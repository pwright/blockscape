var Blockscape=function(){"use strict";var hu=Object.defineProperty;var gu=(Tn,At,ti)=>At in Tn?hu(Tn,At,{enumerable:!0,configurable:!0,writable:!0,value:ti}):Tn[At]=ti;var ei=(Tn,At,ti)=>gu(Tn,typeof At!="symbol"?At+"":At,ti);var Tn=typeof document<"u"?document.currentScript:null;function At(){}function ti(r){return r()}function sr(){return Object.create(null)}function Yi(r){r.forEach(ti)}function lr(r){return typeof r=="function"}function Io(r,l){return r!=r?l==l:r!==l||r&&typeof r=="object"||typeof r=="function"}function zs(r){return Object.keys(r).length===0}const qs=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function k(r,l){r.appendChild(l)}function St(r,l,f){r.insertBefore(l,f||null)}function bt(r){r.parentNode&&r.parentNode.removeChild(r)}function D(r){return document.createElement(r)}function cr(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function na(r){return document.createTextNode(r)}function le(){return na(" ")}function ni(r,l,f,C){return r.addEventListener(l,f,C),()=>r.removeEventListener(l,f,C)}function Gs(r){return function(l){return l.preventDefault(),r.call(this,l)}}function b(r,l,f){f==null?r.removeAttribute(l):r.getAttribute(l)!==f&&r.setAttribute(l,f)}function Ks(r){let l;return{p(...f){l=f,l.forEach(C=>r.push(C))},r(){l.forEach(f=>r.splice(r.indexOf(f),1))}}}function Ys(r){return Array.from(r.childNodes)}function Xs(r,l){l=""+l,r.data!==l&&(r.data=l)}function ii(r,l){r.value=l??""}class Zs{constructor(l=!1){ei(this,"is_svg",!1);ei(this,"e");ei(this,"n");ei(this,"t");ei(this,"a");this.is_svg=l,this.e=this.n=null}c(l){this.h(l)}m(l,f,C=null){this.e||(this.is_svg?this.e=cr(f.nodeName):this.e=D(f.nodeType===11?"TEMPLATE":f.nodeName),this.t=f.tagName!=="TEMPLATE"?f:f.content,this.c(l)),this.i(C)}h(l){this.e.innerHTML=l,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(l){for(let f=0;f<this.n.length;f+=1)St(this.t,this.n[f],l)}p(l){this.d(),this.h(l),this.i(this.a)}d(){this.n.forEach(bt)}}let Xi;function Zi(r){Xi=r}function Qs(){if(!Xi)throw new Error("Function called outside component initialization");return Xi}function el(r){Qs().$$.on_mount.push(r)}const hi=[],dr=[];let gi=[];const ur=[],tl=Promise.resolve();let ia=!1;function nl(){ia||(ia=!0,tl.then(pr))}function oa(r){gi.push(r)}const aa=new Set;let bi=0;function pr(){if(bi!==0)return;const r=Xi;do{try{for(;bi<hi.length;){const l=hi[bi];bi++,Zi(l),il(l.$$)}}catch(l){throw hi.length=0,bi=0,l}for(Zi(null),hi.length=0,bi=0;dr.length;)dr.pop()();for(let l=0;l<gi.length;l+=1){const f=gi[l];aa.has(f)||(aa.add(f),f())}gi.length=0}while(hi.length);for(;ur.length;)ur.pop()();ia=!1,aa.clear(),Zi(r)}function il(r){if(r.fragment!==null){r.update(),Yi(r.before_update);const l=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,l),r.after_update.forEach(oa)}}function ol(r){const l=[],f=[];gi.forEach(C=>r.indexOf(C)===-1?l.push(C):f.push(C)),f.forEach(C=>C()),gi=l}const ko=new Set;let al;function _o(r,l){r&&r.i&&(ko.delete(r),r.i(l))}function ra(r,l,f,C){if(r&&r.o){if(ko.has(r))return;ko.add(r),al.c.push(()=>{ko.delete(r)}),r.o(l)}}function sa(r){r&&r.c()}function Co(r,l,f){const{fragment:C,after_update:S}=r.$$;C&&C.m(l,f),oa(()=>{const F=r.$$.on_mount.map(ti).filter(lr);r.$$.on_destroy?r.$$.on_destroy.push(...F):Yi(F),r.$$.on_mount=[]}),S.forEach(oa)}function xo(r,l){const f=r.$$;f.fragment!==null&&(ol(f.after_update),Yi(f.on_destroy),f.fragment&&f.fragment.d(l),f.on_destroy=f.fragment=null,f.ctx=[])}function rl(r,l){r.$$.dirty[0]===-1&&(hi.push(r),nl(),r.$$.dirty.fill(0)),r.$$.dirty[l/31|0]|=1<<l%31}function Ao(r,l,f,C,S,F,Q=null,j=[-1]){const te=Xi;Zi(r);const _=r.$$={fragment:null,ctx:[],props:F,update:At,not_equal:S,bound:sr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(te?te.$$.context:[])),callbacks:sr(),dirty:j,skip_bound:!1,root:l.target||te.$$.root};Q&&Q(_.root);let ie=!1;if(_.ctx=f?f(r,l.props||{},(U,oe,...ke)=>{const st=ke.length?ke[0]:oe;return _.ctx&&S(_.ctx[U],_.ctx[U]=st)&&(!_.skip_bound&&_.bound[U]&&_.bound[U](st),ie&&rl(r,U)),oe}):[],_.update(),ie=!0,Yi(_.before_update),_.fragment=C?C(_.ctx):!1,l.target){if(l.hydrate){const U=Ys(l.target);_.fragment&&_.fragment.l(U),U.forEach(bt)}else _.fragment&&_.fragment.c();l.intro&&_o(r.$$.fragment),Co(r,l.target,l.anchor),pr()}Zi(te)}class To{constructor(){ei(this,"$$");ei(this,"$$set")}$destroy(){xo(this,1),this.$destroy=At}$on(l,f){if(!lr(f))return At;const C=this.$$.callbacks[l]||(this.$$.callbacks[l]=[]);return C.push(f),()=>{const S=C.indexOf(f);S!==-1&&C.splice(S,1)}}$set(l){this.$$set&&!zs(l)&&(this.$$.skip_bound=!0,this.$$set(l),this.$$.skip_bound=!1)}}const sl="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(sl);const fr="blockscape:apicurioConfig",la="http://localhost:8080/apis/registry/v3",Lo="bs",mr="-series",ca=!1,da=!1;function ll({models:r,getActiveIndex:l,setActive:f,ensureModelMetadata:C,ensureSeriesId:S,getModelId:F,getSeriesId:Q,getModelTitle:j,computeJsonFingerprint:te,uid:_}){let ie=null,U=null,oe=null,ke=null,st=null,Ze=null,Qe=null,Le=null,K=null,G=null;const ye=new Set,M={baseUrl:la,groupId:Lo,authToken:"",enabled:ca,useSemver:da},Ne=new Map,_e=new Map;function pe(u){return(u||"").toString().trim().replace(/\/+$/,"")}function $e(u){return`${(u||"").toString().trim()||Lo}${mr}`}function fe(){return!!(M.baseUrl&&M.groupId)}function ve(){return M.enabled!==!1}function Re(){ye.forEach(u=>{try{u(ve())}catch(g){console.warn("[Blockscape] failed to run Apicurio enabled listener",g)}})}function R(u){return typeof u=="function"&&ye.add(u),()=>ye.delete(u)}function z(){oe&&(oe.value=M.baseUrl||""),ke&&(ke.value=M.groupId||""),st&&(st.value=M.authToken||""),Ze&&(Ze.checked=ve()),Qe&&(Qe.checked=!!M.useSemver)}function d(u="",g="muted"){Le&&(Le.textContent=u||"",Le.classList.remove("is-error","is-success"),g==="error"?Le.classList.add("is-error"):g==="success"&&Le.classList.add("is-success"))}function X(u){if(!G||(G.innerHTML="",!u))return;const g=document.createElement("p");g.className="apicurio-hint",g.textContent=u,G.appendChild(g)}function me(u){Ne.clear(),_e.clear(),X(u)}function he(){const u=l(),g=ve(),L=fe(),A=u>=0?r[u]:null,E=!!(A!=null&&A.apicurioVersions&&A.apicurioVersions.length>1);if(ie){const B=ie.dataset.loading==="true",ee=g&&L&&u>=0&&!!it(r[u]);ie.disabled=!g||B||!ee,g?B||(ie.textContent="Push to Apicurio"):ie.textContent="Enable Apicurio to push"}if(K){const B=K.dataset.loading==="true",ee=g&&L&&E&&!!it(A);K.disabled=!ee||B,K.hidden=!E,g?B||(K.textContent="Push series"):K.textContent="Enable Apicurio to push series"}if(U){const B=U.dataset.loading==="true",ee=g&&L;U.disabled=!ee||B,B||(g?L?U.textContent="List artifacts":U.textContent="Enter details to list":U.textContent="Enable Apicurio to list")}}function ge(){z(),ve()?fe()?(d("Apicurio push is ready when a model is selected.","muted"),Ne.size||X("Click “List artifacts” to browse the current group.")):(d("Enter Apicurio connection details to enable push.","muted"),me("Enter registry details to browse artifacts.")):(d("Apicurio integration is off. Enable it to allow pushes.","muted"),me("Apicurio integration is disabled.")),he()}function et(){if(window!=null&&window.localStorage)try{localStorage.setItem(fr,JSON.stringify(M))}catch(u){console.warn("[Blockscape] unable to persist Apicurio settings",u)}}function Ce(){let u={};if(window!=null&&window.localStorage)try{const B=localStorage.getItem(fr);if(B){const ee=JSON.parse(B);ee&&typeof ee=="object"&&(u=ee)}}catch(B){console.warn("[Blockscape] failed to restore Apicurio settings",B)}const g=pe(u.baseUrl??la),L=(u.groupId??Lo).toString().trim();let A=ca,E=da;typeof u.enabled=="boolean"?A=u.enabled:typeof u.enabled=="string"&&(A=u.enabled==="true"),typeof u.useSemver=="boolean"?E=u.useSemver:typeof u.useSemver=="string"&&(E=u.useSemver==="true"),M.baseUrl=g||la,M.groupId=L||Lo,M.authToken=(u.authToken??"").toString().trim(),M.enabled=A,M.useSemver=E,ge(),Re()}function Ve(){const u={Accept:"application/json"},g=(M.authToken||"").trim();return g&&(u.Authorization=/\s/.test(g)?g:`Bearer ${g}`),u}function tt(u,g,{title:L,description:A,version:E}={}){const B={artifactId:u,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:g},metadata:{properties:{}}}};E&&(B.firstVersion.version=E),L&&(B.name=L),A&&(B.description=A);try{const ee=JSON.parse(g),J=ee==null?void 0:ee.seriesId;J&&typeof J=="string"&&(B.firstVersion.metadata.properties.seriesId=J)}catch{}return B}function ze(u,{version:g}={}){const L={content:{contentType:"application/json",content:u},metadata:{properties:{}}};try{const A=JSON.parse(u),E=A==null?void 0:A.seriesId;E&&typeof E=="string"&&(L.metadata.properties.seriesId=E)}catch{}return g&&(L.version=g),L}function lt(u){if(u==null)return null;const g=String(u).trim();if(!g)return null;const L=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(g);if(L)return{major:Number(L[1]),minor:Number(L[2]),patch:Number(L[3])};const A=/^v?(\d+)$/.exec(g);return A?{major:Number(A[1]),minor:0,patch:0}:null}function vt(u){return`${u.major}.${u.minor}.${u.patch}`}function Ge(u,g){return!u&&!g?0:u?g?u.major!==g.major?u.major-g.major:u.minor!==g.minor?u.minor-g.minor:u.patch-g.patch:1:-1}function P(u=[]){let g=null;if(u.forEach(A=>{const E=lt((A==null?void 0:A.version)??A);E&&(!g||Ge(E,g)>0)&&(g=E)}),!g)return"1.0.0";const L={...g,patch:g.patch+1};return vt(L)}function it(u,{seriesName:g,fallbackTitle:L}={}){var B;if(!u)return null;const A=g||u.title||u.apicurioArtifactName||j(u),E=L||A;if(typeof S=="function"&&(u.isSeries||((B=u.apicurioVersions)==null?void 0:B.length)>1)&&S(u,{seriesName:A,fallbackTitle:E}),typeof Q=="function"){const ee=Q(u,{seriesName:A,fallbackTitle:E});if(ee)return ee}return F(u)}function Ht(u){return Array.isArray(u)?u:Array.isArray(u==null?void 0:u.artifacts)?u.artifacts:Array.isArray(u==null?void 0:u.items)?u.items:Array.isArray(u==null?void 0:u.results)?u.results:[]}function y(u){return Array.isArray(u)?u:Array.isArray(u==null?void 0:u.versions)?u.versions:Array.isArray(u==null?void 0:u.items)?u.items:[]}function w(u=[]){if(!Array.isArray(u)||!u.length)return null;const g=[...u].filter(Boolean);return g.sort((L,A)=>{const E=L!=null&&L.createdOn?new Date(L.createdOn).getTime():0,B=A!=null&&A.createdOn?new Date(A.createdOn).getTime():0;if(E!==B)return B-E;const ee=Number(L==null?void 0:L.version),J=Number(A==null?void 0:A.version),Ee=Number.isFinite(ee),de=Number.isFinite(J);if(Ee&&de&&ee!==J)return J-ee;const be=String((L==null?void 0:L.version)??"");return String((A==null?void 0:A.version)??"").localeCompare(be,void 0,{numeric:!0})}),g[0]||null}function Oe(u){if(!u)return u;let g=u;if(!Array.isArray(u==null?void 0:u.categories)){const A=u==null?void 0:u.content;if(typeof A=="string")try{g=JSON.parse(A)}catch(E){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",E)}else A&&typeof A=="object"&&(g=A)}return g}async function q(u,g,L){const A=encodeURIComponent(g),E=encodeURIComponent(L),B=`${u}/groups/${A}/artifacts/${E}`,ee=Ve();ee.Accept="application/json";const J=await fetch(B,{method:"GET",headers:ee});if(!J.ok){let Ee=J.statusText||"Unknown error";try{const de=await J.text();de&&(Ee=de.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${J.status}): ${Ee}`)}return J.json()}async function Te(u,g,L){const A=encodeURIComponent(g),E=encodeURIComponent(L),B=`${u}/groups/${A}/artifacts/${E}/versions?limit=50&order=desc`,ee=Ve();ee.Accept="application/json";const J=await fetch(B,{method:"GET",headers:ee});if(!J.ok){let de=J.statusText||"Unknown error";try{const be=await J.text();be&&(de=be.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${J.status}): ${de}`)}const Ee=await J.json();return y(Ee).filter(de=>de&&de.version!=null)}async function pt(u,g,L,A="latest"){const E=encodeURIComponent(g),B=encodeURIComponent(L),ee=encodeURIComponent(A||"latest"),J=`${u}/groups/${E}/artifacts/${B}/versions/${ee}/content`,Ee=Ve();Ee.Accept="application/json, application/*+json, */*;q=0.8";const de=await fetch(J,{method:"GET",headers:Ee});if(!de.ok){let We=de.statusText||"Unknown error";try{const xe=await de.text();xe&&(We=xe.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${de.status}): ${We}`)}const be=await de.text();let Me=null;try{Me=JSON.parse(be)}catch{throw new Error("Artifact content is not valid JSON.")}return Oe(Me)}async function Y(u,g,L,A="latest"){const E=await pt(u,g,L,A);return{data:E,fingerprint:te(E)}}async function Ke(u,g,L){try{const E=await Te(u,g,L);if(E!=null&&E.length){_e.set(L,E);const B=w(E);if((B==null?void 0:B.version)!=null)return B.version}}catch(E){console.warn("[Blockscape] compare-version: unable to fetch versions list",E)}try{const E=await q(u,g,L);if((E==null?void 0:E.version)!=null)return E.version}catch(E){console.warn("[Blockscape] compare-version: unable to fetch metadata",E)}const A=_e.get(L);if(A&&A.length){const E=w(A);if((E==null?void 0:E.version)!=null)return E.version}return"latest"}async function ft(u,g,L,A){if(!M.useSemver)return null;if(!A)return"1.0.0";try{const E=await Te(u,g,L);return P(E)}catch(E){throw new Error(`Unable to compute next semantic version: ${E.message}`)}}function ct(u=document){ie=u.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),K=u.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),U=u.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),oe=u.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),ke=u.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),st=u.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),Ze=u.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),Qe=u.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),Le=u.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),G=u.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function vn(){M.baseUrl=pe((oe==null?void 0:oe.value)??M.baseUrl),M.groupId=((ke==null?void 0:ke.value)??"").trim(),M.authToken=((st==null?void 0:st.value)??"").trim(),et(),ge()}function Gt(u){M.enabled=u!==!1,et(),ge(),Re()}function Ft(){Gt(Ze?Ze.checked:ca)}function Jn(){M.useSemver=Qe?Qe.checked:da,et(),ge()}function wt(){[oe,ke,st].forEach(u=>{u&&u.addEventListener("input",vn)}),ie&&ie.addEventListener("click",()=>{Ot()}),K&&K.addEventListener("click",()=>{Zt()}),Ze&&Ze.addEventListener("change",Ft),Qe&&Qe.addEventListener("change",Jn),U&&U.addEventListener("click",kn),G&&G.addEventListener("click",u=>{const g=u.target.closest("[data-artifact-version]");if(g){u.stopPropagation();const E=g.dataset.artifactId,B=g.dataset.artifactVersion;E&&B&&Kt(E,B);return}const L=u.target.closest("[data-artifact-load-all]");if(L){u.stopPropagation(),L.dataset.artifactId&&zn();return}const A=u.target.closest("[data-artifact-trigger]");if(A){const E=A.dataset.artifactId;if(!E)return;Xt(E)}})}function yn(){const u=document.createElement("div");return u.className="blockscape-registry-panel",u.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,u}function Nn(u){if(!u)return;u.innerHTML="";const g=yn();u.appendChild(g),ct(u),wt(),ge()}function ai(u){if(!G)return;if(G.innerHTML="",!u.length){X("No artifacts found in this group.");return}const g=E=>{const B=document.createElement("section");B.className="apicurio-artifact-section";const ee=document.createElement("h3");ee.textContent=E,B.appendChild(ee);const J=document.createElement("ul");return J.className="apicurio-artifact-list",B.appendChild(J),{section:B,list:J}},L=g("Series artifacts"),A=g("Artifacts");u.forEach(E=>{if(!(E!=null&&E.artifactId))return;const ee=E._groupId&&E._groupId.endsWith(mr)?L.list:A.list,J=document.createElement("li"),Ee=document.createElement("button");Ee.type="button",Ee.className="apicurio-artifact",Ee.dataset.artifactId=E.artifactId,Ee.dataset.artifactTrigger="toggle";const de=document.createElement("span");de.className="apicurio-artifact-title",de.textContent=E.artifactId,Ee.appendChild(de);const be=[];if(E.name&&be.push(E.name),E.version!=null&&be.push(`v${E.version}`),E.type&&be.push(E.type),E._groupId&&be.push(E._groupId),be.length){const xe=document.createElement("span");xe.className="apicurio-artifact-meta",xe.textContent=be.join(" • "),Ee.appendChild(xe)}if(E.description){const xe=document.createElement("span");xe.className="apicurio-artifact-meta",xe.textContent=E.description,Ee.appendChild(xe)}J.appendChild(Ee);const Me=document.createElement("div");Me.className="apicurio-version-list",Me.dataset.versionPanel=E.artifactId,Me.hidden=!0;const We=document.createElement("p");We.className="apicurio-hint",We.textContent="Click to load the latest or open versions.",Me.appendChild(We),J.appendChild(Me),ee.appendChild(J)}),L.list.children.length&&G.appendChild(L.section),A.list.children.length&&G.appendChild(A.section)}function In(u){return G?G.querySelector(`[data-version-panel="${u}"]`):null}function $t(u,g){if(!u||(u.innerHTML="",!g))return;const L=document.createElement("p");L.className="apicurio-hint",L.textContent=g,u.appendChild(L)}function rn(u,g){const L=In(u);if(L){if(L.innerHTML="",!g.length){$t(L,"No versions found for this artifact.");return}g.forEach(A=>{const E=document.createElement("button");E.type="button",E.className="apicurio-version-button",E.dataset.artifactId=u,E.dataset.artifactVersion=A.version;const B=[`Version ${A.version}`];if(A.createdOn){const ee=new Date(A.createdOn);isNaN(ee)||B.push(ee.toISOString().slice(0,10))}E.textContent=B.join(" — "),L.appendChild(E)})}}async function Xt(u){const g=In(u);if(!g)return;if(g.dataset.open==="true"){g.hidden=!0,g.dataset.open="false";return}if(g.hidden=!1,g.dataset.open="true",g.dataset.loaded!=="true"){if(!fe()){$t(g,"Enter registry details first.");return}$t(g,"Loading versions…");try{const A=pe(M.baseUrl),E=Ne.get(u),B=M.groupId.trim(),ee=(E==null?void 0:E._groupId)||B,J=await Te(A,ee,u);_e.set(u,J),g.dataset.loaded="true",rn(u,J)}catch(A){console.error("[Blockscape] failed to load versions",A),$t(g,`Unable to fetch versions: ${A.message}`)}}}function sn(u,g){var A;const L=r.findIndex(E=>E.apicurioArtifactId===u);if(L!==-1){const E=r[L].id;r[L]={...g,id:E||g.id},((A=r[L].apicurioVersions)==null?void 0:A.length)>1&&(r[L].isSeries=!0),f(L)}else r.push(g),f(r.length-1)}async function yt(u,g,L,A){const E=encodeURIComponent(g),B=encodeURIComponent(L),ee=`${u}/groups/${E}/artifacts/${B}`;try{const J=await fetch(ee,{method:"GET",headers:A});if(J.status===404)return!1;if(J.ok)return!0;throw J.status===401||J.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${J.status} while checking the artifact.`)}catch(J){throw J instanceof TypeError?new Error("Network error while contacting Apicurio registry."):J}}async function Ot(){var ee;if(!ie||ie.dataset.loading==="true")return;if(!ve()){d("Apicurio integration is off. Enable it first.","error");return}if(!fe()){d("Enter the registry base URL and group ID before pushing.","error");return}const u=l();if(u<0||!r[u]){d("No active model to push.","error");return}const g=it(r[u],{fallbackTitle:j(r[u])});if(!g){d("Active model needs an id before pushing.","error");return}const L=pe(M.baseUrl),A=M.groupId.trim(),E=JSON.stringify(r[u].data,null,2),B=Ve();ie.dataset.loading="true",ie.textContent="Pushing…",ie.disabled=!0,d("Pushing to Apicurio…","muted");try{const J=await yt(L,A,g,B),Ee=te(r[u].data);if(J)try{const dt=await Ke(L,A,g),{data:It,fingerprint:Et}=await Y(L,A,g,dt);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",dt),console.log("local fingerprint",Ee),console.log("registry fingerprint",Et),console.log("local payload",r[u].data),console.log("registry payload",It),console.groupEnd(),Ee&&Et&&Ee===Et){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){d("Push cancelled (content matches the latest registry version).","muted");return}d("Pushing identical content by user choice.","muted")}else Et?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):d("Unable to compare with registry content (skipping confirmation).","muted")}catch(dt){console.warn("[Blockscape] unable to compare registry content before push",dt),d("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const de=M.useSemver?await ft(L,A,g,J):null;if(M.useSemver&&!de)throw new Error("Semantic versioning is enabled but no version could be computed.");const be=encodeURIComponent(A),Me=encodeURIComponent(g),We=J?`${L}/groups/${be}/artifacts/${Me}/versions`:`${L}/groups/${be}/artifacts`,xe={...B,"Content-Type":"application/json"};de&&(xe["X-Registry-Version"]=de,d(`Pushing to Apicurio as version ${de}…`,"muted"));const Rt=J?ze(E,{version:de}):tt(g,E,{title:j(r[u]),description:(ee=r[u].data)==null?void 0:ee.abstract,version:de}),ce=await fetch(We,{method:"POST",headers:xe,body:JSON.stringify(Rt)});if(!ce.ok){let dt=ce.statusText||"Unknown error";try{const It=await ce.text();It&&(dt=It.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${ce.status}): ${dt}`)}let Se=null;try{Se=await ce.json()}catch{Se=null}const je=(Se==null?void 0:Se.version)||(Se==null?void 0:Se.globalId)||"",ht=J?"Updated":"Created",ln=je?` (version ${je})`:"";d(`${ht} ${g}${ln}`,"success")}catch(J){console.error("[Blockscape] Apicurio push failed",J),d(`Apicurio push failed: ${J.message}`,"error")}finally{ie.dataset.loading="false",he()}}async function Zt(){var de,be;if(!K||K.dataset.loading==="true")return;if(!ve()){d("Apicurio integration is off. Enable it first.","error");return}if(!fe()){d("Enter the registry base URL and group ID before pushing.","error");return}const u=l(),g=u>=0?r[u]:null;if(!g||!g.apicurioVersions||g.apicurioVersions.length<2){d("Series push requires a model with multiple versions.","error");return}const L=it(g,{seriesName:g.title||g.apicurioArtifactName||j(g)});if(!L){d("Active series needs an id before pushing.","error");return}typeof S=="function"&&S(g,{seriesName:g.title||g.apicurioArtifactName||j(g)});const A=pe(M.baseUrl),E=M.groupId.trim(),B=g.apicurioVersions.map(Me=>Me.data),ee=JSON.stringify(B,null,2),J=Ve(),Ee=$e(E);K.dataset.loading="true",K.textContent="Pushing…",K.disabled=!0,d("Pushing series to Apicurio…","muted");try{const Me=await yt(A,Ee,L,J),We=te(B);if(Me)try{const cn=await Ke(A,Ee,L),{data:Cn,fingerprint:ri}=await Y(A,Ee,L,cn);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",cn),console.log("local fingerprint",We),console.log("registry fingerprint",ri),console.log("local payload (series)",B),console.log("registry payload",Cn),console.groupEnd(),We&&ri&&We===ri){if(!window.confirm("The current registry version matches this series. Push anyway?")){d("Series push cancelled (content matches latest).","muted");return}d("Pushing identical series by user choice.","muted")}else ri?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):d("Unable to compare with registry content (skipping confirmation).","muted")}catch(cn){console.warn("[Blockscape] unable to compare registry content before series push",cn),d("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const xe=M.useSemver?await ft(A,Ee,L,Me):null;if(M.useSemver&&!xe)throw new Error("Semantic versioning is enabled but no version could be computed.");const Rt=encodeURIComponent(Ee),ce=encodeURIComponent(L),Se=Me?`${A}/groups/${Rt}/artifacts/${ce}/versions`:`${A}/groups/${Rt}/artifacts`,je={...J,"Content-Type":"application/json"};xe&&(je["X-Registry-Version"]=xe,d(`Pushing series to Apicurio as version ${xe}…`,"muted"));const ht=Me?ze(ee,{version:xe}):tt(L,ee,{title:g.apicurioArtifactName||((de=g.data)==null?void 0:de.title)||L,description:(be=g.data)==null?void 0:be.abstract,version:xe}),ln=await fetch(Se,{method:"POST",headers:je,body:JSON.stringify(ht)});if(!ln.ok){let cn=ln.statusText||"Unknown error";try{const Cn=await ln.text();Cn&&(cn=Cn.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${ln.status}): ${cn}`)}let dt=null;try{dt=await ln.json()}catch{dt=null}const It=(dt==null?void 0:dt.version)||(dt==null?void 0:dt.globalId)||"",Et=Me?"Updated":"Created",_n=It?` (version ${It})`:"";d(`${Et} ${L} series${_n}`,"success")}catch(Me){console.error("[Blockscape] Apicurio series push failed",Me),d(`Apicurio series push failed: ${Me.message}`,"error")}finally{K.dataset.loading="false",he()}}async function kn(){if(!U||U.dataset.loading==="true")return;if(!ve()){d("Enable Apicurio integration to list artifacts.","error");return}if(!fe()){d("Enter registry base URL and group ID before listing.","error");return}const u=pe(M.baseUrl),g=M.groupId.trim(),L=$e(g),A=[{groupId:g,label:"base"},{groupId:L,label:"series"}];U.dataset.loading="true",U.textContent="Listing…",U.disabled=!0,d("Listing artifacts…","muted"),X("Contacting registry…");try{const E=Ve();E.Accept="application/json";const B=[];for(const J of A){const Ee=encodeURIComponent(J.groupId),de=`${u}/groups/${Ee}/artifacts?limit=50&offset=0`,be=await fetch(de,{method:"GET",headers:E});if(!be.ok){let xe=be.statusText||"Unknown error";try{const Rt=await be.text();Rt&&(xe=Rt.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${J.groupId} (${be.status}): ${xe}`);continue}const Me=await be.json(),We=Ht(Me).filter(xe=>xe&&xe.artifactId);We.forEach(xe=>{xe&&(xe._groupId=J.groupId)}),B.push(...We)}Ne.clear(),_e.clear(),B.forEach(J=>{J!=null&&J.artifactId&&Ne.set(J.artifactId,J)}),ai(B);const ee=B.length;d(ee?`Found ${ee} artifact${ee===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",ee?"success":"muted")}catch(E){console.error("[Blockscape] failed to list artifacts",E),me("Unable to list artifacts."),d(`Listing failed: ${E.message}`,"error")}finally{U.dataset.loading="false",he()}}async function Kt(u,g=null){var Me,We,xe,Rt,ce,Se;if(!u)return;if(!ve()){d("Enable Apicurio integration to load artifacts.","error");return}if(!fe()){d("Enter registry connection details before loading artifacts.","error");return}const L=pe(M.baseUrl),A=M.groupId.trim(),E=u&&((Me=Ne.get(u))==null?void 0:Me._groupId)||A;let B=Ne.get(u);const ee=async()=>{try{const je=await q(L,E,u);return je!=null&&je.artifactId&&Ne.set(u,je),je}catch(je){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",je),je}};if(!B)try{B=await ee()}catch(je){d(`Failed to fetch artifact metadata: ${je.message}`,"error");return}const J=_e.get(u)||[];let Ee="latest",de="latest";if(g)Ee=g,de=g;else{if(!B||B.version==null)try{B=await ee()}catch(je){d(`Failed to fetch artifact metadata: ${je.message}`,"error");return}Ee=(B==null?void 0:B.version)||"latest",de=(B==null?void 0:B.version)||"latest"}const be=J.find(je=>String(je.version)===String(Ee));(be==null?void 0:be.version)!=null&&(de=be.version),d(`Loading artifact ${u}…`,"muted");try{const je=await pt(L,E,u,Ee),ht=Ne.get(u)||B||{},ln=Array.isArray(je);let dt=null;if(ln){const It=je.map((_n,cn)=>(C(_n,{titleHint:ht.name||u,idHint:u}),{version:String(cn+1),data:_n,createdOn:(be==null?void 0:be.createdOn)||ht.createdOn}));dt={id:_(),title:((xe=(We=It[0])==null?void 0:We.data)==null?void 0:xe.title)||ht.name||u,data:(Rt=It[0])==null?void 0:Rt.data,apicurioArtifactId:u,apicurioArtifactName:ht.name||"",apicurioVersions:It,apicurioActiveVersionIndex:0,isSeries:!0};const Et=((ce=ht==null?void 0:ht.properties)==null?void 0:ce.seriesId)||u;typeof S=="function"&&S(dt,{seriesName:Et,fallbackTitle:Et}),d(`Loaded series artifact ${u}.`,"success")}else{C(je,{titleHint:ht.name||u,idHint:u});const It={version:de,data:je,createdOn:(be==null?void 0:be.createdOn)||ht.createdOn};dt={id:_(),title:je.title||ht.name||u,data:je,apicurioArtifactId:u,apicurioArtifactName:ht.name||"",apicurioVersions:[It],apicurioActiveVersionIndex:0};const Et=(Se=ht==null?void 0:ht.properties)==null?void 0:Se.seriesId;Et&&typeof S=="function"&&S(dt,{seriesName:Et,fallbackTitle:Et});const _n=de?` (version ${de})`:"";d(`Loaded artifact ${u}${_n}.`,"success")}sn(u,dt)}catch(je){console.error("[Blockscape] failed to load artifact",je),d(`Failed to load artifact: ${je.message}`,"error")}}async function zn(u){}return{hydrateConfig:Ce,mount:Nn,updateAvailability:he,isEnabled:ve,setEnabled:Gt,onEnabledChange:R}}const an={color:{borderMuted:"#e5e7eb",surfaceGhost:"#f8fafc",primary:"#2563eb",dangerStrong:"#b42318",success:"#22c55e",ink:"#111111",white:"#ffffff"},blockscape:{revdep:"#ef4444"},palette:{letter:{A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"},letterFallback:"#9ca3af"}};function Wn(r,l){if(typeof r!="function")throw new Error(`[itemEditor] expected ${l} to be a function`)}function cl(r){return(r||"item").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"item"}function dl(r,{excludeId:l}={}){if(!r)return[];const f=r.split(/[\s,]+/).map(S=>S.trim()).filter(Boolean),C=[];return f.forEach(S=>{l&&S===l||C.includes(S)||C.push(S)}),C}function ul(r,l,f){if(!l||!f||l===f)return;((r==null?void 0:r.categories)||[]).forEach(S=>{(S.items||[]).forEach(F=>{Array.isArray(F.deps)&&(F.deps=F.deps.map(Q=>Q===l?f:Q))})}),Array.isArray(r==null?void 0:r.links)&&r.links.forEach(S=>{S.from===l&&(S.from=f),S.to===l&&(S.to=f)})}function pl({findItemAndCategoryById:r,collectAllItemIds:l,updateItemReferences:f,loadActiveIntoEditor:C,rebuildFromActive:S,select:F,onSelectionRenamed:Q,makeSlug:j=cl,isAutoIdFromNameEnabled:te=()=>!0}={}){Wn(r,"findItemAndCategoryById"),Wn(l,"collectAllItemIds"),Wn(f,"updateItemReferences"),Wn(C,"loadActiveIntoEditor"),Wn(S,"rebuildFromActive"),Wn(F,"select"),Wn(j,"makeSlug"),Wn(te,"isAutoIdFromNameEnabled");const _={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null,autoIdManuallyEdited:!1,autoSyncEnabled:!0};function ie(K){if(_.fields.errorEl){if(!K){_.fields.errorEl.hidden=!0,_.fields.errorEl.textContent="";return}_.fields.errorEl.hidden=!1,_.fields.errorEl.textContent=K}}function U(){_.wrapper&&(_.wrapper.hidden=!0,_.wrapper.setAttribute("aria-hidden","true"),ie(""),_.categoryId=null,_.itemId=null,_.modelData=null,document.body.classList.remove("item-editor-open"))}function oe(){_.wrapper&&(_.wrapper.hidden=!1,_.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var K,G;(K=_.fields.nameInput)==null||K.focus(),(G=_.fields.nameInput)==null||G.select()}))}function ke({force:K}={}){var ye,M;if(!((ye=_.fields)!=null&&ye.idInput)||!((M=_.fields)!=null&&M.nameInput)||!_.autoSyncEnabled||!te()||!K&&_.autoIdManuallyEdited)return;const G=j(_.fields.nameInput.value||_.itemId||"item");_.fields.idInput.value=G}function st(K){var ve;if(!_.modelData||!_.categoryId||!_.itemId)throw new Error("No item loaded.");const ye=(((ve=_.modelData)==null?void 0:ve.categories)||[]).find(Re=>Re.id===_.categoryId);if(!ye)throw new Error("Category not found.");ye.items=ye.items||[];const M=ye.items.find(Re=>Re.id===_.itemId);if(!M)throw new Error("Item not found.");const Ne=(K.id||"").trim();if(!Ne)throw new Error("ID is required.");const _e=l(_.modelData);if(Ne!==M.id&&_e.has(Ne))throw new Error("Another item already uses that ID.");M.id=Ne;const pe=(K.name||"").trim();M.name=pe||M.id;const $e=(K.logo||"").trim();if($e?M.logo=$e:delete M.logo,K.externalFlag&&!K.external)M.external=!0;else{const Re=(K.external??"").toString().trim();Re?M.external=Re:delete M.external}const fe=(K.color||"").trim();return fe?M.color=fe:delete M.color,M.deps=Array.isArray(K.deps)?K.deps:[],M.id!==K.originalId&&typeof Q=="function"&&Q(K.originalId,M.id),f(_.modelData,K.originalId,M.id),C(),S(),F(M.id),M.id}function Ze(){if(!_.fields||!_.fields.idInput)return!1;const K=(_.fields.idInput.value||"").trim(),G={originalId:_.itemId,id:K,name:_.fields.nameInput.value||"",logo:_.fields.logoInput.value||"",external:_.fields.externalInput.value||"",externalFlag:_.fields.externalFlagInput.checked,color:_.fields.colorInput.value||"",deps:dl(_.fields.depsInput.value,{excludeId:K})};try{return st(G),U(),!0}catch(ye){return console.warn("[itemEditor] item edit failed",ye),ie((ye==null?void 0:ye.message)||"Unable to save item."),!1}}function Qe(){if(_.wrapper)return _.wrapper;const K=document.createElement("div");K.className="item-editor-modal",K.hidden=!0,K.setAttribute("role","dialog"),K.setAttribute("aria-modal","true");const G=document.createElement("div");G.className="item-editor-modal__backdrop",K.appendChild(G);const ye=document.createElement("div");ye.className="item-editor",K.appendChild(ye);const M=document.createElement("div");M.className="item-editor__header";const Ne=document.createElement("h2");Ne.className="item-editor__title",Ne.textContent="Edit item";const _e=document.createElement("button");_e.type="button",_e.className="item-editor__close",_e.setAttribute("aria-label","Close item editor"),_e.textContent="×",M.appendChild(Ne),M.appendChild(_e),ye.appendChild(M);const pe=document.createElement("form");pe.className="item-editor__form",ye.appendChild(pe);const $e=document.createElement("div");$e.className="item-editor__meta",$e.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',pe.appendChild($e);const fe=document.createElement("div");fe.className="item-editor__error",fe.hidden=!0,pe.appendChild(fe);const ve=(y,w,Oe)=>{const q=document.createElement("label");q.className="item-editor__field";const Te=document.createElement("span");if(Te.className="item-editor__label",Te.textContent=y,q.appendChild(Te),w.classList.add("item-editor__control"),q.appendChild(w),Oe){const pt=document.createElement("div");pt.className="item-editor__hint",pt.textContent=Oe,q.appendChild(pt)}return q},Re=document.createElement("input");Re.type="text",Re.required=!0,pe.appendChild(ve("ID",Re,"Unique identifier used for links and dependencies."));const R=document.createElement("input");R.type="text",pe.appendChild(ve("Name",R,"Visible label shown on the tile."));const z=document.createElement("input");z.type="url",z.inputMode="url",z.placeholder="https://…",pe.appendChild(ve("Logo URL",z,"Optional image URL."));const d=document.createElement("input");d.type="url",d.inputMode="url",d.placeholder="https://…",pe.appendChild(ve("External link",d,"Shown with ↗ icon and in preview."));const X=document.createElement("div");X.className="item-editor__checkbox";const me=document.createElement("label");me.className="item-editor__checkbox-row";const he=document.createElement("input");he.type="checkbox";const ge=document.createElement("span");ge.textContent="Mark as external without link";const et=document.createElement("div");et.className="item-editor__hint",et.textContent="Keeps dashed border even without a URL.",me.appendChild(he),me.appendChild(ge),X.appendChild(me),X.appendChild(et),pe.appendChild(X);const Ce=document.createElement("input");Ce.type="text",Ce.placeholder=an.color.primary,pe.appendChild(ve("Color",Ce,"Optional badge color (hex or CSS color)."));const Ve=document.createElement("textarea");Ve.rows=2,Ve.placeholder="Comma or space separated ids",pe.appendChild(ve("Dependencies",Ve,"Use item IDs, separated by commas or spaces."));const tt=document.createElement("div");tt.className="item-editor__checkbox";const ze=document.createElement("label");ze.className="item-editor__checkbox-row";const lt=document.createElement("input");lt.type="checkbox";const vt=document.createElement("span");vt.textContent="Sync ID while editing name";const Ge=document.createElement("div");Ge.className="item-editor__hint",Ge.textContent="Turn off to keep typing names without changing the ID.",ze.appendChild(lt),ze.appendChild(vt),tt.appendChild(ze),tt.appendChild(Ge),pe.appendChild(tt);const P=document.createElement("div");P.className="item-editor__actions";const it=document.createElement("button");it.type="button",it.className="pf-v5-c-button pf-m-tertiary",it.textContent="Cancel";const Ht=document.createElement("button");return Ht.type="submit",Ht.className="pf-v5-c-button pf-m-primary",Ht.textContent="Save",P.appendChild(it),P.appendChild(Ht),pe.appendChild(P),_.wrapper=K,_.fields={idInput:Re,nameInput:R,logoInput:z,externalInput:d,externalFlagInput:he,colorInput:Ce,depsInput:Ve,syncCheckbox:lt,categoryValue:$e.querySelector(".item-editor__meta-value"),errorEl:fe},it.addEventListener("click",U),_e.addEventListener("click",U),G.addEventListener("click",U),Re.addEventListener("input",()=>{_.autoIdManuallyEdited=!0}),R.addEventListener("input",ke),lt.addEventListener("change",()=>{_.autoSyncEnabled=!!lt.checked,_.autoSyncEnabled&&(_.autoIdManuallyEdited=!1,ke({force:!0}))}),pe.addEventListener("submit",y=>{y.preventDefault(),Ze()}),document.addEventListener("keydown",y=>{y.key==="Escape"&&!K.hidden&&(y.preventDefault(),y.stopPropagation(),U())}),document.body.appendChild(K),K}function Le(K){const G=r(K);if(!G)return!1;Qe(),_.categoryId=G.category.id,_.itemId=G.item.id,_.modelData=G.modelData,_.autoIdManuallyEdited=!1;const ye=!!te();return _.autoSyncEnabled=ye,_.fields.categoryValue.textContent=G.category.title||G.category.id,_.fields.idInput.value=G.item.id||"",_.fields.nameInput.value=G.item.name||"",_.fields.logoInput.value=G.item.logo||"",_.fields.externalInput.value=typeof G.item.external=="string"?G.item.external:"",_.fields.externalFlagInput.checked=G.item.external===!0,_.fields.colorInput.value=G.item.color||"",_.fields.depsInput.value=Array.isArray(G.item.deps)?G.item.deps.join(", "):"",_.fields.syncCheckbox.checked=_.autoSyncEnabled,_.fields.syncCheckbox.disabled=!ye,!_.fields.idInput.value&&ye&&ke({force:!0}),ie(""),F(G.item.id),oe(),!0}return{open:Le,hide:U,isOpen:()=>!!_.wrapper&&!_.wrapper.hidden}}function fl({menuEl:r,previewEl:l,previewTitleEl:f,previewBodyEl:C,previewActionsEl:S,previewCloseEl:F,escapeHtml:Q,onEditItem:j,onChangeColor:te,selectItem:_,colorPresets:ie=[]}={}){const U=r||(()=>{const R=document.createElement("div");return R.className="tile-context-menu",R.hidden=!0,R.setAttribute("aria-hidden","true"),document.body.appendChild(R),R})();let oe={x:0,y:0},ke=0,st=Array.isArray(ie)?ie:[];function Ze(){U&&(U.classList.remove("is-open"),U.hidden=!0,U.setAttribute("aria-hidden","true"),U.innerHTML="")}function Qe(R=[]){S&&(S.innerHTML="",R.forEach(z=>{const d=document.createElement("button");d.type="button",d.className="item-preview__action",d.textContent=z.label||"Action",z.title&&(d.title=z.title),d.addEventListener("click",X=>{X.stopPropagation(),typeof z.onClick=="function"&&z.onClick(X)}),S.appendChild(d)}),S.hidden=R.length===0)}function Le(){Ze(),l&&(l.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),l.setAttribute("aria-hidden","true"),l.hidden=!0,Qe([]))}function K(R,z){l&&(oe={x:R,y:z},l.hidden=!1,l.setAttribute("aria-hidden","false"),l.classList.add("is-visible"),G(R,z))}function G(R,z){if(!l)return;const d=12;l.style.left=`${R+d}px`,l.style.top=`${z+d}px`;const X=l.getBoundingClientRect();let me=X.left,he=X.top;X.right>window.innerWidth-d&&(me=Math.max(d,window.innerWidth-X.width-d)),X.bottom>window.innerHeight-d&&(he=Math.max(d,window.innerHeight-X.height-d)),l.style.left=`${me}px`,l.style.top=`${he}px`}function ye(R,z){var ge;if(!R)return null;const d=R.dataset.id,X=((ge=R.querySelector(".name"))==null?void 0:ge.textContent)||d||"Preview",me=d?`${d}.html`:"",he=me?`items/${me}`:"";return{id:d,displayName:X,filename:me,filepath:he,externalUrl:R.dataset.externalUrl||"",obsidianUrl:R.dataset.obsidianUrl||"",anchorX:(z==null?void 0:z.clientX)??0,anchorY:(z==null?void 0:z.clientY)??0}}function M(R,z){const d=document.createElement("button");return d.type="button",d.className="tile-context-menu__item",d.textContent=R,d.addEventListener("click",()=>{Ze(),typeof z=="function"&&z()}),d}function Ne(R){if(!U)return;U.innerHTML="";const z=document.createElement("div");z.className="tile-context-menu__list",z.appendChild(M("File view",()=>pe(R))),typeof j=="function"&&z.appendChild(M("Edit",()=>j(R.id))),typeof te=="function"&&R.id&&st.forEach(d=>{if(!(d!=null&&d.value))return;const X=d.name||d.value;z.appendChild(M(`Set color: ${X}`,()=>te(R.id,d.value)))}),U.appendChild(z)}function _e(R,z){if(!U)return;const d=4;U.style.left=`${R+d}px`,U.style.top=`${z+d}px`,U.hidden=!1,U.setAttribute("aria-hidden","false"),U.classList.add("is-open");const X=U.getBoundingClientRect();let me=X.left,he=X.top;X.right>window.innerWidth-d&&(me=Math.max(d,window.innerWidth-X.width-d)),X.bottom>window.innerHeight-d&&(he=Math.max(d,window.innerHeight-X.height-d)),U.style.left=`${me}px`,U.style.top=`${he}px`}async function pe(R){if(!l||!f||!C||!R)return;const z=++ke,d=[];if(typeof j=="function"&&R.id&&d.push({label:"Edit",title:"Edit this item",onClick:()=>{Le(),j(R.id)}}),R.externalUrl&&d.push({label:"Open link ↗",title:R.externalUrl,onClick:()=>window.open(R.externalUrl,"_blank","noopener")}),R.obsidianUrl&&d.push({label:"Open in Obsidian",title:R.obsidianUrl,onClick:()=>window.open(R.obsidianUrl,"_blank","noopener")}),Qe(d),R.id&&typeof _=="function"&&_(R.id),f.textContent=R.displayName,C.innerHTML='<div class="item-preview__status">Loading…</div>',l.classList.remove("item-preview--has-frame"),l.classList.add("item-preview--expanded"),K(R.anchorX,R.anchorY),!R.filepath){C.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',G(oe.x,oe.y);return}try{const X=await fetch(R.filepath,{cache:"no-cache"});if(!X.ok)throw new Error(`HTTP ${X.status}`);const me=await X.text();if(z!==ke)return;if(!me.trim()){const et=Q?Q(R.filename):R.filename;C.innerHTML=`<div class="item-preview__status">No content in <code>${et}</code>.</div>`,G(oe.x,oe.y);return}const ge=document.createElement("iframe");ge.className="item-preview__frame",ge.title=`${R.displayName} details`,ge.srcdoc=me,C.innerHTML="",C.appendChild(ge),l.classList.add("item-preview--has-frame"),G(oe.x,oe.y)}catch(X){if(z!==ke)return;const me=Q?Q(R.displayName):R.displayName;C.innerHTML=`<div class="item-preview__status">No preview available for <strong>${me}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${R.filepath}`,X),G(oe.x,oe.y)}}function $e(R,z){if(!z)return;R.preventDefault(),R.stopPropagation();const d=ye(z,R);!d||!d.id||(typeof _=="function"&&_(d.id),Ne(d),_e(R.clientX,R.clientY))}function fe(R){const z=R==null?void 0:R.target,d=U&&!U.hidden&&U.contains(z),X=l&&!l.hidden&&l.contains(z);!d&&!X&&Le()}function ve(){!l||l.hidden||G(oe.x,oe.y)}function Re(){Le()}return F&&F.addEventListener("click",Le),{handleTileContextMenu:$e,hidePreview:Le,hideMenu:Ze,handleDocumentClick:fe,handleWindowResize:ve,handleWindowScroll:Re,updateColorPresets:R=>{st=Array.isArray(R)?R:[]}}}function hr(r,l="series"){return(r||l).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||l}function wn(r,l="series"){const f=hr(r,l).replace(/\./g,"-");return f.replace(/-series$/i,"").replace(/-+$/,"")||f||hr(l,"series")}function gr(r,{seriesName:l,fallbackTitle:f="unknown"}={}){var j,te;const S=[r==null?void 0:r.seriesId,(j=r==null?void 0:r.data)==null?void 0:j.seriesId,r==null?void 0:r.apicurioArtifactId,l,r==null?void 0:r.title,r==null?void 0:r.apicurioArtifactName,(te=r==null?void 0:r.data)==null?void 0:te.title,f].map(_=>(_??"").toString().trim()),F=S.findIndex(Boolean),Q=F!==-1?S[F]:"";return Q?(console.log("[Series] deriveSeriesId: picked base",{base:Q,sourceIndex:F,candidates:S}),wn(Q,f)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:f}),null)}function Bt(r,{seriesName:l,fallbackTitle:f="unknown"}={}){if(!r||typeof r!="object")return null;const C=gr(r,{seriesName:l,fallbackTitle:f});return C?(r.seriesId=C,r.apicurioArtifactId||(r.apicurioArtifactId=C),C):null}function Ln(r,l={}){var S,F;if(!r)return null;const f=r.isSeries||((S=r.apicurioVersions)==null?void 0:S.length)>1||r.seriesId||((F=r.data)==null?void 0:F.seriesId)||r.apicurioArtifactId;if(!f&&!l.force)return null;const C=gr(r,l);return C||(f?wn(l.fallbackTitle||"unknown"):null)}const br={selectionDimOpacity:.2,selectionDimEnabled:!0},jn={seriesNavWait:r=>`${(r/1e3).toFixed(1)}s`,hoverScale:r=>`${Math.round((r-1)*100)}%`,selectionDimming:(r,l=!0)=>{const f=Math.round((1-r)*100);return l?f===0?"Off":`${f}% dim`:"Off"},compactness:r=>r===1?"Default":`${Math.round(r*100)}%`,titleWidth:r=>`${Math.round((r-1)*100)}% extra`,titleZoomPortion:r=>`${Math.round(r*100)}% of hover zoom`,autoReloadInterval:r=>`${(r/1e3).toFixed(2)}s`};function oi(r){return r===!0||r==="true"||r===1||r==="1"}function ml(r,{localBackend:l}={}){const f=l&&typeof l.getAutoReloadConfig=="function"&&l.getAutoReloadConfig(),C={theme:r.theme,hoverScale:r.hoverScale,selectionDimOpacity:r.selectionDimOpacity,selectionDimEnabled:r.selectionDimEnabled,tileCompactness:r.tileCompactness,titleWrapMode:r.titleWrapMode,titleHoverWidthMultiplier:r.titleHoverWidthMultiplier,titleHoverTextPortion:r.titleHoverTextPortion,obsidianLinksEnabled:r.obsidianLinksEnabled,obsidianLinkMode:r.obsidianLinkMode,obsidianVault:r.obsidianVaultName,autoIdFromName:r.autoIdFromNameEnabled,seriesNavDoubleClickMs:r.seriesNavDoubleClickWaitMs,showSecondaryLinks:r.showSecondaryLinks,centerItems:r.centerItems,showReusedInMap:r.showReusedInMap,colorPresets:r.colorPresets};return f&&(C.autoReloadEnabled=!!f.enabled,C.autoReloadIntervalMs=f.intervalMs),C}function hl(r={},l){var ze,lt,vt,Ge;if(!r||typeof r!="object")return{applied:[]};const f=[],{applyTheme:C,applyTileHoverScale:S,persistTileHoverScale:F,applySelectionDimEnabled:Q,persistSelectionDimEnabled:j,applySelectionDimOpacity:te,persistSelectionDimOpacity:_,applyTileCompactness:ie,persistTileCompactness:U,applyTitleWrapMode:oe,persistTitleWrapMode:ke,applyTitleHoverWidthMultiplier:st,persistTitleHoverWidthMultiplier:Ze,applyTitleHoverTextPortion:Qe,persistTitleHoverTextPortion:Le,applyObsidianLinksEnabled:K,persistObsidianLinksEnabled:G,applyObsidianLinkMode:ye,persistObsidianLinkMode:M,applyObsidianVaultName:Ne,persistObsidianVaultName:_e,applyAutoIdFromNameEnabled:pe,persistAutoIdFromNameEnabled:$e,applySeriesNavDoubleClickWait:fe,persistSeriesNavDoubleClickWait:ve,applyCenterItems:Re,persistCenterItems:R,localBackend:z,ui:d,refreshObsidianLinks:X,scheduleOverlaySync:me,selection:he,select:ge,clearStyles:et,drawLinks:Ce,applyReusedHighlights:Ve,current:tt}=l;if(r.theme){const it=((C==null?void 0:C(r.theme))||r.theme)==="dark";(ze=l.ui)!=null&&ze.themeToggle&&(l.ui.themeToggle.checked=it),(lt=l.ui)!=null&&lt.tabThemeToggle&&(l.ui.tabThemeToggle.checked=it),f.push("theme")}if(r.hoverScale!=null){const P=S(parseFloat(r.hoverScale));F(P),d!=null&&d.hoverScaleInput&&(d.hoverScaleInput.value=String(P)),d!=null&&d.hoverScaleValue&&(d.hoverScaleValue.textContent=jn.hoverScale(P)),he&&me(),f.push("hoverScale")}if(r.selectionDimEnabled!=null){const P=Q(oi(r.selectionDimEnabled));j(P),d!=null&&d.selectionDimToggle&&(d.selectionDimToggle.checked=P),d!=null&&d.selectionDimInput&&(d.selectionDimInput.disabled=!P),d!=null&&d.selectionDimValue&&(d.selectionDimValue.textContent=jn.selectionDimming(tt.selectionDimOpacity??br.selectionDimOpacity,P)),f.push("selectionDimEnabled")}if(r.selectionDimOpacity!=null){const P=te(parseFloat(r.selectionDimOpacity));_(P),d!=null&&d.selectionDimInput&&(d.selectionDimInput.value=String(P)),d!=null&&d.selectionDimValue&&(d.selectionDimValue.textContent=jn.selectionDimming(P,tt.selectionDimEnabled??br.selectionDimEnabled)),f.push("selectionDimOpacity")}if(r.tileCompactness!=null){const P=ie(parseFloat(r.tileCompactness));U(P),d!=null&&d.tileCompactnessInput&&(d.tileCompactnessInput.value=String(P)),d!=null&&d.tileCompactnessValue&&(d.tileCompactnessValue.textContent=jn.compactness(P)),he&&me(),f.push("tileCompactness")}if(r.titleWrapMode){const P=oe(r.titleWrapMode);ke(P),d!=null&&d.titleWrapInput&&(d.titleWrapInput.checked=P!=="nowrap"),f.push("titleWrapMode")}if(r.titleHoverWidthMultiplier!=null){const P=st(parseFloat(r.titleHoverWidthMultiplier));Ze(P),d!=null&&d.titleWidthInput&&(d.titleWidthInput.value=String(P)),d!=null&&d.titleWidthValue&&(d.titleWidthValue.textContent=jn.titleWidth(P)),f.push("titleHoverWidthMultiplier")}if(r.titleHoverTextPortion!=null){const P=Qe(parseFloat(r.titleHoverTextPortion));Le(P),d!=null&&d.titleZoomInput&&(d.titleZoomInput.value=String(P)),d!=null&&d.titleZoomValue&&(d.titleZoomValue.textContent=jn.titleZoomPortion(P)),f.push("titleHoverTextPortion")}if(r.obsidianLinksEnabled!=null){const P=K(oi(r.obsidianLinksEnabled));G(P),d!=null&&d.obsidianToggle&&(d.obsidianToggle.checked=P),(vt=d==null?void 0:d.obsidianModeInputs)==null||vt.forEach(it=>{it.disabled=!P}),d!=null&&d.obsidianVaultInput&&(d.obsidianVaultInput.disabled=!P),X==null||X(),f.push("obsidianLinksEnabled")}if(r.obsidianLinkMode){const P=ye(r.obsidianLinkMode);M(P),(Ge=d==null?void 0:d.obsidianModeInputs)==null||Ge.forEach(it=>{it.checked=it.value===P}),X==null||X(),f.push("obsidianLinkMode")}if(r.obsidianVault!=null){const P=Ne(r.obsidianVault);_e(P),d!=null&&d.obsidianVaultInput&&(d.obsidianVaultInput.value=P),X==null||X(),f.push("obsidianVault")}if(r.colorPresets&&(typeof l.setColorPresets=="function"&&l.setColorPresets(r.colorPresets),f.push("colorPresets")),r.autoIdFromName!=null){const P=pe(oi(r.autoIdFromName));$e(P),d!=null&&d.autoIdToggle&&(d.autoIdToggle.checked=P),f.push("autoIdFromName")}if(r.seriesNavDoubleClickMs!=null){const P=fe(parseInt(r.seriesNavDoubleClickMs,10));ve(P),d!=null&&d.seriesNavInput&&(d.seriesNavInput.value=String(P)),d!=null&&d.seriesNavValue&&(d.seriesNavValue.textContent=jn.seriesNavWait(P)),f.push("seriesNavDoubleClickMs")}if(r.autoReloadEnabled!=null&&z&&typeof z.setAutoReloadEnabled=="function"){const P=oi(r.autoReloadEnabled);z.setAutoReloadEnabled(P),d!=null&&d.autoReloadToggle&&(d.autoReloadToggle.checked=P),d!=null&&d.autoReloadInput&&(d.autoReloadInput.disabled=!P),f.push("autoReloadEnabled")}if(r.autoReloadIntervalMs!=null&&z&&typeof z.setAutoReloadInterval=="function"){const P=z.setAutoReloadInterval(parseInt(r.autoReloadIntervalMs,10));d!=null&&d.autoReloadInput&&(d.autoReloadInput.value=String(P)),d!=null&&d.autoReloadValue&&(d.autoReloadValue.textContent=jn.autoReloadInterval(P)),f.push("autoReloadIntervalMs")}if(r.centerItems!=null){const P=Re==null?void 0:Re(oi(r.centerItems));R==null||R(P),d!=null&&d.tabCenterToggle&&(d.tabCenterToggle.checked=P),f.push("centerItems")}if(r.showSecondaryLinks!=null){const P=oi(r.showSecondaryLinks);typeof l.setShowSecondaryLinks=="function"?l.setShowSecondaryLinks(P):l.showSecondaryLinks=P,d!=null&&d.secondaryLinksToggle&&(d.secondaryLinksToggle.checked=P),d!=null&&d.tabSecondaryLinksToggle&&(d.tabSecondaryLinksToggle.checked=P),he?ge(he):(et(),Ce()),f.push("showSecondaryLinks")}if(r.showReusedInMap!=null){const P=oi(r.showReusedInMap);typeof l.setShowReusedInMap=="function"?l.setShowReusedInMap(P):l.showReusedInMap=P,d!=null&&d.reusedToggle&&(d.reusedToggle.checked=P),Ve==null||Ve(),f.push("showReusedInMap")}return{applied:f}}function gl(r,l){const f=new Blob([l],{type:"application/json"}),C=URL.createObjectURL(f),S=document.createElement("a");S.href=C,S.download=r,S.click(),URL.revokeObjectURL(C)}const No=typeof{url:Tn&&Tn.tagName.toUpperCase()==="SCRIPT"&&Tn.src||new URL("blockscape.js",document.baseURI).href}<"u"&&"./"||"";function bl(r={}){console.log("[Blockscape] init");const l={localBackend:!0,fileOpen:!0,fileSave:!0,autoLoadFromDir:!0,showModelMeta:!0,seriesNavMinVersions:1,initialSettings:null,initialSettingsUrl:null,...r},f=document.getElementById("jsonBox"),C=document.querySelector(".blockscape-json-panel"),S=document.getElementById("app"),F=document.getElementById("overlay"),Q=document.getElementById("tabTooltip"),j=document.getElementById("modelList"),te=document.getElementById("itemPreview"),_=document.getElementById("urlForm"),ie=document.getElementById("urlInput"),U=document.getElementById("loadUrl"),oe=te.querySelector(".item-preview__title"),ke=te.querySelector(".item-preview__body"),st=te.querySelector(".item-preview__actions"),Ze=te.querySelector(".item-preview__close"),Qe=document.getElementById("downloadJson"),Le=document.getElementById("shareModel"),K=document.getElementById("createVersion"),G=document.getElementById("openInEditor"),ye=document.getElementById("copyJson"),M=document.getElementById("copySeries"),Ne=document.getElementById("pasteJson"),_e=document.getElementById("helpButton"),pe=document.getElementById("newPanelButton"),$e=document.getElementById("newBlankButton"),fe=document.getElementById("shortcutHelp"),ve=document.getElementById("shortcutHelpList"),Re=document.getElementById("shortcutHelpClose"),R=document.getElementById("shortcutHelpBackdrop"),z=document.getElementById("newPanel"),d=document.getElementById("newPanelClose"),X=document.getElementById("newPanelBackdrop"),me=document.getElementById("search"),he=document.getElementById("searchResults"),ge=document.getElementById("localBackendPanel"),et=document.getElementById("localBackendStatus"),Ce=document.getElementById("localFileList"),Ve=document.getElementById("localDirSelect"),tt=document.getElementById("refreshLocalFiles"),ze=document.getElementById("loadLocalFile"),lt=document.getElementById("saveLocalFile"),vt=document.getElementById("saveLocalFileAs"),Ge=document.getElementById("localSavePath"),P="blockscape:editorPayload",it="blockscape:editorTransfer",Ht=document.title;ge&&(ge.hidden=!0),!l.localBackend&&ge&&(ge.hidden=!0),l.fileOpen||(ze&&(ze.hidden=!0),Ve&&(Ve.hidden=!0),tt&&(tt.hidden=!0),Ce&&(Ce.hidden=!0)),l.fileSave||(lt&&(lt.hidden=!0),vt&&(vt.hidden=!0),Ge&&(Ge.hidden=!0)),f.value=document.getElementById("seed").textContent.trim();let y=[],w=-1;const Oe=ll({models:y,getActiveIndex:()=>w,setActive:kt,ensureModelMetadata:xn,getModelId:mt,getSeriesId:Ln,ensureSeriesId:Bt,getModelTitle:qe,computeJsonFingerprint:Vo,uid:ci});let q=null,Te=new Map,pt=new Map,Y=null,Ke=null,ft=null,ct=null,vn=!0,Gt=!1,Ft=!1,Jn="map",wt=null,yn=null,Nn=!1,ai=null;const In=2e3;let $t=null,rn=null,Xt=null,sn=null,yt=null,Ot=null,Zt=null,kn=null,Kt=null,zn="",u=!1,g=null;const L=new Map;let A=null,E=null,B=[],ee=null;const J=30,Ee=1e3,de="blockscape:hoverScale",be=1.5,Me=1,We=2.5,xe="blockscape:selectionDimOpacity",Rt="blockscape:selectionDimEnabled",ce=.2,Se=.05,je=1,ht="blockscape:titleWrap",ln="blockscape:titleHoverWidth",dt="blockscape:titleHoverTextPortion",It="wrap",Et=1.3,_n=1,cn=1.6,Cn=.25,ri=0,ua=.6,Er="blockscape:tileCompactness",Qi=1,Sr=.75,Ir=1.25,kr="blockscape:obsidianLinksEnabled",_r="blockscape:obsidianLinkMode",Cr="blockscape:obsidianVault",pa="title",Mo="id",Bo=pa,xr="blockscape:autoReloadEnabled",Ar="blockscape:autoReloadIntervalMs",eo=1e3,Tr=500,Lr=1e4,Nr="blockscape:autoIdFromName",$o=!0,Mr="blockscape:colorPresets",Br="blockscape:centerItems",$r="blockscape:theme",wi="light",si="dark",Oo="cat:",Ro=!1;let vi=be,Mn=ce,Bn=!0,yi=Qi,fa=It,Ei=Et,Si=Cn,Ii=!1,to=Bo,ki="",li=$o,no=wi,Wt=[],Qt=Ro,_i=null;const Or="blockscape:seriesNavDoubleClickMs",io=900,Rr=300,Pr=4e3;let $n=io;const Ae={hoverScaleInput:null,hoverScaleValue:null,selectionDimToggle:null,selectionDimInput:null,selectionDimValue:null,tileCompactnessInput:null,tileCompactnessValue:null,titleWrapInput:null,titleWidthInput:null,titleWidthValue:null,titleZoomInput:null,titleZoomValue:null,seriesNavInput:null,seriesNavValue:null,obsidianToggle:null,obsidianModeInputs:[],obsidianVaultInput:null,autoIdToggle:null,autoReloadToggle:null,autoReloadInput:null,autoReloadValue:null,secondaryLinksToggle:null,reusedToggle:null,themeToggle:null,tabThemeToggle:null,tabSecondaryLinksToggle:null,tabCenterToggle:null,colorPresetList:null},Nl={detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1,highlightSource(){},getAutoReloadConfig:()=>({enabled:!1,intervalMs:eo}),setAutoReloadEnabled(){},setAutoReloadInterval(){},saveModelByIndex:async()=>!1},Ye=l.localBackend?zl():Nl,Vr=l.localBackend?Ye.detect():Promise.resolve(!1);Oe.hydrateConfig(),ma(Vl()),xi(Hl(),{silent:!0}),ac(),rc(),cc(),pc(),dc(),uc(),gc(),vc(),wc(),yc(),sc(),lc(),Ul(),Jt();function ci(){return Math.random().toString(36).slice(2,10)}function Ml(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function Bl(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function $l(e){return Ml(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Ol(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),Bl(t)}const Dr=(e,t)=>gl(e,t);function Ur(e){return!e||typeof e!="object"?null:e.settings&&typeof e.settings=="object"?e.settings:e}async function Rl(e){if(!e)return null;const t=Array.isArray(e)?e:[e],n=[];t.forEach(o=>{if(typeof o=="string"&&o.trim()){n.push(o.trim());try{const a=new URL(o,window.location.origin).toString();a!==o.trim()&&n.push(a)}catch{}}});const i=new Set;for(const o of n)if(!i.has(o)){i.add(o);try{const a=await $s(o),s=JSON.parse(a),c=Ur(s);if(c)return c}catch(a){console.warn("[Blockscape] initial settings fetch failed",o,a)}}return null}async function Pl(){const e=typeof refreshObsidianLinks=="function"?refreshObsidianLinks:null,t=[];l.initialSettings&&t.push({type:"inline",snapshot:l.initialSettings}),l.initialSettingsUrl&&t.push({type:"url",url:l.initialSettingsUrl});let n=0;for(const i of t)try{const o=i.type==="inline"?Ur(i.snapshot):await Rl(i.url);if(!o)continue;const a=ts(o,{refreshObsidianLinks:e}),s=(a==null?void 0:a.applied)||[];s.length&&(n+=s.length,console.log(`[Blockscape] applied ${s.length} setting${s.length===1?"":"s"} from ${i.type==="inline"?"inline config":i.url}.`))}catch(o){console.warn("[Blockscape] initial settings apply failed",o)}return n}function Vl(){if(typeof window>"u"||!window.localStorage)return wi;try{return window.localStorage.getItem($r)===si?si:wi}catch{return wi}}function Dl(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem($r,e)}catch(t){console.warn("[Blockscape] theme persistence failed",t)}}function ma(e){const t=e===si?si:wi;return no=t,typeof document<"u"&&document.documentElement.setAttribute("data-theme",t),Dl(t),no}function Hr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Br,e?"true":"false")}catch(t){console.warn("[Blockscape] failed to persist center items",t)}}function Ci(e){return Qt=!!e,S&&(S.classList.toggle("is-center-mode",Qt),S.querySelectorAll(".grid").forEach(t=>{t.classList.toggle("is-centered",Qt)}),S.querySelectorAll(".tile-add").forEach(t=>{t.hidden=Qt,t.tabIndex=Qt?-1:0,t.setAttribute("aria-hidden",Qt?"true":"false")})),q&&(Jo(),Gn()),Qt}function Ul(){if(typeof window>"u"||!window.localStorage)return Ci(Ro);try{const e=window.localStorage.getItem(Br);return e==null?Ci(Ro):Ci(e==="true"||e==="1")}catch(e){return console.warn("[Blockscape] failed to read center items pref",e),Ci(Ro)}}function Fr(e){return typeof window>"u"?"":getComputedStyle(document.documentElement).getPropertyValue(e).trim()}function Wr(e){const t=i=>/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(i||"");if(!Array.isArray(e))return oo();const n=e.map(i=>({name:((i==null?void 0:i.name)||"").toString().trim()||"Custom",value:((i==null?void 0:i.value)||"").toString().trim()})).filter(i=>t(i.value));return n.length?n:oo()}function oo(){return[{name:"Black",value:an.color.ink},{name:"White",value:an.color.white},{name:"Red",value:an.blockscape.revdep},{name:"Green",value:an.color.success}]}function Hl(){if(typeof window>"u"||!window.localStorage)return oo();try{const e=window.localStorage.getItem(Mr);if(!e)return oo();const t=JSON.parse(e);return Wr(t)}catch(e){return console.warn("[Blockscape] failed to load color presets",e),oo()}}function Fl(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Mr,JSON.stringify(e))}catch(t){console.warn("[Blockscape] failed to persist color presets",t)}}function xi(e,{silent:t=!1}={}){return Wt=Wr(e),Fl(Wt),!t&&typeof Ui=="function"&&Ui(Wt),_i==null||_i(),Wt}function Wl(){if(typeof window>"u"||!window.location)return!1;const e=new URL(window.location.href),n=e.pathname.replace(/\/+$/,"").split("/").filter(Boolean),i=e.searchParams.get("server");return n[0]&&n[0].toLowerCase()==="server"||i&&["1","true","yes","on"].includes(i.toLowerCase())}function Po(e,{modelId:t,itemId:n}={}){if(typeof window>"u"||!window.location||!e)return;const i=di(e);if(!i)return;const o=y[w],a=di(o==null?void 0:o.sourcePath),s=t??(a&&a===i?mt(o):null),c=n??(a&&a===i?Y:null),p=i.split("/").filter(Boolean).map(x=>encodeURIComponent(x)),h=s?encodeURIComponent(s):null,v=c?encodeURIComponent(c):null;try{const x=new URL(window.location.href),O=new URLSearchParams(x.search);O.delete("load"),O.delete("share");const T=["","server",...p,...h?[h]:[],...v?[v]:[]].join("/").replace(/\/+/g,"/");x.pathname=T,x.search=O.toString()?`?${O.toString()}`:"",x.hash="",window.history.replaceState({},document.title,x.toString())}catch(x){console.warn("[Blockscape] failed to update URL for server path",x)}}function jl(){if(typeof window>"u"||!window.location)return null;const n=new URL(window.location.href).pathname.replace(/\/+$/,"").split("/").filter(Boolean),i=n.findIndex($=>$.toLowerCase()==="server");if(i===-1)return null;const o=n.slice(i+1);if(!o.length)return null;const a=o.findIndex($=>$.toLowerCase().endsWith(".bs"));if(a===-1)return null;const s=o.slice(0,a+1),c=o.slice(a+1),p=$=>{try{return decodeURIComponent($)}catch{return $}},h=s.map(p),v=c.map(p),x=h.join("/"),O=di(x);if(!O)return null;const T=v[0]?v[0].trim():null,N=v[1]?v[1].trim():null;return{path:O,modelId:T||null,itemId:N||null}}function ha({itemId:e}={}){const t=y[w];t!=null&&t.sourcePath&&Po(t.sourcePath,{modelId:mt(t),itemId:e===void 0?Y:e})}function Jl(){return typeof window>"u"||!window.location?!1:(window.location.hostname||"").toLowerCase().endsWith("github.io")}function zl(){const e=()=>typeof window>"u"||!window.location?{}:{host:window.location.host,path:window.location.pathname,search:window.location.search,hash:window.location.hash};function t(I,W={}){console.log("[Blockscape][local-backend]",I,{...e(),...W})}if(Jl())return t("Disabled on github.io host"),ge&&(ge.hidden=!0),{detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1};if(!Wl()||!ge||!et)return t("Opt-in flag missing or panel unavailable"),ge&&(ge.hidden=!0),{detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1};if(!ge||!et)return{detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1};let i=!1,o="",a=[],s=[],c="",p=new Map,h=$(),v=Be(),x=null,O=!1;const T=new Set;function N(){return T.size>0}function $(){if(typeof window>"u"||!window.localStorage)return!0;try{const I=window.localStorage.getItem(xr);return I==null?!0:I==="true"}catch{return!0}}function ae(I){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(xr,I?"true":"false")}catch(W){console.warn("[Blockscape] auto-reload: failed to persist",W)}}function Be(){if(typeof window>"u"||!window.localStorage)return eo;try{const I=window.localStorage.getItem(Ar);if(!I)return eo;const W=parseInt(I,10);return we(W)}catch{return eo}}function ot(I){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Ar,String(I))}catch(W){console.warn("[Blockscape] auto-reload: failed to persist interval",W)}}function we(I){return Number.isFinite(I)?Math.min(Lr,Math.max(Tr,I)):eo}function De(I){if(!I)return"";const W=I.split("/").filter(Boolean);return W.pop(),W.join("/")}function Ue(I,{error:W=!1}={}){et.textContent=I,et.style.color=W?an.color.dangerStrong:"",t("Status",{text:I,error:W})}function nt(I){return di(I)}function Vt(I){const W=Ho(I);return W?{payload:W,isSeries:!0}:{payload:I==null?void 0:I.data,isSeries:!1}}function _t(){var W;if(w>=0&&((W=y[w])!=null&&W.sourcePath))return y[w].sourcePath;if(w<0)return"blockscape.bs";const I=qe(y[w])||"blockscape";return`${wn(I,"blockscape")}.bs`}function Xe(){var I;Ge&&(Ge.placeholder=_t(),(I=y[w])!=null&&I.sourcePath&&(Ge.value=y[w].sourcePath))}function at(){if(!Ve)return;Ve.innerHTML="";const I=document.createElement("option");I.value="",I.textContent="All (~/blockscape)",Ve.appendChild(I),s.forEach(re=>{const se=document.createElement("option");se.value=re,se.textContent=re||"(root)",Ve.appendChild(se)});const W=s.includes(c)?c:"";Ve.value=W,c=W}function Nt(){if(!Ce)return;Ce.innerHTML="";const I=c?a.filter(W=>W.path.startsWith(`${c}/`)):a;if(!I.length){const W=document.createElement("option");W.disabled=!0,W.textContent="No .bs files found yet",Ce.appendChild(W),Ce.disabled=!0;return}Ce.disabled=!1,I.forEach(W=>{const re=document.createElement("option");re.value=W.path;const se=W.mtimeMs?new Date(W.mtimeMs).toLocaleString():"";re.textContent=se?`${W.path} · ${se}`:W.path,Ce.appendChild(re)}),o&&Array.from(Ce.options).forEach(W=>{W.value===o&&(W.selected=!0)}),!Ce.value&&Ce.options.length&&(Ce.options[0].selected=!0)}function dn(I){if(!i||!Ce||!I||!a.find(rt=>rt.path===I))return;const re=De(I);re!==c&&(c=re,at()),Nt(),Array.from(Ce.options).forEach(rt=>{rt.selected=rt.value===I});const se=Array.from(Ce.options).find(rt=>rt.value===I);se!=null&&se.scrollIntoView&&se.scrollIntoView({block:"nearest"}),Ge&&(Ge.value=I)}function un(){x&&(clearInterval(x),x=null)}function Ct(){un(),!(!i||!h||N())&&(x=setInterval(Sn,v))}function zt(I){if(!I)return;const W=T.size;T.add(I),T.size!==W&&(t("Auto-reload paused",{reason:I}),Ct())}function He(I){if(!I)return;T.delete(I)&&(t("Auto-reload resumed",{reason:I}),Ct())}async function En(I){const W=y.findIndex(re=>re.sourcePath===I);if(W!==-1)try{const re=await fetch(`/api/file?path=${encodeURIComponent(I)}`,{cache:"no-store"});if(!re.ok)throw new Error(`HTTP ${re.status}`);const se=await re.json(),rt=JSON.stringify(se.data??se,null,2),xt=Pn(rt,I,{seriesTitleOverride:`${I} series`});if(!xt.length)return;const ue=xt[0];if(ue.sourcePath=I,xn(ue,{titleHint:qe(y[W]),idHint:mt(y[W])}),ue.isSeries){const Je=ue.title||qe(ue)||qe(y[W]),Mt=wn(Je||"unknown");ui(ue,Mt),Bt(ue,{seriesName:Je||"unknown",fallbackTitle:"unknown"})}y[W]={...y[W],...ue,title:ue.title||qe(ue),data:ue.data,sourcePath:I},W===w?(Pt(),Lt()):Rn(),console.log("[Blockscape] auto-reloaded model from",I)}catch(re){console.warn("[Blockscape] auto-reload failed for",I,re)}}async function Sn(){if(!(!i||!h||N()||O)){O=!0;try{const I=await fetch("/api/files",{cache:"no-store"});if(!I.ok)throw new Error(`HTTP ${I.status}`);const re=((await I.json()).files||[]).slice().sort((ue,Je)=>{const Mt=(ue==null?void 0:ue.mtimeMs)||0,nn=(Je==null?void 0:Je.mtimeMs)||0;return Mt===nn?(ue.path||"").localeCompare(Je.path||""):nn-Mt}),se=new Map;re.forEach(ue=>se.set(ue.path,ue.mtimeMs||0));const rt=y.map((ue,Je)=>({path:ue.sourcePath,idx:Je})).filter(ue=>ue.path);for(const ue of rt){const Je=p.get(ue.path)||0;(se.get(ue.path)||0)>Je&&await En(ue.path)}a=re;const xt=new Set;a.forEach(ue=>xt.add(De(ue.path))),s=Array.from(xt).filter(ue=>ue!=="").sort(),p=se,at(),Nt()}catch(I){console.warn("[Blockscape] auto-reload check failed",I)}finally{O=!1}}}function zi(I){h=!!I,ae(h),Ct()}function qi(I){return v=we(I),ot(v),Ct(),v}function en(I){i=!1,a=[],p=new Map,un(),Nt(),ge.hidden=!0,I&&Ue(I,{error:!0}),t("Panel hidden",{message:I})}async function Yn({silent:I=!1}={}){try{t("Health check start");const W=await fetch("/api/health",{cache:"no-store"});if(!W.ok)throw new Error(`HTTP ${W.status}`);const re=await W.json();if(i=!!(re!=null&&re.ok),!i)throw new Error("Health check failed");return ge.hidden=!1,I||Ue(re.root?`Local server ready (root: ${re.root})`:"Local server ready"),t("Health check ok",{payload:re}),!0}catch(W){return I||console.log("[Blockscape] local backend health failed",W),en("Local server unavailable"),!1}}async function tn(){if(i&&Ce){Ue("Loading files…");try{const I=await fetch("/api/files",{cache:"no-store"});if(!I.ok)throw new Error(`HTTP ${I.status}`);a=((await I.json()).files||[]).slice().sort((se,rt)=>{const xt=(se==null?void 0:se.mtimeMs)||0,ue=(rt==null?void 0:rt.mtimeMs)||0;return xt===ue?(se.path||"").localeCompare(rt.path||""):ue-xt});const re=new Set;a.forEach(se=>{re.add(De(se.path))}),s=Array.from(re).filter(se=>se!=="").sort(),c&&!re.has(c)&&(c=""),!c&&o&&(c=De(o)),p=new Map(a.map(se=>[se.path,se.mtimeMs||0])),at(),Nt(),Ue(a.length?`Browsing ${a.length} file(s) in ~/blockscape`:"No .bs files in ~/blockscape yet")}catch(I){console.warn("[Blockscape] local backend refresh failed",I),en("Local server unavailable")}}}async function uo(){i=!1,en(),Ue("Checking for local server…");try{return t("Detect start"),await Yn()?(Xe(),await tn(),Ct(),!0):!1}catch(I){return i=!1,console.log("[Blockscape] local backend not detected",I),t("Detect failed",{err:I}),!1}}async function Gi(){if(!i||!Ce)return;const I=Array.from(Ce.selectedOptions||[]).map(re=>re.value).filter(Boolean).sort((re,se)=>re.localeCompare(se));if(!I.length){alert("Select one or more files to load from ~/blockscape.");return}let W=null;for(const re of I)try{Ue(`Loading ${re}…`);const se=await jr(re);W==null&&(W=(se==null?void 0:se.firstIndex)??null),o=re,Po(re)}catch(se){console.error("[Blockscape] failed to load from local server",se),alert(`Local load failed for ${re}: ${se.message}`)}W!=null&&kt(W),Ue(`Loaded ${I.length} file(s)`),Nt()}async function Hn(I,{statusPrefix:W="Saved to",updateInput:re=!0}={}){if(!i)return;if(w<0){alert("No active model to save.");return}const se=y[w],{payload:rt,isSeries:xt}=Vt(se);if(!rt){alert("No model data to save.");return}const ue=nt(I);if(!ue){alert("Enter a relative path (no ..) to save under ~/blockscape.");return}try{const Je=JSON.stringify(rt,null,2);Ue(`Saving ${xt?"series":"map"} to ${ue}…`);const nn=await fetch(`/api/file?path=${encodeURIComponent(ue)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:Je});if(!nn.ok)throw new Error(`HTTP ${nn.status}`);const Yt=await nn.json();o=Yt.path||ue,se.sourcePath=Yt.path||ue,re&&Ge&&(Ge.value=Yt.path||ue),Po(Yt.path||ue),Ue(`${W} ${Yt.path||ue}`),await tn()}catch(Je){console.error("[Blockscape] local save failed",Je),alert(`Local save failed: ${Je.message}`),en("Local server unavailable")}}async function po(){var W;const I=nt(Ge==null?void 0:Ge.value)||nt((W=y[w])==null?void 0:W.sourcePath)||_t();if(!I){alert("Enter a relative path (no ..) to save under ~/blockscape.");return}await Hn(I,{statusPrefix:"Saved to"})}async function fo(){var se;if(!i)return;if(w<0){alert("No active model to save.");return}if(typeof window>"u"||typeof window.prompt!="function")return;const I=nt((se=y[w])==null?void 0:se.sourcePath)||_t(),W=window.prompt("Save active map as (under ~/blockscape):",I);if(W==null)return;const re=nt(W);if(!re){alert("Enter a relative path (no ..) to save under ~/blockscape.");return}await Hn(re,{statusPrefix:"Saved to"})}async function mo(I,W,{refreshAfter:re=!0,statusPrefix:se="Saved to"}={}){if(!i)return{ok:!1,error:"Local server unavailable"};if(!Number.isInteger(I)||I<0)return{ok:!1,error:"Invalid model index"};const rt=y[I],{payload:xt,isSeries:ue}=Vt(rt);if(!xt)return{ok:!1,error:"Model has no data"};const Je=nt(W)||nt(rt==null?void 0:rt.sourcePath)||_t();if(!Je)return{ok:!1,error:"Enter a relative path (no ..) to save under ~/blockscape."};try{const Mt=JSON.stringify(xt,null,2);Ue(`Saving ${ue?"series":"map"} to ${Je}…`);const Yt=await fetch(`/api/file?path=${encodeURIComponent(Je)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:Mt});if(!Yt.ok)throw new Error(`HTTP ${Yt.status}`);const Xn=await Yt.json();return o=Xn.path||Je,rt.sourcePath=Xn.path||Je,I===w&&Xe(),Ue(`${se} ${Xn.path||Je}`),re&&await tn(),{ok:!0,path:Xn.path||Je}}catch(Mt){return console.error("[Blockscape] local save failed",Mt),en("Local server unavailable"),{ok:!1,error:Mt.message}}}if(tt&&(tt.onclick=()=>tn()),ze&&(ze.onclick=()=>Gi()),lt&&(lt.onclick=()=>po()),vt&&(vt.onclick=()=>fo()),Ce&&Ge&&(Ce.addEventListener("change",()=>{const I=Array.from(Ce.selectedOptions||[])[0];I!=null&&I.value&&(Ge.value=I.value)}),Ce.addEventListener("dblclick",()=>{Gi()})),Ve&&Ve.addEventListener("change",()=>{c=Ve.value||"",Nt()}),ge){const I="local-files-panel-focus",W="local-files-panel-pointer";let re=!1,se=!1;ge.addEventListener("focusin",()=>{re||(re=!0,zt(I))}),ge.addEventListener("focusout",rt=>{if(!re)return;const xt=rt.relatedTarget;xt&&ge.contains(xt)||(re=!1,He(I))}),ge.addEventListener("pointerenter",()=>{se||(se=!0,zt(W))}),ge.addEventListener("pointerleave",()=>{se&&(se=!1,He(W))})}return{detect:uo,refresh:tn,updateActiveSavePlaceholder:Xe,isAvailable:()=>i,highlightSource:dn,saveModelByIndex:mo,getAutoReloadConfig:()=>({enabled:h,intervalMs:v,available:i}),setAutoReloadEnabled:zi,setAutoReloadInterval:qi}}async function jr(e,{labelBase:t=e,seriesTitleOverride:n}={}){if(!e)throw new Error("Missing path");const i=await fetch(`/api/file?path=${encodeURIComponent(e)}`,{cache:"no-store"});if(!i.ok)throw new Error(`HTTP ${i.status}`);const o=await i.json(),a=JSON.stringify(o.data??o,null,2),s=Pn(a,e,{seriesTitleOverride:n||`${e} series`});if(!s.length)throw new Error("No models found in file");let c=null;return s.forEach((p,h)=>{if(p.sourcePath=e,p.isSeries&&!p.title){const O=(e.split("/").filter(Boolean).pop()||e).replace(/\.bs$/i,"");p.title=O}const v=An(p,{versionLabel:s.length>1?`${t} #${h+1}`:t});c==null&&(c=v)}),{firstIndex:c,total:s.length}}async function Jr(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function ql(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function jt(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function di(e){const t=(e||"").trim().replace(/\\/g,"/").replace(/^\/+/,"");return!t||t.includes("..")?null:t.toLowerCase().endsWith(".bs")?t:`${t}.bs`}function Gl(e){return((e||"").split("/").filter(Boolean).pop()||"").replace(/\.bs$/i,"").trim()}function Kl(e,t){const n=di(e);if(!n)return null;const i=n.split("/"),s=`${(i.pop()||n).replace(/\.bs$/i,"")}-${t}.bs`;return[...i,s].filter(Boolean).join("/")}function ga(){const e=new Date,t=n=>String(n).padStart(2,"0");return`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}-${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`}async function ao(){try{await Vr}catch{}return typeof(Ye==null?void 0:Ye.isAvailable)=="function"?Ye.isAvailable():!1}async function Yl(){try{const e=await fetch("/api/files",{cache:"no-store"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();return new Set((t.files||[]).map(n=>n.path).filter(Boolean))}catch(e){return console.warn("[Blockscape] failed to list existing local files",e),new Set}}function Xl(e,t){const n=di(e);if(!n)return null;if(!(t!=null&&t.has(n)))return n;const i=n.split("/"),a=(i.pop()||n).replace(/\.bs$/i,"");for(let s=2;s<1e3;s++){const c=`${a}-${s}.bs`,p=[...i,c].filter(Boolean).join("/");if(!t.has(p))return p}return null}function Zl(e,t="clipboard"){const n=qe(e)||(e==null?void 0:e.title)||(e==null?void 0:e.apicurioArtifactName)||t||"blockscape",i=jt(n),o=ga();return`${i}-${o}.bs`}function Ql(e,t){if(!(e!=null&&e.isSeries)||!Array.isArray(e==null?void 0:e.apicurioVersions)||e.apicurioVersions.length<=1)return!1;const n=Gl(t);if(!n)return!1;e.title=n,e.apicurioArtifactName=n;const i=wn(n||"unknown");return ui(e,i),Bt(e,{seriesName:n,fallbackTitle:n}),!0}function ec(e){return Number.isFinite(e)?Math.min(We,Math.max(Me,e)):be}function Jt(){if(!S)return;const e=!!Y||!!Ke;S.classList.toggle("blockscape-has-selection",e),S.classList.toggle("blockscape-has-item-selection",!!Y)}function Ai(e){return vi=ec(e),document.documentElement.style.setProperty("--blockscape-tile-hover-scale",vi),vi}function tc(e){return Number.isFinite(e)?Math.min(je,Math.max(Se,e)):ce}function Ti(e){Mn=tc(e),document.documentElement.style.setProperty("--blockscape-selection-dim-opacity",Mn);const t=Bn?Mn:1;return document.documentElement.style.setProperty("--blockscape-selection-dim-applied-opacity",t),Mn}function nc(e){return Number.isFinite(e)?Math.min(Ir,Math.max(Sr,e)):Qi}function Li(e){return yi=nc(e),document.documentElement.style.setProperty("--blockscape-tile-compactness",yi),yi}function ic(e){return Number.isFinite(e)?Math.min(cn,Math.max(_n,e)):Et}function Ni(e){return Ei=ic(e),document.documentElement.style.setProperty("--blockscape-title-hover-width-multiplier",Ei),Ei}function oc(e){return Number.isFinite(e)?Math.min(ua,Math.max(ri,e)):Cn}function Mi(e){return Si=oc(e),document.documentElement.style.setProperty("--blockscape-tile-hover-text-portion",Si),Si}function Bi(e){const t=e==="nowrap"?"nowrap":"wrap";fa=t;const n=t==="nowrap"?"nowrap":"normal",i=t==="nowrap"?"nowrap":"normal";return document.documentElement.style.setProperty("--blockscape-title-white-space",n),document.documentElement.style.setProperty("--blockscape-title-text-wrap",i),t}function zr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(de,String(e))}catch(t){console.warn("[Blockscape] failed to persist hover scale",t)}}function ac(){if(typeof window>"u"||!window.localStorage)return Ai(be);try{const e=window.localStorage.getItem(de);if(!e)return Ai(be);const t=parseFloat(e);return Ai(t)}catch(e){return console.warn("[Blockscape] failed to read hover scale",e),Ai(be)}}function qr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(xe,String(e))}catch(t){console.warn("[Blockscape] failed to persist selection dimming",t)}}function rc(){if(typeof window>"u"||!window.localStorage)return Ti(ce);try{const e=window.localStorage.getItem(xe);if(!e)return Ti(ce);const t=parseFloat(e);return Ti(t)}catch(e){return console.warn("[Blockscape] failed to read selection dimming",e),Ti(ce)}}function $i(e){Bn=!!e;const t=Bn?Mn:1;return document.documentElement.style.setProperty("--blockscape-selection-dim-applied-opacity",t),S&&S.classList.toggle("blockscape-dimming-disabled",!Bn),Bn}function Gr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Rt,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist selection dim toggle",t)}}function sc(){if(typeof window>"u"||!window.localStorage)return $i(!0);try{const e=window.localStorage.getItem(Rt);return e==null?$i(!0):$i(e==="1")}catch(e){return console.warn("[Blockscape] failed to read selection dim toggle",e),$i(!0)}}function Oi(e){return li=!!e,li}function Kr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Nr,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist auto-id toggle",t)}}function lc(){if(typeof window>"u"||!window.localStorage)return Oi($o);try{const e=window.localStorage.getItem(Nr);return e==null?Oi($o):Oi(e==="1")}catch(e){return console.warn("[Blockscape] failed to read auto-id toggle",e),Oi($o)}}function Yr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Er,String(e))}catch(t){console.warn("[Blockscape] failed to persist tile compactness",t)}}function cc(){if(typeof window>"u"||!window.localStorage)return Li(Qi);try{const e=window.localStorage.getItem(Er);if(!e)return Li(Qi);const t=parseFloat(e);return Li(t)}catch(e){return console.warn("[Blockscape] failed to read tile compactness",e),Li(Qi)}}function Xr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ln,String(e))}catch(t){console.warn("[Blockscape] failed to persist title hover width",t)}}function dc(){if(typeof window>"u"||!window.localStorage)return Ni(Et);try{const e=window.localStorage.getItem(ln);if(!e)return Ni(Et);const t=parseFloat(e);return Ni(t)}catch(e){return console.warn("[Blockscape] failed to read title hover width",e),Ni(Et)}}function Zr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(dt,String(e))}catch(t){console.warn("[Blockscape] failed to persist title text zoom",t)}}function uc(){if(typeof window>"u"||!window.localStorage)return Mi(Cn);try{const e=window.localStorage.getItem(dt);if(!e)return Mi(Cn);const t=parseFloat(e);return Mi(t)}catch(e){return console.warn("[Blockscape] failed to read title text zoom",e),Mi(Cn)}}function Qr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ht,e)}catch(t){console.warn("[Blockscape] failed to persist title wrap mode",t)}}function pc(){if(typeof window>"u"||!window.localStorage)return Bi(It);try{const e=window.localStorage.getItem(ht);return Bi(e||It)}catch(e){return console.warn("[Blockscape] failed to read title wrap mode",e),Bi(It)}}function fc(e){return Number.isFinite(e)?Math.min(Pr,Math.max(Rr,e)):io}function Ri(e){return $n=fc(e),$n}function mc(e){vn=!!e}function hc(e){Ft=!!e}function es(){return{hoverScale:vi,selectionDimOpacity:Mn,selectionDimEnabled:Bn,tileCompactness:yi,titleWrapMode:fa,titleHoverWidthMultiplier:Ei,titleHoverTextPortion:Si,obsidianLinksEnabled:Ii,obsidianLinkMode:to,obsidianVaultName:ki,autoIdFromNameEnabled:li,seriesNavDoubleClickWaitMs:$n,showSecondaryLinks:vn,centerItems:Qt,showReusedInMap:Ft,theme:no,colorPresets:Wt}}function ts(e,{refreshObsidianLinks:t}={}){return hl(e,{applyTileHoverScale:Ai,persistTileHoverScale:zr,applySelectionDimEnabled:$i,persistSelectionDimEnabled:Gr,applySelectionDimOpacity:Ti,persistSelectionDimOpacity:qr,applyTileCompactness:Li,persistTileCompactness:Yr,applyTitleWrapMode:Bi,persistTitleWrapMode:Qr,applyTitleHoverWidthMultiplier:Ni,persistTitleHoverWidthMultiplier:Xr,applyTitleHoverTextPortion:Mi,persistTitleHoverTextPortion:Zr,applyObsidianLinksEnabled:Vi,persistObsidianLinksEnabled:os,applyObsidianLinkMode:Pi,persistObsidianLinkMode:is,applyObsidianVaultName:Di,persistObsidianVaultName:as,applyAutoIdFromNameEnabled:Oi,persistAutoIdFromNameEnabled:Kr,applySeriesNavDoubleClickWait:Ri,persistSeriesNavDoubleClickWait:ns,localBackend:Ye,ui:Ae,refreshObsidianLinks:t,scheduleOverlaySync:Fi,selection:Y,select:Tt,clearStyles:qo,drawLinks:Gn,applyReusedHighlights:Ta,setShowSecondaryLinks:mc,setShowReusedInMap:hc,applyTheme:ma,setColorPresets:xi,applyCenterItems:Ci,persistCenterItems:Hr,current:es()})}function ns(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Or,String(e))}catch(t){console.warn("[Blockscape] failed to persist series double-click wait",t)}}function gc(){if(typeof window>"u"||!window.localStorage)return Ri(io);try{const e=window.localStorage.getItem(Or);if(!e)return Ri(io);const t=parseInt(e,10);return Ri(t)}catch(e){return console.warn("[Blockscape] failed to read series double-click wait",e),Ri(io)}}function bc(e){return e===Mo?Mo:pa}function Pi(e){return to=bc(e),to}function is(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(_r,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian link mode",t)}}function wc(){if(typeof window>"u"||!window.localStorage)return Pi(Bo);try{const e=window.localStorage.getItem(_r);return Pi(e||Bo)}catch(e){return console.warn("[Blockscape] failed to read Obsidian link mode",e),Pi(Bo)}}function Vi(e){return Ii=!!e,Ii}function os(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(kr,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist Obsidian toggle",t)}}function vc(){if(typeof window>"u"||!window.localStorage)return Vi(!1);try{const e=window.localStorage.getItem(kr);return e==null?Vi(!1):Vi(e==="1")}catch(e){return console.warn("[Blockscape] failed to read Obsidian toggle",e),Vi(!1)}}function Di(e){return ki=(e??"").toString().trim(),ki}function as(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Cr,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian vault",t)}}function yc(){if(typeof window>"u"||!window.localStorage)return Di("");try{const e=window.localStorage.getItem(Cr);return Di(e||"")}catch(e){return console.warn("[Blockscape] failed to read Obsidian vault",e),Di("")}}function Ec(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function Sc(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(a=>a&&typeof a=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function ui(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t,e.data&&typeof e.data=="object"&&(e.data.seriesId=t),Array.isArray(e.apicurioVersions)&&e.apicurioVersions.forEach(n=>{n!=null&&n.data&&typeof n.data=="object"&&(n.data.seriesId=t)}))}function Ic(e){if(!e||typeof window>"u"||typeof window.prompt!="function")return!1;const t=(e.title??e.apicurioArtifactName??"").toString().trim()||Do(e,"Series"),n=window.prompt("Series name",t);if(n==null)return!1;const i=n.trim();if(!i)return!1;const o=Ln(e,{seriesName:i,fallbackTitle:i})||wn(i,i),a=window.prompt("Series ID (used for linking and downloads)",o);if(a==null)return!1;const s=wn(a.trim()||i,i||"series");return e.title=i,e.apicurioArtifactName=i,ui(e,s),!0}function ba(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>ba(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${ba(e[i])}`).join(",")}}`}function rs(e){try{return ba(e)}catch{return""}}function Vo(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=rs(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=rs(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const kc=[{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Move up/down through items, pausing on category headers before entering the next category at the same relative position."},{keys:[["Cmd/Ctrl","Arrow Up"],["Cmd/Ctrl","Arrow Down"]],description:"Reorder the selected category (or the category that holds the selected item)."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Cmd/Ctrl","Arrow Left"],["Cmd/Ctrl","Arrow Right"]],description:"Switch to the previous or next map when viewing a series."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile or category."},{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["F2"]],description:"Edit the selected item; when a category (not an item) is selected, open the category editor."},{keys:[["Delete"]],description:"Delete the selected item or category (use Cmd/Ctrl+Z to undo)."},{keys:[["Insert"]],description:"Add a new category at the bottom of the map."},{keys:[["Escape"]],description:"Unselect item or close the open preview popover."}];function xn(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const a=n||e.title||t||"model",s=jt(a).replace(/\./g,"-");e.id=s||`model-${ci()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function _c(e){var s,c;const t=p=>{const h=(p??"").toString().trim();if(!h)return{base:"",suffix:null};const v=h.match(/^(.*?)-(\d+)$/);return{base:v?v[1]:h,suffix:v?Number.parseInt(v[2],10):null}},n=Array.isArray(e==null?void 0:e.apicurioVersions)?e.apicurioVersions:[],i=(((s=e==null?void 0:e.data)==null?void 0:s.id)??"").toString().trim();let o=t(i).base;if(!o)for(const p of n){if(p!=null&&p.isCategoryView)continue;const h=t(((c=p==null?void 0:p.data)==null?void 0:c.id)??(p==null?void 0:p.id)??"");if(h.base){o=h.base;break}}o||(o=jt(Ln(e)||wa(e)||qe(e,"model")));let a=0;return n.forEach(p=>{var v;if(p!=null&&p.isCategoryView)return;const h=t(((v=p==null?void 0:p.data)==null?void 0:v.id)??(p==null?void 0:p.id)??"");h.base===o&&Number.isFinite(h.suffix)&&h.suffix>a&&(a=h.suffix)}),`${o}-${String(a+1).padStart(2,"0")}`}function Cc(e){return JSON.parse(JSON.stringify(e))}function qe(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function Do(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const o=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(o)return o;const a=mt(e);return a?`${a} series`:t}return qe(e,t)}function mt(e){var o;const t=Ln(e);if(t)return t;const n=(o=e==null?void 0:e.data)==null?void 0:o.id;return n&&n.toString().trim()||null}function wa(e){if(!(e!=null&&e.sourcePath))return null;try{const t=e.sourcePath.split("/").filter(Boolean);return(t.length?t[t.length-1]:e.sourcePath).replace(/\.bs$/i,"")}catch{return e.sourcePath.replace(/\.bs$/i,"")}}function xc(e){return e?e.toString().replace(/-series$/i,""):null}function va(e){if(!e)return-1;const t=e.toString().trim().toLowerCase();if(!t)return-1;for(let n=0;n<y.length;n++){const i=(mt(y[n])||"").toLowerCase(),o=(wa(y[n])||"").toLowerCase();if(t===i||t===o)return n}return-1}function ss(e){var c;if(e<0||e>=y.length||!f)return!0;const t=y[e],n=(f.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}xn(i,{titleHint:qe(t),idHint:mt(t)});const o=Vo(t.data),a=Vo(i);if(o===a)return!0;t.data=i;const s=Vn(t);return s>=0&&((c=t.apicurioVersions)!=null&&c[s])&&(t.apicurioVersions[s].data=i),!0}function ls(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function ya(e){if(w<0||!e)return null;const t=y[w].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const a=(i.items||[]).find(s=>s.id===e);if(a)return{category:i,item:a,modelData:t}}return null}function Ac(e,t){const n=ya(e);return n?(t?n.item.color=t:delete n.item.color,Pt(),Lt(),Tt(e),!0):!1}function Tc(e,t){const n=ls(t);let i=jt(e||"item");if(!n.has(i))return i;const o=()=>ci().slice(0,4);for(;n.has(i);)i=`${jt(e||"item")}-${o()}`;return i}function Lc(e="category",t){const n=(t==null?void 0:t.categories)||[],i=jt(e||"category"),o=c=>n.some(p=>p.id===c);let a=i||`category-${ci()}`;if(!o(a))return a;let s=n.length+1;for(;o(`${i}-${s}`);)s+=1;return`${i}-${s}`}const pi=pl({findItemAndCategoryById:ya,collectAllItemIds:ls,updateItemReferences:ul,loadActiveIntoEditor:Pt,rebuildFromActive:Lt,select:e=>Tt(e),onSelectionRenamed:(e,t)=>{var n;Y===e&&(Y=t,Jt()),((n=wt==null?void 0:wt.item)==null?void 0:n.id)===e&&(wt.item.id=t)},makeSlug:jt,isAutoIdFromNameEnabled:()=>li});function Nc({getActiveModelData:e,loadActiveIntoEditor:t,rebuildFromActive:n,selectCategory:i,onCategoryRenamed:o}){const a={wrapper:null,fields:{},categoryId:null,modelData:null,idManuallyEdited:!1,autoSyncEnabled:!0},s=N=>{if(a.fields.errorEl){if(!N){a.fields.errorEl.hidden=!0,a.fields.errorEl.textContent="";return}a.fields.errorEl.hidden=!1,a.fields.errorEl.textContent=N}},c=()=>{a.wrapper&&(a.wrapper.hidden=!0,a.wrapper.setAttribute("aria-hidden","true"),s(""),a.categoryId=null,a.modelData=null,document.body.classList.remove("category-editor-open"))},p=()=>{a.wrapper&&(a.wrapper.hidden=!1,a.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("category-editor-open"),requestAnimationFrame(()=>{var N,$;(N=a.fields.titleInput)==null||N.focus(),($=a.fields.titleInput)==null||$.select()}))},h=({force:N}={})=>{var ae,Be;if(!li||!a.autoSyncEnabled||!((ae=a.fields)!=null&&ae.idInput)||!((Be=a.fields)!=null&&Be.titleInput)||!N&&a.idManuallyEdited)return;const $=jt(a.fields.titleInput.value||a.categoryId||"category");a.fields.idInput.value=$},v=()=>{if(!a.modelData||!a.categoryId)throw new Error("No category loaded.");const N=a.modelData.categories||[],$=N.find(De=>De.id===a.categoryId);if(!$)throw new Error("Category not found.");const ae=(a.fields.idInput.value||"").trim();if(!ae)throw new Error("ID is required.");const Be=(a.fields.titleInput.value||"").trim();if(N.some(De=>De.id===ae&&De.id!==$.id))throw new Error("Another category already uses that ID.");const we=$.id;return $.id=ae,$.title=Be||$.id,we!==ae&&typeof o=="function"&&o(we,ae),t(),n(),i(ae,{scrollIntoView:!0}),!0},x=()=>{try{return v(),c(),!0}catch(N){return console.warn("[CategoryEditor] save failed",N),s((N==null?void 0:N.message)||"Unable to save category."),!1}},O=()=>{if(a.wrapper)return a.wrapper;const N=document.createElement("div");N.className="item-editor-modal category-editor-modal",N.hidden=!0,N.setAttribute("role","dialog"),N.setAttribute("aria-modal","true");const $=document.createElement("div");$.className="item-editor-modal__backdrop",N.appendChild($);const ae=document.createElement("div");ae.className="item-editor",N.appendChild(ae);const Be=document.createElement("div");Be.className="item-editor__header";const ot=document.createElement("h2");ot.className="item-editor__title",ot.textContent="Edit category";const we=document.createElement("button");we.type="button",we.className="item-editor__close",we.setAttribute("aria-label","Close category editor"),we.textContent="×",Be.appendChild(ot),Be.appendChild(we),ae.appendChild(Be);const De=document.createElement("form");De.className="item-editor__form",ae.appendChild(De);const Ue=document.createElement("div");Ue.className="item-editor__meta",Ue.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',De.appendChild(Ue);const nt=document.createElement("div");nt.className="item-editor__error",nt.hidden=!0,De.appendChild(nt);const Vt=(Sn,zi,qi)=>{const en=document.createElement("label");en.className="item-editor__field";const Yn=document.createElement("span");if(Yn.className="item-editor__label",Yn.textContent=Sn,en.appendChild(Yn),zi.classList.add("item-editor__control"),en.appendChild(zi),qi){const tn=document.createElement("div");tn.className="item-editor__hint",tn.textContent=qi,en.appendChild(tn)}return en},_t=document.createElement("input");_t.type="text",De.appendChild(Vt("Title",_t,"Display label shown in the map."));const Xe=document.createElement("input");Xe.type="text",Xe.required=!0,De.appendChild(Vt("ID",Xe,"Unique identifier for this category (used in URLs and references)."));const at=document.createElement("div");at.className="item-editor__checkbox";const Nt=document.createElement("label");Nt.className="item-editor__checkbox-row";const dn=document.createElement("input");dn.type="checkbox";const un=document.createElement("span");un.textContent="Sync ID while editing title";const Ct=document.createElement("div");Ct.className="item-editor__hint",Ct.textContent="Turn off to keep typing titles without changing the ID.",Nt.append(dn,un),at.append(Nt,Ct),De.appendChild(at);const zt=document.createElement("div");zt.className="item-editor__actions";const He=document.createElement("button");He.type="submit",He.className="item-editor__action item-editor__action--primary",He.textContent="Save";const En=document.createElement("button");return En.type="button",En.className="item-editor__action",En.textContent="Cancel",zt.appendChild(He),zt.appendChild(En),De.appendChild(zt),De.addEventListener("submit",Sn=>{Sn.preventDefault(),x()}),En.addEventListener("click",c),we.addEventListener("click",c),$.addEventListener("click",c),Xe.addEventListener("input",()=>{a.idManuallyEdited=!0}),_t.addEventListener("input",()=>h()),dn.addEventListener("change",()=>{a.autoSyncEnabled=!!dn.checked,a.autoSyncEnabled&&(a.idManuallyEdited=!1,h({force:!0}))}),N.addEventListener("keydown",Sn=>{Sn.key==="Escape"&&(Sn.preventDefault(),c())}),document.body.appendChild(N),a.wrapper=N,a.fields={titleInput:_t,idInput:Xe,errorEl:nt,metaLabel:Ue.querySelector(".item-editor__meta-value"),syncCheckbox:dn},N};return{open:N=>{if(!N||!O())return!1;const ae=e(),ot=((ae==null?void 0:ae.categories)||[]).find(De=>De.id===N);if(!ot)return!1;a.categoryId=ot.id,a.modelData=ae,a.idManuallyEdited=!1;const we=!!li;return a.autoSyncEnabled=we,a.fields.metaLabel.textContent=ot.title||ot.id||"Category",a.fields.titleInput.value=ot.title||ot.id||"",a.fields.idInput.value=ot.id||"",a.fields.syncCheckbox.checked=a.autoSyncEnabled,a.fields.syncCheckbox.disabled=!we,!a.fields.idInput.value&&we&&h({force:!0}),s(""),p(),!0},hide:c,isOpen:()=>!!a.wrapper&&a.wrapper.hidden===!1}}const Mc=Nc({getActiveModelData:()=>{var e;return(e=y[w])==null?void 0:e.data},loadActiveIntoEditor:Pt,rebuildFromActive:Lt,selectCategory:(e,t={})=>Dn(e,t),onCategoryRenamed:(e,t)=>{Ke===e&&(Ke=t,Jt())}}),{handleTileContextMenu:Bc,hidePreview:qn,handleDocumentClick:$c,handleWindowResize:Oc,handleWindowScroll:Rc,updateColorPresets:Ui}=fl({menuEl:document.getElementById("tileContextMenu"),previewEl:te,previewTitleEl:oe,previewBodyEl:ke,previewActionsEl:st,previewCloseEl:Ze,escapeHtml:so,onEditItem:e=>pi.open(e),onChangeColor:(e,t)=>Ac(e,t),selectItem:e=>Tt(e),colorPresets:Wt});function Uo(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const i={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[i],e.apicurioActiveVersionIndex=0;const o=e.title||qe(e);return Bt(e,{seriesName:o,fallbackTitle:o}),e.isSeries=!0,e}function Pc({seriesId:e=null,mapTitle:t="Blank map"}={}){const n=jt(`${e||"blank"}-${ga()}`),i={id:n,title:t,categories:[],links:[],abstract:""};return e&&(i.seriesId=e),xn(i,{titleHint:t,idHint:n}),i}function Vc(){const t=`Blank series ${ga()}`,n=wn(t,"blank-series"),i=Pc({seriesId:n,mapTitle:"Blank map"}),o={id:n,title:t,apicurioArtifactName:t,data:i,apicurioVersions:[{version:"1",data:i,createdOn:new Date().toISOString()}],apicurioActiveVersionIndex:0,isSeries:!0};return ui(o,n),Bt(o,{seriesName:t,fallbackTitle:t}),o}function Dc(){const e=Vc(),t=An(e,{versionLabel:"blank"});return kt(t),Fo(),On("Blank series created. Add categories and tiles to start.",2600),t}function An(e,{versionLabel:t,createdOn:n}={}){var p,h,v;if(e!=null&&e.isSeries||((p=e==null?void 0:e.apicurioVersions)==null?void 0:p.length)>1){const x=e.title||qe(e);Bt(e,{seriesName:x,fallbackTitle:x}),Wo(e)}const i=mt(e);if(!i)return Uo(e,{versionLabel:t||"1",createdOn:n}),y.push(e),y.length-1;const o=y.findIndex(x=>mt(x)===i);if(o===-1)return Uo(e,{versionLabel:t||"1",createdOn:n}),y.push(e),y.length-1;const a=y[o];if(!Array.isArray(a.apicurioVersions)||!a.apicurioVersions.length){a.apicurioVersions=[{version:"1",data:a.data,createdOn:(v=(h=a.apicurioVersions)==null?void 0:h[0])==null?void 0:v.createdOn}],a.apicurioActiveVersionIndex=0;const x=a.title||qe(a);Bt(a,{seriesName:x,fallbackTitle:x})}const s=String(a.apicurioVersions.length+1);a.apicurioVersions.push({version:s,data:e.data,createdOn:n||new Date().toISOString()}),a.apicurioActiveVersionIndex=a.apicurioVersions.length-1,a.data=e.data,a.title=qe(e)||a.title,a.isSeries=!0;const c=a.title||qe(a);return Bt(a,{seriesName:c,fallbackTitle:c}),o}function cs({versionLabel:e}={}){var c;if(w<0||!y[w])throw new Error("Load or select a model before creating a version.");const t=y[w];Uo(t,{versionLabel:"1"});const n=_c(t);let i;try{i=Cc(t.data)}catch(p){throw console.warn("[Blockscape] failed to clone active model for versioning",p),new Error("Could not copy the current model.")}n&&(i.id=n),xn(i,{titleHint:qe(t),idHint:mt(t)||Ln(t)});const a={version:e||String((((c=t.apicurioVersions)==null?void 0:c.length)||0)+1),data:i,createdOn:new Date().toISOString()};t.apicurioVersions.push(a),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=i,t.isSeries=!0;const s=t.title||qe(t);return Bt(t,{seriesName:s,fallbackTitle:s}),w}function Ea(){const e=w>=0&&y[w]?y[w]:null,t=mt(e);document.title=t?`${t}-blockscape`:Ht}function Ho(e){if(!e)return null;Wo(e);const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||qe(e);return Bt(e,{seriesName:n,fallbackTitle:n}),t.filter((o,a)=>{var p;const s=((o==null?void 0:o.version)??"").toString().trim(),c=(((p=o==null?void 0:o.data)==null?void 0:p.id)??(o==null?void 0:o.id)??"").toString().trim();return o!=null&&o.isCategoryView||s.startsWith(Oo)?(console.log("[Blockscape] not saving computed map",{versionIndex:a,versionId:s,dataId:c}),!1):!0}).map(o=>o&&typeof o=="object"&&"data"in o?o.data:o)}function Uc(){const e=y[w],t=Ho(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function ds(e="shortcut",t=!1){const n=f.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=y[w],o=t?Ho(i):null,a=!!o,s=a?JSON.stringify(o,null,2):n,c=Ln(i),p=mt(i),h=c||p||qe(i,"blockscape"),v=a?"-series":"",x=`${jt(h)}${v}.bs`;return Dr(x,s),console.log(`[Blockscape] saved JSON (${e}):`,x),!0}const Hc=an.palette.letter,Fc=an.palette.letterFallback;function us(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return Hc[n]||Fc}function Wc(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(p=>p+p).join(""):t,i=parseInt(n,16),o=i>>16&255,a=i>>8&255,s=i&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(a/255,2.2)+.0722*Math.pow(s/255,2.2)>.35?an.color.ink:an.color.white}function jc(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function Sa(){if(yt)return;yt=document.createElement("div"),yt.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",Ot=document.createElement("span"),Ot.className="series-nav-notice__text",yt.appendChild(e),yt.appendChild(Ot),document.body.appendChild(yt)}function Ia(){Zt&&(clearTimeout(Zt),Zt=null),yt&&yt.classList.remove("is-visible"),Ot&&(Ot.textContent="")}function Hi(){$t=null,rn&&(clearTimeout(rn),rn=null),Ia()}function ka(){Xt=null,sn&&(clearTimeout(sn),sn=null),Ia()}function Jc(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function zc(e,t,n){Sa(),$t={id:e,targetVersionIndex:t},rn&&clearTimeout(rn),rn=setTimeout(()=>{rn=null,Hi()},$n);const i=Jc(n,t);On(`Click again to open ${i} in this series.`,$n)}function qc(e,t){Sa(),Xt={id:e,targetIndex:t},sn&&clearTimeout(sn),sn=setTimeout(()=>{sn=null,ka()},$n);const n=Do(y[t]);On(`Click again to open "${n}".`,$n)}function On(e,t=In,n=null){if(Sa(),Ot.textContent="",Ot.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener",o.textContent=n,Ot.appendChild(i),Ot.appendChild(o)}yt.classList.add("is-visible"),Zt&&clearTimeout(Zt),Zt=setTimeout(()=>Ia(),t)}function Gc(){ve&&(ve.innerHTML="",kc.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((o,a)=>{if(a>0){const c=document.createElement("span");c.className="shortcut-help__or",c.textContent="or",n.appendChild(c)}const s=document.createElement("div");s.className="shortcut-help__combo",o.forEach((c,p)=>{if(p>0){const v=document.createElement("span");v.className="shortcut-help__sep",v.textContent="+",s.appendChild(v)}const h=document.createElement("kbd");h.className="shortcut-help__key",h.textContent=c,s.appendChild(h)}),n.appendChild(s)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),ve.appendChild(t)}),Nn=!0)}function Kc(){return!!fe&&fe.hidden===!1}function Yc(){if(!fe)return;Nn||Gc(),ai=document.activeElement,fe.hidden=!1,fe.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=fe.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function _a(){if(!fe||fe.hidden)return;fe.hidden=!0,fe.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=ai;e!=null&&e.focus?e.focus({preventScroll:!0}):_e!=null&&_e.focus&&_e.focus({preventScroll:!0})}function Xc(){if(!z)return;z.hidden=!1,z.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=z.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Fo(){!z||z.hidden||(z.hidden=!0,z.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),pe!=null&&pe.focus&&pe.focus({preventScroll:!0}))}let Ca=!1;function Fi(){Ca||(Ca=!0,requestAnimationFrame(()=>{Ca=!1,Jo(),Gn()}))}let ps=!1;function fs(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Zc(e){const t=fs(e);if(!t.length){S.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}S.querySelectorAll(".tile").forEach(n=>{var s;const i=(((s=n.querySelector(".name"))==null?void 0:s.textContent)||"").toLowerCase(),o=(n.dataset.id||"").toLowerCase(),a=t.every(c=>i.includes(c)||o.includes(c));n.style.opacity=a?"1":"0.2"})}function Qc(e){const t=fs(e);if(!t.length)return[];const n=[];return y.forEach((i,o)=>{var h;const a=Do(i),s=mt(i)||"",c=`${a} ${s}`.toLowerCase();t.every(v=>c.includes(v))&&n.push({type:"model",modelIndex:o,modelTitle:a,modelId:s}),(Array.isArray((h=i.data)==null?void 0:h.categories)?i.data.categories:[]).forEach(v=>{const x=(v.title||v.id||"").toString();(v.items||[]).forEach(O=>{const T=(O.name||O.id||"").toString(),N=`${T} ${O.id||""} ${x}`.toLowerCase();t.every($=>N.includes($))&&n.push({type:"item",modelIndex:o,modelTitle:a,modelId:s,itemId:O.id,itemName:T,categoryTitle:x})})})}),n.slice(0,J)}function ms(e){if(!he)return;he.innerHTML="";const t=(e||"").toString();if(!t.trim()){he.hidden=!0;return}if(!y.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",he.appendChild(i),he.hidden=!1;return}const n=Qc(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",he.appendChild(i),he.hidden=!1;return}n.forEach(i=>{const o=document.createElement("button");o.type="button",o.className="search-result",o.dataset.modelIndex=String(i.modelIndex),i.itemId&&(o.dataset.itemId=i.itemId),i.type&&(o.dataset.type=i.type),i.modelIndex===w&&(!i.itemId||Y===i.itemId)&&o.classList.add("is-active");const a=document.createElement("div");a.className="search-result__primary";const s=document.createElement("span");s.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",a.appendChild(s);const c=document.createElement("span");c.className="search-result__badge",c.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",a.appendChild(c);const p=document.createElement("div");p.className="search-result__meta";const h=document.createElement("span");if(h.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,p.appendChild(h),i.type==="item"&&i.itemId){const v=document.createElement("span");v.textContent=`Item ID: ${i.itemId}`,p.appendChild(v)}else if(i.type==="model"){const v=document.createElement("span");v.textContent="Matches model title",p.appendChild(v)}o.appendChild(a),o.appendChild(p),he.appendChild(o)}),he.hidden=!1}function hs(e){Zc(e||""),ms(e||"")}function ed(e){!e||!Number.isInteger(e.modelIndex)||(kt(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(w!==e.modelIndex)return;const t=(n=Te.get(e.itemId))==null?void 0:n.el;t&&(Tt(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function kt(e){var t;if(qn(),Hi(),wt=null,yn=null,Ke=null,ct=null,e<0||e>=y.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}if(u=!0,w=e,console.log("[Blockscape] active model:",qe(y[e]),"(index",e+" )"),typeof(Ye==null?void 0:Ye.highlightSource)=="function"){const n=((t=y[e])==null?void 0:t.sourcePath)||null;Ye.highlightSource(n)}Ea(),Rn(),Pt(),Lt(),me&&hs(me.value||""),Ye.updateActiveSavePlaceholder(),Oe.updateAvailability(),ha()}function Rn(){if(j.innerHTML="",!y.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",j.appendChild(e);return}y.forEach((e,t)=>{var x;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===w?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===w?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const a=document.createElement("span");a.className="model-nav-title",a.textContent=Do(e),o.appendChild(a);const s=xc(wa(e)||mt(e));if(s){const O=document.createElement("span");O.className="model-nav-id",O.textContent=s,o.appendChild(O)}const c=Array.isArray((x=e.data)==null?void 0:x.categories)?e.data.categories:[],p=c.reduce((O,T)=>O+(T.items||[]).length,0),h=document.createElement("span");h.className="model-nav-meta";const v=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} maps`:"";h.textContent=`${c.length} cat · ${p} items${v}`,i.appendChild(o),i.appendChild(h),n.appendChild(i),j.appendChild(n)}),Oe.updateAvailability()}function Pt(){if(w<0){f.value="",M&&(M.disabled=!0);return}const e=y[w];f.value=JSON.stringify(e.data,null,2),M&&(M.disabled=!Ho(e))}function td(e){try{return JSON.parse(e)}catch{return null}}function gs(e){if(typeof e!="string")return e;const t=e.trim().match(/^```[a-zA-Z0-9_-]*\s*\r?\n([\s\S]*?)\r?\n```$/);return t?t[1]:e}function nd(e){const t=((e==null?void 0:e.apicurioVersions)||[]).filter(s=>!(s!=null&&s.isCategoryView));if(t.length<2)return[];const n=new Map;t.forEach((s,c)=>{const p=s==null?void 0:s.data;if(!p||!Array.isArray(p.categories))return;const h=qe(p,`Map ${c+1}`),v=(p.id??"").toString().trim()||jt(h||`map-${c+1}`),x=jt(v||h||`map-${c+1}`);p.categories.forEach(O=>{const T=((O==null?void 0:O.id)??"").toString().trim();if(!T)return;n.has(T)||n.set(T,{catTitle:O.title||T,sources:[]});const N=n.get(T);!N.catTitle&&(O.title||T)&&(N.catTitle=O.title||T),N.sources.push({category:O,mapId:v,mapTitle:h,mapSlug:x,versionIndex:c})})});const i=Ln(e)||null,o=(e==null?void 0:e.title)||(e==null?void 0:e.apicurioArtifactName)||qe(e,"Series"),a=[];return n.forEach((s,c)=>{var O;if((((O=s.sources)==null?void 0:O.length)||0)<2)return;const p=s.catTitle||c,h=new Set,v=s.sources.map(T=>{var ot;let $=T.mapSlug||jt(T.mapTitle||T.mapId)||`map-${T.versionIndex+1}`;h.has($)&&($=`${$}-${T.versionIndex+1}`),h.add($);const ae=new Map,Be=(((ot=T.category)==null?void 0:ot.items)||[]).map((we,De)=>{const Ue=((we==null?void 0:we.id)??"").toString().trim()||`item-${De+1}`,nt=`${$}-${Ue}`;ae.set(Ue,nt);const Vt={...we,id:nt};return Vt.deps=Array.isArray(we==null?void 0:we.deps)?[...we.deps]:[],Vt});return Be.forEach(we=>{we.deps=(we.deps||[]).map(De=>ae.get(De)).filter(Boolean)}),{id:$,title:T.mapTitle||T.mapId||`Map ${T.versionIndex+1}`,items:Be}}),x={id:jt(`${c}-category-view`),title:p,abstract:`Items from "${p}" across ${s.sources.length} maps in this series${o?` (${o})`:""}.`,categories:v,links:[]};i&&(x.seriesId=i),xn(x,{titleHint:p,idHint:`${i||"series"}-${c}`}),a.push({version:`${Oo}${c}`,data:x,isCategoryView:!0,categoryViewKey:c})}),a}function bs(e){var i;if(!e)return null;if(e.isCategoryView&&e.categoryViewKey)return`${Oo}${e.categoryViewKey}`;const t=(((i=e.data)==null?void 0:i.id)??e.id??"").toString().trim();return t||(e.version??"").toString().trim()||null}function Wo(e){var s;if(!((s=e==null?void 0:e.apicurioVersions)!=null&&s.length))return e;const t=bs(e.apicurioVersions[e.apicurioActiveVersionIndex]),n=e.apicurioVersions.filter(c=>!(c!=null&&c.isCategoryView));if(!n.length)return e;if(n.length<2){e.apicurioVersions=n,e.apicurioActiveVersionIndex=Math.max(0,Math.min(Vn(e),e.apicurioVersions.length-1));const c=e.apicurioVersions[e.apicurioActiveVersionIndex];return c!=null&&c.data&&(e.data=c.data),e}const i=nd({...e,apicurioVersions:n});e.apicurioVersions=[...n,...i];let o=e.apicurioVersions.findIndex(c=>bs(c)===t);o===-1&&(o=Math.min(e.apicurioActiveVersionIndex||0,e.apicurioVersions.length-1)),e.apicurioActiveVersionIndex=Math.max(o,0);const a=e.apicurioVersions[e.apicurioActiveVersionIndex];return a!=null&&a.data&&(e.data=a.data),e}function id(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const o=i.map((v,x)=>!v||typeof v!="object"?null:(xn(v,{titleHint:`${t} #${x+1}`}),{obj:v,idx:x})).filter(Boolean);if(!o.length)return[];const a=o[0].obj,{seriesTitleOverride:s}=n;let c=s||a.title||`${t} series`;s&&!a.title&&(a.title=s);const p={id:ci(),title:c,data:a,apicurioVersions:o.map(({obj:v,idx:x})=>({version:String(x+1),data:v})),apicurioActiveVersionIndex:0,isSeries:!0},h=Bt(p,{seriesName:c,fallbackTitle:c});return h&&(p.id=h),Wo(p),[p]}function ws(e,t="Pasted",n={}){return Array.isArray(e)?id(e,t,n):!e||typeof e!="object"?[]:(xn(e,{titleHint:`${t} #1`}),[{id:ci(),title:e.title||`${t} #1`,data:e}])}function Pn(e,t="Pasted",n={}){const o=(gs(typeof e=="string"?e:"")||"").trim();if(!o)return[];const a=td(o);if(a){let c=n;if(Array.isArray(a)&&n.promptForSeriesName){const h=Sc(a,t),v=Ec(h);c={...n,promptForSeriesName:!1,seriesTitleOverride:v||h}}const p=ws(a,t,c);if(p.length)return p}return o.split(/^\s*(?:---|%%%)\s*$/m).map(c=>c.trim()).filter(Boolean).map((c,p)=>{const h=JSON.parse(c);return xn(h,{titleHint:`${t} #${p+1}`}),{id:ci(),title:h.title||`${t} #${p+1}`,data:h}})}function od(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function fi(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!od(e)}function ad(e){if(!e)return!1;const n=(gs(e)||"").trimStart();return/^\s*(\{|\[|---|%%%)/.test(n)}function vs(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(P)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(P)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(P)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=Pn(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let i=null;return n.forEach(o=>{const a=An(o,{versionLabel:"editor"});i==null&&(i=a)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function ys(e="storage"){const t=vs();return!t||typeof t.index!="number"?!1:(kt(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function rd(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const s=new URLSearchParams(window.location.search);s.has("share")&&(t=s.get("share"))}if(!t)return null;let i;try{const s=Ol(t);i=JSON.parse(s)}catch(s){return console.warn("[Blockscape] failed to decode share token",s),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=ws(i.data,i.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let a=null;return o.forEach(s=>{const c=s.isSeries?i.title||s.title:null,p=An({...s,apicurioArtifactName:c||s.apicurioArtifactName},{versionLabel:"shared"});a==null&&(a=p)}),a}async function sd(){const e=jl();if(!(e!=null&&e.path))return null;const{path:t,modelId:n,itemId:i}=e;try{if(!await ao())return console.log("[Blockscape] local backend not ready; skipping server-path autoload"),null;const a=await jr(t);if(typeof(a==null?void 0:a.firstIndex)=="number"){typeof(Ye==null?void 0:Ye.highlightSource)=="function"&&Ye.highlightSource(t);let s=a.firstIndex;if(n){const c=va(n);c!==-1&&(s=c)}return{modelIndex:s,itemId:i||null,modelId:n||null}}return null}catch(o){return console.warn("[Blockscape] server-path autoload failed",o),null}}async function ld(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await La(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function cd(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(a=>(a.items||[]).forEach(s=>{i.add(s.id);const c=new Set(s.deps||[]);(e.links||[]).forEach(p=>{p.from===s.id&&c.add(p.to)}),t.set(s.id,c),c.forEach(p=>{n.has(p)||n.set(p,new Set),n.get(p).add(s.id)})}));const o=new Set;return n.forEach((a,s)=>{((a==null?void 0:a.size)||0)>=2&&o.add(s)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:i}}function dd(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const o=n.getContext("2d"),a=(e||"?").charAt(0).toUpperCase(),s=us(e,t),c=Wc(s);return o.fillStyle=s,o.beginPath(),o.arc(i/2,i/2,i/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=c,o.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(a,i/2,i/2),n.toDataURL("image/png")}function Vn(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Es(e){const t=Vn(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Ss(e,t="active"){return Ln(e)||mt(e)||(e==null?void 0:e.apicurioArtifactId)||(e==null?void 0:e.id)||t}function ud(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var s,c;const o=(((s=n==null?void 0:n.data)==null?void 0:s.id)??"").toString().trim();o&&t.set(o,i);const a=(((c=n==null?void 0:n.data)==null?void 0:c.seriesId)??"").toString().trim();a&&!t.has(a)&&t.set(a,i)}),t}function pd(e,t){if(!e||!t)return null;const n=new Set,i=o=>{const a=(o??"").toString().trim();a&&(n.add(a),n.add(a.toLowerCase()),n.add(jt(a)))};i(e.id),i(e.title);for(const o of n)if(t.has(o))return t.get(o);for(const o of n){const a=o.toLowerCase();for(const[s,c]of t.entries())if(s.toLowerCase()===a)return c}return null}const Is=new WeakMap;function fd(e,t){var nt;if(!((nt=e==null?void 0:e.apicurioVersions)!=null&&nt[t]))return null;const n=e.apicurioVersions[t],i=n.data,o=Vo(i),a=Is.get(n);if(a&&a.fingerprint===o)return a.dataUrl;const s=160,c=160,p=document.createElement("canvas");p.width=s,p.height=c;const h=p.getContext("2d"),v=Fr("--color-surface-ghost")||an.color.surfaceGhost,x=Fr("--color-border-muted")||an.color.borderMuted;h.fillStyle=v,h.fillRect(0,0,s,c),h.strokeStyle=x,h.strokeRect(.5,.5,s-1,c-1);const O=8,T=8,N=4,$=Array.isArray(i==null?void 0:i.categories)?i.categories:[],ae=Math.max($.length,1),Be=s-N*2,ot=N*3,we=ae>1?Math.min(ot,Be/(ae-1)):0,De=ae>1?(s-we*(ae-1))/2:s/2;$.forEach((Vt,_t)=>{const Xe=De+_t*we,at=Array.isArray(Vt.items)?Vt.items:[],Nt=Math.max(at.length,1),dn=c-O-T-N*2,un=Nt>1?Math.min(N*3,dn/(Nt-1)):0;at.forEach((Ct,zt)=>{const He=c-T-N-zt*un;h.beginPath(),h.arc(Xe,He,N,0,Math.PI*2);const En=us(Ct.name||Ct.id||"",Ct.color);h.fillStyle=En,h.strokeStyle="rgba(15,23,42,0.25)",h.fill(),h.stroke()})});const Ue=p.toDataURL("image/png");return Is.set(n,{fingerprint:o,dataUrl:Ue}),Ue}function jo(e,t){var c;if(Hi(),e<0||e>=y.length)return!1;const n=y[e];if(!((c=n==null?void 0:n.apicurioVersions)!=null&&c.length)||!ss(e))return!1;const o=n.apicurioVersions.length,a=(t%o+o)%o,s=n.apicurioVersions[a];return s!=null&&s.data?(n.apicurioActiveVersionIndex=a,n.data=s.data,u=!0,Y=null,ft=null,Jt(),Pt(),Lt(),!0):!1}function xa(e){var i;if(!e||w<0)return!1;const t=y[w];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return!1;const n=Vn(t);return n===-1?!1:jo(w,n+e)}function md(e,t){if(Hi(),e<0||e>=y.length)return!1;const n=y[e];if(!Array.isArray(n==null?void 0:n.apicurioVersions)||n.apicurioVersions.length<=1)return alert("A series needs at least one map. Add another before removing this one."),!1;if(!ss(e))return!1;const i=Math.min(Math.max(t,0),n.apicurioVersions.length-1),o=Vn(n),[a]=n.apicurioVersions.splice(i,1);if(!a)return!1;let s=o;i===o?s=Math.min(i,n.apicurioVersions.length-1):i<o&&(s=Math.max(0,o-1)),n.apicurioActiveVersionIndex=Math.max(0,s);const c=n.apicurioVersions[n.apicurioActiveVersionIndex];return n.data=(c==null?void 0:c.data)||n.data,n.isSeries=n.apicurioVersions.length>1,kt(e),!0}function hd(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=Math.max(1,l.seriesNavMinVersions||1);if(e.apicurioVersions.length<t)return null;const n=document.createElement("div");n.className="version-nav";const i=document.createElement("div");i.className="version-nav__title",i.textContent=e.apicurioArtifactName||e.apicurioArtifactId||mt(e)||"Artifact",i.title="Double-click to rename this series",i.setAttribute("role","button"),i.tabIndex=0,i.addEventListener("dblclick",()=>{var Be;const $=y[w];!((Be=$==null?void 0:$.apicurioVersions)!=null&&Be.length)||!Ic($)||(Rn(),Pt(),Lt())}),n.appendChild(i);const o=document.createElement("div");o.className="version-nav__status";const a=Vn(e),s=Es(e)||"latest";o.textContent=`No. in series ${s} (${a+1} of ${e.apicurioVersions.length})`,n.appendChild(o);const c=document.createElement("div");c.className="version-nav__controls";const p=document.createElement("button");p.type="button",p.className="version-nav__button",p.textContent="Previous",p.addEventListener("click",()=>xa(-1));const h=document.createElement("button");h.type="button",h.className="version-nav__button",h.textContent="Next",h.addEventListener("click",()=>xa(1)),c.appendChild(p),c.appendChild(h),n.appendChild(c);const v=document.createElement("div");v.className="version-nav__thumbs",e.apicurioVersions.forEach(($,ae)=>{var _t,Xe;const Be=document.createElement("button");Be.type="button",Be.className="version-nav__thumb",$!=null&&$.isCategoryView&&Be.classList.add("version-nav__thumb--category"),ae===a&&Be.classList.add("is-active");const ot=fd(e,ae);if(ot){const at=document.createElement("img");at.src=ot,at.alt=`Version ${ae+1}`,Be.appendChild(at)}const we=document.createElement("div");we.className="version-nav__thumb-label";const De=document.createElement("span");De.className="version-nav__thumb-label-text";const Ue=(((_t=$==null?void 0:$.data)==null?void 0:_t.id)??($==null?void 0:$.id)??"").toString().trim();let nt=Ue||($!=null&&$.version?`v${$.version}`:`${ae+1}`),Vt=Ue||nt;if($!=null&&$.isCategoryView){const at=((Xe=$.data)==null?void 0:Xe.title)||$.categoryViewKey||nt||"Category";nt=at,Vt=`Category view: ${at}`,Be.dataset.computed="true"}if(De.textContent=nt,we.title=Vt,we.appendChild(De),Be.appendChild(we),Id(we,De),e.apicurioVersions.length>1&&!($!=null&&$.isCategoryView)){const at=document.createElement("span");at.className="version-nav__thumb-remove",at.title=`Remove ${nt} from this series`,at.setAttribute("aria-label",`Remove ${nt} from this series`),at.setAttribute("role","button"),at.tabIndex=-1,at.textContent="×",at.addEventListener("click",Nt=>{Nt.stopPropagation(),Nt.preventDefault(),window.confirm(`Remove ${nt} from this series?`)&&md(w,ae)}),Be.appendChild(at)}Be.addEventListener("click",()=>jo(w,ae)),_d(Be,$),v.appendChild(Be)});const x=document.createElement("button");x.type="button",x.className="version-nav__thumb version-nav__thumb--add",x.title="Create a new version from this map",x.addEventListener("click",()=>{try{const $=cs({versionLabel:"manual"});kt($)}catch($){alert(($==null?void 0:$.message)||"Unable to create a new version right now.")}});const O=document.createElement("span");O.className="version-nav__thumb-add-icon",O.textContent="+",x.appendChild(O),v.appendChild(x),n.appendChild(v);const T=Ss(e,"active"),N=L.get(T);return typeof N=="number"&&!Number.isNaN(N)&&requestAnimationFrame(()=>{v.scrollLeft=N}),v.addEventListener("scroll",()=>{L.set(T,v.scrollLeft)}),n}function Wi(){var js,Js;if(!q)return;const e=w>=0&&y[w]?y[w]:null,t=S&&S.querySelector?S.querySelector(".version-nav__thumbs"):null;if(t&&e){const m=Ss(e,w);L.set(m,t.scrollLeft)}Un(),Array.isArray(q.m.categories)||(q.m.categories=[]),console.log("[Blockscape] rendering categories=",q.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!q.m.abstract,"- value:",q.m.abstract?q.m.abstract.substring(0,50)+"...":"none"),S.innerHTML="",Te.clear(),pt.clear(),B=[],Uo(y[w],{versionLabel:"1"});const n=hd(y[w]);n&&S.appendChild(n),F.setAttribute("width",window.innerWidth),F.setAttribute("height",window.innerHeight);const o=(()=>{var ut,Pe,gt;const m=document.createElement("div");m.className="blockscape-model-meta";const V=document.createElement("div");V.className="blockscape-model-title",V.textContent=q.m.title&&q.m.title.trim()||qe(y[w]),m.appendChild(V),((ut=y[w])!=null&&ut.isSeries||(gt=(Pe=y[w])==null?void 0:Pe.apicurioVersions)!=null&&gt.length)&&Bt(y[w],{seriesName:y[w].title||q.m.title||qe(y[w])});const H=Es(y[w]),ne=Ln(y[w]),Fe=(q.m.id??"").toString().trim(),Z=document.createElement("div");Z.className="blockscape-model-meta__details";const Ie=(Ut,on)=>{if(!on)return;const mi=document.createElement("div");mi.className="blockscape-model-id";const bn=document.createElement("span");bn.className="blockscape-model-id__label",bn.textContent=Ut;const qt=document.createElement("span");qt.className="blockscape-model-id__value",qt.textContent=on,mi.append(bn,qt),Z.appendChild(mi)};return Ie("Series ID",ne),Ie("Model ID",Fe),Ie("No. in series",H),Z.childElementCount&&m.appendChild(Z),m})();l.showModelMeta!==!1&&S.appendChild(o.cloneNode(!0));const s=document.createElement("div");s.className="blockscape-tabs";const c=document.createElement("div");c.className="blockscape-tabrow";const p=document.createElement("div");p.className="blockscape-tablist",p.setAttribute("role","tablist"),c.appendChild(p);const h=document.createElement("div");h.className="blockscape-tabactions",c.appendChild(h),s.appendChild(c);const v=document.createElement("div");v.className="blockscape-tabpanels",s.appendChild(v);const x=document.createElement("div"),O=document.createElement("div"),T=document.createElement("div"),N=document.createElement("div");let $="";const ae=ud(y[w]),Be=Vn(y[w]),ot=((Js=(js=y[w])==null?void 0:js.apicurioVersions)==null?void 0:Js[Be])||null,we=Gt=!!(ot!=null&&ot.isCategoryView||((ot==null?void 0:ot.version)||"").startsWith(Oo));Kt=null,zn="";const De=(m,V)=>{!m||!V||(m.title=m.title?`${m.title}
${V}`:V)},Ue=[{id:"map",label:"Map",panel:x},{id:"abstract",label:"Info",panel:O},{id:"source",label:"Settings",panel:T},{id:"apicurio",label:"Apicurio",panel:N}],nt=typeof Oe.isEnabled=="function"?Oe.isEnabled():!1,Vt=m=>{if(!F)return;const V=m==="map";F.hidden=!V,V?(Jo(),Gn()):F.innerHTML=""};Ue.forEach((m,V)=>{const H=document.createElement("button");H.type="button",H.id=`tab-${m.id}`,H.className="blockscape-tab"+(V===0?" is-active":""),H.setAttribute("role","tab"),H.setAttribute("aria-controls",`panel-${m.id}`),H.setAttribute("aria-selected",V===0?"true":"false"),H.textContent=m.label,m.id==="apicurio"&&!nt&&(H.hidden=!0,H.tabIndex=-1,H.setAttribute("aria-hidden","true"),H.style.display="none"),m.button=H,p.appendChild(H),m.panel.id=`panel-${m.id}`,m.panel.classList.add("blockscape-tabpanel"),m.panel.setAttribute("role","tabpanel"),m.panel.setAttribute("aria-labelledby",H.id),m.panel.hidden=V!==0,V===0&&m.panel.classList.add("is-active"),v.appendChild(m.panel)});const _t=m=>{Jn=m,Ue.forEach(V=>{const H=V.id===m;V.button.classList.toggle("is-active",H),V.button.setAttribute("aria-selected",H?"true":"false"),V.panel.classList.toggle("is-active",H),V.panel.hidden=!H}),Vt(m)},Xe=Ue.find(m=>m.id==="apicurio"),at=m=>{if(!Xe||!Xe.button||!Xe.panel)return;const V=!!m;if(Xe.button.hidden=!V,Xe.button.tabIndex=V?0:-1,Xe.button.setAttribute("aria-hidden",V?"false":"true"),Xe.button.style.display=V?"":"none",V){const H=Jn==="apicurio";Xe.button.classList.toggle("is-active",H),Xe.button.setAttribute("aria-selected",H?"true":"false"),Xe.panel.classList.toggle("is-active",H),Xe.panel.hidden=!H}else{const H=Xe.panel.classList.contains("is-active");if(Xe.button.classList.remove("is-active"),Xe.button.setAttribute("aria-selected","false"),Xe.panel.classList.remove("is-active"),Xe.panel.hidden=!0,H){const ne=Ue.find(Fe=>Fe.id!=="apicurio");ne&&_t(ne.id)}}A&&(A.checked=V)};Ue.forEach(m=>{m.button.addEventListener("click",()=>{Un(),_t(m.id)}),m.id==="abstract"&&(Kt=m.button,m.button.addEventListener("mouseenter",()=>lo(m.button,$,{offset:12})),m.button.addEventListener("mouseleave",Un),m.button.addEventListener("focus",()=>lo(m.button,$,{offset:12})),m.button.addEventListener("blur",Un))});const dn=(m=>{const V=Ue.find(ne=>ne.id===Jn);if(V&&(V.id!=="apicurio"||m))return V.id;const H=Ue.find(ne=>ne.id!=="apicurio"||m);return(H==null?void 0:H.id)||Ue[0].id})(nt);_t(dn),at(nt),typeof Oe.onEnabledChange=="function"&&Oe.onEnabledChange(at),S.appendChild(s);const un=document.createElement("div");un.className="blockscape-render",x.appendChild(un);const Ct=document.createElement("div");if(Ct.className="blockscape-abstract-panel",O.appendChild(o.cloneNode(!0)),q.m.abstract){console.log("[Blockscape] Rendering abstract content");const m=document.createElement("div");m.className="blockscape-abstract",m.innerHTML=q.m.abstract,Kd(m),Ct.appendChild(m),$=m.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const m=document.createElement("div");m.className="blockscape-abstract-placeholder",m.textContent="No abstract has been provided for this model.",Ct.appendChild(m),$=m.outerHTML}zn=$,O.appendChild(Ct);const zt=document.createElement("div");zt.className="blockscape-source-panel";const He=document.createElement("div");He.className="blockscape-settings-panel";const En=m=>{Ae.themeToggle&&(Ae.themeToggle.checked=m),Ae.tabThemeToggle&&(Ae.tabThemeToggle.checked=m)},Sn=m=>{En(m),ma(m?si:wi)},zi=m=>{Ae.tabCenterToggle&&(Ae.tabCenterToggle.checked=m)},qi=m=>{const V=Ci(m);zi(V),Hr(V)},en=m=>{Ae.secondaryLinksToggle&&(Ae.secondaryLinksToggle.checked=m),Ae.tabSecondaryLinksToggle&&(Ae.tabSecondaryLinksToggle.checked=m)},Yn=m=>{const V=!!m;en(V),vn=V,Y?Tt(Y):(qo(),Gn())},tn=({id:m,label:V,checked:H,onChange:ne})=>{const Fe=document.createElement("label");Fe.className="blockscape-tab-toggle",Fe.setAttribute("for",m);const Z=document.createElement("input");Z.type="checkbox",Z.id=m,Z.checked=H,typeof ne=="function"&&Z.addEventListener("change",()=>ne(Z.checked));const Ie=document.createElement("span");return Ie.className="blockscape-tab-toggle__label",Ie.textContent=V,Fe.append(Z,Ie),{row:Fe,input:Z}},uo=document.createElement("p");uo.className="blockscape-settings-panel__title",uo.textContent="Feature toggles",He.appendChild(uo);const Gi=document.createElement("label");Gi.className="settings-toggle";const Hn=document.createElement("input");Hn.type="checkbox",Hn.checked=no===si;const po=document.createElement("span");po.className="settings-toggle__text";const fo=document.createElement("span");fo.className="settings-toggle__label",fo.textContent="Dark mode";const mo=document.createElement("span");mo.className="settings-toggle__hint",mo.textContent="Switch Blockscape UI to dark colors.",po.append(fo,mo),Gi.append(Hn,po),Hn.addEventListener("change",()=>{Sn(Hn.checked)}),He.appendChild(Gi),Ae.themeToggle=Hn;const{row:I,input:W}=tn({id:"tabToggleTheme",label:"Dark mode",checked:no===si,onChange:m=>Sn(m)});h.appendChild(I),Ae.tabThemeToggle=W;const{row:re,input:se}=tn({id:"tabToggleSecondaryLinks",label:"Show indirect links",checked:vn,onChange:m=>Yn(m)});h.appendChild(re),Ae.tabSecondaryLinksToggle=se;const{row:rt,input:xt}=tn({id:"tabToggleCenterItems",label:"Center",checked:Qt,onChange:m=>qi(m)});h.appendChild(rt),Ae.tabCenterToggle=xt;const ue=document.createElement("div");ue.className="settings-actions";const Je=document.createElement("input");Je.type="file",Je.accept="application/json",Je.hidden=!0;const Mt=document.createElement("button");Mt.type="button",Mt.className="pf-v5-c-button pf-m-secondary",Mt.textContent="Load settings",Mt.addEventListener("click",()=>Je.click()),Je.addEventListener("change",async()=>{var V,H;const m=(V=Je.files)==null?void 0:V[0];if(m)try{const ne=await m.text(),Fe=JSON.parse(ne),Z=(Fe==null?void 0:Fe.settings)||Fe,ut=((H=ts(Z||{},{refreshObsidianLinks:Go}).applied)==null?void 0:H.length)||0;On(ut?`Loaded ${ut} setting${ut===1?"":"s"} from ${m.name}.`:`No matching settings found in ${m.name}.`,2200)}catch(ne){console.warn("[Blockscape] failed to load settings.json",ne),On("Invalid settings file.",2400)}finally{Je.value=""}});const nn=document.createElement("button");nn.type="button",nn.className="pf-v5-c-button pf-m-tertiary",nn.textContent="Download settings",nn.addEventListener("click",()=>{const m={version:1,exportedAt:new Date().toISOString(),settings:ml(es(),{localBackend:Ye})};Dr("settings.json",JSON.stringify(m,null,2)),On("Settings downloaded.",2e3)}),ue.append(Mt,nn,Je),He.appendChild(ue);const Yt=document.createElement("div");Yt.className="color-presets";const Xn=document.createElement("div");Xn.className="settings-text__label",Xn.textContent="Color presets";const Na=document.createElement("div");Na.className="settings-text__hint",Na.textContent="Shown in tile context menu for quick coloring.",Yt.append(Xn,Na);const ho=document.createElement("div");ho.className="color-presets__list";const Ma=document.createElement("div");Ma.className="color-presets__add";const Ki=document.createElement("input");Ki.type="text",Ki.placeholder="Name",Ki.className="settings-text__input";const go=document.createElement("input");go.type="color",go.value="#2563eb",go.className="settings-color-input";const bo=document.createElement("button");bo.type="button",bo.className="pf-v5-c-button pf-m-primary",bo.textContent="Add preset",bo.addEventListener("click",()=>{const m=Ki.value.trim()||"Custom",V=go.value,H=[...Wt,{name:m,value:V}];xi(H),Ui(Wt),Ki.value=""}),Ma.append(Ki,go,bo),Yt.append(ho,Ma),He.appendChild(Yt),Ae.colorPresetList=ho,_i=()=>{ho.innerHTML="",Wt.forEach((m,V)=>{const H=document.createElement("div");H.className="color-presets__row";const ne=document.createElement("input");ne.type="text",ne.className="settings-text__input",ne.value=m.name||"",ne.placeholder="Name",ne.addEventListener("input",()=>{const Ie=[...Wt];Ie[V]={...Ie[V],name:ne.value},xi(Ie),Ui(Wt)});const Fe=document.createElement("input");Fe.type="color",Fe.className="settings-color-input",Fe.value=m.value,Fe.addEventListener("input",()=>{const Ie=[...Wt];Ie[V]={...Ie[V],value:Fe.value},xi(Ie),Ui(Wt)});const Z=document.createElement("button");Z.type="button",Z.className="pf-v5-c-button pf-m-plain",Z.textContent="✕",Z.title="Remove preset",Z.addEventListener("click",()=>{const Ie=Wt.filter((ut,Pe)=>Pe!==V);xi(Ie),Ui(Wt),_i()}),H.append(ne,Fe,Z),ho.appendChild(H)})},_i();const Zn=({id:m,label:V,hint:H,checked:ne,className:Fe="",onChange:Z})=>{const Ie=document.createElement("label");Ie.className=["settings-toggle",Fe].filter(Boolean).join(" ");const ut=document.createElement("input");ut.type="checkbox",ut.id=m,ut.checked=ne;const Pe=document.createElement("span");Pe.className="settings-toggle__text";const gt=document.createElement("span");if(gt.className="settings-toggle__label",gt.textContent=V,Pe.appendChild(gt),H){const Ut=document.createElement("span");Ut.className="settings-toggle__hint",Ut.textContent=H,Pe.appendChild(Ut)}return Ie.appendChild(ut),Ie.appendChild(Pe),typeof Z=="function"&&ut.addEventListener("change",()=>Z(ut.checked)),{row:Ie,input:ut}},Go=()=>{S.querySelectorAll(".tile").forEach(m=>{const V=m.dataset.id,H=ya(V);if(!(H!=null&&H.item))return;const ne=xs(H.item.external),Fe=Cs(H.item,{externalMeta:ne,seriesIdLookup:ae});As(m,Fe)})},{row:Qd,input:eu}=Zn({id:"toggleSecondaryLinks",label:"Show indirect links",checked:vn,className:"map-controls__toggle",onChange:m=>Yn(m)});He.appendChild(Qd),Ae.secondaryLinksToggle=eu;const{row:tu,input:nu}=Zn({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:Ft,className:"map-controls__toggle",onChange:m=>{Ft=m,Ta()}});He.appendChild(tu),Ae.reusedToggle=nu;const{row:iu,input:ou}=Zn({id:"toggleAutoIdFromName",label:"Auto-fill IDs from titles",hint:"Keep ID in sync while editing name/title (can be overridden manually).",checked:li,className:"map-controls__toggle",onChange:m=>{const V=Oi(m);Kr(V)}});He.appendChild(iu),Ae.autoIdToggle=ou;const Ba=[],{row:au,input:ru}=Zn({id:"toggleObsidianLinks",label:"Obsidian",hint:"Make tiles open Obsidian when no external URL exists.",checked:Ii,className:"map-controls__toggle",onChange:m=>{const V=Vi(m);os(V),Ba.forEach(H=>{H.disabled=!V}),Go()}});if(He.appendChild(au),Ae.obsidianToggle=ru,typeof(Ye==null?void 0:Ye.isAvailable)=="function"&&Ye.isAvailable()&&typeof(Ye==null?void 0:Ye.getAutoReloadConfig)=="function"){const{enabled:m,intervalMs:V}=Ye.getAutoReloadConfig();let H=null;const{row:ne,input:Fe}=Zn({id:"toggleAutoReload",label:"Auto-reload local files",hint:"Poll the local backend for file changes and refresh matching models.",checked:m,className:"map-controls__toggle",onChange:on=>{Ye.setAutoReloadEnabled(on),H&&(H.disabled=!on)}});He.appendChild(ne),Ae.autoReloadToggle=Fe;const Z=on=>`${(on/1e3).toFixed(2)}s`,Ie=document.createElement("label");Ie.className="settings-slider",Ie.setAttribute("for","autoReloadInterval");const ut=document.createElement("div");ut.className="settings-slider__text";const Pe=document.createElement("span");Pe.className="settings-slider__label",Pe.textContent="Auto-reload interval";const gt=document.createElement("span");gt.className="settings-slider__hint",gt.textContent="Adjust how often to poll for file changes.",ut.append(Pe,gt);const Ut=document.createElement("span");Ut.className="settings-slider__value",Ut.textContent=Z(V),H=document.createElement("input"),H.type="range",H.id="autoReloadInterval",H.className="settings-slider__input",H.min=String(Tr),H.max=String(Lr),H.step="100",H.value=String(V),H.disabled=!m,H.setAttribute("aria-label","Set auto-reload polling interval"),H.addEventListener("input",()=>{const on=Ye.setAutoReloadInterval(parseInt(H.value,10));Ut.textContent=Z(on)}),Ie.append(ut,Ut,H),He.appendChild(Ie),Ae.autoReloadInput=H,Ae.autoReloadValue=Ut}const $a=document.createElement("div");$a.className="settings-radio";const Oa=document.createElement("div");Oa.className="settings-radio__label",Oa.textContent="Obsidian link format";const Ra=document.createElement("div");Ra.className="settings-radio__hint",Ra.textContent="Use the tile title or id when building Obsidian links.";const Pa=document.createElement("div");Pa.className="settings-radio__options";const Ps=(m,V)=>{const H=document.createElement("label");H.className="settings-radio__option";const ne=document.createElement("input");ne.type="radio",ne.name="obsidianLinkMode",ne.value=m,ne.checked=to===m,ne.disabled=!Ii,ne.addEventListener("change",()=>{if(!ne.checked)return;const Z=Pi(m);is(Z),Go()});const Fe=document.createElement("span");Fe.textContent=V,H.append(ne,Fe),Ba.push(ne),Pa.appendChild(H)};Ps(pa,"Use title"),Ps(Mo,"Use id"),$a.append(Oa,Pa,Ra),He.appendChild($a),Ae.obsidianModeInputs=Ba;const Ko=document.createElement("label");Ko.className="settings-text",Ko.setAttribute("for","obsidianVaultInput");const Va=document.createElement("div");Va.className="settings-text__text";const Da=document.createElement("span");Da.className="settings-text__label",Da.textContent="Obsidian vault";const Ua=document.createElement("span");Ua.className="settings-text__hint",Ua.textContent="Optional. Set the vault name to avoid duplicates.",Va.append(Da,Ua);const Fn=document.createElement("input");Fn.type="text",Fn.id="obsidianVaultInput",Fn.className="settings-text__input",Fn.placeholder="Vault name",Fn.value=ki,Fn.addEventListener("input",()=>{const m=Di(Fn.value);as(m),Go()}),Ko.append(Va,Fn),He.appendChild(Ko),Ae.obsidianVaultInput=Fn;const Ha=document.createElement("p");Ha.className="settings-note",Ha.innerHTML='Requires the Obsidian <a href="https://vinzent03.github.io/obsidian-advanced-uri/" target="_blank" rel="noreferrer noopener">Advanced URI</a> plugin for create/open behavior.',He.appendChild(Ha);const Vs=m=>`${(m/1e3).toFixed(1)}s`,Yo=document.createElement("label");Yo.className="settings-slider",Yo.setAttribute("for","seriesNavDoubleClickWait");const Fa=document.createElement("div");Fa.className="settings-slider__text";const Wa=document.createElement("span");Wa.className="settings-slider__label",Wa.textContent="Series double-click wait";const ja=document.createElement("span");ja.className="settings-slider__hint",ja.textContent="Time window to double-click into another map version.",Fa.append(Wa,ja);const wo=document.createElement("span");wo.className="settings-slider__value",wo.textContent=Vs($n);const pn=document.createElement("input");pn.type="range",pn.id="seriesNavDoubleClickWait",pn.className="settings-slider__input",pn.min=String(Rr),pn.max=String(Pr),pn.step="50",pn.value=String($n),pn.setAttribute("aria-label","Adjust double-click wait for series navigation"),pn.addEventListener("input",()=>{const m=Ri(parseInt(pn.value,10));wo.textContent=Vs(m),ns(m)}),Yo.append(Fa,wo,pn),He.appendChild(Yo),Ae.seriesNavInput=pn,Ae.seriesNavValue=wo;const Ds=m=>`${Math.round((m-1)*100)}%`,Xo=document.createElement("label");Xo.className="settings-slider",Xo.setAttribute("for","hoverScaleSlider");const Ja=document.createElement("div");Ja.className="settings-slider__text";const za=document.createElement("span");za.className="settings-slider__label",za.textContent="Hover zoom";const qa=document.createElement("span");qa.className="settings-slider__hint",qa.textContent="Expand tiles on hover to see more detail.",Ja.append(za,qa);const vo=document.createElement("span");vo.className="settings-slider__value",vo.textContent=Ds(vi);const fn=document.createElement("input");fn.type="range",fn.id="hoverScaleSlider",fn.className="settings-slider__input",fn.min=String(Me),fn.max=String(We),fn.step="0.1",fn.value=String(vi),fn.setAttribute("aria-label","Adjust hover zoom"),fn.addEventListener("input",()=>{const m=Ai(parseFloat(fn.value));vo.textContent=Ds(m),zr(m),Y&&Fi()}),Xo.append(Ja,vo,fn),He.appendChild(Xo),Ae.hoverScaleInput=fn,Ae.hoverScaleValue=vo;let Dt=null,Qn=null;const Ga=m=>{const V=Math.round((1-m)*100);return V===0?"Off":`${V}% dim`},{row:su,input:lu}=Zn({id:"toggleSelectionDimming",label:"Dim unrelated tiles",hint:"When selecting a tile, fade everything except linked tiles.",checked:Bn,className:"map-controls__toggle",onChange:m=>{const V=$i(m);Gr(V),Dt&&(Dt.disabled=!V),Qn&&(Qn.textContent=Ga(V?Mn:1))}});He.appendChild(su),Ae.selectionDimToggle=lu;const Zo=document.createElement("label");Zo.className="settings-slider",Zo.setAttribute("for","selectionDimmingSlider");const Ka=document.createElement("div");Ka.className="settings-slider__text";const Ya=document.createElement("span");Ya.className="settings-slider__label",Ya.textContent="Dimming strength";const Xa=document.createElement("span");Xa.className="settings-slider__hint",Xa.textContent="Adjust how much unrelated tiles fade when dimming is on.",Ka.append(Ya,Xa),Qn=document.createElement("span"),Qn.className="settings-slider__value",Qn.textContent=Ga(Bn?Mn:1),Dt=document.createElement("input"),Dt.type="range",Dt.id="selectionDimmingSlider",Dt.className="settings-slider__input",Dt.min=String(Se),Dt.max=String(je),Dt.step="0.05",Dt.value=String(Mn),Dt.disabled=!Bn,Dt.setAttribute("aria-label","Adjust how much unrelated tiles dim on selection"),Dt.addEventListener("input",()=>{const m=Ti(parseFloat(Dt.value));Qn.textContent=Ga(m),qr(m)}),Zo.append(Ka,Qn,Dt),He.appendChild(Zo),Ae.selectionDimInput=Dt,Ae.selectionDimValue=Qn;const Us=m=>m===1?"Default":`${Math.round(m*100)}%`,Qo=document.createElement("label");Qo.className="settings-slider",Qo.setAttribute("for","tileCompactnessSlider");const Za=document.createElement("div");Za.className="settings-slider__text";const Qa=document.createElement("span");Qa.className="settings-slider__label",Qa.textContent="Tile compactness";const er=document.createElement("span");er.className="settings-slider__hint",er.textContent="Adjust padding, gap, and logo size for tiles.",Za.append(Qa,er);const yo=document.createElement("span");yo.className="settings-slider__value",yo.textContent=Us(yi);const mn=document.createElement("input");mn.type="range",mn.id="tileCompactnessSlider",mn.className="settings-slider__input",mn.min=String(Sr),mn.max=String(Ir),mn.step="0.05",mn.value=String(yi),mn.setAttribute("aria-label","Adjust tile compactness"),mn.addEventListener("input",()=>{const m=Li(parseFloat(mn.value));yo.textContent=Us(m),Yr(m),Y&&Fi()}),Qo.append(Za,yo,mn),He.appendChild(Qo),Ae.tileCompactnessInput=mn,Ae.tileCompactnessValue=yo;const{row:cu,input:du}=Zn({id:"titleWrapToggle",label:"Wrap titles",hint:"Allow long titles to wrap instead of truncating.",checked:fa!=="nowrap",className:"map-controls__toggle",onChange:m=>{const V=m?"wrap":"nowrap";Bi(V),Qr(V)}});He.appendChild(cu),Ae.titleWrapInput=du;const Hs=m=>`${Math.round((m-1)*100)}% extra`,ea=document.createElement("label");ea.className="settings-slider",ea.setAttribute("for","titleHoverWidthSlider");const tr=document.createElement("div");tr.className="settings-slider__text";const nr=document.createElement("span");nr.className="settings-slider__label",nr.textContent="Title width on hover";const ir=document.createElement("span");ir.className="settings-slider__hint",ir.textContent="Give titles more room horizontally when zoomed.",tr.append(nr,ir);const Eo=document.createElement("span");Eo.className="settings-slider__value",Eo.textContent=Hs(Ei);const hn=document.createElement("input");hn.type="range",hn.id="titleHoverWidthSlider",hn.className="settings-slider__input",hn.min=String(_n),hn.max=String(cn),hn.step="0.05",hn.value=String(Ei),hn.setAttribute("aria-label","Adjust title width boost on hover"),hn.addEventListener("input",()=>{const m=Ni(parseFloat(hn.value));Eo.textContent=Hs(m),Xr(m)}),ea.append(tr,Eo,hn),He.appendChild(ea),Ae.titleWidthInput=hn,Ae.titleWidthValue=Eo;const Fs=m=>`${Math.round(m*100)}% of hover zoom`,ta=document.createElement("label");ta.className="settings-slider",ta.setAttribute("for","titleZoomPortionSlider");const or=document.createElement("div");or.className="settings-slider__text";const ar=document.createElement("span");ar.className="settings-slider__label",ar.textContent="Title zoom influence";const rr=document.createElement("span");rr.className="settings-slider__hint",rr.textContent="How much the title scales relative to tile hover zoom.",or.append(ar,rr);const So=document.createElement("span");So.className="settings-slider__value",So.textContent=Fs(Si);const gn=document.createElement("input");gn.type="range",gn.id="titleZoomPortionSlider",gn.className="settings-slider__input",gn.min=String(ri),gn.max=String(ua),gn.step="0.05",gn.value=String(Si),gn.setAttribute("aria-label","Adjust how much titles scale on hover"),gn.addEventListener("input",()=>{const m=Mi(parseFloat(gn.value));So.textContent=Fs(m),Zr(m)}),ta.append(or,So,gn),He.appendChild(ta),Ae.titleZoomInput=gn,Ae.titleZoomValue=So;const uu=typeof Oe.isEnabled=="function"?Oe.isEnabled():!1,{row:pu,input:fu}=Zn({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:uu,className:"apicurio-toggle",onChange:m=>{typeof Oe.setEnabled=="function"&&Oe.setEnabled(m)}});if(A=fu,He.appendChild(pu),zt.appendChild(He),C)C.hidden=!1,C.classList.remove("pf-v5-c-page__main-section"),zt.appendChild(C);else{const m=document.createElement("p");m.className="muted",m.textContent="Source editor unavailable.",zt.appendChild(m)}T.appendChild(zt),Oe.mount(N);let Ws=0;if(q.m.categories.forEach(m=>{const V=document.createElement("section");V.className="category",V.dataset.cat=m.id;const H=we?pd(m,ae):null,ne=document.createElement("div");ne.className="cat-head",ne.dataset.cat=m.id,ne.tabIndex=0,we&&Number.isInteger(H)?(ne.dataset.seriesVersionIndex=String(H),ne.title="Open this category's map in the series",ne.classList.add("cat-head--series-link")):ne.title="Select category",ne.innerHTML=`<div class="cat-title">${so(m.title||m.id)}</div>
                          <div class="muted cat-count">${(m.items||[]).length} items</div>`,ne.addEventListener("click",()=>{var gt;const Z=ne.dataset.seriesVersionIndex!=null?parseInt(ne.dataset.seriesVersionIndex,10):null,Ie=y[w],ut=Ie?Vn(Ie):-1;we&&((gt=Ie==null?void 0:Ie.apicurioVersions)==null?void 0:gt.length)>1&&Number.isInteger(Z)&&Z!==ut&&jo(w,Z)||Dn(m.id)}),ne.addEventListener("keydown",Z=>{(Z.key==="Enter"||Z.key===" ")&&(Z.preventDefault(),ne.click())}),ne.addEventListener("focus",()=>Dn(m.id,{scrollIntoView:!1})),V.appendChild(ne);const Fe=document.createElement("div");if(Fe.className="grid"+(Qt?" is-centered":""),V.appendChild(Fe),(m.items||[]).forEach(Z=>{Ws+=1;const Ie=xs(Z.external),ut=Cs(Z,{externalMeta:Ie,seriesIdLookup:ae}),Pe=document.createElement("div");if(Pe.className=Ie.isExternal?"tile external":"tile",Pe.tabIndex=0,Pe.dataset.id=Z.id,Pe.dataset.globalIndex=String(Ws),Ie.url&&(Pe.dataset.externalUrl=Ie.url),!we){let qt=null;if(ae.has(Z.id)&&(qt=ae.get(Z.id)),Number.isInteger(qt)){Pe.dataset.seriesVersionIndex=String(qt),Pe.classList.add("tile--series-link");const mu=qt===Be?"Current map in this series":`Open version ${qt+1} in this series`;De(Pe,mu)}}if(ut&&(Pe.dataset.obsidianUrl=ut),!we){const qt=va(Z.id);qt!==-1&&qt!==w&&(Pe.classList.add("tile--series-link"),Pe.dataset.navTargetIndex=String(qt))}const gt=document.createElement("img");gt.className="logo",Z.logo?(gt.src=Z.logo,gt.alt=Z.name||Z.id):(gt.alt="",gt.style.opacity=1,gt.src=dd(Z.name||Z.id,Z.color));const Ut=document.createElement("div");Ut.className="name",Ut.textContent=Z.name||Z.id;const on=document.createElement("div");on.className="tile-id",on.textContent=Z.id||"";const mi=document.createElement("div");mi.className="badge",mi.textContent="reused";let bn=null;we||(bn=document.createElement("button"),bn.type="button",bn.className="tile-delete",bn.setAttribute("aria-label",`Delete ${Z.name||Z.id}`),bn.textContent="×",bn.addEventListener("click",qt=>{qt.stopPropagation(),zd(Z.id)})),Ie.url&&Pe.appendChild(Sd(Ie.url)),As(Pe,ut),bn&&Pe.appendChild(bn),Pe.appendChild(gt),Pe.appendChild(Ut),Pe.appendChild(on),Pe.appendChild(mi),Fe.appendChild(Pe),Te.set(Z.id,{el:Pe,catId:m.id,rect:null})}),un.appendChild(V),pt.set(m.id,{el:V,headEl:ne}),!we){const Z=document.createElement("button");Z.type="button",Z.className="tile-add",Z.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',Z.hidden=Qt,Z.tabIndex=Qt?-1:0,Z.setAttribute("aria-hidden",Qt?"true":"false"),Z.addEventListener("click",()=>$d(m.id)),Fe.appendChild(Z)}}),!we){const m=document.createElement("button");m.type="button",m.className="category-add",m.innerHTML='<span class="category-add__icon" aria-hidden="true">+</span><span class="category-add__label">Add category</span><span class="category-add__hint">(Insert)</span>',m.addEventListener("click",()=>Ns()),un.appendChild(m)}Ta(),gd(),Jo(),Gn(),ji(),Cd()}function gd(){S.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",n=>{var T;if(typeof n.button=="number"&&n.button!==0)return;qn();const i=e.dataset.id,o=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,a=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,s=e.dataset.navTargetIndex!=null?parseInt(e.dataset.navTargetIndex,10):null,c=y[w],p=c?Vn(c):-1,h=((T=c==null?void 0:c.apicurioVersions)==null?void 0:T.length)>1&&Number.isInteger(o)&&o!==p,v=Number.isInteger(s)&&s!==w&&s>=0&&s<y.length,x=$t&&$t.id===i&&$t.targetVersionIndex===o,O=Xt&&Xt.id===i&&Xt.targetIndex===s;if($t&&!x&&Hi(),Xt&&!O&&ka(),h)if(x){if(Hi(),jo(w,o))return}else zc(i,o,c);else if(v){if(O){ka(),kt(s);return}qc(i,s)}else Number.isInteger(a)&&a>0&&a%5===0&&On("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",i),Y===i&&!(h&&x)&&!(v&&O)){Ji();return}Tt(i)}),e.addEventListener("dblclick",n=>{n.preventDefault();const i=e.dataset.id,o=e.dataset.navTargetIndex!=null?parseInt(e.dataset.navTargetIndex,10):va(i);o!==-1&&o!==w&&kt(o)}),e.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())});const t=()=>{Y&&Fi()};e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",t),e.addEventListener("focus",t),e.addEventListener("blur",t),e.draggable=!0,e.addEventListener("dragstart",Ad),e.addEventListener("dragend",Td)}),S.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",Ld),e.addEventListener("drop",Bd),e.addEventListener("dragenter",Nd),e.addEventListener("dragleave",Md)}),ps||(ps=!0,window.addEventListener("resize",Fi),window.addEventListener("scroll",Fi,{passive:!0}),window.addEventListener("resize",Ts),document.addEventListener("click",e=>{var a,s,c;if(!Y&&!Ke||typeof e.button=="number"&&e.button!==0)return;const t=e.target,n=(a=t==null?void 0:t.closest)==null?void 0:a.call(t,".tile"),i=(s=t==null?void 0:t.closest)==null?void 0:s.call(t,".cat-head"),o=(c=t==null?void 0:t.closest)==null?void 0:c.call(t,".tile-context-menu");n||i||o||Ji()})),document.getElementById("clear").onclick=()=>Ji()}function Jo(){Te.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function ks(e,{includeSecondary:t=vn}={}){if(!e||!q)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(q.fwd.get(e)||[]),i=new Set(q.rev.get(e)||[]),o=new Set,a=new Set,s=[],c=new Set,p=(h,v,x,O)=>{if(!h||!v)return;const T=`${h}->${v}:${x}:${O}`;c.has(T)||(c.add(T),s.push({from:h,to:v,type:x,depth:O}))};return n.forEach(h=>p(e,h,"dep",1)),i.forEach(h=>p(e,h,"revdep",1)),t&&new Set([...n,...i]).forEach(v=>{(q.fwd.get(v)||new Set).forEach(T=>{const N=T===e;N||o.add(T),N||p(v,T,"dep",2)}),(q.rev.get(v)||new Set).forEach(T=>{const N=T===e;N||a.add(T),N||p(v,T,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:o,secondaryRevs:a,edges:s}}function zo(e,t){const n=Te.get(e);n&&n.el.classList.add(t)}function Tt(e){var c,p,h;if(!e)return;Ke=null,Y=e,ct=null,ft=ks(e),Jt(),qo(),ji();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:o}=ft;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const a=Te.get(e);a&&a.el.classList.add("selected"),t.forEach(v=>zo(v,"dep")),n.forEach(v=>zo(v,"revdep")),i.forEach(v=>{!t.has(v)&&v!==e&&zo(v,"dep-indirect")}),o.forEach(v=>{!n.has(v)&&!t.has(v)&&v!==e&&zo(v,"revdep-indirect")}),Gn();const s=(h=(p=(c=Te.get(e))==null?void 0:c.el)==null?void 0:p.dataset)==null?void 0:h.externalUrl;s&&On("This item has link to",In,s),ha()}function Dn(e,{scrollIntoView:t=!0,preserveEntryHint:n=!1}={}){var s,c;if(!((s=q==null?void 0:q.m)!=null&&s.categories)||!e)return!1;const o=(q.m.categories||[]).find(p=>p.id===e);if(!o)return!1;qn(),Aa(),n||(ct=null),Ke=o.id,Jt(),ji();const a=pt.get(o.id);return t&&(a!=null&&a.el)&&(a.el.scrollIntoView({behavior:"smooth",block:"center"}),(c=a.headEl)==null||c.focus({preventScroll:!0})),!0}function ji(){if(pt.forEach(({el:t,headEl:n})=>{t.classList.remove("category--selected"),n&&n.removeAttribute("aria-current")}),!Ke)return;const e=pt.get(Ke);if(!(e!=null&&e.el)){Ke=null,ct=null,Jt();return}e.el.classList.add("category--selected"),e.headEl&&e.headEl.setAttribute("aria-current","true")}function ro(){if(Ke)return Ke;const e=Y?Te.get(Y):null;return e!=null&&e.catId?e.catId:null}function bd(e){var a,s,c,p;if(!((s=(a=q==null?void 0:q.m)==null?void 0:a.categories)!=null&&s.length)||!e)return!1;const t=q.m.categories,n=ro();let i=t.findIndex(h=>h.id===n);if(i===-1){const h=((c=t.find(v=>(v.items||[]).length))==null?void 0:c.id)||((p=t[0])==null?void 0:p.id);return h?Dn(h):!1}const o=i+e;return o<0||o>=t.length?!1:Dn(t[o].id)}function Aa(){Y=null,ft=null,qo(),Gn(),ha({itemId:null})}function wd(){Ke=null,ct=null,ji()}function Ji(){Aa(),wd(),ct=null,Jt()}function qo(){S.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function Ta(){q!=null&&q.reusedLocal&&q.reusedLocal.forEach(e=>{const t=Te.get(e);if(!t)return;t.el.classList.toggle("reused",Ft);const n=t.el.querySelector(".badge");n&&(n.style.display=Ft?"inline-block":"none")})}function Gn(){for(;F.firstChild;)F.removeChild(F.firstChild);if(!Y||F.hidden)return;ft=ks(Y),ft.edges.forEach(t=>{var x,O;const n=(x=Te.get(t.from))==null?void 0:x.rect,i=(O=Te.get(t.to))==null?void 0:O.rect;if(!n||!i)return;const o=_s(n),a=_s(i),s=document.createElementNS("http://www.w3.org/2000/svg","path"),c=(o.x+a.x)/2,p=o.y,h=(o.x+a.x)/2,v=a.y;s.setAttribute("d",`M ${o.x},${o.y} C ${c},${p} ${h},${v} ${a.x},${a.y}`),s.setAttribute("fill","none"),s.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),s.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),s.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&s.setAttribute("stroke-dasharray","4 3"),s.setAttribute("vector-effect","non-scaling-stroke"),F.appendChild(s)})}function _s(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function so(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function vd(e){const t=(e??"").toString().trim();if(!t)return"";const n=t.endsWith(".md")?t:`${t}.md`,i=new URLSearchParams;return i.set("filepath",n),i.set("data"," "),i.set("mode","append"),ki&&i.set("vault",ki),`obsidian://advanced-uri?${i.toString()}`}function yd(e){return e?to===Mo?e.id??e.name??"":e.name??e.id??"":""}function Cs(e,{externalMeta:t,seriesIdLookup:n}={}){var o;if(!Ii||!e||(o=n==null?void 0:n.has)!=null&&o.call(n,e.id))return"";const i=yd(e);return vd(i)}function xs(e){var t;if(typeof e=="string"){const n=e.trim();if(!n)return{isExternal:!1,url:""};try{const i=new URL(n);return/^https?:/i.test(i.protocol)?{isExternal:!0,url:i.toString()}:{isExternal:!1,url:""}}catch{}if(!/^[a-z][a-z0-9+.-]*:/i.test(n))try{const i=typeof window<"u"&&((t=window.location)!=null&&t.href)?window.location.href:void 0;return{isExternal:!0,url:i?new URL(n,i).toString():n}}catch(i){return console.warn("[Blockscape] invalid external url skipped",e,i),{isExternal:!1,url:""}}return console.warn("[Blockscape] invalid external url skipped",e),{isExternal:!1,url:""}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function Ed(e){const t=document.createElement("button");return t.type="button",t.className="external-link obsidian-link",t.setAttribute("aria-label","Open in Obsidian"),t.title=e,t.textContent="O",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function Sd(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function As(e,t){if(!e)return;const n=e.querySelector(".obsidian-link");if(!t){n&&n.remove(),e.removeAttribute("data-obsidian-url");return}if(e.dataset.obsidianUrl=t,n){n.title=t;return}e.appendChild(Ed(t))}function Ts(){ee||(ee=requestAnimationFrame(()=>{ee=null,B=B.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),B.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function Id(e,t){!e||!t||(B.push({labelEl:e,textEl:t}),Ts())}function kd(e,t){var a,s;const n=[`<div class="version-nav__tooltip-title">${so(t)}</div>`],i=((e==null?void 0:e.version)??((a=e==null?void 0:e.data)==null?void 0:a.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${so(i)}</div>`);const o=(((s=e==null?void 0:e.data)==null?void 0:s.abstract)??"").toString().trim();return o?n.push(`<div class="version-nav__tooltip-body">${o}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function lo(e,t,{offset:n=8}={}){!Q||!e||!t||(Q.innerHTML=t,Q.hidden=!1,Q.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),o=Q.getBoundingClientRect(),a=window.scrollX||document.documentElement.scrollLeft,s=window.scrollY||document.documentElement.scrollTop;let c=i.left+i.width/2-o.width/2+a,p=i.top-o.height-n+s;c<a+n&&(c=a+n);const h=a+window.innerWidth-o.width-n;c>h&&(c=h),p<s+n&&(p=i.bottom+n+s),Q.style.left=`${c}px`,Q.style.top=`${p}px`,Q.classList.add("is-visible")}))}function Un(){kn&&(clearTimeout(kn),kn=null),Q&&(Q.classList.remove("is-visible"),Q.setAttribute("aria-hidden","true"),Q.hidden=!0)}function _d(e,t){if(!e)return;const n=qe((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=kd(t,n);let o=null;const a=()=>{o&&(clearTimeout(o),o=null)},s=()=>{E=e,lo(e,`<div class="version-nav__tooltip-title">${so(n)}</div>`,{offset:10})},c=()=>{a(),o=setTimeout(()=>{E===e&&lo(e,i,{offset:10})},Ee)},p=()=>{s(),c()},h=()=>{E!==e&&s(),c()},v=()=>{a(),E===e&&(E=null,Un())};e.addEventListener("mouseenter",p),e.addEventListener("focus",p),e.addEventListener("pointermove",h),e.addEventListener("mouseleave",v),e.addEventListener("blur",v),e.addEventListener("click",v)}function Cd(){u&&(u=!1,!(!Kt||!zn)&&(Un(),lo(Kt,zn,{offset:12}),kn=setTimeout(()=>{Un(),xd()},1e3)))}function xd(){Kt&&(g&&(clearTimeout(g),g=null),Kt.classList.add("blockscape-tab--twinkle"),g=setTimeout(()=>{Kt.classList.remove("blockscape-tab--twinkle"),g=null},1400))}window.addEventListener("scroll",Un,!0),window.addEventListener("resize",Un),_e&&_e.addEventListener("click",()=>{Yc()}),pe&&pe.addEventListener("click",()=>{Xc()}),$e&&$e.addEventListener("click",()=>{try{jc(),Dc()}catch(e){console.error("[Blockscape] failed to create blank series",e),alert((e==null?void 0:e.message)||"Unable to create a blank map right now.")}}),Re&&Re.addEventListener("click",_a),R&&R.addEventListener("click",_a),d&&d.addEventListener("click",Fo),X&&X.addEventListener("click",Fo),S&&S.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");Gt||!t||!S.contains(t)||Bc(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||$c(e)}),Qe&&Qe.addEventListener("click",()=>{ds("button")}),K&&K.addEventListener("click",()=>{if(w<0){alert("Load or select a model before creating a version.");return}try{const e=cs({versionLabel:"map edit"});kt(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),Le&&Le.addEventListener("click",async()=>{var a;if(w<0||!y[w]){alert("Select or load a model before sharing.");return}const e={title:qe(y[w],"Shared Model"),data:y[w].data};let t;try{t=$l(JSON.stringify(e))}catch(s){console.error("[Blockscape] share encode failed",s),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(s){console.warn("[Blockscape] failed to update URL for share",s),window.location.hash=n.hash}let o=!1;if((a=navigator.clipboard)!=null&&a.writeText)try{await navigator.clipboard.writeText(i),o=!0}catch(s){console.warn("[Blockscape] clipboard write failed",s)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),G&&G.addEventListener("click",()=>{const e=(f.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};Y&&(n.selectedItemId=Y),localStorage.setItem(P,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";Y&&(t=`editor.html?selected=${encodeURIComponent(Y)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==P||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||ys("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===it&&ys("message")})),document.addEventListener("keydown",e=>{var i,o,a,s,c,p,h,v,x,O;if(Kc()){e.key==="Escape"&&(e.preventDefault(),_a());return}if(!(z!=null&&z.hidden)&&e.key==="Escape"){e.preventDefault(),Fo();return}if((i=pi==null?void 0:pi.isOpen)==null?void 0:i.call(pi))return;const n=Gt;if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const T=y[w],N=((o=T==null?void 0:T.apicurioVersions)==null?void 0:o.length)>1;ds("shortcut",N);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!fi())return;if(Fd()){e.preventDefault();return}}if(e.key==="Escape"){let T=!1;te&&!te.hidden&&(qn(),T=!0),(Y||Ke)&&(Ji(),T=!0),T&&e.preventDefault()}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(n||!fi())return;const T=e.key==="ArrowLeft"?-1:1;if(e.altKey)return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){xa(T)&&e.preventDefault();return}if(e.ctrlKey||e.metaKey)return;if(Ke&&!e.shiftKey){e.preventDefault();return}e.shiftKey?Rd(T)&&e.preventDefault():Pd(T)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(n||!fi())return;const T=e.key==="ArrowUp"?-1:1;if((e.ctrlKey||e.metaKey)&&!e.altKey){Hd(T)&&e.preventDefault();return}if(e.altKey)return;if(Ke&&!Y&&!e.shiftKey){if(Dd(T)){e.preventDefault();return}if(bd(T)){e.preventDefault();return}}e.shiftKey?Ud(T)&&e.preventDefault():Vd(T)&&e.preventDefault()}if(e.key==="Delete"){if(n||!fi()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const T=Ke?Jd():!1,N=T?!0:Ms();(T||N)&&e.preventDefault()}if(e.key==="F2"){if(n||!fi())return;const T=Ke&&!Y&&Ke||!Y&&((p=(c=(s=(a=e.target)==null?void 0:a.closest)==null?void 0:s.call(a,".category"))==null?void 0:c.dataset)==null?void 0:p.cat)||null;if(T&&!Y&&Od(T)){e.preventDefault();return}const N=Y||((O=(x=(v=(h=e.target)==null?void 0:h.closest)==null?void 0:v.call(h,".tile"))==null?void 0:x.dataset)==null?void 0:O.id);N&&pi.open(N)&&e.preventDefault()}if(e.key==="Insert"){if(n||!fi()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;Ns()&&e.preventDefault()}}),window.addEventListener("resize",()=>{Oc()}),window.addEventListener("scroll",()=>Rc(),!0);let Kn=null,co=null;function Ad(e){if(Gt){e.preventDefault();return}qn(),Kn=e.target.dataset.id,co=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:Kn,categoryId:co})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",Kn,"from",co)}function Td(e){e.target.classList.remove("dragging"),S.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),S.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),Kn=null,co=null}function Ld(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function Nd(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function Md(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function Bd(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!Kn||!i)return;const a=Array.from(t.querySelectorAll(".tile")).filter(s=>s.dataset.id!==Kn).find(s=>{const c=s.getBoundingClientRect();return e.clientY<c.top+c.height/2});Ls(Kn,a?a.dataset.id:null,i),Wi(),console.log("[Blockscape] drop completed",Kn,"from",co,"to",i)}function Ls(e,t,n){if(w<0)return;const o=y[w].data.categories||[],a=o.find(v=>(v.items||[]).some(x=>x.id===e)),s=o.find(v=>v.id===n);if(!a||!s)return;a.items=a.items||[],s.items=s.items||[];const c=a.items.findIndex(v=>v.id===e);if(c===-1)return;const[p]=a.items.splice(c,1);let h=s.items.length;if(t){const v=s.items.findIndex(x=>x.id===t);v!==-1&&(h=v)}s.items.splice(h,0,p),Pt(),Lt()}function $d(e){if(w<0||!e)return;const t=y[w].data,i=(t.categories||[]).find(p=>p.id===e);if(!i)return;i.items=i.items||[];const o=`New item ${i.items.length+1}`,s={id:Tc(`${e}-${i.items.length+1}`,t),name:o,deps:[]};i.items.push(s),Pt(),Lt(),qn(),Tt(s.id);const c=Te.get(s.id);c!=null&&c.el&&c.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",s.id,"to",e)}function Ns(){if(w<0)return!1;const e=y[w].data;e.categories=e.categories||[];const t=`New category ${e.categories.length+1}`,n=Lc(t,e),i={id:n,title:t,items:[]};return e.categories.push(i),Ke=n,Y=null,ft=null,ct=null,Pt(),Lt(),Dn(n),console.log("[Blockscape] added category",n),!0}function Od(e=ro()){if(w<0||!e)return!1;const t=Mc.open(e);return t&&(Y=null,ft=null,Jt()),t}function Rd(e){if(!Y||w<0||!e)return!1;const n=y[w].data.categories||[],i=Te.get(Y);let o=null;if(i!=null&&i.catId&&(o=n.find(p=>p.id===i.catId)),o||(o=n.find(p=>(p.items||[]).some(h=>h.id===Y))),!o)return!1;o.items=o.items||[];const a=o.items.findIndex(p=>p.id===Y);if(a===-1)return!1;const s=a+e;if(s<0||s>=o.items.length)return!1;const[c]=o.items.splice(a,1);return o.items.splice(s,0,c),Pt(),Lt(),Wi(),Tt(Y),!0}function Pd(e){if(!q||!q.m||!e)return!1;const t=q.m.categories||[];if(!t.length)return!1;const n=()=>{const p=t.find(h=>(h.items||[]).length);return p?{category:p,item:p.items[0]}:null};if(!Y){const p=n();return p?(Tt(p.item.id),!0):!1}const i=Te.get(Y);let o=null;if(i!=null&&i.catId&&(o=t.find(p=>p.id===i.catId)),o||(o=t.find(p=>(p.items||[]).some(h=>h.id===Y))),!o){const p=n();return p?(Tt(p.item.id),!0):!1}const a=o.items||[];if(!a.length)return!1;const s=a.findIndex(p=>p.id===Y);if(s===-1)return!1;const c=s+e;return c<0||c>=a.length?!1:(Tt(a[c].id),!0)}function Vd(e){if(!q||!q.m||!e)return!1;const t=q.m.categories||[];if(!t.length)return!1;const n=ro();let i=t.findIndex(s=>s.id===n),o=i+e;if(i===-1&&(o=e>0?0:t.length-1),o<0||o>=t.length)return!1;const a=t[o];if(Y){const c=(t[i].items||[]).findIndex(p=>p.id===Y);ct={catId:a.id,position:c===-1?0:c}}else ct=null;return Dn(a.id,{preserveEntryHint:!0})}function Dd(e){var a;if(!Ke||!((a=q==null?void 0:q.m)!=null&&a.categories)||!e)return!1;const n=(q.m.categories||[]).find(s=>s.id===Ke);if(!n)return!1;const i=n.items||[];if(!i.length)return!1;let o=e>0?0:Math.max(0,i.length-1);return(ct==null?void 0:ct.catId)===n.id&&(o=Math.min(i.length-1,Math.max(0,ct.position||0))),ct=null,Tt(i[o].id),!0}function Ud(e){if(!Y||w<0||!e)return!1;const n=y[w].data.categories||[];if(!n.length)return!1;const i=Te.get(Y);let o=-1;if(i!=null&&i.catId&&(o=n.findIndex(x=>x.id===i.catId)),o===-1&&(o=n.findIndex(x=>(x.items||[]).some(O=>O.id===Y))),o===-1)return!1;const a=o+e;if(a<0||a>=n.length)return!1;const s=n[o],c=n[a];if(!c)return!1;s.items=s.items||[],c.items=c.items||[];const p=s.items.findIndex(x=>x.id===Y);if(p===-1)return!1;const h=Math.min(c.items.length,Math.max(0,p)),v=h<c.items.length?c.items[h].id:null;return Ls(Y,v,c.id),Wi(),Tt(Y),!0}function Hd(e){if(w<0||!e)return!1;const n=y[w].data.categories||[];if(!n.length)return!1;const i=ro();if(!i)return!1;const o=n.findIndex(c=>c.id===i);if(o===-1)return!1;const a=o+e;if(a<0||a>=n.length)return!1;const[s]=n.splice(o,1);return n.splice(a,0,s),Ke=s.id,Aa(),ct=null,Jt(),Pt(),Lt(),ji(),console.log("[Blockscape] moved category",s.id,"from",o,"to",a),!0}function Fd(){if(w<0)return!1;const e=y[w],t=mt(e)||(e?e.id:null),n=[];if(wt&&t===wt.modelId&&n.push({...wt,type:"item"}),yn&&t===yn.modelId&&n.push({...yn,type:"category"}),!n.length)return!1;const i=n.reduce((o,a)=>o?(a.ts||0)>(o.ts||0)?a:o:a,null);if(!i)return!1;if(i.type==="category"){if(jd(i))return!0}else if(i.type==="item"&&Wd(i))return!0;return!1}function Wd(e){const t=y[w],n=mt(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const a=(t.data.categories||[]).find(c=>c.id===e.categoryId);if(!a)return!1;a.items=a.items||[];const s=Math.min(Math.max(e.index,0),a.items.length);return a.items.splice(s,0,e.item),wt=null,qn(),Y=null,ft=null,Jt(),Pt(),Lt(),Wi(),Tt(e.item.id),console.log("[Blockscape] undo delete restored",e.item.id),!0}function jd(e){const t=y[w],n=mt(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const i=t.data;i.categories=i.categories||[];const o=Math.min(Math.max(e.index,0),i.categories.length);return i.categories.splice(o,0,e.category),yn=null,Y=null,ft=null,Ke=e.category.id,ct=null,Jt(),Pt(),Lt(),ji(),Dn(e.category.id),console.log("[Blockscape] undo delete restored category",e.category.id),!0}function Ms(){if(!Y||w<0)return!1;const t=y[w].data.categories||[];if(!t.length)return!1;const n=Te.get(Y);let i=null;if(n!=null&&n.catId&&(i=t.find(h=>h.id===n.catId)),i||(i=t.find(h=>(h.items||[]).some(v=>v.id===Y))),!i||!Array.isArray(i.items))return!1;const o=i.items.findIndex(h=>h.id===Y);if(o===-1)return!1;const a=i.items.splice(o,1)[0];if(!a)return!1;const s=y[w];wt={item:a,categoryId:i.id,index:o,modelId:mt(s)||(s?s.id:null),ts:Date.now()};const p=(()=>{var v;if(i.items.length){const x=Math.min(o,i.items.length-1);return((v=i.items[x])==null?void 0:v.id)||null}const h=t.findIndex(x=>x.id===i.id);if(h===-1)return null;for(let x=h+1;x<t.length;x++){const O=t[x].items||[];if(O.length)return O[0].id}for(let x=h-1;x>=0;x--){const O=t[x].items||[];if(O.length)return O[0].id}return null})();return qn(),Y=null,ft=null,ct=null,Jt(),Pt(),Lt(),Wi(),p?Tt(p):Ji(),console.log("[Blockscape] removed item",a.id),!0}function Jd(){var c,p;const e=ro();if(!e||w<0)return!1;const n=y[w].data.categories||[];if(!n.length)return!1;const i=n.findIndex(h=>h.id===e);if(i===-1)return!1;const[o]=n.splice(i,1);if(!o)return!1;const a=y[w];yn={category:o,index:i,modelId:mt(a)||(a?a.id:null),ts:Date.now()},Ke=null,Y=null,ft=null,ct=null,Jt(),Pt(),Lt();const s=((c=n[i])==null?void 0:c.id)||((p=n[i-1])==null?void 0:p.id)||null;return s?Dn(s):Ji(),console.log("[Blockscape] removed category",o.id),!0}function zd(e){if(!e)return!1;const t=Y;Y=e;const n=Ms();return n||(Y=t,Jt()),n}ye&&ye.addEventListener("click",async()=>{const e=f.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await Jr(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),M&&M.addEventListener("click",async()=>{const e=Uc();if(!e){alert("No series available to copy. Create another version first.");return}await Jr(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),Ne&&Ne.addEventListener("click",async()=>{try{const e=await ql();if(!e){alert("Clipboard is empty.");return}f.value=e,f.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=async()=>{try{const e=await ao(),t=Pn(f.value,"Pasted",{promptForSeriesName:!e});if(!t.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",t.length,"model(s)");let n=null;const i=[];t.forEach((o,a)=>{const s=An(o,{versionLabel:t.length>1?`paste #${a+1}`:"paste"});n==null&&(n=s),i.push(s)}),w===-1&&n!=null?kt(n):Rn(),e&&await Bs(i,{origin:"append"})}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(w<0){alert("No active model selected.");return}try{const t=JSON.parse(f.value);if(xn(t,{titleHint:qe(y[w]),idHint:mt(y[w])||qe(y[w])}),y[w].data=t,y[w].title=t.title||y[w].title,y[w].isSeries||((e=y[w].apicurioVersions)==null?void 0:e.length)>1){const n=y[w].title||qe(y[w]);Bt(y[w],{seriesName:n,fallbackTitle:n})}Ea(),console.log("[Blockscape] replaced active model:",qe(y[w])),Lt(),Oe.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const o=await i.text(),a=i.name.replace(/\.[^.]+$/,"")||"File",s=Pn(o,a,{seriesTitleOverride:`${a} series`});if(!s.length){console.warn("[Blockscape] no models in file:",i.name);continue}s.forEach((c,p)=>{var $;const h=((($=c.data)==null?void 0:$.title)??"").toString().trim(),v=s.length>1?`${i.name} #${p+1}`:i.name,x=`${a} series`,O=c.isSeries?x:null;let T={...c};if(c.isSeries){const ae=O||h||c.title||v||"unknown";T.title=ae;const Be=wn(ae||"unknown");ui(T,Be),Bt(T,{seriesName:ae,fallbackTitle:"unknown"}),T.apicurioArtifactName=T.apicurioArtifactName||ae}else T.title=h||v;const N=An({...T,apicurioArtifactName:T.apicurioArtifactName||O||T.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=N)})}w===-1&&n!=null?kt(n):Rn()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",qd);async function qd(e){var a;if(!fi())return;const t=((a=e.clipboardData)==null?void 0:a.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!ad(t))return;let n=[];try{const s=await ao();n=Pn(t,"Clipboard",{promptForSeriesName:!s})}catch(s){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",s);return}if(!n.length)return;e.preventDefault();let i=null;const o=[];n.forEach((s,c)=>{const p=An(s,{versionLabel:n.length>1?`paste #${c+1}`:"paste"});i==null&&(i=p),o.push(p)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&kt(i),await ao()&&await Bs(o,{origin:"clipboard"})}async function Bs(e,{origin:t="clipboard"}={}){if(!await ao()||typeof(Ye==null?void 0:Ye.saveModelByIndex)!="function")return;const i=(Array.isArray(e)?e:[]).filter(O=>{const T=y[O];return T&&!T.sourcePath});if(!i.length)return;const o=i.length===1?"model":"models",a=y[i[0]],s=Zl(a,t==="append"?"pasted":"clipboard");if(typeof window>"u"||typeof window.prompt!="function")return;const c=window.prompt(`Save pasted ${o} as a new .bs file (under ~/blockscape):`,s);if(c==null)return;const p=di(c);if(!p){alert("Enter a relative filename (no ..) to save under ~/blockscape.");return}const h=await Yl(),v=[];for(let O=0;O<i.length;O++){const T=i.length===1?p:Kl(p,O+1),N=Xl(T,h);if(!N){alert("Could not find a unique filename to save.");return}h.add(N),v.push(N)}let x=null;for(let O=0;O<i.length;O++){const T=i[O],N=v[O],$=y[T];if(!$)continue;i.length===1&&Ql($,N);const ae=await Ye.saveModelByIndex(T,N,{refreshAfter:!1,statusPrefix:"Auto-saved to"});if(!(ae!=null&&ae.ok)){alert(`Local auto-save failed: ${(ae==null?void 0:ae.error)||"unknown error"}`);return}x==null&&(x=N)}x&&Po(x),await Ye.refresh(),Rn(),On(`Saved ${i.length} ${o}.`,2500)}j.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&kt(n)}),document.getElementById("removeModel").onclick=()=>{if(w<0)return;const e=qe(y[w]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",qe(y[w])),y.splice(w,1),!y.length){w=-1,q=null,S.innerHTML="",F.innerHTML="",f.value="",Rn(),Ea();return}const n=Math.min(w,y.length-1);kt(n)},me&&(me.addEventListener("input",e=>{hs(e.target.value||"")}),me.addEventListener("focus",()=>{me.value&&me.value.trim()&&ms(me.value)})),he&&he.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;ed({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!he||he.hidden)return;const t=e.target;he.contains(t)||me&&(t===me||me.contains(t))||(he.hidden=!0)}),_&&ie&&U&&_.addEventListener("submit",async e=>{e.preventDefault();const t=ie.value.trim();if(!t){alert("Please enter a URL"),ie.focus();return}const n=await La(t);if(typeof n=="number"){kt(n),ie.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!ie||!t)return;let n=null;ie.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=ie.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function Lt(){if(!(w<0))try{Wo(y[w]),q=cd(y[w].data),Wi()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function Gd(){const e=["comms.bs","planets.bs","styleguide.bs","blockscape-features.bs"],t=n=>No?No.endsWith("/")?`${No}${n}`:`${No}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const o=await i.text(),a=n.replace(/\.[^.]+$/,"")||"Model",s=Pn(o,a,{seriesTitleOverride:`${a} series`});if(!s.length){console.warn("[Blockscape] no models found in",n);continue}s.forEach(c=>{let p={...c};if(c.isSeries){const h=`${a} series`;p={...c,title:h,apicurioArtifactName:h};const v=wn(h||"unknown");ui(p,v),Bt(p,{seriesName:h,fallbackTitle:"unknown"})}An(p,{versionLabel:n})}),console.log(`[Blockscape] loaded ${s.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}Rn()}async function $s(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const o=await fetch(e,i);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function Kd(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>Yd(i)),e.querySelectorAll("a[href]").forEach(i=>{const o=i.getAttribute("href");Rs(o)&&Os(i,o)})}function Yd(e){var c,p;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(p=(c=e.parentNode)==null?void 0:c.closest)!=null&&p.call(c,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let o;for(;(o=n.exec(t))!==null;)i.push({url:o[0],index:o.index});if(!i.length)return;const a=document.createDocumentFragment();let s=0;i.forEach(({url:h,index:v})=>{v>s&&a.appendChild(document.createTextNode(t.slice(s,v))),a.appendChild(Xd(h)),s=v+h.length}),s<t.length&&a.appendChild(document.createTextNode(t.slice(s))),e.parentNode.replaceChild(a,e)}function Xd(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",Rs(e)&&Os(t,e),t}function Os(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>Zd(n,t,e)))}async function Zd(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await La(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function Rs(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function La(e){try{console.log("[Blockscape] loading from URL:",e);const t=await $s(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=Pn(t,i)}catch(s){throw new Error(`Invalid JSON payload: ${s.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let a=null;return o.forEach((s,c)=>{var T;const p=(((T=s.data)==null?void 0:T.title)??"").toString().trim(),h=o.length>1?`${i} #${c+1}`:i,v=s.isSeries?`${i} series`:null;let x={...s};if(s.isSeries){const N=v||p||x.title||h;x={...s,title:N,apicurioArtifactName:N||s.apicurioArtifactName};const $=wn(N||"unknown");ui(x,$),Bt(x,{seriesName:N||v||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:$,url:e,baseName:i,seriesTitle:N})}const O=An({...x,title:p||x.title||h,apicurioArtifactName:x.apicurioArtifactName||v||s.apicurioArtifactName},{versionLabel:i});a==null&&(a=O)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,i),w===-1&&a!=null?kt(a):Rn(),a}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=Pn(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let o=null;i.forEach(T=>{const N=An(T,{versionLabel:"seed"});o==null&&(o=N)}),await Pl(),!await Vr&&l.autoLoadFromDir&&await Gd();const s=await sd(),c=typeof(s==null?void 0:s.modelIndex)=="number"?s.modelIndex:null,p=await ld(),h=vs(),v=h==null?void 0:h.index,x=rd(),O=typeof c=="number"?c:typeof p=="number"?p:typeof x=="number"?x:typeof v=="number"?v:o??0;kt(O),s!=null&&s.itemId&&typeof s.modelIndex=="number"&&s.modelIndex===O&&requestAnimationFrame(()=>{var N;if(w!==s.modelIndex)return;const T=(N=Te.get(s.itemId))==null?void 0:N.el;T&&(Tt(s.itemId),T.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),T.focus({preventScroll:!0}))})})()}function wl(r){let l;return{c(){l=D("div"),l.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Open the <a href="./documentation/">documentation</a>.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',b(l,"id","shortcutHelp"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","shortcutHelpTitle")},m(f,C){St(f,l,C)},p:At,i:At,o:At,d(f){f&&bt(l)}}}class vl extends To{constructor(l){super(),Ao(this,l,null,wl,Io,{})}}const yl=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: optional string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * optional \`deps\`: array of item \`id\`s this item **depends on** (when present, must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet, optional]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\` and \`title\` are present and non-empty; if \`abstract\` is provided, it is non-empty.
* All provided \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\`
`;function wr(r){let l,f,C,S,F,Q,j,te;return{c(){l=D("div"),f=D("div"),C=D("a"),S=na("Open Blockscape GPT"),F=le(),Q=D("div"),Q.textContent="Paste the copied prompt into that chat.",j=le(),te=D("div"),te.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',b(C,"href",Sl),b(C,"target","_blank"),b(C,"rel","noreferrer"),b(Q,"class","new-panel__hint"),b(f,"class","new-panel__link"),b(te,"class","new-panel__link new-panel__link--disabled"),b(l,"class","new-panel__links")},m(_,ie){St(_,l,ie),k(l,f),k(f,C),k(C,S),k(f,F),k(f,Q),k(l,j),k(l,te)},p:At,d(_){_&&bt(l)}}}function vr(r){let l,f,C,S,F,Q;return{c(){l=D("div"),f=D("div"),f.textContent="Generated prompt",C=le(),S=D("textarea"),b(f,"class","new-panel__prompt-label"),b(S,"class","pf-v5-c-form-control new-panel__textarea"),b(S,"rows","4"),S.readOnly=!0,b(l,"class","new-panel__prompt")},m(j,te){St(j,l,te),k(l,f),k(l,C),k(l,S),ii(S,r[4]),F||(Q=ni(S,"input",r[12]),F=!0)},p(j,te){te&16&&ii(S,j[4])},d(j){j&&bt(l),F=!1,Q()}}}function El(r){let l,f,C,S,F,Q,j,te,_,ie,U,oe,ke,st,Ze,Qe,Le,K,G,ye,M,Ne,_e,pe,$e,fe,ve,Re,R,z,d,X,me,he,ge,et,Ce,Ve,tt,ze,lt,vt,Ge,P,it,Ht,y,w=r[2]==="gpt"&&wr(),Oe=r[4]&&r[5]&&vr(r);return it=Ks(r[10][0]),{c(){l=D("div"),f=D("div"),C=le(),S=D("div"),F=D("div"),F.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',Q=le(),j=D("form"),te=D("div"),_=D("label"),_.textContent="Domain",ie=le(),U=D("p"),U.textContent="Describe what you want to create a map for.",oe=le(),ke=D("textarea"),st=le(),Ze=D("div"),Qe=D("label"),Le=D("input"),K=le(),G=D("span"),G.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,ye=le(),M=D("fieldset"),Ne=D("legend"),Ne.textContent="Target",_e=le(),pe=D("p"),pe.textContent="Choose where you plan to use the prompt.",$e=le(),fe=D("label"),ve=D("input"),Re=le(),R=D("div"),R.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',z=le(),d=D("label"),X=D("input"),me=le(),he=D("div"),he.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',ge=le(),et=D("div"),Ce=D("button"),Ce.textContent="Copy prompt",Ve=le(),tt=D("button"),tt.textContent="New blank",ze=le(),lt=D("div"),vt=na(r[3]),Ge=le(),w&&w.c(),P=le(),Oe&&Oe.c(),b(f,"id","newPanelBackdrop"),b(f,"class","shortcut-help__backdrop"),b(F,"class","shortcut-help__header"),b(_,"for","newDomain"),b(U,"class","new-panel__hint"),b(ke,"id","newDomain"),b(ke,"class","pf-v5-c-form-control new-panel__textarea"),b(ke,"rows","4"),ke.required=!0,b(ke,"placeholder","Ex: Companies building open-source geospatial tools"),b(te,"class","new-panel__field"),b(Le,"id","seriesToggle"),b(Le,"type","checkbox"),b(Qe,"class","new-panel__toggle"),b(Qe,"for","seriesToggle"),b(Ze,"class","new-panel__field"),b(pe,"class","new-panel__hint"),b(ve,"type","radio"),b(ve,"name","target"),ve.__value="gpt",ii(ve,ve.__value),b(fe,"class","new-panel__option"),b(X,"type","radio"),b(X,"name","target"),X.__value="plain",ii(X,X.__value),b(d,"class","new-panel__option"),b(M,"class","new-panel__field"),b(Ce,"class","pf-v5-c-button pf-m-primary"),b(Ce,"type","submit"),b(tt,"id","newBlankButton"),b(tt,"class","pf-v5-c-button pf-m-secondary"),b(tt,"type","button"),b(tt,"title","Start from an empty map"),b(lt,"class","new-panel__status"),b(lt,"aria-live","polite"),b(et,"class","new-panel__actions"),b(j,"class","shortcut-help__list new-panel__form"),b(S,"class","shortcut-help__panel"),b(S,"tabindex","-1"),b(l,"id","newPanel"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","newPanelTitle"),it.p(ve,X)},m(q,Te){St(q,l,Te),k(l,f),k(l,C),k(l,S),k(S,F),k(S,Q),k(S,j),k(j,te),k(te,_),k(te,ie),k(te,U),k(te,oe),k(te,ke),ii(ke,r[0]),k(j,st),k(j,Ze),k(Ze,Qe),k(Qe,Le),Le.checked=r[1],k(Qe,K),k(Qe,G),k(j,ye),k(j,M),k(M,Ne),k(M,_e),k(M,pe),k(M,$e),k(M,fe),k(fe,ve),ve.checked=ve.__value===r[2],k(fe,Re),k(fe,R),k(M,z),k(M,d),k(d,X),X.checked=X.__value===r[2],k(d,me),k(d,he),k(j,ge),k(j,et),k(et,Ce),k(et,Ve),k(et,tt),k(et,ze),k(et,lt),k(lt,vt),k(j,Ge),w&&w.m(j,null),k(j,P),Oe&&Oe.m(j,null),Ht||(y=[ni(ke,"input",r[7]),ni(Le,"change",r[8]),ni(ve,"change",r[9]),ni(X,"change",r[11]),ni(j,"submit",Gs(r[6]))],Ht=!0)},p(q,[Te]){Te&1&&ii(ke,q[0]),Te&2&&(Le.checked=q[1]),Te&4&&(ve.checked=ve.__value===q[2]),Te&4&&(X.checked=X.__value===q[2]),Te&8&&Xs(vt,q[3]),q[2]==="gpt"?w?w.p(q,Te):(w=wr(),w.c(),w.m(j,P)):w&&(w.d(1),w=null),q[4]&&q[5]?Oe?Oe.p(q,Te):(Oe=vr(q),Oe.c(),Oe.m(j,null)):Oe&&(Oe.d(1),Oe=null)},i:At,o:At,d(q){q&&bt(l),w&&w.d(),Oe&&Oe.d(),it.r(),Ht=!1,Yi(y)}}}const Sl="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function Il(r,l,f){let C="",S=!1,F="gpt",Q="",j="",te=!1;const _=()=>{var K;return typeof navigator<"u"&&!!((K=navigator.clipboard)!=null&&K.writeText)};function ie(K){const G=K||"[DOMAIN]",ye=S?"series":"map",Ne=yl.replaceAll("[DOMAIN NAME]",G).replaceAll("[DOMAIN]",G).replaceAll("[map|series]",ye).split(`
`),_e=`Generate a **blockscape ${ye}** for the domain of ${G}.`,pe=Ne.findIndex(fe=>fe.toLowerCase().includes("generate a **blockscape value")||fe.toLowerCase().includes("generate a blockscape [map|series]")||fe.toLowerCase().startsWith("generate a blockscape"));pe>=0?Ne[pe]=_e:Ne.unshift(_e);const $e=S?`

User requested a series (return an array of models).`:"";return`${Ne.join(`
`).trim()}${$e}`}async function U(K){K.preventDefault();const G=C.trim();if(f(3,Q=""),f(5,te=F!=="gpt"),!G){f(3,Q="Add a domain to generate a prompt."),f(4,j="");return}if(F==="gpt"?f(4,j=`${S?"Create a series":"Create a map"} for ${G}`):(f(4,j=ie(G)),f(5,te=!0)),!_()){f(3,Q="Clipboard access is unavailable. Copy the prompt below."),f(5,te=!0);return}try{await navigator.clipboard.writeText(j),f(3,Q=F==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),F==="gpt"&&f(5,te=!1)}catch(M){console.warn("[Blockscape] clipboard write failed",M),f(3,Q="Copy failed. Use the prompt below."),f(5,te=!0)}}const oe=[[]];function ke(){C=this.value,f(0,C)}function st(){S=this.checked,f(1,S)}function Ze(){F=this.__value,f(2,F)}function Qe(){F=this.__value,f(2,F)}function Le(){j=this.value,f(4,j)}return[C,S,F,Q,j,te,U,ke,st,Ze,oe,Qe,Le]}class kl extends To{constructor(l){super(),Ao(this,l,Il,El,Io,{})}}const{document:yr}=qs;function _l(r){let l,f,C,S,F,Q,j,te,_,ie,U,oe,ke,st,Ze,Qe,Le,K,G,ye,M,Ne,_e,pe,$e,fe,ve,Re,R,z,d,X,me,he,ge,et,Ce,Ve,tt,ze,lt,vt,Ge,P,it,Ht,y,w,Oe,q,Te,pt,Y,Ke,ft,ct,vn,Gt,Ft,Jn,wt,yn,Nn,ai,In,$t,rn,Xt,sn,yt,Ot,Zt,kn,Kt,zn=`<script id="seed" type="application/json">${r[4]}<\/script>`,u,g,L,A,E,B,ee,J,Ee,de,be,Me,We,xe,Rt;return de=new vl({}),Me=new kl({}),{c(){l=D("link"),f=le(),C=D("div"),S=D("header"),F=D("div"),Q=D("div"),j=D("div"),te=D("div"),te.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',_=le(),ie=D("div"),U=D("div"),oe=D("button"),ke=D("span"),ke.textContent="Toggle search and edit tools",st=le(),Ze=D("span"),Ze.textContent="▾",Qe=le(),Le=D("button"),Le.textContent="New",K=le(),G=D("form"),G.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',ye=le(),M=D("label"),M.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',Ne=le(),_e=D("button"),_e.textContent="Help",pe=le(),$e=D("div"),fe=D("div"),fe.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',ve=le(),Re=D("button"),Re.textContent="Edit",R=le(),z=D("button"),z.textContent="Share",he=le(),ge=D("div"),ge.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',Ce=le(),Ve=D("main"),tt=D("div"),ze=D("aside"),lt=D("div"),lt.textContent="Models",vt=le(),Ge=D("ul"),P=le(),it=D("div"),it.innerHTML='<button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button>',Ht=le(),y=D("section"),w=D("div"),w.textContent="Local files",Oe=le(),q=D("p"),q.textContent="Checking for local server…",Te=le(),pt=D("div"),Y=D("label"),Y.textContent="Blockscape files under ~/blockscape",Ke=le(),ft=D("div"),ct=D("label"),ct.textContent="Folder",vn=le(),Gt=D("select"),Ft=D("option"),Ft.textContent="All (~/blockscape)",Jn=le(),wt=D("select"),yn=le(),Nn=D("div"),Nn.innerHTML='<button id="refreshLocalFiles" class="pf-v5-c-button pf-m-tertiary" type="button">Refresh</button> <button id="loadLocalFile" class="pf-v5-c-button pf-m-secondary" type="button">Load</button>',ai=le(),In=D("div"),In.innerHTML='<label for="localSavePath">Save active map to ~/blockscape</label> <input id="localSavePath" class="pf-v5-c-form-control" type="text" placeholder="my-map.bs"/> <div class="local-backend__save-actions"><button id="saveLocalFile" class="pf-v5-c-button pf-m-primary" type="button">Save</button> <button id="saveLocalFileAs" class="pf-v5-c-button pf-m-secondary" type="button">Save as</button></div>',rn=le(),Xt=D("div"),Xt.innerHTML=`<section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,deps?:[],logo?,external?:url,color?,...}}], ... }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section>`,sn=le(),yt=D("footer"),Ot=D("div"),Ot.innerHTML='<a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a>',kn=le(),Kt=new Zs(!1),u=le(),g=cr("svg"),L=le(),A=D("div"),E=le(),B=D("div"),ee=le(),J=D("div"),J.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',Ee=le(),sa(de.$$.fragment),be=le(),sa(Me.$$.fragment),yr.title="Blockscape — simple landscape-style tiles",b(l,"rel","icon"),b(l,"type","image/svg+xml"),b(l,"href","./favicon.svg"),b(te,"class","blockscape-brand"),b(ke,"class","sr-only"),b(Ze,"class","blockscape-toolbar__toggle-icon"),b(Ze,"aria-hidden","true"),b(oe,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),b(oe,"type","button"),b(oe,"aria-expanded",r[0]),b(oe,"aria-controls","blockscapeHeaderExtras"),b(Le,"id","newPanelButton"),b(Le,"class","pf-v5-c-button pf-m-primary"),b(Le,"type","button"),b(Le,"title","Create something new"),b(G,"id","urlForm"),b(G,"class","blockscape-url-form"),b(G,"autocomplete","on"),G.noValidate=!0,b(M,"class","pf-v5-c-button pf-m-primary blockscape-file"),b(_e,"id","helpButton"),b(_e,"class","pf-v5-c-button pf-m-primary"),b(_e,"type","button"),b(_e,"title","Show keyboard shortcuts"),b(U,"class","blockscape-toolbar__primary"),b(fe,"class","blockscape-search"),b(Re,"id","openInEditor"),b(Re,"class","pf-v5-c-button pf-m-secondary"),b(Re,"type","button"),b(Re,"title","Open current JSON in the editor"),b(z,"id","shareModel"),b(z,"class","pf-v5-c-button pf-m-secondary"),b(z,"type","button"),b(z,"title","Copy a shareable URL for this model"),b($e,"id","blockscapeHeaderExtras"),b($e,"class","blockscape-toolbar__extras"),$e.hidden=d=!r[0],b($e,"aria-hidden",X=!r[0]),b(ie,"class","blockscape-toolbar__controls"),b(ie,"data-expanded",me=r[0]?"true":"false"),b(ge,"class","blockscape-legend"),b(ge,"role","presentation"),b(j,"class","blockscape-toolbar"),b(Q,"class","pf-v5-c-masthead__content"),b(F,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),b(S,"class","pf-v5-c-page__header"),S.hidden=et=!r[3],b(lt,"class","sidebar-heading"),b(Ge,"id","modelList"),b(Ge,"class","model-nav-list"),b(it,"class","model-actions"),b(w,"class","sidebar-heading"),b(q,"id","localBackendStatus"),b(q,"class","local-backend__status muted"),b(Y,"class","sr-only"),b(Y,"for","localFileList"),b(ct,"for","localDirSelect"),Ft.__value="",ii(Ft,Ft.__value),b(Gt,"id","localDirSelect"),b(Gt,"class","pf-v5-c-form-control"),b(Gt,"aria-label","Folder filter"),b(ft,"class","local-backend__dir"),b(wt,"id","localFileList"),b(wt,"class","pf-v5-c-form-control"),b(wt,"size","12"),wt.multiple=!0,b(wt,"aria-label","Blockscape files on local server"),b(Nn,"class","local-backend__actions"),b(pt,"class","local-backend__list"),b(In,"class","local-backend__save"),b(y,"id","localBackendPanel"),b(y,"class","local-backend"),y.hidden=!0,b(ze,"class","blockscape-sidebar"),b(ze,"aria-label","Models"),ze.hidden=$t=!r[2],b(Xt,"class","blockscape-main"),b(tt,"class","blockscape-content"),b(Ve,"class","pf-v5-c-page__main"),b(Ot,"class","blockscape-footer__inner"),b(yt,"class","pf-v5-c-page__footer blockscape-footer"),yt.hidden=Zt=!r[1],b(C,"class","pf-v5-c-page"),Kt.a=u,b(g,"id","overlay"),b(g,"class","svg-layer"),b(A,"id","tabTooltip"),b(A,"class","blockscape-tab-tooltip"),A.hidden=!0,b(A,"aria-hidden","true"),b(B,"id","tileContextMenu"),b(B,"class","tile-context-menu"),B.hidden=!0,b(B,"aria-hidden","true"),b(J,"id","itemPreview"),b(J,"class","item-preview"),J.hidden=!0,b(J,"aria-hidden","true")},m(ce,Se){k(yr.head,l),St(ce,f,Se),St(ce,C,Se),k(C,S),k(S,F),k(F,Q),k(Q,j),k(j,te),k(j,_),k(j,ie),k(ie,U),k(U,oe),k(oe,ke),k(oe,st),k(oe,Ze),k(U,Qe),k(U,Le),k(U,K),k(U,G),k(U,ye),k(U,M),k(U,Ne),k(U,_e),k(ie,pe),k(ie,$e),k($e,fe),k($e,ve),k($e,Re),k($e,R),k($e,z),k(j,he),k(j,ge),k(C,Ce),k(C,Ve),k(Ve,tt),k(tt,ze),k(ze,lt),k(ze,vt),k(ze,Ge),k(ze,P),k(ze,it),k(ze,Ht),k(ze,y),k(y,w),k(y,Oe),k(y,q),k(y,Te),k(y,pt),k(pt,Y),k(pt,Ke),k(pt,ft),k(ft,ct),k(ft,vn),k(ft,Gt),k(Gt,Ft),k(pt,Jn),k(pt,wt),k(pt,yn),k(pt,Nn),k(y,ai),k(y,In),k(tt,rn),k(tt,Xt),k(C,sn),k(C,yt),k(yt,Ot),St(ce,kn,Se),Kt.m(zn,ce,Se),St(ce,u,Se),St(ce,g,Se),St(ce,L,Se),St(ce,A,Se),St(ce,E,Se),St(ce,B,Se),St(ce,ee,Se),St(ce,J,Se),St(ce,Ee,Se),Co(de,ce,Se),St(ce,be,Se),Co(Me,ce,Se),We=!0,xe||(Rt=ni(oe,"click",r[5]),xe=!0)},p(ce,[Se]){(!We||Se&1)&&b(oe,"aria-expanded",ce[0]),(!We||Se&1&&d!==(d=!ce[0]))&&($e.hidden=d),(!We||Se&1&&X!==(X=!ce[0]))&&b($e,"aria-hidden",X),(!We||Se&1&&me!==(me=ce[0]?"true":"false"))&&b(ie,"data-expanded",me),(!We||Se&8&&et!==(et=!ce[3]))&&(S.hidden=et),(!We||Se&4&&$t!==($t=!ce[2]))&&(ze.hidden=$t),(!We||Se&2&&Zt!==(Zt=!ce[1]))&&(yt.hidden=Zt)},i(ce){We||(_o(de.$$.fragment,ce),_o(Me.$$.fragment,ce),We=!0)},o(ce){ra(de.$$.fragment,ce),ra(Me.$$.fragment,ce),We=!1},d(ce){ce&&(bt(f),bt(C),bt(kn),Kt.d(),bt(u),bt(g),bt(L),bt(A),bt(E),bt(B),bt(ee),bt(J),bt(Ee),bt(be)),bt(l),xo(de,ce),xo(Me,ce),xe=!1,Rt()}}}function Cl(r,l,f){let C,S,F,{seed:Q}=l,{features:j={}}=l;const _=Q?JSON.stringify(Q,null,2):`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let ie=!1;const U=()=>{if(f(0,ie=!ie),!ie){const oe=document.getElementById("search");oe&&oe.value&&(oe.value="",oe.dispatchEvent(new Event("input",{bubbles:!0})))}};return el(()=>{bl(j)}),r.$$set=oe=>{"seed"in oe&&f(6,Q=oe.seed),"features"in oe&&f(7,j=oe.features)},r.$$.update=()=>{r.$$.dirty&128&&f(3,C=j.showHeader!==!1),r.$$.dirty&128&&f(2,S=j.showSidebar!==!1),r.$$.dirty&128&&f(1,F=j.showFooter!==!1)},[ie,F,S,C,_,U,Q,j]}class xl extends To{constructor(l){super(),Ao(this,l,Cl,_l,Io,{seed:6,features:7})}}function Al(r){let l,f;return l=new xl({props:{seed:r[0],features:r[1]}}),{c(){sa(l.$$.fragment)},m(C,S){Co(l,C,S),f=!0},p(C,[S]){const F={};S&1&&(F.seed=C[0]),S&2&&(F.features=C[1]),l.$set(F)},i(C){f||(_o(l.$$.fragment,C),f=!0)},o(C){ra(l.$$.fragment,C),f=!1},d(C){xo(l,C)}}}function Tl(r,l,f){let{seed:C}=l,{features:S={}}=l;return r.$$set=F=>{"seed"in F&&f(0,C=F.seed),"features"in F&&f(1,S=F.features)},[C,S]}class Ll extends To{constructor(l){super(),Ao(this,l,Tl,Al,Io,{seed:0,features:1})}}return Ll}();
