var Is=Object.defineProperty;var xs=(r,l,p)=>l in r?Is(r,l,{enumerable:!0,configurable:!0,writable:!0,value:p}):r[l]=p;var Tt=(r,l,p)=>xs(r,typeof l!="symbol"?l+"":l,p);(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))k(w);new MutationObserver(w=>{for(const B of w)if(B.type==="childList")for(const A of B.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&k(A)}).observe(document,{childList:!0,subtree:!0});function p(w){const B={};return w.integrity&&(B.integrity=w.integrity),w.referrerPolicy&&(B.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?B.credentials="include":w.crossOrigin==="anonymous"?B.credentials="omit":B.credentials="same-origin",B}function k(w){if(w.ep)return;w.ep=!0;const B=p(w);fetch(w.href,B)}})();function xt(){}function Jo(r){return r()}function $o(){return Object.create(null)}function $n(r){r.forEach(Jo)}function jo(r){return typeof r=="function"}function ji(r,l){return r!=r?l==l:r!==l||r&&typeof r=="object"||typeof r=="function"}function Cs(r){return Object.keys(r).length===0}const As=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function x(r,l){r.appendChild(l)}function Ze(r,l,p){r.insertBefore(l,p||null)}function De(r){r.parentNode&&r.parentNode.removeChild(r)}function P(r){return document.createElement(r)}function Wo(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Wi(r){return document.createTextNode(r)}function ie(){return Wi(" ")}function qt(r,l,p,k){return r.addEventListener(l,p,k),()=>r.removeEventListener(l,p,k)}function Ns(r){return function(l){return l.preventDefault(),r.call(this,l)}}function b(r,l,p){p==null?r.removeAttribute(l):r.getAttribute(l)!==p&&r.setAttribute(l,p)}function Ls(r){let l;return{p(...p){l=p,l.forEach(k=>r.push(k))},r(){l.forEach(p=>r.splice(r.indexOf(p),1))}}}function Ts(r){return Array.from(r.childNodes)}function $s(r,l){l=""+l,r.data!==l&&(r.data=l)}function dn(r,l){r.value=l??""}class Bs{constructor(l=!1){Tt(this,"is_svg",!1);Tt(this,"e");Tt(this,"n");Tt(this,"t");Tt(this,"a");this.is_svg=l,this.e=this.n=null}c(l){this.h(l)}m(l,p,k=null){this.e||(this.is_svg?this.e=Wo(p.nodeName):this.e=P(p.nodeType===11?"TEMPLATE":p.nodeName),this.t=p.tagName!=="TEMPLATE"?p:p.content,this.c(l)),this.i(k)}h(l){this.e.innerHTML=l,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(l){for(let p=0;p<this.n.length;p+=1)Ze(this.t,this.n[p],l)}p(l){this.d(),this.h(l),this.i(this.a)}d(){this.n.forEach(De)}}let Tn;function Nn(r){Tn=r}function Ms(){if(!Tn)throw new Error("Function called outside component initialization");return Tn}function Os(r){Ms().$$.on_mount.push(r)}const ln=[],Bo=[];let un=[];const Mo=[],Ps=Promise.resolve();let Ui=!1;function Rs(){Ui||(Ui=!0,Ps.then(qo))}function Hi(r){un.push(r)}const Oi=new Set;let an=0;function qo(){if(an!==0)return;const r=Tn;do{try{for(;an<ln.length;){const l=ln[an];an++,Nn(l),Vs(l.$$)}}catch(l){throw ln.length=0,an=0,l}for(Nn(null),ln.length=0,an=0;Bo.length;)Bo.pop()();for(let l=0;l<un.length;l+=1){const p=un[l];Oi.has(p)||(Oi.add(p),p())}un.length=0}while(ln.length);for(;Mo.length;)Mo.pop()();Ui=!1,Oi.clear(),Nn(r)}function Vs(r){if(r.fragment!==null){r.update(),$n(r.before_update);const l=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,l),r.after_update.forEach(Hi)}}function Us(r){const l=[],p=[];un.forEach(k=>r.indexOf(k)===-1?l.push(k):p.push(k)),p.forEach(k=>k()),un=l}const ii=new Set;let Hs;function Di(r,l){r&&r.i&&(ii.delete(r),r.i(l))}function Oo(r,l,p,k){if(r&&r.o){if(ii.has(r))return;ii.add(r),Hs.c.push(()=>{ii.delete(r)}),r.o(l)}}function Po(r){r&&r.c()}function Fi(r,l,p){const{fragment:k,after_update:w}=r.$$;k&&k.m(l,p),Hi(()=>{const B=r.$$.on_mount.map(Jo).filter(jo);r.$$.on_destroy?r.$$.on_destroy.push(...B):$n(B),r.$$.on_mount=[]}),w.forEach(Hi)}function Ji(r,l){const p=r.$$;p.fragment!==null&&(Us(p.after_update),$n(p.on_destroy),p.fragment&&p.fragment.d(l),p.on_destroy=p.fragment=null,p.ctx=[])}function Ds(r,l){r.$$.dirty[0]===-1&&(ln.push(r),Rs(),r.$$.dirty.fill(0)),r.$$.dirty[l/31|0]|=1<<l%31}function qi(r,l,p,k,w,B,A=null,v=[-1]){const H=Tn;Nn(r);const G=r.$$={fragment:null,ctx:[],props:B,update:xt,not_equal:w,bound:$o(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(H?H.$$.context:[])),callbacks:$o(),dirty:v,skip_bound:!1,root:l.target||H.$$.root};A&&A(G.root);let oe=!1;if(G.ctx=p?p(r,l.props||{},(D,ce,...le)=>{const Ae=le.length?le[0]:ce;return G.ctx&&w(G.ctx[D],G.ctx[D]=Ae)&&(!G.skip_bound&&G.bound[D]&&G.bound[D](Ae),oe&&Ds(r,D)),ce}):[],G.update(),oe=!0,$n(G.before_update),G.fragment=k?k(G.ctx):!1,l.target){if(l.hydrate){const D=Ts(l.target);G.fragment&&G.fragment.l(D),D.forEach(De)}else G.fragment&&G.fragment.c();l.intro&&Di(r.$$.fragment),Fi(r,l.target,l.anchor),qo()}Nn(H)}class Gi{constructor(){Tt(this,"$$");Tt(this,"$$set")}$destroy(){Ji(this,1),this.$destroy=xt}$on(l,p){if(!jo(p))return xt;const k=this.$$.callbacks[l]||(this.$$.callbacks[l]=[]);return k.push(p),()=>{const w=k.indexOf(p);w!==-1&&k.splice(w,1)}}$set(l){this.$$set&&!Cs(l)&&(this.$$.skip_bound=!0,this.$$set(l),this.$$.skip_bound=!1)}}const Fs="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Fs);const Ro="blockscape:apicurioConfig",Pi="http://localhost:8080/apis/registry/v3",ti="bs",Vo="-series",Ri=!1,Vi=!1;function Js({models:r,getActiveIndex:l,setActive:p,ensureModelMetadata:k,ensureSeriesId:w,getModelId:B,getSeriesId:A,getModelTitle:v,computeJsonFingerprint:H,uid:G}){let oe=null,D=null,ce=null,le=null,Ae=null,R=null,F=null,K=null,V=null,j=null;const _e=new Set,N={baseUrl:Pi,groupId:ti,authToken:"",enabled:Ri,useSemver:Vi},re=new Map,Z=new Map;function ue(s){return(s||"").toString().trim().replace(/\/+$/,"")}function se(s){return`${(s||"").toString().trim()||ti}${Vo}`}function he(){return!!(N.baseUrl&&N.groupId)}function z(){return N.enabled!==!1}function Le(){_e.forEach(s=>{try{s(z())}catch(f){console.warn("[Blockscape] failed to run Apicurio enabled listener",f)}})}function qe(s){return typeof s=="function"&&_e.add(s),()=>_e.delete(s)}function we(){ce&&(ce.value=N.baseUrl||""),le&&(le.value=N.groupId||""),Ae&&(Ae.value=N.authToken||""),R&&(R.checked=z()),F&&(F.checked=!!N.useSemver)}function L(s="",f="muted"){K&&(K.textContent=s||"",K.classList.remove("is-error","is-success"),f==="error"?K.classList.add("is-error"):f==="success"&&K.classList.add("is-success"))}function pe(s){if(!j||(j.innerHTML="",!s))return;const f=document.createElement("p");f.className="apicurio-hint",f.textContent=s,j.appendChild(f)}function Fe(s){re.clear(),Z.clear(),pe(s)}function Oe(){const s=l(),f=z(),y=he(),E=s>=0?r[s]:null,h=!!(E!=null&&E.apicurioVersions&&E.apicurioVersions.length>1);if(oe){const C=oe.dataset.loading==="true",O=f&&y&&s>=0&&!!Ne(r[s]);oe.disabled=!f||C||!O,f?C||(oe.textContent="Push to Apicurio"):oe.textContent="Enable Apicurio to push"}if(V){const C=V.dataset.loading==="true",O=f&&y&&h&&!!Ne(E);V.disabled=!O||C,V.hidden=!h,f?C||(V.textContent="Push series"):V.textContent="Enable Apicurio to push series"}if(D){const C=D.dataset.loading==="true",O=f&&y;D.disabled=!O||C,C||(f?y?D.textContent="List artifacts":D.textContent="Enter details to list":D.textContent="Enable Apicurio to list")}}function I(){we(),z()?he()?(L("Apicurio push is ready when a model is selected.","muted"),re.size||pe("Click “List artifacts” to browse the current group.")):(L("Enter Apicurio connection details to enable push.","muted"),Fe("Enter registry details to browse artifacts.")):(L("Apicurio integration is off. Enable it to allow pushes.","muted"),Fe("Apicurio integration is disabled.")),Oe()}function _(){if(window!=null&&window.localStorage)try{localStorage.setItem(Ro,JSON.stringify(N))}catch(s){console.warn("[Blockscape] unable to persist Apicurio settings",s)}}function fe(){let s={};if(window!=null&&window.localStorage)try{const C=localStorage.getItem(Ro);if(C){const O=JSON.parse(C);O&&typeof O=="object"&&(s=O)}}catch(C){console.warn("[Blockscape] failed to restore Apicurio settings",C)}const f=ue(s.baseUrl??Pi),y=(s.groupId??ti).toString().trim();let E=Ri,h=Vi;typeof s.enabled=="boolean"?E=s.enabled:typeof s.enabled=="string"&&(E=s.enabled==="true"),typeof s.useSemver=="boolean"?h=s.useSemver:typeof s.useSemver=="string"&&(h=s.useSemver==="true"),N.baseUrl=f||Pi,N.groupId=y||ti,N.authToken=(s.authToken??"").toString().trim(),N.enabled=E,N.useSemver=h,I(),Le()}function J(){const s={Accept:"application/json"},f=(N.authToken||"").trim();return f&&(s.Authorization=/\s/.test(f)?f:`Bearer ${f}`),s}function Q(s,f,{title:y,description:E,version:h}={}){const C={artifactId:s,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:f},metadata:{properties:{}}}};h&&(C.firstVersion.version=h),y&&(C.name=y),E&&(C.description=E);try{const O=JSON.parse(f),$=O==null?void 0:O.seriesId;$&&typeof $=="string"&&(C.firstVersion.metadata.properties.seriesId=$)}catch{}return C}function M(s,{version:f}={}){const y={content:{contentType:"application/json",content:s},metadata:{properties:{}}};try{const E=JSON.parse(s),h=E==null?void 0:E.seriesId;h&&typeof h=="string"&&(y.metadata.properties.seriesId=h)}catch{}return f&&(y.version=f),y}function Te(s){if(s==null)return null;const f=String(s).trim();if(!f)return null;const y=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(f);if(y)return{major:Number(y[1]),minor:Number(y[2]),patch:Number(y[3])};const E=/^v?(\d+)$/.exec(f);return E?{major:Number(E[1]),minor:0,patch:0}:null}function Je(s){return`${s.major}.${s.minor}.${s.patch}`}function Pe(s,f){return!s&&!f?0:s?f?s.major!==f.major?s.major-f.major:s.minor!==f.minor?s.minor-f.minor:s.patch-f.patch:1:-1}function Re(s=[]){let f=null;if(s.forEach(E=>{const h=Te((E==null?void 0:E.version)??E);h&&(!f||Pe(h,f)>0)&&(f=h)}),!f)return"1.0.0";const y={...f,patch:f.patch+1};return Je(y)}function Ne(s,{seriesName:f,fallbackTitle:y}={}){var C;if(!s)return null;const E=f||s.title||s.apicurioArtifactName||v(s),h=y||E;if(typeof w=="function"&&(s.isSeries||((C=s.apicurioVersions)==null?void 0:C.length)>1)&&w(s,{seriesName:E,fallbackTitle:h}),typeof A=="function"){const O=A(s,{seriesName:E,fallbackTitle:h});if(O)return O}return B(s)}function Ee(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.artifacts)?s.artifacts:Array.isArray(s==null?void 0:s.items)?s.items:Array.isArray(s==null?void 0:s.results)?s.results:[]}function me(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.versions)?s.versions:Array.isArray(s==null?void 0:s.items)?s.items:[]}function ge(s=[]){if(!Array.isArray(s)||!s.length)return null;const f=[...s].filter(Boolean);return f.sort((y,E)=>{const h=y!=null&&y.createdOn?new Date(y.createdOn).getTime():0,C=E!=null&&E.createdOn?new Date(E.createdOn).getTime():0;if(h!==C)return C-h;const O=Number(y==null?void 0:y.version),$=Number(E==null?void 0:E.version),ee=Number.isFinite(O),q=Number.isFinite($);if(ee&&q&&O!==$)return $-O;const X=String((y==null?void 0:y.version)??"");return String((E==null?void 0:E.version)??"").localeCompare(X,void 0,{numeric:!0})}),f[0]||null}function Ue(s){if(!s)return s;let f=s;if(!Array.isArray(s==null?void 0:s.categories)){const E=s==null?void 0:s.content;if(typeof E=="string")try{f=JSON.parse(E)}catch(h){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",h)}else E&&typeof E=="object"&&(f=E)}return f}async function ct(s,f,y){const E=encodeURIComponent(f),h=encodeURIComponent(y),C=`${s}/groups/${E}/artifacts/${h}`,O=J();O.Accept="application/json";const $=await fetch(C,{method:"GET",headers:O});if(!$.ok){let ee=$.statusText||"Unknown error";try{const q=await $.text();q&&(ee=q.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${$.status}): ${ee}`)}return $.json()}async function nt(s,f,y){const E=encodeURIComponent(f),h=encodeURIComponent(y),C=`${s}/groups/${E}/artifacts/${h}/versions?limit=50&order=desc`,O=J();O.Accept="application/json";const $=await fetch(C,{method:"GET",headers:O});if(!$.ok){let q=$.statusText||"Unknown error";try{const X=await $.text();X&&(q=X.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${$.status}): ${q}`)}const ee=await $.json();return me(ee).filter(q=>q&&q.version!=null)}async function je(s,f,y,E="latest"){const h=encodeURIComponent(f),C=encodeURIComponent(y),O=encodeURIComponent(E||"latest"),$=`${s}/groups/${h}/artifacts/${C}/versions/${O}/content`,ee=J();ee.Accept="application/json, application/*+json, */*;q=0.8";const q=await fetch($,{method:"GET",headers:ee});if(!q.ok){let ke=q.statusText||"Unknown error";try{const te=await q.text();te&&(ke=te.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${q.status}): ${ke}`)}const X=await q.text();let be=null;try{be=JSON.parse(X)}catch{throw new Error("Artifact content is not valid JSON.")}return Ue(be)}async function $e(s,f,y,E="latest"){const h=await je(s,f,y,E);return{data:h,fingerprint:H(h)}}async function Ge(s,f,y){try{const h=await nt(s,f,y);if(h!=null&&h.length){Z.set(y,h);const C=ge(h);if((C==null?void 0:C.version)!=null)return C.version}}catch(h){console.warn("[Blockscape] compare-version: unable to fetch versions list",h)}try{const h=await ct(s,f,y);if((h==null?void 0:h.version)!=null)return h.version}catch(h){console.warn("[Blockscape] compare-version: unable to fetch metadata",h)}const E=Z.get(y);if(E&&E.length){const h=ge(E);if((h==null?void 0:h.version)!=null)return h.version}return"latest"}async function lt(s,f,y,E){if(!N.useSemver)return null;if(!E)return"1.0.0";try{const h=await nt(s,f,y);return Re(h)}catch(h){throw new Error(`Unable to compute next semantic version: ${h.message}`)}}function ae(s=document){oe=s.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),V=s.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),D=s.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),ce=s.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),le=s.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),Ae=s.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),R=s.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),F=s.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),K=s.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),j=s.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function ye(){N.baseUrl=ue((ce==null?void 0:ce.value)??N.baseUrl),N.groupId=((le==null?void 0:le.value)??"").trim(),N.authToken=((Ae==null?void 0:Ae.value)??"").trim(),_(),I()}function $t(s){N.enabled=s!==!1,_(),I(),Le()}function Gt(){$t(R?R.checked:Ri)}function Bt(){N.useSemver=F?F.checked:Vi,_(),I()}function pn(){[ce,le,Ae].forEach(s=>{s&&s.addEventListener("input",ye)}),oe&&oe.addEventListener("click",()=>{Pn()}),V&&V.addEventListener("click",()=>{Rn()}),R&&R.addEventListener("change",Gt),F&&F.addEventListener("change",Bt),D&&D.addEventListener("click",Vn),j&&j.addEventListener("click",s=>{const f=s.target.closest("[data-artifact-version]");if(f){s.stopPropagation();const h=f.dataset.artifactId,C=f.dataset.artifactVersion;h&&C&&Kt(h,C);return}const y=s.target.closest("[data-artifact-load-all]");if(y){s.stopPropagation(),y.dataset.artifactId&&Rt();return}const E=s.target.closest("[data-artifact-trigger]");if(E){const h=E.dataset.artifactId;if(!h)return;Pt(h)}})}function Mt(){const s=document.createElement("div");return s.className="blockscape-registry-panel",s.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,s}function Ot(s){if(!s)return;s.innerHTML="";const f=Mt();s.appendChild(f),ae(s),pn(),I()}function fn(s){if(!j)return;if(j.innerHTML="",!s.length){pe("No artifacts found in this group.");return}const f=h=>{const C=document.createElement("section");C.className="apicurio-artifact-section";const O=document.createElement("h3");O.textContent=h,C.appendChild(O);const $=document.createElement("ul");return $.className="apicurio-artifact-list",C.appendChild($),{section:C,list:$}},y=f("Series artifacts"),E=f("Artifacts");s.forEach(h=>{if(!(h!=null&&h.artifactId))return;const O=h._groupId&&h._groupId.endsWith(Vo)?y.list:E.list,$=document.createElement("li"),ee=document.createElement("button");ee.type="button",ee.className="apicurio-artifact",ee.dataset.artifactId=h.artifactId,ee.dataset.artifactTrigger="toggle";const q=document.createElement("span");q.className="apicurio-artifact-title",q.textContent=h.artifactId,ee.appendChild(q);const X=[];if(h.name&&X.push(h.name),h.version!=null&&X.push(`v${h.version}`),h.type&&X.push(h.type),h._groupId&&X.push(h._groupId),X.length){const te=document.createElement("span");te.className="apicurio-artifact-meta",te.textContent=X.join(" • "),ee.appendChild(te)}if(h.description){const te=document.createElement("span");te.className="apicurio-artifact-meta",te.textContent=h.description,ee.appendChild(te)}$.appendChild(ee);const be=document.createElement("div");be.className="apicurio-version-list",be.dataset.versionPanel=h.artifactId,be.hidden=!0;const ke=document.createElement("p");ke.className="apicurio-hint",ke.textContent="Click to load the latest or open versions.",be.appendChild(ke),$.appendChild(be),O.appendChild($)}),y.list.children.length&&j.appendChild(y.section),E.list.children.length&&j.appendChild(E.section)}function Bn(s){return j?j.querySelector(`[data-version-panel="${s}"]`):null}function zt(s,f){if(!s||(s.innerHTML="",!f))return;const y=document.createElement("p");y.className="apicurio-hint",y.textContent=f,s.appendChild(y)}function Mn(s,f){const y=Bn(s);if(y){if(y.innerHTML="",!f.length){zt(y,"No versions found for this artifact.");return}f.forEach(E=>{const h=document.createElement("button");h.type="button",h.className="apicurio-version-button",h.dataset.artifactId=s,h.dataset.artifactVersion=E.version;const C=[`Version ${E.version}`];if(E.createdOn){const O=new Date(E.createdOn);isNaN(O)||C.push(O.toISOString().slice(0,10))}h.textContent=C.join(" — "),y.appendChild(h)})}}async function Pt(s){const f=Bn(s);if(!f)return;if(f.dataset.open==="true"){f.hidden=!0,f.dataset.open="false";return}if(f.hidden=!1,f.dataset.open="true",f.dataset.loaded!=="true"){if(!he()){zt(f,"Enter registry details first.");return}zt(f,"Loading versions…");try{const E=ue(N.baseUrl),h=re.get(s),C=N.groupId.trim(),O=(h==null?void 0:h._groupId)||C,$=await nt(E,O,s);Z.set(s,$),f.dataset.loaded="true",Mn(s,$)}catch(E){console.error("[Blockscape] failed to load versions",E),zt(f,`Unable to fetch versions: ${E.message}`)}}}function On(s,f){var E;const y=r.findIndex(h=>h.apicurioArtifactId===s);if(y!==-1){const h=r[y].id;r[y]={...f,id:h||f.id},((E=r[y].apicurioVersions)==null?void 0:E.length)>1&&(r[y].isSeries=!0),p(y)}else r.push(f),p(r.length-1)}async function mn(s,f,y,E){const h=encodeURIComponent(f),C=encodeURIComponent(y),O=`${s}/groups/${h}/artifacts/${C}`;try{const $=await fetch(O,{method:"GET",headers:E});if($.status===404)return!1;if($.ok)return!0;throw $.status===401||$.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${$.status} while checking the artifact.`)}catch($){throw $ instanceof TypeError?new Error("Network error while contacting Apicurio registry."):$}}async function Pn(){var O;if(!oe||oe.dataset.loading==="true")return;if(!z()){L("Apicurio integration is off. Enable it first.","error");return}if(!he()){L("Enter the registry base URL and group ID before pushing.","error");return}const s=l();if(s<0||!r[s]){L("No active model to push.","error");return}const f=Ne(r[s],{fallbackTitle:v(r[s])});if(!f){L("Active model needs an id before pushing.","error");return}const y=ue(N.baseUrl),E=N.groupId.trim(),h=JSON.stringify(r[s].data,null,2),C=J();oe.dataset.loading="true",oe.textContent="Pushing…",oe.disabled=!0,L("Pushing to Apicurio…","muted");try{const $=await mn(y,E,f,C),ee=H(r[s].data);if($)try{const Ie=await Ge(y,E,f),{data:Qe,fingerprint:et}=await $e(y,E,f,Ie);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",Ie),console.log("local fingerprint",ee),console.log("registry fingerprint",et),console.log("local payload",r[s].data),console.log("registry payload",Qe),console.groupEnd(),ee&&et&&ee===et){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){L("Push cancelled (content matches the latest registry version).","muted");return}L("Pushing identical content by user choice.","muted")}else et?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):L("Unable to compare with registry content (skipping confirmation).","muted")}catch(Ie){console.warn("[Blockscape] unable to compare registry content before push",Ie),L("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const q=N.useSemver?await lt(y,E,f,$):null;if(N.useSemver&&!q)throw new Error("Semantic versioning is enabled but no version could be computed.");const X=encodeURIComponent(E),be=encodeURIComponent(f),ke=$?`${y}/groups/${X}/artifacts/${be}/versions`:`${y}/groups/${X}/artifacts`,te={...C,"Content-Type":"application/json"};q&&(te["X-Registry-Version"]=q,L(`Pushing to Apicurio as version ${q}…`,"muted"));const rt=$?M(h,{version:q}):Q(f,h,{title:v(r[s]),description:(O=r[s].data)==null?void 0:O.abstract,version:q}),ze=await fetch(ke,{method:"POST",headers:te,body:JSON.stringify(rt)});if(!ze.ok){let Ie=ze.statusText||"Unknown error";try{const Qe=await ze.text();Qe&&(Ie=Qe.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${ze.status}): ${Ie}`)}let Ke=null;try{Ke=await ze.json()}catch{Ke=null}const de=(Ke==null?void 0:Ke.version)||(Ke==null?void 0:Ke.globalId)||"",Se=$?"Updated":"Created",Xe=de?` (version ${de})`:"";L(`${Se} ${f}${Xe}`,"success")}catch($){console.error("[Blockscape] Apicurio push failed",$),L(`Apicurio push failed: ${$.message}`,"error")}finally{oe.dataset.loading="false",Oe()}}async function Rn(){var q,X;if(!V||V.dataset.loading==="true")return;if(!z()){L("Apicurio integration is off. Enable it first.","error");return}if(!he()){L("Enter the registry base URL and group ID before pushing.","error");return}const s=l(),f=s>=0?r[s]:null;if(!f||!f.apicurioVersions||f.apicurioVersions.length<2){L("Series push requires a model with multiple versions.","error");return}const y=Ne(f,{seriesName:f.title||f.apicurioArtifactName||v(f)});if(!y){L("Active series needs an id before pushing.","error");return}typeof w=="function"&&w(f,{seriesName:f.title||f.apicurioArtifactName||v(f)});const E=ue(N.baseUrl),h=N.groupId.trim(),C=f.apicurioVersions.map(be=>be.data),O=JSON.stringify(C,null,2),$=J(),ee=se(h);V.dataset.loading="true",V.textContent="Pushing…",V.disabled=!0,L("Pushing series to Apicurio…","muted");try{const be=await mn(E,ee,y,$),ke=H(C);if(be)try{const pt=await Ge(E,ee,y),{data:Vt,fingerprint:Xt}=await $e(E,ee,y,pt);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",pt),console.log("local fingerprint",ke),console.log("registry fingerprint",Xt),console.log("local payload (series)",C),console.log("registry payload",Vt),console.groupEnd(),ke&&Xt&&ke===Xt){if(!window.confirm("The current registry version matches this series. Push anyway?")){L("Series push cancelled (content matches latest).","muted");return}L("Pushing identical series by user choice.","muted")}else Xt?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):L("Unable to compare with registry content (skipping confirmation).","muted")}catch(pt){console.warn("[Blockscape] unable to compare registry content before series push",pt),L("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const te=N.useSemver?await lt(E,ee,y,be):null;if(N.useSemver&&!te)throw new Error("Semantic versioning is enabled but no version could be computed.");const rt=encodeURIComponent(ee),ze=encodeURIComponent(y),Ke=be?`${E}/groups/${rt}/artifacts/${ze}/versions`:`${E}/groups/${rt}/artifacts`,de={...$,"Content-Type":"application/json"};te&&(de["X-Registry-Version"]=te,L(`Pushing series to Apicurio as version ${te}…`,"muted"));const Se=be?M(O,{version:te}):Q(y,O,{title:f.apicurioArtifactName||((q=f.data)==null?void 0:q.title)||y,description:(X=f.data)==null?void 0:X.abstract,version:te}),Xe=await fetch(Ke,{method:"POST",headers:de,body:JSON.stringify(Se)});if(!Xe.ok){let pt=Xe.statusText||"Unknown error";try{const Vt=await Xe.text();Vt&&(pt=Vt.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${Xe.status}): ${pt}`)}let Ie=null;try{Ie=await Xe.json()}catch{Ie=null}const Qe=(Ie==null?void 0:Ie.version)||(Ie==null?void 0:Ie.globalId)||"",et=be?"Updated":"Created",St=Qe?` (version ${Qe})`:"";L(`${et} ${y} series${St}`,"success")}catch(be){console.error("[Blockscape] Apicurio series push failed",be),L(`Apicurio series push failed: ${be.message}`,"error")}finally{V.dataset.loading="false",Oe()}}async function Vn(){if(!D||D.dataset.loading==="true")return;if(!z()){L("Enable Apicurio integration to list artifacts.","error");return}if(!he()){L("Enter registry base URL and group ID before listing.","error");return}const s=ue(N.baseUrl),f=N.groupId.trim(),y=se(f),E=[{groupId:f,label:"base"},{groupId:y,label:"series"}];D.dataset.loading="true",D.textContent="Listing…",D.disabled=!0,L("Listing artifacts…","muted"),pe("Contacting registry…");try{const h=J();h.Accept="application/json";const C=[];for(const $ of E){const ee=encodeURIComponent($.groupId),q=`${s}/groups/${ee}/artifacts?limit=50&offset=0`,X=await fetch(q,{method:"GET",headers:h});if(!X.ok){let te=X.statusText||"Unknown error";try{const rt=await X.text();rt&&(te=rt.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${$.groupId} (${X.status}): ${te}`);continue}const be=await X.json(),ke=Ee(be).filter(te=>te&&te.artifactId);ke.forEach(te=>{te&&(te._groupId=$.groupId)}),C.push(...ke)}re.clear(),Z.clear(),C.forEach($=>{$!=null&&$.artifactId&&re.set($.artifactId,$)}),fn(C);const O=C.length;L(O?`Found ${O} artifact${O===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",O?"success":"muted")}catch(h){console.error("[Blockscape] failed to list artifacts",h),Fe("Unable to list artifacts."),L(`Listing failed: ${h.message}`,"error")}finally{D.dataset.loading="false",Oe()}}async function Kt(s,f=null){var be,ke,te,rt,ze,Ke;if(!s)return;if(!z()){L("Enable Apicurio integration to load artifacts.","error");return}if(!he()){L("Enter registry connection details before loading artifacts.","error");return}const y=ue(N.baseUrl),E=N.groupId.trim(),h=s&&((be=re.get(s))==null?void 0:be._groupId)||E;let C=re.get(s);const O=async()=>{try{const de=await ct(y,h,s);return de!=null&&de.artifactId&&re.set(s,de),de}catch(de){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",de),de}};if(!C)try{C=await O()}catch(de){L(`Failed to fetch artifact metadata: ${de.message}`,"error");return}const $=Z.get(s)||[];let ee="latest",q="latest";if(f)ee=f,q=f;else{if(!C||C.version==null)try{C=await O()}catch(de){L(`Failed to fetch artifact metadata: ${de.message}`,"error");return}ee=(C==null?void 0:C.version)||"latest",q=(C==null?void 0:C.version)||"latest"}const X=$.find(de=>String(de.version)===String(ee));(X==null?void 0:X.version)!=null&&(q=X.version),L(`Loading artifact ${s}…`,"muted");try{const de=await je(y,h,s,ee),Se=re.get(s)||C||{},Xe=Array.isArray(de);let Ie=null;if(Xe){const Qe=de.map((St,pt)=>(k(St,{titleHint:Se.name||s,idHint:s}),{version:String(pt+1),data:St,createdOn:(X==null?void 0:X.createdOn)||Se.createdOn}));Ie={id:G(),title:((te=(ke=Qe[0])==null?void 0:ke.data)==null?void 0:te.title)||Se.name||s,data:(rt=Qe[0])==null?void 0:rt.data,apicurioArtifactId:s,apicurioArtifactName:Se.name||"",apicurioVersions:Qe,apicurioActiveVersionIndex:0,isSeries:!0};const et=((ze=Se==null?void 0:Se.properties)==null?void 0:ze.seriesId)||s;typeof w=="function"&&w(Ie,{seriesName:et,fallbackTitle:et}),L(`Loaded series artifact ${s}.`,"success")}else{k(de,{titleHint:Se.name||s,idHint:s});const Qe={version:q,data:de,createdOn:(X==null?void 0:X.createdOn)||Se.createdOn};Ie={id:G(),title:de.title||Se.name||s,data:de,apicurioArtifactId:s,apicurioArtifactName:Se.name||"",apicurioVersions:[Qe],apicurioActiveVersionIndex:0};const et=(Ke=Se==null?void 0:Se.properties)==null?void 0:Ke.seriesId;et&&typeof w=="function"&&w(Ie,{seriesName:et,fallbackTitle:et});const St=q?` (version ${q})`:"";L(`Loaded artifact ${s}${St}.`,"success")}On(s,Ie)}catch(de){console.error("[Blockscape] failed to load artifact",de),L(`Failed to load artifact: ${de.message}`,"error")}}async function Rt(s){}return{hydrateConfig:fe,mount:Ot,updateAvailability:Oe,isEnabled:z,setEnabled:$t,onEnabledChange:qe}}function cn(r,l){if(typeof r!="function")throw new Error(`[itemEditor] expected ${l} to be a function`)}function js(r,{excludeId:l}={}){if(!r)return[];const p=r.split(/[\s,]+/).map(w=>w.trim()).filter(Boolean),k=[];return p.forEach(w=>{l&&w===l||k.includes(w)||k.push(w)}),k}function Ws(r,l,p){if(!l||!p||l===p)return;((r==null?void 0:r.categories)||[]).forEach(w=>{(w.items||[]).forEach(B=>{Array.isArray(B.deps)&&(B.deps=B.deps.map(A=>A===l?p:A))})}),Array.isArray(r==null?void 0:r.links)&&r.links.forEach(w=>{w.from===l&&(w.from=p),w.to===l&&(w.to=p)})}function qs({findItemAndCategoryById:r,collectAllItemIds:l,updateItemReferences:p,loadActiveIntoEditor:k,rebuildFromActive:w,select:B,onSelectionRenamed:A}={}){cn(r,"findItemAndCategoryById"),cn(l,"collectAllItemIds"),cn(p,"updateItemReferences"),cn(k,"loadActiveIntoEditor"),cn(w,"rebuildFromActive"),cn(B,"select");const v={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function H(R){if(v.fields.errorEl){if(!R){v.fields.errorEl.hidden=!0,v.fields.errorEl.textContent="";return}v.fields.errorEl.hidden=!1,v.fields.errorEl.textContent=R}}function G(){v.wrapper&&(v.wrapper.hidden=!0,v.wrapper.setAttribute("aria-hidden","true"),H(""),v.categoryId=null,v.itemId=null,v.modelData=null,document.body.classList.remove("item-editor-open"))}function oe(){v.wrapper&&(v.wrapper.hidden=!1,v.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var R,F;(R=v.fields.nameInput)==null||R.focus(),(F=v.fields.nameInput)==null||F.select()}))}function D(R){var ue;if(!v.modelData||!v.categoryId||!v.itemId)throw new Error("No item loaded.");const K=(((ue=v.modelData)==null?void 0:ue.categories)||[]).find(se=>se.id===v.categoryId);if(!K)throw new Error("Category not found.");K.items=K.items||[];const V=K.items.find(se=>se.id===v.itemId);if(!V)throw new Error("Item not found.");const j=(R.id||"").trim();if(!j)throw new Error("ID is required.");const _e=l(v.modelData);if(j!==V.id&&_e.has(j))throw new Error("Another item already uses that ID.");V.id=j;const N=(R.name||"").trim();V.name=N||V.id;const re=(R.logo||"").trim();if(re?V.logo=re:delete V.logo,R.externalFlag&&!R.external)V.external=!0;else{const se=(R.external??"").toString().trim();se?V.external=se:delete V.external}const Z=(R.color||"").trim();return Z?V.color=Z:delete V.color,V.deps=Array.isArray(R.deps)?R.deps:[],V.id!==R.originalId&&typeof A=="function"&&A(R.originalId,V.id),p(v.modelData,R.originalId,V.id),k(),w(),B(V.id),V.id}function ce(){if(!v.fields||!v.fields.idInput)return!1;const R=(v.fields.idInput.value||"").trim(),F={originalId:v.itemId,id:R,name:v.fields.nameInput.value||"",logo:v.fields.logoInput.value||"",external:v.fields.externalInput.value||"",externalFlag:v.fields.externalFlagInput.checked,color:v.fields.colorInput.value||"",deps:js(v.fields.depsInput.value,{excludeId:R})};try{return D(F),G(),!0}catch(K){return console.warn("[itemEditor] item edit failed",K),H((K==null?void 0:K.message)||"Unable to save item."),!1}}function le(){if(v.wrapper)return v.wrapper;const R=document.createElement("div");R.className="item-editor-modal",R.hidden=!0,R.setAttribute("role","dialog"),R.setAttribute("aria-modal","true");const F=document.createElement("div");F.className="item-editor-modal__backdrop",R.appendChild(F);const K=document.createElement("div");K.className="item-editor",R.appendChild(K);const V=document.createElement("div");V.className="item-editor__header";const j=document.createElement("h2");j.className="item-editor__title",j.textContent="Edit item";const _e=document.createElement("button");_e.type="button",_e.className="item-editor__close",_e.setAttribute("aria-label","Close item editor"),_e.textContent="×",V.appendChild(j),V.appendChild(_e),K.appendChild(V);const N=document.createElement("form");N.className="item-editor__form",K.appendChild(N);const re=document.createElement("div");re.className="item-editor__meta",re.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',N.appendChild(re);const Z=document.createElement("div");Z.className="item-editor__error",Z.hidden=!0,N.appendChild(Z);const ue=(Q,M,Te)=>{const Je=document.createElement("label");Je.className="item-editor__field";const Pe=document.createElement("span");if(Pe.className="item-editor__label",Pe.textContent=Q,Je.appendChild(Pe),M.classList.add("item-editor__control"),Je.appendChild(M),Te){const Re=document.createElement("div");Re.className="item-editor__hint",Re.textContent=Te,Je.appendChild(Re)}return Je},se=document.createElement("input");se.type="text",se.required=!0,N.appendChild(ue("ID",se,"Unique identifier used for links and dependencies."));const he=document.createElement("input");he.type="text",N.appendChild(ue("Name",he,"Visible label shown on the tile."));const z=document.createElement("input");z.type="url",z.inputMode="url",z.placeholder="https://…",N.appendChild(ue("Logo URL",z,"Optional image URL."));const Le=document.createElement("input");Le.type="url",Le.inputMode="url",Le.placeholder="https://…",N.appendChild(ue("External link",Le,"Shown with ↗ icon and in preview."));const qe=document.createElement("div");qe.className="item-editor__checkbox";const we=document.createElement("label");we.className="item-editor__checkbox-row";const L=document.createElement("input");L.type="checkbox";const pe=document.createElement("span");pe.textContent="Mark as external without link";const Fe=document.createElement("div");Fe.className="item-editor__hint",Fe.textContent="Keeps dashed border even without a URL.",we.appendChild(L),we.appendChild(pe),qe.appendChild(we),qe.appendChild(Fe),N.appendChild(qe);const Oe=document.createElement("input");Oe.type="text",Oe.placeholder="#2563eb",N.appendChild(ue("Color",Oe,"Optional badge color (hex or CSS color)."));const I=document.createElement("textarea");I.rows=2,I.placeholder="Comma or space separated ids",N.appendChild(ue("Dependencies",I,"Use item IDs, separated by commas or spaces."));const _=document.createElement("div");_.className="item-editor__actions";const fe=document.createElement("button");fe.type="button",fe.className="pf-v5-c-button pf-m-tertiary",fe.textContent="Cancel";const J=document.createElement("button");return J.type="submit",J.className="pf-v5-c-button pf-m-primary",J.textContent="Save",_.appendChild(fe),_.appendChild(J),N.appendChild(_),v.wrapper=R,v.fields={idInput:se,nameInput:he,logoInput:z,externalInput:Le,externalFlagInput:L,colorInput:Oe,depsInput:I,categoryValue:re.querySelector(".item-editor__meta-value"),errorEl:Z},fe.addEventListener("click",G),_e.addEventListener("click",G),F.addEventListener("click",G),N.addEventListener("submit",Q=>{Q.preventDefault(),ce()}),document.addEventListener("keydown",Q=>{Q.key==="Escape"&&!R.hidden&&(Q.preventDefault(),Q.stopPropagation(),G())}),document.body.appendChild(R),R}function Ae(R){const F=r(R);return F?(le(),v.categoryId=F.category.id,v.itemId=F.item.id,v.modelData=F.modelData,v.fields.categoryValue.textContent=F.category.title||F.category.id,v.fields.idInput.value=F.item.id||"",v.fields.nameInput.value=F.item.name||"",v.fields.logoInput.value=F.item.logo||"",v.fields.externalInput.value=typeof F.item.external=="string"?F.item.external:"",v.fields.externalFlagInput.checked=F.item.external===!0,v.fields.colorInput.value=F.item.color||"",v.fields.depsInput.value=Array.isArray(F.item.deps)?F.item.deps.join(", "):"",H(""),B(F.item.id),oe(),!0):!1}return{open:Ae,hide:G,isOpen:()=>!!v.wrapper&&!v.wrapper.hidden}}function Uo(r,l="series"){return(r||l).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||l}function Ln(r,l="series"){const p=Uo(r,l).replace(/\./g,"-");return p.replace(/-series$/i,"").replace(/-+$/,"")||p||Uo(l,"series")}function Go(r,{seriesName:l,fallbackTitle:p="unknown"}={}){var v,H;const w=[r==null?void 0:r.seriesId,(v=r==null?void 0:r.data)==null?void 0:v.seriesId,r==null?void 0:r.apicurioArtifactId,l,r==null?void 0:r.title,r==null?void 0:r.apicurioArtifactName,(H=r==null?void 0:r.data)==null?void 0:H.title,p].map(G=>(G??"").toString().trim()),B=w.findIndex(Boolean),A=B!==-1?w[B]:"";return A?(console.log("[Series] deriveSeriesId: picked base",{base:A,sourceIndex:B,candidates:w}),Ln(A,p)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:p}),null)}function at(r,{seriesName:l,fallbackTitle:p="unknown"}={}){if(!r||typeof r!="object")return null;const k=Go(r,{seriesName:l,fallbackTitle:p});return k?(r.seriesId=k,r.apicurioArtifactId||(r.apicurioArtifactId=k),k):null}function An(r,l={}){var w,B;if(!r)return null;const p=r.isSeries||((w=r.apicurioVersions)==null?void 0:w.length)>1||r.seriesId||((B=r.data)==null?void 0:B.seriesId)||r.apicurioArtifactId;if(!p&&!l.force)return null;const k=Go(r,l);return k||(p?Ln(l.fallbackTitle||"unknown"):null)}const ni=typeof import.meta<"u"&&"./"||"";function Gs(){console.log("[Blockscape] init");const r=document.getElementById("jsonBox"),l=document.querySelector(".blockscape-json-panel"),p=document.getElementById("app"),k=document.getElementById("overlay"),w=document.getElementById("tabTooltip"),B=document.getElementById("modelList"),A=document.getElementById("itemPreview"),v=document.getElementById("urlForm"),H=document.getElementById("urlInput"),G=document.getElementById("loadUrl"),oe=A.querySelector(".item-preview__title"),D=A.querySelector(".item-preview__body"),ce=A.querySelector(".item-preview__actions"),le=A.querySelector(".item-preview__close"),Ae=document.getElementById("downloadJson"),R=document.getElementById("shareModel"),F=document.getElementById("createVersion"),K=document.getElementById("openInEditor"),V=document.getElementById("copyJson"),j=document.getElementById("copySeries"),_e=document.getElementById("pasteJson"),N=document.getElementById("helpButton"),re=document.getElementById("newPanelButton"),Z=document.getElementById("shortcutHelp"),ue=document.getElementById("shortcutHelpList"),se=document.getElementById("shortcutHelpClose"),he=document.getElementById("shortcutHelpBackdrop"),z=document.getElementById("newPanel"),Le=document.getElementById("newPanelClose"),qe=document.getElementById("newPanelBackdrop"),we=document.getElementById("search"),L=document.getElementById("searchResults"),pe="blockscape:editorPayload",Fe="blockscape:editorTransfer",Oe=document.title;r.value=document.getElementById("seed").textContent.trim();let I=[],_=-1;const fe=Js({models:I,getActiveIndex:()=>_,setActive:it,ensureModelMetadata:Ut,getModelId:ft,getSeriesId:An,ensureSeriesId:at,getModelTitle:xe,computeJsonFingerprint:Un,uid:Xe});let J=null,Q=new Map,M=null,Te=null,Je=!0,Pe=!1,Re=0,Ne={x:0,y:0},Ee="map",me=null,ge=!1,Ue=null;const ct=2e3;let nt=null,je=null,$e=null,Ge=null,lt=null,ae=null,ye=null,$t="",Gt=!1,Bt=null,pn=null,Mt=null,Ot=[],fn=null;const Bn=30,zt=1e3,Mn="blockscape:hoverScale",Pt=1.5,On=1,mn=2.5,Pn="blockscape:titleWrap",Rn="blockscape:titleHoverWidth",Vn="blockscape:titleHoverTextPortion",Kt="wrap",Rt=1.3,s=1,f=1.6,y=.25,E=0,h=.6,C="blockscape:tileCompactness",O=1,$=.75,ee=1.25;let q=Pt,X=O,be=Kt,ke=Rt,te=y;const rt="blockscape:seriesNavDoubleClickMs",ze=900,Ke=300,de=4e3;let Se=ze;fe.hydrateConfig(),Qo(),tr(),ar(),ir(),rr(),dr(),Ct();function Xe(){return Math.random().toString(36).slice(2,10)}function Ie(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function Qe(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function et(e){return Ie(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function St(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),Qe(t)}function pt(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}async function Vt(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function Xt(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function hn(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function zo(e){return Number.isFinite(e)?Math.min(mn,Math.max(On,e)):Pt}function Ct(){p&&p.classList.toggle("blockscape-has-selection",!!M)}function gn(e){return q=zo(e),document.documentElement.style.setProperty("--blockscape-tile-hover-scale",q),q}function Ko(e){return Number.isFinite(e)?Math.min(ee,Math.max($,e)):O}function bn(e){return X=Ko(e),document.documentElement.style.setProperty("--blockscape-tile-compactness",X),X}function Xo(e){return Number.isFinite(e)?Math.min(f,Math.max(s,e)):Rt}function vn(e){return ke=Xo(e),document.documentElement.style.setProperty("--blockscape-title-hover-width-multiplier",ke),ke}function Yo(e){return Number.isFinite(e)?Math.min(h,Math.max(E,e)):y}function wn(e){return te=Yo(e),document.documentElement.style.setProperty("--blockscape-tile-hover-text-portion",te),te}function yn(e){const t=e==="nowrap"?"nowrap":"wrap";be=t;const n=t==="nowrap"?"nowrap":"normal",i=t==="nowrap"?"nowrap":"normal";return document.documentElement.style.setProperty("--blockscape-title-white-space",n),document.documentElement.style.setProperty("--blockscape-title-text-wrap",i),t}function Zo(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Mn,String(e))}catch(t){console.warn("[Blockscape] failed to persist hover scale",t)}}function Qo(){if(typeof window>"u"||!window.localStorage)return gn(Pt);try{const e=window.localStorage.getItem(Mn);if(!e)return gn(Pt);const t=parseFloat(e);return gn(t)}catch(e){return console.warn("[Blockscape] failed to read hover scale",e),gn(Pt)}}function er(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(C,String(e))}catch(t){console.warn("[Blockscape] failed to persist tile compactness",t)}}function tr(){if(typeof window>"u"||!window.localStorage)return bn(O);try{const e=window.localStorage.getItem(C);if(!e)return bn(O);const t=parseFloat(e);return bn(t)}catch(e){return console.warn("[Blockscape] failed to read tile compactness",e),bn(O)}}function nr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Rn,String(e))}catch(t){console.warn("[Blockscape] failed to persist title hover width",t)}}function ir(){if(typeof window>"u"||!window.localStorage)return vn(Rt);try{const e=window.localStorage.getItem(Rn);if(!e)return vn(Rt);const t=parseFloat(e);return vn(t)}catch(e){return console.warn("[Blockscape] failed to read title hover width",e),vn(Rt)}}function or(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Vn,String(e))}catch(t){console.warn("[Blockscape] failed to persist title text zoom",t)}}function rr(){if(typeof window>"u"||!window.localStorage)return wn(y);try{const e=window.localStorage.getItem(Vn);if(!e)return wn(y);const t=parseFloat(e);return wn(t)}catch(e){return console.warn("[Blockscape] failed to read title text zoom",e),wn(y)}}function sr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Pn,e)}catch(t){console.warn("[Blockscape] failed to persist title wrap mode",t)}}function ar(){if(typeof window>"u"||!window.localStorage)return yn(Kt);try{const e=window.localStorage.getItem(Pn);return yn(e||Kt)}catch(e){return console.warn("[Blockscape] failed to read title wrap mode",e),yn(Kt)}}function cr(e){return Number.isFinite(e)?Math.min(de,Math.max(Ke,e)):ze}function En(e){return Se=cr(e),Se}function lr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(rt,String(e))}catch(t){console.warn("[Blockscape] failed to persist series double-click wait",t)}}function dr(){if(typeof window>"u"||!window.localStorage)return En(ze);try{const e=window.localStorage.getItem(rt);if(!e)return En(ze);const t=parseInt(e,10);return En(t)}catch(e){return console.warn("[Blockscape] failed to read series double-click wait",e),En(ze)}}function ur(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function pr(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(c=>c&&typeof c=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function oi(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t)}function ri(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>ri(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${ri(e[i])}`).join(",")}}`}function zi(e){try{return ri(e)}catch{return""}}function Un(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=zi(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=zi(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const fr=[{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Jump to the previous or next category while keeping position where possible."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Cmd/Ctrl","Arrow Left"],["Cmd/Ctrl","Arrow Right"]],description:"Switch to the previous or next map when viewing a series."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile."},{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["F2"]],description:"Open the item editor for the selected tile."},{keys:[["Delete"]],description:"Delete the selected item (use Cmd/Ctrl+Z to undo)."},{keys:[["Escape"]],description:"Unselect item or close the open preview popover."}];function Ut(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const c=n||e.title||t||"model",a=hn(c).replace(/\./g,"-");e.id=a||`model-${Xe()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function mr(e){return JSON.parse(JSON.stringify(e))}function xe(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function Ki(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const o=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(o)return o;const c=ft(e);return c?`${c} series`:t}return xe(e,t)}function ft(e){var o;const t=An(e);if(t)return t;const n=(o=e==null?void 0:e.data)==null?void 0:o.id;return n&&n.toString().trim()||null}function Xi(e){var u;if(e<0||e>=I.length||!r)return!0;const t=I[e],n=(r.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}Ut(i,{titleHint:xe(t),idHint:ft(t)});const o=Un(t.data),c=Un(i);if(o===c)return!0;t.data=i;const a=Ft(t);return a>=0&&((u=t.apicurioVersions)!=null&&u[a])&&(t.apicurioVersions[a].data=i),!0}function Yi(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function hr(e){if(_<0||!e)return null;const t=I[_].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const c=(i.items||[]).find(a=>a.id===e);if(c)return{category:i,item:c,modelData:t}}return null}function gr(e,t){const n=Yi(t);let i=hn(e||"item");if(!n.has(i))return i;const o=()=>Xe().slice(0,4);for(;n.has(i);)i=`${hn(e||"item")}-${o()}`;return i}const Ht=qs({findItemAndCategoryById:hr,collectAllItemIds:Yi,updateItemReferences:Ws,loadActiveIntoEditor:Nt,rebuildFromActive:It,select:e=>tt(e),onSelectionRenamed:(e,t)=>{var n;M===e&&(M=t,Ct()),((n=me==null?void 0:me.item)==null?void 0:n.id)===e&&(me.item.id=t)}});function Hn(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const i={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[i],e.apicurioActiveVersionIndex=0;const o=e.title||xe(e);return at(e,{seriesName:o,fallbackTitle:o}),e.isSeries=!0,e}function At(e,{versionLabel:t,createdOn:n}={}){var d,m,g;if(e!=null&&e.isSeries||((d=e==null?void 0:e.apicurioVersions)==null?void 0:d.length)>1){const T=e.title||xe(e);at(e,{seriesName:T,fallbackTitle:T})}const i=ft(e);if(!i)return Hn(e,{versionLabel:t||"1",createdOn:n}),I.push(e),I.length-1;const o=I.findIndex(T=>ft(T)===i);if(o===-1)return Hn(e,{versionLabel:t||"1",createdOn:n}),I.push(e),I.length-1;const c=I[o];if(!Array.isArray(c.apicurioVersions)||!c.apicurioVersions.length){c.apicurioVersions=[{version:"1",data:c.data,createdOn:(g=(m=c.apicurioVersions)==null?void 0:m[0])==null?void 0:g.createdOn}],c.apicurioActiveVersionIndex=0;const T=c.title||xe(c);at(c,{seriesName:T,fallbackTitle:T})}const a=String(c.apicurioVersions.length+1);c.apicurioVersions.push({version:a,data:e.data,createdOn:n||new Date().toISOString()}),c.apicurioActiveVersionIndex=c.apicurioVersions.length-1,c.data=e.data,c.title=xe(e)||c.title,c.isSeries=!0;const u=c.title||xe(c);return at(c,{seriesName:u,fallbackTitle:u}),o}function Zi({versionLabel:e}={}){var a;if(_<0||!I[_])throw new Error("Load or select a model before creating a version.");const t=I[_];Hn(t,{versionLabel:"1"});let n;try{n=mr(t.data)}catch(u){throw console.warn("[Blockscape] failed to clone active model for versioning",u),new Error("Could not copy the current model.")}Ut(n,{titleHint:xe(t),idHint:ft(t)||An(t)});const o={version:e||String((((a=t.apicurioVersions)==null?void 0:a.length)||0)+1),data:n,createdOn:new Date().toISOString()};t.apicurioVersions.push(o),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=n,t.isSeries=!0;const c=t.title||xe(t);return at(t,{seriesName:c,fallbackTitle:c}),_}function si(){const e=_>=0&&I[_]?I[_]:null,t=ft(e);document.title=t?`${t}-blockscape`:Oe}function ai(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||xe(e);return at(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function br(){const e=I[_],t=ai(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function Qi(e="shortcut",t=!1){const n=r.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=I[_],o=t?ai(i):null,c=!!o,a=c?JSON.stringify(o,null,2):n,u=c&&An(i)||xe(i,"blockscape"),d=c?"-series":"",m=`${hn(u)}${d}.json`;return pt(m,a),console.log(`[Blockscape] saved JSON (${e}):`,m),!0}const vr={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function eo(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return vr[n]||"#9ca3af"}function wr(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(d=>d+d).join(""):t,i=parseInt(n,16),o=i>>16&255,c=i>>8&255,a=i&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(c/255,2.2)+.0722*Math.pow(a/255,2.2)>.35?"#111111":"#ffffff"}function yr(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function to(){if($e)return;$e=document.createElement("div"),$e.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",Ge=document.createElement("span"),Ge.className="series-nav-notice__text",$e.appendChild(e),$e.appendChild(Ge),document.body.appendChild($e)}function no(){lt&&(clearTimeout(lt),lt=null),$e&&$e.classList.remove("is-visible"),Ge&&(Ge.textContent="")}function Yt(){nt=null,je&&(clearTimeout(je),je=null),no()}function Er(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function _r(e,t,n){to(),nt={id:e,targetVersionIndex:t},je&&clearTimeout(je),je=setTimeout(()=>{je=null,Yt()},Se);const i=Er(n,t);ci(`Click again to open ${i} in this series.`,Se)}function ci(e,t=ct,n=null){if(to(),Ge.textContent="",Ge.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener",o.textContent=n,Ge.appendChild(i),Ge.appendChild(o)}$e.classList.add("is-visible"),lt&&clearTimeout(lt),lt=setTimeout(()=>no(),t)}function Sr(){ue&&(ue.innerHTML="",fr.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((o,c)=>{if(c>0){const u=document.createElement("span");u.className="shortcut-help__or",u.textContent="or",n.appendChild(u)}const a=document.createElement("div");a.className="shortcut-help__combo",o.forEach((u,d)=>{if(d>0){const g=document.createElement("span");g.className="shortcut-help__sep",g.textContent="+",a.appendChild(g)}const m=document.createElement("kbd");m.className="shortcut-help__key",m.textContent=u,a.appendChild(m)}),n.appendChild(a)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),ue.appendChild(t)}),ge=!0)}function kr(){return!!Z&&Z.hidden===!1}function Ir(){if(!Z)return;ge||Sr(),Ue=document.activeElement,Z.hidden=!1,Z.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Z.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function li(){if(!Z||Z.hidden)return;Z.hidden=!0,Z.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=Ue;e!=null&&e.focus?e.focus({preventScroll:!0}):N!=null&&N.focus&&N.focus({preventScroll:!0})}function xr(){if(!z)return;z.hidden=!1,z.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=z.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function di(){!z||z.hidden||(z.hidden=!0,z.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),re!=null&&re.focus&&re.focus({preventScroll:!0}))}let ui=!1;function _n(){ui||(ui=!0,requestAnimationFrame(()=>{ui=!1,mi(),tn()}))}let io=!1;function oo(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Cr(e){const t=oo(e);if(!t.length){p.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}p.querySelectorAll(".tile").forEach(n=>{var a;const i=(((a=n.querySelector(".name"))==null?void 0:a.textContent)||"").toLowerCase(),o=(n.dataset.id||"").toLowerCase(),c=t.every(u=>i.includes(u)||o.includes(u));n.style.opacity=c?"1":"0.2"})}function Ar(e){const t=oo(e);if(!t.length)return[];const n=[];return I.forEach((i,o)=>{var m;const c=Ki(i),a=ft(i)||"",u=`${c} ${a}`.toLowerCase();t.every(g=>u.includes(g))&&n.push({type:"model",modelIndex:o,modelTitle:c,modelId:a}),(Array.isArray((m=i.data)==null?void 0:m.categories)?i.data.categories:[]).forEach(g=>{const T=(g.title||g.id||"").toString();(g.items||[]).forEach(U=>{const W=(U.name||U.id||"").toString(),ve=`${W} ${U.id||""} ${T}`.toLowerCase();t.every(He=>ve.includes(He))&&n.push({type:"item",modelIndex:o,modelTitle:c,modelId:a,itemId:U.id,itemName:W,categoryTitle:T})})})}),n.slice(0,Bn)}function ro(e){if(!L)return;L.innerHTML="";const t=(e||"").toString();if(!t.trim()){L.hidden=!0;return}if(!I.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",L.appendChild(i),L.hidden=!1;return}const n=Ar(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",L.appendChild(i),L.hidden=!1;return}n.forEach(i=>{const o=document.createElement("button");o.type="button",o.className="search-result",o.dataset.modelIndex=String(i.modelIndex),i.itemId&&(o.dataset.itemId=i.itemId),i.type&&(o.dataset.type=i.type),i.modelIndex===_&&(!i.itemId||M===i.itemId)&&o.classList.add("is-active");const c=document.createElement("div");c.className="search-result__primary";const a=document.createElement("span");a.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",c.appendChild(a);const u=document.createElement("span");u.className="search-result__badge",u.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",c.appendChild(u);const d=document.createElement("div");d.className="search-result__meta";const m=document.createElement("span");if(m.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,d.appendChild(m),i.type==="item"&&i.itemId){const g=document.createElement("span");g.textContent=`Item ID: ${i.itemId}`,d.appendChild(g)}else if(i.type==="model"){const g=document.createElement("span");g.textContent="Matches model title",d.appendChild(g)}o.appendChild(c),o.appendChild(d),L.appendChild(o)}),L.hidden=!1}function so(e){Cr(e||""),ro(e||"")}function Nr(e){!e||!Number.isInteger(e.modelIndex)||(it(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(_!==e.modelIndex)return;const t=(n=Q.get(e.itemId))==null?void 0:n.el;t&&(tt(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function it(e){if(mt(),Yt(),me=null,e<0||e>=I.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}Gt=!0,_=e,console.log("[Blockscape] active model:",xe(I[e]),"(index",e+" )"),si(),Zt(),Nt(),It(),we&&so(we.value||""),fe.updateAvailability()}function Zt(){if(B.innerHTML="",!I.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",B.appendChild(e);return}I.forEach((e,t)=>{var T;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===_?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===_?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const c=document.createElement("span");c.className="model-nav-title",c.textContent=Ki(e),o.appendChild(c);const a=ft(e);if(a){const U=document.createElement("span");U.className="model-nav-id",U.textContent=a,o.appendChild(U)}const u=Array.isArray((T=e.data)==null?void 0:T.categories)?e.data.categories:[],d=u.reduce((U,W)=>U+(W.items||[]).length,0),m=document.createElement("span");m.className="model-nav-meta";const g=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";m.textContent=`${u.length} cat · ${d} items${g}`,i.appendChild(o),i.appendChild(m),n.appendChild(i),B.appendChild(n)}),fe.updateAvailability()}function Nt(){if(_<0){r.value="",j&&(j.disabled=!0);return}const e=I[_];r.value=JSON.stringify(e.data,null,2),j&&(j.disabled=!ai(e))}function Lr(e){try{return JSON.parse(e)}catch{return null}}function Tr(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const o=i.map((g,T)=>!g||typeof g!="object"?null:(Ut(g,{titleHint:`${t} #${T+1}`}),{obj:g,idx:T})).filter(Boolean);if(!o.length)return[];const c=o[0].obj,{seriesTitleOverride:a}=n;let u=a||c.title||`${t} series`;a&&!c.title&&(c.title=a);const d={id:Xe(),title:u,data:c,apicurioVersions:o.map(({obj:g,idx:T})=>({version:String(T+1),data:g})),apicurioActiveVersionIndex:0,isSeries:!0},m=at(d,{seriesName:u,fallbackTitle:u});return m&&(d.id=m),[d]}function ao(e,t="Pasted",n={}){return Array.isArray(e)?Tr(e,t,n):!e||typeof e!="object"?[]:(Ut(e,{titleHint:`${t} #1`}),[{id:Xe(),title:e.title||`${t} #1`,data:e}])}function Dt(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const o=Lr(i);if(o){let a=n;if(Array.isArray(o)&&n.promptForSeriesName){const d=pr(o,t),m=ur(d);a={...n,promptForSeriesName:!1,seriesTitleOverride:m||d}}const u=ao(o,t,a);if(u.length)return u}return i.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,u)=>{const d=JSON.parse(a);return Ut(d,{titleHint:`${t} #${u+1}`}),{id:Xe(),title:d.title||`${t} #${u+1}`,data:d}})}function $r(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function Qt(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!$r(e)}function Br(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function co(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(pe)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(pe)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(pe)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=Dt(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let i=null;return n.forEach(o=>{const c=At(o,{versionLabel:"editor"});i==null&&(i=c)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function lo(e="storage"){const t=co();return!t||typeof t.index!="number"?!1:(it(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function Mr(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let i;try{const a=St(t);i=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=ao(i.data,i.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let c=null;return o.forEach(a=>{const u=a.isSeries?i.title||a.title:null,d=At({...a,apicurioArtifactName:u||a.apicurioArtifactName},{versionLabel:"shared"});c==null&&(c=d)}),c}async function Or(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await gi(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function Pr(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(c=>(c.items||[]).forEach(a=>{i.add(a.id);const u=new Set(a.deps||[]);(e.links||[]).forEach(d=>{d.from===a.id&&u.add(d.to)}),t.set(a.id,u),u.forEach(d=>{n.has(d)||n.set(d,new Set),n.get(d).add(a.id)})}));const o=new Set;return n.forEach((c,a)=>{((c==null?void 0:c.size)||0)>=2&&o.add(a)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:i}}function Rr(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const o=n.getContext("2d"),c=(e||"?").charAt(0).toUpperCase(),a=eo(e,t),u=wr(a);return o.fillStyle=a,o.beginPath(),o.arc(i/2,i/2,i/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=u,o.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(c,i/2,i/2),n.toDataURL("image/png")}function Ft(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function uo(e){const t=Ft(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Vr(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var a,u;const o=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();o&&t.set(o,i);const c=(((u=n==null?void 0:n.data)==null?void 0:u.seriesId)??"").toString().trim();c&&!t.has(c)&&t.set(c,i)}),t}const po=new WeakMap;function Ur(e,t){var ht;if(!((ht=e==null?void 0:e.apicurioVersions)!=null&&ht[t]))return null;const n=e.apicurioVersions[t],i=n.data,o=Un(i),c=po.get(n);if(c&&c.fingerprint===o)return c.dataUrl;const a=160,u=90,d=document.createElement("canvas");d.width=a,d.height=u;const m=d.getContext("2d");m.fillStyle="#f8fafc",m.fillRect(0,0,a,u),m.strokeStyle="#e5e7eb",m.strokeRect(.5,.5,a-1,u-1);const g=Array.isArray(i==null?void 0:i.categories)?i.categories:[],T=Math.max(g.length,1),U=a/T,W=8,ve=8,He=4;g.forEach((ot,gt)=>{const rn=gt*U+U/2,Ve=Array.isArray(ot.items)?ot.items:[],Be=Math.max(Ve.length,1);Ve.forEach((Jt,_o)=>{const bi=W+(_o+.5)*((u-W-ve)/Be);m.beginPath(),m.arc(rn,bi,He,0,Math.PI*2);const In=eo(Jt.name||Jt.id||"",Jt.color);m.fillStyle=In,m.strokeStyle="rgba(15,23,42,0.25)",m.fill(),m.stroke()})});const Ye=d.toDataURL("image/png");return po.set(n,{fingerprint:o,dataUrl:Ye}),Ye}function pi(e,t){var u;if(Yt(),e<0||e>=I.length)return!1;const n=I[e];if(!((u=n==null?void 0:n.apicurioVersions)!=null&&u.length)||!Xi(e))return!1;const o=n.apicurioVersions.length,c=(t%o+o)%o,a=n.apicurioVersions[c];return a!=null&&a.data?(n.apicurioActiveVersionIndex=c,n.data=a.data,Gt=!0,M=null,Te=null,Ct(),Nt(),It(),!0):!1}function fi(e){var i;if(!e||_<0)return!1;const t=I[_];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return!1;const n=Ft(t);return n===-1?!1:pi(_,n+e)}function Hr(e,t){if(Yt(),e<0||e>=I.length)return!1;const n=I[e];if(!Array.isArray(n==null?void 0:n.apicurioVersions)||n.apicurioVersions.length<=1)return alert("A series needs at least one map. Add another before removing this one."),!1;if(!Xi(e))return!1;const i=Math.min(Math.max(t,0),n.apicurioVersions.length-1),o=Ft(n),[c]=n.apicurioVersions.splice(i,1);if(!c)return!1;let a=o;i===o?a=Math.min(i,n.apicurioVersions.length-1):i<o&&(a=Math.max(0,o-1)),n.apicurioActiveVersionIndex=Math.max(0,a);const u=n.apicurioVersions[n.apicurioActiveVersionIndex];return n.data=(u==null?void 0:u.data)||n.data,n.isSeries=n.apicurioVersions.length>1,it(e),!0}function Dr(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||ft(e)||"Artifact",t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const o=Ft(e),c=uo(e)||"latest";i.textContent=`No. in series ${c} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const a=document.createElement("div");a.className="version-nav__controls";const u=document.createElement("button");u.type="button",u.className="version-nav__button",u.textContent="Previous",u.addEventListener("click",()=>fi(-1));const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Next",d.addEventListener("click",()=>fi(1)),a.appendChild(u),a.appendChild(d),t.appendChild(a);const m=document.createElement("div");m.className="version-nav__thumbs",e.apicurioVersions.forEach((U,W)=>{var rn;const ve=document.createElement("button");ve.type="button",ve.className="version-nav__thumb",W===o&&ve.classList.add("is-active");const He=Ur(e,W);if(He){const Ve=document.createElement("img");Ve.src=He,Ve.alt=`Version ${W+1}`,ve.appendChild(Ve)}const Ye=document.createElement("div");Ye.className="version-nav__thumb-label";const ht=document.createElement("span");ht.className="version-nav__thumb-label-text";const ot=(((rn=U==null?void 0:U.data)==null?void 0:rn.id)??(U==null?void 0:U.id)??"").toString().trim(),gt=ot||(U!=null&&U.version?`v${U.version}`:`${W+1}`);if(ht.textContent=gt,Ye.title=ot||gt,Ye.appendChild(ht),ve.appendChild(Ye),Wr(Ye,ht),e.apicurioVersions.length>1){const Ve=document.createElement("span");Ve.className="version-nav__thumb-remove",Ve.title=`Remove ${gt} from this series`,Ve.setAttribute("aria-label",`Remove ${gt} from this series`),Ve.setAttribute("role","button"),Ve.tabIndex=-1,Ve.textContent="×",Ve.addEventListener("click",Be=>{Be.stopPropagation(),Be.preventDefault(),window.confirm(`Remove ${gt} from this series?`)&&Hr(_,W)}),ve.appendChild(Ve)}ve.addEventListener("click",()=>pi(_,W)),Gr(ve,U),m.appendChild(ve)});const g=document.createElement("button");g.type="button",g.className="version-nav__thumb version-nav__thumb--add",g.title="Create a new version from this map",g.addEventListener("click",()=>{try{const U=Zi({versionLabel:"manual"});it(U)}catch(U){alert((U==null?void 0:U.message)||"Unable to create a new version right now.")}});const T=document.createElement("span");return T.className="version-nav__thumb-add-icon",T.textContent="+",g.appendChild(T),m.appendChild(g),t.appendChild(m),t}function en(){var No,Lo,To;if(!J)return;kt(),Array.isArray(J.m.categories)||(J.m.categories=[]),console.log("[Blockscape] rendering categories=",J.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!J.m.abstract,"- value:",J.m.abstract?J.m.abstract.substring(0,50)+"...":"none"),p.innerHTML="",Q.clear(),Ot=[],Hn(I[_],{versionLabel:"1"});const e=Dr(I[_]);e&&p.appendChild(e),k.setAttribute("width",window.innerWidth),k.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=J.m.title&&J.m.title.trim()||xe(I[_]),t.appendChild(n),((No=I[_])!=null&&No.isSeries||(To=(Lo=I[_])==null?void 0:Lo.apicurioVersions)!=null&&To.length)&&at(I[_],{seriesName:I[_].title||J.m.title||xe(I[_])});const i=uo(I[_]),o=An(I[_]),c=(J.m.id??"").toString().trim(),a=document.createElement("div");a.className="blockscape-model-meta__details";const u=(S,ne)=>{if(!ne)return;const Y=document.createElement("div");Y.className="blockscape-model-id";const We=document.createElement("span");We.className="blockscape-model-id__label",We.textContent=S;const st=document.createElement("span");st.className="blockscape-model-id__value",st.textContent=ne,Y.append(We,st),a.appendChild(Y)};u("Series ID",o),u("Model ID",c),u("No. in series",i),a.childElementCount&&t.appendChild(a),p.appendChild(t);const d=document.createElement("div");d.className="blockscape-tabs";const m=document.createElement("div");m.className="blockscape-tablist",m.setAttribute("role","tablist"),d.appendChild(m);const g=document.createElement("div");g.className="blockscape-tabpanels",d.appendChild(g);const T=document.createElement("div"),U=document.createElement("div"),W=document.createElement("div"),ve=document.createElement("div");let He="";const Ye=Vr(I[_]),ht=Ft(I[_]);ye=null,$t="";const ot=[{id:"map",label:"Map",panel:T},{id:"abstract",label:"Info",panel:U},{id:"source",label:"Settings",panel:W},{id:"apicurio",label:"Apicurio",panel:ve}],gt=typeof fe.isEnabled=="function"?fe.isEnabled():!1,rn=S=>{if(!k)return;const ne=S==="map";k.hidden=!ne,ne?(mi(),tn()):k.innerHTML=""};ot.forEach((S,ne)=>{const Y=document.createElement("button");Y.type="button",Y.id=`tab-${S.id}`,Y.className="blockscape-tab"+(ne===0?" is-active":""),Y.setAttribute("role","tab"),Y.setAttribute("aria-controls",`panel-${S.id}`),Y.setAttribute("aria-selected",ne===0?"true":"false"),Y.textContent=S.label,S.id==="apicurio"&&!gt&&(Y.hidden=!0,Y.tabIndex=-1,Y.setAttribute("aria-hidden","true"),Y.style.display="none"),S.button=Y,m.appendChild(Y),S.panel.id=`panel-${S.id}`,S.panel.classList.add("blockscape-tabpanel"),S.panel.setAttribute("role","tabpanel"),S.panel.setAttribute("aria-labelledby",Y.id),S.panel.hidden=ne!==0,ne===0&&S.panel.classList.add("is-active"),g.appendChild(S.panel)});const Ve=S=>{Ee=S,ot.forEach(ne=>{const Y=ne.id===S;ne.button.classList.toggle("is-active",Y),ne.button.setAttribute("aria-selected",Y?"true":"false"),ne.panel.classList.toggle("is-active",Y),ne.panel.hidden=!Y}),rn(S)},Be=ot.find(S=>S.id==="apicurio"),Jt=S=>{if(!Be||!Be.button||!Be.panel)return;const ne=!!S;if(Be.button.hidden=!ne,Be.button.tabIndex=ne?0:-1,Be.button.setAttribute("aria-hidden",ne?"false":"true"),Be.button.style.display=ne?"":"none",ne){const Y=Ee==="apicurio";Be.button.classList.toggle("is-active",Y),Be.button.setAttribute("aria-selected",Y?"true":"false"),Be.panel.classList.toggle("is-active",Y),Be.panel.hidden=!Y}else{const Y=Be.panel.classList.contains("is-active");if(Be.button.classList.remove("is-active"),Be.button.setAttribute("aria-selected","false"),Be.panel.classList.remove("is-active"),Be.panel.hidden=!0,Y){const We=ot.find(st=>st.id!=="apicurio");We&&Ve(We.id)}}pn&&(pn.checked=ne)};ot.forEach(S=>{S.button.addEventListener("click",()=>{kt(),Ve(S.id)}),S.id==="abstract"&&(ye=S.button,S.button.addEventListener("mouseenter",()=>Sn(S.button,He,{offset:12})),S.button.addEventListener("mouseleave",kt),S.button.addEventListener("focus",()=>Sn(S.button,He,{offset:12})),S.button.addEventListener("blur",kt))});const bi=(S=>{const ne=ot.find(We=>We.id===Ee);if(ne&&(ne.id!=="apicurio"||S))return ne.id;const Y=ot.find(We=>We.id!=="apicurio"||S);return(Y==null?void 0:Y.id)||ot[0].id})(gt);Ve(bi),Jt(gt),typeof fe.onEnabledChange=="function"&&fe.onEnabledChange(Jt),p.appendChild(d);const In=document.createElement("div");In.className="blockscape-render",T.appendChild(In);const Jn=document.createElement("div");if(Jn.className="blockscape-abstract-panel",J.m.abstract){console.log("[Blockscape] Rendering abstract content");const S=document.createElement("div");S.className="blockscape-abstract",S.innerHTML=J.m.abstract,ms(S),Jn.appendChild(S),He=S.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const S=document.createElement("div");S.className="blockscape-abstract-placeholder",S.textContent="No abstract has been provided for this model.",Jn.appendChild(S),He=S.outerHTML}$t=He,U.appendChild(Jn);const xn=document.createElement("div");xn.className="blockscape-source-panel";const dt=document.createElement("div");dt.className="blockscape-settings-panel";const vi=document.createElement("p");vi.className="blockscape-settings-panel__title",vi.textContent="Feature toggles",dt.appendChild(vi);const jn=({id:S,label:ne,hint:Y,checked:We,className:st="",onChange:Me})=>{const _t=document.createElement("label");_t.className=["settings-toggle",st].filter(Boolean).join(" ");const Ce=document.createElement("input");Ce.type="checkbox",Ce.id=S,Ce.checked=We;const ut=document.createElement("span");ut.className="settings-toggle__text";const jt=document.createElement("span");if(jt.className="settings-toggle__label",jt.textContent=ne,ut.appendChild(jt),Y){const Wt=document.createElement("span");Wt.className="settings-toggle__hint",Wt.textContent=Y,ut.appendChild(Wt)}return _t.appendChild(Ce),_t.appendChild(ut),typeof Me=="function"&&Ce.addEventListener("change",()=>Me(Ce.checked)),{row:_t,input:Ce}},{row:vs}=jn({id:"toggleSecondaryLinks",label:"Show indirect links",checked:Je,className:"map-controls__toggle",onChange:S=>{Je=S,M?tt(M):(hi(),tn())}});dt.appendChild(vs);const{row:ws}=jn({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:Pe,className:"map-controls__toggle",onChange:S=>{Pe=S,mo()}});dt.appendChild(ws);const So=S=>`${(S/1e3).toFixed(1)}s`,Wn=document.createElement("label");Wn.className="settings-slider",Wn.setAttribute("for","seriesNavDoubleClickWait");const wi=document.createElement("div");wi.className="settings-slider__text";const yi=document.createElement("span");yi.className="settings-slider__label",yi.textContent="Series double-click wait";const Ei=document.createElement("span");Ei.className="settings-slider__hint",Ei.textContent="Time window to double-click into another map version.",wi.append(yi,Ei);const qn=document.createElement("span");qn.className="settings-slider__value",qn.textContent=So(Se);const bt=document.createElement("input");bt.type="range",bt.id="seriesNavDoubleClickWait",bt.className="settings-slider__input",bt.min=String(Ke),bt.max=String(de),bt.step="50",bt.value=String(Se),bt.setAttribute("aria-label","Adjust double-click wait for series navigation"),bt.addEventListener("input",()=>{const S=En(parseInt(bt.value,10));qn.textContent=So(S),lr(S)}),Wn.append(wi,qn,bt),dt.appendChild(Wn);const ko=S=>`${Math.round((S-1)*100)}%`,Gn=document.createElement("label");Gn.className="settings-slider",Gn.setAttribute("for","hoverScaleSlider");const _i=document.createElement("div");_i.className="settings-slider__text";const Si=document.createElement("span");Si.className="settings-slider__label",Si.textContent="Hover zoom";const ki=document.createElement("span");ki.className="settings-slider__hint",ki.textContent="Expand tiles on hover to see more detail.",_i.append(Si,ki);const zn=document.createElement("span");zn.className="settings-slider__value",zn.textContent=ko(q);const vt=document.createElement("input");vt.type="range",vt.id="hoverScaleSlider",vt.className="settings-slider__input",vt.min=String(On),vt.max=String(mn),vt.step="0.1",vt.value=String(q),vt.setAttribute("aria-label","Adjust hover zoom"),vt.addEventListener("input",()=>{const S=gn(parseFloat(vt.value));zn.textContent=ko(S),Zo(S),M&&_n()}),Gn.append(_i,zn,vt),dt.appendChild(Gn);const Io=S=>S===1?"Default":`${Math.round(S*100)}%`,Kn=document.createElement("label");Kn.className="settings-slider",Kn.setAttribute("for","tileCompactnessSlider");const Ii=document.createElement("div");Ii.className="settings-slider__text";const xi=document.createElement("span");xi.className="settings-slider__label",xi.textContent="Tile compactness";const Ci=document.createElement("span");Ci.className="settings-slider__hint",Ci.textContent="Adjust padding, gap, and logo size for tiles.",Ii.append(xi,Ci);const Xn=document.createElement("span");Xn.className="settings-slider__value",Xn.textContent=Io(X);const wt=document.createElement("input");wt.type="range",wt.id="tileCompactnessSlider",wt.className="settings-slider__input",wt.min=String($),wt.max=String(ee),wt.step="0.05",wt.value=String(X),wt.setAttribute("aria-label","Adjust tile compactness"),wt.addEventListener("input",()=>{const S=bn(parseFloat(wt.value));Xn.textContent=Io(S),er(S),M&&_n()}),Kn.append(Ii,Xn,wt),dt.appendChild(Kn);const{row:ys}=jn({id:"titleWrapToggle",label:"Wrap titles",hint:"Allow long titles to wrap instead of truncating.",checked:be!=="nowrap",className:"map-controls__toggle",onChange:S=>{const ne=S?"wrap":"nowrap";yn(ne),sr(ne)}});dt.appendChild(ys);const xo=S=>`${Math.round((S-1)*100)}% extra`,Yn=document.createElement("label");Yn.className="settings-slider",Yn.setAttribute("for","titleHoverWidthSlider");const Ai=document.createElement("div");Ai.className="settings-slider__text";const Ni=document.createElement("span");Ni.className="settings-slider__label",Ni.textContent="Title width on hover";const Li=document.createElement("span");Li.className="settings-slider__hint",Li.textContent="Give titles more room horizontally when zoomed.",Ai.append(Ni,Li);const Zn=document.createElement("span");Zn.className="settings-slider__value",Zn.textContent=xo(ke);const yt=document.createElement("input");yt.type="range",yt.id="titleHoverWidthSlider",yt.className="settings-slider__input",yt.min=String(s),yt.max=String(f),yt.step="0.05",yt.value=String(ke),yt.setAttribute("aria-label","Adjust title width boost on hover"),yt.addEventListener("input",()=>{const S=vn(parseFloat(yt.value));Zn.textContent=xo(S),nr(S)}),Yn.append(Ai,Zn,yt),dt.appendChild(Yn);const Co=S=>`${Math.round(S*100)}% of hover zoom`,Qn=document.createElement("label");Qn.className="settings-slider",Qn.setAttribute("for","titleZoomPortionSlider");const Ti=document.createElement("div");Ti.className="settings-slider__text";const $i=document.createElement("span");$i.className="settings-slider__label",$i.textContent="Title zoom influence";const Bi=document.createElement("span");Bi.className="settings-slider__hint",Bi.textContent="How much the title scales relative to tile hover zoom.",Ti.append($i,Bi);const ei=document.createElement("span");ei.className="settings-slider__value",ei.textContent=Co(te);const Et=document.createElement("input");Et.type="range",Et.id="titleZoomPortionSlider",Et.className="settings-slider__input",Et.min=String(E),Et.max=String(h),Et.step="0.05",Et.value=String(te),Et.setAttribute("aria-label","Adjust how much titles scale on hover"),Et.addEventListener("input",()=>{const S=wn(parseFloat(Et.value));ei.textContent=Co(S),or(S)}),Qn.append(Ti,ei,Et),dt.appendChild(Qn);const Es=typeof fe.isEnabled=="function"?fe.isEnabled():!1,{row:_s,input:Ss}=jn({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:Es,className:"apicurio-toggle",onChange:S=>{typeof fe.setEnabled=="function"&&fe.setEnabled(S)}});if(pn=Ss,dt.appendChild(_s),xn.appendChild(dt),l)l.hidden=!1,l.classList.remove("pf-v5-c-page__main-section"),xn.appendChild(l);else{const S=document.createElement("p");S.className="muted",S.textContent="Source editor unavailable.",xn.appendChild(S)}W.appendChild(xn),fe.mount(ve);let Ao=0;J.m.categories.forEach(S=>{const ne=document.createElement("section");ne.className="category",ne.dataset.cat=S.id;const Y=document.createElement("div");Y.className="cat-head",Y.innerHTML=`<div class="cat-title">${nn(S.title||S.id)}</div>
                          <div class="muted cat-count">${(S.items||[]).length} items</div>`,ne.appendChild(Y);const We=document.createElement("div");We.className="grid",ne.appendChild(We),(S.items||[]).forEach(Me=>{Ao+=1;const _t=Jr(Me.external),Ce=document.createElement("div");if(Ce.className=_t.isExternal?"tile external":"tile",Ce.tabIndex=0,Ce.dataset.id=Me.id,Ce.dataset.globalIndex=String(Ao),_t.url&&(Ce.dataset.externalUrl=_t.url),Ye.has(Me.id)){const Cn=Ye.get(Me.id);Ce.dataset.seriesVersionIndex=String(Cn),Ce.classList.add("tile--series-link");const ks=Cn===ht?"Current map in this series":`Open version ${Cn+1} in this series`;Ce.title=ks}const ut=document.createElement("img");ut.className="logo",Me.logo?(ut.src=Me.logo,ut.alt=Me.name||Me.id):(ut.alt="",ut.style.opacity=1,ut.src=Rr(Me.name||Me.id,Me.color));const jt=document.createElement("div");jt.className="name",jt.textContent=Me.name||Me.id;const Wt=document.createElement("div");Wt.className="tile-id",Wt.textContent=Me.id||"";const Mi=document.createElement("div");Mi.className="badge",Mi.textContent="reused";const sn=document.createElement("button");sn.type="button",sn.className="tile-delete",sn.setAttribute("aria-label",`Delete ${Me.name||Me.id}`),sn.textContent="×",sn.addEventListener("click",Cn=>{Cn.stopPropagation(),ds(Me.id)}),_t.url&&Ce.appendChild(jr(_t.url)),Ce.appendChild(sn),Ce.appendChild(ut),Ce.appendChild(jt),Ce.appendChild(Wt),Ce.appendChild(Mi),We.appendChild(Ce),Q.set(Me.id,{el:Ce,catId:S.id,rect:null})}),In.appendChild(ne);const st=document.createElement("button");st.type="button",st.className="tile-add",st.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',st.addEventListener("click",()=>os(S.id)),We.appendChild(st)}),mo(),Fr(),mi(),tn(),zr()}function Fr(){p.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",n=>{var g;if(typeof n.button=="number"&&n.button!==0)return;mt();const i=e.dataset.id,o=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,c=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,a=I[_],u=a?Ft(a):-1,d=((g=a==null?void 0:a.apicurioVersions)==null?void 0:g.length)>1&&Number.isInteger(o)&&o!==u,m=nt&&nt.id===i&&nt.targetVersionIndex===o;if(nt&&!m&&Yt(),d)if(m){if(Yt(),pi(_,o))return}else _r(i,o,a);else Number.isInteger(c)&&c>0&&c%5===0&&ci("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",i),M===i&&!(d&&m)){Fn();return}tt(i)}),e.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())});const t=()=>{M&&_n()};e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",t),e.addEventListener("focus",t),e.addEventListener("blur",t),e.draggable=!0,e.addEventListener("dragstart",Zr),e.addEventListener("dragend",Qr)}),p.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",es),e.addEventListener("drop",is),e.addEventListener("dragenter",ts),e.addEventListener("dragleave",ns)}),io||(io=!0,window.addEventListener("resize",_n),window.addEventListener("scroll",_n,{passive:!0}),window.addEventListener("resize",go)),document.getElementById("clear").onclick=()=>Fn()}function mi(){Q.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function fo(e,{includeSecondary:t=Je}={}){if(!e||!J)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(J.fwd.get(e)||[]),i=new Set(J.rev.get(e)||[]),o=new Set,c=new Set,a=[],u=new Set,d=(m,g,T,U)=>{if(!m||!g)return;const W=`${m}->${g}:${T}:${U}`;u.has(W)||(u.add(W),a.push({from:m,to:g,type:T,depth:U}))};return n.forEach(m=>d(e,m,"dep",1)),i.forEach(m=>d(e,m,"revdep",1)),t&&new Set([...n,...i]).forEach(g=>{(J.fwd.get(g)||new Set).forEach(W=>{const ve=W===e;ve||o.add(W),ve||d(g,W,"dep",2)}),(J.rev.get(g)||new Set).forEach(W=>{const ve=W===e;ve||c.add(W),ve||d(g,W,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:o,secondaryRevs:c,edges:a}}function Dn(e,t){const n=Q.get(e);n&&n.el.classList.add(t)}function tt(e){var u,d,m;M=e,Te=fo(e),Ct(),hi();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:o}=Te;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const c=Q.get(e);c&&c.el.classList.add("selected"),t.forEach(g=>Dn(g,"dep")),n.forEach(g=>Dn(g,"revdep")),i.forEach(g=>{!t.has(g)&&g!==e&&Dn(g,"dep-indirect")}),o.forEach(g=>{!n.has(g)&&!t.has(g)&&g!==e&&Dn(g,"revdep-indirect")}),tn();const a=(m=(d=(u=Q.get(e))==null?void 0:u.el)==null?void 0:d.dataset)==null?void 0:m.externalUrl;a&&ci("This item has link to",ct,a)}function Fn(){M=null,Te=null,Ct(),hi(),tn()}function hi(){p.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function mo(){J!=null&&J.reusedLocal&&J.reusedLocal.forEach(e=>{const t=Q.get(e);if(!t)return;t.el.classList.toggle("reused",Pe);const n=t.el.querySelector(".badge");n&&(n.style.display=Pe?"inline-block":"none")})}function tn(){for(;k.firstChild;)k.removeChild(k.firstChild);if(!M||k.hidden)return;Te=fo(M),Te.edges.forEach(t=>{var T,U;const n=(T=Q.get(t.from))==null?void 0:T.rect,i=(U=Q.get(t.to))==null?void 0:U.rect;if(!n||!i)return;const o=ho(n),c=ho(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),u=(o.x+c.x)/2,d=o.y,m=(o.x+c.x)/2,g=c.y;a.setAttribute("d",`M ${o.x},${o.y} C ${u},${d} ${m},${g} ${c.x},${c.y}`),a.setAttribute("fill","none"),a.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),a.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),a.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&a.setAttribute("stroke-dasharray","4 3"),a.setAttribute("vector-effect","non-scaling-stroke"),k.appendChild(a)})}function ho(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function nn(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Jr(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function jr(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function go(){fn||(fn=requestAnimationFrame(()=>{fn=null,Ot=Ot.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),Ot.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function Wr(e,t){!e||!t||(Ot.push({labelEl:e,textEl:t}),go())}function qr(e,t){var c,a;const n=[`<div class="version-nav__tooltip-title">${nn(t)}</div>`],i=((e==null?void 0:e.version)??((c=e==null?void 0:e.data)==null?void 0:c.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${nn(i)}</div>`);const o=(((a=e==null?void 0:e.data)==null?void 0:a.abstract)??"").toString().trim();return o?n.push(`<div class="version-nav__tooltip-body">${o}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function Sn(e,t,{offset:n=8}={}){!w||!e||!t||(w.innerHTML=t,w.hidden=!1,w.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),o=w.getBoundingClientRect(),c=window.scrollX||document.documentElement.scrollLeft,a=window.scrollY||document.documentElement.scrollTop;let u=i.left+i.width/2-o.width/2+c,d=i.top-o.height-n+a;u<c+n&&(u=c+n);const m=c+window.innerWidth-o.width-n;u>m&&(u=m),d<a+n&&(d=i.bottom+n+a),w.style.left=`${u}px`,w.style.top=`${d}px`,w.classList.add("is-visible")}))}function kt(){ae&&(clearTimeout(ae),ae=null),w&&(w.classList.remove("is-visible"),w.setAttribute("aria-hidden","true"),w.hidden=!0)}function Gr(e,t){if(!e)return;const n=xe((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=qr(t,n);let o=null;const c=()=>{o&&(clearTimeout(o),o=null)},a=()=>{Mt=e,Sn(e,`<div class="version-nav__tooltip-title">${nn(n)}</div>`,{offset:10})},u=()=>{c(),o=setTimeout(()=>{Mt===e&&Sn(e,i,{offset:10})},zt)},d=()=>{a(),u()},m=()=>{Mt!==e&&a(),u()},g=()=>{c(),Mt===e&&(Mt=null,kt())};e.addEventListener("mouseenter",d),e.addEventListener("focus",d),e.addEventListener("pointermove",m),e.addEventListener("mouseleave",g),e.addEventListener("blur",g),e.addEventListener("click",g)}function zr(){Gt&&(Gt=!1,!(!ye||!$t)&&(kt(),Sn(ye,$t,{offset:12}),ae=setTimeout(()=>{kt(),Kr()},1e3)))}function Kr(){ye&&(Bt&&(clearTimeout(Bt),Bt=null),ye.classList.add("blockscape-tab--twinkle"),Bt=setTimeout(()=>{ye.classList.remove("blockscape-tab--twinkle"),Bt=null},1400))}window.addEventListener("scroll",kt,!0),window.addEventListener("resize",kt);function mt(){A&&(A.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),A.setAttribute("aria-hidden","true"),A.hidden=!0,bo([]))}function Xr(e,t){A&&(Ne={x:e,y:t},A.hidden=!1,A.setAttribute("aria-hidden","false"),A.classList.add("is-visible"),on(e,t))}function on(e,t){if(!A)return;const n=12;A.style.left=`${e+n}px`,A.style.top=`${t+n}px`;const i=A.getBoundingClientRect();let o=i.left,c=i.top;i.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(c=Math.max(n,window.innerHeight-i.height-n)),A.style.left=`${o}px`,A.style.top=`${c}px`}function bo(e=[]){ce&&(ce.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),ce.appendChild(n)}),ce.hidden=e.length===0)}async function Yr(e,t){var m;if(!A)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((m=t.querySelector(".name"))==null?void 0:m.textContent)||n||"Preview",o=n?`${n}.html`:"",c=o?`items/${o}`:"",a=++Re,u=t.dataset.externalUrl||"",d=[{label:"Edit",title:"Edit this item",onClick:()=>{mt(),Ht.open(n)}}];if(u&&d.push({label:"Open link ↗",title:u,onClick:()=>window.open(u,"_blank","noopener")}),bo(d),n&&tt(n),oe.textContent=i,D.innerHTML='<div class="item-preview__status">Loading…</div>',A.classList.remove("item-preview--has-frame"),A.classList.add("item-preview--expanded"),Xr(e.clientX,e.clientY),!c){D.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',on(Ne.x,Ne.y);return}try{const g=await fetch(c,{cache:"no-cache"});if(!g.ok)throw new Error(`HTTP ${g.status}`);const T=await g.text();if(a!==Re)return;if(!T.trim()){D.innerHTML=`<div class="item-preview__status">No content in <code>${nn(o)}</code>.</div>`,on(Ne.x,Ne.y);return}const W=document.createElement("iframe");W.className="item-preview__frame",W.title=`${i} details`,W.srcdoc=T,D.innerHTML="",D.appendChild(W),A.classList.add("item-preview--has-frame"),on(Ne.x,Ne.y)}catch(g){if(a!==Re)return;D.innerHTML=`<div class="item-preview__status">No preview available for <strong>${nn(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${c}`,g),on(Ne.x,Ne.y)}}le&&le.addEventListener("click",mt),N&&N.addEventListener("click",()=>{Ir()}),re&&re.addEventListener("click",()=>{xr()}),se&&se.addEventListener("click",li),he&&he.addEventListener("click",li),Le&&Le.addEventListener("click",di),qe&&qe.addEventListener("click",di),p&&p.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!p.contains(t)||Yr(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!A||A.hidden||A.contains(e.target)||mt()}),Ae&&Ae.addEventListener("click",()=>{Qi("button")}),F&&F.addEventListener("click",()=>{if(_<0){alert("Load or select a model before creating a version.");return}try{const e=Zi({versionLabel:"map edit"});it(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),R&&R.addEventListener("click",async()=>{var c;if(_<0||!I[_]){alert("Select or load a model before sharing.");return}const e={title:xe(I[_],"Shared Model"),data:I[_].data};let t;try{t=et(JSON.stringify(e))}catch(a){console.error("[Blockscape] share encode failed",a),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(a){console.warn("[Blockscape] failed to update URL for share",a),window.location.hash=n.hash}let o=!1;if((c=navigator.clipboard)!=null&&c.writeText)try{await navigator.clipboard.writeText(i),o=!0}catch(a){console.warn("[Blockscape] clipboard write failed",a)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),K&&K.addEventListener("click",()=>{const e=(r.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};M&&(n.selectedItemId=M),localStorage.setItem(pe,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";M&&(t=`editor.html?selected=${encodeURIComponent(M)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==pe||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||lo("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===Fe&&lo("message")})),document.addEventListener("keydown",e=>{var n,i,o,c,a,u;if(kr()){e.key==="Escape"&&(e.preventDefault(),li());return}if(!(z!=null&&z.hidden)&&e.key==="Escape"){e.preventDefault(),di();return}if(!((n=Ht==null?void 0:Ht.isOpen)!=null&&n.call(Ht))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const d=I[_],m=((i=d==null?void 0:d.apicurioVersions)==null?void 0:i.length)>1;Qi("shortcut",m);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!Qt())return;if(ls()){e.preventDefault();return}}if(e.key==="Escape"){let d=!1;A&&!A.hidden&&(mt(),d=!0),M&&(Fn(),d=!0),d&&e.preventDefault()}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!Qt())return;const d=e.key==="ArrowLeft"?-1:1;if(e.altKey)return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){fi(d)&&e.preventDefault();return}if(e.ctrlKey||e.metaKey)return;e.shiftKey?rs(d)&&e.preventDefault():ss(d)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!Qt()||e.altKey||e.ctrlKey||e.metaKey)return;const d=e.key==="ArrowUp"?-1:1;e.shiftKey?cs(d)&&e.preventDefault():as(d)&&e.preventDefault()}if(e.key==="Delete"){if(!Qt()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;wo()&&e.preventDefault()}if(e.key==="F2"){if(!Qt())return;const d=M||((u=(a=(c=(o=e.target)==null?void 0:o.closest)==null?void 0:c.call(o,".tile"))==null?void 0:a.dataset)==null?void 0:u.id);d&&Ht.open(d)&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!A||A.hidden||on(Ne.x,Ne.y)}),window.addEventListener("scroll",()=>{!A||A.hidden||mt()},!0);let Lt=null,kn=null;function Zr(e){mt(),Lt=e.target.dataset.id,kn=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:Lt,categoryId:kn})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",Lt,"from",kn)}function Qr(e){e.target.classList.remove("dragging"),p.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),p.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),Lt=null,kn=null}function es(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function ts(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function ns(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function is(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!Lt||!i)return;const c=Array.from(t.querySelectorAll(".tile")).filter(a=>a.dataset.id!==Lt).find(a=>{const u=a.getBoundingClientRect();return e.clientY<u.top+u.height/2});vo(Lt,c?c.dataset.id:null,i),en(),console.log("[Blockscape] drop completed",Lt,"from",kn,"to",i)}function vo(e,t,n){if(_<0)return;const o=I[_].data.categories||[],c=o.find(g=>(g.items||[]).some(T=>T.id===e)),a=o.find(g=>g.id===n);if(!c||!a)return;c.items=c.items||[],a.items=a.items||[];const u=c.items.findIndex(g=>g.id===e);if(u===-1)return;const[d]=c.items.splice(u,1);let m=a.items.length;if(t){const g=a.items.findIndex(T=>T.id===t);g!==-1&&(m=g)}a.items.splice(m,0,d),Nt(),It()}function os(e){if(_<0||!e)return;const t=I[_].data,i=(t.categories||[]).find(d=>d.id===e);if(!i)return;i.items=i.items||[];const o=`New item ${i.items.length+1}`,a={id:gr(`${e}-${i.items.length+1}`,t),name:o,deps:[]};i.items.push(a),Nt(),It(),mt(),tt(a.id);const u=Q.get(a.id);u!=null&&u.el&&u.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",a.id,"to",e)}function rs(e){if(!M||_<0||!e)return!1;const n=I[_].data.categories||[],i=Q.get(M);let o=null;if(i!=null&&i.catId&&(o=n.find(d=>d.id===i.catId)),o||(o=n.find(d=>(d.items||[]).some(m=>m.id===M))),!o)return!1;o.items=o.items||[];const c=o.items.findIndex(d=>d.id===M);if(c===-1)return!1;const a=c+e;if(a<0||a>=o.items.length)return!1;const[u]=o.items.splice(c,1);return o.items.splice(a,0,u),Nt(),It(),en(),tt(M),!0}function ss(e){if(!J||!J.m||!e)return!1;const t=J.m.categories||[];if(!t.length)return!1;const n=()=>{const d=t.find(m=>(m.items||[]).length);return d?{category:d,item:d.items[0]}:null};if(!M){const d=n();return d?(tt(d.item.id),!0):!1}const i=Q.get(M);let o=null;if(i!=null&&i.catId&&(o=t.find(d=>d.id===i.catId)),o||(o=t.find(d=>(d.items||[]).some(m=>m.id===M))),!o){const d=n();return d?(tt(d.item.id),!0):!1}const c=o.items||[];if(!c.length)return!1;const a=c.findIndex(d=>d.id===M);if(a===-1)return!1;const u=a+e;return u<0||u>=c.length?!1:(tt(c[u].id),!0)}function as(e){if(!J||!J.m||!e)return!1;const t=J.m.categories||[];if(!t.length)return!1;const n=()=>{for(const d of t)if(d.items&&d.items.length)return d.items[0].id;return null};let o=(()=>{if(!M)return-1;const d=Q.get(M);if(d!=null&&d.catId){const m=t.findIndex(g=>g.id===d.catId);if(m!==-1)return m}return t.findIndex(m=>(m.items||[]).some(g=>g.id===M))})();if(o===-1){const d=n();return d?(tt(d),!0):!1}let a=(t[o].items||[]).findIndex(d=>d.id===M);a===-1&&(a=0);let u=o+e;for(;u>=0&&u<t.length;){const m=t[u].items||[];if(m.length){const g=Math.min(m.length-1,Math.max(0,a));return tt(m[g].id),!0}u+=e>0?1:-1}return!1}function cs(e){if(!M||_<0||!e)return!1;const n=I[_].data.categories||[];if(!n.length)return!1;const i=Q.get(M);let o=-1;if(i!=null&&i.catId&&(o=n.findIndex(T=>T.id===i.catId)),o===-1&&(o=n.findIndex(T=>(T.items||[]).some(U=>U.id===M))),o===-1)return!1;const c=o+e;if(c<0||c>=n.length)return!1;const a=n[o],u=n[c];if(!u)return!1;a.items=a.items||[],u.items=u.items||[];const d=a.items.findIndex(T=>T.id===M);if(d===-1)return!1;const m=Math.min(u.items.length,Math.max(0,d)),g=m<u.items.length?u.items[m].id:null;return vo(M,g,u.id),en(),tt(M),!0}function ls(){if(!me||_<0)return!1;const e=I[_];if(!e||e.id!==me.modelId)return!1;const t=me,o=(e.data.categories||[]).find(a=>a.id===t.categoryId);if(!o)return!1;o.items=o.items||[];const c=Math.min(Math.max(t.index,0),o.items.length);return o.items.splice(c,0,t.item),me=null,mt(),M=null,Te=null,Ct(),Nt(),It(),en(),tt(t.item.id),console.log("[Blockscape] undo delete restored",t.item.id),!0}function wo(){if(!M||_<0)return!1;const t=I[_].data.categories||[];if(!t.length)return!1;const n=Q.get(M);let i=null;if(n!=null&&n.catId&&(i=t.find(m=>m.id===n.catId)),i||(i=t.find(m=>(m.items||[]).some(g=>g.id===M))),!i||!Array.isArray(i.items))return!1;const o=i.items.findIndex(m=>m.id===M);if(o===-1)return!1;const c=i.items.splice(o,1)[0];if(!c)return!1;const a=I[_];me={item:c,categoryId:i.id,index:o,modelId:a?a.id:null};const d=(()=>{var g;if(i.items.length){const T=Math.min(o,i.items.length-1);return((g=i.items[T])==null?void 0:g.id)||null}const m=t.findIndex(T=>T.id===i.id);if(m===-1)return null;for(let T=m+1;T<t.length;T++){const U=t[T].items||[];if(U.length)return U[0].id}for(let T=m-1;T>=0;T--){const U=t[T].items||[];if(U.length)return U[0].id}return null})();return mt(),M=null,Te=null,Ct(),Nt(),It(),en(),d?tt(d):Fn(),console.log("[Blockscape] removed item",c.id),!0}function ds(e){if(!e)return!1;const t=M;M=e;const n=wo();return n||(M=t,Ct()),n}V&&V.addEventListener("click",async()=>{const e=r.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await Vt(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),j&&j.addEventListener("click",async()=>{const e=br();if(!e){alert("No series available to copy. Create another version first.");return}await Vt(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),_e&&_e.addEventListener("click",async()=>{try{const e=await Xt();if(!e){alert("Clipboard is empty.");return}r.value=e,r.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=Dt(r.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const o=At(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=o)}),_===-1&&t!=null?it(t):Zt()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(_<0){alert("No active model selected.");return}try{const t=JSON.parse(r.value);if(Ut(t,{titleHint:xe(I[_]),idHint:ft(I[_])||xe(I[_])}),I[_].data=t,I[_].title=t.title||I[_].title,I[_].isSeries||((e=I[_].apicurioVersions)==null?void 0:e.length)>1){const n=I[_].title||xe(I[_]);at(I[_],{seriesName:n,fallbackTitle:n})}si(),console.log("[Blockscape] replaced active model:",xe(I[_])),It(),fe.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const o=await i.text(),c=i.name.replace(/\.[^.]+$/,"")||"File",a=Dt(o,c,{seriesTitleOverride:`${c} series`});if(!a.length){console.warn("[Blockscape] no models in file:",i.name);continue}a.forEach((u,d)=>{var He;const m=(((He=u.data)==null?void 0:He.title)??"").toString().trim(),g=a.length>1?`${i.name} #${d+1}`:i.name,T=`${c} series`,U=u.isSeries?T:null;let W={...u};if(u.isSeries){const Ye=U||m||u.title||g||"unknown";W.title=Ye;const ht=Ln(Ye||"unknown");oi(W,ht),at(W,{seriesName:Ye,fallbackTitle:"unknown"}),W.apicurioArtifactName=W.apicurioArtifactName||Ye}else W.title=m||g;const ve=At({...W,apicurioArtifactName:W.apicurioArtifactName||U||W.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=ve)})}_===-1&&n!=null?it(n):Zt()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",us);function us(e){var o;if(!Qt())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Br(t))return;let n=[];try{n=Dt(t,"Clipboard",{promptForSeriesName:!0})}catch(c){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",c);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((c,a)=>{const u=At(c,{versionLabel:n.length>1?`paste #${a+1}`:"paste"});i==null&&(i=u)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&it(i)}B.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(yr(),it(n))}),document.getElementById("removeModel").onclick=()=>{if(_<0)return;const e=xe(I[_]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",xe(I[_])),I.splice(_,1),!I.length){_=-1,J=null,p.innerHTML="",k.innerHTML="",r.value="",Zt(),si();return}const n=Math.min(_,I.length-1);it(n)},we&&(we.addEventListener("input",e=>{so(e.target.value||"")}),we.addEventListener("focus",()=>{we.value&&we.value.trim()&&ro(we.value)})),L&&L.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;Nr({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!L||L.hidden)return;const t=e.target;L.contains(t)||we&&(t===we||we.contains(t))||(L.hidden=!0)}),v&&H&&G&&v.addEventListener("submit",async e=>{e.preventDefault();const t=H.value.trim();if(!t){alert("Please enter a URL"),H.focus();return}const n=await gi(t);if(typeof n=="number"){it(n),H.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!H||!t)return;let n=null;H.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=H.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function It(){if(!(_<0))try{J=Pr(I[_].data),en()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function ps(){const e=["comms.bs","planets.bs","styleguide.bs"],t=n=>ni?ni.endsWith("/")?`${ni}${n}`:`${ni}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const o=await i.text(),c=n.replace(/\.[^.]+$/,"")||"Model",a=Dt(o,c,{seriesTitleOverride:`${c} series`});if(!a.length){console.warn("[Blockscape] no models found in",n);continue}a.forEach(u=>{let d={...u};if(u.isSeries){const m=`${c} series`;d={...u,title:m,apicurioArtifactName:m};const g=Ln(m||"unknown");oi(d,g),at(d,{seriesName:m,fallbackTitle:"unknown"})}At(d,{versionLabel:n})}),console.log(`[Blockscape] loaded ${a.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}Zt()}async function fs(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const o=await fetch(e,i);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function ms(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>hs(i)),e.querySelectorAll("a[href]").forEach(i=>{const o=i.getAttribute("href");Eo(o)&&yo(i,o)})}function hs(e){var u,d;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(d=(u=e.parentNode)==null?void 0:u.closest)!=null&&d.call(u,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let o;for(;(o=n.exec(t))!==null;)i.push({url:o[0],index:o.index});if(!i.length)return;const c=document.createDocumentFragment();let a=0;i.forEach(({url:m,index:g})=>{g>a&&c.appendChild(document.createTextNode(t.slice(a,g))),c.appendChild(gs(m)),a=g+m.length}),a<t.length&&c.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(c,e)}function gs(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",Eo(e)&&yo(t,e),t}function yo(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>bs(n,t,e)))}async function bs(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await gi(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function Eo(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function gi(e){try{console.log("[Blockscape] loading from URL:",e);const t=await fs(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=Dt(t,i)}catch(a){throw new Error(`Invalid JSON payload: ${a.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let c=null;return o.forEach((a,u)=>{var W;const d=(((W=a.data)==null?void 0:W.title)??"").toString().trim(),m=o.length>1?`${i} #${u+1}`:i,g=a.isSeries?`${i} series`:null;let T={...a};if(a.isSeries){const ve=g||d||T.title||m;T={...a,title:ve,apicurioArtifactName:ve||a.apicurioArtifactName};const He=Ln(ve||"unknown");oi(T,He),at(T,{seriesName:ve||g||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:He,url:e,baseName:i,seriesTitle:ve})}const U=At({...T,title:d||T.title||m,apicurioArtifactName:T.apicurioArtifactName||g||a.apicurioArtifactName},{versionLabel:i});c==null&&(c=U)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,i),_===-1&&c!=null?it(c):Zt(),c}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=Dt(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let o=null;i.forEach(g=>{const T=At(g,{versionLabel:"seed"});o==null&&(o=T)}),await ps();const c=await Or(),a=co(),u=a==null?void 0:a.index,d=Mr();it(typeof c=="number"?c:typeof d=="number"?d:typeof u=="number"?u:o??0)})()}function zs(r){let l;return{c(){l=P("div"),l.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',b(l,"id","shortcutHelp"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","shortcutHelpTitle")},m(p,k){Ze(p,l,k)},p:xt,i:xt,o:xt,d(p){p&&De(l)}}}class Ks extends Gi{constructor(l){super(),qi(this,l,null,zs,ji,{})}}const Xs=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function Ho(r){let l,p,k,w,B,A,v,H;return{c(){l=P("div"),p=P("div"),k=P("a"),w=Wi("Open Blockscape GPT"),B=ie(),A=P("div"),A.textContent="Paste the copied prompt into that chat.",v=ie(),H=P("div"),H.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',b(k,"href",Zs),b(k,"target","_blank"),b(k,"rel","noreferrer"),b(A,"class","new-panel__hint"),b(p,"class","new-panel__link"),b(H,"class","new-panel__link new-panel__link--disabled"),b(l,"class","new-panel__links")},m(G,oe){Ze(G,l,oe),x(l,p),x(p,k),x(k,w),x(p,B),x(p,A),x(l,v),x(l,H)},p:xt,d(G){G&&De(l)}}}function Do(r){let l,p,k,w,B,A;return{c(){l=P("div"),p=P("div"),p.textContent="Generated prompt",k=ie(),w=P("textarea"),b(p,"class","new-panel__prompt-label"),b(w,"class","pf-v5-c-form-control new-panel__textarea"),b(w,"rows","4"),w.readOnly=!0,b(l,"class","new-panel__prompt")},m(v,H){Ze(v,l,H),x(l,p),x(l,k),x(l,w),dn(w,r[4]),B||(A=qt(w,"input",r[12]),B=!0)},p(v,H){H&16&&dn(w,v[4])},d(v){v&&De(l),B=!1,A()}}}function Ys(r){let l,p,k,w,B,A,v,H,G,oe,D,ce,le,Ae,R,F,K,V,j,_e,N,re,Z,ue,se,he,z,Le,qe,we,L,pe,Fe,Oe,I,_,fe,J,Q,M,Te,Je,Pe,Re,Ne,Ee=r[2]==="gpt"&&Ho(),me=r[4]&&r[5]&&Do(r);return Pe=Ls(r[10][0]),{c(){l=P("div"),p=P("div"),k=ie(),w=P("div"),B=P("div"),B.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',A=ie(),v=P("form"),H=P("div"),G=P("label"),G.textContent="Domain",oe=ie(),D=P("p"),D.textContent="Describe what you want to create a map for.",ce=ie(),le=P("textarea"),Ae=ie(),R=P("div"),F=P("label"),K=P("input"),V=ie(),j=P("span"),j.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,_e=ie(),N=P("fieldset"),re=P("legend"),re.textContent="Target",Z=ie(),ue=P("p"),ue.textContent="Choose where you plan to use the prompt.",se=ie(),he=P("label"),z=P("input"),Le=ie(),qe=P("div"),qe.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',we=ie(),L=P("label"),pe=P("input"),Fe=ie(),Oe=P("div"),Oe.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',I=ie(),_=P("div"),fe=P("button"),fe.textContent="Copy prompt",J=ie(),Q=P("div"),M=Wi(r[3]),Te=ie(),Ee&&Ee.c(),Je=ie(),me&&me.c(),b(p,"id","newPanelBackdrop"),b(p,"class","shortcut-help__backdrop"),b(B,"class","shortcut-help__header"),b(G,"for","newDomain"),b(D,"class","new-panel__hint"),b(le,"id","newDomain"),b(le,"class","pf-v5-c-form-control new-panel__textarea"),b(le,"rows","4"),le.required=!0,b(le,"placeholder","Ex: Companies building open-source geospatial tools"),b(H,"class","new-panel__field"),b(K,"id","seriesToggle"),b(K,"type","checkbox"),b(F,"class","new-panel__toggle"),b(F,"for","seriesToggle"),b(R,"class","new-panel__field"),b(ue,"class","new-panel__hint"),b(z,"type","radio"),b(z,"name","target"),z.__value="gpt",dn(z,z.__value),b(he,"class","new-panel__option"),b(pe,"type","radio"),b(pe,"name","target"),pe.__value="plain",dn(pe,pe.__value),b(L,"class","new-panel__option"),b(N,"class","new-panel__field"),b(fe,"class","pf-v5-c-button pf-m-primary"),b(fe,"type","submit"),b(Q,"class","new-panel__status"),b(Q,"aria-live","polite"),b(_,"class","new-panel__actions"),b(v,"class","shortcut-help__list new-panel__form"),b(w,"class","shortcut-help__panel"),b(w,"tabindex","-1"),b(l,"id","newPanel"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","newPanelTitle"),Pe.p(z,pe)},m(ge,Ue){Ze(ge,l,Ue),x(l,p),x(l,k),x(l,w),x(w,B),x(w,A),x(w,v),x(v,H),x(H,G),x(H,oe),x(H,D),x(H,ce),x(H,le),dn(le,r[0]),x(v,Ae),x(v,R),x(R,F),x(F,K),K.checked=r[1],x(F,V),x(F,j),x(v,_e),x(v,N),x(N,re),x(N,Z),x(N,ue),x(N,se),x(N,he),x(he,z),z.checked=z.__value===r[2],x(he,Le),x(he,qe),x(N,we),x(N,L),x(L,pe),pe.checked=pe.__value===r[2],x(L,Fe),x(L,Oe),x(v,I),x(v,_),x(_,fe),x(_,J),x(_,Q),x(Q,M),x(v,Te),Ee&&Ee.m(v,null),x(v,Je),me&&me.m(v,null),Re||(Ne=[qt(le,"input",r[7]),qt(K,"change",r[8]),qt(z,"change",r[9]),qt(pe,"change",r[11]),qt(v,"submit",Ns(r[6]))],Re=!0)},p(ge,[Ue]){Ue&1&&dn(le,ge[0]),Ue&2&&(K.checked=ge[1]),Ue&4&&(z.checked=z.__value===ge[2]),Ue&4&&(pe.checked=pe.__value===ge[2]),Ue&8&&$s(M,ge[3]),ge[2]==="gpt"?Ee?Ee.p(ge,Ue):(Ee=Ho(),Ee.c(),Ee.m(v,Je)):Ee&&(Ee.d(1),Ee=null),ge[4]&&ge[5]?me?me.p(ge,Ue):(me=Do(ge),me.c(),me.m(v,null)):me&&(me.d(1),me=null)},i:xt,o:xt,d(ge){ge&&De(l),Ee&&Ee.d(),me&&me.d(),Pe.r(),Re=!1,$n(Ne)}}}const Zs="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function Qs(r,l,p){let k="",w=!1,B="gpt",A="",v="",H=!1;const G=()=>{var V;return typeof navigator<"u"&&!!((V=navigator.clipboard)!=null&&V.writeText)};function oe(V){const j=V||"[DOMAIN]",_e=w?"series":"map",re=Xs.replaceAll("[DOMAIN NAME]",j).replaceAll("[DOMAIN]",j).replaceAll("[map|series]",_e).split(`
`),Z=`Generate a **blockscape ${_e}** for the domain of ${j}.`,ue=re.findIndex(he=>he.toLowerCase().includes("generate a **blockscape value")||he.toLowerCase().includes("generate a blockscape [map|series]")||he.toLowerCase().startsWith("generate a blockscape"));ue>=0?re[ue]=Z:re.unshift(Z);const se=w?`

User requested a series (return an array of models).`:"";return`${re.join(`
`).trim()}${se}`}async function D(V){V.preventDefault();const j=k.trim();if(p(3,A=""),p(5,H=B!=="gpt"),!j){p(3,A="Add a domain to generate a prompt."),p(4,v="");return}if(B==="gpt"?p(4,v=`${w?"Create a series":"Create a map"} for ${j}`):(p(4,v=oe(j)),p(5,H=!0)),!G()){p(3,A="Clipboard access is unavailable. Copy the prompt below."),p(5,H=!0);return}try{await navigator.clipboard.writeText(v),p(3,A=B==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),B==="gpt"&&p(5,H=!1)}catch(N){console.warn("[Blockscape] clipboard write failed",N),p(3,A="Copy failed. Use the prompt below."),p(5,H=!0)}}const ce=[[]];function le(){k=this.value,p(0,k)}function Ae(){w=this.checked,p(1,w)}function R(){B=this.__value,p(2,B)}function F(){B=this.__value,p(2,B)}function K(){v=this.value,p(4,v)}return[k,w,B,A,v,H,D,le,Ae,R,ce,F,K]}class ea extends Gi{constructor(l){super(),qi(this,l,Qs,Ys,ji,{})}}const{document:Fo}=As;function ta(r){let l,p,k,w,B,A,v,H,G,oe,D,ce,le,Ae,R,F,K,V,j,_e,N,re,Z,ue,se,he,z,Le,qe,we,L,pe,Fe,Oe,I,_,fe,J,Q,M,Te,Je=`<script id="seed" type="application/json">${r[1]}<\/script>`,Pe,Re,Ne,Ee,me,ge,Ue,ct,nt,je,$e,Ge,lt;return ct=new Ks({}),je=new ea({}),{c(){l=P("link"),p=ie(),k=P("div"),w=P("header"),B=P("div"),A=P("div"),v=P("div"),H=P("div"),H.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',G=ie(),oe=P("div"),D=P("div"),ce=P("button"),le=P("span"),le.textContent="Toggle search and edit tools",Ae=ie(),R=P("span"),R.textContent="▾",F=ie(),K=P("button"),K.textContent="New",V=ie(),j=P("form"),j.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',_e=ie(),N=P("label"),N.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',re=ie(),Z=P("button"),Z.textContent="Help",ue=ie(),se=P("div"),he=P("div"),he.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',z=ie(),Le=P("button"),Le.textContent="Edit",qe=ie(),we=P("button"),we.textContent="Share",Oe=ie(),I=P("div"),I.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',_=ie(),fe=P("main"),fe.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,J=ie(),Q=P("footer"),Q.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',M=ie(),Te=new Bs(!1),Pe=ie(),Re=Wo("svg"),Ne=ie(),Ee=P("div"),me=ie(),ge=P("div"),ge.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',Ue=ie(),Po(ct.$$.fragment),nt=ie(),Po(je.$$.fragment),Fo.title="Blockscape — simple landscape-style tiles",b(l,"rel","icon"),b(l,"type","image/svg+xml"),b(l,"href","./favicon.svg"),b(H,"class","blockscape-brand"),b(le,"class","sr-only"),b(R,"class","blockscape-toolbar__toggle-icon"),b(R,"aria-hidden","true"),b(ce,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),b(ce,"type","button"),b(ce,"aria-expanded",r[0]),b(ce,"aria-controls","blockscapeHeaderExtras"),b(K,"id","newPanelButton"),b(K,"class","pf-v5-c-button pf-m-primary"),b(K,"type","button"),b(K,"title","Create something new"),b(j,"id","urlForm"),b(j,"class","blockscape-url-form"),b(j,"autocomplete","on"),j.noValidate=!0,b(N,"class","pf-v5-c-button pf-m-primary blockscape-file"),b(Z,"id","helpButton"),b(Z,"class","pf-v5-c-button pf-m-primary"),b(Z,"type","button"),b(Z,"title","Show keyboard shortcuts"),b(D,"class","blockscape-toolbar__primary"),b(he,"class","blockscape-search"),b(Le,"id","openInEditor"),b(Le,"class","pf-v5-c-button pf-m-secondary"),b(Le,"type","button"),b(Le,"title","Open current JSON in the editor"),b(we,"id","shareModel"),b(we,"class","pf-v5-c-button pf-m-secondary"),b(we,"type","button"),b(we,"title","Copy a shareable URL for this model"),b(se,"id","blockscapeHeaderExtras"),b(se,"class","blockscape-toolbar__extras"),se.hidden=L=!r[0],b(se,"aria-hidden",pe=!r[0]),b(oe,"class","blockscape-toolbar__controls"),b(oe,"data-expanded",Fe=r[0]?"true":"false"),b(I,"class","blockscape-legend"),b(I,"role","presentation"),b(v,"class","blockscape-toolbar"),b(A,"class","pf-v5-c-masthead__content"),b(B,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),b(w,"class","pf-v5-c-page__header"),b(fe,"class","pf-v5-c-page__main"),b(Q,"class","pf-v5-c-page__footer blockscape-footer"),b(k,"class","pf-v5-c-page"),Te.a=Pe,b(Re,"id","overlay"),b(Re,"class","svg-layer"),b(Ee,"id","tabTooltip"),b(Ee,"class","blockscape-tab-tooltip"),Ee.hidden=!0,b(Ee,"aria-hidden","true"),b(ge,"id","itemPreview"),b(ge,"class","item-preview"),ge.hidden=!0,b(ge,"aria-hidden","true")},m(ae,ye){x(Fo.head,l),Ze(ae,p,ye),Ze(ae,k,ye),x(k,w),x(w,B),x(B,A),x(A,v),x(v,H),x(v,G),x(v,oe),x(oe,D),x(D,ce),x(ce,le),x(ce,Ae),x(ce,R),x(D,F),x(D,K),x(D,V),x(D,j),x(D,_e),x(D,N),x(D,re),x(D,Z),x(oe,ue),x(oe,se),x(se,he),x(se,z),x(se,Le),x(se,qe),x(se,we),x(v,Oe),x(v,I),x(k,_),x(k,fe),x(k,J),x(k,Q),Ze(ae,M,ye),Te.m(Je,ae,ye),Ze(ae,Pe,ye),Ze(ae,Re,ye),Ze(ae,Ne,ye),Ze(ae,Ee,ye),Ze(ae,me,ye),Ze(ae,ge,ye),Ze(ae,Ue,ye),Fi(ct,ae,ye),Ze(ae,nt,ye),Fi(je,ae,ye),$e=!0,Ge||(lt=qt(ce,"click",r[2]),Ge=!0)},p(ae,[ye]){(!$e||ye&1)&&b(ce,"aria-expanded",ae[0]),(!$e||ye&1&&L!==(L=!ae[0]))&&(se.hidden=L),(!$e||ye&1&&pe!==(pe=!ae[0]))&&b(se,"aria-hidden",pe),(!$e||ye&1&&Fe!==(Fe=ae[0]?"true":"false"))&&b(oe,"data-expanded",Fe)},i(ae){$e||(Di(ct.$$.fragment,ae),Di(je.$$.fragment,ae),$e=!0)},o(ae){Oo(ct.$$.fragment,ae),Oo(je.$$.fragment,ae),$e=!1},d(ae){ae&&(De(p),De(k),De(M),Te.d(),De(Pe),De(Re),De(Ne),De(Ee),De(me),De(ge),De(Ue),De(nt)),De(l),Ji(ct,ae),Ji(je,ae),Ge=!1,lt()}}}function na(r,l,p){const k=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let w=!1;const B=()=>{if(p(0,w=!w),!w){const A=document.getElementById("search");A&&A.value&&(A.value="",A.dispatchEvent(new Event("input",{bubbles:!0})))}};return Os(()=>{Gs()}),[w,k,B]}class ia extends Gi{constructor(l){super(),qi(this,l,na,ta,ji,{})}}const oa=document.getElementById("root");new ia({target:oa});
