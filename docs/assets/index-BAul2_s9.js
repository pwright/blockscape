var io=Object.defineProperty;var oo=(o,a,p)=>a in o?io(o,a,{enumerable:!0,configurable:!0,writable:!0,value:p}):o[a]=p;var gt=(o,a,p)=>oo(o,typeof a!="symbol"?a+"":a,p);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))k(w);new MutationObserver(w=>{for(const C of w)if(C.type==="childList")for(const I of C.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&k(I)}).observe(document,{childList:!0,subtree:!0});function p(w){const C={};return w.integrity&&(C.integrity=w.integrity),w.referrerPolicy&&(C.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?C.credentials="include":w.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function k(w){if(w.ep)return;w.ep=!0;const C=p(w);fetch(w.href,C)}})();function dt(){}function ui(o){return o()}function ei(){return Object.create(null)}function Kt(o){o.forEach(ui)}function pi(o){return typeof o=="function"}function Bn(o,a){return o!=o?a==a:o!==a||o&&typeof o=="object"||typeof o=="function"}function ro(o){return Object.keys(o).length===0}const so=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function x(o,a){o.appendChild(a)}function Re(o,a,p){o.insertBefore(a,p||null)}function Oe(o){o.parentNode&&o.parentNode.removeChild(o)}function $(o){return document.createElement(o)}function fi(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function On(o){return document.createTextNode(o)}function X(){return On(" ")}function yt(o,a,p,k){return o.addEventListener(a,p,k),()=>o.removeEventListener(a,p,k)}function ao(o){return function(a){return a.preventDefault(),o.call(this,a)}}function h(o,a,p){p==null?o.removeAttribute(a):o.getAttribute(a)!==p&&o.setAttribute(a,p)}function co(o){let a;return{p(...p){a=p,a.forEach(k=>o.push(k))},r(){a.forEach(p=>o.splice(o.indexOf(p),1))}}}function lo(o){return Array.from(o.childNodes)}function uo(o,a){a=""+a,o.data!==a&&(o.data=a)}function Mt(o,a){o.value=a??""}class po{constructor(a=!1){gt(this,"is_svg",!1);gt(this,"e");gt(this,"n");gt(this,"t");gt(this,"a");this.is_svg=a,this.e=this.n=null}c(a){this.h(a)}m(a,p,k=null){this.e||(this.is_svg?this.e=fi(p.nodeName):this.e=$(p.nodeType===11?"TEMPLATE":p.nodeName),this.t=p.tagName!=="TEMPLATE"?p:p.content,this.c(a)),this.i(k)}h(a){this.e.innerHTML=a,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(a){for(let p=0;p<this.n.length;p+=1)Re(this.t,this.n[p],a)}p(a){this.d(),this.h(a),this.i(this.a)}d(){this.n.forEach(Oe)}}let zt;function qt(o){zt=o}function fo(){if(!zt)throw new Error("Function called outside component initialization");return zt}function mo(o){fo().$$.on_mount.push(o)}const Pt=[],ti=[];let Vt=[];const ni=[],ho=Promise.resolve();let Cn=!1;function go(){Cn||(Cn=!0,ho.then(mi))}function Nn(o){Vt.push(o)}const _n=new Set;let Ot=0;function mi(){if(Ot!==0)return;const o=zt;do{try{for(;Ot<Pt.length;){const a=Pt[Ot];Ot++,qt(a),bo(a.$$)}}catch(a){throw Pt.length=0,Ot=0,a}for(qt(null),Pt.length=0,Ot=0;ti.length;)ti.pop()();for(let a=0;a<Vt.length;a+=1){const p=Vt[a];_n.has(p)||(_n.add(p),p())}Vt.length=0}while(Pt.length);for(;ni.length;)ni.pop()();Cn=!1,_n.clear(),qt(o)}function bo(o){if(o.fragment!==null){o.update(),Kt(o.before_update);const a=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,a),o.after_update.forEach(Nn)}}function vo(o){const a=[],p=[];Vt.forEach(k=>o.indexOf(k)===-1?a.push(k):p.push(k)),p.forEach(k=>k()),Vt=a}const sn=new Set;let wo;function Ln(o,a){o&&o.i&&(sn.delete(o),o.i(a))}function ii(o,a,p,k){if(o&&o.o){if(sn.has(o))return;sn.add(o),wo.c.push(()=>{sn.delete(o)}),o.o(a)}}function oi(o){o&&o.c()}function Tn(o,a,p){const{fragment:k,after_update:w}=o.$$;k&&k.m(a,p),Nn(()=>{const C=o.$$.on_mount.map(ui).filter(pi);o.$$.on_destroy?o.$$.on_destroy.push(...C):Kt(C),o.$$.on_mount=[]}),w.forEach(Nn)}function $n(o,a){const p=o.$$;p.fragment!==null&&(vo(p.after_update),Kt(p.on_destroy),p.fragment&&p.fragment.d(a),p.on_destroy=p.fragment=null,p.ctx=[])}function yo(o,a){o.$$.dirty[0]===-1&&(Pt.push(o),go(),o.$$.dirty.fill(0)),o.$$.dirty[a/31|0]|=1<<a%31}function Un(o,a,p,k,w,C,I=null,g=[-1]){const R=zt;qt(o);const z=o.$$={fragment:null,ctx:[],props:C,update:dt,not_equal:w,bound:ei(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(R?R.$$.context:[])),callbacks:ei(),dirty:g,skip_bound:!1,root:a.target||R.$$.root};I&&I(z.root);let Z=!1;if(z.ctx=p?p(o,a.props||{},(H,re,...se)=>{const ke=se.length?se[0]:re;return z.ctx&&w(z.ctx[H],z.ctx[H]=ke)&&(!z.skip_bound&&z.bound[H]&&z.bound[H](ke),Z&&yo(o,H)),re}):[],z.update(),Z=!0,Kt(z.before_update),z.fragment=k?k(z.ctx):!1,a.target){if(a.hydrate){const H=lo(a.target);z.fragment&&z.fragment.l(H),H.forEach(Oe)}else z.fragment&&z.fragment.c();a.intro&&Ln(o.$$.fragment),Tn(o,a.target,a.anchor),mi()}qt(R)}class Pn{constructor(){gt(this,"$$");gt(this,"$$set")}$destroy(){$n(this,1),this.$destroy=dt}$on(a,p){if(!pi(p))return dt;const k=this.$$.callbacks[a]||(this.$$.callbacks[a]=[]);return k.push(p),()=>{const w=k.indexOf(p);w!==-1&&k.splice(w,1)}}$set(a){this.$$set&&!ro(a)&&(this.$$.skip_bound=!0,this.$$set(a),this.$$.skip_bound=!1)}}const Eo="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Eo);const ri="blockscape:apicurioConfig",In="http://localhost:8080/apis/registry/v3",nn="bs",si="-series",An=!1,Sn=!1;function ko({models:o,getActiveIndex:a,setActive:p,ensureModelMetadata:k,ensureSeriesId:w,getModelId:C,getSeriesId:I,getModelTitle:g,computeJsonFingerprint:R,uid:z}){let Z=null,H=null,re=null,se=null,ke=null,O=null,F=null,W=null,M=null,J=null;const U={baseUrl:In,groupId:nn,authToken:"",enabled:An,useSemver:Sn},D=new Map,ae=new Map;function Y(r){return(r||"").toString().trim().replace(/\/+$/,"")}function be(r){return`${(r||"").toString().trim()||nn}${si}`}function K(){return!!(U.baseUrl&&U.groupId)}function ue(){return U.enabled!==!1}function ne(){re&&(re.value=U.baseUrl||""),se&&(se.value=U.groupId||""),ke&&(ke.value=U.authToken||""),O&&(O.checked=ue()),F&&(F.checked=!!U.useSemver)}function B(r="",d="muted"){W&&(W.textContent=r||"",W.classList.remove("is-error","is-success"),d==="error"?W.classList.add("is-error"):d==="success"&&W.classList.add("is-success"))}function Le(r){if(!J||(J.innerHTML="",!r))return;const d=document.createElement("p");d.className="apicurio-hint",d.textContent=r,J.appendChild(d)}function ve(r){D.clear(),ae.clear(),Le(r)}function Ce(){const r=a(),d=ue(),y=K(),b=r>=0?o[r]:null,m=!!(b!=null&&b.apicurioVersions&&b.apicurioVersions.length>1);if(Z){const A=Z.dataset.loading==="true",P=d&&y&&r>=0&&!!fe(o[r]);Z.disabled=!d||A||!P,d?A||(Z.textContent="Push to Apicurio"):Z.textContent="Enable Apicurio to push"}if(M){const A=M.dataset.loading==="true",P=d&&y&&m&&!!fe(b);M.disabled=!P||A,M.hidden=!m,d?A||(M.textContent="Push series"):M.textContent="Enable Apicurio to push series"}if(H){const A=H.dataset.loading==="true",P=d&&y;H.disabled=!P||A,A||(d?y?H.textContent="List artifacts":H.textContent="Enter details to list":H.textContent="Enable Apicurio to list")}}function de(){ne(),ue()?K()?(B("Apicurio push is ready when a model is selected.","muted"),D.size||Le("Click “List artifacts” to browse the current group.")):(B("Enter Apicurio connection details to enable push.","muted"),ve("Enter registry details to browse artifacts.")):(B("Apicurio integration is off. Enable it to allow pushes.","muted"),ve("Apicurio integration is disabled.")),Ce()}function _(){if(window!=null&&window.localStorage)try{localStorage.setItem(ri,JSON.stringify(U))}catch(r){console.warn("[Blockscape] unable to persist Apicurio settings",r)}}function E(){let r={};if(window!=null&&window.localStorage)try{const A=localStorage.getItem(ri);if(A){const P=JSON.parse(A);P&&typeof P=="object"&&(r=P)}}catch(A){console.warn("[Blockscape] failed to restore Apicurio settings",A)}const d=Y(r.baseUrl??In),y=(r.groupId??nn).toString().trim();let b=An,m=Sn;typeof r.enabled=="boolean"?b=r.enabled:typeof r.enabled=="string"&&(b=r.enabled==="true"),typeof r.useSemver=="boolean"?m=r.useSemver:typeof r.useSemver=="string"&&(m=r.useSemver==="true"),U.baseUrl=d||In,U.groupId=y||nn,U.authToken=(r.authToken??"").toString().trim(),U.enabled=b,U.useSemver=m,de()}function we(){const r={Accept:"application/json"},d=(U.authToken||"").trim();return d&&(r.Authorization=/\s/.test(d)?d:`Bearer ${d}`),r}function q(r,d,{title:y,description:b,version:m}={}){const A={artifactId:r,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:d},metadata:{properties:{}}}};m&&(A.firstVersion.version=m),y&&(A.name=y),b&&(A.description=b);try{const P=JSON.parse(d),N=P==null?void 0:P.seriesId;N&&typeof N=="string"&&(A.firstVersion.metadata.properties.seriesId=N)}catch{}return A}function Q(r,{version:d}={}){const y={content:{contentType:"application/json",content:r},metadata:{properties:{}}};try{const b=JSON.parse(r),m=b==null?void 0:b.seriesId;m&&typeof m=="string"&&(y.metadata.properties.seriesId=m)}catch{}return d&&(y.version=d),y}function V(r){if(r==null)return null;const d=String(r).trim();if(!d)return null;const y=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(d);if(y)return{major:Number(y[1]),minor:Number(y[2]),patch:Number(y[3])};const b=/^v?(\d+)$/.exec(d);return b?{major:Number(b[1]),minor:0,patch:0}:null}function Ee(r){return`${r.major}.${r.minor}.${r.patch}`}function xe(r,d){return!r&&!d?0:r?d?r.major!==d.major?r.major-d.major:r.minor!==d.minor?r.minor-d.minor:r.patch-d.patch:1:-1}function He(r=[]){let d=null;if(r.forEach(b=>{const m=V((b==null?void 0:b.version)??b);m&&(!d||xe(m,d)>0)&&(d=m)}),!d)return"1.0.0";const y={...d,patch:d.patch+1};return Ee(y)}function fe(r,{seriesName:d,fallbackTitle:y}={}){var A;if(!r)return null;const b=d||r.title||r.apicurioArtifactName||g(r),m=y||b;if(typeof w=="function"&&(r.isSeries||((A=r.apicurioVersions)==null?void 0:A.length)>1)&&w(r,{seriesName:b,fallbackTitle:m}),typeof I=="function"){const P=I(r,{seriesName:b,fallbackTitle:m});if(P)return P}return C(r)}function Ue(r){return Array.isArray(r)?r:Array.isArray(r==null?void 0:r.artifacts)?r.artifacts:Array.isArray(r==null?void 0:r.items)?r.items:Array.isArray(r==null?void 0:r.results)?r.results:[]}function Fe(r){return Array.isArray(r)?r:Array.isArray(r==null?void 0:r.versions)?r.versions:Array.isArray(r==null?void 0:r.items)?r.items:[]}function We(r=[]){if(!Array.isArray(r)||!r.length)return null;const d=[...r].filter(Boolean);return d.sort((y,b)=>{const m=y!=null&&y.createdOn?new Date(y.createdOn).getTime():0,A=b!=null&&b.createdOn?new Date(b.createdOn).getTime():0;if(m!==A)return A-m;const P=Number(y==null?void 0:y.version),N=Number(b==null?void 0:b.version),te=Number.isFinite(P),j=Number.isFinite(N);if(te&&j&&P!==N)return N-P;const G=String((y==null?void 0:y.version)??"");return String((b==null?void 0:b.version)??"").localeCompare(G,void 0,{numeric:!0})}),d[0]||null}function me(r){if(!r)return r;let d=r;if(!Array.isArray(r==null?void 0:r.categories)){const b=r==null?void 0:r.content;if(typeof b=="string")try{d=JSON.parse(b)}catch(m){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",m)}else b&&typeof b=="object"&&(d=b)}return d}async function pe(r,d,y){const b=encodeURIComponent(d),m=encodeURIComponent(y),A=`${r}/groups/${b}/artifacts/${m}`,P=we();P.Accept="application/json";const N=await fetch(A,{method:"GET",headers:P});if(!N.ok){let te=N.statusText||"Unknown error";try{const j=await N.text();j&&(te=j.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${N.status}): ${te}`)}return N.json()}async function ee(r,d,y){const b=encodeURIComponent(d),m=encodeURIComponent(y),A=`${r}/groups/${b}/artifacts/${m}/versions?limit=50&order=desc`,P=we();P.Accept="application/json";const N=await fetch(A,{method:"GET",headers:P});if(!N.ok){let j=N.statusText||"Unknown error";try{const G=await N.text();G&&(j=G.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${N.status}): ${j}`)}const te=await N.json();return Fe(te).filter(j=>j&&j.version!=null)}async function _e(r,d,y,b="latest"){const m=encodeURIComponent(d),A=encodeURIComponent(y),P=encodeURIComponent(b||"latest"),N=`${r}/groups/${m}/artifacts/${A}/versions/${P}/content`,te=we();te.Accept="application/json, application/*+json, */*;q=0.8";const j=await fetch(N,{method:"GET",headers:te});if(!j.ok){let Se=j.statusText||"Unknown error";try{const ie=await j.text();ie&&(Se=ie.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${j.status}): ${Se}`)}const G=await j.text();let he=null;try{he=JSON.parse(G)}catch{throw new Error("Artifact content is not valid JSON.")}return me(he)}async function Me(r,d,y,b="latest"){const m=await _e(r,d,y,b);return{data:m,fingerprint:R(m)}}async function Je(r,d,y){try{const m=await ee(r,d,y);if(m!=null&&m.length){ae.set(y,m);const A=We(m);if((A==null?void 0:A.version)!=null)return A.version}}catch(m){console.warn("[Blockscape] compare-version: unable to fetch versions list",m)}try{const m=await pe(r,d,y);if((m==null?void 0:m.version)!=null)return m.version}catch(m){console.warn("[Blockscape] compare-version: unable to fetch metadata",m)}const b=ae.get(y);if(b&&b.length){const m=We(b);if((m==null?void 0:m.version)!=null)return m.version}return"latest"}async function je(r,d,y,b){if(!U.useSemver)return null;if(!b)return"1.0.0";try{const m=await ee(r,d,y);return He(m)}catch(m){throw new Error(`Unable to compute next semantic version: ${m.message}`)}}function st(r=document){Z=r.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),M=r.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),H=r.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),re=r.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),se=r.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),ke=r.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),O=r.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),F=r.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),W=r.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),J=r.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function qe(){U.baseUrl=Y((re==null?void 0:re.value)??U.baseUrl),U.groupId=((se==null?void 0:se.value)??"").trim(),U.authToken=((ke==null?void 0:ke.value)??"").trim(),_(),de()}function Pe(){U.enabled=O?O.checked:An,_(),de()}function bt(){U.useSemver=F?F.checked:Sn,_(),de()}function Et(){[re,se,ke].forEach(r=>{r&&r.addEventListener("input",qe)}),Z&&Z.addEventListener("click",()=>{Ht()}),M&&M.addEventListener("click",()=>{Wt()}),O&&O.addEventListener("change",Pe),F&&F.addEventListener("change",bt),H&&H.addEventListener("click",It),J&&J.addEventListener("click",r=>{const d=r.target.closest("[data-artifact-version]");if(d){r.stopPropagation();const m=d.dataset.artifactId,A=d.dataset.artifactVersion;m&&A&&dn(m,A);return}const y=r.target.closest("[data-artifact-load-all]");if(y){r.stopPropagation(),y.dataset.artifactId&&at();return}const b=r.target.closest("[data-artifact-trigger]");if(b){const m=b.dataset.artifactId;if(!m)return;cn(m)}})}function ce(){const r=document.createElement("div");return r.className="blockscape-registry-panel",r.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,r}function Ie(r){if(!r)return;r.innerHTML="";const d=ce();r.appendChild(d),st(r),Et(),de()}function an(r){if(!J)return;if(J.innerHTML="",!r.length){Le("No artifacts found in this group.");return}const d=m=>{const A=document.createElement("section");A.className="apicurio-artifact-section";const P=document.createElement("h3");P.textContent=m,A.appendChild(P);const N=document.createElement("ul");return N.className="apicurio-artifact-list",A.appendChild(N),{section:A,list:N}},y=d("Series artifacts"),b=d("Artifacts");r.forEach(m=>{if(!(m!=null&&m.artifactId))return;const P=m._groupId&&m._groupId.endsWith(si)?y.list:b.list,N=document.createElement("li"),te=document.createElement("button");te.type="button",te.className="apicurio-artifact",te.dataset.artifactId=m.artifactId,te.dataset.artifactTrigger="toggle";const j=document.createElement("span");j.className="apicurio-artifact-title",j.textContent=m.artifactId,te.appendChild(j);const G=[];if(m.name&&G.push(m.name),m.version!=null&&G.push(`v${m.version}`),m.type&&G.push(m.type),m._groupId&&G.push(m._groupId),G.length){const ie=document.createElement("span");ie.className="apicurio-artifact-meta",ie.textContent=G.join(" • "),te.appendChild(ie)}if(m.description){const ie=document.createElement("span");ie.className="apicurio-artifact-meta",ie.textContent=m.description,te.appendChild(ie)}N.appendChild(te);const he=document.createElement("div");he.className="apicurio-version-list",he.dataset.versionPanel=m.artifactId,he.hidden=!0;const Se=document.createElement("p");Se.className="apicurio-hint",Se.textContent="Click to load the latest or open versions.",he.appendChild(Se),N.appendChild(he),P.appendChild(N)}),y.list.children.length&&J.appendChild(y.section),b.list.children.length&&J.appendChild(b.section)}function Rt(r){return J?J.querySelector(`[data-version-panel="${r}"]`):null}function kt(r,d){if(!r||(r.innerHTML="",!d))return;const y=document.createElement("p");y.className="apicurio-hint",y.textContent=d,r.appendChild(y)}function xt(r,d){const y=Rt(r);if(y){if(y.innerHTML="",!d.length){kt(y,"No versions found for this artifact.");return}d.forEach(b=>{const m=document.createElement("button");m.type="button",m.className="apicurio-version-button",m.dataset.artifactId=r,m.dataset.artifactVersion=b.version;const A=[`Version ${b.version}`];if(b.createdOn){const P=new Date(b.createdOn);isNaN(P)||A.push(P.toISOString().slice(0,10))}m.textContent=A.join(" — "),y.appendChild(m)})}}async function cn(r){const d=Rt(r);if(!d)return;if(d.dataset.open==="true"){d.hidden=!0,d.dataset.open="false";return}if(d.hidden=!1,d.dataset.open="true",d.dataset.loaded!=="true"){if(!K()){kt(d,"Enter registry details first.");return}kt(d,"Loading versions…");try{const b=Y(U.baseUrl),m=D.get(r),A=U.groupId.trim(),P=(m==null?void 0:m._groupId)||A,N=await ee(b,P,r);ae.set(r,N),d.dataset.loaded="true",xt(r,N)}catch(b){console.error("[Blockscape] failed to load versions",b),kt(d,`Unable to fetch versions: ${b.message}`)}}}function ln(r,d){var b;const y=o.findIndex(m=>m.apicurioArtifactId===r);if(y!==-1){const m=o[y].id;o[y]={...d,id:m||d.id},((b=o[y].apicurioVersions)==null?void 0:b.length)>1&&(o[y].isSeries=!0),p(y)}else o.push(d),p(o.length-1)}async function _t(r,d,y,b){const m=encodeURIComponent(d),A=encodeURIComponent(y),P=`${r}/groups/${m}/artifacts/${A}`;try{const N=await fetch(P,{method:"GET",headers:b});if(N.status===404)return!1;if(N.ok)return!0;throw N.status===401||N.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${N.status} while checking the artifact.`)}catch(N){throw N instanceof TypeError?new Error("Network error while contacting Apicurio registry."):N}}async function Ht(){var P;if(!Z||Z.dataset.loading==="true")return;if(!ue()){B("Apicurio integration is off. Enable it first.","error");return}if(!K()){B("Enter the registry base URL and group ID before pushing.","error");return}const r=a();if(r<0||!o[r]){B("No active model to push.","error");return}const d=fe(o[r],{fallbackTitle:g(o[r])});if(!d){B("Active model needs an id before pushing.","error");return}const y=Y(U.baseUrl),b=U.groupId.trim(),m=JSON.stringify(o[r].data,null,2),A=we();Z.dataset.loading="true",Z.textContent="Pushing…",Z.disabled=!0,B("Pushing to Apicurio…","muted");try{const N=await _t(y,b,d,A),te=R(o[r].data);if(N)try{const ye=await Je(y,b,d),{data:Ve,fingerprint:Be}=await Me(y,b,d,ye);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",ye),console.log("local fingerprint",te),console.log("registry fingerprint",Be),console.log("local payload",o[r].data),console.log("registry payload",Ve),console.groupEnd(),te&&Be&&te===Be){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){B("Push cancelled (content matches the latest registry version).","muted");return}B("Pushing identical content by user choice.","muted")}else Be?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):B("Unable to compare with registry content (skipping confirmation).","muted")}catch(ye){console.warn("[Blockscape] unable to compare registry content before push",ye),B("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const j=U.useSemver?await je(y,b,d,N):null;if(U.useSemver&&!j)throw new Error("Semantic versioning is enabled but no version could be computed.");const G=encodeURIComponent(b),he=encodeURIComponent(d),Se=N?`${y}/groups/${G}/artifacts/${he}/versions`:`${y}/groups/${G}/artifacts`,ie={...A,"Content-Type":"application/json"};j&&(ie["X-Registry-Version"]=j,B(`Pushing to Apicurio as version ${j}…`,"muted"));const Ze=N?Q(m,{version:j}):q(d,m,{title:g(o[r]),description:(P=o[r].data)==null?void 0:P.abstract,version:j}),Ye=await fetch(Se,{method:"POST",headers:ie,body:JSON.stringify(Ze)});if(!Ye.ok){let ye=Ye.statusText||"Unknown error";try{const Ve=await Ye.text();Ve&&(ye=Ve.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${Ye.status}): ${ye}`)}let De=null;try{De=await Ye.json()}catch{De=null}const le=(De==null?void 0:De.version)||(De==null?void 0:De.globalId)||"",Ne=N?"Updated":"Created",tt=le?` (version ${le})`:"";B(`${Ne} ${d}${tt}`,"success")}catch(N){console.error("[Blockscape] Apicurio push failed",N),B(`Apicurio push failed: ${N.message}`,"error")}finally{Z.dataset.loading="false",Ce()}}async function Wt(){var j,G;if(!M||M.dataset.loading==="true")return;if(!ue()){B("Apicurio integration is off. Enable it first.","error");return}if(!K()){B("Enter the registry base URL and group ID before pushing.","error");return}const r=a(),d=r>=0?o[r]:null;if(!d||!d.apicurioVersions||d.apicurioVersions.length<2){B("Series push requires a model with multiple versions.","error");return}const y=fe(d,{seriesName:d.title||d.apicurioArtifactName||g(d)});if(!y){B("Active series needs an id before pushing.","error");return}typeof w=="function"&&w(d,{seriesName:d.title||d.apicurioArtifactName||g(d)});const b=Y(U.baseUrl),m=U.groupId.trim(),A=d.apicurioVersions.map(he=>he.data),P=JSON.stringify(A,null,2),N=we(),te=be(m);M.dataset.loading="true",M.textContent="Pushing…",M.disabled=!0,B("Pushing series to Apicurio…","muted");try{const he=await _t(b,te,y,N),Se=R(A);if(he)try{const nt=await Je(b,te,y),{data:ut,fingerprint:At}=await Me(b,te,y,nt);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",nt),console.log("local fingerprint",Se),console.log("registry fingerprint",At),console.log("local payload (series)",A),console.log("registry payload",ut),console.groupEnd(),Se&&At&&Se===At){if(!window.confirm("The current registry version matches this series. Push anyway?")){B("Series push cancelled (content matches latest).","muted");return}B("Pushing identical series by user choice.","muted")}else At?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):B("Unable to compare with registry content (skipping confirmation).","muted")}catch(nt){console.warn("[Blockscape] unable to compare registry content before series push",nt),B("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const ie=U.useSemver?await je(b,te,y,he):null;if(U.useSemver&&!ie)throw new Error("Semantic versioning is enabled but no version could be computed.");const Ze=encodeURIComponent(te),Ye=encodeURIComponent(y),De=he?`${b}/groups/${Ze}/artifacts/${Ye}/versions`:`${b}/groups/${Ze}/artifacts`,le={...N,"Content-Type":"application/json"};ie&&(le["X-Registry-Version"]=ie,B(`Pushing series to Apicurio as version ${ie}…`,"muted"));const Ne=he?Q(P,{version:ie}):q(y,P,{title:d.apicurioArtifactName||((j=d.data)==null?void 0:j.title)||y,description:(G=d.data)==null?void 0:G.abstract,version:ie}),tt=await fetch(De,{method:"POST",headers:le,body:JSON.stringify(Ne)});if(!tt.ok){let nt=tt.statusText||"Unknown error";try{const ut=await tt.text();ut&&(nt=ut.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${tt.status}): ${nt}`)}let ye=null;try{ye=await tt.json()}catch{ye=null}const Ve=(ye==null?void 0:ye.version)||(ye==null?void 0:ye.globalId)||"",Be=he?"Updated":"Created",ct=Ve?` (version ${Ve})`:"";B(`${Be} ${y} series${ct}`,"success")}catch(he){console.error("[Blockscape] Apicurio series push failed",he),B(`Apicurio series push failed: ${he.message}`,"error")}finally{M.dataset.loading="false",Ce()}}async function It(){if(!H||H.dataset.loading==="true")return;if(!ue()){B("Enable Apicurio integration to list artifacts.","error");return}if(!K()){B("Enter registry base URL and group ID before listing.","error");return}const r=Y(U.baseUrl),d=U.groupId.trim(),y=be(d),b=[{groupId:d,label:"base"},{groupId:y,label:"series"}];H.dataset.loading="true",H.textContent="Listing…",H.disabled=!0,B("Listing artifacts…","muted"),Le("Contacting registry…");try{const m=we();m.Accept="application/json";const A=[];for(const N of b){const te=encodeURIComponent(N.groupId),j=`${r}/groups/${te}/artifacts?limit=50&offset=0`,G=await fetch(j,{method:"GET",headers:m});if(!G.ok){let ie=G.statusText||"Unknown error";try{const Ze=await G.text();Ze&&(ie=Ze.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${N.groupId} (${G.status}): ${ie}`);continue}const he=await G.json(),Se=Ue(he).filter(ie=>ie&&ie.artifactId);Se.forEach(ie=>{ie&&(ie._groupId=N.groupId)}),A.push(...Se)}D.clear(),ae.clear(),A.forEach(N=>{N!=null&&N.artifactId&&D.set(N.artifactId,N)}),an(A);const P=A.length;B(P?`Found ${P} artifact${P===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",P?"success":"muted")}catch(m){console.error("[Blockscape] failed to list artifacts",m),ve("Unable to list artifacts."),B(`Listing failed: ${m.message}`,"error")}finally{H.dataset.loading="false",Ce()}}async function dn(r,d=null){var he,Se,ie,Ze,Ye,De;if(!r)return;if(!ue()){B("Enable Apicurio integration to load artifacts.","error");return}if(!K()){B("Enter registry connection details before loading artifacts.","error");return}const y=Y(U.baseUrl),b=U.groupId.trim(),m=r&&((he=D.get(r))==null?void 0:he._groupId)||b;let A=D.get(r);const P=async()=>{try{const le=await pe(y,m,r);return le!=null&&le.artifactId&&D.set(r,le),le}catch(le){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",le),le}};if(!A)try{A=await P()}catch(le){B(`Failed to fetch artifact metadata: ${le.message}`,"error");return}const N=ae.get(r)||[];let te="latest",j="latest";if(d)te=d,j=d;else{if(!A||A.version==null)try{A=await P()}catch(le){B(`Failed to fetch artifact metadata: ${le.message}`,"error");return}te=(A==null?void 0:A.version)||"latest",j=(A==null?void 0:A.version)||"latest"}const G=N.find(le=>String(le.version)===String(te));(G==null?void 0:G.version)!=null&&(j=G.version),B(`Loading artifact ${r}…`,"muted");try{const le=await _e(y,m,r,te),Ne=D.get(r)||A||{},tt=Array.isArray(le);let ye=null;if(tt){const Ve=le.map((ct,nt)=>(k(ct,{titleHint:Ne.name||r,idHint:r}),{version:String(nt+1),data:ct,createdOn:(G==null?void 0:G.createdOn)||Ne.createdOn}));ye={id:z(),title:((ie=(Se=Ve[0])==null?void 0:Se.data)==null?void 0:ie.title)||Ne.name||r,data:(Ze=Ve[0])==null?void 0:Ze.data,apicurioArtifactId:r,apicurioArtifactName:Ne.name||"",apicurioVersions:Ve,apicurioActiveVersionIndex:0,isSeries:!0};const Be=((Ye=Ne==null?void 0:Ne.properties)==null?void 0:Ye.seriesId)||r;typeof w=="function"&&w(ye,{seriesName:Be,fallbackTitle:Be}),B(`Loaded series artifact ${r}.`,"success")}else{k(le,{titleHint:Ne.name||r,idHint:r});const Ve={version:j,data:le,createdOn:(G==null?void 0:G.createdOn)||Ne.createdOn};ye={id:z(),title:le.title||Ne.name||r,data:le,apicurioArtifactId:r,apicurioArtifactName:Ne.name||"",apicurioVersions:[Ve],apicurioActiveVersionIndex:0};const Be=(De=Ne==null?void 0:Ne.properties)==null?void 0:De.seriesId;Be&&typeof w=="function"&&w(ye,{seriesName:Be,fallbackTitle:Be});const ct=j?` (version ${j})`:"";B(`Loaded artifact ${r}${ct}.`,"success")}ln(r,ye)}catch(le){console.error("[Blockscape] failed to load artifact",le),B(`Failed to load artifact: ${le.message}`,"error")}}async function at(r){}return{hydrateConfig:E,mount:Ie,updateAvailability:Ce}}function Ut(o,a){if(typeof o!="function")throw new Error(`[itemEditor] expected ${a} to be a function`)}function xo(o,{excludeId:a}={}){if(!o)return[];const p=o.split(/[\s,]+/).map(w=>w.trim()).filter(Boolean),k=[];return p.forEach(w=>{a&&w===a||k.includes(w)||k.push(w)}),k}function _o(o,a,p){if(!a||!p||a===p)return;((o==null?void 0:o.categories)||[]).forEach(w=>{(w.items||[]).forEach(C=>{Array.isArray(C.deps)&&(C.deps=C.deps.map(I=>I===a?p:I))})}),Array.isArray(o==null?void 0:o.links)&&o.links.forEach(w=>{w.from===a&&(w.from=p),w.to===a&&(w.to=p)})}function Io({findItemAndCategoryById:o,collectAllItemIds:a,updateItemReferences:p,loadActiveIntoEditor:k,rebuildFromActive:w,select:C,onSelectionRenamed:I}={}){Ut(o,"findItemAndCategoryById"),Ut(a,"collectAllItemIds"),Ut(p,"updateItemReferences"),Ut(k,"loadActiveIntoEditor"),Ut(w,"rebuildFromActive"),Ut(C,"select");const g={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function R(O){if(g.fields.errorEl){if(!O){g.fields.errorEl.hidden=!0,g.fields.errorEl.textContent="";return}g.fields.errorEl.hidden=!1,g.fields.errorEl.textContent=O}}function z(){g.wrapper&&(g.wrapper.hidden=!0,g.wrapper.setAttribute("aria-hidden","true"),R(""),g.categoryId=null,g.itemId=null,g.modelData=null,document.body.classList.remove("item-editor-open"))}function Z(){g.wrapper&&(g.wrapper.hidden=!1,g.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var O,F;(O=g.fields.nameInput)==null||O.focus(),(F=g.fields.nameInput)==null||F.select()}))}function H(O){var be;if(!g.modelData||!g.categoryId||!g.itemId)throw new Error("No item loaded.");const W=(((be=g.modelData)==null?void 0:be.categories)||[]).find(K=>K.id===g.categoryId);if(!W)throw new Error("Category not found.");W.items=W.items||[];const M=W.items.find(K=>K.id===g.itemId);if(!M)throw new Error("Item not found.");const J=(O.id||"").trim();if(!J)throw new Error("ID is required.");const U=a(g.modelData);if(J!==M.id&&U.has(J))throw new Error("Another item already uses that ID.");M.id=J;const D=(O.name||"").trim();M.name=D||M.id;const ae=(O.logo||"").trim();if(ae?M.logo=ae:delete M.logo,O.externalFlag&&!O.external)M.external=!0;else{const K=(O.external??"").toString().trim();K?M.external=K:delete M.external}const Y=(O.color||"").trim();return Y?M.color=Y:delete M.color,M.deps=Array.isArray(O.deps)?O.deps:[],M.id!==O.originalId&&typeof I=="function"&&I(O.originalId,M.id),p(g.modelData,O.originalId,M.id),k(),w(),C(M.id),M.id}function re(){if(!g.fields||!g.fields.idInput)return!1;const O=(g.fields.idInput.value||"").trim(),F={originalId:g.itemId,id:O,name:g.fields.nameInput.value||"",logo:g.fields.logoInput.value||"",external:g.fields.externalInput.value||"",externalFlag:g.fields.externalFlagInput.checked,color:g.fields.colorInput.value||"",deps:xo(g.fields.depsInput.value,{excludeId:O})};try{return H(F),z(),!0}catch(W){return console.warn("[itemEditor] item edit failed",W),R((W==null?void 0:W.message)||"Unable to save item."),!1}}function se(){if(g.wrapper)return g.wrapper;const O=document.createElement("div");O.className="item-editor-modal",O.hidden=!0,O.setAttribute("role","dialog"),O.setAttribute("aria-modal","true");const F=document.createElement("div");F.className="item-editor-modal__backdrop",O.appendChild(F);const W=document.createElement("div");W.className="item-editor",O.appendChild(W);const M=document.createElement("div");M.className="item-editor__header";const J=document.createElement("h2");J.className="item-editor__title",J.textContent="Edit item";const U=document.createElement("button");U.type="button",U.className="item-editor__close",U.setAttribute("aria-label","Close item editor"),U.textContent="×",M.appendChild(J),M.appendChild(U),W.appendChild(M);const D=document.createElement("form");D.className="item-editor__form",W.appendChild(D);const ae=document.createElement("div");ae.className="item-editor__meta",ae.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',D.appendChild(ae);const Y=document.createElement("div");Y.className="item-editor__error",Y.hidden=!0,D.appendChild(Y);const be=(Ee,xe,He)=>{const fe=document.createElement("label");fe.className="item-editor__field";const Ue=document.createElement("span");if(Ue.className="item-editor__label",Ue.textContent=Ee,fe.appendChild(Ue),xe.classList.add("item-editor__control"),fe.appendChild(xe),He){const Fe=document.createElement("div");Fe.className="item-editor__hint",Fe.textContent=He,fe.appendChild(Fe)}return fe},K=document.createElement("input");K.type="text",K.required=!0,D.appendChild(be("ID",K,"Unique identifier used for links and dependencies."));const ue=document.createElement("input");ue.type="text",D.appendChild(be("Name",ue,"Visible label shown on the tile."));const ne=document.createElement("input");ne.type="url",ne.inputMode="url",ne.placeholder="https://…",D.appendChild(be("Logo URL",ne,"Optional image URL."));const B=document.createElement("input");B.type="url",B.inputMode="url",B.placeholder="https://…",D.appendChild(be("External link",B,"Shown with ↗ icon and in preview."));const Le=document.createElement("div");Le.className="item-editor__checkbox";const ve=document.createElement("label");ve.className="item-editor__checkbox-row";const Ce=document.createElement("input");Ce.type="checkbox";const de=document.createElement("span");de.textContent="Mark as external without link";const _=document.createElement("div");_.className="item-editor__hint",_.textContent="Keeps dashed border even without a URL.",ve.appendChild(Ce),ve.appendChild(de),Le.appendChild(ve),Le.appendChild(_),D.appendChild(Le);const E=document.createElement("input");E.type="text",E.placeholder="#2563eb",D.appendChild(be("Color",E,"Optional badge color (hex or CSS color)."));const we=document.createElement("textarea");we.rows=2,we.placeholder="Comma or space separated ids",D.appendChild(be("Dependencies",we,"Use item IDs, separated by commas or spaces."));const q=document.createElement("div");q.className="item-editor__actions";const Q=document.createElement("button");Q.type="button",Q.className="pf-v5-c-button pf-m-tertiary",Q.textContent="Cancel";const V=document.createElement("button");return V.type="submit",V.className="pf-v5-c-button pf-m-primary",V.textContent="Save",q.appendChild(Q),q.appendChild(V),D.appendChild(q),g.wrapper=O,g.fields={idInput:K,nameInput:ue,logoInput:ne,externalInput:B,externalFlagInput:Ce,colorInput:E,depsInput:we,categoryValue:ae.querySelector(".item-editor__meta-value"),errorEl:Y},Q.addEventListener("click",z),U.addEventListener("click",z),F.addEventListener("click",z),D.addEventListener("submit",Ee=>{Ee.preventDefault(),re()}),document.addEventListener("keydown",Ee=>{Ee.key==="Escape"&&!O.hidden&&(Ee.preventDefault(),Ee.stopPropagation(),z())}),document.body.appendChild(O),O}function ke(O){const F=o(O);return F?(se(),g.categoryId=F.category.id,g.itemId=F.item.id,g.modelData=F.modelData,g.fields.categoryValue.textContent=F.category.title||F.category.id,g.fields.idInput.value=F.item.id||"",g.fields.nameInput.value=F.item.name||"",g.fields.logoInput.value=F.item.logo||"",g.fields.externalInput.value=typeof F.item.external=="string"?F.item.external:"",g.fields.externalFlagInput.checked=F.item.external===!0,g.fields.colorInput.value=F.item.color||"",g.fields.depsInput.value=Array.isArray(F.item.deps)?F.item.deps.join(", "):"",R(""),C(F.item.id),Z(),!0):!1}return{open:ke,hide:z,isOpen:()=>!!g.wrapper&&!g.wrapper.hidden}}function ai(o,a="series"){return(o||a).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||a}function Gt(o,a="series"){return ai(o,a).replace(/\./g,"-")||ai(a,"series")}function hi(o,{seriesName:a,fallbackTitle:p="unknown"}={}){var g,R;const w=[o==null?void 0:o.seriesId,(g=o==null?void 0:o.data)==null?void 0:g.seriesId,o==null?void 0:o.apicurioArtifactId,a,o==null?void 0:o.title,o==null?void 0:o.apicurioArtifactName,(R=o==null?void 0:o.data)==null?void 0:R.title,p].map(z=>(z??"").toString().trim()),C=w.findIndex(Boolean),I=C!==-1?w[C]:"";return I?(console.log("[Series] deriveSeriesId: picked base",{base:I,sourceIndex:C,candidates:w}),Gt(I,p)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:p}),null)}function rt(o,{seriesName:a,fallbackTitle:p="unknown"}={}){if(!o||typeof o!="object")return null;const k=hi(o,{seriesName:a,fallbackTitle:p});return k?(o.seriesId=k,o.apicurioArtifactId||(o.apicurioArtifactId=k),k):null}function on(o,a={}){var w,C;if(!o)return null;const p=o.isSeries||((w=o.apicurioVersions)==null?void 0:w.length)>1||o.seriesId||((C=o.data)==null?void 0:C.seriesId)||o.apicurioArtifactId;if(!p&&!a.force)return null;const k=hi(o,a);return k||(p?Gt(a.fallbackTitle||"unknown"):null)}const rn=typeof import.meta<"u"&&"./"||"";function Ao(){console.log("[Blockscape] init");const o=document.getElementById("jsonBox"),a=document.querySelector(".blockscape-json-panel"),p=document.getElementById("app"),k=document.getElementById("overlay"),w=document.getElementById("tabTooltip"),C=document.getElementById("modelList"),I=document.getElementById("itemPreview"),g=document.getElementById("urlForm"),R=document.getElementById("urlInput"),z=document.getElementById("loadUrl"),Z=I.querySelector(".item-preview__title"),H=I.querySelector(".item-preview__body"),re=I.querySelector(".item-preview__actions"),se=I.querySelector(".item-preview__close"),ke=document.getElementById("downloadJson"),O=document.getElementById("shareModel"),F=document.getElementById("createVersion"),W=document.getElementById("openInEditor"),M=document.getElementById("copyJson"),J=document.getElementById("copySeries"),U=document.getElementById("pasteJson"),D=document.getElementById("helpButton"),ae=document.getElementById("newPanelButton"),Y=document.getElementById("shortcutHelp"),be=document.getElementById("shortcutHelpList"),K=document.getElementById("shortcutHelpClose"),ue=document.getElementById("shortcutHelpBackdrop"),ne=document.getElementById("newPanel"),B=document.getElementById("newPanelClose"),Le=document.getElementById("newPanelBackdrop"),ve="blockscape:editorPayload",Ce="blockscape:editorTransfer",de=document.title;o.value=document.getElementById("seed").textContent.trim();let _=[],E=-1;const we=ko({models:_,getActiveIndex:()=>E,setActive:it,ensureModelMetadata:at,getModelId:b,getSeriesId:on,ensureSeriesId:rt,getModelTitle:d,computeJsonFingerprint:It,uid:Pe});let q=null,Q=new Map,V=null,Ee=0,xe={x:0,y:0},He="map",fe=null,Ue=!1,Fe=null;const We=2e3;let me=null,pe=null,ee=null,_e=null,Me=null,Je=null,je="",st=!1,qe=null;we.hydrateConfig();function Pe(){return Math.random().toString(36).slice(2,10)}function bt(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function Et(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function ce(e){return bt(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Ie(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),Et(t)}function an(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),s=document.createElement("a");s.href=i,s.download=e,s.click(),URL.revokeObjectURL(i)}async function Rt(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function kt(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function xt(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function cn(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function ln(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(c=>c&&typeof c=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function _t(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t)}function Ht(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>Ht(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${Ht(e[i])}`).join(",")}}`}function Wt(e){try{return Ht(e)}catch{return""}}function It(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=Wt(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=Wt(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const dn=[{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile."},{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Jump to the previous or next category while keeping position where possible."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Delete"]],description:"Delete the selected item (use Cmd/Ctrl+Z to undo)."},{keys:[["F2"]],description:"Open the item editor for the selected tile."},{keys:[["Escape"]],description:"Close the open preview popover."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."}];function at(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const s=(e.id??"").toString().trim();if(s)e.id=s;else{const c=n||e.title||t||"model",l=xt(c).replace(/\./g,"-");e.id=l||`model-${Pe()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function r(e){return JSON.parse(JSON.stringify(e))}function d(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function y(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const s=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(s)return s;const c=b(e);return c?`${c} series`:t}return d(e,t)}function b(e){var s;const t=on(e);if(t)return t;const n=(s=e==null?void 0:e.data)==null?void 0:s.id;return n&&n.toString().trim()||null}function m(e){const t=(e??"").toString().trim();return t?t.split(/[^a-zA-Z0-9]+/).filter(Boolean)[0]||t:""}function A(e){var f;if(e<0||e>=_.length||!o)return!0;const t=_[e],n=(o.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}at(i,{titleHint:d(t),idHint:b(t)});const s=It(t.data),c=It(i);if(s===c)return!0;t.data=i;const l=Nt(t);return l>=0&&((f=t.apicurioVersions)!=null&&f[l])&&(t.apicurioVersions[l].data=i),!0}function P(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function N(e){if(E<0||!e)return null;const t=_[E].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const c=(i.items||[]).find(l=>l.id===e);if(c)return{category:i,item:c,modelData:t}}return null}function te(e,t){const n=P(t);let i=xt(e||"item");if(!n.has(i))return i;const s=()=>Pe().slice(0,4);for(;n.has(i);)i=`${xt(e||"item")}-${s()}`;return i}const j=Io({findItemAndCategoryById:N,collectAllItemIds:P,updateItemReferences:_o,loadActiveIntoEditor:pt,rebuildFromActive:lt,select:e=>Xe(e),onSelectionRenamed:(e,t)=>{var n;V===e&&(V=t),((n=fe==null?void 0:fe.item)==null?void 0:n.id)===e&&(fe.item.id=t)}});function G(e,{versionLabel:t,createdOn:n}={}){var u,v,S;if(e!=null&&e.isSeries||((u=e==null?void 0:e.apicurioVersions)==null?void 0:u.length)>1){const L=e.title||d(e);rt(e,{seriesName:L,fallbackTitle:L})}const i=b(e);if(!i)return _.push(e),_.length-1;const s=_.findIndex(L=>b(L)===i);if(s===-1)return _.push(e),_.length-1;const c=_[s];if(!Array.isArray(c.apicurioVersions)||!c.apicurioVersions.length){c.apicurioVersions=[{version:"1",data:c.data,createdOn:(S=(v=c.apicurioVersions)==null?void 0:v[0])==null?void 0:S.createdOn}],c.apicurioActiveVersionIndex=0;const L=c.title||d(c);rt(c,{seriesName:L,fallbackTitle:L})}const l=String(c.apicurioVersions.length+1);c.apicurioVersions.push({version:l,data:e.data,createdOn:n||new Date().toISOString()}),c.apicurioActiveVersionIndex=c.apicurioVersions.length-1,c.data=e.data,c.title=d(e)||c.title,c.isSeries=!0;const f=c.title||d(c);return rt(c,{seriesName:f,fallbackTitle:f}),s}function he({versionLabel:e}={}){if(E<0||!_[E])throw new Error("Load or select a model before creating a version.");let t;try{t=r(_[E].data)}catch(i){throw console.warn("[Blockscape] failed to clone active model for versioning",i),new Error("Could not copy the current model.")}return at(t,{titleHint:d(_[E]),idHint:b(_[E])}),G({title:d(_[E]),data:t},{versionLabel:e||"manual",createdOn:new Date().toISOString()})}function Se(){const e=E>=0&&_[E]?_[E]:null,t=b(e);document.title=t?`${t}-blockscape`:de}function ie(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||d(e);return rt(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function Ze(){const e=_[E],t=ie(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function Ye(e="shortcut",t=!1){const n=o.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=_[E],s=t?ie(i):null,c=!!s,l=c?JSON.stringify(s,null,2):n,f=c&&on(i)||d(i,"blockscape"),u=c?"-series":"",v=`${xt(f)}${u}.json`;return an(v,l),console.log(`[Blockscape] saved JSON (${e}):`,v),!0}const De={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function le(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return De[n]||"#9ca3af"}function Ne(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(u=>u+u).join(""):t,i=parseInt(n,16),s=i>>16&255,c=i>>8&255,l=i&255;return .2126*Math.pow(s/255,2.2)+.7152*Math.pow(c/255,2.2)+.0722*Math.pow(l/255,2.2)>.35?"#111111":"#ffffff"}function tt(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function ye(){if(pe)return;pe=document.createElement("div"),pe.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",ee=document.createElement("span"),ee.className="series-nav-notice__text",pe.appendChild(e),pe.appendChild(ee),document.body.appendChild(pe)}function Ve(){_e&&(clearTimeout(_e),_e=null),pe&&pe.classList.remove("is-visible"),ee&&(ee.textContent="")}function Be(){me=null,Ve()}function ct(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function nt(e,t,n){ye(),me={id:e,targetVersionIndex:t};const i=ct(n,t);ut(`Click again to open ${i} in this series.`)}function ut(e,t=We,n=null){if(ye(),ee.textContent="",ee.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),s=document.createElement("a");s.href=n,s.target="_blank",s.rel="noopener",s.textContent=n,ee.appendChild(i),ee.appendChild(s)}pe.classList.add("is-visible"),_e&&clearTimeout(_e),_e=setTimeout(()=>Ve(),t)}function At(){be&&(be.innerHTML="",dn.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((s,c)=>{if(c>0){const f=document.createElement("span");f.className="shortcut-help__or",f.textContent="or",n.appendChild(f)}const l=document.createElement("div");l.className="shortcut-help__combo",s.forEach((f,u)=>{if(u>0){const S=document.createElement("span");S.className="shortcut-help__sep",S.textContent="+",l.appendChild(S)}const v=document.createElement("kbd");v.className="shortcut-help__key",v.textContent=f,l.appendChild(v)}),n.appendChild(l)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),be.appendChild(t)}),Ue=!0)}function Mn(){return!!Y&&Y.hidden===!1}function gi(){if(!Y)return;Ue||At(),Fe=document.activeElement,Y.hidden=!1,Y.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Y.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function un(){if(!Y||Y.hidden)return;Y.hidden=!0,Y.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=Fe;e!=null&&e.focus?e.focus({preventScroll:!0}):D!=null&&D.focus&&D.focus({preventScroll:!0})}function bi(){if(!ne)return;ne.hidden=!1,ne.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=ne.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function pn(){!ne||ne.hidden||(ne.hidden=!0,ne.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),ae!=null&&ae.focus&&ae.focus({preventScroll:!0}))}let fn=!1;function Vn(){fn||(fn=!0,requestAnimationFrame(()=>{fn=!1,hn(),Dt()}))}let Rn=!1;function it(e){if(ot(),Be(),fe=null,e<0||e>=_.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}st=!0,E=e,console.log("[Blockscape] active model:",d(_[e]),"(index",e+" )"),Se(),St(),pt(),lt(),we.updateAvailability()}function St(){if(C.innerHTML="",!_.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",C.appendChild(e);return}_.forEach((e,t)=>{var L;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===E?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===E?"true":"false");const s=document.createElement("span");s.className="model-nav-label";const c=document.createElement("span");c.className="model-nav-title",c.textContent=y(e),s.appendChild(c);const l=b(e);if(l){const oe=document.createElement("span");oe.className="model-nav-id",oe.textContent=l,s.appendChild(oe)}const f=Array.isArray((L=e.data)==null?void 0:L.categories)?e.data.categories:[],u=f.reduce((oe,ge)=>oe+(ge.items||[]).length,0),v=document.createElement("span");v.className="model-nav-meta";const S=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";v.textContent=`${f.length} cat · ${u} items${S}`,i.appendChild(s),i.appendChild(v),n.appendChild(i),C.appendChild(n)}),we.updateAvailability()}function pt(){if(E<0){o.value="",J&&(J.disabled=!0);return}const e=_[E];o.value=JSON.stringify(e.data,null,2),J&&(J.disabled=!ie(e))}function vi(e){try{return JSON.parse(e)}catch{return null}}function wi(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const s=i.map((S,L)=>!S||typeof S!="object"?null:(at(S,{titleHint:`${t} #${L+1}`}),{obj:S,idx:L})).filter(Boolean);if(!s.length)return[];const c=s[0].obj,{seriesTitleOverride:l}=n;let f=l||c.title||`${t} series`;l&&!c.title&&(c.title=l);const u={id:Pe(),title:f,data:c,apicurioVersions:s.map(({obj:S,idx:L})=>({version:String(L+1),data:S})),apicurioActiveVersionIndex:0,isSeries:!0},v=rt(u,{seriesName:f,fallbackTitle:f});return v&&(u.id=v),[u]}function Hn(e,t="Pasted",n={}){return Array.isArray(e)?wi(e,t,n):!e||typeof e!="object"?[]:(at(e,{titleHint:`${t} #1`}),[{id:Pe(),title:e.title||`${t} #1`,data:e}])}function vt(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const s=vi(i);if(s){let l=n;if(Array.isArray(s)&&n.promptForSeriesName){const u=ln(s,t),v=cn(u);l={...n,promptForSeriesName:!1,seriesTitleOverride:v||u}}const f=Hn(s,t,l);if(f.length)return f}return i.split(/^\s*(?:---|%%%)\s*$/m).map(l=>l.trim()).filter(Boolean).map((l,f)=>{const u=JSON.parse(l);return at(u,{titleHint:`${t} #${f+1}`}),{id:Pe(),title:u.title||`${t} #${f+1}`,data:u}})}function yi(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function Ct(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!yi(e)}function Ei(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function Dn(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(ve)}catch(s){return console.warn("[Blockscape] failed to access editor payload",s),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(s){console.warn("[Blockscape] invalid payload JSON",s);try{localStorage.removeItem(ve)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(ve)}catch(s){console.warn("[Blockscape] failed to clear editor payload",s)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=vt(t.text,t.title||"Editor Export")}catch(s){return console.warn("[Blockscape] could not parse payload text",s),null}if(!n.length)return null;let i=null;return n.forEach(s=>{const c=G(s,{versionLabel:"editor"});i==null&&(i=c)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function Fn(e="storage"){const t=Dn();return!t||typeof t.index!="number"?!1:(it(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function ki(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const l=new URLSearchParams(window.location.search);l.has("share")&&(t=l.get("share"))}if(!t)return null;let i;try{const l=Ie(t);i=JSON.parse(l)}catch(l){return console.warn("[Blockscape] failed to decode share token",l),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const s=Hn(i.data,i.title||"Shared Model");if(!s.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let c=null;return s.forEach(l=>{const f=l.isSeries?i.title||l.title:null,u=G({...l,apicurioArtifactName:f||l.apicurioArtifactName},{versionLabel:"shared"});c==null&&(c=u)}),c}async function xi(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await wn(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function _i(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(c=>(c.items||[]).forEach(l=>{i.add(l.id);const f=new Set(l.deps||[]);(e.links||[]).forEach(u=>{u.from===l.id&&f.add(u.to)}),t.set(l.id,f),f.forEach(u=>{n.has(u)||n.set(u,new Set),n.get(u).add(l.id)})}));const s=new Set;return n.forEach((c,l)=>{((c==null?void 0:c.size)||0)>=2&&s.add(l)}),{m:e,fwd:t,rev:n,reusedLocal:s,seen:i}}function Ii(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const s=n.getContext("2d"),c=(e||"?").charAt(0).toUpperCase(),l=le(e,t),f=Ne(l);return s.fillStyle=l,s.beginPath(),s.arc(i/2,i/2,i/2-2,0,2*Math.PI),s.fill(),s.strokeStyle="rgba(0,0,0,0.15)",s.lineWidth=1,s.stroke(),s.fillStyle=f,s.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,s.textAlign="center",s.textBaseline="middle",s.fillText(c,i/2,i/2),n.toDataURL("image/png")}function Nt(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Jn(e){const t=Nt(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Ai(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var l,f;const s=(((l=n==null?void 0:n.data)==null?void 0:l.id)??"").toString().trim();s&&t.set(s,i);const c=(((f=n==null?void 0:n.data)==null?void 0:f.seriesId)??"").toString().trim();c&&!t.has(c)&&t.set(c,i)}),t}const jn=new WeakMap;function Si(e,t){var Ge;if(!((Ge=e==null?void 0:e.apicurioVersions)!=null&&Ge[t]))return null;const n=e.apicurioVersions[t],i=n.data,s=It(i),c=jn.get(n);if(c&&c.fingerprint===s)return c.dataUrl;const l=160,f=90,u=document.createElement("canvas");u.width=l,u.height=f;const v=u.getContext("2d");v.fillStyle="#f8fafc",v.fillRect(0,0,l,f),v.strokeStyle="#e5e7eb",v.strokeRect(.5,.5,l-1,f-1);const S=Array.isArray(i==null?void 0:i.categories)?i.categories:[],L=Math.max(S.length,1),oe=l/L,ge=8,Te=8,Qe=4;S.forEach((Yt,Xt)=>{const yn=Xt*oe+oe/2,$t=Array.isArray(Yt.items)?Yt.items:[],Bt=Math.max($t.length,1);$t.forEach((ht,Zt)=>{const Qt=ge+(Zt+.5)*((f-ge-Te)/Bt);v.beginPath(),v.arc(yn,Qt,Qe,0,Math.PI*2);const en=le(ht.name||ht.id||"",ht.color);v.fillStyle=en,v.strokeStyle="rgba(15,23,42,0.25)",v.fill(),v.stroke()})});const et=u.toDataURL("image/png");return jn.set(n,{fingerprint:s,dataUrl:et}),et}function mn(e,t){var f;if(Be(),e<0||e>=_.length)return!1;const n=_[e];if(!((f=n==null?void 0:n.apicurioVersions)!=null&&f.length)||!A(e))return!1;const s=n.apicurioVersions.length,c=(t%s+s)%s,l=n.apicurioVersions[c];return l!=null&&l.data?(n.apicurioActiveVersionIndex=c,n.data=l.data,st=!0,V=null,pt(),lt(),!0):!1}function qn(e){var i;if(!e||E<0)return;const t=_[E];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return;const n=Nt(t);n!==-1&&mn(E,n+e)}function Ci(e){if(!(e!=null&&e.apicurioVersions)||e.apicurioVersions.length<=1)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||b(e)||"Artifact",t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const s=Nt(e),c=Jn(e)||"latest";i.textContent=`No. in series ${c} (${s+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const l=document.createElement("div");l.className="version-nav__controls";const f=document.createElement("button");f.type="button",f.className="version-nav__button",f.textContent="Previous",f.addEventListener("click",()=>qn(-1));const u=document.createElement("button");u.type="button",u.className="version-nav__button",u.textContent="Next",u.addEventListener("click",()=>qn(1)),l.appendChild(f),l.appendChild(u),t.appendChild(l);const v=document.createElement("div");return v.className="version-nav__thumbs",e.apicurioVersions.forEach((S,L)=>{var et;const oe=document.createElement("button");oe.type="button",oe.className="version-nav__thumb",L===s&&oe.classList.add("is-active");const ge=Si(e,L);if(ge){const Ge=document.createElement("img");Ge.src=ge,Ge.alt=`Version ${L+1}`,oe.appendChild(Ge)}const Te=document.createElement("div");Te.className="version-nav__thumb-label";const Qe=m(((et=S==null?void 0:S.data)==null?void 0:et.id)||(S==null?void 0:S.id)||"");Te.textContent=Qe||(S!=null&&S.version?`v${S.version}`:`${L+1}`),oe.appendChild(Te),oe.addEventListener("click",()=>mn(E,L)),v.appendChild(oe)}),t.appendChild(v),t}function Lt(){var Qt,en,Zn,Qn;if(!q)return;ft(),Array.isArray(q.m.categories)||(q.m.categories=[]),console.log("[Blockscape] rendering categories=",q.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!q.m.abstract,"- value:",q.m.abstract?q.m.abstract.substring(0,50)+"...":"none"),p.innerHTML="",Q.clear();const e=Ci(_[E]);e&&p.appendChild(e),k.setAttribute("width",window.innerWidth),k.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=q.m.title&&q.m.title.trim()||d(_[E]),t.appendChild(n),((Qt=_[E])!=null&&Qt.isSeries||((Zn=(en=_[E])==null?void 0:en.apicurioVersions)==null?void 0:Zn.length)>1)&&rt(_[E],{seriesName:_[E].title||q.m.title||d(_[E])});const i=Jn(_[E]),s=on(_[E]),c=(q.m.id??"").toString().trim(),l=s||c;if(l){const T=document.createElement("div");T.className="blockscape-model-id",T.textContent=`ID: ${l}`,t.appendChild(T)}if(i){const T=document.createElement("div");T.className="blockscape-model-id",T.textContent=`No. in series: ${i}`,t.appendChild(T)}p.appendChild(t);const f=document.createElement("div");f.className="blockscape-tabs";const u=document.createElement("div");u.className="blockscape-tablist",u.setAttribute("role","tablist"),f.appendChild(u);const v=document.createElement("div");v.className="blockscape-tabpanels",f.appendChild(v);const S=document.createElement("div"),L=document.createElement("div"),oe=document.createElement("div"),ge=document.createElement("div");let Te="";const Qe=Ai(_[E]),et=Nt(_[E]);Je=null,je="";const Ge=[{id:"map",label:"Map",panel:S},{id:"abstract",label:"Info",panel:L},{id:"source",label:"Source",panel:oe},{id:"apicurio",label:"Apicurio",panel:ge}],Yt=T=>{if(!k)return;const Ae=T==="map";k.hidden=!Ae,Ae?(hn(),Dt()):k.innerHTML=""};Ge.forEach((T,Ae)=>{const $e=document.createElement("button");$e.type="button",$e.id=`tab-${T.id}`,$e.className="blockscape-tab"+(Ae===0?" is-active":""),$e.setAttribute("role","tab"),$e.setAttribute("aria-controls",`panel-${T.id}`),$e.setAttribute("aria-selected",Ae===0?"true":"false"),$e.textContent=T.label,T.button=$e,u.appendChild($e),T.panel.id=`panel-${T.id}`,T.panel.classList.add("blockscape-tabpanel"),T.panel.setAttribute("role","tabpanel"),T.panel.setAttribute("aria-labelledby",$e.id),T.panel.hidden=Ae!==0,Ae===0&&T.panel.classList.add("is-active"),v.appendChild(T.panel)});const Xt=T=>{He=T,Ge.forEach(Ae=>{const $e=Ae.id===T;Ae.button.classList.toggle("is-active",$e),Ae.button.setAttribute("aria-selected",$e?"true":"false"),Ae.panel.classList.toggle("is-active",$e),Ae.panel.hidden=!$e}),Yt(T)};Ge.forEach(T=>{T.button.addEventListener("click",()=>{ft(),Xt(T.id)}),T.id==="abstract"&&(Je=T.button,T.button.addEventListener("mouseenter",()=>vn(T.button,Te,{offset:12})),T.button.addEventListener("mouseleave",ft),T.button.addEventListener("focus",()=>vn(T.button,Te,{offset:12})),T.button.addEventListener("blur",ft))});const yn=((Qn=Ge.find(T=>T.id===He))==null?void 0:Qn.id)||Ge[0].id;Xt(yn),p.appendChild(f);const $t=document.createElement("div");$t.className="blockscape-render",S.appendChild($t);const Bt=document.createElement("div");if(Bt.className="blockscape-abstract-panel",q.m.abstract){console.log("[Blockscape] Rendering abstract content");const T=document.createElement("div");T.className="blockscape-abstract",T.innerHTML=q.m.abstract,Zi(T),Bt.appendChild(T),Te=T.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const T=document.createElement("div");T.className="blockscape-abstract-placeholder",T.textContent="No abstract has been provided for this model.",Bt.appendChild(T),Te=T.outerHTML}je=Te,L.appendChild(Bt);const ht=document.createElement("div");if(ht.className="blockscape-source-panel",a)a.hidden=!1,a.classList.remove("pf-v5-c-page__main-section"),ht.appendChild(a);else{const T=document.createElement("p");T.className="muted",T.textContent="Source editor unavailable.",ht.appendChild(T)}oe.appendChild(ht),we.mount(ge);let Zt=0;q.m.categories.forEach(T=>{const Ae=document.createElement("section");Ae.className="category",Ae.dataset.cat=T.id;const $e=document.createElement("div");$e.className="cat-head",$e.innerHTML=`<div class="cat-title">${bn(T.title||T.id)}</div>
                          <div class="muted cat-count">${(T.items||[]).length} items</div>`,Ae.appendChild($e);const tn=document.createElement("div");tn.className="grid",Ae.appendChild(tn),(T.items||[]).forEach(ze=>{Zt+=1;const jt=Li(ze.external),Ke=document.createElement("div");if(Ke.className=jt.isExternal?"tile external":"tile",Ke.tabIndex=0,Ke.dataset.id=ze.id,Ke.dataset.globalIndex=String(Zt),jt.url&&(Ke.dataset.externalUrl=jt.url),Qe.has(ze.id)){const xn=Qe.get(ze.id);Ke.dataset.seriesVersionIndex=String(xn),Ke.classList.add("tile--series-link");const no=xn===et?"Current map in this series":`Open version ${xn+1} in this series`;Ke.title=no}const wt=document.createElement("img");wt.className="logo",ze.logo?(wt.src=ze.logo,wt.alt=ze.name||ze.id):(wt.alt="",wt.style.opacity=1,wt.src=Ii(ze.name||ze.id,ze.color));const En=document.createElement("div");En.className="name",En.textContent=ze.name||ze.id;const kn=document.createElement("div");kn.className="badge",kn.textContent="reused",jt.url&&Ke.appendChild(Ti(jt.url)),Ke.appendChild(wt),Ke.appendChild(En),Ke.appendChild(kn),tn.appendChild(Ke),Q.set(ze.id,{el:Ke,catId:T.id,rect:null})}),$t.appendChild(Ae);const Jt=document.createElement("button");Jt.type="button",Jt.className="tile-add",Jt.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',Jt.addEventListener("click",()=>Fi(T.id)),tn.appendChild(Jt)}),q.reusedLocal.forEach(T=>{const Ae=Q.get(T);Ae&&(Ae.el.classList.add("reused"),Ae.el.querySelector(".badge").style.display="inline-block")}),Ni(),hn(),Dt(),$i()}function Ni(){p.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",t=>{var v;if(typeof t.button=="number"&&t.button!==0)return;ot();const n=e.dataset.id,i=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,s=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,c=_[E],l=c?Nt(c):-1,f=((v=c==null?void 0:c.apicurioVersions)==null?void 0:v.length)>1&&Number.isInteger(i)&&i!==l,u=me&&me.id===n&&me.targetVersionIndex===i;if(me&&!u&&Be(),f)if(u){if(Be(),mn(E,i))return}else nt(n,i,c);else Number.isInteger(s)&&s>0&&s%5===0&&ut("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",n),V===n&&!(f&&u)){gn();return}Xe(n)}),e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e.click())}),e.draggable=!0,e.addEventListener("dragstart",Pi),e.addEventListener("dragend",Mi)}),p.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",Vi),e.addEventListener("drop",Di),e.addEventListener("dragenter",Ri),e.addEventListener("dragleave",Hi)}),Rn||(Rn=!0,window.addEventListener("resize",Vn),window.addEventListener("scroll",Vn,{passive:!0})),document.getElementById("clear").onclick=()=>gn()}function hn(){Q.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function Xe(e){var c,l,f;V=e,Gn();const t=Array.from(q.fwd.get(e)||[]),n=Array.from(q.rev.get(e)||[]);console.log("[Blockscape] selecting id=",e,"deps=",t,"revs=",n);const i=Q.get(e);i&&i.el.classList.add("selected"),t.forEach(u=>{const v=Q.get(u);v&&v.el.classList.add("dep")}),n.forEach(u=>{const v=Q.get(u);v&&v.el.classList.add("revdep")}),Dt();const s=(f=(l=(c=Q.get(e))==null?void 0:c.el)==null?void 0:l.dataset)==null?void 0:f.externalUrl;s&&ut("This item has link to",We,s)}function gn(){V=null,Gn(),Dt()}function Gn(){p.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","selected"))}function Dt(){var n;for(;k.firstChild;)k.removeChild(k.firstChild);if(!V||k.hidden)return;const e=(n=Q.get(V))==null?void 0:n.rect;if(!e)return;new Set([...q.fwd.get(V)||[],...q.rev.get(V)||[]]).forEach(i=>{const s=Q.get(i);if(!s||!s.rect)return;const c=zn(e),l=zn(s.rect),f=document.createElementNS("http://www.w3.org/2000/svg","path"),u=(c.x+l.x)/2,v=c.y,S=(c.x+l.x)/2,L=l.y,oe=(q.fwd.get(V)||new Set).has(i);f.setAttribute("d",`M ${c.x},${c.y} C ${u},${v} ${S},${L} ${l.x},${l.y}`),f.setAttribute("fill","none"),f.setAttribute("stroke",oe?"var(--blockscape-dep)":"var(--blockscape-revdep)"),f.setAttribute("stroke-opacity","0.45"),f.setAttribute("stroke-width","2"),f.setAttribute("vector-effect","non-scaling-stroke"),k.appendChild(f)})}function zn(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function bn(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Li(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function Ti(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function vn(e,t,{offset:n=8}={}){!w||!e||!t||(w.innerHTML=t,w.hidden=!1,w.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),s=w.getBoundingClientRect(),c=window.scrollX||document.documentElement.scrollLeft,l=window.scrollY||document.documentElement.scrollTop;let f=i.left+i.width/2-s.width/2+c,u=i.top-s.height-n+l;f<c+n&&(f=c+n);const v=c+window.innerWidth-s.width-n;f>v&&(f=v),u<l+n&&(u=i.bottom+n+l),w.style.left=`${f}px`,w.style.top=`${u}px`,w.classList.add("is-visible")}))}function ft(){Me&&(clearTimeout(Me),Me=null),w&&(w.classList.remove("is-visible"),w.setAttribute("aria-hidden","true"),w.hidden=!0)}function $i(){st&&(st=!1,!(!Je||!je)&&(ft(),vn(Je,je,{offset:12}),Me=setTimeout(()=>{ft(),Bi()},1e3)))}function Bi(){Je&&(qe&&(clearTimeout(qe),qe=null),Je.classList.add("blockscape-tab--twinkle"),qe=setTimeout(()=>{Je.classList.remove("blockscape-tab--twinkle"),qe=null},1400))}window.addEventListener("scroll",ft,!0),window.addEventListener("resize",ft);function ot(){I&&(I.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),I.setAttribute("aria-hidden","true"),I.hidden=!0,Kn([]))}function Oi(e,t){I&&(xe={x:e,y:t},I.hidden=!1,I.setAttribute("aria-hidden","false"),I.classList.add("is-visible"),Tt(e,t))}function Tt(e,t){if(!I)return;const n=12;I.style.left=`${e+n}px`,I.style.top=`${t+n}px`;const i=I.getBoundingClientRect();let s=i.left,c=i.top;i.right>window.innerWidth-n&&(s=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(c=Math.max(n,window.innerHeight-i.height-n)),I.style.left=`${s}px`,I.style.top=`${c}px`}function Kn(e=[]){re&&(re.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),re.appendChild(n)}),re.hidden=e.length===0)}async function Ui(e,t){var v;if(!I)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((v=t.querySelector(".name"))==null?void 0:v.textContent)||n||"Preview",s=n?`${n}.html`:"",c=s?`items/${s}`:"",l=++Ee,f=t.dataset.externalUrl||"",u=[{label:"Edit",title:"Edit this item",onClick:()=>{ot(),j.open(n)}}];if(f&&u.push({label:"Open link ↗",title:f,onClick:()=>window.open(f,"_blank","noopener")}),Kn(u),n&&Xe(n),Z.textContent=i,H.innerHTML='<div class="item-preview__status">Loading…</div>',I.classList.remove("item-preview--has-frame"),I.classList.add("item-preview--expanded"),Oi(e.clientX,e.clientY),!c){H.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',Tt(xe.x,xe.y);return}try{const S=await fetch(c,{cache:"no-cache"});if(!S.ok)throw new Error(`HTTP ${S.status}`);const L=await S.text();if(l!==Ee)return;if(!L.trim()){H.innerHTML=`<div class="item-preview__status">No content in <code>${bn(s)}</code>.</div>`,Tt(xe.x,xe.y);return}const ge=document.createElement("iframe");ge.className="item-preview__frame",ge.title=`${i} details`,ge.srcdoc=L,H.innerHTML="",H.appendChild(ge),I.classList.add("item-preview--has-frame"),Tt(xe.x,xe.y)}catch(S){if(l!==Ee)return;H.innerHTML=`<div class="item-preview__status">No preview available for <strong>${bn(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${c}`,S),Tt(xe.x,xe.y)}}se&&se.addEventListener("click",ot),D&&D.addEventListener("click",()=>{gi()}),ae&&ae.addEventListener("click",()=>{bi()}),K&&K.addEventListener("click",un),ue&&ue.addEventListener("click",un),B&&B.addEventListener("click",pn),Le&&Le.addEventListener("click",pn),p&&p.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!p.contains(t)||Ui(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!I||I.hidden||I.contains(e.target)||ot()}),ke&&ke.addEventListener("click",()=>{Ye("button")}),F&&F.addEventListener("click",()=>{if(E<0){alert("Load or select a model before creating a version.");return}try{const e=he({versionLabel:"map edit"});it(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),O&&O.addEventListener("click",async()=>{var c;if(E<0||!_[E]){alert("Select or load a model before sharing.");return}const e={title:d(_[E],"Shared Model"),data:_[E].data};let t;try{t=ce(JSON.stringify(e))}catch(l){console.error("[Blockscape] share encode failed",l),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(l){console.warn("[Blockscape] failed to update URL for share",l),window.location.hash=n.hash}let s=!1;if((c=navigator.clipboard)!=null&&c.writeText)try{await navigator.clipboard.writeText(i),s=!0}catch(l){console.warn("[Blockscape] clipboard write failed",l)}s?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),W&&W.addEventListener("click",()=>{const e=(o.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};V&&(n.selectedItemId=V),localStorage.setItem(ve,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";V&&(t=`editor.html?selected=${encodeURIComponent(V)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==ve||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||Fn("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===Ce&&Fn("message")})),document.addEventListener("keydown",e=>{var n,i,s,c,l,f;if(Mn()){e.key==="Escape"&&(e.preventDefault(),un());return}if(!(ne!=null&&ne.hidden)&&e.key==="Escape"){e.preventDefault(),pn();return}if(!((n=j==null?void 0:j.isOpen)!=null&&n.call(j))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const u=_[E],v=((i=u==null?void 0:u.apicurioVersions)==null?void 0:i.length)>1;Ye("shortcut",v);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!Ct())return;if(zi()){e.preventDefault();return}}if(e.key==="Escape"&&I&&!I.hidden&&ot(),e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!Ct()||e.altKey||e.ctrlKey||e.metaKey)return;const u=e.key==="ArrowLeft"?-1:1;e.shiftKey?Ji(u)&&e.preventDefault():ji(u)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!Ct()||e.altKey||e.ctrlKey||e.metaKey)return;const u=e.key==="ArrowUp"?-1:1;e.shiftKey?Gi(u)&&e.preventDefault():qi(u)&&e.preventDefault()}if(e.key==="Delete"){if(!Ct()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;Ki()&&e.preventDefault()}if(e.key==="F2"){if(!Ct())return;const u=V||((f=(l=(c=(s=e.target)==null?void 0:s.closest)==null?void 0:c.call(s,".tile"))==null?void 0:l.dataset)==null?void 0:f.id);u&&j.open(u)&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!I||I.hidden||Tt(xe.x,xe.y)}),window.addEventListener("scroll",()=>{!I||I.hidden||ot()},!0);let mt=null,Ft=null;function Pi(e){ot(),mt=e.target.dataset.id,Ft=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:mt,categoryId:Ft})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",mt,"from",Ft)}function Mi(e){e.target.classList.remove("dragging"),p.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),p.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),mt=null,Ft=null}function Vi(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function Ri(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function Hi(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function Di(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!mt||!i)return;const c=Array.from(t.querySelectorAll(".tile")).filter(l=>l.dataset.id!==mt).find(l=>{const f=l.getBoundingClientRect();return e.clientY<f.top+f.height/2});Wn(mt,c?c.dataset.id:null,i),Lt(),console.log("[Blockscape] drop completed",mt,"from",Ft,"to",i)}function Wn(e,t,n){if(E<0)return;const s=_[E].data.categories||[],c=s.find(S=>(S.items||[]).some(L=>L.id===e)),l=s.find(S=>S.id===n);if(!c||!l)return;c.items=c.items||[],l.items=l.items||[];const f=c.items.findIndex(S=>S.id===e);if(f===-1)return;const[u]=c.items.splice(f,1);let v=l.items.length;if(t){const S=l.items.findIndex(L=>L.id===t);S!==-1&&(v=S)}l.items.splice(v,0,u),pt(),lt()}function Fi(e){if(E<0||!e)return;const t=_[E].data,i=(t.categories||[]).find(u=>u.id===e);if(!i)return;i.items=i.items||[];const s=`New item ${i.items.length+1}`,l={id:te(`${e}-${i.items.length+1}`,t),name:s,deps:[]};i.items.push(l),pt(),lt(),ot(),Xe(l.id);const f=Q.get(l.id);f!=null&&f.el&&f.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",l.id,"to",e)}function Ji(e){if(!V||E<0||!e)return!1;const n=_[E].data.categories||[],i=Q.get(V);let s=null;if(i!=null&&i.catId&&(s=n.find(u=>u.id===i.catId)),s||(s=n.find(u=>(u.items||[]).some(v=>v.id===V))),!s)return!1;s.items=s.items||[];const c=s.items.findIndex(u=>u.id===V);if(c===-1)return!1;const l=c+e;if(l<0||l>=s.items.length)return!1;const[f]=s.items.splice(c,1);return s.items.splice(l,0,f),pt(),lt(),Lt(),Xe(V),!0}function ji(e){if(!q||!q.m||!e)return!1;const t=q.m.categories||[];if(!t.length)return!1;const n=()=>{const u=t.find(v=>(v.items||[]).length);return u?{category:u,item:u.items[0]}:null};if(!V){const u=n();return u?(Xe(u.item.id),!0):!1}const i=Q.get(V);let s=null;if(i!=null&&i.catId&&(s=t.find(u=>u.id===i.catId)),s||(s=t.find(u=>(u.items||[]).some(v=>v.id===V))),!s){const u=n();return u?(Xe(u.item.id),!0):!1}const c=s.items||[];if(!c.length)return!1;const l=c.findIndex(u=>u.id===V);if(l===-1)return!1;const f=l+e;return f<0||f>=c.length?!1:(Xe(c[f].id),!0)}function qi(e){if(!q||!q.m||!e)return!1;const t=q.m.categories||[];if(!t.length)return!1;const n=()=>{for(const u of t)if(u.items&&u.items.length)return u.items[0].id;return null};let s=(()=>{if(!V)return-1;const u=Q.get(V);if(u!=null&&u.catId){const v=t.findIndex(S=>S.id===u.catId);if(v!==-1)return v}return t.findIndex(v=>(v.items||[]).some(S=>S.id===V))})();if(s===-1){const u=n();return u?(Xe(u),!0):!1}let l=(t[s].items||[]).findIndex(u=>u.id===V);l===-1&&(l=0);let f=s+e;for(;f>=0&&f<t.length;){const v=t[f].items||[];if(v.length){const S=Math.min(v.length-1,Math.max(0,l));return Xe(v[S].id),!0}f+=e>0?1:-1}return!1}function Gi(e){if(!V||E<0||!e)return!1;const n=_[E].data.categories||[];if(!n.length)return!1;const i=Q.get(V);let s=-1;if(i!=null&&i.catId&&(s=n.findIndex(L=>L.id===i.catId)),s===-1&&(s=n.findIndex(L=>(L.items||[]).some(oe=>oe.id===V))),s===-1)return!1;const c=s+e;if(c<0||c>=n.length)return!1;const l=n[s],f=n[c];if(!f)return!1;l.items=l.items||[],f.items=f.items||[];const u=l.items.findIndex(L=>L.id===V);if(u===-1)return!1;const v=Math.min(f.items.length,Math.max(0,u)),S=v<f.items.length?f.items[v].id:null;return Wn(V,S,f.id),Lt(),Xe(V),!0}function zi(){if(!fe||E<0)return!1;const e=_[E];if(!e||e.id!==fe.modelId)return!1;const t=fe,s=(e.data.categories||[]).find(l=>l.id===t.categoryId);if(!s)return!1;s.items=s.items||[];const c=Math.min(Math.max(t.index,0),s.items.length);return s.items.splice(c,0,t.item),fe=null,ot(),V=null,pt(),lt(),Lt(),Xe(t.item.id),console.log("[Blockscape] undo delete restored",t.item.id),!0}function Ki(){if(!V||E<0)return!1;const t=_[E].data.categories||[];if(!t.length)return!1;const n=Q.get(V);let i=null;if(n!=null&&n.catId&&(i=t.find(v=>v.id===n.catId)),i||(i=t.find(v=>(v.items||[]).some(S=>S.id===V))),!i||!Array.isArray(i.items))return!1;const s=i.items.findIndex(v=>v.id===V);if(s===-1)return!1;const c=i.items.splice(s,1)[0];if(!c)return!1;const l=_[E];fe={item:c,categoryId:i.id,index:s,modelId:l?l.id:null};const u=(()=>{var S;if(i.items.length){const L=Math.min(s,i.items.length-1);return((S=i.items[L])==null?void 0:S.id)||null}const v=t.findIndex(L=>L.id===i.id);if(v===-1)return null;for(let L=v+1;L<t.length;L++){const oe=t[L].items||[];if(oe.length)return oe[0].id}for(let L=v-1;L>=0;L--){const oe=t[L].items||[];if(oe.length)return oe[0].id}return null})();return ot(),V=null,pt(),lt(),Lt(),u?Xe(u):gn(),console.log("[Blockscape] removed item",c.id),!0}M&&M.addEventListener("click",async()=>{const e=o.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await Rt(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),J&&J.addEventListener("click",async()=>{const e=Ze();if(!e){alert("No series available to copy. Create another version first.");return}await Rt(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),U&&U.addEventListener("click",async()=>{try{const e=await kt();if(!e){alert("Clipboard is empty.");return}o.value=e,o.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=vt(o.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const s=G(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=s)}),E===-1&&t!=null?it(t):St()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(E<0){alert("No active model selected.");return}try{const t=JSON.parse(o.value);if(at(t,{titleHint:d(_[E]),idHint:b(_[E])||d(_[E])}),_[E].data=t,_[E].title=t.title||_[E].title,_[E].isSeries||((e=_[E].apicurioVersions)==null?void 0:e.length)>1){const n=_[E].title||d(_[E]);rt(_[E],{seriesName:n,fallbackTitle:n})}Se(),console.log("[Blockscape] replaced active model:",d(_[E])),lt(),we.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const s=await i.text(),c=i.name.replace(/\.[^.]+$/,"")||"File",l=vt(s,c,{seriesTitleOverride:`${c} series`});if(!l.length){console.warn("[Blockscape] no models in file:",i.name);continue}l.forEach((f,u)=>{var Qe;const v=(((Qe=f.data)==null?void 0:Qe.title)??"").toString().trim(),S=l.length>1?`${i.name} #${u+1}`:i.name,L=`${c} series`,oe=f.isSeries?L:null;let ge={...f};if(f.isSeries){const et=oe||v||f.title||S||"unknown";ge.title=et;const Ge=Gt(et||"unknown");_t(ge,Ge),rt(ge,{seriesName:et,fallbackTitle:"unknown"}),ge.apicurioArtifactName=ge.apicurioArtifactName||et}else ge.title=v||S;const Te=G({...ge,apicurioArtifactName:ge.apicurioArtifactName||oe||ge.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=Te)})}E===-1&&n!=null?it(n):St()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",Wi);function Wi(e){var s;if(!Ct())return;const t=((s=e.clipboardData)==null?void 0:s.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Ei(t))return;let n=[];try{n=vt(t,"Clipboard",{promptForSeriesName:!0})}catch(c){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",c);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((c,l)=>{const f=G(c,{versionLabel:n.length>1?`paste #${l+1}`:"paste"});i==null&&(i=f)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&it(i)}C.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(tt(),it(n))}),document.getElementById("removeModel").onclick=()=>{if(E<0)return;const e=d(_[E]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",d(_[E])),_.splice(E,1),!_.length){E=-1,q=null,p.innerHTML="",k.innerHTML="",o.value="",St(),Se();return}const n=Math.min(E,_.length-1);it(n)},document.getElementById("search").addEventListener("input",e=>{const t=e.target.value.trim().toLowerCase();console.log("[Blockscape] search:",t),p.querySelectorAll(".tile").forEach(n=>{const i=n.querySelector(".name").textContent.toLowerCase();n.style.opacity=!t||i.includes(t)?1:.2})}),g&&R&&z&&g.addEventListener("submit",async e=>{e.preventDefault();const t=R.value.trim();if(!t){alert("Please enter a URL"),R.focus();return}const n=await wn(t);if(typeof n=="number"){it(n),R.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!R||!t)return;let n=null;R.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const s=R.value.slice(-12);t.textContent=s?`…${s}`:""},300)})}();function lt(){if(!(E<0))try{q=_i(_[E].data),Lt()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function Yi(){const e=["NFR.bs","planets.bs","styleguide.bs"],t=n=>rn?rn.endsWith("/")?`${rn}${n}`:`${rn}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const s=await i.text(),c=n.replace(/\.[^.]+$/,"")||"Model",l=vt(s,c,{seriesTitleOverride:`${c} series`});if(!l.length){console.warn("[Blockscape] no models found in",n);continue}l.forEach(f=>{let u={...f};if(f.isSeries){const v=`${c} series`;u={...f,title:v,apicurioArtifactName:v};const S=Gt(v||"unknown");_t(u,S),rt(u,{seriesName:v,fallbackTitle:"unknown"})}G(u,{versionLabel:n})}),console.log(`[Blockscape] loaded ${l.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}St()}async function Xi(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const s=await fetch(e,i);if(s.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);return await s.text()}catch(s){n=s}throw n||new Error("Unable to fetch URL")}function Zi(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>Qi(i)),e.querySelectorAll("a[href]").forEach(i=>{const s=i.getAttribute("href");Xn(s)&&Yn(i,s)})}function Qi(e){var f,u;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(u=(f=e.parentNode)==null?void 0:f.closest)!=null&&u.call(f,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let s;for(;(s=n.exec(t))!==null;)i.push({url:s[0],index:s.index});if(!i.length)return;const c=document.createDocumentFragment();let l=0;i.forEach(({url:v,index:S})=>{S>l&&c.appendChild(document.createTextNode(t.slice(l,S))),c.appendChild(eo(v)),l=S+v.length}),l<t.length&&c.appendChild(document.createTextNode(t.slice(l))),e.parentNode.replaceChild(c,e)}function eo(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",Xn(e)&&Yn(t,e),t}function Yn(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>to(n,t,e)))}async function to(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await wn(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function Xn(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function wn(e){try{console.log("[Blockscape] loading from URL:",e);const t=await Xi(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let s;try{s=vt(t,i)}catch(l){throw new Error(`Invalid JSON payload: ${l.message}`)}if(!s.length)throw new Error("No JSON objects found in response.");let c=null;return s.forEach((l,f)=>{var ge;const u=(((ge=l.data)==null?void 0:ge.title)??"").toString().trim(),v=s.length>1?`${i} #${f+1}`:i,S=l.isSeries?`${i} series`:null;let L={...l};if(l.isSeries){const Te=S||u||L.title||v;L={...l,title:Te,apicurioArtifactName:Te||l.apicurioArtifactName};const Qe=Gt(Te||"unknown");_t(L,Qe),rt(L,{seriesName:Te||S||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:Qe,url:e,baseName:i,seriesTitle:Te})}const oe=G({...L,title:u||L.title||v,apicurioArtifactName:L.apicurioArtifactName||S||l.apicurioArtifactName},{versionLabel:i});c==null&&(c=oe)}),console.log(`[Blockscape] loaded ${s.length} model(s) from URL:`,i),E===-1&&c!=null?it(c):St(),c}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=vt(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let s=null;i.forEach(S=>{const L=G(S,{versionLabel:"seed"});s==null&&(s=L)}),await Yi();const c=await xi(),l=Dn(),f=l==null?void 0:l.index,u=ki();it(typeof c=="number"?c:typeof u=="number"?u:typeof f=="number"?f:s??0)})()}function So(o){let a;return{c(){a=$("div"),a.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',h(a,"id","shortcutHelp"),h(a,"class","shortcut-help"),a.hidden=!0,h(a,"aria-hidden","true"),h(a,"role","dialog"),h(a,"aria-modal","true"),h(a,"aria-labelledby","shortcutHelpTitle")},m(p,k){Re(p,a,k)},p:dt,i:dt,o:dt,d(p){p&&Oe(a)}}}class Co extends Pn{constructor(a){super(),Un(this,a,null,So,Bn,{})}}const No=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function ci(o){let a,p,k,w,C,I,g,R;return{c(){a=$("div"),p=$("div"),k=$("a"),w=On("Open Blockscape GPT"),C=X(),I=$("div"),I.textContent="Paste the copied prompt into that chat.",g=X(),R=$("div"),R.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',h(k,"href",To),h(k,"target","_blank"),h(k,"rel","noreferrer"),h(I,"class","new-panel__hint"),h(p,"class","new-panel__link"),h(R,"class","new-panel__link new-panel__link--disabled"),h(a,"class","new-panel__links")},m(z,Z){Re(z,a,Z),x(a,p),x(p,k),x(k,w),x(p,C),x(p,I),x(a,g),x(a,R)},p:dt,d(z){z&&Oe(a)}}}function li(o){let a,p,k,w,C,I;return{c(){a=$("div"),p=$("div"),p.textContent="Generated prompt",k=X(),w=$("textarea"),h(p,"class","new-panel__prompt-label"),h(w,"class","pf-v5-c-form-control new-panel__textarea"),h(w,"rows","4"),w.readOnly=!0,h(a,"class","new-panel__prompt")},m(g,R){Re(g,a,R),x(a,p),x(a,k),x(a,w),Mt(w,o[4]),C||(I=yt(w,"input",o[12]),C=!0)},p(g,R){R&16&&Mt(w,g[4])},d(g){g&&Oe(a),C=!1,I()}}}function Lo(o){let a,p,k,w,C,I,g,R,z,Z,H,re,se,ke,O,F,W,M,J,U,D,ae,Y,be,K,ue,ne,B,Le,ve,Ce,de,_,E,we,q,Q,V,Ee,xe,He,fe,Ue,Fe,We,me=o[2]==="gpt"&&ci(),pe=o[4]&&o[5]&&li(o);return Ue=co(o[10][0]),{c(){a=$("div"),p=$("div"),k=X(),w=$("div"),C=$("div"),C.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',I=X(),g=$("form"),R=$("div"),z=$("label"),z.textContent="Domain",Z=X(),H=$("p"),H.textContent="Describe what you want to create a map for.",re=X(),se=$("textarea"),ke=X(),O=$("div"),F=$("label"),W=$("input"),M=X(),J=$("span"),J.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,U=X(),D=$("fieldset"),ae=$("legend"),ae.textContent="Target",Y=X(),be=$("p"),be.textContent="Choose where you plan to use the prompt.",K=X(),ue=$("label"),ne=$("input"),B=X(),Le=$("div"),Le.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',ve=X(),Ce=$("label"),de=$("input"),_=X(),E=$("div"),E.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',we=X(),q=$("div"),Q=$("button"),Q.textContent="Copy prompt",V=X(),Ee=$("div"),xe=On(o[3]),He=X(),me&&me.c(),fe=X(),pe&&pe.c(),h(p,"id","newPanelBackdrop"),h(p,"class","shortcut-help__backdrop"),h(C,"class","shortcut-help__header"),h(z,"for","newDomain"),h(H,"class","new-panel__hint"),h(se,"id","newDomain"),h(se,"class","pf-v5-c-form-control new-panel__textarea"),h(se,"rows","4"),se.required=!0,h(se,"placeholder","Ex: Companies building open-source geospatial tools"),h(R,"class","new-panel__field"),h(W,"id","seriesToggle"),h(W,"type","checkbox"),h(F,"class","new-panel__toggle"),h(F,"for","seriesToggle"),h(O,"class","new-panel__field"),h(be,"class","new-panel__hint"),h(ne,"type","radio"),h(ne,"name","target"),ne.__value="gpt",Mt(ne,ne.__value),h(ue,"class","new-panel__option"),h(de,"type","radio"),h(de,"name","target"),de.__value="plain",Mt(de,de.__value),h(Ce,"class","new-panel__option"),h(D,"class","new-panel__field"),h(Q,"class","pf-v5-c-button pf-m-primary"),h(Q,"type","submit"),h(Ee,"class","new-panel__status"),h(Ee,"aria-live","polite"),h(q,"class","new-panel__actions"),h(g,"class","shortcut-help__list new-panel__form"),h(w,"class","shortcut-help__panel"),h(w,"tabindex","-1"),h(a,"id","newPanel"),h(a,"class","shortcut-help"),a.hidden=!0,h(a,"aria-hidden","true"),h(a,"role","dialog"),h(a,"aria-modal","true"),h(a,"aria-labelledby","newPanelTitle"),Ue.p(ne,de)},m(ee,_e){Re(ee,a,_e),x(a,p),x(a,k),x(a,w),x(w,C),x(w,I),x(w,g),x(g,R),x(R,z),x(R,Z),x(R,H),x(R,re),x(R,se),Mt(se,o[0]),x(g,ke),x(g,O),x(O,F),x(F,W),W.checked=o[1],x(F,M),x(F,J),x(g,U),x(g,D),x(D,ae),x(D,Y),x(D,be),x(D,K),x(D,ue),x(ue,ne),ne.checked=ne.__value===o[2],x(ue,B),x(ue,Le),x(D,ve),x(D,Ce),x(Ce,de),de.checked=de.__value===o[2],x(Ce,_),x(Ce,E),x(g,we),x(g,q),x(q,Q),x(q,V),x(q,Ee),x(Ee,xe),x(g,He),me&&me.m(g,null),x(g,fe),pe&&pe.m(g,null),Fe||(We=[yt(se,"input",o[7]),yt(W,"change",o[8]),yt(ne,"change",o[9]),yt(de,"change",o[11]),yt(g,"submit",ao(o[6]))],Fe=!0)},p(ee,[_e]){_e&1&&Mt(se,ee[0]),_e&2&&(W.checked=ee[1]),_e&4&&(ne.checked=ne.__value===ee[2]),_e&4&&(de.checked=de.__value===ee[2]),_e&8&&uo(xe,ee[3]),ee[2]==="gpt"?me?me.p(ee,_e):(me=ci(),me.c(),me.m(g,fe)):me&&(me.d(1),me=null),ee[4]&&ee[5]?pe?pe.p(ee,_e):(pe=li(ee),pe.c(),pe.m(g,null)):pe&&(pe.d(1),pe=null)},i:dt,o:dt,d(ee){ee&&Oe(a),me&&me.d(),pe&&pe.d(),Ue.r(),Fe=!1,Kt(We)}}}const To="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function $o(o,a,p){let k="",w=!1,C="gpt",I="",g="",R=!1;const z=()=>{var M;return typeof navigator<"u"&&!!((M=navigator.clipboard)!=null&&M.writeText)};function Z(M){const J=M||"[DOMAIN]",U=w?"series":"map",ae=No.replaceAll("[DOMAIN NAME]",J).replaceAll("[DOMAIN]",J).replaceAll("[map|series]",U).split(`
`),Y=`Generate a **blockscape ${U}** for the domain of ${J}.`,be=ae.findIndex(ue=>ue.toLowerCase().includes("generate a **blockscape value")||ue.toLowerCase().includes("generate a blockscape [map|series]")||ue.toLowerCase().startsWith("generate a blockscape"));be>=0?ae[be]=Y:ae.unshift(Y);const K=w?`

User requested a series (return an array of models).`:"";return`${ae.join(`
`).trim()}${K}`}async function H(M){M.preventDefault();const J=k.trim();if(p(3,I=""),p(5,R=C!=="gpt"),!J){p(3,I="Add a domain to generate a prompt."),p(4,g="");return}if(C==="gpt"?p(4,g=`${w?"Create a series":"Create a map"} for ${J}`):(p(4,g=Z(J)),p(5,R=!0)),!z()){p(3,I="Clipboard access is unavailable. Copy the prompt below."),p(5,R=!0);return}try{await navigator.clipboard.writeText(g),p(3,I=C==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),C==="gpt"&&p(5,R=!1)}catch(D){console.warn("[Blockscape] clipboard write failed",D),p(3,I="Copy failed. Use the prompt below."),p(5,R=!0)}}const re=[[]];function se(){k=this.value,p(0,k)}function ke(){w=this.checked,p(1,w)}function O(){C=this.__value,p(2,C)}function F(){C=this.__value,p(2,C)}function W(){g=this.value,p(4,g)}return[k,w,C,I,g,R,H,se,ke,O,re,F,W]}class Bo extends Pn{constructor(a){super(),Un(this,a,$o,Lo,Bn,{})}}const{document:di}=so;function Oo(o){let a,p,k,w,C,I,g,R,z,Z,H,re,se,ke,O,F,W,M,J,U,D,ae,Y,be,K,ue,ne,B,Le,ve,Ce,de,_,E,we,q,Q,V,Ee,xe,He,fe,Ue,Fe=`<script id="seed" type="application/json">${o[1]}<\/script>`,We,me,pe,ee,_e,Me,Je,je,st,qe,Pe,bt,Et;return je=new Co({}),qe=new Bo({}),{c(){a=$("link"),p=X(),k=$("div"),w=$("header"),C=$("div"),I=$("div"),g=$("div"),R=$("div"),R.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',z=X(),Z=$("div"),H=$("div"),re=$("button"),se=$("span"),se.textContent="Toggle search and edit tools",ke=X(),O=$("span"),O.textContent="▾",F=X(),W=$("button"),W.textContent="New",M=X(),J=$("form"),J.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',U=X(),D=$("label"),D.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',ae=X(),Y=$("button"),Y.textContent="Help",be=X(),K=$("div"),ue=$("label"),ue.textContent="Search tiles",ne=X(),B=$("input"),Le=X(),ve=$("button"),ve.textContent="Edit",Ce=X(),de=$("button"),de.textContent="Share",q=X(),Q=$("div"),Q.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',V=X(),Ee=$("main"),Ee.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,xe=X(),He=$("footer"),He.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',fe=X(),Ue=new po(!1),We=X(),me=fi("svg"),pe=X(),ee=$("div"),_e=X(),Me=$("div"),Me.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',Je=X(),oi(je.$$.fragment),st=X(),oi(qe.$$.fragment),di.title="Blockscape — simple landscape-style tiles",h(a,"rel","icon"),h(a,"type","image/svg+xml"),h(a,"href","./favicon.svg"),h(R,"class","blockscape-brand"),h(se,"class","sr-only"),h(O,"class","blockscape-toolbar__toggle-icon"),h(O,"aria-hidden","true"),h(re,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),h(re,"type","button"),h(re,"aria-expanded",o[0]),h(re,"aria-controls","blockscapeHeaderExtras"),h(W,"id","newPanelButton"),h(W,"class","pf-v5-c-button pf-m-primary"),h(W,"type","button"),h(W,"title","Create something new"),h(J,"id","urlForm"),h(J,"class","blockscape-url-form"),h(J,"autocomplete","on"),J.noValidate=!0,h(D,"class","pf-v5-c-button pf-m-primary blockscape-file"),h(Y,"id","helpButton"),h(Y,"class","pf-v5-c-button pf-m-primary"),h(Y,"type","button"),h(Y,"title","Show keyboard shortcuts"),h(H,"class","blockscape-toolbar__primary"),h(ue,"class","sr-only"),h(ue,"for","search"),h(B,"id","search"),h(B,"class","pf-v5-c-form-control"),h(B,"type","text"),h(B,"placeholder","Search…"),h(ve,"id","openInEditor"),h(ve,"class","pf-v5-c-button pf-m-secondary"),h(ve,"type","button"),h(ve,"title","Open current JSON in the editor"),h(de,"id","shareModel"),h(de,"class","pf-v5-c-button pf-m-secondary"),h(de,"type","button"),h(de,"title","Copy a shareable URL for this model"),h(K,"id","blockscapeHeaderExtras"),h(K,"class","blockscape-toolbar__extras"),K.hidden=_=!o[0],h(K,"aria-hidden",E=!o[0]),h(Z,"class","blockscape-toolbar__controls"),h(Z,"data-expanded",we=o[0]?"true":"false"),h(Q,"class","blockscape-legend"),h(Q,"role","presentation"),h(g,"class","blockscape-toolbar"),h(I,"class","pf-v5-c-masthead__content"),h(C,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),h(w,"class","pf-v5-c-page__header"),h(Ee,"class","pf-v5-c-page__main"),h(He,"class","pf-v5-c-page__footer blockscape-footer"),h(k,"class","pf-v5-c-page"),Ue.a=We,h(me,"id","overlay"),h(me,"class","svg-layer"),h(ee,"id","tabTooltip"),h(ee,"class","blockscape-tab-tooltip"),ee.hidden=!0,h(ee,"aria-hidden","true"),h(Me,"id","itemPreview"),h(Me,"class","item-preview"),Me.hidden=!0,h(Me,"aria-hidden","true")},m(ce,Ie){x(di.head,a),Re(ce,p,Ie),Re(ce,k,Ie),x(k,w),x(w,C),x(C,I),x(I,g),x(g,R),x(g,z),x(g,Z),x(Z,H),x(H,re),x(re,se),x(re,ke),x(re,O),x(H,F),x(H,W),x(H,M),x(H,J),x(H,U),x(H,D),x(H,ae),x(H,Y),x(Z,be),x(Z,K),x(K,ue),x(K,ne),x(K,B),x(K,Le),x(K,ve),x(K,Ce),x(K,de),x(g,q),x(g,Q),x(k,V),x(k,Ee),x(k,xe),x(k,He),Re(ce,fe,Ie),Ue.m(Fe,ce,Ie),Re(ce,We,Ie),Re(ce,me,Ie),Re(ce,pe,Ie),Re(ce,ee,Ie),Re(ce,_e,Ie),Re(ce,Me,Ie),Re(ce,Je,Ie),Tn(je,ce,Ie),Re(ce,st,Ie),Tn(qe,ce,Ie),Pe=!0,bt||(Et=yt(re,"click",o[2]),bt=!0)},p(ce,[Ie]){(!Pe||Ie&1)&&h(re,"aria-expanded",ce[0]),(!Pe||Ie&1&&_!==(_=!ce[0]))&&(K.hidden=_),(!Pe||Ie&1&&E!==(E=!ce[0]))&&h(K,"aria-hidden",E),(!Pe||Ie&1&&we!==(we=ce[0]?"true":"false"))&&h(Z,"data-expanded",we)},i(ce){Pe||(Ln(je.$$.fragment,ce),Ln(qe.$$.fragment,ce),Pe=!0)},o(ce){ii(je.$$.fragment,ce),ii(qe.$$.fragment,ce),Pe=!1},d(ce){ce&&(Oe(p),Oe(k),Oe(fe),Ue.d(),Oe(We),Oe(me),Oe(pe),Oe(ee),Oe(_e),Oe(Me),Oe(Je),Oe(st)),Oe(a),$n(je,ce),$n(qe,ce),bt=!1,Et()}}}function Uo(o,a,p){const k=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let w=!1;const C=()=>{if(p(0,w=!w),!w){const I=document.getElementById("search");I&&I.value&&(I.value="",I.dispatchEvent(new Event("input",{bubbles:!0})))}};return mo(()=>{Ao()}),[w,k,C]}class Po extends Pn{constructor(a){super(),Un(this,a,Uo,Oo,Bn,{})}}const Mo=document.getElementById("root");new Po({target:Mo});
