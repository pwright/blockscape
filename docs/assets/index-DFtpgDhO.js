var _r=Object.defineProperty;var Sr=(r,l,p)=>l in r?_r(r,l,{enumerable:!0,configurable:!0,writable:!0,value:p}):r[l]=p;var At=(r,l,p)=>Sr(r,typeof l!="symbol"?l+"":l,p);(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))_(w);new MutationObserver(w=>{for(const B of w)if(B.type==="childList")for(const C of B.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&_(C)}).observe(document,{childList:!0,subtree:!0});function p(w){const B={};return w.integrity&&(B.integrity=w.integrity),w.referrerPolicy&&(B.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?B.credentials="include":w.crossOrigin==="anonymous"?B.credentials="omit":B.credentials="same-origin",B}function _(w){if(w.ep)return;w.ep=!0;const B=p(w);fetch(w.href,B)}})();function _t(){}function co(r){return r()}function Xi(){return Object.create(null)}function wn(r){r.forEach(co)}function lo(r){return typeof r=="function"}function fi(r,l){return r!=r?l==l:r!==l||r&&typeof r=="object"||typeof r=="function"}function xr(r){return Object.keys(r).length===0}const Ir=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function x(r,l){r.appendChild(l)}function Ze(r,l,p){r.insertBefore(l,p||null)}function Fe(r){r.parentNode&&r.parentNode.removeChild(r)}function O(r){return document.createElement(r)}function uo(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function mi(r){return document.createTextNode(r)}function ee(){return mi(" ")}function Ft(r,l,p,_){return r.addEventListener(l,p,_),()=>r.removeEventListener(l,p,_)}function Cr(r){return function(l){return l.preventDefault(),r.call(this,l)}}function b(r,l,p){p==null?r.removeAttribute(l):r.getAttribute(l)!==p&&r.setAttribute(l,p)}function Ar(r){let l;return{p(...p){l=p,l.forEach(_=>r.push(_))},r(){l.forEach(p=>r.splice(r.indexOf(p),1))}}}function Nr(r){return Array.from(r.childNodes)}function Lr(r,l){l=""+l,r.data!==l&&(r.data=l)}function rn(r,l){r.value=l??""}class Tr{constructor(l=!1){At(this,"is_svg",!1);At(this,"e");At(this,"n");At(this,"t");At(this,"a");this.is_svg=l,this.e=this.n=null}c(l){this.h(l)}m(l,p,_=null){this.e||(this.is_svg?this.e=uo(p.nodeName):this.e=O(p.nodeType===11?"TEMPLATE":p.nodeName),this.t=p.tagName!=="TEMPLATE"?p:p.content,this.c(l)),this.i(_)}h(l){this.e.innerHTML=l,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(l){for(let p=0;p<this.n.length;p+=1)Ze(this.t,this.n[p],l)}p(l){this.d(),this.h(l),this.i(this.a)}d(){this.n.forEach(Fe)}}let vn;function gn(r){vn=r}function $r(){if(!vn)throw new Error("Function called outside component initialization");return vn}function Br(r){$r().$$.on_mount.push(r)}const on=[],Zi=[];let sn=[];const Qi=[],Mr=Promise.resolve();let ci=!1;function Or(){ci||(ci=!0,Mr.then(po))}function li(r){sn.push(r)}const oi=new Set;let tn=0;function po(){if(tn!==0)return;const r=vn;do{try{for(;tn<on.length;){const l=on[tn];tn++,gn(l),Vr(l.$$)}}catch(l){throw on.length=0,tn=0,l}for(gn(null),on.length=0,tn=0;Zi.length;)Zi.pop()();for(let l=0;l<sn.length;l+=1){const p=sn[l];oi.has(p)||(oi.add(p),p())}sn.length=0}while(on.length);for(;Qi.length;)Qi.pop()();ci=!1,oi.clear(),gn(r)}function Vr(r){if(r.fragment!==null){r.update(),wn(r.before_update);const l=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,l),r.after_update.forEach(li)}}function Ur(r){const l=[],p=[];sn.forEach(_=>r.indexOf(_)===-1?l.push(_):p.push(_)),p.forEach(_=>_()),sn=l}const Un=new Set;let Pr;function di(r,l){r&&r.i&&(Un.delete(r),r.i(l))}function eo(r,l,p,_){if(r&&r.o){if(Un.has(r))return;Un.add(r),Pr.c.push(()=>{Un.delete(r)}),r.o(l)}}function to(r){r&&r.c()}function ui(r,l,p){const{fragment:_,after_update:w}=r.$$;_&&_.m(l,p),li(()=>{const B=r.$$.on_mount.map(co).filter(lo);r.$$.on_destroy?r.$$.on_destroy.push(...B):wn(B),r.$$.on_mount=[]}),w.forEach(li)}function pi(r,l){const p=r.$$;p.fragment!==null&&(Ur(p.after_update),wn(p.on_destroy),p.fragment&&p.fragment.d(l),p.on_destroy=p.fragment=null,p.ctx=[])}function Rr(r,l){r.$$.dirty[0]===-1&&(on.push(r),Or(),r.$$.dirty.fill(0)),r.$$.dirty[l/31|0]|=1<<l%31}function hi(r,l,p,_,w,B,C=null,v=[-1]){const H=vn;gn(r);const G=r.$$={fragment:null,ctx:[],props:B,update:_t,not_equal:w,bound:Xi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(H?H.$$.context:[])),callbacks:Xi(),dirty:v,skip_bound:!1,root:l.target||H.$$.root};C&&C(G.root);let te=!1;if(G.ctx=p?p(r,l.props||{},(D,ce,...de)=>{const Ie=de.length?de[0]:ce;return G.ctx&&w(G.ctx[D],G.ctx[D]=Ie)&&(!G.skip_bound&&G.bound[D]&&G.bound[D](Ie),te&&Rr(r,D)),ce}):[],G.update(),te=!0,wn(G.before_update),G.fragment=_?_(G.ctx):!1,l.target){if(l.hydrate){const D=Nr(l.target);G.fragment&&G.fragment.l(D),D.forEach(Fe)}else G.fragment&&G.fragment.c();l.intro&&di(r.$$.fragment),ui(r,l.target,l.anchor),po()}gn(H)}class gi{constructor(){At(this,"$$");At(this,"$$set")}$destroy(){pi(this,1),this.$destroy=_t}$on(l,p){if(!lo(p))return _t;const _=this.$$.callbacks[l]||(this.$$.callbacks[l]=[]);return _.push(p),()=>{const w=_.indexOf(p);w!==-1&&_.splice(w,1)}}$set(l){this.$$set&&!xr(l)&&(this.$$.skip_bound=!0,this.$$set(l),this.$$.skip_bound=!1)}}const Hr="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Hr);const no="blockscape:apicurioConfig",ri="http://localhost:8080/apis/registry/v3",On="bs",io="-series",si=!1,ai=!1;function Dr({models:r,getActiveIndex:l,setActive:p,ensureModelMetadata:_,ensureSeriesId:w,getModelId:B,getSeriesId:C,getModelTitle:v,computeJsonFingerprint:H,uid:G}){let te=null,D=null,ce=null,de=null,Ie=null,V=null,F=null,K=null,P=null,j=null;const ke=new Set,N={baseUrl:ri,groupId:On,authToken:"",enabled:si,useSemver:ai},ie=new Map,X=new Map;function ue(s){return(s||"").toString().trim().replace(/\/+$/,"")}function oe(s){return`${(s||"").toString().trim()||On}${io}`}function ge(){return!!(N.baseUrl&&N.groupId)}function W(){return N.enabled!==!1}function Ne(){ke.forEach(s=>{try{s(W())}catch(f){console.warn("[Blockscape] failed to run Apicurio enabled listener",f)}})}function Ke(s){return typeof s=="function"&&ke.add(s),()=>ke.delete(s)}function we(){ce&&(ce.value=N.baseUrl||""),de&&(de.value=N.groupId||""),Ie&&(Ie.value=N.authToken||""),V&&(V.checked=W()),F&&(F.checked=!!N.useSemver)}function L(s="",f="muted"){K&&(K.textContent=s||"",K.classList.remove("is-error","is-success"),f==="error"?K.classList.add("is-error"):f==="success"&&K.classList.add("is-success"))}function pe(s){if(!j||(j.innerHTML="",!s))return;const f=document.createElement("p");f.className="apicurio-hint",f.textContent=s,j.appendChild(f)}function Je(s){ie.clear(),X.clear(),pe(s)}function Oe(){const s=l(),f=W(),k=ge(),E=s>=0?r[s]:null,h=!!(E!=null&&E.apicurioVersions&&E.apicurioVersions.length>1);if(te){const A=te.dataset.loading==="true",U=f&&k&&s>=0&&!!Ce(r[s]);te.disabled=!f||A||!U,f?A||(te.textContent="Push to Apicurio"):te.textContent="Enable Apicurio to push"}if(P){const A=P.dataset.loading==="true",U=f&&k&&h&&!!Ce(E);P.disabled=!U||A,P.hidden=!h,f?A||(P.textContent="Push series"):P.textContent="Enable Apicurio to push series"}if(D){const A=D.dataset.loading==="true",U=f&&k;D.disabled=!U||A,A||(f?k?D.textContent="List artifacts":D.textContent="Enter details to list":D.textContent="Enable Apicurio to list")}}function S(){we(),W()?ge()?(L("Apicurio push is ready when a model is selected.","muted"),ie.size||pe("Click “List artifacts” to browse the current group.")):(L("Enter Apicurio connection details to enable push.","muted"),Je("Enter registry details to browse artifacts.")):(L("Apicurio integration is off. Enable it to allow pushes.","muted"),Je("Apicurio integration is disabled.")),Oe()}function y(){if(window!=null&&window.localStorage)try{localStorage.setItem(no,JSON.stringify(N))}catch(s){console.warn("[Blockscape] unable to persist Apicurio settings",s)}}function fe(){let s={};if(window!=null&&window.localStorage)try{const A=localStorage.getItem(no);if(A){const U=JSON.parse(A);U&&typeof U=="object"&&(s=U)}}catch(A){console.warn("[Blockscape] failed to restore Apicurio settings",A)}const f=ue(s.baseUrl??ri),k=(s.groupId??On).toString().trim();let E=si,h=ai;typeof s.enabled=="boolean"?E=s.enabled:typeof s.enabled=="string"&&(E=s.enabled==="true"),typeof s.useSemver=="boolean"?h=s.useSemver:typeof s.useSemver=="string"&&(h=s.useSemver==="true"),N.baseUrl=f||ri,N.groupId=k||On,N.authToken=(s.authToken??"").toString().trim(),N.enabled=E,N.useSemver=h,S(),Ne()}function J(){const s={Accept:"application/json"},f=(N.authToken||"").trim();return f&&(s.Authorization=/\s/.test(f)?f:`Bearer ${f}`),s}function Z(s,f,{title:k,description:E,version:h}={}){const A={artifactId:s,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:f},metadata:{properties:{}}}};h&&(A.firstVersion.version=h),k&&(A.name=k),E&&(A.description=E);try{const U=JSON.parse(f),$=U==null?void 0:U.seriesId;$&&typeof $=="string"&&(A.firstVersion.metadata.properties.seriesId=$)}catch{}return A}function M(s,{version:f}={}){const k={content:{contentType:"application/json",content:s},metadata:{properties:{}}};try{const E=JSON.parse(s),h=E==null?void 0:E.seriesId;h&&typeof h=="string"&&(k.metadata.properties.seriesId=h)}catch{}return f&&(k.version=f),k}function Le(s){if(s==null)return null;const f=String(s).trim();if(!f)return null;const k=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(f);if(k)return{major:Number(k[1]),minor:Number(k[2]),patch:Number(k[3])};const E=/^v?(\d+)$/.exec(f);return E?{major:Number(E[1]),minor:0,patch:0}:null}function je(s){return`${s.major}.${s.minor}.${s.patch}`}function Ve(s,f){return!s&&!f?0:s?f?s.major!==f.major?s.major-f.major:s.minor!==f.minor?s.minor-f.minor:s.patch-f.patch:1:-1}function Ue(s=[]){let f=null;if(s.forEach(E=>{const h=Le((E==null?void 0:E.version)??E);h&&(!f||Ve(h,f)>0)&&(f=h)}),!f)return"1.0.0";const k={...f,patch:f.patch+1};return je(k)}function Ce(s,{seriesName:f,fallbackTitle:k}={}){var A;if(!s)return null;const E=f||s.title||s.apicurioArtifactName||v(s),h=k||E;if(typeof w=="function"&&(s.isSeries||((A=s.apicurioVersions)==null?void 0:A.length)>1)&&w(s,{seriesName:E,fallbackTitle:h}),typeof C=="function"){const U=C(s,{seriesName:E,fallbackTitle:h});if(U)return U}return B(s)}function Ee(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.artifacts)?s.artifacts:Array.isArray(s==null?void 0:s.items)?s.items:Array.isArray(s==null?void 0:s.results)?s.results:[]}function he(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.versions)?s.versions:Array.isArray(s==null?void 0:s.items)?s.items:[]}function be(s=[]){if(!Array.isArray(s)||!s.length)return null;const f=[...s].filter(Boolean);return f.sort((k,E)=>{const h=k!=null&&k.createdOn?new Date(k.createdOn).getTime():0,A=E!=null&&E.createdOn?new Date(E.createdOn).getTime():0;if(h!==A)return A-h;const U=Number(k==null?void 0:k.version),$=Number(E==null?void 0:E.version),ne=Number.isFinite(U),z=Number.isFinite($);if(ne&&z&&U!==$)return $-U;const Q=String((k==null?void 0:k.version)??"");return String((E==null?void 0:E.version)??"").localeCompare(Q,void 0,{numeric:!0})}),f[0]||null}function He(s){if(!s)return s;let f=s;if(!Array.isArray(s==null?void 0:s.categories)){const E=s==null?void 0:s.content;if(typeof E=="string")try{f=JSON.parse(E)}catch(h){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",h)}else E&&typeof E=="object"&&(f=E)}return f}async function st(s,f,k){const E=encodeURIComponent(f),h=encodeURIComponent(k),A=`${s}/groups/${E}/artifacts/${h}`,U=J();U.Accept="application/json";const $=await fetch(A,{method:"GET",headers:U});if(!$.ok){let ne=$.statusText||"Unknown error";try{const z=await $.text();z&&(ne=z.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${$.status}): ${ne}`)}return $.json()}async function et(s,f,k){const E=encodeURIComponent(f),h=encodeURIComponent(k),A=`${s}/groups/${E}/artifacts/${h}/versions?limit=50&order=desc`,U=J();U.Accept="application/json";const $=await fetch(A,{method:"GET",headers:U});if(!$.ok){let z=$.statusText||"Unknown error";try{const Q=await $.text();Q&&(z=Q.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${$.status}): ${z}`)}const ne=await $.json();return he(ne).filter(z=>z&&z.version!=null)}async function qe(s,f,k,E="latest"){const h=encodeURIComponent(f),A=encodeURIComponent(k),U=encodeURIComponent(E||"latest"),$=`${s}/groups/${h}/artifacts/${A}/versions/${U}/content`,ne=J();ne.Accept="application/json, application/*+json, */*;q=0.8";const z=await fetch($,{method:"GET",headers:ne});if(!z.ok){let _e=z.statusText||"Unknown error";try{const le=await z.text();le&&(_e=le.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${z.status}): ${_e}`)}const Q=await z.text();let se=null;try{se=JSON.parse(Q)}catch{throw new Error("Artifact content is not valid JSON.")}return He(se)}async function Te(s,f,k,E="latest"){const h=await qe(s,f,k,E);return{data:h,fingerprint:H(h)}}async function Ye(s,f,k){try{const h=await et(s,f,k);if(h!=null&&h.length){X.set(k,h);const A=be(h);if((A==null?void 0:A.version)!=null)return A.version}}catch(h){console.warn("[Blockscape] compare-version: unable to fetch versions list",h)}try{const h=await st(s,f,k);if((h==null?void 0:h.version)!=null)return h.version}catch(h){console.warn("[Blockscape] compare-version: unable to fetch metadata",h)}const E=X.get(k);if(E&&E.length){const h=be(E);if((h==null?void 0:h.version)!=null)return h.version}return"latest"}async function at(s,f,k,E){if(!N.useSemver)return null;if(!E)return"1.0.0";try{const h=await et(s,f,k);return Ue(h)}catch(h){throw new Error(`Unable to compute next semantic version: ${h.message}`)}}function re(s=document){te=s.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),P=s.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),D=s.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),ce=s.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),de=s.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),Ie=s.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),V=s.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),F=s.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),K=s.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),j=s.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function ye(){N.baseUrl=ue((ce==null?void 0:ce.value)??N.baseUrl),N.groupId=((de==null?void 0:de.value)??"").trim(),N.authToken=((Ie==null?void 0:Ie.value)??"").trim(),y(),S()}function Nt(s){N.enabled=s!==!1,y(),S(),Ne()}function Jt(){Nt(V?V.checked:si)}function Lt(){N.useSemver=F?F.checked:ai,y(),S()}function an(){[ce,de,Ie].forEach(s=>{s&&s.addEventListener("input",ye)}),te&&te.addEventListener("click",()=>{Mt()}),P&&P.addEventListener("click",()=>{_n()}),V&&V.addEventListener("change",Jt),F&&F.addEventListener("change",Lt),D&&D.addEventListener("click",Ot),j&&j.addEventListener("click",s=>{const f=s.target.closest("[data-artifact-version]");if(f){s.stopPropagation();const h=f.dataset.artifactId,A=f.dataset.artifactVersion;h&&A&&Sn(h,A);return}const k=s.target.closest("[data-artifact-load-all]");if(k){s.stopPropagation(),k.dataset.artifactId&&xn();return}const E=s.target.closest("[data-artifact-trigger]");if(E){const h=E.dataset.artifactId;if(!h)return;Bt(h)}})}function Tt(){const s=document.createElement("div");return s.className="blockscape-registry-panel",s.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,s}function $t(s){if(!s)return;s.innerHTML="";const f=Tt();s.appendChild(f),re(s),an(),S()}function cn(s){if(!j)return;if(j.innerHTML="",!s.length){pe("No artifacts found in this group.");return}const f=h=>{const A=document.createElement("section");A.className="apicurio-artifact-section";const U=document.createElement("h3");U.textContent=h,A.appendChild(U);const $=document.createElement("ul");return $.className="apicurio-artifact-list",A.appendChild($),{section:A,list:$}},k=f("Series artifacts"),E=f("Artifacts");s.forEach(h=>{if(!(h!=null&&h.artifactId))return;const U=h._groupId&&h._groupId.endsWith(io)?k.list:E.list,$=document.createElement("li"),ne=document.createElement("button");ne.type="button",ne.className="apicurio-artifact",ne.dataset.artifactId=h.artifactId,ne.dataset.artifactTrigger="toggle";const z=document.createElement("span");z.className="apicurio-artifact-title",z.textContent=h.artifactId,ne.appendChild(z);const Q=[];if(h.name&&Q.push(h.name),h.version!=null&&Q.push(`v${h.version}`),h.type&&Q.push(h.type),h._groupId&&Q.push(h._groupId),Q.length){const le=document.createElement("span");le.className="apicurio-artifact-meta",le.textContent=Q.join(" • "),ne.appendChild(le)}if(h.description){const le=document.createElement("span");le.className="apicurio-artifact-meta",le.textContent=h.description,ne.appendChild(le)}$.appendChild(ne);const se=document.createElement("div");se.className="apicurio-version-list",se.dataset.versionPanel=h.artifactId,se.hidden=!0;const _e=document.createElement("p");_e.className="apicurio-hint",_e.textContent="Click to load the latest or open versions.",se.appendChild(_e),$.appendChild(se),U.appendChild($)}),k.list.children.length&&j.appendChild(k.section),E.list.children.length&&j.appendChild(E.section)}function yn(s){return j?j.querySelector(`[data-version-panel="${s}"]`):null}function jt(s,f){if(!s||(s.innerHTML="",!f))return;const k=document.createElement("p");k.className="apicurio-hint",k.textContent=f,s.appendChild(k)}function En(s,f){const k=yn(s);if(k){if(k.innerHTML="",!f.length){jt(k,"No versions found for this artifact.");return}f.forEach(E=>{const h=document.createElement("button");h.type="button",h.className="apicurio-version-button",h.dataset.artifactId=s,h.dataset.artifactVersion=E.version;const A=[`Version ${E.version}`];if(E.createdOn){const U=new Date(E.createdOn);isNaN(U)||A.push(U.toISOString().slice(0,10))}h.textContent=A.join(" — "),k.appendChild(h)})}}async function Bt(s){const f=yn(s);if(!f)return;if(f.dataset.open==="true"){f.hidden=!0,f.dataset.open="false";return}if(f.hidden=!1,f.dataset.open="true",f.dataset.loaded!=="true"){if(!ge()){jt(f,"Enter registry details first.");return}jt(f,"Loading versions…");try{const E=ue(N.baseUrl),h=ie.get(s),A=N.groupId.trim(),U=(h==null?void 0:h._groupId)||A,$=await et(E,U,s);X.set(s,$),f.dataset.loaded="true",En(s,$)}catch(E){console.error("[Blockscape] failed to load versions",E),jt(f,`Unable to fetch versions: ${E.message}`)}}}function kn(s,f){var E;const k=r.findIndex(h=>h.apicurioArtifactId===s);if(k!==-1){const h=r[k].id;r[k]={...f,id:h||f.id},((E=r[k].apicurioVersions)==null?void 0:E.length)>1&&(r[k].isSeries=!0),p(k)}else r.push(f),p(r.length-1)}async function ln(s,f,k,E){const h=encodeURIComponent(f),A=encodeURIComponent(k),U=`${s}/groups/${h}/artifacts/${A}`;try{const $=await fetch(U,{method:"GET",headers:E});if($.status===404)return!1;if($.ok)return!0;throw $.status===401||$.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${$.status} while checking the artifact.`)}catch($){throw $ instanceof TypeError?new Error("Network error while contacting Apicurio registry."):$}}async function Mt(){var U;if(!te||te.dataset.loading==="true")return;if(!W()){L("Apicurio integration is off. Enable it first.","error");return}if(!ge()){L("Enter the registry base URL and group ID before pushing.","error");return}const s=l();if(s<0||!r[s]){L("No active model to push.","error");return}const f=Ce(r[s],{fallbackTitle:v(r[s])});if(!f){L("Active model needs an id before pushing.","error");return}const k=ue(N.baseUrl),E=N.groupId.trim(),h=JSON.stringify(r[s].data,null,2),A=J();te.dataset.loading="true",te.textContent="Pushing…",te.disabled=!0,L("Pushing to Apicurio…","muted");try{const $=await ln(k,E,f,A),ne=H(r[s].data);if($)try{const Se=await Ye(k,E,f),{data:Ge,fingerprint:We}=await Te(k,E,f,Se);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",Se),console.log("local fingerprint",ne),console.log("registry fingerprint",We),console.log("local payload",r[s].data),console.log("registry payload",Ge),console.groupEnd(),ne&&We&&ne===We){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){L("Push cancelled (content matches the latest registry version).","muted");return}L("Pushing identical content by user choice.","muted")}else We?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):L("Unable to compare with registry content (skipping confirmation).","muted")}catch(Se){console.warn("[Blockscape] unable to compare registry content before push",Se),L("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const z=N.useSemver?await at(k,E,f,$):null;if(N.useSemver&&!z)throw new Error("Semantic versioning is enabled but no version could be computed.");const Q=encodeURIComponent(E),se=encodeURIComponent(f),_e=$?`${k}/groups/${Q}/artifacts/${se}/versions`:`${k}/groups/${Q}/artifacts`,le={...A,"Content-Type":"application/json"};z&&(le["X-Registry-Version"]=z,L(`Pushing to Apicurio as version ${z}…`,"muted"));const ct=$?M(h,{version:z}):Z(f,h,{title:v(r[s]),description:(U=r[s].data)==null?void 0:U.abstract,version:z}),lt=await fetch(_e,{method:"POST",headers:le,body:JSON.stringify(ct)});if(!lt.ok){let Se=lt.statusText||"Unknown error";try{const Ge=await lt.text();Ge&&(Se=Ge.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${lt.status}): ${Se}`)}let Pe=null;try{Pe=await lt.json()}catch{Pe=null}const me=(Pe==null?void 0:Pe.version)||(Pe==null?void 0:Pe.globalId)||"",Be=$?"Updated":"Created",pt=me?` (version ${me})`:"";L(`${Be} ${f}${pt}`,"success")}catch($){console.error("[Blockscape] Apicurio push failed",$),L(`Apicurio push failed: ${$.message}`,"error")}finally{te.dataset.loading="false",Oe()}}async function _n(){var z,Q;if(!P||P.dataset.loading==="true")return;if(!W()){L("Apicurio integration is off. Enable it first.","error");return}if(!ge()){L("Enter the registry base URL and group ID before pushing.","error");return}const s=l(),f=s>=0?r[s]:null;if(!f||!f.apicurioVersions||f.apicurioVersions.length<2){L("Series push requires a model with multiple versions.","error");return}const k=Ce(f,{seriesName:f.title||f.apicurioArtifactName||v(f)});if(!k){L("Active series needs an id before pushing.","error");return}typeof w=="function"&&w(f,{seriesName:f.title||f.apicurioArtifactName||v(f)});const E=ue(N.baseUrl),h=N.groupId.trim(),A=f.apicurioVersions.map(se=>se.data),U=JSON.stringify(A,null,2),$=J(),ne=oe(h);P.dataset.loading="true",P.textContent="Pushing…",P.disabled=!0,L("Pushing series to Apicurio…","muted");try{const se=await ln(E,ne,k,$),_e=H(A);if(se)try{const tt=await Ye(E,ne,k),{data:qt,fingerprint:dt}=await Te(E,ne,k,tt);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",tt),console.log("local fingerprint",_e),console.log("registry fingerprint",dt),console.log("local payload (series)",A),console.log("registry payload",qt),console.groupEnd(),_e&&dt&&_e===dt){if(!window.confirm("The current registry version matches this series. Push anyway?")){L("Series push cancelled (content matches latest).","muted");return}L("Pushing identical series by user choice.","muted")}else dt?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):L("Unable to compare with registry content (skipping confirmation).","muted")}catch(tt){console.warn("[Blockscape] unable to compare registry content before series push",tt),L("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const le=N.useSemver?await at(E,ne,k,se):null;if(N.useSemver&&!le)throw new Error("Semantic versioning is enabled but no version could be computed.");const ct=encodeURIComponent(ne),lt=encodeURIComponent(k),Pe=se?`${E}/groups/${ct}/artifacts/${lt}/versions`:`${E}/groups/${ct}/artifacts`,me={...$,"Content-Type":"application/json"};le&&(me["X-Registry-Version"]=le,L(`Pushing series to Apicurio as version ${le}…`,"muted"));const Be=se?M(U,{version:le}):Z(k,U,{title:f.apicurioArtifactName||((z=f.data)==null?void 0:z.title)||k,description:(Q=f.data)==null?void 0:Q.abstract,version:le}),pt=await fetch(Pe,{method:"POST",headers:me,body:JSON.stringify(Be)});if(!pt.ok){let tt=pt.statusText||"Unknown error";try{const qt=await pt.text();qt&&(tt=qt.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${pt.status}): ${tt}`)}let Se=null;try{Se=await pt.json()}catch{Se=null}const Ge=(Se==null?void 0:Se.version)||(Se==null?void 0:Se.globalId)||"",We=se?"Updated":"Created",wt=Ge?` (version ${Ge})`:"";L(`${We} ${k} series${wt}`,"success")}catch(se){console.error("[Blockscape] Apicurio series push failed",se),L(`Apicurio series push failed: ${se.message}`,"error")}finally{P.dataset.loading="false",Oe()}}async function Ot(){if(!D||D.dataset.loading==="true")return;if(!W()){L("Enable Apicurio integration to list artifacts.","error");return}if(!ge()){L("Enter registry base URL and group ID before listing.","error");return}const s=ue(N.baseUrl),f=N.groupId.trim(),k=oe(f),E=[{groupId:f,label:"base"},{groupId:k,label:"series"}];D.dataset.loading="true",D.textContent="Listing…",D.disabled=!0,L("Listing artifacts…","muted"),pe("Contacting registry…");try{const h=J();h.Accept="application/json";const A=[];for(const $ of E){const ne=encodeURIComponent($.groupId),z=`${s}/groups/${ne}/artifacts?limit=50&offset=0`,Q=await fetch(z,{method:"GET",headers:h});if(!Q.ok){let le=Q.statusText||"Unknown error";try{const ct=await Q.text();ct&&(le=ct.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${$.groupId} (${Q.status}): ${le}`);continue}const se=await Q.json(),_e=Ee(se).filter(le=>le&&le.artifactId);_e.forEach(le=>{le&&(le._groupId=$.groupId)}),A.push(..._e)}ie.clear(),X.clear(),A.forEach($=>{$!=null&&$.artifactId&&ie.set($.artifactId,$)}),cn(A);const U=A.length;L(U?`Found ${U} artifact${U===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",U?"success":"muted")}catch(h){console.error("[Blockscape] failed to list artifacts",h),Je("Unable to list artifacts."),L(`Listing failed: ${h.message}`,"error")}finally{D.dataset.loading="false",Oe()}}async function Sn(s,f=null){var se,_e,le,ct,lt,Pe;if(!s)return;if(!W()){L("Enable Apicurio integration to load artifacts.","error");return}if(!ge()){L("Enter registry connection details before loading artifacts.","error");return}const k=ue(N.baseUrl),E=N.groupId.trim(),h=s&&((se=ie.get(s))==null?void 0:se._groupId)||E;let A=ie.get(s);const U=async()=>{try{const me=await st(k,h,s);return me!=null&&me.artifactId&&ie.set(s,me),me}catch(me){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",me),me}};if(!A)try{A=await U()}catch(me){L(`Failed to fetch artifact metadata: ${me.message}`,"error");return}const $=X.get(s)||[];let ne="latest",z="latest";if(f)ne=f,z=f;else{if(!A||A.version==null)try{A=await U()}catch(me){L(`Failed to fetch artifact metadata: ${me.message}`,"error");return}ne=(A==null?void 0:A.version)||"latest",z=(A==null?void 0:A.version)||"latest"}const Q=$.find(me=>String(me.version)===String(ne));(Q==null?void 0:Q.version)!=null&&(z=Q.version),L(`Loading artifact ${s}…`,"muted");try{const me=await qe(k,h,s,ne),Be=ie.get(s)||A||{},pt=Array.isArray(me);let Se=null;if(pt){const Ge=me.map((wt,tt)=>(_(wt,{titleHint:Be.name||s,idHint:s}),{version:String(tt+1),data:wt,createdOn:(Q==null?void 0:Q.createdOn)||Be.createdOn}));Se={id:G(),title:((le=(_e=Ge[0])==null?void 0:_e.data)==null?void 0:le.title)||Be.name||s,data:(ct=Ge[0])==null?void 0:ct.data,apicurioArtifactId:s,apicurioArtifactName:Be.name||"",apicurioVersions:Ge,apicurioActiveVersionIndex:0,isSeries:!0};const We=((lt=Be==null?void 0:Be.properties)==null?void 0:lt.seriesId)||s;typeof w=="function"&&w(Se,{seriesName:We,fallbackTitle:We}),L(`Loaded series artifact ${s}.`,"success")}else{_(me,{titleHint:Be.name||s,idHint:s});const Ge={version:z,data:me,createdOn:(Q==null?void 0:Q.createdOn)||Be.createdOn};Se={id:G(),title:me.title||Be.name||s,data:me,apicurioArtifactId:s,apicurioArtifactName:Be.name||"",apicurioVersions:[Ge],apicurioActiveVersionIndex:0};const We=(Pe=Be==null?void 0:Be.properties)==null?void 0:Pe.seriesId;We&&typeof w=="function"&&w(Se,{seriesName:We,fallbackTitle:We});const wt=z?` (version ${z})`:"";L(`Loaded artifact ${s}${wt}.`,"success")}kn(s,Se)}catch(me){console.error("[Blockscape] failed to load artifact",me),L(`Failed to load artifact: ${me.message}`,"error")}}async function xn(s){}return{hydrateConfig:fe,mount:$t,updateAvailability:Oe,isEnabled:W,setEnabled:Nt,onEnabledChange:Ke}}function nn(r,l){if(typeof r!="function")throw new Error(`[itemEditor] expected ${l} to be a function`)}function Fr(r,{excludeId:l}={}){if(!r)return[];const p=r.split(/[\s,]+/).map(w=>w.trim()).filter(Boolean),_=[];return p.forEach(w=>{l&&w===l||_.includes(w)||_.push(w)}),_}function Jr(r,l,p){if(!l||!p||l===p)return;((r==null?void 0:r.categories)||[]).forEach(w=>{(w.items||[]).forEach(B=>{Array.isArray(B.deps)&&(B.deps=B.deps.map(C=>C===l?p:C))})}),Array.isArray(r==null?void 0:r.links)&&r.links.forEach(w=>{w.from===l&&(w.from=p),w.to===l&&(w.to=p)})}function jr({findItemAndCategoryById:r,collectAllItemIds:l,updateItemReferences:p,loadActiveIntoEditor:_,rebuildFromActive:w,select:B,onSelectionRenamed:C}={}){nn(r,"findItemAndCategoryById"),nn(l,"collectAllItemIds"),nn(p,"updateItemReferences"),nn(_,"loadActiveIntoEditor"),nn(w,"rebuildFromActive"),nn(B,"select");const v={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function H(V){if(v.fields.errorEl){if(!V){v.fields.errorEl.hidden=!0,v.fields.errorEl.textContent="";return}v.fields.errorEl.hidden=!1,v.fields.errorEl.textContent=V}}function G(){v.wrapper&&(v.wrapper.hidden=!0,v.wrapper.setAttribute("aria-hidden","true"),H(""),v.categoryId=null,v.itemId=null,v.modelData=null,document.body.classList.remove("item-editor-open"))}function te(){v.wrapper&&(v.wrapper.hidden=!1,v.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var V,F;(V=v.fields.nameInput)==null||V.focus(),(F=v.fields.nameInput)==null||F.select()}))}function D(V){var ue;if(!v.modelData||!v.categoryId||!v.itemId)throw new Error("No item loaded.");const K=(((ue=v.modelData)==null?void 0:ue.categories)||[]).find(oe=>oe.id===v.categoryId);if(!K)throw new Error("Category not found.");K.items=K.items||[];const P=K.items.find(oe=>oe.id===v.itemId);if(!P)throw new Error("Item not found.");const j=(V.id||"").trim();if(!j)throw new Error("ID is required.");const ke=l(v.modelData);if(j!==P.id&&ke.has(j))throw new Error("Another item already uses that ID.");P.id=j;const N=(V.name||"").trim();P.name=N||P.id;const ie=(V.logo||"").trim();if(ie?P.logo=ie:delete P.logo,V.externalFlag&&!V.external)P.external=!0;else{const oe=(V.external??"").toString().trim();oe?P.external=oe:delete P.external}const X=(V.color||"").trim();return X?P.color=X:delete P.color,P.deps=Array.isArray(V.deps)?V.deps:[],P.id!==V.originalId&&typeof C=="function"&&C(V.originalId,P.id),p(v.modelData,V.originalId,P.id),_(),w(),B(P.id),P.id}function ce(){if(!v.fields||!v.fields.idInput)return!1;const V=(v.fields.idInput.value||"").trim(),F={originalId:v.itemId,id:V,name:v.fields.nameInput.value||"",logo:v.fields.logoInput.value||"",external:v.fields.externalInput.value||"",externalFlag:v.fields.externalFlagInput.checked,color:v.fields.colorInput.value||"",deps:Fr(v.fields.depsInput.value,{excludeId:V})};try{return D(F),G(),!0}catch(K){return console.warn("[itemEditor] item edit failed",K),H((K==null?void 0:K.message)||"Unable to save item."),!1}}function de(){if(v.wrapper)return v.wrapper;const V=document.createElement("div");V.className="item-editor-modal",V.hidden=!0,V.setAttribute("role","dialog"),V.setAttribute("aria-modal","true");const F=document.createElement("div");F.className="item-editor-modal__backdrop",V.appendChild(F);const K=document.createElement("div");K.className="item-editor",V.appendChild(K);const P=document.createElement("div");P.className="item-editor__header";const j=document.createElement("h2");j.className="item-editor__title",j.textContent="Edit item";const ke=document.createElement("button");ke.type="button",ke.className="item-editor__close",ke.setAttribute("aria-label","Close item editor"),ke.textContent="×",P.appendChild(j),P.appendChild(ke),K.appendChild(P);const N=document.createElement("form");N.className="item-editor__form",K.appendChild(N);const ie=document.createElement("div");ie.className="item-editor__meta",ie.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',N.appendChild(ie);const X=document.createElement("div");X.className="item-editor__error",X.hidden=!0,N.appendChild(X);const ue=(Z,M,Le)=>{const je=document.createElement("label");je.className="item-editor__field";const Ve=document.createElement("span");if(Ve.className="item-editor__label",Ve.textContent=Z,je.appendChild(Ve),M.classList.add("item-editor__control"),je.appendChild(M),Le){const Ue=document.createElement("div");Ue.className="item-editor__hint",Ue.textContent=Le,je.appendChild(Ue)}return je},oe=document.createElement("input");oe.type="text",oe.required=!0,N.appendChild(ue("ID",oe,"Unique identifier used for links and dependencies."));const ge=document.createElement("input");ge.type="text",N.appendChild(ue("Name",ge,"Visible label shown on the tile."));const W=document.createElement("input");W.type="url",W.inputMode="url",W.placeholder="https://…",N.appendChild(ue("Logo URL",W,"Optional image URL."));const Ne=document.createElement("input");Ne.type="url",Ne.inputMode="url",Ne.placeholder="https://…",N.appendChild(ue("External link",Ne,"Shown with ↗ icon and in preview."));const Ke=document.createElement("div");Ke.className="item-editor__checkbox";const we=document.createElement("label");we.className="item-editor__checkbox-row";const L=document.createElement("input");L.type="checkbox";const pe=document.createElement("span");pe.textContent="Mark as external without link";const Je=document.createElement("div");Je.className="item-editor__hint",Je.textContent="Keeps dashed border even without a URL.",we.appendChild(L),we.appendChild(pe),Ke.appendChild(we),Ke.appendChild(Je),N.appendChild(Ke);const Oe=document.createElement("input");Oe.type="text",Oe.placeholder="#2563eb",N.appendChild(ue("Color",Oe,"Optional badge color (hex or CSS color)."));const S=document.createElement("textarea");S.rows=2,S.placeholder="Comma or space separated ids",N.appendChild(ue("Dependencies",S,"Use item IDs, separated by commas or spaces."));const y=document.createElement("div");y.className="item-editor__actions";const fe=document.createElement("button");fe.type="button",fe.className="pf-v5-c-button pf-m-tertiary",fe.textContent="Cancel";const J=document.createElement("button");return J.type="submit",J.className="pf-v5-c-button pf-m-primary",J.textContent="Save",y.appendChild(fe),y.appendChild(J),N.appendChild(y),v.wrapper=V,v.fields={idInput:oe,nameInput:ge,logoInput:W,externalInput:Ne,externalFlagInput:L,colorInput:Oe,depsInput:S,categoryValue:ie.querySelector(".item-editor__meta-value"),errorEl:X},fe.addEventListener("click",G),ke.addEventListener("click",G),F.addEventListener("click",G),N.addEventListener("submit",Z=>{Z.preventDefault(),ce()}),document.addEventListener("keydown",Z=>{Z.key==="Escape"&&!V.hidden&&(Z.preventDefault(),Z.stopPropagation(),G())}),document.body.appendChild(V),V}function Ie(V){const F=r(V);return F?(de(),v.categoryId=F.category.id,v.itemId=F.item.id,v.modelData=F.modelData,v.fields.categoryValue.textContent=F.category.title||F.category.id,v.fields.idInput.value=F.item.id||"",v.fields.nameInput.value=F.item.name||"",v.fields.logoInput.value=F.item.logo||"",v.fields.externalInput.value=typeof F.item.external=="string"?F.item.external:"",v.fields.externalFlagInput.checked=F.item.external===!0,v.fields.colorInput.value=F.item.color||"",v.fields.depsInput.value=Array.isArray(F.item.deps)?F.item.deps.join(", "):"",H(""),B(F.item.id),te(),!0):!1}return{open:Ie,hide:G,isOpen:()=>!!v.wrapper&&!v.wrapper.hidden}}function oo(r,l="series"){return(r||l).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||l}function bn(r,l="series"){const p=oo(r,l).replace(/\./g,"-");return p.replace(/-series$/i,"").replace(/-+$/,"")||p||oo(l,"series")}function fo(r,{seriesName:l,fallbackTitle:p="unknown"}={}){var v,H;const w=[r==null?void 0:r.seriesId,(v=r==null?void 0:r.data)==null?void 0:v.seriesId,r==null?void 0:r.apicurioArtifactId,l,r==null?void 0:r.title,r==null?void 0:r.apicurioArtifactName,(H=r==null?void 0:r.data)==null?void 0:H.title,p].map(G=>(G??"").toString().trim()),B=w.findIndex(Boolean),C=B!==-1?w[B]:"";return C?(console.log("[Series] deriveSeriesId: picked base",{base:C,sourceIndex:B,candidates:w}),bn(C,p)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:p}),null)}function rt(r,{seriesName:l,fallbackTitle:p="unknown"}={}){if(!r||typeof r!="object")return null;const _=fo(r,{seriesName:l,fallbackTitle:p});return _?(r.seriesId=_,r.apicurioArtifactId||(r.apicurioArtifactId=_),_):null}function hn(r,l={}){var w,B;if(!r)return null;const p=r.isSeries||((w=r.apicurioVersions)==null?void 0:w.length)>1||r.seriesId||((B=r.data)==null?void 0:B.seriesId)||r.apicurioArtifactId;if(!p&&!l.force)return null;const _=fo(r,l);return _||(p?bn(l.fallbackTitle||"unknown"):null)}const Vn=typeof import.meta<"u"&&"./"||"";function qr(){console.log("[Blockscape] init");const r=document.getElementById("jsonBox"),l=document.querySelector(".blockscape-json-panel"),p=document.getElementById("app"),_=document.getElementById("overlay"),w=document.getElementById("tabTooltip"),B=document.getElementById("modelList"),C=document.getElementById("itemPreview"),v=document.getElementById("urlForm"),H=document.getElementById("urlInput"),G=document.getElementById("loadUrl"),te=C.querySelector(".item-preview__title"),D=C.querySelector(".item-preview__body"),ce=C.querySelector(".item-preview__actions"),de=C.querySelector(".item-preview__close"),Ie=document.getElementById("downloadJson"),V=document.getElementById("shareModel"),F=document.getElementById("createVersion"),K=document.getElementById("openInEditor"),P=document.getElementById("copyJson"),j=document.getElementById("copySeries"),ke=document.getElementById("pasteJson"),N=document.getElementById("helpButton"),ie=document.getElementById("newPanelButton"),X=document.getElementById("shortcutHelp"),ue=document.getElementById("shortcutHelpList"),oe=document.getElementById("shortcutHelpClose"),ge=document.getElementById("shortcutHelpBackdrop"),W=document.getElementById("newPanel"),Ne=document.getElementById("newPanelClose"),Ke=document.getElementById("newPanelBackdrop"),we=document.getElementById("search"),L=document.getElementById("searchResults"),pe="blockscape:editorPayload",Je="blockscape:editorTransfer",Oe=document.title;r.value=document.getElementById("seed").textContent.trim();let S=[],y=-1;const fe=Dr({models:S,getActiveIndex:()=>y,setActive:nt,ensureModelMetadata:dt,getModelId:ft,getSeriesId:hn,ensureSeriesId:rt,getModelTitle:xe,computeJsonFingerprint:tt,uid:f});let J=null,Z=new Map,M=null,Le=null,je=!0,Ve=!1,Ue=0,Ce={x:0,y:0},Ee="map",he=null,be=!1,He=null;const st=2e3;let et=null,qe=null,Te=null,Ye=null,at=null,re=null,ye=null,Nt="",Jt=!1,Lt=null,an=null,Tt=null,$t=[],cn=null;const yn=30,jt=1e3,En="blockscape:hoverScale",Bt=1.5,kn=1,ln=2.5;let Mt=Bt;const _n="blockscape:seriesNavDoubleClickMs",Ot=900,Sn=300,xn=4e3;let s=Ot;fe.hydrateConfig(),ct(),Be(),se();function f(){return Math.random().toString(36).slice(2,10)}function k(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function E(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function h(e){return k(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function A(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),E(t)}function U(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}async function $(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function ne(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function z(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function Q(e){return Number.isFinite(e)?Math.min(ln,Math.max(kn,e)):Bt}function se(){p&&p.classList.toggle("blockscape-has-selection",!!M)}function _e(e){return Mt=Q(e),document.documentElement.style.setProperty("--blockscape-tile-hover-scale",Mt),Mt}function le(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(En,String(e))}catch(t){console.warn("[Blockscape] failed to persist hover scale",t)}}function ct(){if(typeof window>"u"||!window.localStorage)return _e(Bt);try{const e=window.localStorage.getItem(En);if(!e)return _e(Bt);const t=parseFloat(e);return _e(t)}catch(e){return console.warn("[Blockscape] failed to read hover scale",e),_e(Bt)}}function lt(e){return Number.isFinite(e)?Math.min(xn,Math.max(Sn,e)):Ot}function Pe(e){return s=lt(e),s}function me(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(_n,String(e))}catch(t){console.warn("[Blockscape] failed to persist series double-click wait",t)}}function Be(){if(typeof window>"u"||!window.localStorage)return Pe(Ot);try{const e=window.localStorage.getItem(_n);if(!e)return Pe(Ot);const t=parseInt(e,10);return Pe(t)}catch(e){return console.warn("[Blockscape] failed to read series double-click wait",e),Pe(Ot)}}function pt(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function Se(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(c=>c&&typeof c=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function Ge(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t)}function We(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>We(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${We(e[i])}`).join(",")}}`}function wt(e){try{return We(e)}catch{return""}}function tt(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=wt(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=wt(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const qt=[{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Jump to the previous or next category while keeping position where possible."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Cmd/Ctrl","Arrow Left"],["Cmd/Ctrl","Arrow Right"]],description:"Switch to the previous or next map when viewing a series."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile."},{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["F2"]],description:"Open the item editor for the selected tile."},{keys:[["Delete"]],description:"Delete the selected item (use Cmd/Ctrl+Z to undo)."},{keys:[["Escape"]],description:"Unselect item or close the open preview popover."}];function dt(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const c=n||e.title||t||"model",a=z(c).replace(/\./g,"-");e.id=a||`model-${f()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function bi(e){return JSON.parse(JSON.stringify(e))}function xe(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function vi(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const o=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(o)return o;const c=ft(e);return c?`${c} series`:t}return xe(e,t)}function ft(e){var o;const t=hn(e);if(t)return t;const n=(o=e==null?void 0:e.data)==null?void 0:o.id;return n&&n.toString().trim()||null}function wi(e){var u;if(e<0||e>=S.length||!r)return!0;const t=S[e],n=(r.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}dt(i,{titleHint:xe(t),idHint:ft(t)});const o=tt(t.data),c=tt(i);if(o===c)return!0;t.data=i;const a=Pt(t);return a>=0&&((u=t.apicurioVersions)!=null&&u[a])&&(t.apicurioVersions[a].data=i),!0}function yi(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function mo(e){if(y<0||!e)return null;const t=S[y].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const c=(i.items||[]).find(a=>a.id===e);if(c)return{category:i,item:c,modelData:t}}return null}function ho(e,t){const n=yi(t);let i=z(e||"item");if(!n.has(i))return i;const o=()=>f().slice(0,4);for(;n.has(i);)i=`${z(e||"item")}-${o()}`;return i}const Vt=jr({findItemAndCategoryById:mo,collectAllItemIds:yi,updateItemReferences:Jr,loadActiveIntoEditor:xt,rebuildFromActive:kt,select:e=>Qe(e),onSelectionRenamed:(e,t)=>{var n;M===e&&(M=t,se()),((n=he==null?void 0:he.item)==null?void 0:n.id)===e&&(he.item.id=t)}});function In(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const i={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[i],e.apicurioActiveVersionIndex=0;const o=e.title||xe(e);return rt(e,{seriesName:o,fallbackTitle:o}),e.isSeries=!0,e}function St(e,{versionLabel:t,createdOn:n}={}){var d,m,g;if(e!=null&&e.isSeries||((d=e==null?void 0:e.apicurioVersions)==null?void 0:d.length)>1){const T=e.title||xe(e);rt(e,{seriesName:T,fallbackTitle:T})}const i=ft(e);if(!i)return In(e,{versionLabel:t||"1",createdOn:n}),S.push(e),S.length-1;const o=S.findIndex(T=>ft(T)===i);if(o===-1)return In(e,{versionLabel:t||"1",createdOn:n}),S.push(e),S.length-1;const c=S[o];if(!Array.isArray(c.apicurioVersions)||!c.apicurioVersions.length){c.apicurioVersions=[{version:"1",data:c.data,createdOn:(g=(m=c.apicurioVersions)==null?void 0:m[0])==null?void 0:g.createdOn}],c.apicurioActiveVersionIndex=0;const T=c.title||xe(c);rt(c,{seriesName:T,fallbackTitle:T})}const a=String(c.apicurioVersions.length+1);c.apicurioVersions.push({version:a,data:e.data,createdOn:n||new Date().toISOString()}),c.apicurioActiveVersionIndex=c.apicurioVersions.length-1,c.data=e.data,c.title=xe(e)||c.title,c.isSeries=!0;const u=c.title||xe(c);return rt(c,{seriesName:u,fallbackTitle:u}),o}function Ei({versionLabel:e}={}){var a;if(y<0||!S[y])throw new Error("Load or select a model before creating a version.");const t=S[y];In(t,{versionLabel:"1"});let n;try{n=bi(t.data)}catch(u){throw console.warn("[Blockscape] failed to clone active model for versioning",u),new Error("Could not copy the current model.")}dt(n,{titleHint:xe(t),idHint:ft(t)||hn(t)});const o={version:e||String((((a=t.apicurioVersions)==null?void 0:a.length)||0)+1),data:n,createdOn:new Date().toISOString()};t.apicurioVersions.push(o),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=n,t.isSeries=!0;const c=t.title||xe(t);return rt(t,{seriesName:c,fallbackTitle:c}),y}function Pn(){const e=y>=0&&S[y]?S[y]:null,t=ft(e);document.title=t?`${t}-blockscape`:Oe}function Rn(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||xe(e);return rt(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function go(){const e=S[y],t=Rn(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function ki(e="shortcut",t=!1){const n=r.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=S[y],o=t?Rn(i):null,c=!!o,a=c?JSON.stringify(o,null,2):n,u=c&&hn(i)||xe(i,"blockscape"),d=c?"-series":"",m=`${z(u)}${d}.json`;return U(m,a),console.log(`[Blockscape] saved JSON (${e}):`,m),!0}const bo={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function _i(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return bo[n]||"#9ca3af"}function vo(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(d=>d+d).join(""):t,i=parseInt(n,16),o=i>>16&255,c=i>>8&255,a=i&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(c/255,2.2)+.0722*Math.pow(a/255,2.2)>.35?"#111111":"#ffffff"}function wo(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function Si(){if(Te)return;Te=document.createElement("div"),Te.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",Ye=document.createElement("span"),Ye.className="series-nav-notice__text",Te.appendChild(e),Te.appendChild(Ye),document.body.appendChild(Te)}function xi(){at&&(clearTimeout(at),at=null),Te&&Te.classList.remove("is-visible"),Ye&&(Ye.textContent="")}function Gt(){et=null,qe&&(clearTimeout(qe),qe=null),xi()}function yo(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function Eo(e,t,n){Si(),et={id:e,targetVersionIndex:t},qe&&clearTimeout(qe),qe=setTimeout(()=>{qe=null,Gt()},s);const i=yo(n,t);Hn(`Click again to open ${i} in this series.`,s)}function Hn(e,t=st,n=null){if(Si(),Ye.textContent="",Ye.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener",o.textContent=n,Ye.appendChild(i),Ye.appendChild(o)}Te.classList.add("is-visible"),at&&clearTimeout(at),at=setTimeout(()=>xi(),t)}function ko(){ue&&(ue.innerHTML="",qt.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((o,c)=>{if(c>0){const u=document.createElement("span");u.className="shortcut-help__or",u.textContent="or",n.appendChild(u)}const a=document.createElement("div");a.className="shortcut-help__combo",o.forEach((u,d)=>{if(d>0){const g=document.createElement("span");g.className="shortcut-help__sep",g.textContent="+",a.appendChild(g)}const m=document.createElement("kbd");m.className="shortcut-help__key",m.textContent=u,a.appendChild(m)}),n.appendChild(a)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),ue.appendChild(t)}),be=!0)}function _o(){return!!X&&X.hidden===!1}function So(){if(!X)return;be||ko(),He=document.activeElement,X.hidden=!1,X.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=X.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Dn(){if(!X||X.hidden)return;X.hidden=!0,X.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=He;e!=null&&e.focus?e.focus({preventScroll:!0}):N!=null&&N.focus&&N.focus({preventScroll:!0})}function xo(){if(!W)return;W.hidden=!1,W.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=W.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Fn(){!W||W.hidden||(W.hidden=!0,W.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),ie!=null&&ie.focus&&ie.focus({preventScroll:!0}))}let Jn=!1;function Cn(){Jn||(Jn=!0,requestAnimationFrame(()=>{Jn=!1,Gn(),Yt()}))}let Ii=!1;function Ci(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Io(e){const t=Ci(e);if(!t.length){p.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}p.querySelectorAll(".tile").forEach(n=>{var a;const i=(((a=n.querySelector(".name"))==null?void 0:a.textContent)||"").toLowerCase(),o=(n.dataset.id||"").toLowerCase(),c=t.every(u=>i.includes(u)||o.includes(u));n.style.opacity=c?"1":"0.2"})}function Co(e){const t=Ci(e);if(!t.length)return[];const n=[];return S.forEach((i,o)=>{var m;const c=vi(i),a=ft(i)||"",u=`${c} ${a}`.toLowerCase();t.every(g=>u.includes(g))&&n.push({type:"model",modelIndex:o,modelTitle:c,modelId:a}),(Array.isArray((m=i.data)==null?void 0:m.categories)?i.data.categories:[]).forEach(g=>{const T=(g.title||g.id||"").toString();(g.items||[]).forEach(R=>{const q=(R.name||R.id||"").toString(),ve=`${q} ${R.id||""} ${T}`.toLowerCase();t.every(De=>ve.includes(De))&&n.push({type:"item",modelIndex:o,modelTitle:c,modelId:a,itemId:R.id,itemName:q,categoryTitle:T})})})}),n.slice(0,yn)}function Ai(e){if(!L)return;L.innerHTML="";const t=(e||"").toString();if(!t.trim()){L.hidden=!0;return}if(!S.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",L.appendChild(i),L.hidden=!1;return}const n=Co(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",L.appendChild(i),L.hidden=!1;return}n.forEach(i=>{const o=document.createElement("button");o.type="button",o.className="search-result",o.dataset.modelIndex=String(i.modelIndex),i.itemId&&(o.dataset.itemId=i.itemId),i.type&&(o.dataset.type=i.type),i.modelIndex===y&&(!i.itemId||M===i.itemId)&&o.classList.add("is-active");const c=document.createElement("div");c.className="search-result__primary";const a=document.createElement("span");a.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",c.appendChild(a);const u=document.createElement("span");u.className="search-result__badge",u.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",c.appendChild(u);const d=document.createElement("div");d.className="search-result__meta";const m=document.createElement("span");if(m.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,d.appendChild(m),i.type==="item"&&i.itemId){const g=document.createElement("span");g.textContent=`Item ID: ${i.itemId}`,d.appendChild(g)}else if(i.type==="model"){const g=document.createElement("span");g.textContent="Matches model title",d.appendChild(g)}o.appendChild(c),o.appendChild(d),L.appendChild(o)}),L.hidden=!1}function Ni(e){Io(e||""),Ai(e||"")}function Ao(e){!e||!Number.isInteger(e.modelIndex)||(nt(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(y!==e.modelIndex)return;const t=(n=Z.get(e.itemId))==null?void 0:n.el;t&&(Qe(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function nt(e){if(mt(),Gt(),he=null,e<0||e>=S.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}Jt=!0,y=e,console.log("[Blockscape] active model:",xe(S[e]),"(index",e+" )"),Pn(),Wt(),xt(),kt(),we&&Ni(we.value||""),fe.updateAvailability()}function Wt(){if(B.innerHTML="",!S.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",B.appendChild(e);return}S.forEach((e,t)=>{var T;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===y?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===y?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const c=document.createElement("span");c.className="model-nav-title",c.textContent=vi(e),o.appendChild(c);const a=ft(e);if(a){const R=document.createElement("span");R.className="model-nav-id",R.textContent=a,o.appendChild(R)}const u=Array.isArray((T=e.data)==null?void 0:T.categories)?e.data.categories:[],d=u.reduce((R,q)=>R+(q.items||[]).length,0),m=document.createElement("span");m.className="model-nav-meta";const g=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";m.textContent=`${u.length} cat · ${d} items${g}`,i.appendChild(o),i.appendChild(m),n.appendChild(i),B.appendChild(n)}),fe.updateAvailability()}function xt(){if(y<0){r.value="",j&&(j.disabled=!0);return}const e=S[y];r.value=JSON.stringify(e.data,null,2),j&&(j.disabled=!Rn(e))}function No(e){try{return JSON.parse(e)}catch{return null}}function Lo(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const o=i.map((g,T)=>!g||typeof g!="object"?null:(dt(g,{titleHint:`${t} #${T+1}`}),{obj:g,idx:T})).filter(Boolean);if(!o.length)return[];const c=o[0].obj,{seriesTitleOverride:a}=n;let u=a||c.title||`${t} series`;a&&!c.title&&(c.title=a);const d={id:f(),title:u,data:c,apicurioVersions:o.map(({obj:g,idx:T})=>({version:String(T+1),data:g})),apicurioActiveVersionIndex:0,isSeries:!0},m=rt(d,{seriesName:u,fallbackTitle:u});return m&&(d.id=m),[d]}function Li(e,t="Pasted",n={}){return Array.isArray(e)?Lo(e,t,n):!e||typeof e!="object"?[]:(dt(e,{titleHint:`${t} #1`}),[{id:f(),title:e.title||`${t} #1`,data:e}])}function Ut(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const o=No(i);if(o){let a=n;if(Array.isArray(o)&&n.promptForSeriesName){const d=Se(o,t),m=pt(d);a={...n,promptForSeriesName:!1,seriesTitleOverride:m||d}}const u=Li(o,t,a);if(u.length)return u}return i.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,u)=>{const d=JSON.parse(a);return dt(d,{titleHint:`${t} #${u+1}`}),{id:f(),title:d.title||`${t} #${u+1}`,data:d}})}function To(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function zt(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!To(e)}function $o(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function Ti(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(pe)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(pe)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(pe)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=Ut(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let i=null;return n.forEach(o=>{const c=St(o,{versionLabel:"editor"});i==null&&(i=c)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function $i(e="storage"){const t=Ti();return!t||typeof t.index!="number"?!1:(nt(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function Bo(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let i;try{const a=A(t);i=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=Li(i.data,i.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let c=null;return o.forEach(a=>{const u=a.isSeries?i.title||a.title:null,d=St({...a,apicurioArtifactName:u||a.apicurioArtifactName},{versionLabel:"shared"});c==null&&(c=d)}),c}async function Mo(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await zn(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function Oo(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(c=>(c.items||[]).forEach(a=>{i.add(a.id);const u=new Set(a.deps||[]);(e.links||[]).forEach(d=>{d.from===a.id&&u.add(d.to)}),t.set(a.id,u),u.forEach(d=>{n.has(d)||n.set(d,new Set),n.get(d).add(a.id)})}));const o=new Set;return n.forEach((c,a)=>{((c==null?void 0:c.size)||0)>=2&&o.add(a)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:i}}function Vo(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const o=n.getContext("2d"),c=(e||"?").charAt(0).toUpperCase(),a=_i(e,t),u=vo(a);return o.fillStyle=a,o.beginPath(),o.arc(i/2,i/2,i/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=u,o.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(c,i/2,i/2),n.toDataURL("image/png")}function Pt(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Bi(e){const t=Pt(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Uo(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var a,u;const o=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();o&&t.set(o,i);const c=(((u=n==null?void 0:n.data)==null?void 0:u.seriesId)??"").toString().trim();c&&!t.has(c)&&t.set(c,i)}),t}const Mi=new WeakMap;function Po(e,t){var ht;if(!((ht=e==null?void 0:e.apicurioVersions)!=null&&ht[t]))return null;const n=e.apicurioVersions[t],i=n.data,o=tt(i),c=Mi.get(n);if(c&&c.fingerprint===o)return c.dataUrl;const a=160,u=90,d=document.createElement("canvas");d.width=a,d.height=u;const m=d.getContext("2d");m.fillStyle="#f8fafc",m.fillRect(0,0,a,u),m.strokeStyle="#e5e7eb",m.strokeRect(.5,.5,a-1,u-1);const g=Array.isArray(i==null?void 0:i.categories)?i.categories:[],T=Math.max(g.length,1),R=a/T,q=8,ve=8,De=4;g.forEach((it,gt)=>{const Qt=gt*R+R/2,Re=Array.isArray(it.items)?it.items:[],$e=Math.max(Re.length,1);Re.forEach((Rt,ji)=>{const Kn=q+(ji+.5)*((u-q-ve)/$e);m.beginPath(),m.arc(Qt,Kn,De,0,Math.PI*2);const pn=_i(Rt.name||Rt.id||"",Rt.color);m.fillStyle=pn,m.strokeStyle="rgba(15,23,42,0.25)",m.fill(),m.stroke()})});const Xe=d.toDataURL("image/png");return Mi.set(n,{fingerprint:o,dataUrl:Xe}),Xe}function jn(e,t){var u;if(Gt(),e<0||e>=S.length)return!1;const n=S[e];if(!((u=n==null?void 0:n.apicurioVersions)!=null&&u.length)||!wi(e))return!1;const o=n.apicurioVersions.length,c=(t%o+o)%o,a=n.apicurioVersions[c];return a!=null&&a.data?(n.apicurioActiveVersionIndex=c,n.data=a.data,Jt=!0,M=null,Le=null,se(),xt(),kt(),!0):!1}function qn(e){var i;if(!e||y<0)return!1;const t=S[y];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return!1;const n=Pt(t);return n===-1?!1:jn(y,n+e)}function Ro(e,t){if(Gt(),e<0||e>=S.length)return!1;const n=S[e];if(!Array.isArray(n==null?void 0:n.apicurioVersions)||n.apicurioVersions.length<=1)return alert("A series needs at least one map. Add another before removing this one."),!1;if(!wi(e))return!1;const i=Math.min(Math.max(t,0),n.apicurioVersions.length-1),o=Pt(n),[c]=n.apicurioVersions.splice(i,1);if(!c)return!1;let a=o;i===o?a=Math.min(i,n.apicurioVersions.length-1):i<o&&(a=Math.max(0,o-1)),n.apicurioActiveVersionIndex=Math.max(0,a);const u=n.apicurioVersions[n.apicurioActiveVersionIndex];return n.data=(u==null?void 0:u.data)||n.data,n.isSeries=n.apicurioVersions.length>1,nt(e),!0}function Ho(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||ft(e)||"Artifact",t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const o=Pt(e),c=Bi(e)||"latest";i.textContent=`No. in series ${c} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const a=document.createElement("div");a.className="version-nav__controls";const u=document.createElement("button");u.type="button",u.className="version-nav__button",u.textContent="Previous",u.addEventListener("click",()=>qn(-1));const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Next",d.addEventListener("click",()=>qn(1)),a.appendChild(u),a.appendChild(d),t.appendChild(a);const m=document.createElement("div");m.className="version-nav__thumbs",e.apicurioVersions.forEach((R,q)=>{var Qt;const ve=document.createElement("button");ve.type="button",ve.className="version-nav__thumb",q===o&&ve.classList.add("is-active");const De=Po(e,q);if(De){const Re=document.createElement("img");Re.src=De,Re.alt=`Version ${q+1}`,ve.appendChild(Re)}const Xe=document.createElement("div");Xe.className="version-nav__thumb-label";const ht=document.createElement("span");ht.className="version-nav__thumb-label-text";const it=(((Qt=R==null?void 0:R.data)==null?void 0:Qt.id)??(R==null?void 0:R.id)??"").toString().trim(),gt=it||(R!=null&&R.version?`v${R.version}`:`${q+1}`);if(ht.textContent=gt,Xe.title=it||gt,Xe.appendChild(ht),ve.appendChild(Xe),jo(Xe,ht),e.apicurioVersions.length>1){const Re=document.createElement("span");Re.className="version-nav__thumb-remove",Re.title=`Remove ${gt} from this series`,Re.setAttribute("aria-label",`Remove ${gt} from this series`),Re.setAttribute("role","button"),Re.tabIndex=-1,Re.textContent="×",Re.addEventListener("click",$e=>{$e.stopPropagation(),$e.preventDefault(),window.confirm(`Remove ${gt} from this series?`)&&Ro(y,q)}),ve.appendChild(Re)}ve.addEventListener("click",()=>jn(y,q)),Go(ve,R),m.appendChild(ve)});const g=document.createElement("button");g.type="button",g.className="version-nav__thumb version-nav__thumb--add",g.title="Create a new version from this map",g.addEventListener("click",()=>{try{const R=Ei({versionLabel:"manual"});nt(R)}catch(R){alert((R==null?void 0:R.message)||"Unable to create a new version right now.")}});const T=document.createElement("span");return T.className="version-nav__thumb-add-icon",T.textContent="+",g.appendChild(T),m.appendChild(g),t.appendChild(m),t}function Kt(){var zi,Ki,Yi;if(!J)return;Et(),Array.isArray(J.m.categories)||(J.m.categories=[]),console.log("[Blockscape] rendering categories=",J.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!J.m.abstract,"- value:",J.m.abstract?J.m.abstract.substring(0,50)+"...":"none"),p.innerHTML="",Z.clear(),$t=[],In(S[y],{versionLabel:"1"});const e=Ho(S[y]);e&&p.appendChild(e),_.setAttribute("width",window.innerWidth),_.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=J.m.title&&J.m.title.trim()||xe(S[y]),t.appendChild(n),((zi=S[y])!=null&&zi.isSeries||(Yi=(Ki=S[y])==null?void 0:Ki.apicurioVersions)!=null&&Yi.length)&&rt(S[y],{seriesName:S[y].title||J.m.title||xe(S[y])});const i=Bi(S[y]),o=hn(S[y]),c=(J.m.id??"").toString().trim(),a=document.createElement("div");a.className="blockscape-model-meta__details";const u=(I,ae)=>{if(!ae)return;const Y=document.createElement("div");Y.className="blockscape-model-id";const ze=document.createElement("span");ze.className="blockscape-model-id__label",ze.textContent=I;const ot=document.createElement("span");ot.className="blockscape-model-id__value",ot.textContent=ae,Y.append(ze,ot),a.appendChild(Y)};u("Series ID",o),u("Model ID",c),u("No. in series",i),a.childElementCount&&t.appendChild(a),p.appendChild(t);const d=document.createElement("div");d.className="blockscape-tabs";const m=document.createElement("div");m.className="blockscape-tablist",m.setAttribute("role","tablist"),d.appendChild(m);const g=document.createElement("div");g.className="blockscape-tabpanels",d.appendChild(g);const T=document.createElement("div"),R=document.createElement("div"),q=document.createElement("div"),ve=document.createElement("div");let De="";const Xe=Uo(S[y]),ht=Pt(S[y]);ye=null,Nt="";const it=[{id:"map",label:"Map",panel:T},{id:"abstract",label:"Info",panel:R},{id:"source",label:"Settings",panel:q},{id:"apicurio",label:"Apicurio",panel:ve}],gt=typeof fe.isEnabled=="function"?fe.isEnabled():!1,Qt=I=>{if(!_)return;const ae=I==="map";_.hidden=!ae,ae?(Gn(),Yt()):_.innerHTML=""};it.forEach((I,ae)=>{const Y=document.createElement("button");Y.type="button",Y.id=`tab-${I.id}`,Y.className="blockscape-tab"+(ae===0?" is-active":""),Y.setAttribute("role","tab"),Y.setAttribute("aria-controls",`panel-${I.id}`),Y.setAttribute("aria-selected",ae===0?"true":"false"),Y.textContent=I.label,I.id==="apicurio"&&!gt&&(Y.hidden=!0,Y.tabIndex=-1,Y.setAttribute("aria-hidden","true"),Y.style.display="none"),I.button=Y,m.appendChild(Y),I.panel.id=`panel-${I.id}`,I.panel.classList.add("blockscape-tabpanel"),I.panel.setAttribute("role","tabpanel"),I.panel.setAttribute("aria-labelledby",Y.id),I.panel.hidden=ae!==0,ae===0&&I.panel.classList.add("is-active"),g.appendChild(I.panel)});const Re=I=>{Ee=I,it.forEach(ae=>{const Y=ae.id===I;ae.button.classList.toggle("is-active",Y),ae.button.setAttribute("aria-selected",Y?"true":"false"),ae.panel.classList.toggle("is-active",Y),ae.panel.hidden=!Y}),Qt(I)},$e=it.find(I=>I.id==="apicurio"),Rt=I=>{if(!$e||!$e.button||!$e.panel)return;const ae=!!I;if($e.button.hidden=!ae,$e.button.tabIndex=ae?0:-1,$e.button.setAttribute("aria-hidden",ae?"false":"true"),$e.button.style.display=ae?"":"none",ae){const Y=Ee==="apicurio";$e.button.classList.toggle("is-active",Y),$e.button.setAttribute("aria-selected",Y?"true":"false"),$e.panel.classList.toggle("is-active",Y),$e.panel.hidden=!Y}else{const Y=$e.panel.classList.contains("is-active");if($e.button.classList.remove("is-active"),$e.button.setAttribute("aria-selected","false"),$e.panel.classList.remove("is-active"),$e.panel.hidden=!0,Y){const ze=it.find(ot=>ot.id!=="apicurio");ze&&Re(ze.id)}}an&&(an.checked=ae)};it.forEach(I=>{I.button.addEventListener("click",()=>{Et(),Re(I.id)}),I.id==="abstract"&&(ye=I.button,I.button.addEventListener("mouseenter",()=>dn(I.button,De,{offset:12})),I.button.addEventListener("mouseleave",Et),I.button.addEventListener("focus",()=>dn(I.button,De,{offset:12})),I.button.addEventListener("blur",Et))});const Kn=(I=>{const ae=it.find(ze=>ze.id===Ee);if(ae&&(ae.id!=="apicurio"||I))return ae.id;const Y=it.find(ze=>ze.id!=="apicurio"||I);return(Y==null?void 0:Y.id)||it[0].id})(gt);Re(Kn),Rt(gt),typeof fe.onEnabledChange=="function"&&fe.onEnabledChange(Rt),p.appendChild(d);const pn=document.createElement("div");pn.className="blockscape-render",T.appendChild(pn);const Ln=document.createElement("div");if(Ln.className="blockscape-abstract-panel",J.m.abstract){console.log("[Blockscape] Rendering abstract content");const I=document.createElement("div");I.className="blockscape-abstract",I.innerHTML=J.m.abstract,fr(I),Ln.appendChild(I),De=I.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const I=document.createElement("div");I.className="blockscape-abstract-placeholder",I.textContent="No abstract has been provided for this model.",Ln.appendChild(I),De=I.outerHTML}Nt=De,R.appendChild(Ln);const fn=document.createElement("div");fn.className="blockscape-source-panel";const Ct=document.createElement("div");Ct.className="blockscape-settings-panel";const Yn=document.createElement("p");Yn.className="blockscape-settings-panel__title",Yn.textContent="Feature toggles",Ct.appendChild(Yn);const Xn=({id:I,label:ae,hint:Y,checked:ze,className:ot="",onChange:Me})=>{const yt=document.createElement("label");yt.className=["settings-toggle",ot].filter(Boolean).join(" ");const Ae=document.createElement("input");Ae.type="checkbox",Ae.id=I,Ae.checked=ze;const ut=document.createElement("span");ut.className="settings-toggle__text";const Ht=document.createElement("span");if(Ht.className="settings-toggle__label",Ht.textContent=ae,ut.appendChild(Ht),Y){const Dt=document.createElement("span");Dt.className="settings-toggle__hint",Dt.textContent=Y,ut.appendChild(Dt)}return yt.appendChild(Ae),yt.appendChild(ut),typeof Me=="function"&&Ae.addEventListener("change",()=>Me(Ae.checked)),{row:yt,input:Ae}},{row:br}=Xn({id:"toggleSecondaryLinks",label:"Show indirect links",checked:je,className:"map-controls__toggle",onChange:I=>{je=I,M?Qe(M):(Wn(),Yt())}});Ct.appendChild(br);const{row:vr}=Xn({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:Ve,className:"map-controls__toggle",onChange:I=>{Ve=I,Vi()}});Ct.appendChild(vr);const qi=I=>`${(I/1e3).toFixed(1)}s`,Tn=document.createElement("label");Tn.className="settings-slider",Tn.setAttribute("for","seriesNavDoubleClickWait");const Zn=document.createElement("div");Zn.className="settings-slider__text";const Qn=document.createElement("span");Qn.className="settings-slider__label",Qn.textContent="Series double-click wait";const ei=document.createElement("span");ei.className="settings-slider__hint",ei.textContent="Time window to double-click into another map version.",Zn.append(Qn,ei);const $n=document.createElement("span");$n.className="settings-slider__value",$n.textContent=qi(s);const bt=document.createElement("input");bt.type="range",bt.id="seriesNavDoubleClickWait",bt.className="settings-slider__input",bt.min=String(Sn),bt.max=String(xn),bt.step="50",bt.value=String(s),bt.setAttribute("aria-label","Adjust double-click wait for series navigation"),bt.addEventListener("input",()=>{const I=Pe(parseInt(bt.value,10));$n.textContent=qi(I),me(I)}),Tn.append(Zn,$n,bt),Ct.appendChild(Tn);const Gi=I=>`${Math.round((I-1)*100)}%`,Bn=document.createElement("label");Bn.className="settings-slider",Bn.setAttribute("for","hoverScaleSlider");const ti=document.createElement("div");ti.className="settings-slider__text";const ni=document.createElement("span");ni.className="settings-slider__label",ni.textContent="Hover zoom";const ii=document.createElement("span");ii.className="settings-slider__hint",ii.textContent="Expand tiles on hover to see more detail.",ti.append(ni,ii);const Mn=document.createElement("span");Mn.className="settings-slider__value",Mn.textContent=Gi(Mt);const vt=document.createElement("input");vt.type="range",vt.id="hoverScaleSlider",vt.className="settings-slider__input",vt.min=String(kn),vt.max=String(ln),vt.step="0.1",vt.value=String(Mt),vt.setAttribute("aria-label","Adjust hover zoom"),vt.addEventListener("input",()=>{const I=_e(parseFloat(vt.value));Mn.textContent=Gi(I),le(I),M&&Cn()}),Bn.append(ti,Mn,vt),Ct.appendChild(Bn);const wr=typeof fe.isEnabled=="function"?fe.isEnabled():!1,{row:yr,input:Er}=Xn({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:wr,className:"apicurio-toggle",onChange:I=>{typeof fe.setEnabled=="function"&&fe.setEnabled(I)}});if(an=Er,Ct.appendChild(yr),fn.appendChild(Ct),l)l.hidden=!1,l.classList.remove("pf-v5-c-page__main-section"),fn.appendChild(l);else{const I=document.createElement("p");I.className="muted",I.textContent="Source editor unavailable.",fn.appendChild(I)}q.appendChild(fn),fe.mount(ve);let Wi=0;J.m.categories.forEach(I=>{const ae=document.createElement("section");ae.className="category",ae.dataset.cat=I.id;const Y=document.createElement("div");Y.className="cat-head",Y.innerHTML=`<div class="cat-title">${Xt(I.title||I.id)}</div>
                          <div class="muted cat-count">${(I.items||[]).length} items</div>`,ae.appendChild(Y);const ze=document.createElement("div");ze.className="grid",ae.appendChild(ze),(I.items||[]).forEach(Me=>{Wi+=1;const yt=Fo(Me.external),Ae=document.createElement("div");if(Ae.className=yt.isExternal?"tile external":"tile",Ae.tabIndex=0,Ae.dataset.id=Me.id,Ae.dataset.globalIndex=String(Wi),yt.url&&(Ae.dataset.externalUrl=yt.url),Xe.has(Me.id)){const mn=Xe.get(Me.id);Ae.dataset.seriesVersionIndex=String(mn),Ae.classList.add("tile--series-link");const kr=mn===ht?"Current map in this series":`Open version ${mn+1} in this series`;Ae.title=kr}const ut=document.createElement("img");ut.className="logo",Me.logo?(ut.src=Me.logo,ut.alt=Me.name||Me.id):(ut.alt="",ut.style.opacity=1,ut.src=Vo(Me.name||Me.id,Me.color));const Ht=document.createElement("div");Ht.className="name",Ht.textContent=Me.name||Me.id;const Dt=document.createElement("div");Dt.className="badge",Dt.textContent="reused";const en=document.createElement("button");en.type="button",en.className="tile-delete",en.setAttribute("aria-label",`Delete ${Me.name||Me.id}`),en.textContent="×",en.addEventListener("click",mn=>{mn.stopPropagation(),lr(Me.id)}),yt.url&&Ae.appendChild(Jo(yt.url)),Ae.appendChild(en),Ae.appendChild(ut),Ae.appendChild(Ht),Ae.appendChild(Dt),ze.appendChild(Ae),Z.set(Me.id,{el:Ae,catId:I.id,rect:null})}),pn.appendChild(ae);const ot=document.createElement("button");ot.type="button",ot.className="tile-add",ot.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',ot.addEventListener("click",()=>ir(I.id)),ze.appendChild(ot)}),Vi(),Do(),Gn(),Yt(),Wo()}function Do(){p.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",n=>{var g;if(typeof n.button=="number"&&n.button!==0)return;mt();const i=e.dataset.id,o=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,c=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,a=S[y],u=a?Pt(a):-1,d=((g=a==null?void 0:a.apicurioVersions)==null?void 0:g.length)>1&&Number.isInteger(o)&&o!==u,m=et&&et.id===i&&et.targetVersionIndex===o;if(et&&!m&&Gt(),d)if(m){if(Gt(),jn(y,o))return}else Eo(i,o,a);else Number.isInteger(c)&&c>0&&c%5===0&&Hn("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",i),M===i&&!(d&&m)){Nn();return}Qe(i)}),e.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())});const t=()=>{M&&Cn()};e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",t),e.addEventListener("focus",t),e.addEventListener("blur",t),e.draggable=!0,e.addEventListener("dragstart",Xo),e.addEventListener("dragend",Zo)}),p.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",Qo),e.addEventListener("drop",nr),e.addEventListener("dragenter",er),e.addEventListener("dragleave",tr)}),Ii||(Ii=!0,window.addEventListener("resize",Cn),window.addEventListener("scroll",Cn,{passive:!0}),window.addEventListener("resize",Pi)),document.getElementById("clear").onclick=()=>Nn()}function Gn(){Z.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function Oi(e,{includeSecondary:t=je}={}){if(!e||!J)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(J.fwd.get(e)||[]),i=new Set(J.rev.get(e)||[]),o=new Set,c=new Set,a=[],u=new Set,d=(m,g,T,R)=>{if(!m||!g)return;const q=`${m}->${g}:${T}:${R}`;u.has(q)||(u.add(q),a.push({from:m,to:g,type:T,depth:R}))};return n.forEach(m=>d(e,m,"dep",1)),i.forEach(m=>d(e,m,"revdep",1)),t&&new Set([...n,...i]).forEach(g=>{(J.fwd.get(g)||new Set).forEach(q=>{const ve=q===e;ve||o.add(q),ve||d(g,q,"dep",2)}),(J.rev.get(g)||new Set).forEach(q=>{const ve=q===e;ve||c.add(q),ve||d(g,q,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:o,secondaryRevs:c,edges:a}}function An(e,t){const n=Z.get(e);n&&n.el.classList.add(t)}function Qe(e){var u,d,m;M=e,Le=Oi(e),se(),Wn();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:o}=Le;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const c=Z.get(e);c&&c.el.classList.add("selected"),t.forEach(g=>An(g,"dep")),n.forEach(g=>An(g,"revdep")),i.forEach(g=>{!t.has(g)&&g!==e&&An(g,"dep-indirect")}),o.forEach(g=>{!n.has(g)&&!t.has(g)&&g!==e&&An(g,"revdep-indirect")}),Yt();const a=(m=(d=(u=Z.get(e))==null?void 0:u.el)==null?void 0:d.dataset)==null?void 0:m.externalUrl;a&&Hn("This item has link to",st,a)}function Nn(){M=null,Le=null,se(),Wn(),Yt()}function Wn(){p.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function Vi(){J!=null&&J.reusedLocal&&J.reusedLocal.forEach(e=>{const t=Z.get(e);if(!t)return;t.el.classList.toggle("reused",Ve);const n=t.el.querySelector(".badge");n&&(n.style.display=Ve?"inline-block":"none")})}function Yt(){for(;_.firstChild;)_.removeChild(_.firstChild);if(!M||_.hidden)return;Le=Oi(M),Le.edges.forEach(t=>{var T,R;const n=(T=Z.get(t.from))==null?void 0:T.rect,i=(R=Z.get(t.to))==null?void 0:R.rect;if(!n||!i)return;const o=Ui(n),c=Ui(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),u=(o.x+c.x)/2,d=o.y,m=(o.x+c.x)/2,g=c.y;a.setAttribute("d",`M ${o.x},${o.y} C ${u},${d} ${m},${g} ${c.x},${c.y}`),a.setAttribute("fill","none"),a.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),a.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),a.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&a.setAttribute("stroke-dasharray","4 3"),a.setAttribute("vector-effect","non-scaling-stroke"),_.appendChild(a)})}function Ui(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function Xt(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Fo(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function Jo(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function Pi(){cn||(cn=requestAnimationFrame(()=>{cn=null,$t=$t.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),$t.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function jo(e,t){!e||!t||($t.push({labelEl:e,textEl:t}),Pi())}function qo(e,t){var c,a;const n=[`<div class="version-nav__tooltip-title">${Xt(t)}</div>`],i=((e==null?void 0:e.version)??((c=e==null?void 0:e.data)==null?void 0:c.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${Xt(i)}</div>`);const o=(((a=e==null?void 0:e.data)==null?void 0:a.abstract)??"").toString().trim();return o?n.push(`<div class="version-nav__tooltip-body">${o}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function dn(e,t,{offset:n=8}={}){!w||!e||!t||(w.innerHTML=t,w.hidden=!1,w.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),o=w.getBoundingClientRect(),c=window.scrollX||document.documentElement.scrollLeft,a=window.scrollY||document.documentElement.scrollTop;let u=i.left+i.width/2-o.width/2+c,d=i.top-o.height-n+a;u<c+n&&(u=c+n);const m=c+window.innerWidth-o.width-n;u>m&&(u=m),d<a+n&&(d=i.bottom+n+a),w.style.left=`${u}px`,w.style.top=`${d}px`,w.classList.add("is-visible")}))}function Et(){re&&(clearTimeout(re),re=null),w&&(w.classList.remove("is-visible"),w.setAttribute("aria-hidden","true"),w.hidden=!0)}function Go(e,t){if(!e)return;const n=xe((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=qo(t,n);let o=null;const c=()=>{o&&(clearTimeout(o),o=null)},a=()=>{Tt=e,dn(e,`<div class="version-nav__tooltip-title">${Xt(n)}</div>`,{offset:10})},u=()=>{c(),o=setTimeout(()=>{Tt===e&&dn(e,i,{offset:10})},jt)},d=()=>{a(),u()},m=()=>{Tt!==e&&a(),u()},g=()=>{c(),Tt===e&&(Tt=null,Et())};e.addEventListener("mouseenter",d),e.addEventListener("focus",d),e.addEventListener("pointermove",m),e.addEventListener("mouseleave",g),e.addEventListener("blur",g),e.addEventListener("click",g)}function Wo(){Jt&&(Jt=!1,!(!ye||!Nt)&&(Et(),dn(ye,Nt,{offset:12}),re=setTimeout(()=>{Et(),zo()},1e3)))}function zo(){ye&&(Lt&&(clearTimeout(Lt),Lt=null),ye.classList.add("blockscape-tab--twinkle"),Lt=setTimeout(()=>{ye.classList.remove("blockscape-tab--twinkle"),Lt=null},1400))}window.addEventListener("scroll",Et,!0),window.addEventListener("resize",Et);function mt(){C&&(C.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),C.setAttribute("aria-hidden","true"),C.hidden=!0,Ri([]))}function Ko(e,t){C&&(Ce={x:e,y:t},C.hidden=!1,C.setAttribute("aria-hidden","false"),C.classList.add("is-visible"),Zt(e,t))}function Zt(e,t){if(!C)return;const n=12;C.style.left=`${e+n}px`,C.style.top=`${t+n}px`;const i=C.getBoundingClientRect();let o=i.left,c=i.top;i.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(c=Math.max(n,window.innerHeight-i.height-n)),C.style.left=`${o}px`,C.style.top=`${c}px`}function Ri(e=[]){ce&&(ce.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),ce.appendChild(n)}),ce.hidden=e.length===0)}async function Yo(e,t){var m;if(!C)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((m=t.querySelector(".name"))==null?void 0:m.textContent)||n||"Preview",o=n?`${n}.html`:"",c=o?`items/${o}`:"",a=++Ue,u=t.dataset.externalUrl||"",d=[{label:"Edit",title:"Edit this item",onClick:()=>{mt(),Vt.open(n)}}];if(u&&d.push({label:"Open link ↗",title:u,onClick:()=>window.open(u,"_blank","noopener")}),Ri(d),n&&Qe(n),te.textContent=i,D.innerHTML='<div class="item-preview__status">Loading…</div>',C.classList.remove("item-preview--has-frame"),C.classList.add("item-preview--expanded"),Ko(e.clientX,e.clientY),!c){D.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',Zt(Ce.x,Ce.y);return}try{const g=await fetch(c,{cache:"no-cache"});if(!g.ok)throw new Error(`HTTP ${g.status}`);const T=await g.text();if(a!==Ue)return;if(!T.trim()){D.innerHTML=`<div class="item-preview__status">No content in <code>${Xt(o)}</code>.</div>`,Zt(Ce.x,Ce.y);return}const q=document.createElement("iframe");q.className="item-preview__frame",q.title=`${i} details`,q.srcdoc=T,D.innerHTML="",D.appendChild(q),C.classList.add("item-preview--has-frame"),Zt(Ce.x,Ce.y)}catch(g){if(a!==Ue)return;D.innerHTML=`<div class="item-preview__status">No preview available for <strong>${Xt(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${c}`,g),Zt(Ce.x,Ce.y)}}de&&de.addEventListener("click",mt),N&&N.addEventListener("click",()=>{So()}),ie&&ie.addEventListener("click",()=>{xo()}),oe&&oe.addEventListener("click",Dn),ge&&ge.addEventListener("click",Dn),Ne&&Ne.addEventListener("click",Fn),Ke&&Ke.addEventListener("click",Fn),p&&p.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!p.contains(t)||Yo(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!C||C.hidden||C.contains(e.target)||mt()}),Ie&&Ie.addEventListener("click",()=>{ki("button")}),F&&F.addEventListener("click",()=>{if(y<0){alert("Load or select a model before creating a version.");return}try{const e=Ei({versionLabel:"map edit"});nt(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),V&&V.addEventListener("click",async()=>{var c;if(y<0||!S[y]){alert("Select or load a model before sharing.");return}const e={title:xe(S[y],"Shared Model"),data:S[y].data};let t;try{t=h(JSON.stringify(e))}catch(a){console.error("[Blockscape] share encode failed",a),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(a){console.warn("[Blockscape] failed to update URL for share",a),window.location.hash=n.hash}let o=!1;if((c=navigator.clipboard)!=null&&c.writeText)try{await navigator.clipboard.writeText(i),o=!0}catch(a){console.warn("[Blockscape] clipboard write failed",a)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),K&&K.addEventListener("click",()=>{const e=(r.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};M&&(n.selectedItemId=M),localStorage.setItem(pe,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";M&&(t=`editor.html?selected=${encodeURIComponent(M)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==pe||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||$i("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===Je&&$i("message")})),document.addEventListener("keydown",e=>{var n,i,o,c,a,u;if(_o()){e.key==="Escape"&&(e.preventDefault(),Dn());return}if(!(W!=null&&W.hidden)&&e.key==="Escape"){e.preventDefault(),Fn();return}if(!((n=Vt==null?void 0:Vt.isOpen)!=null&&n.call(Vt))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const d=S[y],m=((i=d==null?void 0:d.apicurioVersions)==null?void 0:i.length)>1;ki("shortcut",m);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!zt())return;if(cr()){e.preventDefault();return}}if(e.key==="Escape"){let d=!1;C&&!C.hidden&&(mt(),d=!0),M&&(Nn(),d=!0),d&&e.preventDefault()}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!zt())return;const d=e.key==="ArrowLeft"?-1:1;if(e.altKey)return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){qn(d)&&e.preventDefault();return}if(e.ctrlKey||e.metaKey)return;e.shiftKey?or(d)&&e.preventDefault():rr(d)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!zt()||e.altKey||e.ctrlKey||e.metaKey)return;const d=e.key==="ArrowUp"?-1:1;e.shiftKey?ar(d)&&e.preventDefault():sr(d)&&e.preventDefault()}if(e.key==="Delete"){if(!zt()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;Di()&&e.preventDefault()}if(e.key==="F2"){if(!zt())return;const d=M||((u=(a=(c=(o=e.target)==null?void 0:o.closest)==null?void 0:c.call(o,".tile"))==null?void 0:a.dataset)==null?void 0:u.id);d&&Vt.open(d)&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!C||C.hidden||Zt(Ce.x,Ce.y)}),window.addEventListener("scroll",()=>{!C||C.hidden||mt()},!0);let It=null,un=null;function Xo(e){mt(),It=e.target.dataset.id,un=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:It,categoryId:un})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",It,"from",un)}function Zo(e){e.target.classList.remove("dragging"),p.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),p.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),It=null,un=null}function Qo(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function er(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function tr(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function nr(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!It||!i)return;const c=Array.from(t.querySelectorAll(".tile")).filter(a=>a.dataset.id!==It).find(a=>{const u=a.getBoundingClientRect();return e.clientY<u.top+u.height/2});Hi(It,c?c.dataset.id:null,i),Kt(),console.log("[Blockscape] drop completed",It,"from",un,"to",i)}function Hi(e,t,n){if(y<0)return;const o=S[y].data.categories||[],c=o.find(g=>(g.items||[]).some(T=>T.id===e)),a=o.find(g=>g.id===n);if(!c||!a)return;c.items=c.items||[],a.items=a.items||[];const u=c.items.findIndex(g=>g.id===e);if(u===-1)return;const[d]=c.items.splice(u,1);let m=a.items.length;if(t){const g=a.items.findIndex(T=>T.id===t);g!==-1&&(m=g)}a.items.splice(m,0,d),xt(),kt()}function ir(e){if(y<0||!e)return;const t=S[y].data,i=(t.categories||[]).find(d=>d.id===e);if(!i)return;i.items=i.items||[];const o=`New item ${i.items.length+1}`,a={id:ho(`${e}-${i.items.length+1}`,t),name:o,deps:[]};i.items.push(a),xt(),kt(),mt(),Qe(a.id);const u=Z.get(a.id);u!=null&&u.el&&u.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",a.id,"to",e)}function or(e){if(!M||y<0||!e)return!1;const n=S[y].data.categories||[],i=Z.get(M);let o=null;if(i!=null&&i.catId&&(o=n.find(d=>d.id===i.catId)),o||(o=n.find(d=>(d.items||[]).some(m=>m.id===M))),!o)return!1;o.items=o.items||[];const c=o.items.findIndex(d=>d.id===M);if(c===-1)return!1;const a=c+e;if(a<0||a>=o.items.length)return!1;const[u]=o.items.splice(c,1);return o.items.splice(a,0,u),xt(),kt(),Kt(),Qe(M),!0}function rr(e){if(!J||!J.m||!e)return!1;const t=J.m.categories||[];if(!t.length)return!1;const n=()=>{const d=t.find(m=>(m.items||[]).length);return d?{category:d,item:d.items[0]}:null};if(!M){const d=n();return d?(Qe(d.item.id),!0):!1}const i=Z.get(M);let o=null;if(i!=null&&i.catId&&(o=t.find(d=>d.id===i.catId)),o||(o=t.find(d=>(d.items||[]).some(m=>m.id===M))),!o){const d=n();return d?(Qe(d.item.id),!0):!1}const c=o.items||[];if(!c.length)return!1;const a=c.findIndex(d=>d.id===M);if(a===-1)return!1;const u=a+e;return u<0||u>=c.length?!1:(Qe(c[u].id),!0)}function sr(e){if(!J||!J.m||!e)return!1;const t=J.m.categories||[];if(!t.length)return!1;const n=()=>{for(const d of t)if(d.items&&d.items.length)return d.items[0].id;return null};let o=(()=>{if(!M)return-1;const d=Z.get(M);if(d!=null&&d.catId){const m=t.findIndex(g=>g.id===d.catId);if(m!==-1)return m}return t.findIndex(m=>(m.items||[]).some(g=>g.id===M))})();if(o===-1){const d=n();return d?(Qe(d),!0):!1}let a=(t[o].items||[]).findIndex(d=>d.id===M);a===-1&&(a=0);let u=o+e;for(;u>=0&&u<t.length;){const m=t[u].items||[];if(m.length){const g=Math.min(m.length-1,Math.max(0,a));return Qe(m[g].id),!0}u+=e>0?1:-1}return!1}function ar(e){if(!M||y<0||!e)return!1;const n=S[y].data.categories||[];if(!n.length)return!1;const i=Z.get(M);let o=-1;if(i!=null&&i.catId&&(o=n.findIndex(T=>T.id===i.catId)),o===-1&&(o=n.findIndex(T=>(T.items||[]).some(R=>R.id===M))),o===-1)return!1;const c=o+e;if(c<0||c>=n.length)return!1;const a=n[o],u=n[c];if(!u)return!1;a.items=a.items||[],u.items=u.items||[];const d=a.items.findIndex(T=>T.id===M);if(d===-1)return!1;const m=Math.min(u.items.length,Math.max(0,d)),g=m<u.items.length?u.items[m].id:null;return Hi(M,g,u.id),Kt(),Qe(M),!0}function cr(){if(!he||y<0)return!1;const e=S[y];if(!e||e.id!==he.modelId)return!1;const t=he,o=(e.data.categories||[]).find(a=>a.id===t.categoryId);if(!o)return!1;o.items=o.items||[];const c=Math.min(Math.max(t.index,0),o.items.length);return o.items.splice(c,0,t.item),he=null,mt(),M=null,Le=null,se(),xt(),kt(),Kt(),Qe(t.item.id),console.log("[Blockscape] undo delete restored",t.item.id),!0}function Di(){if(!M||y<0)return!1;const t=S[y].data.categories||[];if(!t.length)return!1;const n=Z.get(M);let i=null;if(n!=null&&n.catId&&(i=t.find(m=>m.id===n.catId)),i||(i=t.find(m=>(m.items||[]).some(g=>g.id===M))),!i||!Array.isArray(i.items))return!1;const o=i.items.findIndex(m=>m.id===M);if(o===-1)return!1;const c=i.items.splice(o,1)[0];if(!c)return!1;const a=S[y];he={item:c,categoryId:i.id,index:o,modelId:a?a.id:null};const d=(()=>{var g;if(i.items.length){const T=Math.min(o,i.items.length-1);return((g=i.items[T])==null?void 0:g.id)||null}const m=t.findIndex(T=>T.id===i.id);if(m===-1)return null;for(let T=m+1;T<t.length;T++){const R=t[T].items||[];if(R.length)return R[0].id}for(let T=m-1;T>=0;T--){const R=t[T].items||[];if(R.length)return R[0].id}return null})();return mt(),M=null,Le=null,se(),xt(),kt(),Kt(),d?Qe(d):Nn(),console.log("[Blockscape] removed item",c.id),!0}function lr(e){if(!e)return!1;const t=M;M=e;const n=Di();return n||(M=t,se()),n}P&&P.addEventListener("click",async()=>{const e=r.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await $(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),j&&j.addEventListener("click",async()=>{const e=go();if(!e){alert("No series available to copy. Create another version first.");return}await $(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),ke&&ke.addEventListener("click",async()=>{try{const e=await ne();if(!e){alert("Clipboard is empty.");return}r.value=e,r.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=Ut(r.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const o=St(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=o)}),y===-1&&t!=null?nt(t):Wt()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(y<0){alert("No active model selected.");return}try{const t=JSON.parse(r.value);if(dt(t,{titleHint:xe(S[y]),idHint:ft(S[y])||xe(S[y])}),S[y].data=t,S[y].title=t.title||S[y].title,S[y].isSeries||((e=S[y].apicurioVersions)==null?void 0:e.length)>1){const n=S[y].title||xe(S[y]);rt(S[y],{seriesName:n,fallbackTitle:n})}Pn(),console.log("[Blockscape] replaced active model:",xe(S[y])),kt(),fe.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const o=await i.text(),c=i.name.replace(/\.[^.]+$/,"")||"File",a=Ut(o,c,{seriesTitleOverride:`${c} series`});if(!a.length){console.warn("[Blockscape] no models in file:",i.name);continue}a.forEach((u,d)=>{var De;const m=(((De=u.data)==null?void 0:De.title)??"").toString().trim(),g=a.length>1?`${i.name} #${d+1}`:i.name,T=`${c} series`,R=u.isSeries?T:null;let q={...u};if(u.isSeries){const Xe=R||m||u.title||g||"unknown";q.title=Xe;const ht=bn(Xe||"unknown");Ge(q,ht),rt(q,{seriesName:Xe,fallbackTitle:"unknown"}),q.apicurioArtifactName=q.apicurioArtifactName||Xe}else q.title=m||g;const ve=St({...q,apicurioArtifactName:q.apicurioArtifactName||R||q.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=ve)})}y===-1&&n!=null?nt(n):Wt()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",dr);function dr(e){var o;if(!zt())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!$o(t))return;let n=[];try{n=Ut(t,"Clipboard",{promptForSeriesName:!0})}catch(c){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",c);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((c,a)=>{const u=St(c,{versionLabel:n.length>1?`paste #${a+1}`:"paste"});i==null&&(i=u)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&nt(i)}B.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(wo(),nt(n))}),document.getElementById("removeModel").onclick=()=>{if(y<0)return;const e=xe(S[y]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",xe(S[y])),S.splice(y,1),!S.length){y=-1,J=null,p.innerHTML="",_.innerHTML="",r.value="",Wt(),Pn();return}const n=Math.min(y,S.length-1);nt(n)},we&&(we.addEventListener("input",e=>{Ni(e.target.value||"")}),we.addEventListener("focus",()=>{we.value&&we.value.trim()&&Ai(we.value)})),L&&L.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;Ao({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!L||L.hidden)return;const t=e.target;L.contains(t)||we&&(t===we||we.contains(t))||(L.hidden=!0)}),v&&H&&G&&v.addEventListener("submit",async e=>{e.preventDefault();const t=H.value.trim();if(!t){alert("Please enter a URL"),H.focus();return}const n=await zn(t);if(typeof n=="number"){nt(n),H.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!H||!t)return;let n=null;H.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=H.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function kt(){if(!(y<0))try{J=Oo(S[y].data),Kt()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function ur(){const e=["comms.bs","planets.bs","styleguide.bs"],t=n=>Vn?Vn.endsWith("/")?`${Vn}${n}`:`${Vn}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const o=await i.text(),c=n.replace(/\.[^.]+$/,"")||"Model",a=Ut(o,c,{seriesTitleOverride:`${c} series`});if(!a.length){console.warn("[Blockscape] no models found in",n);continue}a.forEach(u=>{let d={...u};if(u.isSeries){const m=`${c} series`;d={...u,title:m,apicurioArtifactName:m};const g=bn(m||"unknown");Ge(d,g),rt(d,{seriesName:m,fallbackTitle:"unknown"})}St(d,{versionLabel:n})}),console.log(`[Blockscape] loaded ${a.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}Wt()}async function pr(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const o=await fetch(e,i);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function fr(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>mr(i)),e.querySelectorAll("a[href]").forEach(i=>{const o=i.getAttribute("href");Ji(o)&&Fi(i,o)})}function mr(e){var u,d;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(d=(u=e.parentNode)==null?void 0:u.closest)!=null&&d.call(u,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let o;for(;(o=n.exec(t))!==null;)i.push({url:o[0],index:o.index});if(!i.length)return;const c=document.createDocumentFragment();let a=0;i.forEach(({url:m,index:g})=>{g>a&&c.appendChild(document.createTextNode(t.slice(a,g))),c.appendChild(hr(m)),a=g+m.length}),a<t.length&&c.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(c,e)}function hr(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",Ji(e)&&Fi(t,e),t}function Fi(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>gr(n,t,e)))}async function gr(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await zn(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function Ji(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function zn(e){try{console.log("[Blockscape] loading from URL:",e);const t=await pr(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=Ut(t,i)}catch(a){throw new Error(`Invalid JSON payload: ${a.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let c=null;return o.forEach((a,u)=>{var q;const d=(((q=a.data)==null?void 0:q.title)??"").toString().trim(),m=o.length>1?`${i} #${u+1}`:i,g=a.isSeries?`${i} series`:null;let T={...a};if(a.isSeries){const ve=g||d||T.title||m;T={...a,title:ve,apicurioArtifactName:ve||a.apicurioArtifactName};const De=bn(ve||"unknown");Ge(T,De),rt(T,{seriesName:ve||g||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:De,url:e,baseName:i,seriesTitle:ve})}const R=St({...T,title:d||T.title||m,apicurioArtifactName:T.apicurioArtifactName||g||a.apicurioArtifactName},{versionLabel:i});c==null&&(c=R)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,i),y===-1&&c!=null?nt(c):Wt(),c}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=Ut(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let o=null;i.forEach(g=>{const T=St(g,{versionLabel:"seed"});o==null&&(o=T)}),await ur();const c=await Mo(),a=Ti(),u=a==null?void 0:a.index,d=Bo();nt(typeof c=="number"?c:typeof d=="number"?d:typeof u=="number"?u:o??0)})()}function Gr(r){let l;return{c(){l=O("div"),l.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',b(l,"id","shortcutHelp"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","shortcutHelpTitle")},m(p,_){Ze(p,l,_)},p:_t,i:_t,o:_t,d(p){p&&Fe(l)}}}class Wr extends gi{constructor(l){super(),hi(this,l,null,Gr,fi,{})}}const zr=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function ro(r){let l,p,_,w,B,C,v,H;return{c(){l=O("div"),p=O("div"),_=O("a"),w=mi("Open Blockscape GPT"),B=ee(),C=O("div"),C.textContent="Paste the copied prompt into that chat.",v=ee(),H=O("div"),H.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',b(_,"href",Yr),b(_,"target","_blank"),b(_,"rel","noreferrer"),b(C,"class","new-panel__hint"),b(p,"class","new-panel__link"),b(H,"class","new-panel__link new-panel__link--disabled"),b(l,"class","new-panel__links")},m(G,te){Ze(G,l,te),x(l,p),x(p,_),x(_,w),x(p,B),x(p,C),x(l,v),x(l,H)},p:_t,d(G){G&&Fe(l)}}}function so(r){let l,p,_,w,B,C;return{c(){l=O("div"),p=O("div"),p.textContent="Generated prompt",_=ee(),w=O("textarea"),b(p,"class","new-panel__prompt-label"),b(w,"class","pf-v5-c-form-control new-panel__textarea"),b(w,"rows","4"),w.readOnly=!0,b(l,"class","new-panel__prompt")},m(v,H){Ze(v,l,H),x(l,p),x(l,_),x(l,w),rn(w,r[4]),B||(C=Ft(w,"input",r[12]),B=!0)},p(v,H){H&16&&rn(w,v[4])},d(v){v&&Fe(l),B=!1,C()}}}function Kr(r){let l,p,_,w,B,C,v,H,G,te,D,ce,de,Ie,V,F,K,P,j,ke,N,ie,X,ue,oe,ge,W,Ne,Ke,we,L,pe,Je,Oe,S,y,fe,J,Z,M,Le,je,Ve,Ue,Ce,Ee=r[2]==="gpt"&&ro(),he=r[4]&&r[5]&&so(r);return Ve=Ar(r[10][0]),{c(){l=O("div"),p=O("div"),_=ee(),w=O("div"),B=O("div"),B.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',C=ee(),v=O("form"),H=O("div"),G=O("label"),G.textContent="Domain",te=ee(),D=O("p"),D.textContent="Describe what you want to create a map for.",ce=ee(),de=O("textarea"),Ie=ee(),V=O("div"),F=O("label"),K=O("input"),P=ee(),j=O("span"),j.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,ke=ee(),N=O("fieldset"),ie=O("legend"),ie.textContent="Target",X=ee(),ue=O("p"),ue.textContent="Choose where you plan to use the prompt.",oe=ee(),ge=O("label"),W=O("input"),Ne=ee(),Ke=O("div"),Ke.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',we=ee(),L=O("label"),pe=O("input"),Je=ee(),Oe=O("div"),Oe.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',S=ee(),y=O("div"),fe=O("button"),fe.textContent="Copy prompt",J=ee(),Z=O("div"),M=mi(r[3]),Le=ee(),Ee&&Ee.c(),je=ee(),he&&he.c(),b(p,"id","newPanelBackdrop"),b(p,"class","shortcut-help__backdrop"),b(B,"class","shortcut-help__header"),b(G,"for","newDomain"),b(D,"class","new-panel__hint"),b(de,"id","newDomain"),b(de,"class","pf-v5-c-form-control new-panel__textarea"),b(de,"rows","4"),de.required=!0,b(de,"placeholder","Ex: Companies building open-source geospatial tools"),b(H,"class","new-panel__field"),b(K,"id","seriesToggle"),b(K,"type","checkbox"),b(F,"class","new-panel__toggle"),b(F,"for","seriesToggle"),b(V,"class","new-panel__field"),b(ue,"class","new-panel__hint"),b(W,"type","radio"),b(W,"name","target"),W.__value="gpt",rn(W,W.__value),b(ge,"class","new-panel__option"),b(pe,"type","radio"),b(pe,"name","target"),pe.__value="plain",rn(pe,pe.__value),b(L,"class","new-panel__option"),b(N,"class","new-panel__field"),b(fe,"class","pf-v5-c-button pf-m-primary"),b(fe,"type","submit"),b(Z,"class","new-panel__status"),b(Z,"aria-live","polite"),b(y,"class","new-panel__actions"),b(v,"class","shortcut-help__list new-panel__form"),b(w,"class","shortcut-help__panel"),b(w,"tabindex","-1"),b(l,"id","newPanel"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","newPanelTitle"),Ve.p(W,pe)},m(be,He){Ze(be,l,He),x(l,p),x(l,_),x(l,w),x(w,B),x(w,C),x(w,v),x(v,H),x(H,G),x(H,te),x(H,D),x(H,ce),x(H,de),rn(de,r[0]),x(v,Ie),x(v,V),x(V,F),x(F,K),K.checked=r[1],x(F,P),x(F,j),x(v,ke),x(v,N),x(N,ie),x(N,X),x(N,ue),x(N,oe),x(N,ge),x(ge,W),W.checked=W.__value===r[2],x(ge,Ne),x(ge,Ke),x(N,we),x(N,L),x(L,pe),pe.checked=pe.__value===r[2],x(L,Je),x(L,Oe),x(v,S),x(v,y),x(y,fe),x(y,J),x(y,Z),x(Z,M),x(v,Le),Ee&&Ee.m(v,null),x(v,je),he&&he.m(v,null),Ue||(Ce=[Ft(de,"input",r[7]),Ft(K,"change",r[8]),Ft(W,"change",r[9]),Ft(pe,"change",r[11]),Ft(v,"submit",Cr(r[6]))],Ue=!0)},p(be,[He]){He&1&&rn(de,be[0]),He&2&&(K.checked=be[1]),He&4&&(W.checked=W.__value===be[2]),He&4&&(pe.checked=pe.__value===be[2]),He&8&&Lr(M,be[3]),be[2]==="gpt"?Ee?Ee.p(be,He):(Ee=ro(),Ee.c(),Ee.m(v,je)):Ee&&(Ee.d(1),Ee=null),be[4]&&be[5]?he?he.p(be,He):(he=so(be),he.c(),he.m(v,null)):he&&(he.d(1),he=null)},i:_t,o:_t,d(be){be&&Fe(l),Ee&&Ee.d(),he&&he.d(),Ve.r(),Ue=!1,wn(Ce)}}}const Yr="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function Xr(r,l,p){let _="",w=!1,B="gpt",C="",v="",H=!1;const G=()=>{var P;return typeof navigator<"u"&&!!((P=navigator.clipboard)!=null&&P.writeText)};function te(P){const j=P||"[DOMAIN]",ke=w?"series":"map",ie=zr.replaceAll("[DOMAIN NAME]",j).replaceAll("[DOMAIN]",j).replaceAll("[map|series]",ke).split(`
`),X=`Generate a **blockscape ${ke}** for the domain of ${j}.`,ue=ie.findIndex(ge=>ge.toLowerCase().includes("generate a **blockscape value")||ge.toLowerCase().includes("generate a blockscape [map|series]")||ge.toLowerCase().startsWith("generate a blockscape"));ue>=0?ie[ue]=X:ie.unshift(X);const oe=w?`

User requested a series (return an array of models).`:"";return`${ie.join(`
`).trim()}${oe}`}async function D(P){P.preventDefault();const j=_.trim();if(p(3,C=""),p(5,H=B!=="gpt"),!j){p(3,C="Add a domain to generate a prompt."),p(4,v="");return}if(B==="gpt"?p(4,v=`${w?"Create a series":"Create a map"} for ${j}`):(p(4,v=te(j)),p(5,H=!0)),!G()){p(3,C="Clipboard access is unavailable. Copy the prompt below."),p(5,H=!0);return}try{await navigator.clipboard.writeText(v),p(3,C=B==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),B==="gpt"&&p(5,H=!1)}catch(N){console.warn("[Blockscape] clipboard write failed",N),p(3,C="Copy failed. Use the prompt below."),p(5,H=!0)}}const ce=[[]];function de(){_=this.value,p(0,_)}function Ie(){w=this.checked,p(1,w)}function V(){B=this.__value,p(2,B)}function F(){B=this.__value,p(2,B)}function K(){v=this.value,p(4,v)}return[_,w,B,C,v,H,D,de,Ie,V,ce,F,K]}class Zr extends gi{constructor(l){super(),hi(this,l,Xr,Kr,fi,{})}}const{document:ao}=Ir;function Qr(r){let l,p,_,w,B,C,v,H,G,te,D,ce,de,Ie,V,F,K,P,j,ke,N,ie,X,ue,oe,ge,W,Ne,Ke,we,L,pe,Je,Oe,S,y,fe,J,Z,M,Le,je=`<script id="seed" type="application/json">${r[1]}<\/script>`,Ve,Ue,Ce,Ee,he,be,He,st,et,qe,Te,Ye,at;return st=new Wr({}),qe=new Zr({}),{c(){l=O("link"),p=ee(),_=O("div"),w=O("header"),B=O("div"),C=O("div"),v=O("div"),H=O("div"),H.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',G=ee(),te=O("div"),D=O("div"),ce=O("button"),de=O("span"),de.textContent="Toggle search and edit tools",Ie=ee(),V=O("span"),V.textContent="▾",F=ee(),K=O("button"),K.textContent="New",P=ee(),j=O("form"),j.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',ke=ee(),N=O("label"),N.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',ie=ee(),X=O("button"),X.textContent="Help",ue=ee(),oe=O("div"),ge=O("div"),ge.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',W=ee(),Ne=O("button"),Ne.textContent="Edit",Ke=ee(),we=O("button"),we.textContent="Share",Oe=ee(),S=O("div"),S.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',y=ee(),fe=O("main"),fe.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,J=ee(),Z=O("footer"),Z.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',M=ee(),Le=new Tr(!1),Ve=ee(),Ue=uo("svg"),Ce=ee(),Ee=O("div"),he=ee(),be=O("div"),be.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',He=ee(),to(st.$$.fragment),et=ee(),to(qe.$$.fragment),ao.title="Blockscape — simple landscape-style tiles",b(l,"rel","icon"),b(l,"type","image/svg+xml"),b(l,"href","./favicon.svg"),b(H,"class","blockscape-brand"),b(de,"class","sr-only"),b(V,"class","blockscape-toolbar__toggle-icon"),b(V,"aria-hidden","true"),b(ce,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),b(ce,"type","button"),b(ce,"aria-expanded",r[0]),b(ce,"aria-controls","blockscapeHeaderExtras"),b(K,"id","newPanelButton"),b(K,"class","pf-v5-c-button pf-m-primary"),b(K,"type","button"),b(K,"title","Create something new"),b(j,"id","urlForm"),b(j,"class","blockscape-url-form"),b(j,"autocomplete","on"),j.noValidate=!0,b(N,"class","pf-v5-c-button pf-m-primary blockscape-file"),b(X,"id","helpButton"),b(X,"class","pf-v5-c-button pf-m-primary"),b(X,"type","button"),b(X,"title","Show keyboard shortcuts"),b(D,"class","blockscape-toolbar__primary"),b(ge,"class","blockscape-search"),b(Ne,"id","openInEditor"),b(Ne,"class","pf-v5-c-button pf-m-secondary"),b(Ne,"type","button"),b(Ne,"title","Open current JSON in the editor"),b(we,"id","shareModel"),b(we,"class","pf-v5-c-button pf-m-secondary"),b(we,"type","button"),b(we,"title","Copy a shareable URL for this model"),b(oe,"id","blockscapeHeaderExtras"),b(oe,"class","blockscape-toolbar__extras"),oe.hidden=L=!r[0],b(oe,"aria-hidden",pe=!r[0]),b(te,"class","blockscape-toolbar__controls"),b(te,"data-expanded",Je=r[0]?"true":"false"),b(S,"class","blockscape-legend"),b(S,"role","presentation"),b(v,"class","blockscape-toolbar"),b(C,"class","pf-v5-c-masthead__content"),b(B,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),b(w,"class","pf-v5-c-page__header"),b(fe,"class","pf-v5-c-page__main"),b(Z,"class","pf-v5-c-page__footer blockscape-footer"),b(_,"class","pf-v5-c-page"),Le.a=Ve,b(Ue,"id","overlay"),b(Ue,"class","svg-layer"),b(Ee,"id","tabTooltip"),b(Ee,"class","blockscape-tab-tooltip"),Ee.hidden=!0,b(Ee,"aria-hidden","true"),b(be,"id","itemPreview"),b(be,"class","item-preview"),be.hidden=!0,b(be,"aria-hidden","true")},m(re,ye){x(ao.head,l),Ze(re,p,ye),Ze(re,_,ye),x(_,w),x(w,B),x(B,C),x(C,v),x(v,H),x(v,G),x(v,te),x(te,D),x(D,ce),x(ce,de),x(ce,Ie),x(ce,V),x(D,F),x(D,K),x(D,P),x(D,j),x(D,ke),x(D,N),x(D,ie),x(D,X),x(te,ue),x(te,oe),x(oe,ge),x(oe,W),x(oe,Ne),x(oe,Ke),x(oe,we),x(v,Oe),x(v,S),x(_,y),x(_,fe),x(_,J),x(_,Z),Ze(re,M,ye),Le.m(je,re,ye),Ze(re,Ve,ye),Ze(re,Ue,ye),Ze(re,Ce,ye),Ze(re,Ee,ye),Ze(re,he,ye),Ze(re,be,ye),Ze(re,He,ye),ui(st,re,ye),Ze(re,et,ye),ui(qe,re,ye),Te=!0,Ye||(at=Ft(ce,"click",r[2]),Ye=!0)},p(re,[ye]){(!Te||ye&1)&&b(ce,"aria-expanded",re[0]),(!Te||ye&1&&L!==(L=!re[0]))&&(oe.hidden=L),(!Te||ye&1&&pe!==(pe=!re[0]))&&b(oe,"aria-hidden",pe),(!Te||ye&1&&Je!==(Je=re[0]?"true":"false"))&&b(te,"data-expanded",Je)},i(re){Te||(di(st.$$.fragment,re),di(qe.$$.fragment,re),Te=!0)},o(re){eo(st.$$.fragment,re),eo(qe.$$.fragment,re),Te=!1},d(re){re&&(Fe(p),Fe(_),Fe(M),Le.d(),Fe(Ve),Fe(Ue),Fe(Ce),Fe(Ee),Fe(he),Fe(be),Fe(He),Fe(et)),Fe(l),pi(st,re),pi(qe,re),Ye=!1,at()}}}function es(r,l,p){const _=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let w=!1;const B=()=>{if(p(0,w=!w),!w){const C=document.getElementById("search");C&&C.value&&(C.value="",C.dispatchEvent(new Event("input",{bubbles:!0})))}};return Br(()=>{qr()}),[w,_,B]}class ts extends gi{constructor(l){super(),hi(this,l,es,Qr,fi,{})}}const ns=document.getElementById("root");new ts({target:ns});
