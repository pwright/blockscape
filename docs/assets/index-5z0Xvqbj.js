var Ho=Object.defineProperty;var Do=(r,l,p)=>l in r?Ho(r,l,{enumerable:!0,configurable:!0,writable:!0,value:p}):r[l]=p;var kt=(r,l,p)=>Do(r,typeof l!="symbol"?l+"":l,p);(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))_(w);new MutationObserver(w=>{for(const $ of w)if($.type==="childList")for(const S of $.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&_(S)}).observe(document,{childList:!0,subtree:!0});function p(w){const $={};return w.integrity&&($.integrity=w.integrity),w.referrerPolicy&&($.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?$.credentials="include":w.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function _(w){if(w.ep)return;w.ep=!0;const $=p(w);fetch(w.href,$)}})();function vt(){}function $i(r){return r()}function Ei(){return Object.create(null)}function sn(r){r.forEach($i)}function Bi(r){return typeof r=="function"}function Gn(r,l){return r!=r?l==l:r!==l||r&&typeof r=="object"||typeof r=="function"}function Fo(r){return Object.keys(r).length===0}const Jo=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function I(r,l){r.appendChild(l)}function We(r,l,p){r.insertBefore(l,p||null)}function De(r){r.parentNode&&r.parentNode.removeChild(r)}function P(r){return document.createElement(r)}function Oi(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function zn(r){return document.createTextNode(r)}function ie(){return zn(" ")}function Nt(r,l,p,_){return r.addEventListener(l,p,_),()=>r.removeEventListener(l,p,_)}function jo(r){return function(l){return l.preventDefault(),r.call(this,l)}}function b(r,l,p){p==null?r.removeAttribute(l):r.getAttribute(l)!==p&&r.setAttribute(l,p)}function qo(r){let l;return{p(...p){l=p,l.forEach(_=>r.push(_))},r(){l.forEach(p=>r.splice(r.indexOf(p),1))}}}function Go(r){return Array.from(r.childNodes)}function zo(r,l){l=""+l,r.data!==l&&(r.data=l)}function zt(r,l){r.value=l??""}class Ko{constructor(l=!1){kt(this,"is_svg",!1);kt(this,"e");kt(this,"n");kt(this,"t");kt(this,"a");this.is_svg=l,this.e=this.n=null}c(l){this.h(l)}m(l,p,_=null){this.e||(this.is_svg?this.e=Oi(p.nodeName):this.e=P(p.nodeType===11?"TEMPLATE":p.nodeName),this.t=p.tagName!=="TEMPLATE"?p:p.content,this.c(l)),this.i(_)}h(l){this.e.innerHTML=l,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(l){for(let p=0;p<this.n.length;p+=1)We(this.t,this.n[p],l)}p(l){this.d(),this.h(l),this.i(this.a)}d(){this.n.forEach(De)}}let rn;function nn(r){rn=r}function Wo(){if(!rn)throw new Error("Function called outside component initialization");return rn}function Yo(r){Wo().$$.on_mount.push(r)}const Gt=[],ki=[];let Kt=[];const _i=[],Xo=Promise.resolve();let Dn=!1;function Zo(){Dn||(Dn=!0,Xo.then(Mi))}function Fn(r){Kt.push(r)}const Un=new Set;let jt=0;function Mi(){if(jt!==0)return;const r=rn;do{try{for(;jt<Gt.length;){const l=Gt[jt];jt++,nn(l),Qo(l.$$)}}catch(l){throw Gt.length=0,jt=0,l}for(nn(null),Gt.length=0,jt=0;ki.length;)ki.pop()();for(let l=0;l<Kt.length;l+=1){const p=Kt[l];Un.has(p)||(Un.add(p),p())}Kt.length=0}while(Gt.length);for(;_i.length;)_i.pop()();Dn=!1,Un.clear(),nn(r)}function Qo(r){if(r.fragment!==null){r.update(),sn(r.before_update);const l=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,l),r.after_update.forEach(Fn)}}function er(r){const l=[],p=[];Kt.forEach(_=>r.indexOf(_)===-1?l.push(_):p.push(_)),p.forEach(_=>_()),Kt=l}const hn=new Set;let tr;function Jn(r,l){r&&r.i&&(hn.delete(r),r.i(l))}function xi(r,l,p,_){if(r&&r.o){if(hn.has(r))return;hn.add(r),tr.c.push(()=>{hn.delete(r)}),r.o(l)}}function Ii(r){r&&r.c()}function jn(r,l,p){const{fragment:_,after_update:w}=r.$$;_&&_.m(l,p),Fn(()=>{const $=r.$$.on_mount.map($i).filter(Bi);r.$$.on_destroy?r.$$.on_destroy.push(...$):sn($),r.$$.on_mount=[]}),w.forEach(Fn)}function qn(r,l){const p=r.$$;p.fragment!==null&&(er(p.after_update),sn(p.on_destroy),p.fragment&&p.fragment.d(l),p.on_destroy=p.fragment=null,p.ctx=[])}function nr(r,l){r.$$.dirty[0]===-1&&(Gt.push(r),Zo(),r.$$.dirty.fill(0)),r.$$.dirty[l/31|0]|=1<<l%31}function Kn(r,l,p,_,w,$,S=null,v=[-1]){const D=rn;nn(r);const K=r.$$={fragment:null,ctx:[],props:$,update:vt,not_equal:w,bound:Ei(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(D?D.$$.context:[])),callbacks:Ei(),dirty:v,skip_bound:!1,root:l.target||D.$$.root};S&&S(K.root);let oe=!1;if(K.ctx=p?p(r,l.props||{},(F,ce,...de)=>{const xe=de.length?de[0]:ce;return K.ctx&&w(K.ctx[F],K.ctx[F]=xe)&&(!K.skip_bound&&K.bound[F]&&K.bound[F](xe),oe&&nr(r,F)),ce}):[],K.update(),oe=!0,sn(K.before_update),K.fragment=_?_(K.ctx):!1,l.target){if(l.hydrate){const F=Go(l.target);K.fragment&&K.fragment.l(F),F.forEach(De)}else K.fragment&&K.fragment.c();l.intro&&Jn(r.$$.fragment),jn(r,l.target,l.anchor),Mi()}nn(D)}class Wn{constructor(){kt(this,"$$");kt(this,"$$set")}$destroy(){qn(this,1),this.$destroy=vt}$on(l,p){if(!Bi(p))return vt;const _=this.$$.callbacks[l]||(this.$$.callbacks[l]=[]);return _.push(p),()=>{const w=_.indexOf(p);w!==-1&&_.splice(w,1)}}$set(l){this.$$set&&!Fo(l)&&(this.$$.skip_bound=!0,this.$$set(l),this.$$.skip_bound=!1)}}const ir="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ir);const Si="blockscape:apicurioConfig",Vn="http://localhost:8080/apis/registry/v3",fn="bs",Ci="-series",Rn=!1,Hn=!1;function or({models:r,getActiveIndex:l,setActive:p,ensureModelMetadata:_,ensureSeriesId:w,getModelId:$,getSeriesId:S,getModelTitle:v,computeJsonFingerprint:D,uid:K}){let oe=null,F=null,ce=null,de=null,xe=null,U=null,J=null,Y=null,V=null,q=null;const _e=new Set,A={baseUrl:Vn,groupId:fn,authToken:"",enabled:Rn,useSemver:Hn},re=new Map,Q=new Map;function ue(s){return(s||"").toString().trim().replace(/\/+$/,"")}function se(s){return`${(s||"").toString().trim()||fn}${Ci}`}function he(){return!!(A.baseUrl&&A.groupId)}function W(){return A.enabled!==!1}function Se(){_e.forEach(s=>{try{s(W())}catch(f){console.warn("[Blockscape] failed to run Apicurio enabled listener",f)}})}function Ge(s){return typeof s=="function"&&_e.add(s),()=>_e.delete(s)}function be(){ce&&(ce.value=A.baseUrl||""),de&&(de.value=A.groupId||""),xe&&(xe.value=A.authToken||""),U&&(U.checked=W()),J&&(J.checked=!!A.useSemver)}function L(s="",f="muted"){Y&&(Y.textContent=s||"",Y.classList.remove("is-error","is-success"),f==="error"?Y.classList.add("is-error"):f==="success"&&Y.classList.add("is-success"))}function pe(s){if(!q||(q.innerHTML="",!s))return;const f=document.createElement("p");f.className="apicurio-hint",f.textContent=s,q.appendChild(f)}function Fe(s){re.clear(),Q.clear(),pe(s)}function $e(){const s=l(),f=W(),y=he(),E=s>=0?r[s]:null,h=!!(E!=null&&E.apicurioVersions&&E.apicurioVersions.length>1);if(oe){const C=oe.dataset.loading==="true",O=f&&y&&s>=0&&!!Ie(r[s]);oe.disabled=!f||C||!O,f?C||(oe.textContent="Push to Apicurio"):oe.textContent="Enable Apicurio to push"}if(V){const C=V.dataset.loading==="true",O=f&&y&&h&&!!Ie(E);V.disabled=!O||C,V.hidden=!h,f?C||(V.textContent="Push series"):V.textContent="Enable Apicurio to push series"}if(F){const C=F.dataset.loading==="true",O=f&&y;F.disabled=!O||C,C||(f?y?F.textContent="List artifacts":F.textContent="Enter details to list":F.textContent="Enable Apicurio to list")}}function x(){be(),W()?he()?(L("Apicurio push is ready when a model is selected.","muted"),re.size||pe("Click “List artifacts” to browse the current group.")):(L("Enter Apicurio connection details to enable push.","muted"),Fe("Enter registry details to browse artifacts.")):(L("Apicurio integration is off. Enable it to allow pushes.","muted"),Fe("Apicurio integration is disabled.")),$e()}function k(){if(window!=null&&window.localStorage)try{localStorage.setItem(Si,JSON.stringify(A))}catch(s){console.warn("[Blockscape] unable to persist Apicurio settings",s)}}function fe(){let s={};if(window!=null&&window.localStorage)try{const C=localStorage.getItem(Si);if(C){const O=JSON.parse(C);O&&typeof O=="object"&&(s=O)}}catch(C){console.warn("[Blockscape] failed to restore Apicurio settings",C)}const f=ue(s.baseUrl??Vn),y=(s.groupId??fn).toString().trim();let E=Rn,h=Hn;typeof s.enabled=="boolean"?E=s.enabled:typeof s.enabled=="string"&&(E=s.enabled==="true"),typeof s.useSemver=="boolean"?h=s.useSemver:typeof s.useSemver=="string"&&(h=s.useSemver==="true"),A.baseUrl=f||Vn,A.groupId=y||fn,A.authToken=(s.authToken??"").toString().trim(),A.enabled=E,A.useSemver=h,x(),Se()}function j(){const s={Accept:"application/json"},f=(A.authToken||"").trim();return f&&(s.Authorization=/\s/.test(f)?f:`Bearer ${f}`),s}function ne(s,f,{title:y,description:E,version:h}={}){const C={artifactId:s,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:f},metadata:{properties:{}}}};h&&(C.firstVersion.version=h),y&&(C.name=y),E&&(C.description=E);try{const O=JSON.parse(f),B=O==null?void 0:O.seriesId;B&&typeof B=="string"&&(C.firstVersion.metadata.properties.seriesId=B)}catch{}return C}function R(s,{version:f}={}){const y={content:{contentType:"application/json",content:s},metadata:{properties:{}}};try{const E=JSON.parse(s),h=E==null?void 0:E.seriesId;h&&typeof h=="string"&&(y.metadata.properties.seriesId=h)}catch{}return f&&(y.version=f),y}function Ae(s){if(s==null)return null;const f=String(s).trim();if(!f)return null;const y=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(f);if(y)return{major:Number(y[1]),minor:Number(y[2]),patch:Number(y[3])};const E=/^v?(\d+)$/.exec(f);return E?{major:Number(E[1]),minor:0,patch:0}:null}function Je(s){return`${s.major}.${s.minor}.${s.patch}`}function Be(s,f){return!s&&!f?0:s?f?s.major!==f.major?s.major-f.major:s.minor!==f.minor?s.minor-f.minor:s.patch-f.patch:1:-1}function Oe(s=[]){let f=null;if(s.forEach(E=>{const h=Ae((E==null?void 0:E.version)??E);h&&(!f||Be(h,f)>0)&&(f=h)}),!f)return"1.0.0";const y={...f,patch:f.patch+1};return Je(y)}function Ie(s,{seriesName:f,fallbackTitle:y}={}){var C;if(!s)return null;const E=f||s.title||s.apicurioArtifactName||v(s),h=y||E;if(typeof w=="function"&&(s.isSeries||((C=s.apicurioVersions)==null?void 0:C.length)>1)&&w(s,{seriesName:E,fallbackTitle:h}),typeof S=="function"){const O=S(s,{seriesName:E,fallbackTitle:h});if(O)return O}return $(s)}function ye(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.artifacts)?s.artifacts:Array.isArray(s==null?void 0:s.items)?s.items:Array.isArray(s==null?void 0:s.results)?s.results:[]}function me(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.versions)?s.versions:Array.isArray(s==null?void 0:s.items)?s.items:[]}function ge(s=[]){if(!Array.isArray(s)||!s.length)return null;const f=[...s].filter(Boolean);return f.sort((y,E)=>{const h=y!=null&&y.createdOn?new Date(y.createdOn).getTime():0,C=E!=null&&E.createdOn?new Date(E.createdOn).getTime():0;if(h!==C)return C-h;const O=Number(y==null?void 0:y.version),B=Number(E==null?void 0:E.version),M=Number.isFinite(O),X=Number.isFinite(B);if(M&&X&&O!==B)return B-O;const G=String((y==null?void 0:y.version)??"");return String((E==null?void 0:E.version)??"").localeCompare(G,void 0,{numeric:!0})}),f[0]||null}function Pe(s){if(!s)return s;let f=s;if(!Array.isArray(s==null?void 0:s.categories)){const E=s==null?void 0:s.content;if(typeof E=="string")try{f=JSON.parse(E)}catch(h){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",h)}else E&&typeof E=="object"&&(f=E)}return f}async function rt(s,f,y){const E=encodeURIComponent(f),h=encodeURIComponent(y),C=`${s}/groups/${E}/artifacts/${h}`,O=j();O.Accept="application/json";const B=await fetch(C,{method:"GET",headers:O});if(!B.ok){let M=B.statusText||"Unknown error";try{const X=await B.text();X&&(M=X.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${B.status}): ${M}`)}return B.json()}async function Ze(s,f,y){const E=encodeURIComponent(f),h=encodeURIComponent(y),C=`${s}/groups/${E}/artifacts/${h}/versions?limit=50&order=desc`,O=j();O.Accept="application/json";const B=await fetch(C,{method:"GET",headers:O});if(!B.ok){let X=B.statusText||"Unknown error";try{const G=await B.text();G&&(X=G.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${B.status}): ${X}`)}const M=await B.json();return me(M).filter(X=>X&&X.version!=null)}async function Me(s,f,y,E="latest"){const h=encodeURIComponent(f),C=encodeURIComponent(y),O=encodeURIComponent(E||"latest"),B=`${s}/groups/${h}/artifacts/${C}/versions/${O}/content`,M=j();M.Accept="application/json, application/*+json, */*;q=0.8";const X=await fetch(B,{method:"GET",headers:M});if(!X.ok){let Ne=X.statusText||"Unknown error";try{const le=await X.text();le&&(Ne=le.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${X.status}): ${Ne}`)}const G=await X.text();let ve=null;try{ve=JSON.parse(G)}catch{throw new Error("Artifact content is not valid JSON.")}return Pe(ve)}async function Le(s,f,y,E="latest"){const h=await Me(s,f,y,E);return{data:h,fingerprint:D(h)}}async function et(s,f,y){try{const h=await Ze(s,f,y);if(h!=null&&h.length){Q.set(y,h);const C=ge(h);if((C==null?void 0:C.version)!=null)return C.version}}catch(h){console.warn("[Blockscape] compare-version: unable to fetch versions list",h)}try{const h=await rt(s,f,y);if((h==null?void 0:h.version)!=null)return h.version}catch(h){console.warn("[Blockscape] compare-version: unable to fetch metadata",h)}const E=Q.get(y);if(E&&E.length){const h=ge(E);if((h==null?void 0:h.version)!=null)return h.version}return"latest"}async function pt(s,f,y,E){if(!A.useSemver)return null;if(!E)return"1.0.0";try{const h=await Ze(s,f,y);return Oe(h)}catch(h){throw new Error(`Unable to compute next semantic version: ${h.message}`)}}function ee(s=document){oe=s.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),V=s.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),F=s.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),ce=s.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),de=s.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),xe=s.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),U=s.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),J=s.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),Y=s.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),q=s.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function Ee(){A.baseUrl=ue((ce==null?void 0:ce.value)??A.baseUrl),A.groupId=((de==null?void 0:de.value)??"").trim(),A.authToken=((xe==null?void 0:xe.value)??"").trim(),k(),x()}function _t(s){A.enabled=s!==!1,k(),x(),Se()}function xt(){_t(U?U.checked:Rn)}function Wt(){A.useSemver=J?J.checked:Hn,k(),x()}function It(){[ce,de,xe].forEach(s=>{s&&s.addEventListener("input",Ee)}),oe&&oe.addEventListener("click",()=>{yn()}),V&&V.addEventListener("click",()=>{ln()}),U&&U.addEventListener("change",xt),J&&J.addEventListener("change",Wt),F&&F.addEventListener("click",En),q&&q.addEventListener("click",s=>{const f=s.target.closest("[data-artifact-version]");if(f){s.stopPropagation();const h=f.dataset.artifactId,C=f.dataset.artifactVersion;h&&C&&Tt(h,C);return}const y=s.target.closest("[data-artifact-load-all]");if(y){s.stopPropagation(),y.dataset.artifactId&&kn();return}const E=s.target.closest("[data-artifact-trigger]");if(E){const h=E.dataset.artifactId;if(!h)return;vn(h)}})}function St(){const s=document.createElement("div");return s.className="blockscape-registry-panel",s.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,s}function Yt(s){if(!s)return;s.innerHTML="";const f=St();s.appendChild(f),ee(s),It(),x()}function gn(s){if(!q)return;if(q.innerHTML="",!s.length){pe("No artifacts found in this group.");return}const f=h=>{const C=document.createElement("section");C.className="apicurio-artifact-section";const O=document.createElement("h3");O.textContent=h,C.appendChild(O);const B=document.createElement("ul");return B.className="apicurio-artifact-list",C.appendChild(B),{section:C,list:B}},y=f("Series artifacts"),E=f("Artifacts");s.forEach(h=>{if(!(h!=null&&h.artifactId))return;const O=h._groupId&&h._groupId.endsWith(Ci)?y.list:E.list,B=document.createElement("li"),M=document.createElement("button");M.type="button",M.className="apicurio-artifact",M.dataset.artifactId=h.artifactId,M.dataset.artifactTrigger="toggle";const X=document.createElement("span");X.className="apicurio-artifact-title",X.textContent=h.artifactId,M.appendChild(X);const G=[];if(h.name&&G.push(h.name),h.version!=null&&G.push(`v${h.version}`),h.type&&G.push(h.type),h._groupId&&G.push(h._groupId),G.length){const le=document.createElement("span");le.className="apicurio-artifact-meta",le.textContent=G.join(" • "),M.appendChild(le)}if(h.description){const le=document.createElement("span");le.className="apicurio-artifact-meta",le.textContent=h.description,M.appendChild(le)}B.appendChild(M);const ve=document.createElement("div");ve.className="apicurio-version-list",ve.dataset.versionPanel=h.artifactId,ve.hidden=!0;const Ne=document.createElement("p");Ne.className="apicurio-hint",Ne.textContent="Click to load the latest or open versions.",ve.appendChild(Ne),B.appendChild(ve),O.appendChild(B)}),y.list.children.length&&q.appendChild(y.section),E.list.children.length&&q.appendChild(E.section)}function an(s){return q?q.querySelector(`[data-version-panel="${s}"]`):null}function lt(s,f){if(!s||(s.innerHTML="",!f))return;const y=document.createElement("p");y.className="apicurio-hint",y.textContent=f,s.appendChild(y)}function bn(s,f){const y=an(s);if(y){if(y.innerHTML="",!f.length){lt(y,"No versions found for this artifact.");return}f.forEach(E=>{const h=document.createElement("button");h.type="button",h.className="apicurio-version-button",h.dataset.artifactId=s,h.dataset.artifactVersion=E.version;const C=[`Version ${E.version}`];if(E.createdOn){const O=new Date(E.createdOn);isNaN(O)||C.push(O.toISOString().slice(0,10))}h.textContent=C.join(" — "),y.appendChild(h)})}}async function vn(s){const f=an(s);if(!f)return;if(f.dataset.open==="true"){f.hidden=!0,f.dataset.open="false";return}if(f.hidden=!1,f.dataset.open="true",f.dataset.loaded!=="true"){if(!he()){lt(f,"Enter registry details first.");return}lt(f,"Loading versions…");try{const E=ue(A.baseUrl),h=re.get(s),C=A.groupId.trim(),O=(h==null?void 0:h._groupId)||C,B=await Ze(E,O,s);Q.set(s,B),f.dataset.loaded="true",bn(s,B)}catch(E){console.error("[Blockscape] failed to load versions",E),lt(f,`Unable to fetch versions: ${E.message}`)}}}function wn(s,f){var E;const y=r.findIndex(h=>h.apicurioArtifactId===s);if(y!==-1){const h=r[y].id;r[y]={...f,id:h||f.id},((E=r[y].apicurioVersions)==null?void 0:E.length)>1&&(r[y].isSeries=!0),p(y)}else r.push(f),p(r.length-1)}async function cn(s,f,y,E){const h=encodeURIComponent(f),C=encodeURIComponent(y),O=`${s}/groups/${h}/artifacts/${C}`;try{const B=await fetch(O,{method:"GET",headers:E});if(B.status===404)return!1;if(B.ok)return!0;throw B.status===401||B.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${B.status} while checking the artifact.`)}catch(B){throw B instanceof TypeError?new Error("Network error while contacting Apicurio registry."):B}}async function yn(){var O;if(!oe||oe.dataset.loading==="true")return;if(!W()){L("Apicurio integration is off. Enable it first.","error");return}if(!he()){L("Enter the registry base URL and group ID before pushing.","error");return}const s=l();if(s<0||!r[s]){L("No active model to push.","error");return}const f=Ie(r[s],{fallbackTitle:v(r[s])});if(!f){L("Active model needs an id before pushing.","error");return}const y=ue(A.baseUrl),E=A.groupId.trim(),h=JSON.stringify(r[s].data,null,2),C=j();oe.dataset.loading="true",oe.textContent="Pushing…",oe.disabled=!0,L("Pushing to Apicurio…","muted");try{const B=await cn(y,E,f,C),M=D(r[s].data);if(B)try{const ke=await et(y,E,f),{data:Ye,fingerprint:ze}=await Le(y,E,f,ke);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",ke),console.log("local fingerprint",M),console.log("registry fingerprint",ze),console.log("local payload",r[s].data),console.log("registry payload",Ye),console.groupEnd(),M&&ze&&M===ze){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){L("Push cancelled (content matches the latest registry version).","muted");return}L("Pushing identical content by user choice.","muted")}else ze?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):L("Unable to compare with registry content (skipping confirmation).","muted")}catch(ke){console.warn("[Blockscape] unable to compare registry content before push",ke),L("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const X=A.useSemver?await pt(y,E,f,B):null;if(A.useSemver&&!X)throw new Error("Semantic versioning is enabled but no version could be computed.");const G=encodeURIComponent(E),ve=encodeURIComponent(f),Ne=B?`${y}/groups/${G}/artifacts/${ve}/versions`:`${y}/groups/${G}/artifacts`,le={...C,"Content-Type":"application/json"};X&&(le["X-Registry-Version"]=X,L(`Pushing to Apicurio as version ${X}…`,"muted"));const st=B?R(h,{version:X}):ne(f,h,{title:v(r[s]),description:(O=r[s].data)==null?void 0:O.abstract,version:X}),Ue=await fetch(Ne,{method:"POST",headers:le,body:JSON.stringify(st)});if(!Ue.ok){let ke=Ue.statusText||"Unknown error";try{const Ye=await Ue.text();Ye&&(ke=Ye.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${Ue.status}): ${ke}`)}let Ve=null;try{Ve=await Ue.json()}catch{Ve=null}const te=(Ve==null?void 0:Ve.version)||(Ve==null?void 0:Ve.globalId)||"",Te=B?"Updated":"Created",tt=te?` (version ${te})`:"";L(`${Te} ${f}${tt}`,"success")}catch(B){console.error("[Blockscape] Apicurio push failed",B),L(`Apicurio push failed: ${B.message}`,"error")}finally{oe.dataset.loading="false",$e()}}async function ln(){var X,G;if(!V||V.dataset.loading==="true")return;if(!W()){L("Apicurio integration is off. Enable it first.","error");return}if(!he()){L("Enter the registry base URL and group ID before pushing.","error");return}const s=l(),f=s>=0?r[s]:null;if(!f||!f.apicurioVersions||f.apicurioVersions.length<2){L("Series push requires a model with multiple versions.","error");return}const y=Ie(f,{seriesName:f.title||f.apicurioArtifactName||v(f)});if(!y){L("Active series needs an id before pushing.","error");return}typeof w=="function"&&w(f,{seriesName:f.title||f.apicurioArtifactName||v(f)});const E=ue(A.baseUrl),h=A.groupId.trim(),C=f.apicurioVersions.map(ve=>ve.data),O=JSON.stringify(C,null,2),B=j(),M=se(h);V.dataset.loading="true",V.textContent="Pushing…",V.disabled=!0,L("Pushing series to Apicurio…","muted");try{const ve=await cn(E,M,y,B),Ne=D(C);if(ve)try{const at=await et(E,M,y),{data:$t,fingerprint:Bt}=await Le(E,M,y,at);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",at),console.log("local fingerprint",Ne),console.log("registry fingerprint",Bt),console.log("local payload (series)",C),console.log("registry payload",$t),console.groupEnd(),Ne&&Bt&&Ne===Bt){if(!window.confirm("The current registry version matches this series. Push anyway?")){L("Series push cancelled (content matches latest).","muted");return}L("Pushing identical series by user choice.","muted")}else Bt?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):L("Unable to compare with registry content (skipping confirmation).","muted")}catch(at){console.warn("[Blockscape] unable to compare registry content before series push",at),L("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const le=A.useSemver?await pt(E,M,y,ve):null;if(A.useSemver&&!le)throw new Error("Semantic versioning is enabled but no version could be computed.");const st=encodeURIComponent(M),Ue=encodeURIComponent(y),Ve=ve?`${E}/groups/${st}/artifacts/${Ue}/versions`:`${E}/groups/${st}/artifacts`,te={...B,"Content-Type":"application/json"};le&&(te["X-Registry-Version"]=le,L(`Pushing series to Apicurio as version ${le}…`,"muted"));const Te=ve?R(O,{version:le}):ne(y,O,{title:f.apicurioArtifactName||((X=f.data)==null?void 0:X.title)||y,description:(G=f.data)==null?void 0:G.abstract,version:le}),tt=await fetch(Ve,{method:"POST",headers:te,body:JSON.stringify(Te)});if(!tt.ok){let at=tt.statusText||"Unknown error";try{const $t=await tt.text();$t&&(at=$t.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${tt.status}): ${at}`)}let ke=null;try{ke=await tt.json()}catch{ke=null}const Ye=(ke==null?void 0:ke.version)||(ke==null?void 0:ke.globalId)||"",ze=ve?"Updated":"Created",ht=Ye?` (version ${Ye})`:"";L(`${ze} ${y} series${ht}`,"success")}catch(ve){console.error("[Blockscape] Apicurio series push failed",ve),L(`Apicurio series push failed: ${ve.message}`,"error")}finally{V.dataset.loading="false",$e()}}async function En(){if(!F||F.dataset.loading==="true")return;if(!W()){L("Enable Apicurio integration to list artifacts.","error");return}if(!he()){L("Enter registry base URL and group ID before listing.","error");return}const s=ue(A.baseUrl),f=A.groupId.trim(),y=se(f),E=[{groupId:f,label:"base"},{groupId:y,label:"series"}];F.dataset.loading="true",F.textContent="Listing…",F.disabled=!0,L("Listing artifacts…","muted"),pe("Contacting registry…");try{const h=j();h.Accept="application/json";const C=[];for(const B of E){const M=encodeURIComponent(B.groupId),X=`${s}/groups/${M}/artifacts?limit=50&offset=0`,G=await fetch(X,{method:"GET",headers:h});if(!G.ok){let le=G.statusText||"Unknown error";try{const st=await G.text();st&&(le=st.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${B.groupId} (${G.status}): ${le}`);continue}const ve=await G.json(),Ne=ye(ve).filter(le=>le&&le.artifactId);Ne.forEach(le=>{le&&(le._groupId=B.groupId)}),C.push(...Ne)}re.clear(),Q.clear(),C.forEach(B=>{B!=null&&B.artifactId&&re.set(B.artifactId,B)}),gn(C);const O=C.length;L(O?`Found ${O} artifact${O===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",O?"success":"muted")}catch(h){console.error("[Blockscape] failed to list artifacts",h),Fe("Unable to list artifacts."),L(`Listing failed: ${h.message}`,"error")}finally{F.dataset.loading="false",$e()}}async function Tt(s,f=null){var ve,Ne,le,st,Ue,Ve;if(!s)return;if(!W()){L("Enable Apicurio integration to load artifacts.","error");return}if(!he()){L("Enter registry connection details before loading artifacts.","error");return}const y=ue(A.baseUrl),E=A.groupId.trim(),h=s&&((ve=re.get(s))==null?void 0:ve._groupId)||E;let C=re.get(s);const O=async()=>{try{const te=await rt(y,h,s);return te!=null&&te.artifactId&&re.set(s,te),te}catch(te){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",te),te}};if(!C)try{C=await O()}catch(te){L(`Failed to fetch artifact metadata: ${te.message}`,"error");return}const B=Q.get(s)||[];let M="latest",X="latest";if(f)M=f,X=f;else{if(!C||C.version==null)try{C=await O()}catch(te){L(`Failed to fetch artifact metadata: ${te.message}`,"error");return}M=(C==null?void 0:C.version)||"latest",X=(C==null?void 0:C.version)||"latest"}const G=B.find(te=>String(te.version)===String(M));(G==null?void 0:G.version)!=null&&(X=G.version),L(`Loading artifact ${s}…`,"muted");try{const te=await Me(y,h,s,M),Te=re.get(s)||C||{},tt=Array.isArray(te);let ke=null;if(tt){const Ye=te.map((ht,at)=>(_(ht,{titleHint:Te.name||s,idHint:s}),{version:String(at+1),data:ht,createdOn:(G==null?void 0:G.createdOn)||Te.createdOn}));ke={id:K(),title:((le=(Ne=Ye[0])==null?void 0:Ne.data)==null?void 0:le.title)||Te.name||s,data:(st=Ye[0])==null?void 0:st.data,apicurioArtifactId:s,apicurioArtifactName:Te.name||"",apicurioVersions:Ye,apicurioActiveVersionIndex:0,isSeries:!0};const ze=((Ue=Te==null?void 0:Te.properties)==null?void 0:Ue.seriesId)||s;typeof w=="function"&&w(ke,{seriesName:ze,fallbackTitle:ze}),L(`Loaded series artifact ${s}.`,"success")}else{_(te,{titleHint:Te.name||s,idHint:s});const Ye={version:X,data:te,createdOn:(G==null?void 0:G.createdOn)||Te.createdOn};ke={id:K(),title:te.title||Te.name||s,data:te,apicurioArtifactId:s,apicurioArtifactName:Te.name||"",apicurioVersions:[Ye],apicurioActiveVersionIndex:0};const ze=(Ve=Te==null?void 0:Te.properties)==null?void 0:Ve.seriesId;ze&&typeof w=="function"&&w(ke,{seriesName:ze,fallbackTitle:ze});const ht=X?` (version ${X})`:"";L(`Loaded artifact ${s}${ht}.`,"success")}wn(s,ke)}catch(te){console.error("[Blockscape] failed to load artifact",te),L(`Failed to load artifact: ${te.message}`,"error")}}async function kn(s){}return{hydrateConfig:fe,mount:Yt,updateAvailability:$e,isEnabled:W,setEnabled:_t,onEnabledChange:Ge}}function qt(r,l){if(typeof r!="function")throw new Error(`[itemEditor] expected ${l} to be a function`)}function rr(r,{excludeId:l}={}){if(!r)return[];const p=r.split(/[\s,]+/).map(w=>w.trim()).filter(Boolean),_=[];return p.forEach(w=>{l&&w===l||_.includes(w)||_.push(w)}),_}function sr(r,l,p){if(!l||!p||l===p)return;((r==null?void 0:r.categories)||[]).forEach(w=>{(w.items||[]).forEach($=>{Array.isArray($.deps)&&($.deps=$.deps.map(S=>S===l?p:S))})}),Array.isArray(r==null?void 0:r.links)&&r.links.forEach(w=>{w.from===l&&(w.from=p),w.to===l&&(w.to=p)})}function ar({findItemAndCategoryById:r,collectAllItemIds:l,updateItemReferences:p,loadActiveIntoEditor:_,rebuildFromActive:w,select:$,onSelectionRenamed:S}={}){qt(r,"findItemAndCategoryById"),qt(l,"collectAllItemIds"),qt(p,"updateItemReferences"),qt(_,"loadActiveIntoEditor"),qt(w,"rebuildFromActive"),qt($,"select");const v={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function D(U){if(v.fields.errorEl){if(!U){v.fields.errorEl.hidden=!0,v.fields.errorEl.textContent="";return}v.fields.errorEl.hidden=!1,v.fields.errorEl.textContent=U}}function K(){v.wrapper&&(v.wrapper.hidden=!0,v.wrapper.setAttribute("aria-hidden","true"),D(""),v.categoryId=null,v.itemId=null,v.modelData=null,document.body.classList.remove("item-editor-open"))}function oe(){v.wrapper&&(v.wrapper.hidden=!1,v.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var U,J;(U=v.fields.nameInput)==null||U.focus(),(J=v.fields.nameInput)==null||J.select()}))}function F(U){var ue;if(!v.modelData||!v.categoryId||!v.itemId)throw new Error("No item loaded.");const Y=(((ue=v.modelData)==null?void 0:ue.categories)||[]).find(se=>se.id===v.categoryId);if(!Y)throw new Error("Category not found.");Y.items=Y.items||[];const V=Y.items.find(se=>se.id===v.itemId);if(!V)throw new Error("Item not found.");const q=(U.id||"").trim();if(!q)throw new Error("ID is required.");const _e=l(v.modelData);if(q!==V.id&&_e.has(q))throw new Error("Another item already uses that ID.");V.id=q;const A=(U.name||"").trim();V.name=A||V.id;const re=(U.logo||"").trim();if(re?V.logo=re:delete V.logo,U.externalFlag&&!U.external)V.external=!0;else{const se=(U.external??"").toString().trim();se?V.external=se:delete V.external}const Q=(U.color||"").trim();return Q?V.color=Q:delete V.color,V.deps=Array.isArray(U.deps)?U.deps:[],V.id!==U.originalId&&typeof S=="function"&&S(U.originalId,V.id),p(v.modelData,U.originalId,V.id),_(),w(),$(V.id),V.id}function ce(){if(!v.fields||!v.fields.idInput)return!1;const U=(v.fields.idInput.value||"").trim(),J={originalId:v.itemId,id:U,name:v.fields.nameInput.value||"",logo:v.fields.logoInput.value||"",external:v.fields.externalInput.value||"",externalFlag:v.fields.externalFlagInput.checked,color:v.fields.colorInput.value||"",deps:rr(v.fields.depsInput.value,{excludeId:U})};try{return F(J),K(),!0}catch(Y){return console.warn("[itemEditor] item edit failed",Y),D((Y==null?void 0:Y.message)||"Unable to save item."),!1}}function de(){if(v.wrapper)return v.wrapper;const U=document.createElement("div");U.className="item-editor-modal",U.hidden=!0,U.setAttribute("role","dialog"),U.setAttribute("aria-modal","true");const J=document.createElement("div");J.className="item-editor-modal__backdrop",U.appendChild(J);const Y=document.createElement("div");Y.className="item-editor",U.appendChild(Y);const V=document.createElement("div");V.className="item-editor__header";const q=document.createElement("h2");q.className="item-editor__title",q.textContent="Edit item";const _e=document.createElement("button");_e.type="button",_e.className="item-editor__close",_e.setAttribute("aria-label","Close item editor"),_e.textContent="×",V.appendChild(q),V.appendChild(_e),Y.appendChild(V);const A=document.createElement("form");A.className="item-editor__form",Y.appendChild(A);const re=document.createElement("div");re.className="item-editor__meta",re.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',A.appendChild(re);const Q=document.createElement("div");Q.className="item-editor__error",Q.hidden=!0,A.appendChild(Q);const ue=(ne,R,Ae)=>{const Je=document.createElement("label");Je.className="item-editor__field";const Be=document.createElement("span");if(Be.className="item-editor__label",Be.textContent=ne,Je.appendChild(Be),R.classList.add("item-editor__control"),Je.appendChild(R),Ae){const Oe=document.createElement("div");Oe.className="item-editor__hint",Oe.textContent=Ae,Je.appendChild(Oe)}return Je},se=document.createElement("input");se.type="text",se.required=!0,A.appendChild(ue("ID",se,"Unique identifier used for links and dependencies."));const he=document.createElement("input");he.type="text",A.appendChild(ue("Name",he,"Visible label shown on the tile."));const W=document.createElement("input");W.type="url",W.inputMode="url",W.placeholder="https://…",A.appendChild(ue("Logo URL",W,"Optional image URL."));const Se=document.createElement("input");Se.type="url",Se.inputMode="url",Se.placeholder="https://…",A.appendChild(ue("External link",Se,"Shown with ↗ icon and in preview."));const Ge=document.createElement("div");Ge.className="item-editor__checkbox";const be=document.createElement("label");be.className="item-editor__checkbox-row";const L=document.createElement("input");L.type="checkbox";const pe=document.createElement("span");pe.textContent="Mark as external without link";const Fe=document.createElement("div");Fe.className="item-editor__hint",Fe.textContent="Keeps dashed border even without a URL.",be.appendChild(L),be.appendChild(pe),Ge.appendChild(be),Ge.appendChild(Fe),A.appendChild(Ge);const $e=document.createElement("input");$e.type="text",$e.placeholder="#2563eb",A.appendChild(ue("Color",$e,"Optional badge color (hex or CSS color)."));const x=document.createElement("textarea");x.rows=2,x.placeholder="Comma or space separated ids",A.appendChild(ue("Dependencies",x,"Use item IDs, separated by commas or spaces."));const k=document.createElement("div");k.className="item-editor__actions";const fe=document.createElement("button");fe.type="button",fe.className="pf-v5-c-button pf-m-tertiary",fe.textContent="Cancel";const j=document.createElement("button");return j.type="submit",j.className="pf-v5-c-button pf-m-primary",j.textContent="Save",k.appendChild(fe),k.appendChild(j),A.appendChild(k),v.wrapper=U,v.fields={idInput:se,nameInput:he,logoInput:W,externalInput:Se,externalFlagInput:L,colorInput:$e,depsInput:x,categoryValue:re.querySelector(".item-editor__meta-value"),errorEl:Q},fe.addEventListener("click",K),_e.addEventListener("click",K),J.addEventListener("click",K),A.addEventListener("submit",ne=>{ne.preventDefault(),ce()}),document.addEventListener("keydown",ne=>{ne.key==="Escape"&&!U.hidden&&(ne.preventDefault(),ne.stopPropagation(),K())}),document.body.appendChild(U),U}function xe(U){const J=r(U);return J?(de(),v.categoryId=J.category.id,v.itemId=J.item.id,v.modelData=J.modelData,v.fields.categoryValue.textContent=J.category.title||J.category.id,v.fields.idInput.value=J.item.id||"",v.fields.nameInput.value=J.item.name||"",v.fields.logoInput.value=J.item.logo||"",v.fields.externalInput.value=typeof J.item.external=="string"?J.item.external:"",v.fields.externalFlagInput.checked=J.item.external===!0,v.fields.colorInput.value=J.item.color||"",v.fields.depsInput.value=Array.isArray(J.item.deps)?J.item.deps.join(", "):"",D(""),$(J.item.id),oe(),!0):!1}return{open:xe,hide:K,isOpen:()=>!!v.wrapper&&!v.wrapper.hidden}}function Ai(r,l="series"){return(r||l).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||l}function on(r,l="series"){const p=Ai(r,l).replace(/\./g,"-");return p.replace(/-series$/i,"").replace(/-+$/,"")||p||Ai(l,"series")}function Pi(r,{seriesName:l,fallbackTitle:p="unknown"}={}){var v,D;const w=[r==null?void 0:r.seriesId,(v=r==null?void 0:r.data)==null?void 0:v.seriesId,r==null?void 0:r.apicurioArtifactId,l,r==null?void 0:r.title,r==null?void 0:r.apicurioArtifactName,(D=r==null?void 0:r.data)==null?void 0:D.title,p].map(K=>(K??"").toString().trim()),$=w.findIndex(Boolean),S=$!==-1?w[$]:"";return S?(console.log("[Series] deriveSeriesId: picked base",{base:S,sourceIndex:$,candidates:w}),on(S,p)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:p}),null)}function ot(r,{seriesName:l,fallbackTitle:p="unknown"}={}){if(!r||typeof r!="object")return null;const _=Pi(r,{seriesName:l,fallbackTitle:p});return _?(r.seriesId=_,r.apicurioArtifactId||(r.apicurioArtifactId=_),_):null}function tn(r,l={}){var w,$;if(!r)return null;const p=r.isSeries||((w=r.apicurioVersions)==null?void 0:w.length)>1||r.seriesId||(($=r.data)==null?void 0:$.seriesId)||r.apicurioArtifactId;if(!p&&!l.force)return null;const _=Pi(r,l);return _||(p?on(l.fallbackTitle||"unknown"):null)}const mn=typeof import.meta<"u"&&"./"||"";function cr(){console.log("[Blockscape] init");const r=document.getElementById("jsonBox"),l=document.querySelector(".blockscape-json-panel"),p=document.getElementById("app"),_=document.getElementById("overlay"),w=document.getElementById("tabTooltip"),$=document.getElementById("modelList"),S=document.getElementById("itemPreview"),v=document.getElementById("urlForm"),D=document.getElementById("urlInput"),K=document.getElementById("loadUrl"),oe=S.querySelector(".item-preview__title"),F=S.querySelector(".item-preview__body"),ce=S.querySelector(".item-preview__actions"),de=S.querySelector(".item-preview__close"),xe=document.getElementById("downloadJson"),U=document.getElementById("shareModel"),J=document.getElementById("createVersion"),Y=document.getElementById("openInEditor"),V=document.getElementById("copyJson"),q=document.getElementById("copySeries"),_e=document.getElementById("pasteJson"),A=document.getElementById("helpButton"),re=document.getElementById("newPanelButton"),Q=document.getElementById("shortcutHelp"),ue=document.getElementById("shortcutHelpList"),se=document.getElementById("shortcutHelpClose"),he=document.getElementById("shortcutHelpBackdrop"),W=document.getElementById("newPanel"),Se=document.getElementById("newPanelClose"),Ge=document.getElementById("newPanelBackdrop"),be=document.getElementById("search"),L=document.getElementById("searchResults"),pe="blockscape:editorPayload",Fe="blockscape:editorTransfer",$e=document.title;r.value=document.getElementById("seed").textContent.trim();let x=[],k=-1;const fe=or({models:x,getActiveIndex:()=>k,setActive:nt,ensureModelMetadata:O,getModelId:G,getSeriesId:tn,ensureSeriesId:ot,getModelTitle:M,computeJsonFingerprint:h,uid:lt});let j=null,ne=new Map,R=null,Ae=null,Je=!0,Be=!1,Oe=0,Ie={x:0,y:0},ye="map",me=null,ge=!1,Pe=null;const rt=2e3;let Ze=null,Me=null,Le=null,et=null,pt=null,ee=null,Ee="",_t=!1,xt=null,Wt=null,It=null,St=[],Yt=null;const gn=30,an=1e3;fe.hydrateConfig();function lt(){return Math.random().toString(36).slice(2,10)}function bn(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function vn(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function wn(e){return bn(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function cn(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),vn(t)}function yn(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}async function ln(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function En(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function Tt(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function kn(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function s(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(c=>c&&typeof c=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function f(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t)}function y(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>y(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${y(e[i])}`).join(",")}}`}function E(e){try{return y(e)}catch{return""}}function h(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=E(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=E(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const C=[{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile."},{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Jump to the previous or next category while keeping position where possible."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Delete"]],description:"Delete the selected item (use Cmd/Ctrl+Z to undo)."},{keys:[["F2"]],description:"Open the item editor for the selected tile."},{keys:[["Escape"]],description:"Close the open preview popover."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."}];function O(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const c=n||e.title||t||"model",a=Tt(c).replace(/\./g,"-");e.id=a||`model-${lt()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function B(e){return JSON.parse(JSON.stringify(e))}function M(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function X(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const o=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(o)return o;const c=G(e);return c?`${c} series`:t}return M(e,t)}function G(e){var o;const t=tn(e);if(t)return t;const n=(o=e==null?void 0:e.data)==null?void 0:o.id;return n&&n.toString().trim()||null}function ve(e){var u;if(e<0||e>=x.length||!r)return!0;const t=x[e],n=(r.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}O(i,{titleHint:M(t),idHint:G(t)});const o=h(t.data),c=h(i);if(o===c)return!0;t.data=i;const a=Pt(t);return a>=0&&((u=t.apicurioVersions)!=null&&u[a])&&(t.apicurioVersions[a].data=i),!0}function Ne(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function le(e){if(k<0||!e)return null;const t=x[k].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const c=(i.items||[]).find(a=>a.id===e);if(c)return{category:i,item:c,modelData:t}}return null}function st(e,t){const n=Ne(t);let i=Tt(e||"item");if(!n.has(i))return i;const o=()=>lt().slice(0,4);for(;n.has(i);)i=`${Tt(e||"item")}-${o()}`;return i}const Ue=ar({findItemAndCategoryById:le,collectAllItemIds:Ne,updateItemReferences:sr,loadActiveIntoEditor:wt,rebuildFromActive:bt,select:e=>Xe(e),onSelectionRenamed:(e,t)=>{var n;R===e&&(R=t),((n=me==null?void 0:me.item)==null?void 0:n.id)===e&&(me.item.id=t)}});function Ve(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const i={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[i],e.apicurioActiveVersionIndex=0;const o=e.title||M(e);return ot(e,{seriesName:o,fallbackTitle:o}),e.isSeries=!0,e}function te(e,{versionLabel:t,createdOn:n}={}){var d,m,g;if(e!=null&&e.isSeries||((d=e==null?void 0:e.apicurioVersions)==null?void 0:d.length)>1){const N=e.title||M(e);ot(e,{seriesName:N,fallbackTitle:N})}const i=G(e);if(!i)return Ve(e,{versionLabel:t||"1",createdOn:n}),x.push(e),x.length-1;const o=x.findIndex(N=>G(N)===i);if(o===-1)return Ve(e,{versionLabel:t||"1",createdOn:n}),x.push(e),x.length-1;const c=x[o];if(!Array.isArray(c.apicurioVersions)||!c.apicurioVersions.length){c.apicurioVersions=[{version:"1",data:c.data,createdOn:(g=(m=c.apicurioVersions)==null?void 0:m[0])==null?void 0:g.createdOn}],c.apicurioActiveVersionIndex=0;const N=c.title||M(c);ot(c,{seriesName:N,fallbackTitle:N})}const a=String(c.apicurioVersions.length+1);c.apicurioVersions.push({version:a,data:e.data,createdOn:n||new Date().toISOString()}),c.apicurioActiveVersionIndex=c.apicurioVersions.length-1,c.data=e.data,c.title=M(e)||c.title,c.isSeries=!0;const u=c.title||M(c);return ot(c,{seriesName:u,fallbackTitle:u}),o}function Te({versionLabel:e}={}){var a;if(k<0||!x[k])throw new Error("Load or select a model before creating a version.");const t=x[k];Ve(t,{versionLabel:"1"});let n;try{n=B(t.data)}catch(u){throw console.warn("[Blockscape] failed to clone active model for versioning",u),new Error("Could not copy the current model.")}O(n,{titleHint:M(t),idHint:G(t)||tn(t)});const o={version:e||String((((a=t.apicurioVersions)==null?void 0:a.length)||0)+1),data:n,createdOn:new Date().toISOString()};t.apicurioVersions.push(o),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=n,t.isSeries=!0;const c=t.title||M(t);return ot(t,{seriesName:c,fallbackTitle:c}),k}function tt(){const e=k>=0&&x[k]?x[k]:null,t=G(e);document.title=t?`${t}-blockscape`:$e}function ke(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||M(e);return ot(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function Ye(){const e=x[k],t=ke(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function ze(e="shortcut",t=!1){const n=r.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=x[k],o=t?ke(i):null,c=!!o,a=c?JSON.stringify(o,null,2):n,u=c&&tn(i)||M(i,"blockscape"),d=c?"-series":"",m=`${Tt(u)}${d}.json`;return yn(m,a),console.log(`[Blockscape] saved JSON (${e}):`,m),!0}const ht={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function at(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return ht[n]||"#9ca3af"}function $t(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(d=>d+d).join(""):t,i=parseInt(n,16),o=i>>16&255,c=i>>8&255,a=i&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(c/255,2.2)+.0722*Math.pow(a/255,2.2)>.35?"#111111":"#ffffff"}function Bt(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function _n(){if(Me)return;Me=document.createElement("div"),Me.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",Le=document.createElement("span"),Le.className="series-nav-notice__text",Me.appendChild(e),Me.appendChild(Le),document.body.appendChild(Me)}function Yn(){et&&(clearTimeout(et),et=null),Me&&Me.classList.remove("is-visible"),Le&&(Le.textContent="")}function dn(){Ze=null,Yn()}function Ui(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function Vi(e,t,n){_n(),Ze={id:e,targetVersionIndex:t};const i=Ui(n,t);xn(`Click again to open ${i} in this series.`)}function xn(e,t=rt,n=null){if(_n(),Le.textContent="",Le.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener",o.textContent=n,Le.appendChild(i),Le.appendChild(o)}Me.classList.add("is-visible"),et&&clearTimeout(et),et=setTimeout(()=>Yn(),t)}function Ri(){ue&&(ue.innerHTML="",C.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((o,c)=>{if(c>0){const u=document.createElement("span");u.className="shortcut-help__or",u.textContent="or",n.appendChild(u)}const a=document.createElement("div");a.className="shortcut-help__combo",o.forEach((u,d)=>{if(d>0){const g=document.createElement("span");g.className="shortcut-help__sep",g.textContent="+",a.appendChild(g)}const m=document.createElement("kbd");m.className="shortcut-help__key",m.textContent=u,a.appendChild(m)}),n.appendChild(a)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),ue.appendChild(t)}),ge=!0)}function Hi(){return!!Q&&Q.hidden===!1}function Di(){if(!Q)return;ge||Ri(),Pe=document.activeElement,Q.hidden=!1,Q.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Q.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function In(){if(!Q||Q.hidden)return;Q.hidden=!0,Q.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=Pe;e!=null&&e.focus?e.focus({preventScroll:!0}):A!=null&&A.focus&&A.focus({preventScroll:!0})}function Fi(){if(!W)return;W.hidden=!1,W.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=W.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Sn(){!W||W.hidden||(W.hidden=!0,W.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),re!=null&&re.focus&&re.focus({preventScroll:!0}))}let Cn=!1;function Xn(){Cn||(Cn=!0,requestAnimationFrame(()=>{Cn=!1,Ln(),Vt()}))}let Zn=!1;function Qn(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Ji(e){const t=Qn(e);if(!t.length){p.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}p.querySelectorAll(".tile").forEach(n=>{var a;const i=(((a=n.querySelector(".name"))==null?void 0:a.textContent)||"").toLowerCase(),o=(n.dataset.id||"").toLowerCase(),c=t.every(u=>i.includes(u)||o.includes(u));n.style.opacity=c?"1":"0.2"})}function ji(e){const t=Qn(e);if(!t.length)return[];const n=[];return x.forEach((i,o)=>{var m;const c=X(i),a=G(i)||"",u=`${c} ${a}`.toLowerCase();t.every(g=>u.includes(g))&&n.push({type:"model",modelIndex:o,modelTitle:c,modelId:a}),(Array.isArray((m=i.data)==null?void 0:m.categories)?i.data.categories:[]).forEach(g=>{const N=(g.title||g.id||"").toString();(g.items||[]).forEach(H=>{const z=(H.name||H.id||"").toString(),we=`${z} ${H.id||""} ${N}`.toLowerCase();t.every(Re=>we.includes(Re))&&n.push({type:"item",modelIndex:o,modelTitle:c,modelId:a,itemId:H.id,itemName:z,categoryTitle:N})})})}),n.slice(0,gn)}function ei(e){if(!L)return;L.innerHTML="";const t=(e||"").toString();if(!t.trim()){L.hidden=!0;return}if(!x.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",L.appendChild(i),L.hidden=!1;return}const n=ji(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",L.appendChild(i),L.hidden=!1;return}n.forEach(i=>{const o=document.createElement("button");o.type="button",o.className="search-result",o.dataset.modelIndex=String(i.modelIndex),i.itemId&&(o.dataset.itemId=i.itemId),i.type&&(o.dataset.type=i.type),i.modelIndex===k&&(!i.itemId||R===i.itemId)&&o.classList.add("is-active");const c=document.createElement("div");c.className="search-result__primary";const a=document.createElement("span");a.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",c.appendChild(a);const u=document.createElement("span");u.className="search-result__badge",u.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",c.appendChild(u);const d=document.createElement("div");d.className="search-result__meta";const m=document.createElement("span");if(m.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,d.appendChild(m),i.type==="item"&&i.itemId){const g=document.createElement("span");g.textContent=`Item ID: ${i.itemId}`,d.appendChild(g)}else if(i.type==="model"){const g=document.createElement("span");g.textContent="Matches model title",d.appendChild(g)}o.appendChild(c),o.appendChild(d),L.appendChild(o)}),L.hidden=!1}function ti(e){Ji(e||""),ei(e||"")}function qi(e){!e||!Number.isInteger(e.modelIndex)||(nt(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(k!==e.modelIndex)return;const t=(n=ne.get(e.itemId))==null?void 0:n.el;t&&(Xe(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function nt(e){if(dt(),dn(),me=null,e<0||e>=x.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}_t=!0,k=e,console.log("[Blockscape] active model:",M(x[e]),"(index",e+" )"),tt(),Ot(),wt(),bt(),be&&ti(be.value||""),fe.updateAvailability()}function Ot(){if($.innerHTML="",!x.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",$.appendChild(e);return}x.forEach((e,t)=>{var N;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===k?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===k?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const c=document.createElement("span");c.className="model-nav-title",c.textContent=X(e),o.appendChild(c);const a=G(e);if(a){const H=document.createElement("span");H.className="model-nav-id",H.textContent=a,o.appendChild(H)}const u=Array.isArray((N=e.data)==null?void 0:N.categories)?e.data.categories:[],d=u.reduce((H,z)=>H+(z.items||[]).length,0),m=document.createElement("span");m.className="model-nav-meta";const g=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";m.textContent=`${u.length} cat · ${d} items${g}`,i.appendChild(o),i.appendChild(m),n.appendChild(i),$.appendChild(n)}),fe.updateAvailability()}function wt(){if(k<0){r.value="",q&&(q.disabled=!0);return}const e=x[k];r.value=JSON.stringify(e.data,null,2),q&&(q.disabled=!ke(e))}function Gi(e){try{return JSON.parse(e)}catch{return null}}function zi(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const o=i.map((g,N)=>!g||typeof g!="object"?null:(O(g,{titleHint:`${t} #${N+1}`}),{obj:g,idx:N})).filter(Boolean);if(!o.length)return[];const c=o[0].obj,{seriesTitleOverride:a}=n;let u=a||c.title||`${t} series`;a&&!c.title&&(c.title=a);const d={id:lt(),title:u,data:c,apicurioVersions:o.map(({obj:g,idx:N})=>({version:String(N+1),data:g})),apicurioActiveVersionIndex:0,isSeries:!0},m=ot(d,{seriesName:u,fallbackTitle:u});return m&&(d.id=m),[d]}function ni(e,t="Pasted",n={}){return Array.isArray(e)?zi(e,t,n):!e||typeof e!="object"?[]:(O(e,{titleHint:`${t} #1`}),[{id:lt(),title:e.title||`${t} #1`,data:e}])}function Ct(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const o=Gi(i);if(o){let a=n;if(Array.isArray(o)&&n.promptForSeriesName){const d=s(o,t),m=kn(d);a={...n,promptForSeriesName:!1,seriesTitleOverride:m||d}}const u=ni(o,t,a);if(u.length)return u}return i.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,u)=>{const d=JSON.parse(a);return O(d,{titleHint:`${t} #${u+1}`}),{id:lt(),title:d.title||`${t} #${u+1}`,data:d}})}function Ki(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function Mt(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!Ki(e)}function Wi(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function ii(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(pe)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(pe)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(pe)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=Ct(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let i=null;return n.forEach(o=>{const c=te(o,{versionLabel:"editor"});i==null&&(i=c)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function oi(e="storage"){const t=ii();return!t||typeof t.index!="number"?!1:(nt(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function Yi(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let i;try{const a=cn(t);i=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=ni(i.data,i.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let c=null;return o.forEach(a=>{const u=a.isSeries?i.title||a.title:null,d=te({...a,apicurioArtifactName:u||a.apicurioArtifactName},{versionLabel:"shared"});c==null&&(c=d)}),c}async function Xi(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await $n(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function Zi(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(c=>(c.items||[]).forEach(a=>{i.add(a.id);const u=new Set(a.deps||[]);(e.links||[]).forEach(d=>{d.from===a.id&&u.add(d.to)}),t.set(a.id,u),u.forEach(d=>{n.has(d)||n.set(d,new Set),n.get(d).add(a.id)})}));const o=new Set;return n.forEach((c,a)=>{((c==null?void 0:c.size)||0)>=2&&o.add(a)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:i}}function Qi(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const o=n.getContext("2d"),c=(e||"?").charAt(0).toUpperCase(),a=at(e,t),u=$t(a);return o.fillStyle=a,o.beginPath(),o.arc(i/2,i/2,i/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=u,o.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(c,i/2,i/2),n.toDataURL("image/png")}function Pt(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function ri(e){const t=Pt(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function eo(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var a,u;const o=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();o&&t.set(o,i);const c=(((u=n==null?void 0:n.data)==null?void 0:u.seriesId)??"").toString().trim();c&&!t.has(c)&&t.set(c,i)}),t}const si=new WeakMap;function to(e,t){var ut;if(!((ut=e==null?void 0:e.apicurioVersions)!=null&&ut[t]))return null;const n=e.apicurioVersions[t],i=n.data,o=h(i),c=si.get(n);if(c&&c.fingerprint===o)return c.dataUrl;const a=160,u=90,d=document.createElement("canvas");d.width=a,d.height=u;const m=d.getContext("2d");m.fillStyle="#f8fafc",m.fillRect(0,0,a,u),m.strokeStyle="#e5e7eb",m.strokeRect(.5,.5,a-1,u-1);const g=Array.isArray(i==null?void 0:i.categories)?i.categories:[],N=Math.max(g.length,1),H=a/N,z=8,we=8,Re=4;g.forEach((Qe,Et)=>{const Dt=Et*H+H/2,ft=Array.isArray(Qe.items)?Qe.items:[],He=Math.max(ft.length,1);ft.forEach((Ft,gi)=>{const Bn=z+(gi+.5)*((u-z-we)/He);m.beginPath(),m.arc(Dt,Bn,Re,0,Math.PI*2);const Qt=at(Ft.name||Ft.id||"",Ft.color);m.fillStyle=Qt,m.strokeStyle="rgba(15,23,42,0.25)",m.fill(),m.stroke()})});const Ke=d.toDataURL("image/png");return si.set(n,{fingerprint:o,dataUrl:Ke}),Ke}function An(e,t){var u;if(dn(),e<0||e>=x.length)return!1;const n=x[e];if(!((u=n==null?void 0:n.apicurioVersions)!=null&&u.length)||!ve(e))return!1;const o=n.apicurioVersions.length,c=(t%o+o)%o,a=n.apicurioVersions[c];return a!=null&&a.data?(n.apicurioActiveVersionIndex=c,n.data=a.data,_t=!0,R=null,Ae=null,wt(),bt(),!0):!1}function ai(e){var i;if(!e||k<0)return;const t=x[k];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return;const n=Pt(t);n!==-1&&An(k,n+e)}function no(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||G(e)||"Artifact",t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const o=Pt(e),c=ri(e)||"latest";i.textContent=`No. in series ${c} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const a=document.createElement("div");a.className="version-nav__controls";const u=document.createElement("button");u.type="button",u.className="version-nav__button",u.textContent="Previous",u.addEventListener("click",()=>ai(-1));const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Next",d.addEventListener("click",()=>ai(1)),a.appendChild(u),a.appendChild(d),t.appendChild(a);const m=document.createElement("div");m.className="version-nav__thumbs",e.apicurioVersions.forEach((H,z)=>{var Dt;const we=document.createElement("button");we.type="button",we.className="version-nav__thumb",z===o&&we.classList.add("is-active");const Re=to(e,z);if(Re){const ft=document.createElement("img");ft.src=Re,ft.alt=`Version ${z+1}`,we.appendChild(ft)}const Ke=document.createElement("div");Ke.className="version-nav__thumb-label";const ut=document.createElement("span");ut.className="version-nav__thumb-label-text";const Qe=(((Dt=H==null?void 0:H.data)==null?void 0:Dt.id)??(H==null?void 0:H.id)??"").toString().trim(),Et=Qe||(H!=null&&H.version?`v${H.version}`:`${z+1}`);ut.textContent=Et,Ke.title=Qe||Et,Ke.appendChild(ut),we.appendChild(Ke),so(Ke,ut),we.addEventListener("click",()=>An(k,z)),co(we,H),m.appendChild(we)});const g=document.createElement("button");g.type="button",g.className="version-nav__thumb version-nav__thumb--add",g.title="Create a new version from this map",g.addEventListener("click",()=>{try{const H=Te({versionLabel:"manual"});nt(H)}catch(H){alert((H==null?void 0:H.message)||"Unable to create a new version right now.")}});const N=document.createElement("span");return N.className="version-nav__thumb-add-icon",N.textContent="+",g.appendChild(N),m.appendChild(g),t.appendChild(m),t}function Ut(){var vi,wi,yi;if(!j)return;gt(),Array.isArray(j.m.categories)||(j.m.categories=[]),console.log("[Blockscape] rendering categories=",j.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!j.m.abstract,"- value:",j.m.abstract?j.m.abstract.substring(0,50)+"...":"none"),p.innerHTML="",ne.clear(),St=[],Ve(x[k],{versionLabel:"1"});const e=no(x[k]);e&&p.appendChild(e),_.setAttribute("width",window.innerWidth),_.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=j.m.title&&j.m.title.trim()||M(x[k]),t.appendChild(n),((vi=x[k])!=null&&vi.isSeries||(yi=(wi=x[k])==null?void 0:wi.apicurioVersions)!=null&&yi.length)&&ot(x[k],{seriesName:x[k].title||j.m.title||M(x[k])});const i=ri(x[k]),o=tn(x[k]),c=(j.m.id??"").toString().trim(),a=document.createElement("div");a.className="blockscape-model-meta__details";const u=(T,ae)=>{if(!ae)return;const Z=document.createElement("div");Z.className="blockscape-model-id";const je=document.createElement("span");je.className="blockscape-model-id__label",je.textContent=T;const it=document.createElement("span");it.className="blockscape-model-id__value",it.textContent=ae,Z.append(je,it),a.appendChild(Z)};u("Series ID",o),u("Model ID",c),u("No. in series",i),a.childElementCount&&t.appendChild(a),p.appendChild(t);const d=document.createElement("div");d.className="blockscape-tabs";const m=document.createElement("div");m.className="blockscape-tablist",m.setAttribute("role","tablist"),d.appendChild(m);const g=document.createElement("div");g.className="blockscape-tabpanels",d.appendChild(g);const N=document.createElement("div"),H=document.createElement("div"),z=document.createElement("div"),we=document.createElement("div");let Re="";const Ke=eo(x[k]),ut=Pt(x[k]);ee=null,Ee="";const Qe=[{id:"map",label:"Map",panel:N},{id:"abstract",label:"Info",panel:H},{id:"source",label:"Settings",panel:z},{id:"apicurio",label:"Apicurio",panel:we}],Et=typeof fe.isEnabled=="function"?fe.isEnabled():!1,Dt=T=>{if(!_)return;const ae=T==="map";_.hidden=!ae,ae?(Ln(),Vt()):_.innerHTML=""};Qe.forEach((T,ae)=>{const Z=document.createElement("button");Z.type="button",Z.id=`tab-${T.id}`,Z.className="blockscape-tab"+(ae===0?" is-active":""),Z.setAttribute("role","tab"),Z.setAttribute("aria-controls",`panel-${T.id}`),Z.setAttribute("aria-selected",ae===0?"true":"false"),Z.textContent=T.label,T.id==="apicurio"&&!Et&&(Z.hidden=!0,Z.tabIndex=-1,Z.setAttribute("aria-hidden","true"),Z.style.display="none"),T.button=Z,m.appendChild(Z),T.panel.id=`panel-${T.id}`,T.panel.classList.add("blockscape-tabpanel"),T.panel.setAttribute("role","tabpanel"),T.panel.setAttribute("aria-labelledby",Z.id),T.panel.hidden=ae!==0,ae===0&&T.panel.classList.add("is-active"),g.appendChild(T.panel)});const ft=T=>{ye=T,Qe.forEach(ae=>{const Z=ae.id===T;ae.button.classList.toggle("is-active",Z),ae.button.setAttribute("aria-selected",Z?"true":"false"),ae.panel.classList.toggle("is-active",Z),ae.panel.hidden=!Z}),Dt(T)},He=Qe.find(T=>T.id==="apicurio"),Ft=T=>{if(!He||!He.button||!He.panel)return;const ae=!!T;if(He.button.hidden=!ae,He.button.tabIndex=ae?0:-1,He.button.setAttribute("aria-hidden",ae?"false":"true"),He.button.style.display=ae?"":"none",ae){const Z=ye==="apicurio";He.button.classList.toggle("is-active",Z),He.button.setAttribute("aria-selected",Z?"true":"false"),He.panel.classList.toggle("is-active",Z),He.panel.hidden=!Z}else{const Z=He.panel.classList.contains("is-active");if(He.button.classList.remove("is-active"),He.button.setAttribute("aria-selected","false"),He.panel.classList.remove("is-active"),He.panel.hidden=!0,Z){const je=Qe.find(it=>it.id!=="apicurio");je&&ft(je.id)}}Wt&&(Wt.checked=ae)};Qe.forEach(T=>{T.button.addEventListener("click",()=>{gt(),ft(T.id)}),T.id==="abstract"&&(ee=T.button,T.button.addEventListener("mouseenter",()=>Xt(T.button,Re,{offset:12})),T.button.addEventListener("mouseleave",gt),T.button.addEventListener("focus",()=>Xt(T.button,Re,{offset:12})),T.button.addEventListener("blur",gt))});const Bn=(T=>{const ae=Qe.find(je=>je.id===ye);if(ae&&(ae.id!=="apicurio"||T))return ae.id;const Z=Qe.find(je=>je.id!=="apicurio"||T);return(Z==null?void 0:Z.id)||Qe[0].id})(Et);ft(Bn),Ft(Et),typeof fe.onEnabledChange=="function"&&fe.onEnabledChange(Ft),p.appendChild(d);const Qt=document.createElement("div");Qt.className="blockscape-render",N.appendChild(Qt);const pn=document.createElement("div");if(pn.className="blockscape-abstract-panel",j.m.abstract){console.log("[Blockscape] Rendering abstract content");const T=document.createElement("div");T.className="blockscape-abstract",T.innerHTML=j.m.abstract,No(T),pn.appendChild(T),Re=T.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const T=document.createElement("div");T.className="blockscape-abstract-placeholder",T.textContent="No abstract has been provided for this model.",pn.appendChild(T),Re=T.outerHTML}Ee=Re,H.appendChild(pn);const en=document.createElement("div");en.className="blockscape-source-panel";const Jt=document.createElement("div");Jt.className="blockscape-settings-panel";const On=document.createElement("p");On.className="blockscape-settings-panel__title",On.textContent="Feature toggles",Jt.appendChild(On);const Mn=({id:T,label:ae,hint:Z,checked:je,className:it="",onChange:qe})=>{const mt=document.createElement("label");mt.className=["settings-toggle",it].filter(Boolean).join(" ");const Ce=document.createElement("input");Ce.type="checkbox",Ce.id=T,Ce.checked=je;const ct=document.createElement("span");ct.className="settings-toggle__text";const At=document.createElement("span");if(At.className="settings-toggle__label",At.textContent=ae,ct.appendChild(At),Z){const Lt=document.createElement("span");Lt.className="settings-toggle__hint",Lt.textContent=Z,ct.appendChild(Lt)}return mt.appendChild(Ce),mt.appendChild(ct),typeof qe=="function"&&Ce.addEventListener("change",()=>qe(Ce.checked)),{row:mt,input:Ce}},{row:Oo}=Mn({id:"toggleSecondaryLinks",label:"Show indirect links",checked:Je,className:"map-controls__toggle",onChange:T=>{Je=T,R?Xe(R):(Tn(),Vt())}});Jt.appendChild(Oo);const{row:Mo}=Mn({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:Be,className:"map-controls__toggle",onChange:T=>{Be=T,li()}});Jt.appendChild(Mo);const Po=typeof fe.isEnabled=="function"?fe.isEnabled():!1,{row:Uo,input:Vo}=Mn({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:Po,className:"apicurio-toggle",onChange:T=>{typeof fe.setEnabled=="function"&&fe.setEnabled(T)}});if(Wt=Vo,Jt.appendChild(Uo),en.appendChild(Jt),l)l.hidden=!1,l.classList.remove("pf-v5-c-page__main-section"),en.appendChild(l);else{const T=document.createElement("p");T.className="muted",T.textContent="Source editor unavailable.",en.appendChild(T)}z.appendChild(en),fe.mount(we);let bi=0;j.m.categories.forEach(T=>{const ae=document.createElement("section");ae.className="category",ae.dataset.cat=T.id;const Z=document.createElement("div");Z.className="cat-head",Z.innerHTML=`<div class="cat-title">${Rt(T.title||T.id)}</div>
                          <div class="muted cat-count">${(T.items||[]).length} items</div>`,ae.appendChild(Z);const je=document.createElement("div");je.className="grid",ae.appendChild(je),(T.items||[]).forEach(qe=>{bi+=1;const mt=oo(qe.external),Ce=document.createElement("div");if(Ce.className=mt.isExternal?"tile external":"tile",Ce.tabIndex=0,Ce.dataset.id=qe.id,Ce.dataset.globalIndex=String(bi),mt.url&&(Ce.dataset.externalUrl=mt.url),Ke.has(qe.id)){const Pn=Ke.get(qe.id);Ce.dataset.seriesVersionIndex=String(Pn),Ce.classList.add("tile--series-link");const Ro=Pn===ut?"Current map in this series":`Open version ${Pn+1} in this series`;Ce.title=Ro}const ct=document.createElement("img");ct.className="logo",qe.logo?(ct.src=qe.logo,ct.alt=qe.name||qe.id):(ct.alt="",ct.style.opacity=1,ct.src=Qi(qe.name||qe.id,qe.color));const At=document.createElement("div");At.className="name",At.textContent=qe.name||qe.id;const Lt=document.createElement("div");Lt.className="badge",Lt.textContent="reused",mt.url&&Ce.appendChild(ro(mt.url)),Ce.appendChild(ct),Ce.appendChild(At),Ce.appendChild(Lt),je.appendChild(Ce),ne.set(qe.id,{el:Ce,catId:T.id,rect:null})}),Qt.appendChild(ae);const it=document.createElement("button");it.type="button",it.className="tile-add",it.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',it.addEventListener("click",()=>yo(T.id)),je.appendChild(it)}),li(),io(),Ln(),Vt(),lo()}function io(){p.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",t=>{var m;if(typeof t.button=="number"&&t.button!==0)return;dt();const n=e.dataset.id,i=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,o=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,c=x[k],a=c?Pt(c):-1,u=((m=c==null?void 0:c.apicurioVersions)==null?void 0:m.length)>1&&Number.isInteger(i)&&i!==a,d=Ze&&Ze.id===n&&Ze.targetVersionIndex===i;if(Ze&&!d&&dn(),u)if(d){if(dn(),An(k,i))return}else Vi(n,i,c);else Number.isInteger(o)&&o>0&&o%5===0&&xn("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",n),R===n&&!(u&&d)){Nn();return}Xe(n)}),e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e.click())}),e.draggable=!0,e.addEventListener("dragstart",mo),e.addEventListener("dragend",ho)}),p.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",go),e.addEventListener("drop",wo),e.addEventListener("dragenter",bo),e.addEventListener("dragleave",vo)}),Zn||(Zn=!0,window.addEventListener("resize",Xn),window.addEventListener("scroll",Xn,{passive:!0}),window.addEventListener("resize",ui)),document.getElementById("clear").onclick=()=>Nn()}function Ln(){ne.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function ci(e,{includeSecondary:t=Je}={}){if(!e||!j)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(j.fwd.get(e)||[]),i=new Set(j.rev.get(e)||[]),o=new Set,c=new Set,a=[],u=new Set,d=(m,g,N,H)=>{if(!m||!g)return;const z=`${m}->${g}:${N}:${H}`;u.has(z)||(u.add(z),a.push({from:m,to:g,type:N,depth:H}))};return n.forEach(m=>d(e,m,"dep",1)),i.forEach(m=>d(e,m,"revdep",1)),t&&new Set([...n,...i]).forEach(g=>{(j.fwd.get(g)||new Set).forEach(z=>{const we=z===e;we||o.add(z),we||d(g,z,"dep",2)}),(j.rev.get(g)||new Set).forEach(z=>{const we=z===e;we||c.add(z),we||d(g,z,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:o,secondaryRevs:c,edges:a}}function un(e,t){const n=ne.get(e);n&&n.el.classList.add(t)}function Xe(e){var u,d,m;R=e,Ae=ci(e),Tn();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:o}=Ae;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const c=ne.get(e);c&&c.el.classList.add("selected"),t.forEach(g=>un(g,"dep")),n.forEach(g=>un(g,"revdep")),i.forEach(g=>{!t.has(g)&&g!==e&&un(g,"dep-indirect")}),o.forEach(g=>{!n.has(g)&&!t.has(g)&&g!==e&&un(g,"revdep-indirect")}),Vt();const a=(m=(d=(u=ne.get(e))==null?void 0:u.el)==null?void 0:d.dataset)==null?void 0:m.externalUrl;a&&xn("This item has link to",rt,a)}function Nn(){R=null,Ae=null,Tn(),Vt()}function Tn(){p.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function li(){j!=null&&j.reusedLocal&&j.reusedLocal.forEach(e=>{const t=ne.get(e);if(!t)return;t.el.classList.toggle("reused",Be);const n=t.el.querySelector(".badge");n&&(n.style.display=Be?"inline-block":"none")})}function Vt(){for(;_.firstChild;)_.removeChild(_.firstChild);if(!R||_.hidden)return;Ae=ci(R),Ae.edges.forEach(t=>{var N,H;const n=(N=ne.get(t.from))==null?void 0:N.rect,i=(H=ne.get(t.to))==null?void 0:H.rect;if(!n||!i)return;const o=di(n),c=di(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),u=(o.x+c.x)/2,d=o.y,m=(o.x+c.x)/2,g=c.y;a.setAttribute("d",`M ${o.x},${o.y} C ${u},${d} ${m},${g} ${c.x},${c.y}`),a.setAttribute("fill","none"),a.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),a.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),a.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&a.setAttribute("stroke-dasharray","4 3"),a.setAttribute("vector-effect","non-scaling-stroke"),_.appendChild(a)})}function di(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function Rt(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function oo(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function ro(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function ui(){Yt||(Yt=requestAnimationFrame(()=>{Yt=null,St=St.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),St.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function so(e,t){!e||!t||(St.push({labelEl:e,textEl:t}),ui())}function ao(e,t){var c,a;const n=[`<div class="version-nav__tooltip-title">${Rt(t)}</div>`],i=((e==null?void 0:e.version)??((c=e==null?void 0:e.data)==null?void 0:c.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${Rt(i)}</div>`);const o=(((a=e==null?void 0:e.data)==null?void 0:a.abstract)??"").toString().trim();return o?n.push(`<div class="version-nav__tooltip-body">${o}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function Xt(e,t,{offset:n=8}={}){!w||!e||!t||(w.innerHTML=t,w.hidden=!1,w.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),o=w.getBoundingClientRect(),c=window.scrollX||document.documentElement.scrollLeft,a=window.scrollY||document.documentElement.scrollTop;let u=i.left+i.width/2-o.width/2+c,d=i.top-o.height-n+a;u<c+n&&(u=c+n);const m=c+window.innerWidth-o.width-n;u>m&&(u=m),d<a+n&&(d=i.bottom+n+a),w.style.left=`${u}px`,w.style.top=`${d}px`,w.classList.add("is-visible")}))}function gt(){pt&&(clearTimeout(pt),pt=null),w&&(w.classList.remove("is-visible"),w.setAttribute("aria-hidden","true"),w.hidden=!0)}function co(e,t){if(!e)return;const n=M((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=ao(t,n);let o=null;const c=()=>{o&&(clearTimeout(o),o=null)},a=()=>{It=e,Xt(e,`<div class="version-nav__tooltip-title">${Rt(n)}</div>`,{offset:10})},u=()=>{c(),o=setTimeout(()=>{It===e&&Xt(e,i,{offset:10})},an)},d=()=>{a(),u()},m=()=>{It!==e&&a(),u()},g=()=>{c(),It===e&&(It=null,gt())};e.addEventListener("mouseenter",d),e.addEventListener("focus",d),e.addEventListener("pointermove",m),e.addEventListener("mouseleave",g),e.addEventListener("blur",g),e.addEventListener("click",g)}function lo(){_t&&(_t=!1,!(!ee||!Ee)&&(gt(),Xt(ee,Ee,{offset:12}),pt=setTimeout(()=>{gt(),uo()},1e3)))}function uo(){ee&&(xt&&(clearTimeout(xt),xt=null),ee.classList.add("blockscape-tab--twinkle"),xt=setTimeout(()=>{ee.classList.remove("blockscape-tab--twinkle"),xt=null},1400))}window.addEventListener("scroll",gt,!0),window.addEventListener("resize",gt);function dt(){S&&(S.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),S.setAttribute("aria-hidden","true"),S.hidden=!0,pi([]))}function po(e,t){S&&(Ie={x:e,y:t},S.hidden=!1,S.setAttribute("aria-hidden","false"),S.classList.add("is-visible"),Ht(e,t))}function Ht(e,t){if(!S)return;const n=12;S.style.left=`${e+n}px`,S.style.top=`${t+n}px`;const i=S.getBoundingClientRect();let o=i.left,c=i.top;i.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(c=Math.max(n,window.innerHeight-i.height-n)),S.style.left=`${o}px`,S.style.top=`${c}px`}function pi(e=[]){ce&&(ce.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),ce.appendChild(n)}),ce.hidden=e.length===0)}async function fo(e,t){var m;if(!S)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((m=t.querySelector(".name"))==null?void 0:m.textContent)||n||"Preview",o=n?`${n}.html`:"",c=o?`items/${o}`:"",a=++Oe,u=t.dataset.externalUrl||"",d=[{label:"Edit",title:"Edit this item",onClick:()=>{dt(),Ue.open(n)}}];if(u&&d.push({label:"Open link ↗",title:u,onClick:()=>window.open(u,"_blank","noopener")}),pi(d),n&&Xe(n),oe.textContent=i,F.innerHTML='<div class="item-preview__status">Loading…</div>',S.classList.remove("item-preview--has-frame"),S.classList.add("item-preview--expanded"),po(e.clientX,e.clientY),!c){F.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',Ht(Ie.x,Ie.y);return}try{const g=await fetch(c,{cache:"no-cache"});if(!g.ok)throw new Error(`HTTP ${g.status}`);const N=await g.text();if(a!==Oe)return;if(!N.trim()){F.innerHTML=`<div class="item-preview__status">No content in <code>${Rt(o)}</code>.</div>`,Ht(Ie.x,Ie.y);return}const z=document.createElement("iframe");z.className="item-preview__frame",z.title=`${i} details`,z.srcdoc=N,F.innerHTML="",F.appendChild(z),S.classList.add("item-preview--has-frame"),Ht(Ie.x,Ie.y)}catch(g){if(a!==Oe)return;F.innerHTML=`<div class="item-preview__status">No preview available for <strong>${Rt(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${c}`,g),Ht(Ie.x,Ie.y)}}de&&de.addEventListener("click",dt),A&&A.addEventListener("click",()=>{Di()}),re&&re.addEventListener("click",()=>{Fi()}),se&&se.addEventListener("click",In),he&&he.addEventListener("click",In),Se&&Se.addEventListener("click",Sn),Ge&&Ge.addEventListener("click",Sn),p&&p.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!p.contains(t)||fo(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!S||S.hidden||S.contains(e.target)||dt()}),xe&&xe.addEventListener("click",()=>{ze("button")}),J&&J.addEventListener("click",()=>{if(k<0){alert("Load or select a model before creating a version.");return}try{const e=Te({versionLabel:"map edit"});nt(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),U&&U.addEventListener("click",async()=>{var c;if(k<0||!x[k]){alert("Select or load a model before sharing.");return}const e={title:M(x[k],"Shared Model"),data:x[k].data};let t;try{t=wn(JSON.stringify(e))}catch(a){console.error("[Blockscape] share encode failed",a),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(a){console.warn("[Blockscape] failed to update URL for share",a),window.location.hash=n.hash}let o=!1;if((c=navigator.clipboard)!=null&&c.writeText)try{await navigator.clipboard.writeText(i),o=!0}catch(a){console.warn("[Blockscape] clipboard write failed",a)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),Y&&Y.addEventListener("click",()=>{const e=(r.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};R&&(n.selectedItemId=R),localStorage.setItem(pe,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";R&&(t=`editor.html?selected=${encodeURIComponent(R)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==pe||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||oi("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===Fe&&oi("message")})),document.addEventListener("keydown",e=>{var n,i,o,c,a,u;if(Hi()){e.key==="Escape"&&(e.preventDefault(),In());return}if(!(W!=null&&W.hidden)&&e.key==="Escape"){e.preventDefault(),Sn();return}if(!((n=Ue==null?void 0:Ue.isOpen)!=null&&n.call(Ue))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const d=x[k],m=((i=d==null?void 0:d.apicurioVersions)==null?void 0:i.length)>1;ze("shortcut",m);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!Mt())return;if(Io()){e.preventDefault();return}}if(e.key==="Escape"&&S&&!S.hidden&&dt(),e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!Mt()||e.altKey||e.ctrlKey||e.metaKey)return;const d=e.key==="ArrowLeft"?-1:1;e.shiftKey?Eo(d)&&e.preventDefault():ko(d)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!Mt()||e.altKey||e.ctrlKey||e.metaKey)return;const d=e.key==="ArrowUp"?-1:1;e.shiftKey?xo(d)&&e.preventDefault():_o(d)&&e.preventDefault()}if(e.key==="Delete"){if(!Mt()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;So()&&e.preventDefault()}if(e.key==="F2"){if(!Mt())return;const d=R||((u=(a=(c=(o=e.target)==null?void 0:o.closest)==null?void 0:c.call(o,".tile"))==null?void 0:a.dataset)==null?void 0:u.id);d&&Ue.open(d)&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!S||S.hidden||Ht(Ie.x,Ie.y)}),window.addEventListener("scroll",()=>{!S||S.hidden||dt()},!0);let yt=null,Zt=null;function mo(e){dt(),yt=e.target.dataset.id,Zt=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:yt,categoryId:Zt})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",yt,"from",Zt)}function ho(e){e.target.classList.remove("dragging"),p.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),p.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),yt=null,Zt=null}function go(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function bo(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function vo(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function wo(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!yt||!i)return;const c=Array.from(t.querySelectorAll(".tile")).filter(a=>a.dataset.id!==yt).find(a=>{const u=a.getBoundingClientRect();return e.clientY<u.top+u.height/2});fi(yt,c?c.dataset.id:null,i),Ut(),console.log("[Blockscape] drop completed",yt,"from",Zt,"to",i)}function fi(e,t,n){if(k<0)return;const o=x[k].data.categories||[],c=o.find(g=>(g.items||[]).some(N=>N.id===e)),a=o.find(g=>g.id===n);if(!c||!a)return;c.items=c.items||[],a.items=a.items||[];const u=c.items.findIndex(g=>g.id===e);if(u===-1)return;const[d]=c.items.splice(u,1);let m=a.items.length;if(t){const g=a.items.findIndex(N=>N.id===t);g!==-1&&(m=g)}a.items.splice(m,0,d),wt(),bt()}function yo(e){if(k<0||!e)return;const t=x[k].data,i=(t.categories||[]).find(d=>d.id===e);if(!i)return;i.items=i.items||[];const o=`New item ${i.items.length+1}`,a={id:st(`${e}-${i.items.length+1}`,t),name:o,deps:[]};i.items.push(a),wt(),bt(),dt(),Xe(a.id);const u=ne.get(a.id);u!=null&&u.el&&u.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",a.id,"to",e)}function Eo(e){if(!R||k<0||!e)return!1;const n=x[k].data.categories||[],i=ne.get(R);let o=null;if(i!=null&&i.catId&&(o=n.find(d=>d.id===i.catId)),o||(o=n.find(d=>(d.items||[]).some(m=>m.id===R))),!o)return!1;o.items=o.items||[];const c=o.items.findIndex(d=>d.id===R);if(c===-1)return!1;const a=c+e;if(a<0||a>=o.items.length)return!1;const[u]=o.items.splice(c,1);return o.items.splice(a,0,u),wt(),bt(),Ut(),Xe(R),!0}function ko(e){if(!j||!j.m||!e)return!1;const t=j.m.categories||[];if(!t.length)return!1;const n=()=>{const d=t.find(m=>(m.items||[]).length);return d?{category:d,item:d.items[0]}:null};if(!R){const d=n();return d?(Xe(d.item.id),!0):!1}const i=ne.get(R);let o=null;if(i!=null&&i.catId&&(o=t.find(d=>d.id===i.catId)),o||(o=t.find(d=>(d.items||[]).some(m=>m.id===R))),!o){const d=n();return d?(Xe(d.item.id),!0):!1}const c=o.items||[];if(!c.length)return!1;const a=c.findIndex(d=>d.id===R);if(a===-1)return!1;const u=a+e;return u<0||u>=c.length?!1:(Xe(c[u].id),!0)}function _o(e){if(!j||!j.m||!e)return!1;const t=j.m.categories||[];if(!t.length)return!1;const n=()=>{for(const d of t)if(d.items&&d.items.length)return d.items[0].id;return null};let o=(()=>{if(!R)return-1;const d=ne.get(R);if(d!=null&&d.catId){const m=t.findIndex(g=>g.id===d.catId);if(m!==-1)return m}return t.findIndex(m=>(m.items||[]).some(g=>g.id===R))})();if(o===-1){const d=n();return d?(Xe(d),!0):!1}let a=(t[o].items||[]).findIndex(d=>d.id===R);a===-1&&(a=0);let u=o+e;for(;u>=0&&u<t.length;){const m=t[u].items||[];if(m.length){const g=Math.min(m.length-1,Math.max(0,a));return Xe(m[g].id),!0}u+=e>0?1:-1}return!1}function xo(e){if(!R||k<0||!e)return!1;const n=x[k].data.categories||[];if(!n.length)return!1;const i=ne.get(R);let o=-1;if(i!=null&&i.catId&&(o=n.findIndex(N=>N.id===i.catId)),o===-1&&(o=n.findIndex(N=>(N.items||[]).some(H=>H.id===R))),o===-1)return!1;const c=o+e;if(c<0||c>=n.length)return!1;const a=n[o],u=n[c];if(!u)return!1;a.items=a.items||[],u.items=u.items||[];const d=a.items.findIndex(N=>N.id===R);if(d===-1)return!1;const m=Math.min(u.items.length,Math.max(0,d)),g=m<u.items.length?u.items[m].id:null;return fi(R,g,u.id),Ut(),Xe(R),!0}function Io(){if(!me||k<0)return!1;const e=x[k];if(!e||e.id!==me.modelId)return!1;const t=me,o=(e.data.categories||[]).find(a=>a.id===t.categoryId);if(!o)return!1;o.items=o.items||[];const c=Math.min(Math.max(t.index,0),o.items.length);return o.items.splice(c,0,t.item),me=null,dt(),R=null,Ae=null,wt(),bt(),Ut(),Xe(t.item.id),console.log("[Blockscape] undo delete restored",t.item.id),!0}function So(){if(!R||k<0)return!1;const t=x[k].data.categories||[];if(!t.length)return!1;const n=ne.get(R);let i=null;if(n!=null&&n.catId&&(i=t.find(m=>m.id===n.catId)),i||(i=t.find(m=>(m.items||[]).some(g=>g.id===R))),!i||!Array.isArray(i.items))return!1;const o=i.items.findIndex(m=>m.id===R);if(o===-1)return!1;const c=i.items.splice(o,1)[0];if(!c)return!1;const a=x[k];me={item:c,categoryId:i.id,index:o,modelId:a?a.id:null};const d=(()=>{var g;if(i.items.length){const N=Math.min(o,i.items.length-1);return((g=i.items[N])==null?void 0:g.id)||null}const m=t.findIndex(N=>N.id===i.id);if(m===-1)return null;for(let N=m+1;N<t.length;N++){const H=t[N].items||[];if(H.length)return H[0].id}for(let N=m-1;N>=0;N--){const H=t[N].items||[];if(H.length)return H[0].id}return null})();return dt(),R=null,Ae=null,wt(),bt(),Ut(),d?Xe(d):Nn(),console.log("[Blockscape] removed item",c.id),!0}V&&V.addEventListener("click",async()=>{const e=r.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await ln(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),q&&q.addEventListener("click",async()=>{const e=Ye();if(!e){alert("No series available to copy. Create another version first.");return}await ln(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),_e&&_e.addEventListener("click",async()=>{try{const e=await En();if(!e){alert("Clipboard is empty.");return}r.value=e,r.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=Ct(r.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const o=te(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=o)}),k===-1&&t!=null?nt(t):Ot()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(k<0){alert("No active model selected.");return}try{const t=JSON.parse(r.value);if(O(t,{titleHint:M(x[k]),idHint:G(x[k])||M(x[k])}),x[k].data=t,x[k].title=t.title||x[k].title,x[k].isSeries||((e=x[k].apicurioVersions)==null?void 0:e.length)>1){const n=x[k].title||M(x[k]);ot(x[k],{seriesName:n,fallbackTitle:n})}tt(),console.log("[Blockscape] replaced active model:",M(x[k])),bt(),fe.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const o=await i.text(),c=i.name.replace(/\.[^.]+$/,"")||"File",a=Ct(o,c,{seriesTitleOverride:`${c} series`});if(!a.length){console.warn("[Blockscape] no models in file:",i.name);continue}a.forEach((u,d)=>{var Re;const m=(((Re=u.data)==null?void 0:Re.title)??"").toString().trim(),g=a.length>1?`${i.name} #${d+1}`:i.name,N=`${c} series`,H=u.isSeries?N:null;let z={...u};if(u.isSeries){const Ke=H||m||u.title||g||"unknown";z.title=Ke;const ut=on(Ke||"unknown");f(z,ut),ot(z,{seriesName:Ke,fallbackTitle:"unknown"}),z.apicurioArtifactName=z.apicurioArtifactName||Ke}else z.title=m||g;const we=te({...z,apicurioArtifactName:z.apicurioArtifactName||H||z.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=we)})}k===-1&&n!=null?nt(n):Ot()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",Co);function Co(e){var o;if(!Mt())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Wi(t))return;let n=[];try{n=Ct(t,"Clipboard",{promptForSeriesName:!0})}catch(c){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",c);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((c,a)=>{const u=te(c,{versionLabel:n.length>1?`paste #${a+1}`:"paste"});i==null&&(i=u)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&nt(i)}$.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(Bt(),nt(n))}),document.getElementById("removeModel").onclick=()=>{if(k<0)return;const e=M(x[k]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",M(x[k])),x.splice(k,1),!x.length){k=-1,j=null,p.innerHTML="",_.innerHTML="",r.value="",Ot(),tt();return}const n=Math.min(k,x.length-1);nt(n)},be&&(be.addEventListener("input",e=>{ti(e.target.value||"")}),be.addEventListener("focus",()=>{be.value&&be.value.trim()&&ei(be.value)})),L&&L.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;qi({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!L||L.hidden)return;const t=e.target;L.contains(t)||be&&(t===be||be.contains(t))||(L.hidden=!0)}),v&&D&&K&&v.addEventListener("submit",async e=>{e.preventDefault();const t=D.value.trim();if(!t){alert("Please enter a URL"),D.focus();return}const n=await $n(t);if(typeof n=="number"){nt(n),D.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!D||!t)return;let n=null;D.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=D.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function bt(){if(!(k<0))try{j=Zi(x[k].data),Ut()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function Ao(){const e=["comms.bs","planets.bs","styleguide.bs"],t=n=>mn?mn.endsWith("/")?`${mn}${n}`:`${mn}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const o=await i.text(),c=n.replace(/\.[^.]+$/,"")||"Model",a=Ct(o,c,{seriesTitleOverride:`${c} series`});if(!a.length){console.warn("[Blockscape] no models found in",n);continue}a.forEach(u=>{let d={...u};if(u.isSeries){const m=`${c} series`;d={...u,title:m,apicurioArtifactName:m};const g=on(m||"unknown");f(d,g),ot(d,{seriesName:m,fallbackTitle:"unknown"})}te(d,{versionLabel:n})}),console.log(`[Blockscape] loaded ${a.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}Ot()}async function Lo(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const o=await fetch(e,i);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function No(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>To(i)),e.querySelectorAll("a[href]").forEach(i=>{const o=i.getAttribute("href");hi(o)&&mi(i,o)})}function To(e){var u,d;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(d=(u=e.parentNode)==null?void 0:u.closest)!=null&&d.call(u,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let o;for(;(o=n.exec(t))!==null;)i.push({url:o[0],index:o.index});if(!i.length)return;const c=document.createDocumentFragment();let a=0;i.forEach(({url:m,index:g})=>{g>a&&c.appendChild(document.createTextNode(t.slice(a,g))),c.appendChild($o(m)),a=g+m.length}),a<t.length&&c.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(c,e)}function $o(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",hi(e)&&mi(t,e),t}function mi(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>Bo(n,t,e)))}async function Bo(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await $n(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function hi(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function $n(e){try{console.log("[Blockscape] loading from URL:",e);const t=await Lo(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=Ct(t,i)}catch(a){throw new Error(`Invalid JSON payload: ${a.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let c=null;return o.forEach((a,u)=>{var z;const d=(((z=a.data)==null?void 0:z.title)??"").toString().trim(),m=o.length>1?`${i} #${u+1}`:i,g=a.isSeries?`${i} series`:null;let N={...a};if(a.isSeries){const we=g||d||N.title||m;N={...a,title:we,apicurioArtifactName:we||a.apicurioArtifactName};const Re=on(we||"unknown");f(N,Re),ot(N,{seriesName:we||g||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:Re,url:e,baseName:i,seriesTitle:we})}const H=te({...N,title:d||N.title||m,apicurioArtifactName:N.apicurioArtifactName||g||a.apicurioArtifactName},{versionLabel:i});c==null&&(c=H)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,i),k===-1&&c!=null?nt(c):Ot(),c}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=Ct(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let o=null;i.forEach(g=>{const N=te(g,{versionLabel:"seed"});o==null&&(o=N)}),await Ao();const c=await Xi(),a=ii(),u=a==null?void 0:a.index,d=Yi();nt(typeof c=="number"?c:typeof d=="number"?d:typeof u=="number"?u:o??0)})()}function lr(r){let l;return{c(){l=P("div"),l.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',b(l,"id","shortcutHelp"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","shortcutHelpTitle")},m(p,_){We(p,l,_)},p:vt,i:vt,o:vt,d(p){p&&De(l)}}}class dr extends Wn{constructor(l){super(),Kn(this,l,null,lr,Gn,{})}}const ur=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function Li(r){let l,p,_,w,$,S,v,D;return{c(){l=P("div"),p=P("div"),_=P("a"),w=zn("Open Blockscape GPT"),$=ie(),S=P("div"),S.textContent="Paste the copied prompt into that chat.",v=ie(),D=P("div"),D.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',b(_,"href",fr),b(_,"target","_blank"),b(_,"rel","noreferrer"),b(S,"class","new-panel__hint"),b(p,"class","new-panel__link"),b(D,"class","new-panel__link new-panel__link--disabled"),b(l,"class","new-panel__links")},m(K,oe){We(K,l,oe),I(l,p),I(p,_),I(_,w),I(p,$),I(p,S),I(l,v),I(l,D)},p:vt,d(K){K&&De(l)}}}function Ni(r){let l,p,_,w,$,S;return{c(){l=P("div"),p=P("div"),p.textContent="Generated prompt",_=ie(),w=P("textarea"),b(p,"class","new-panel__prompt-label"),b(w,"class","pf-v5-c-form-control new-panel__textarea"),b(w,"rows","4"),w.readOnly=!0,b(l,"class","new-panel__prompt")},m(v,D){We(v,l,D),I(l,p),I(l,_),I(l,w),zt(w,r[4]),$||(S=Nt(w,"input",r[12]),$=!0)},p(v,D){D&16&&zt(w,v[4])},d(v){v&&De(l),$=!1,S()}}}function pr(r){let l,p,_,w,$,S,v,D,K,oe,F,ce,de,xe,U,J,Y,V,q,_e,A,re,Q,ue,se,he,W,Se,Ge,be,L,pe,Fe,$e,x,k,fe,j,ne,R,Ae,Je,Be,Oe,Ie,ye=r[2]==="gpt"&&Li(),me=r[4]&&r[5]&&Ni(r);return Be=qo(r[10][0]),{c(){l=P("div"),p=P("div"),_=ie(),w=P("div"),$=P("div"),$.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',S=ie(),v=P("form"),D=P("div"),K=P("label"),K.textContent="Domain",oe=ie(),F=P("p"),F.textContent="Describe what you want to create a map for.",ce=ie(),de=P("textarea"),xe=ie(),U=P("div"),J=P("label"),Y=P("input"),V=ie(),q=P("span"),q.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,_e=ie(),A=P("fieldset"),re=P("legend"),re.textContent="Target",Q=ie(),ue=P("p"),ue.textContent="Choose where you plan to use the prompt.",se=ie(),he=P("label"),W=P("input"),Se=ie(),Ge=P("div"),Ge.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',be=ie(),L=P("label"),pe=P("input"),Fe=ie(),$e=P("div"),$e.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',x=ie(),k=P("div"),fe=P("button"),fe.textContent="Copy prompt",j=ie(),ne=P("div"),R=zn(r[3]),Ae=ie(),ye&&ye.c(),Je=ie(),me&&me.c(),b(p,"id","newPanelBackdrop"),b(p,"class","shortcut-help__backdrop"),b($,"class","shortcut-help__header"),b(K,"for","newDomain"),b(F,"class","new-panel__hint"),b(de,"id","newDomain"),b(de,"class","pf-v5-c-form-control new-panel__textarea"),b(de,"rows","4"),de.required=!0,b(de,"placeholder","Ex: Companies building open-source geospatial tools"),b(D,"class","new-panel__field"),b(Y,"id","seriesToggle"),b(Y,"type","checkbox"),b(J,"class","new-panel__toggle"),b(J,"for","seriesToggle"),b(U,"class","new-panel__field"),b(ue,"class","new-panel__hint"),b(W,"type","radio"),b(W,"name","target"),W.__value="gpt",zt(W,W.__value),b(he,"class","new-panel__option"),b(pe,"type","radio"),b(pe,"name","target"),pe.__value="plain",zt(pe,pe.__value),b(L,"class","new-panel__option"),b(A,"class","new-panel__field"),b(fe,"class","pf-v5-c-button pf-m-primary"),b(fe,"type","submit"),b(ne,"class","new-panel__status"),b(ne,"aria-live","polite"),b(k,"class","new-panel__actions"),b(v,"class","shortcut-help__list new-panel__form"),b(w,"class","shortcut-help__panel"),b(w,"tabindex","-1"),b(l,"id","newPanel"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","newPanelTitle"),Be.p(W,pe)},m(ge,Pe){We(ge,l,Pe),I(l,p),I(l,_),I(l,w),I(w,$),I(w,S),I(w,v),I(v,D),I(D,K),I(D,oe),I(D,F),I(D,ce),I(D,de),zt(de,r[0]),I(v,xe),I(v,U),I(U,J),I(J,Y),Y.checked=r[1],I(J,V),I(J,q),I(v,_e),I(v,A),I(A,re),I(A,Q),I(A,ue),I(A,se),I(A,he),I(he,W),W.checked=W.__value===r[2],I(he,Se),I(he,Ge),I(A,be),I(A,L),I(L,pe),pe.checked=pe.__value===r[2],I(L,Fe),I(L,$e),I(v,x),I(v,k),I(k,fe),I(k,j),I(k,ne),I(ne,R),I(v,Ae),ye&&ye.m(v,null),I(v,Je),me&&me.m(v,null),Oe||(Ie=[Nt(de,"input",r[7]),Nt(Y,"change",r[8]),Nt(W,"change",r[9]),Nt(pe,"change",r[11]),Nt(v,"submit",jo(r[6]))],Oe=!0)},p(ge,[Pe]){Pe&1&&zt(de,ge[0]),Pe&2&&(Y.checked=ge[1]),Pe&4&&(W.checked=W.__value===ge[2]),Pe&4&&(pe.checked=pe.__value===ge[2]),Pe&8&&zo(R,ge[3]),ge[2]==="gpt"?ye?ye.p(ge,Pe):(ye=Li(),ye.c(),ye.m(v,Je)):ye&&(ye.d(1),ye=null),ge[4]&&ge[5]?me?me.p(ge,Pe):(me=Ni(ge),me.c(),me.m(v,null)):me&&(me.d(1),me=null)},i:vt,o:vt,d(ge){ge&&De(l),ye&&ye.d(),me&&me.d(),Be.r(),Oe=!1,sn(Ie)}}}const fr="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function mr(r,l,p){let _="",w=!1,$="gpt",S="",v="",D=!1;const K=()=>{var V;return typeof navigator<"u"&&!!((V=navigator.clipboard)!=null&&V.writeText)};function oe(V){const q=V||"[DOMAIN]",_e=w?"series":"map",re=ur.replaceAll("[DOMAIN NAME]",q).replaceAll("[DOMAIN]",q).replaceAll("[map|series]",_e).split(`
`),Q=`Generate a **blockscape ${_e}** for the domain of ${q}.`,ue=re.findIndex(he=>he.toLowerCase().includes("generate a **blockscape value")||he.toLowerCase().includes("generate a blockscape [map|series]")||he.toLowerCase().startsWith("generate a blockscape"));ue>=0?re[ue]=Q:re.unshift(Q);const se=w?`

User requested a series (return an array of models).`:"";return`${re.join(`
`).trim()}${se}`}async function F(V){V.preventDefault();const q=_.trim();if(p(3,S=""),p(5,D=$!=="gpt"),!q){p(3,S="Add a domain to generate a prompt."),p(4,v="");return}if($==="gpt"?p(4,v=`${w?"Create a series":"Create a map"} for ${q}`):(p(4,v=oe(q)),p(5,D=!0)),!K()){p(3,S="Clipboard access is unavailable. Copy the prompt below."),p(5,D=!0);return}try{await navigator.clipboard.writeText(v),p(3,S=$==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),$==="gpt"&&p(5,D=!1)}catch(A){console.warn("[Blockscape] clipboard write failed",A),p(3,S="Copy failed. Use the prompt below."),p(5,D=!0)}}const ce=[[]];function de(){_=this.value,p(0,_)}function xe(){w=this.checked,p(1,w)}function U(){$=this.__value,p(2,$)}function J(){$=this.__value,p(2,$)}function Y(){v=this.value,p(4,v)}return[_,w,$,S,v,D,F,de,xe,U,ce,J,Y]}class hr extends Wn{constructor(l){super(),Kn(this,l,mr,pr,Gn,{})}}const{document:Ti}=Jo;function gr(r){let l,p,_,w,$,S,v,D,K,oe,F,ce,de,xe,U,J,Y,V,q,_e,A,re,Q,ue,se,he,W,Se,Ge,be,L,pe,Fe,$e,x,k,fe,j,ne,R,Ae,Je=`<script id="seed" type="application/json">${r[1]}<\/script>`,Be,Oe,Ie,ye,me,ge,Pe,rt,Ze,Me,Le,et,pt;return rt=new dr({}),Me=new hr({}),{c(){l=P("link"),p=ie(),_=P("div"),w=P("header"),$=P("div"),S=P("div"),v=P("div"),D=P("div"),D.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',K=ie(),oe=P("div"),F=P("div"),ce=P("button"),de=P("span"),de.textContent="Toggle search and edit tools",xe=ie(),U=P("span"),U.textContent="▾",J=ie(),Y=P("button"),Y.textContent="New",V=ie(),q=P("form"),q.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',_e=ie(),A=P("label"),A.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',re=ie(),Q=P("button"),Q.textContent="Help",ue=ie(),se=P("div"),he=P("div"),he.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',W=ie(),Se=P("button"),Se.textContent="Edit",Ge=ie(),be=P("button"),be.textContent="Share",$e=ie(),x=P("div"),x.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',k=ie(),fe=P("main"),fe.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,j=ie(),ne=P("footer"),ne.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',R=ie(),Ae=new Ko(!1),Be=ie(),Oe=Oi("svg"),Ie=ie(),ye=P("div"),me=ie(),ge=P("div"),ge.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',Pe=ie(),Ii(rt.$$.fragment),Ze=ie(),Ii(Me.$$.fragment),Ti.title="Blockscape — simple landscape-style tiles",b(l,"rel","icon"),b(l,"type","image/svg+xml"),b(l,"href","./favicon.svg"),b(D,"class","blockscape-brand"),b(de,"class","sr-only"),b(U,"class","blockscape-toolbar__toggle-icon"),b(U,"aria-hidden","true"),b(ce,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),b(ce,"type","button"),b(ce,"aria-expanded",r[0]),b(ce,"aria-controls","blockscapeHeaderExtras"),b(Y,"id","newPanelButton"),b(Y,"class","pf-v5-c-button pf-m-primary"),b(Y,"type","button"),b(Y,"title","Create something new"),b(q,"id","urlForm"),b(q,"class","blockscape-url-form"),b(q,"autocomplete","on"),q.noValidate=!0,b(A,"class","pf-v5-c-button pf-m-primary blockscape-file"),b(Q,"id","helpButton"),b(Q,"class","pf-v5-c-button pf-m-primary"),b(Q,"type","button"),b(Q,"title","Show keyboard shortcuts"),b(F,"class","blockscape-toolbar__primary"),b(he,"class","blockscape-search"),b(Se,"id","openInEditor"),b(Se,"class","pf-v5-c-button pf-m-secondary"),b(Se,"type","button"),b(Se,"title","Open current JSON in the editor"),b(be,"id","shareModel"),b(be,"class","pf-v5-c-button pf-m-secondary"),b(be,"type","button"),b(be,"title","Copy a shareable URL for this model"),b(se,"id","blockscapeHeaderExtras"),b(se,"class","blockscape-toolbar__extras"),se.hidden=L=!r[0],b(se,"aria-hidden",pe=!r[0]),b(oe,"class","blockscape-toolbar__controls"),b(oe,"data-expanded",Fe=r[0]?"true":"false"),b(x,"class","blockscape-legend"),b(x,"role","presentation"),b(v,"class","blockscape-toolbar"),b(S,"class","pf-v5-c-masthead__content"),b($,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),b(w,"class","pf-v5-c-page__header"),b(fe,"class","pf-v5-c-page__main"),b(ne,"class","pf-v5-c-page__footer blockscape-footer"),b(_,"class","pf-v5-c-page"),Ae.a=Be,b(Oe,"id","overlay"),b(Oe,"class","svg-layer"),b(ye,"id","tabTooltip"),b(ye,"class","blockscape-tab-tooltip"),ye.hidden=!0,b(ye,"aria-hidden","true"),b(ge,"id","itemPreview"),b(ge,"class","item-preview"),ge.hidden=!0,b(ge,"aria-hidden","true")},m(ee,Ee){I(Ti.head,l),We(ee,p,Ee),We(ee,_,Ee),I(_,w),I(w,$),I($,S),I(S,v),I(v,D),I(v,K),I(v,oe),I(oe,F),I(F,ce),I(ce,de),I(ce,xe),I(ce,U),I(F,J),I(F,Y),I(F,V),I(F,q),I(F,_e),I(F,A),I(F,re),I(F,Q),I(oe,ue),I(oe,se),I(se,he),I(se,W),I(se,Se),I(se,Ge),I(se,be),I(v,$e),I(v,x),I(_,k),I(_,fe),I(_,j),I(_,ne),We(ee,R,Ee),Ae.m(Je,ee,Ee),We(ee,Be,Ee),We(ee,Oe,Ee),We(ee,Ie,Ee),We(ee,ye,Ee),We(ee,me,Ee),We(ee,ge,Ee),We(ee,Pe,Ee),jn(rt,ee,Ee),We(ee,Ze,Ee),jn(Me,ee,Ee),Le=!0,et||(pt=Nt(ce,"click",r[2]),et=!0)},p(ee,[Ee]){(!Le||Ee&1)&&b(ce,"aria-expanded",ee[0]),(!Le||Ee&1&&L!==(L=!ee[0]))&&(se.hidden=L),(!Le||Ee&1&&pe!==(pe=!ee[0]))&&b(se,"aria-hidden",pe),(!Le||Ee&1&&Fe!==(Fe=ee[0]?"true":"false"))&&b(oe,"data-expanded",Fe)},i(ee){Le||(Jn(rt.$$.fragment,ee),Jn(Me.$$.fragment,ee),Le=!0)},o(ee){xi(rt.$$.fragment,ee),xi(Me.$$.fragment,ee),Le=!1},d(ee){ee&&(De(p),De(_),De(R),Ae.d(),De(Be),De(Oe),De(Ie),De(ye),De(me),De(ge),De(Pe),De(Ze)),De(l),qn(rt,ee),qn(Me,ee),et=!1,pt()}}}function br(r,l,p){const _=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let w=!1;const $=()=>{if(p(0,w=!w),!w){const S=document.getElementById("search");S&&S.value&&(S.value="",S.dispatchEvent(new Event("input",{bubbles:!0})))}};return Yo(()=>{cr()}),[w,_,$]}class vr extends Wn{constructor(l){super(),Kn(this,l,br,gr,Gn,{})}}const wr=document.getElementById("root");new vr({target:wr});
