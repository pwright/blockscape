var Ba=Object.defineProperty;var $a=(s,l,u)=>l in s?Ba(s,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[l]=u;var Gt=(s,l,u)=>$a(s,typeof l!="symbol"?l+"":l,u);(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))I(E);new MutationObserver(E=>{for(const V of E)if(V.type==="childList")for(const T of V.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&I(T)}).observe(document,{childList:!0,subtree:!0});function u(E){const V={};return E.integrity&&(V.integrity=E.integrity),E.referrerPolicy&&(V.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?V.credentials="include":E.crossOrigin==="anonymous"?V.credentials="omit":V.credentials="same-origin",V}function I(E){if(E.ep)return;E.ep=!0;const V=u(E);fetch(E.href,V)}})();function Ht(){}function kr(s){return s()}function fr(){return Object.create(null)}function Xn(s){s.forEach(kr)}function Ir(s){return typeof s=="function"}function wo(s,l){return s!=s?l==l:s!==l||s&&typeof s=="object"||typeof s=="function"}function Oa(s){return Object.keys(s).length===0}const Ma=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function A(s,l){s.appendChild(l)}function tt(s,l,u){s.insertBefore(l,u||null)}function Ke(s){s.parentNode&&s.parentNode.removeChild(s)}function D(s){return document.createElement(s)}function Cr(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function yo(s){return document.createTextNode(s)}function se(){return yo(" ")}function cn(s,l,u,I){return s.addEventListener(l,u,I),()=>s.removeEventListener(l,u,I)}function Va(s){return function(l){return l.preventDefault(),s.call(this,l)}}function w(s,l,u){u==null?s.removeAttribute(l):s.getAttribute(l)!==u&&s.setAttribute(l,u)}function Ra(s){let l;return{p(...u){l=u,l.forEach(I=>s.push(I))},r(){l.forEach(u=>s.splice(s.indexOf(u),1))}}}function Pa(s){return Array.from(s.childNodes)}function Ua(s,l){l=""+l,s.data!==l&&(s.data=l)}function xn(s,l){s.value=l??""}class Da{constructor(l=!1){Gt(this,"is_svg",!1);Gt(this,"e");Gt(this,"n");Gt(this,"t");Gt(this,"a");this.is_svg=l,this.e=this.n=null}c(l){this.h(l)}m(l,u,I=null){this.e||(this.is_svg?this.e=Cr(u.nodeName):this.e=D(u.nodeType===11?"TEMPLATE":u.nodeName),this.t=u.tagName!=="TEMPLATE"?u:u.content,this.c(l)),this.i(I)}h(l){this.e.innerHTML=l,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(l){for(let u=0;u<this.n.length;u+=1)tt(this.t,this.n[u],l)}p(l){this.d(),this.h(l),this.i(this.a)}d(){this.n.forEach(Ke)}}let Yn;function Kn(s){Yn=s}function Ha(){if(!Yn)throw new Error("Function called outside component initialization");return Yn}function Fa(s){Ha().$$.on_mount.push(s)}const Cn=[],mr=[];let An=[];const hr=[],ja=Promise.resolve();let mo=!1;function Ja(){mo||(mo=!0,ja.then(xr))}function ho(s){An.push(s)}const lo=new Set;let Sn=0;function xr(){if(Sn!==0)return;const s=Yn;do{try{for(;Sn<Cn.length;){const l=Cn[Sn];Sn++,Kn(l),qa(l.$$)}}catch(l){throw Cn.length=0,Sn=0,l}for(Kn(null),Cn.length=0,Sn=0;mr.length;)mr.pop()();for(let l=0;l<An.length;l+=1){const u=An[l];lo.has(u)||(lo.add(u),u())}An.length=0}while(Cn.length);for(;hr.length;)hr.pop()();mo=!1,lo.clear(),Kn(s)}function qa(s){if(s.fragment!==null){s.update(),Xn(s.before_update);const l=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,l),s.after_update.forEach(ho)}}function Wa(s){const l=[],u=[];An.forEach(I=>s.indexOf(I)===-1?l.push(I):u.push(I)),u.forEach(I=>I()),An=l}const yi=new Set;let Ga;function go(s,l){s&&s.i&&(yi.delete(s),s.i(l))}function gr(s,l,u,I){if(s&&s.o){if(yi.has(s))return;yi.add(s),Ga.c.push(()=>{yi.delete(s)}),s.o(l)}}function br(s){s&&s.c()}function bo(s,l,u){const{fragment:I,after_update:E}=s.$$;I&&I.m(l,u),ho(()=>{const V=s.$$.on_mount.map(kr).filter(Ir);s.$$.on_destroy?s.$$.on_destroy.push(...V):Xn(V),s.$$.on_mount=[]}),E.forEach(ho)}function vo(s,l){const u=s.$$;u.fragment!==null&&(Wa(u.after_update),Xn(u.on_destroy),u.fragment&&u.fragment.d(l),u.on_destroy=u.fragment=null,u.ctx=[])}function za(s,l){s.$$.dirty[0]===-1&&(Cn.push(s),Ja(),s.$$.dirty.fill(0)),s.$$.dirty[l/31|0]|=1<<l%31}function Eo(s,l,u,I,E,V,T=null,y=[-1]){const J=Yn;Kn(s);const K=s.$$={fragment:null,ctx:[],props:V,update:Ht,not_equal:E,bound:fr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(J?J.$$.context:[])),callbacks:fr(),dirty:y,skip_bound:!1,root:l.target||J.$$.root};T&&T(K.root);let ae=!1;if(K.ctx=u?u(s,l.props||{},(q,fe,...he)=>{const Ve=he.length?he[0]:fe;return K.ctx&&E(K.ctx[q],K.ctx[q]=Ve)&&(!K.skip_bound&&K.bound[q]&&K.bound[q](Ve),ae&&za(s,q)),fe}):[],K.update(),ae=!0,Xn(K.before_update),K.fragment=I?I(K.ctx):!1,l.target){if(l.hydrate){const q=Pa(l.target);K.fragment&&K.fragment.l(q),q.forEach(Ke)}else K.fragment&&K.fragment.c();l.intro&&go(s.$$.fragment),bo(s,l.target,l.anchor),xr()}Kn(J)}class _o{constructor(){Gt(this,"$$");Gt(this,"$$set")}$destroy(){vo(this,1),this.$destroy=Ht}$on(l,u){if(!Ir(u))return Ht;const I=this.$$.callbacks[l]||(this.$$.callbacks[l]=[]);return I.push(u),()=>{const E=I.indexOf(u);E!==-1&&I.splice(E,1)}}$set(l){this.$$set&&!Oa(l)&&(this.$$.skip_bound=!0,this.$$set(l),this.$$.skip_bound=!1)}}const Ka="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ka);const vr="blockscape:apicurioConfig",uo="http://localhost:8080/apis/registry/v3",vi="bs",wr="-series",po=!1,fo=!1;function Ya({models:s,getActiveIndex:l,setActive:u,ensureModelMetadata:I,ensureSeriesId:E,getModelId:V,getSeriesId:T,getModelTitle:y,computeJsonFingerprint:J,uid:K}){let ae=null,q=null,fe=null,he=null,Ve=null,H=null,W=null,X=null,j=null,G=null;const Le=new Set,B={baseUrl:uo,groupId:vi,authToken:"",enabled:po,useSemver:fo},ce=new Map,ee=new Map;function ge(c){return(c||"").toString().trim().replace(/\/+$/,"")}function le(c){return`${(c||"").toString().trim()||vi}${wr}`}function Ee(){return!!(B.baseUrl&&B.groupId)}function Y(){return B.enabled!==!1}function De(){Le.forEach(c=>{try{c(Y())}catch(f){console.warn("[Blockscape] failed to run Apicurio enabled listener",f)}})}function Qe(c){return typeof c=="function"&&Le.add(c),()=>Le.delete(c)}function Se(){fe&&(fe.value=B.baseUrl||""),he&&(he.value=B.groupId||""),Ve&&(Ve.value=B.authToken||""),H&&(H.checked=Y()),W&&(W.checked=!!B.useSemver)}function $(c="",f="muted"){X&&(X.textContent=c||"",X.classList.remove("is-error","is-success"),f==="error"?X.classList.add("is-error"):f==="success"&&X.classList.add("is-success"))}function be(c){if(!G||(G.innerHTML="",!c))return;const f=document.createElement("p");f.className="apicurio-hint",f.textContent=c,G.appendChild(f)}function Ye(c){ce.clear(),ee.clear(),be(c)}function je(){const c=l(),f=Y(),S=Ee(),_=c>=0?s[c]:null,m=!!(_!=null&&_.apicurioVersions&&_.apicurioVersions.length>1);if(ae){const L=ae.dataset.loading==="true",P=f&&S&&c>=0&&!!nt(s[c]);ae.disabled=!f||L||!P,f?L||(ae.textContent="Push to Apicurio"):ae.textContent="Enable Apicurio to push"}if(j){const L=j.dataset.loading==="true",P=f&&S&&m&&!!nt(_);j.disabled=!P||L,j.hidden=!m,f?L||(j.textContent="Push series"):j.textContent="Enable Apicurio to push series"}if(q){const L=q.dataset.loading==="true",P=f&&S;q.disabled=!P||L,L||(f?S?q.textContent="List artifacts":q.textContent="Enter details to list":q.textContent="Enable Apicurio to list")}}function k(){Se(),Y()?Ee()?($("Apicurio push is ready when a model is selected.","muted"),ce.size||be("Click “List artifacts” to browse the current group.")):($("Enter Apicurio connection details to enable push.","muted"),Ye("Enter registry details to browse artifacts.")):($("Apicurio integration is off. Enable it to allow pushes.","muted"),Ye("Apicurio integration is disabled.")),je()}function v(){if(window!=null&&window.localStorage)try{localStorage.setItem(vr,JSON.stringify(B))}catch(c){console.warn("[Blockscape] unable to persist Apicurio settings",c)}}function ve(){let c={};if(window!=null&&window.localStorage)try{const L=localStorage.getItem(vr);if(L){const P=JSON.parse(L);P&&typeof P=="object"&&(c=P)}}catch(L){console.warn("[Blockscape] failed to restore Apicurio settings",L)}const f=ge(c.baseUrl??uo),S=(c.groupId??vi).toString().trim();let _=po,m=fo;typeof c.enabled=="boolean"?_=c.enabled:typeof c.enabled=="string"&&(_=c.enabled==="true"),typeof c.useSemver=="boolean"?m=c.useSemver:typeof c.useSemver=="string"&&(m=c.useSemver==="true"),B.baseUrl=f||uo,B.groupId=S||vi,B.authToken=(c.authToken??"").toString().trim(),B.enabled=_,B.useSemver=m,k(),De()}function R(){const c={Accept:"application/json"},f=(B.authToken||"").trim();return f&&(c.Authorization=/\s/.test(f)?f:`Bearer ${f}`),c}function ie(c,f,{title:S,description:_,version:m}={}){const L={artifactId:c,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:f},metadata:{properties:{}}}};m&&(L.firstVersion.version=m),S&&(L.name=S),_&&(L.description=_);try{const P=JSON.parse(f),M=P==null?void 0:P.seriesId;M&&typeof M=="string"&&(L.firstVersion.metadata.properties.seriesId=M)}catch{}return L}function Je(c,{version:f}={}){const S={content:{contentType:"application/json",content:c},metadata:{properties:{}}};try{const _=JSON.parse(c),m=_==null?void 0:_.seriesId;m&&typeof m=="string"&&(S.metadata.properties.seriesId=m)}catch{}return f&&(S.version=f),S}function O(c){if(c==null)return null;const f=String(c).trim();if(!f)return null;const S=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(f);if(S)return{major:Number(S[1]),minor:Number(S[2]),patch:Number(S[3])};const _=/^v?(\d+)$/.exec(f);return _?{major:Number(_[1]),minor:0,patch:0}:null}function oe(c){return`${c.major}.${c.minor}.${c.patch}`}function xe(c,f){return!c&&!f?0:c?f?c.major!==f.major?c.major-f.major:c.minor!==f.minor?c.minor-f.minor:c.patch-f.patch:1:-1}function me(c=[]){let f=null;if(c.forEach(_=>{const m=O((_==null?void 0:_.version)??_);m&&(!f||xe(m,f)>0)&&(f=m)}),!f)return"1.0.0";const S={...f,patch:f.patch+1};return oe(S)}function nt(c,{seriesName:f,fallbackTitle:S}={}){var L;if(!c)return null;const _=f||c.title||c.apicurioArtifactName||y(c),m=S||_;if(typeof E=="function"&&(c.isSeries||((L=c.apicurioVersions)==null?void 0:L.length)>1)&&E(c,{seriesName:_,fallbackTitle:m}),typeof T=="function"){const P=T(c,{seriesName:_,fallbackTitle:m});if(P)return P}return V(c)}function ke(c){return Array.isArray(c)?c:Array.isArray(c==null?void 0:c.artifacts)?c.artifacts:Array.isArray(c==null?void 0:c.items)?c.items:Array.isArray(c==null?void 0:c.results)?c.results:[]}function Be(c){return Array.isArray(c)?c:Array.isArray(c==null?void 0:c.versions)?c.versions:Array.isArray(c==null?void 0:c.items)?c.items:[]}function te(c=[]){if(!Array.isArray(c)||!c.length)return null;const f=[...c].filter(Boolean);return f.sort((S,_)=>{const m=S!=null&&S.createdOn?new Date(S.createdOn).getTime():0,L=_!=null&&_.createdOn?new Date(_.createdOn).getTime():0;if(m!==L)return L-m;const P=Number(S==null?void 0:S.version),M=Number(_==null?void 0:_.version),re=Number.isFinite(P),Z=Number.isFinite(M);if(re&&Z&&P!==M)return M-P;const Q=String((S==null?void 0:S.version)??"");return String((_==null?void 0:_.version)??"").localeCompare(Q,void 0,{numeric:!0})}),f[0]||null}function qe(c){if(!c)return c;let f=c;if(!Array.isArray(c==null?void 0:c.categories)){const _=c==null?void 0:c.content;if(typeof _=="string")try{f=JSON.parse(_)}catch(m){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",m)}else _&&typeof _=="object"&&(f=_)}return f}async function Fe(c,f,S){const _=encodeURIComponent(f),m=encodeURIComponent(S),L=`${c}/groups/${_}/artifacts/${m}`,P=R();P.Accept="application/json";const M=await fetch(L,{method:"GET",headers:P});if(!M.ok){let re=M.statusText||"Unknown error";try{const Z=await M.text();Z&&(re=Z.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${M.status}): ${re}`)}return M.json()}async function at(c,f,S){const _=encodeURIComponent(f),m=encodeURIComponent(S),L=`${c}/groups/${_}/artifacts/${m}/versions?limit=50&order=desc`,P=R();P.Accept="application/json";const M=await fetch(L,{method:"GET",headers:P});if(!M.ok){let Z=M.statusText||"Unknown error";try{const Q=await M.text();Q&&(Z=Q.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${M.status}): ${Z}`)}const re=await M.json();return Be(re).filter(Z=>Z&&Z.version!=null)}async function bt(c,f,S,_="latest"){const m=encodeURIComponent(f),L=encodeURIComponent(S),P=encodeURIComponent(_||"latest"),M=`${c}/groups/${m}/artifacts/${L}/versions/${P}/content`,re=R();re.Accept="application/json, application/*+json, */*;q=0.8";const Z=await fetch(M,{method:"GET",headers:re});if(!Z.ok){let He=Z.statusText||"Unknown error";try{const de=await Z.text();de&&(He=de.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${Z.status}): ${He}`)}const Q=await Z.text();let _e=null;try{_e=JSON.parse(Q)}catch{throw new Error("Artifact content is not valid JSON.")}return qe(_e)}async function ct(c,f,S,_="latest"){const m=await bt(c,f,S,_);return{data:m,fingerprint:J(m)}}async function Rt(c,f,S){try{const m=await at(c,f,S);if(m!=null&&m.length){ee.set(S,m);const L=te(m);if((L==null?void 0:L.version)!=null)return L.version}}catch(m){console.warn("[Blockscape] compare-version: unable to fetch versions list",m)}try{const m=await Fe(c,f,S);if((m==null?void 0:m.version)!=null)return m.version}catch(m){console.warn("[Blockscape] compare-version: unable to fetch metadata",m)}const _=ee.get(S);if(_&&_.length){const m=te(_);if((m==null?void 0:m.version)!=null)return m.version}return"latest"}async function vt(c,f,S,_){if(!B.useSemver)return null;if(!_)return"1.0.0";try{const m=await at(c,f,S);return me(m)}catch(m){throw new Error(`Unable to compute next semantic version: ${m.message}`)}}function ne(c=document){ae=c.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),j=c.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),q=c.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),fe=c.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),he=c.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),Ve=c.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),H=c.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),W=c.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),X=c.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),G=c.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function we(){B.baseUrl=ge((fe==null?void 0:fe.value)??B.baseUrl),B.groupId=((he==null?void 0:he.value)??"").trim(),B.authToken=((Ve==null?void 0:Ve.value)??"").trim(),v(),k()}function wt(c){B.enabled=c!==!1,v(),k(),De()}function Ft(){wt(H?H.checked:po)}function dn(){B.useSemver=W?W.checked:fo,v(),k()}function Pt(){[fe,he,Ve].forEach(c=>{c&&c.addEventListener("input",we)}),ae&&ae.addEventListener("click",()=>{Qn()}),j&&j.addEventListener("click",()=>{Yt()}),H&&H.addEventListener("change",Ft),W&&W.addEventListener("change",dn),q&&q.addEventListener("click",ei),G&&G.addEventListener("click",c=>{const f=c.target.closest("[data-artifact-version]");if(f){c.stopPropagation();const m=f.dataset.artifactId,L=f.dataset.artifactVersion;m&&L&&ti(m,L);return}const S=c.target.closest("[data-artifact-load-all]");if(S){c.stopPropagation(),S.dataset.artifactId&&ni();return}const _=c.target.closest("[data-artifact-trigger]");if(_){const m=_.dataset.artifactId;if(!m)return;Nn(m)}})}function un(){const c=document.createElement("div");return c.className="blockscape-registry-panel",c.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,c}function pn(c){if(!c)return;c.innerHTML="";const f=un();c.appendChild(f),ne(c),Pt(),k()}function zt(c){if(!G)return;if(G.innerHTML="",!c.length){be("No artifacts found in this group.");return}const f=m=>{const L=document.createElement("section");L.className="apicurio-artifact-section";const P=document.createElement("h3");P.textContent=m,L.appendChild(P);const M=document.createElement("ul");return M.className="apicurio-artifact-list",L.appendChild(M),{section:L,list:M}},S=f("Series artifacts"),_=f("Artifacts");c.forEach(m=>{if(!(m!=null&&m.artifactId))return;const P=m._groupId&&m._groupId.endsWith(wr)?S.list:_.list,M=document.createElement("li"),re=document.createElement("button");re.type="button",re.className="apicurio-artifact",re.dataset.artifactId=m.artifactId,re.dataset.artifactTrigger="toggle";const Z=document.createElement("span");Z.className="apicurio-artifact-title",Z.textContent=m.artifactId,re.appendChild(Z);const Q=[];if(m.name&&Q.push(m.name),m.version!=null&&Q.push(`v${m.version}`),m.type&&Q.push(m.type),m._groupId&&Q.push(m._groupId),Q.length){const de=document.createElement("span");de.className="apicurio-artifact-meta",de.textContent=Q.join(" • "),re.appendChild(de)}if(m.description){const de=document.createElement("span");de.className="apicurio-artifact-meta",de.textContent=m.description,re.appendChild(de)}M.appendChild(re);const _e=document.createElement("div");_e.className="apicurio-version-list",_e.dataset.versionPanel=m.artifactId,_e.hidden=!0;const He=document.createElement("p");He.className="apicurio-hint",He.textContent="Click to load the latest or open versions.",_e.appendChild(He),M.appendChild(_e),P.appendChild(M)}),S.list.children.length&&G.appendChild(S.section),_.list.children.length&&G.appendChild(_.section)}function fn(c){return G?G.querySelector(`[data-version-panel="${c}"]`):null}function $t(c,f){if(!c||(c.innerHTML="",!f))return;const S=document.createElement("p");S.className="apicurio-hint",S.textContent=f,c.appendChild(S)}function Kt(c,f){const S=fn(c);if(S){if(S.innerHTML="",!f.length){$t(S,"No versions found for this artifact.");return}f.forEach(_=>{const m=document.createElement("button");m.type="button",m.className="apicurio-version-button",m.dataset.artifactId=c,m.dataset.artifactVersion=_.version;const L=[`Version ${_.version}`];if(_.createdOn){const P=new Date(_.createdOn);isNaN(P)||L.push(P.toISOString().slice(0,10))}m.textContent=L.join(" — "),S.appendChild(m)})}}async function Nn(c){const f=fn(c);if(!f)return;if(f.dataset.open==="true"){f.hidden=!0,f.dataset.open="false";return}if(f.hidden=!1,f.dataset.open="true",f.dataset.loaded!=="true"){if(!Ee()){$t(f,"Enter registry details first.");return}$t(f,"Loading versions…");try{const _=ge(B.baseUrl),m=ce.get(c),L=B.groupId.trim(),P=(m==null?void 0:m._groupId)||L,M=await at(_,P,c);ee.set(c,M),f.dataset.loaded="true",Kt(c,M)}catch(_){console.error("[Blockscape] failed to load versions",_),$t(f,`Unable to fetch versions: ${_.message}`)}}}function Ei(c,f){var _;const S=s.findIndex(m=>m.apicurioArtifactId===c);if(S!==-1){const m=s[S].id;s[S]={...f,id:m||f.id},((_=s[S].apicurioVersions)==null?void 0:_.length)>1&&(s[S].isSeries=!0),u(S)}else s.push(f),u(s.length-1)}async function Zn(c,f,S,_){const m=encodeURIComponent(f),L=encodeURIComponent(S),P=`${c}/groups/${m}/artifacts/${L}`;try{const M=await fetch(P,{method:"GET",headers:_});if(M.status===404)return!1;if(M.ok)return!0;throw M.status===401||M.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${M.status} while checking the artifact.`)}catch(M){throw M instanceof TypeError?new Error("Network error while contacting Apicurio registry."):M}}async function Qn(){var P;if(!ae||ae.dataset.loading==="true")return;if(!Y()){$("Apicurio integration is off. Enable it first.","error");return}if(!Ee()){$("Enter the registry base URL and group ID before pushing.","error");return}const c=l();if(c<0||!s[c]){$("No active model to push.","error");return}const f=nt(s[c],{fallbackTitle:y(s[c])});if(!f){$("Active model needs an id before pushing.","error");return}const S=ge(B.baseUrl),_=B.groupId.trim(),m=JSON.stringify(s[c].data,null,2),L=R();ae.dataset.loading="true",ae.textContent="Pushing…",ae.disabled=!0,$("Pushing to Apicurio…","muted");try{const M=await Zn(S,_,f,L),re=J(s[c].data);if(M)try{const Ie=await Rt(S,_,f),{data:et,fingerprint:We}=await ct(S,_,f,Ie);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",Ie),console.log("local fingerprint",re),console.log("registry fingerprint",We),console.log("local payload",s[c].data),console.log("registry payload",et),console.groupEnd(),re&&We&&re===We){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){$("Push cancelled (content matches the latest registry version).","muted");return}$("Pushing identical content by user choice.","muted")}else We?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):$("Unable to compare with registry content (skipping confirmation).","muted")}catch(Ie){console.warn("[Blockscape] unable to compare registry content before push",Ie),$("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const Z=B.useSemver?await vt(S,_,f,M):null;if(B.useSemver&&!Z)throw new Error("Semantic versioning is enabled but no version could be computed.");const Q=encodeURIComponent(_),_e=encodeURIComponent(f),He=M?`${S}/groups/${Q}/artifacts/${_e}/versions`:`${S}/groups/${Q}/artifacts`,de={...L,"Content-Type":"application/json"};Z&&(de["X-Registry-Version"]=Z,$(`Pushing to Apicurio as version ${Z}…`,"muted"));const pt=M?Je(m,{version:Z}):ie(f,m,{title:y(s[c]),description:(P=s[c].data)==null?void 0:P.abstract,version:Z}),ft=await fetch(He,{method:"POST",headers:de,body:JSON.stringify(pt)});if(!ft.ok){let Ie=ft.statusText||"Unknown error";try{const et=await ft.text();et&&(Ie=et.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${ft.status}): ${Ie}`)}let Xe=null;try{Xe=await ft.json()}catch{Xe=null}const ue=(Xe==null?void 0:Xe.version)||(Xe==null?void 0:Xe.globalId)||"",Re=M?"Updated":"Created",it=ue?` (version ${ue})`:"";$(`${Re} ${f}${it}`,"success")}catch(M){console.error("[Blockscape] Apicurio push failed",M),$(`Apicurio push failed: ${M.message}`,"error")}finally{ae.dataset.loading="false",je()}}async function Yt(){var Z,Q;if(!j||j.dataset.loading==="true")return;if(!Y()){$("Apicurio integration is off. Enable it first.","error");return}if(!Ee()){$("Enter the registry base URL and group ID before pushing.","error");return}const c=l(),f=c>=0?s[c]:null;if(!f||!f.apicurioVersions||f.apicurioVersions.length<2){$("Series push requires a model with multiple versions.","error");return}const S=nt(f,{seriesName:f.title||f.apicurioArtifactName||y(f)});if(!S){$("Active series needs an id before pushing.","error");return}typeof E=="function"&&E(f,{seriesName:f.title||f.apicurioArtifactName||y(f)});const _=ge(B.baseUrl),m=B.groupId.trim(),L=f.apicurioVersions.map(_e=>_e.data),P=JSON.stringify(L,null,2),M=R(),re=le(m);j.dataset.loading="true",j.textContent="Pushing…",j.disabled=!0,$("Pushing series to Apicurio…","muted");try{const _e=await Zn(_,re,S,M),He=J(L);if(_e)try{const ot=await Rt(_,re,S),{data:Ut,fingerprint:Ot}=await ct(_,re,S,ot);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",ot),console.log("local fingerprint",He),console.log("registry fingerprint",Ot),console.log("local payload (series)",L),console.log("registry payload",Ut),console.groupEnd(),He&&Ot&&He===Ot){if(!window.confirm("The current registry version matches this series. Push anyway?")){$("Series push cancelled (content matches latest).","muted");return}$("Pushing identical series by user choice.","muted")}else Ot?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):$("Unable to compare with registry content (skipping confirmation).","muted")}catch(ot){console.warn("[Blockscape] unable to compare registry content before series push",ot),$("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const de=B.useSemver?await vt(_,re,S,_e):null;if(B.useSemver&&!de)throw new Error("Semantic versioning is enabled but no version could be computed.");const pt=encodeURIComponent(re),ft=encodeURIComponent(S),Xe=_e?`${_}/groups/${pt}/artifacts/${ft}/versions`:`${_}/groups/${pt}/artifacts`,ue={...M,"Content-Type":"application/json"};de&&(ue["X-Registry-Version"]=de,$(`Pushing series to Apicurio as version ${de}…`,"muted"));const Re=_e?Je(P,{version:de}):ie(S,P,{title:f.apicurioArtifactName||((Z=f.data)==null?void 0:Z.title)||S,description:(Q=f.data)==null?void 0:Q.abstract,version:de}),it=await fetch(Xe,{method:"POST",headers:ue,body:JSON.stringify(Re)});if(!it.ok){let ot=it.statusText||"Unknown error";try{const Ut=await it.text();Ut&&(ot=Ut.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${it.status}): ${ot}`)}let Ie=null;try{Ie=await it.json()}catch{Ie=null}const et=(Ie==null?void 0:Ie.version)||(Ie==null?void 0:Ie.globalId)||"",We=_e?"Updated":"Created",mt=et?` (version ${et})`:"";$(`${We} ${S} series${mt}`,"success")}catch(_e){console.error("[Blockscape] Apicurio series push failed",_e),$(`Apicurio series push failed: ${_e.message}`,"error")}finally{j.dataset.loading="false",je()}}async function ei(){if(!q||q.dataset.loading==="true")return;if(!Y()){$("Enable Apicurio integration to list artifacts.","error");return}if(!Ee()){$("Enter registry base URL and group ID before listing.","error");return}const c=ge(B.baseUrl),f=B.groupId.trim(),S=le(f),_=[{groupId:f,label:"base"},{groupId:S,label:"series"}];q.dataset.loading="true",q.textContent="Listing…",q.disabled=!0,$("Listing artifacts…","muted"),be("Contacting registry…");try{const m=R();m.Accept="application/json";const L=[];for(const M of _){const re=encodeURIComponent(M.groupId),Z=`${c}/groups/${re}/artifacts?limit=50&offset=0`,Q=await fetch(Z,{method:"GET",headers:m});if(!Q.ok){let de=Q.statusText||"Unknown error";try{const pt=await Q.text();pt&&(de=pt.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${M.groupId} (${Q.status}): ${de}`);continue}const _e=await Q.json(),He=ke(_e).filter(de=>de&&de.artifactId);He.forEach(de=>{de&&(de._groupId=M.groupId)}),L.push(...He)}ce.clear(),ee.clear(),L.forEach(M=>{M!=null&&M.artifactId&&ce.set(M.artifactId,M)}),zt(L);const P=L.length;$(P?`Found ${P} artifact${P===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",P?"success":"muted")}catch(m){console.error("[Blockscape] failed to list artifacts",m),Ye("Unable to list artifacts."),$(`Listing failed: ${m.message}`,"error")}finally{q.dataset.loading="false",je()}}async function ti(c,f=null){var _e,He,de,pt,ft,Xe;if(!c)return;if(!Y()){$("Enable Apicurio integration to load artifacts.","error");return}if(!Ee()){$("Enter registry connection details before loading artifacts.","error");return}const S=ge(B.baseUrl),_=B.groupId.trim(),m=c&&((_e=ce.get(c))==null?void 0:_e._groupId)||_;let L=ce.get(c);const P=async()=>{try{const ue=await Fe(S,m,c);return ue!=null&&ue.artifactId&&ce.set(c,ue),ue}catch(ue){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",ue),ue}};if(!L)try{L=await P()}catch(ue){$(`Failed to fetch artifact metadata: ${ue.message}`,"error");return}const M=ee.get(c)||[];let re="latest",Z="latest";if(f)re=f,Z=f;else{if(!L||L.version==null)try{L=await P()}catch(ue){$(`Failed to fetch artifact metadata: ${ue.message}`,"error");return}re=(L==null?void 0:L.version)||"latest",Z=(L==null?void 0:L.version)||"latest"}const Q=M.find(ue=>String(ue.version)===String(re));(Q==null?void 0:Q.version)!=null&&(Z=Q.version),$(`Loading artifact ${c}…`,"muted");try{const ue=await bt(S,m,c,re),Re=ce.get(c)||L||{},it=Array.isArray(ue);let Ie=null;if(it){const et=ue.map((mt,ot)=>(I(mt,{titleHint:Re.name||c,idHint:c}),{version:String(ot+1),data:mt,createdOn:(Q==null?void 0:Q.createdOn)||Re.createdOn}));Ie={id:K(),title:((de=(He=et[0])==null?void 0:He.data)==null?void 0:de.title)||Re.name||c,data:(pt=et[0])==null?void 0:pt.data,apicurioArtifactId:c,apicurioArtifactName:Re.name||"",apicurioVersions:et,apicurioActiveVersionIndex:0,isSeries:!0};const We=((ft=Re==null?void 0:Re.properties)==null?void 0:ft.seriesId)||c;typeof E=="function"&&E(Ie,{seriesName:We,fallbackTitle:We}),$(`Loaded series artifact ${c}.`,"success")}else{I(ue,{titleHint:Re.name||c,idHint:c});const et={version:Z,data:ue,createdOn:(Q==null?void 0:Q.createdOn)||Re.createdOn};Ie={id:K(),title:ue.title||Re.name||c,data:ue,apicurioArtifactId:c,apicurioArtifactName:Re.name||"",apicurioVersions:[et],apicurioActiveVersionIndex:0};const We=(Xe=Re==null?void 0:Re.properties)==null?void 0:Xe.seriesId;We&&typeof E=="function"&&E(Ie,{seriesName:We,fallbackTitle:We});const mt=Z?` (version ${Z})`:"";$(`Loaded artifact ${c}${mt}.`,"success")}Ei(c,Ie)}catch(ue){console.error("[Blockscape] failed to load artifact",ue),$(`Failed to load artifact: ${ue.message}`,"error")}}async function ni(c){}return{hydrateConfig:ve,mount:pn,updateAvailability:je,isEnabled:Y,setEnabled:wt,onEnabledChange:Qe}}function kn(s,l){if(typeof s!="function")throw new Error(`[itemEditor] expected ${l} to be a function`)}function Xa(s,{excludeId:l}={}){if(!s)return[];const u=s.split(/[\s,]+/).map(E=>E.trim()).filter(Boolean),I=[];return u.forEach(E=>{l&&E===l||I.includes(E)||I.push(E)}),I}function Za(s,l,u){if(!l||!u||l===u)return;((s==null?void 0:s.categories)||[]).forEach(E=>{(E.items||[]).forEach(V=>{Array.isArray(V.deps)&&(V.deps=V.deps.map(T=>T===l?u:T))})}),Array.isArray(s==null?void 0:s.links)&&s.links.forEach(E=>{E.from===l&&(E.from=u),E.to===l&&(E.to=u)})}function Qa({findItemAndCategoryById:s,collectAllItemIds:l,updateItemReferences:u,loadActiveIntoEditor:I,rebuildFromActive:E,select:V,onSelectionRenamed:T}={}){kn(s,"findItemAndCategoryById"),kn(l,"collectAllItemIds"),kn(u,"updateItemReferences"),kn(I,"loadActiveIntoEditor"),kn(E,"rebuildFromActive"),kn(V,"select");const y={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function J(H){if(y.fields.errorEl){if(!H){y.fields.errorEl.hidden=!0,y.fields.errorEl.textContent="";return}y.fields.errorEl.hidden=!1,y.fields.errorEl.textContent=H}}function K(){y.wrapper&&(y.wrapper.hidden=!0,y.wrapper.setAttribute("aria-hidden","true"),J(""),y.categoryId=null,y.itemId=null,y.modelData=null,document.body.classList.remove("item-editor-open"))}function ae(){y.wrapper&&(y.wrapper.hidden=!1,y.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var H,W;(H=y.fields.nameInput)==null||H.focus(),(W=y.fields.nameInput)==null||W.select()}))}function q(H){var ge;if(!y.modelData||!y.categoryId||!y.itemId)throw new Error("No item loaded.");const X=(((ge=y.modelData)==null?void 0:ge.categories)||[]).find(le=>le.id===y.categoryId);if(!X)throw new Error("Category not found.");X.items=X.items||[];const j=X.items.find(le=>le.id===y.itemId);if(!j)throw new Error("Item not found.");const G=(H.id||"").trim();if(!G)throw new Error("ID is required.");const Le=l(y.modelData);if(G!==j.id&&Le.has(G))throw new Error("Another item already uses that ID.");j.id=G;const B=(H.name||"").trim();j.name=B||j.id;const ce=(H.logo||"").trim();if(ce?j.logo=ce:delete j.logo,H.externalFlag&&!H.external)j.external=!0;else{const le=(H.external??"").toString().trim();le?j.external=le:delete j.external}const ee=(H.color||"").trim();return ee?j.color=ee:delete j.color,j.deps=Array.isArray(H.deps)?H.deps:[],j.id!==H.originalId&&typeof T=="function"&&T(H.originalId,j.id),u(y.modelData,H.originalId,j.id),I(),E(),V(j.id),j.id}function fe(){if(!y.fields||!y.fields.idInput)return!1;const H=(y.fields.idInput.value||"").trim(),W={originalId:y.itemId,id:H,name:y.fields.nameInput.value||"",logo:y.fields.logoInput.value||"",external:y.fields.externalInput.value||"",externalFlag:y.fields.externalFlagInput.checked,color:y.fields.colorInput.value||"",deps:Xa(y.fields.depsInput.value,{excludeId:H})};try{return q(W),K(),!0}catch(X){return console.warn("[itemEditor] item edit failed",X),J((X==null?void 0:X.message)||"Unable to save item."),!1}}function he(){if(y.wrapper)return y.wrapper;const H=document.createElement("div");H.className="item-editor-modal",H.hidden=!0,H.setAttribute("role","dialog"),H.setAttribute("aria-modal","true");const W=document.createElement("div");W.className="item-editor-modal__backdrop",H.appendChild(W);const X=document.createElement("div");X.className="item-editor",H.appendChild(X);const j=document.createElement("div");j.className="item-editor__header";const G=document.createElement("h2");G.className="item-editor__title",G.textContent="Edit item";const Le=document.createElement("button");Le.type="button",Le.className="item-editor__close",Le.setAttribute("aria-label","Close item editor"),Le.textContent="×",j.appendChild(G),j.appendChild(Le),X.appendChild(j);const B=document.createElement("form");B.className="item-editor__form",X.appendChild(B);const ce=document.createElement("div");ce.className="item-editor__meta",ce.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',B.appendChild(ce);const ee=document.createElement("div");ee.className="item-editor__error",ee.hidden=!0,B.appendChild(ee);const ge=(ie,Je,O)=>{const oe=document.createElement("label");oe.className="item-editor__field";const xe=document.createElement("span");if(xe.className="item-editor__label",xe.textContent=ie,oe.appendChild(xe),Je.classList.add("item-editor__control"),oe.appendChild(Je),O){const me=document.createElement("div");me.className="item-editor__hint",me.textContent=O,oe.appendChild(me)}return oe},le=document.createElement("input");le.type="text",le.required=!0,B.appendChild(ge("ID",le,"Unique identifier used for links and dependencies."));const Ee=document.createElement("input");Ee.type="text",B.appendChild(ge("Name",Ee,"Visible label shown on the tile."));const Y=document.createElement("input");Y.type="url",Y.inputMode="url",Y.placeholder="https://…",B.appendChild(ge("Logo URL",Y,"Optional image URL."));const De=document.createElement("input");De.type="url",De.inputMode="url",De.placeholder="https://…",B.appendChild(ge("External link",De,"Shown with ↗ icon and in preview."));const Qe=document.createElement("div");Qe.className="item-editor__checkbox";const Se=document.createElement("label");Se.className="item-editor__checkbox-row";const $=document.createElement("input");$.type="checkbox";const be=document.createElement("span");be.textContent="Mark as external without link";const Ye=document.createElement("div");Ye.className="item-editor__hint",Ye.textContent="Keeps dashed border even without a URL.",Se.appendChild($),Se.appendChild(be),Qe.appendChild(Se),Qe.appendChild(Ye),B.appendChild(Qe);const je=document.createElement("input");je.type="text",je.placeholder="#2563eb",B.appendChild(ge("Color",je,"Optional badge color (hex or CSS color)."));const k=document.createElement("textarea");k.rows=2,k.placeholder="Comma or space separated ids",B.appendChild(ge("Dependencies",k,"Use item IDs, separated by commas or spaces."));const v=document.createElement("div");v.className="item-editor__actions";const ve=document.createElement("button");ve.type="button",ve.className="pf-v5-c-button pf-m-tertiary",ve.textContent="Cancel";const R=document.createElement("button");return R.type="submit",R.className="pf-v5-c-button pf-m-primary",R.textContent="Save",v.appendChild(ve),v.appendChild(R),B.appendChild(v),y.wrapper=H,y.fields={idInput:le,nameInput:Ee,logoInput:Y,externalInput:De,externalFlagInput:$,colorInput:je,depsInput:k,categoryValue:ce.querySelector(".item-editor__meta-value"),errorEl:ee},ve.addEventListener("click",K),Le.addEventListener("click",K),W.addEventListener("click",K),B.addEventListener("submit",ie=>{ie.preventDefault(),fe()}),document.addEventListener("keydown",ie=>{ie.key==="Escape"&&!H.hidden&&(ie.preventDefault(),ie.stopPropagation(),K())}),document.body.appendChild(H),H}function Ve(H){const W=s(H);return W?(he(),y.categoryId=W.category.id,y.itemId=W.item.id,y.modelData=W.modelData,y.fields.categoryValue.textContent=W.category.title||W.category.id,y.fields.idInput.value=W.item.id||"",y.fields.nameInput.value=W.item.name||"",y.fields.logoInput.value=W.item.logo||"",y.fields.externalInput.value=typeof W.item.external=="string"?W.item.external:"",y.fields.externalFlagInput.checked=W.item.external===!0,y.fields.colorInput.value=W.item.color||"",y.fields.depsInput.value=Array.isArray(W.item.deps)?W.item.deps.join(", "):"",J(""),V(W.item.id),ae(),!0):!1}return{open:Ve,hide:K,isOpen:()=>!!y.wrapper&&!y.wrapper.hidden}}function yr(s,l="series"){return(s||l).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||l}function ln(s,l="series"){const u=yr(s,l).replace(/\./g,"-");return u.replace(/-series$/i,"").replace(/-+$/,"")||u||yr(l,"series")}function Ar(s,{seriesName:l,fallbackTitle:u="unknown"}={}){var y,J;const E=[s==null?void 0:s.seriesId,(y=s==null?void 0:s.data)==null?void 0:y.seriesId,s==null?void 0:s.apicurioArtifactId,l,s==null?void 0:s.title,s==null?void 0:s.apicurioArtifactName,(J=s==null?void 0:s.data)==null?void 0:J.title,u].map(K=>(K??"").toString().trim()),V=E.findIndex(Boolean),T=V!==-1?E[V]:"";return T?(console.log("[Series] deriveSeriesId: picked base",{base:T,sourceIndex:V,candidates:E}),ln(T,u)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:u}),null)}function gt(s,{seriesName:l,fallbackTitle:u="unknown"}={}){if(!s||typeof s!="object")return null;const I=Ar(s,{seriesName:l,fallbackTitle:u});return I?(s.seriesId=I,s.apicurioArtifactId||(s.apicurioArtifactId=I),I):null}function In(s,l={}){var E,V;if(!s)return null;const u=s.isSeries||((E=s.apicurioVersions)==null?void 0:E.length)>1||s.seriesId||((V=s.data)==null?void 0:V.seriesId)||s.apicurioArtifactId;if(!u&&!l.force)return null;const I=Ar(s,l);return I||(u?ln(l.fallbackTitle||"unknown"):null)}const wi=typeof import.meta<"u"&&"./"||"";function ec(){console.log("[Blockscape] init");const s=document.getElementById("jsonBox"),l=document.querySelector(".blockscape-json-panel"),u=document.getElementById("app"),I=document.getElementById("overlay"),E=document.getElementById("tabTooltip"),V=document.getElementById("modelList"),T=document.getElementById("itemPreview"),y=document.getElementById("urlForm"),J=document.getElementById("urlInput"),K=document.getElementById("loadUrl"),ae=T.querySelector(".item-preview__title"),q=T.querySelector(".item-preview__body"),fe=T.querySelector(".item-preview__actions"),he=T.querySelector(".item-preview__close"),Ve=document.getElementById("downloadJson"),H=document.getElementById("shareModel"),W=document.getElementById("createVersion"),X=document.getElementById("openInEditor"),j=document.getElementById("copyJson"),G=document.getElementById("copySeries"),Le=document.getElementById("pasteJson"),B=document.getElementById("helpButton"),ce=document.getElementById("newPanelButton"),ee=document.getElementById("shortcutHelp"),ge=document.getElementById("shortcutHelpList"),le=document.getElementById("shortcutHelpClose"),Ee=document.getElementById("shortcutHelpBackdrop"),Y=document.getElementById("newPanel"),De=document.getElementById("newPanelClose"),Qe=document.getElementById("newPanelBackdrop"),Se=document.getElementById("search"),$=document.getElementById("searchResults"),be="blockscape:editorPayload",Ye="blockscape:editorTransfer",je=document.title;s.value=document.getElementById("seed").textContent.trim();let k=[],v=-1;const ve=Ya({models:k,getActiveIndex:()=>v,setActive:lt,ensureModelMetadata:Zt,getModelId:Ze,getSeriesId:In,ensureSeriesId:gt,getModelTitle:Pe,computeJsonFingerprint:oi,uid:Xt});let R=null,ie=new Map,Je=new Map,O=null,oe=null,xe=null,me=null,nt=!0,ke=!1,Be=0,te={x:0,y:0},qe="map",Fe=null,at=null,bt=!1,ct=null;const Rt=2e3;let vt=null,ne=null,we=null,wt=null,Ft=null,dn=null,Pt=null,un="",pn=!1,zt=null,fn=null,$t=null,Kt=[],Nn=null;const Ei=30,Zn=1e3,Qn="blockscape:hoverScale",Yt=1.5,ei=1,ti=2.5,ni="blockscape:titleWrap",c="blockscape:titleHoverWidth",f="blockscape:titleHoverTextPortion",S="wrap",_=1.3,m=1,L=1.6,P=.25,M=0,re=.6,Z="blockscape:tileCompactness",Q=1,_e=.75,He=1.25,de="blockscape:obsidianLinksEnabled",pt="blockscape:obsidianLinkMode",ft="blockscape:obsidianVault",Xe="title",ue="id",Re=Xe;let it=Yt,Ie=Q,et=S,We=_,mt=P,ot=!1,Ut=Re,Ot="";const _i="blockscape:seriesNavDoubleClickMs",Ln=900,So=300,ko=4e3;let mn=Ln;ve.hydrateConfig(),Dr(),Fr(),zr(),Jr(),Wr(),Xr(),ns(),es(),os(),rt();function Xt(){return Math.random().toString(36).slice(2,10)}function Nr(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function Lr(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function Tr(e){return Nr(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Br(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),Lr(t)}function $r(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}async function Io(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function Or(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function Tn(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function Mr(e){return Number.isFinite(e)?Math.min(ti,Math.max(ei,e)):Yt}function rt(){if(!u)return;const e=!!O||!!oe;u.classList.toggle("blockscape-has-selection",e)}function Bn(e){return it=Mr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-scale",it),it}function Vr(e){return Number.isFinite(e)?Math.min(He,Math.max(_e,e)):Q}function $n(e){return Ie=Vr(e),document.documentElement.style.setProperty("--blockscape-tile-compactness",Ie),Ie}function Rr(e){return Number.isFinite(e)?Math.min(L,Math.max(m,e)):_}function On(e){return We=Rr(e),document.documentElement.style.setProperty("--blockscape-title-hover-width-multiplier",We),We}function Pr(e){return Number.isFinite(e)?Math.min(re,Math.max(M,e)):P}function Mn(e){return mt=Pr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-text-portion",mt),mt}function Vn(e){const t=e==="nowrap"?"nowrap":"wrap";et=t;const n=t==="nowrap"?"nowrap":"normal",i=t==="nowrap"?"nowrap":"normal";return document.documentElement.style.setProperty("--blockscape-title-white-space",n),document.documentElement.style.setProperty("--blockscape-title-text-wrap",i),t}function Ur(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Qn,String(e))}catch(t){console.warn("[Blockscape] failed to persist hover scale",t)}}function Dr(){if(typeof window>"u"||!window.localStorage)return Bn(Yt);try{const e=window.localStorage.getItem(Qn);if(!e)return Bn(Yt);const t=parseFloat(e);return Bn(t)}catch(e){return console.warn("[Blockscape] failed to read hover scale",e),Bn(Yt)}}function Hr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Z,String(e))}catch(t){console.warn("[Blockscape] failed to persist tile compactness",t)}}function Fr(){if(typeof window>"u"||!window.localStorage)return $n(Q);try{const e=window.localStorage.getItem(Z);if(!e)return $n(Q);const t=parseFloat(e);return $n(t)}catch(e){return console.warn("[Blockscape] failed to read tile compactness",e),$n(Q)}}function jr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(c,String(e))}catch(t){console.warn("[Blockscape] failed to persist title hover width",t)}}function Jr(){if(typeof window>"u"||!window.localStorage)return On(_);try{const e=window.localStorage.getItem(c);if(!e)return On(_);const t=parseFloat(e);return On(t)}catch(e){return console.warn("[Blockscape] failed to read title hover width",e),On(_)}}function qr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(f,String(e))}catch(t){console.warn("[Blockscape] failed to persist title text zoom",t)}}function Wr(){if(typeof window>"u"||!window.localStorage)return Mn(P);try{const e=window.localStorage.getItem(f);if(!e)return Mn(P);const t=parseFloat(e);return Mn(t)}catch(e){return console.warn("[Blockscape] failed to read title text zoom",e),Mn(P)}}function Gr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ni,e)}catch(t){console.warn("[Blockscape] failed to persist title wrap mode",t)}}function zr(){if(typeof window>"u"||!window.localStorage)return Vn(S);try{const e=window.localStorage.getItem(ni);return Vn(e||S)}catch(e){return console.warn("[Blockscape] failed to read title wrap mode",e),Vn(S)}}function Kr(e){return Number.isFinite(e)?Math.min(ko,Math.max(So,e)):Ln}function Rn(e){return mn=Kr(e),mn}function Yr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(_i,String(e))}catch(t){console.warn("[Blockscape] failed to persist series double-click wait",t)}}function Xr(){if(typeof window>"u"||!window.localStorage)return Rn(Ln);try{const e=window.localStorage.getItem(_i);if(!e)return Rn(Ln);const t=parseInt(e,10);return Rn(t)}catch(e){return console.warn("[Blockscape] failed to read series double-click wait",e),Rn(Ln)}}function Zr(e){return e===ue?ue:Xe}function Pn(e){return Ut=Zr(e),Ut}function Qr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(pt,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian link mode",t)}}function es(){if(typeof window>"u"||!window.localStorage)return Pn(Re);try{const e=window.localStorage.getItem(pt);return Pn(e||Re)}catch(e){return console.warn("[Blockscape] failed to read Obsidian link mode",e),Pn(Re)}}function Un(e){return ot=!!e,ot}function ts(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(de,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist Obsidian toggle",t)}}function ns(){if(typeof window>"u"||!window.localStorage)return Un(!1);try{const e=window.localStorage.getItem(de);return e==null?Un(!1):Un(e==="1")}catch(e){return console.warn("[Blockscape] failed to read Obsidian toggle",e),Un(!1)}}function Dn(e){return Ot=(e??"").toString().trim(),Ot}function is(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ft,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian vault",t)}}function os(){if(typeof window>"u"||!window.localStorage)return Dn("");try{const e=window.localStorage.getItem(ft);return Dn(e||"")}catch(e){return console.warn("[Blockscape] failed to read Obsidian vault",e),Dn("")}}function rs(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function ss(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(r=>r&&typeof r=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function ii(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t,e.data&&typeof e.data=="object"&&(e.data.seriesId=t),Array.isArray(e.apicurioVersions)&&e.apicurioVersions.forEach(n=>{n!=null&&n.data&&typeof n.data=="object"&&(n.data.seriesId=t)}))}function as(e){if(!e||typeof window>"u"||typeof window.prompt!="function")return!1;const t=(e.title??e.apicurioArtifactName??"").toString().trim()||ki(e,"Series"),n=window.prompt("Series name",t);if(n==null)return!1;const i=n.trim();if(!i)return!1;const o=In(e,{seriesName:i,fallbackTitle:i})||ln(i,i),r=window.prompt("Series ID (used for linking and downloads)",o);if(r==null)return!1;const a=ln(r.trim()||i,i||"series");return e.title=i,e.apicurioArtifactName=i,ii(e,a),!0}function Si(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>Si(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${Si(e[i])}`).join(",")}}`}function Co(e){try{return Si(e)}catch{return""}}function oi(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=Co(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=Co(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const cs=[{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Move up/down through items, pausing on category headers before entering the next category at the same relative position."},{keys:[["Cmd/Ctrl","Arrow Up"],["Cmd/Ctrl","Arrow Down"]],description:"Reorder the selected category (or the category that holds the selected item)."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Cmd/Ctrl","Arrow Left"],["Cmd/Ctrl","Arrow Right"]],description:"Switch to the previous or next map when viewing a series."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile or category."},{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["F2"]],description:"Edit the selected item; when a category (not an item) is selected, open the category editor."},{keys:[["Delete"]],description:"Delete the selected item or category (use Cmd/Ctrl+Z to undo)."},{keys:[["Insert"]],description:"Add a new category at the bottom of the map."},{keys:[["Escape"]],description:"Unselect item or close the open preview popover."}];function Zt(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const r=n||e.title||t||"model",a=Tn(r).replace(/\./g,"-");e.id=a||`model-${Xt()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function ls(e){return JSON.parse(JSON.stringify(e))}function Pe(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function ki(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const o=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(o)return o;const r=Ze(e);return r?`${r} series`:t}return Pe(e,t)}function Ze(e){var o;const t=In(e);if(t)return t;const n=(o=e==null?void 0:e.data)==null?void 0:o.id;return n&&n.toString().trim()||null}function xo(e){var d;if(e<0||e>=k.length||!s)return!0;const t=k[e],n=(s.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}Zt(i,{titleHint:Pe(t),idHint:Ze(t)});const o=oi(t.data),r=oi(i);if(o===r)return!0;t.data=i;const a=on(t);return a>=0&&((d=t.apicurioVersions)!=null&&d[a])&&(t.apicurioVersions[a].data=i),!0}function Ao(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function No(e){if(v<0||!e)return null;const t=k[v].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const r=(i.items||[]).find(a=>a.id===e);if(r)return{category:i,item:r,modelData:t}}return null}function ds(e,t){const n=Ao(t);let i=Tn(e||"item");if(!n.has(i))return i;const o=()=>Xt().slice(0,4);for(;n.has(i);)i=`${Tn(e||"item")}-${o()}`;return i}function us(e="category",t){const n=(t==null?void 0:t.categories)||[],i=Tn(e||"category"),o=d=>n.some(p=>p.id===d);let r=i||`category-${Xt()}`;if(!o(r))return r;let a=n.length+1;for(;o(`${i}-${a}`);)a+=1;return`${i}-${a}`}const Qt=Qa({findItemAndCategoryById:No,collectAllItemIds:Ao,updateItemReferences:Za,loadActiveIntoEditor:dt,rebuildFromActive:st,select:e=>ut(e),onSelectionRenamed:(e,t)=>{var n;O===e&&(O=t,rt()),((n=Fe==null?void 0:Fe.item)==null?void 0:n.id)===e&&(Fe.item.id=t)}});function ps({getActiveModelData:e,loadActiveIntoEditor:t,rebuildFromActive:n,selectCategory:i,onCategoryRenamed:o}){const r={wrapper:null,fields:{},categoryId:null,modelData:null},a=x=>{if(r.fields.errorEl){if(!x){r.fields.errorEl.hidden=!0,r.fields.errorEl.textContent="";return}r.fields.errorEl.hidden=!1,r.fields.errorEl.textContent=x}},d=()=>{r.wrapper&&(r.wrapper.hidden=!0,r.wrapper.setAttribute("aria-hidden","true"),a(""),r.categoryId=null,r.modelData=null,document.body.classList.remove("category-editor-open"))},p=()=>{r.wrapper&&(r.wrapper.hidden=!1,r.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("category-editor-open"),requestAnimationFrame(()=>{var x,F;(x=r.fields.titleInput)==null||x.focus(),(F=r.fields.titleInput)==null||F.select()}))},h=()=>{if(!r.modelData||!r.categoryId)throw new Error("No category loaded.");const x=r.modelData.categories||[],F=x.find(Te=>Te.id===r.categoryId);if(!F)throw new Error("Category not found.");const pe=(r.fields.idInput.value||"").trim();if(!pe)throw new Error("ID is required.");const Ae=(r.fields.titleInput.value||"").trim();if(x.some(Te=>Te.id===pe&&Te.id!==F.id))throw new Error("Another category already uses that ID.");const Ne=F.id;return F.id=pe,F.title=Ae||F.id,Ne!==pe&&typeof o=="function"&&o(Ne,pe),t(),n(),i(pe,{scrollIntoView:!0}),!0},g=()=>{try{return h(),d(),!0}catch(x){return console.warn("[CategoryEditor] save failed",x),a((x==null?void 0:x.message)||"Unable to save category."),!1}},N=()=>{if(r.wrapper)return r.wrapper;const x=document.createElement("div");x.className="item-editor-modal category-editor-modal",x.hidden=!0,x.setAttribute("role","dialog"),x.setAttribute("aria-modal","true");const F=document.createElement("div");F.className="item-editor-modal__backdrop",x.appendChild(F);const pe=document.createElement("div");pe.className="item-editor",x.appendChild(pe);const Ae=document.createElement("div");Ae.className="item-editor__header";const $e=document.createElement("h2");$e.className="item-editor__title",$e.textContent="Edit category";const Ne=document.createElement("button");Ne.type="button",Ne.className="item-editor__close",Ne.setAttribute("aria-label","Close category editor"),Ne.textContent="×",Ae.appendChild($e),Ae.appendChild(Ne),pe.appendChild(Ae);const Te=document.createElement("form");Te.className="item-editor__form",pe.appendChild(Te);const _t=document.createElement("div");_t.className="item-editor__meta",_t.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',Te.appendChild(_t);const Oe=document.createElement("div");Oe.className="item-editor__error",Oe.hidden=!0,Te.appendChild(Oe);const Me=(Et,Ge,En)=>{const It=document.createElement("label");It.className="item-editor__field";const sn=document.createElement("span");if(sn.className="item-editor__label",sn.textContent=Et,It.appendChild(sn),Ge.classList.add("item-editor__control"),It.appendChild(Ge),En){const Wn=document.createElement("div");Wn.className="item-editor__hint",Wn.textContent=En,It.appendChild(Wn)}return It},St=document.createElement("input");St.type="text",Te.appendChild(Me("Title",St,"Display label shown in the map."));const rn=document.createElement("input");rn.type="text",rn.required=!0,Te.appendChild(Me("ID",rn,"Unique identifier for this category (used in URLs and references)."));const qt=document.createElement("div");qt.className="item-editor__actions";const kt=document.createElement("button");kt.type="submit",kt.className="item-editor__action item-editor__action--primary",kt.textContent="Save";const Vt=document.createElement("button");return Vt.type="button",Vt.className="item-editor__action",Vt.textContent="Cancel",qt.appendChild(kt),qt.appendChild(Vt),Te.appendChild(qt),Te.addEventListener("submit",Et=>{Et.preventDefault(),g()}),Vt.addEventListener("click",d),Ne.addEventListener("click",d),F.addEventListener("click",d),x.addEventListener("keydown",Et=>{Et.key==="Escape"&&(Et.preventDefault(),d())}),document.body.appendChild(x),r.wrapper=x,r.fields={titleInput:St,idInput:rn,errorEl:Oe,metaLabel:_t.querySelector(".item-editor__meta-value")},x};return{open:x=>{if(!x||!N())return!1;const pe=e(),$e=((pe==null?void 0:pe.categories)||[]).find(Ne=>Ne.id===x);return $e?(r.categoryId=$e.id,r.modelData=pe,r.fields.metaLabel.textContent=$e.title||$e.id||"Category",r.fields.titleInput.value=$e.title||$e.id||"",r.fields.idInput.value=$e.id||"",a(""),p(),!0):!1},hide:d,isOpen:()=>!!r.wrapper&&r.wrapper.hidden===!1}}const fs=ps({getActiveModelData:()=>{var e;return(e=k[v])==null?void 0:e.data},loadActiveIntoEditor:dt,rebuildFromActive:st,selectCategory:(e,t={})=>Mt(e,t),onCategoryRenamed:(e,t)=>{oe===e&&(oe=t,rt())}});function ri(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const i={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[i],e.apicurioActiveVersionIndex=0;const o=e.title||Pe(e);return gt(e,{seriesName:o,fallbackTitle:o}),e.isSeries=!0,e}function jt(e,{versionLabel:t,createdOn:n}={}){var p,h,g;if(e!=null&&e.isSeries||((p=e==null?void 0:e.apicurioVersions)==null?void 0:p.length)>1){const N=e.title||Pe(e);gt(e,{seriesName:N,fallbackTitle:N})}const i=Ze(e);if(!i)return ri(e,{versionLabel:t||"1",createdOn:n}),k.push(e),k.length-1;const o=k.findIndex(N=>Ze(N)===i);if(o===-1)return ri(e,{versionLabel:t||"1",createdOn:n}),k.push(e),k.length-1;const r=k[o];if(!Array.isArray(r.apicurioVersions)||!r.apicurioVersions.length){r.apicurioVersions=[{version:"1",data:r.data,createdOn:(g=(h=r.apicurioVersions)==null?void 0:h[0])==null?void 0:g.createdOn}],r.apicurioActiveVersionIndex=0;const N=r.title||Pe(r);gt(r,{seriesName:N,fallbackTitle:N})}const a=String(r.apicurioVersions.length+1);r.apicurioVersions.push({version:a,data:e.data,createdOn:n||new Date().toISOString()}),r.apicurioActiveVersionIndex=r.apicurioVersions.length-1,r.data=e.data,r.title=Pe(e)||r.title,r.isSeries=!0;const d=r.title||Pe(r);return gt(r,{seriesName:d,fallbackTitle:d}),o}function Lo({versionLabel:e}={}){var a;if(v<0||!k[v])throw new Error("Load or select a model before creating a version.");const t=k[v];ri(t,{versionLabel:"1"});let n;try{n=ls(t.data)}catch(d){throw console.warn("[Blockscape] failed to clone active model for versioning",d),new Error("Could not copy the current model.")}Zt(n,{titleHint:Pe(t),idHint:Ze(t)||In(t)});const o={version:e||String((((a=t.apicurioVersions)==null?void 0:a.length)||0)+1),data:n,createdOn:new Date().toISOString()};t.apicurioVersions.push(o),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=n,t.isSeries=!0;const r=t.title||Pe(t);return gt(t,{seriesName:r,fallbackTitle:r}),v}function Ii(){const e=v>=0&&k[v]?k[v]:null,t=Ze(e);document.title=t?`${t}-blockscape`:je}function Ci(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||Pe(e);return gt(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function ms(){const e=k[v],t=Ci(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function To(e="shortcut",t=!1){const n=s.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=k[v],o=t?Ci(i):null,r=!!o,a=r?JSON.stringify(o,null,2):n,d=In(i),p=Ze(i),h=d||p||Pe(i,"blockscape"),g=r?"-series":"",N=`${Tn(h)}${g}.bs`;return $r(N,a),console.log(`[Blockscape] saved JSON (${e}):`,N),!0}const hs={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function Bo(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return hs[n]||"#9ca3af"}function gs(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(p=>p+p).join(""):t,i=parseInt(n,16),o=i>>16&255,r=i>>8&255,a=i&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(r/255,2.2)+.0722*Math.pow(a/255,2.2)>.35?"#111111":"#ffffff"}function bs(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function $o(){if(we)return;we=document.createElement("div"),we.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",wt=document.createElement("span"),wt.className="series-nav-notice__text",we.appendChild(e),we.appendChild(wt),document.body.appendChild(we)}function Oo(){Ft&&(clearTimeout(Ft),Ft=null),we&&we.classList.remove("is-visible"),wt&&(wt.textContent="")}function hn(){vt=null,ne&&(clearTimeout(ne),ne=null),Oo()}function vs(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function ws(e,t,n){$o(),vt={id:e,targetVersionIndex:t},ne&&clearTimeout(ne),ne=setTimeout(()=>{ne=null,hn()},mn);const i=vs(n,t);xi(`Click again to open ${i} in this series.`,mn)}function xi(e,t=Rt,n=null){if($o(),wt.textContent="",wt.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener",o.textContent=n,wt.appendChild(i),wt.appendChild(o)}we.classList.add("is-visible"),Ft&&clearTimeout(Ft),Ft=setTimeout(()=>Oo(),t)}function ys(){ge&&(ge.innerHTML="",cs.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((o,r)=>{if(r>0){const d=document.createElement("span");d.className="shortcut-help__or",d.textContent="or",n.appendChild(d)}const a=document.createElement("div");a.className="shortcut-help__combo",o.forEach((d,p)=>{if(p>0){const g=document.createElement("span");g.className="shortcut-help__sep",g.textContent="+",a.appendChild(g)}const h=document.createElement("kbd");h.className="shortcut-help__key",h.textContent=d,a.appendChild(h)}),n.appendChild(a)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),ge.appendChild(t)}),bt=!0)}function Es(){return!!ee&&ee.hidden===!1}function _s(){if(!ee)return;bt||ys(),ct=document.activeElement,ee.hidden=!1,ee.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=ee.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Ai(){if(!ee||ee.hidden)return;ee.hidden=!0,ee.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=ct;e!=null&&e.focus?e.focus({preventScroll:!0}):B!=null&&B.focus&&B.focus({preventScroll:!0})}function Ss(){if(!Y)return;Y.hidden=!1,Y.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Y.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Ni(){!Y||Y.hidden||(Y.hidden=!0,Y.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),ce!=null&&ce.focus&&ce.focus({preventScroll:!0}))}let Li=!1;function Hn(){Li||(Li=!0,requestAnimationFrame(()=>{Li=!1,$i(),vn()}))}let Mo=!1;function Vo(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function ks(e){const t=Vo(e);if(!t.length){u.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}u.querySelectorAll(".tile").forEach(n=>{var a;const i=(((a=n.querySelector(".name"))==null?void 0:a.textContent)||"").toLowerCase(),o=(n.dataset.id||"").toLowerCase(),r=t.every(d=>i.includes(d)||o.includes(d));n.style.opacity=r?"1":"0.2"})}function Is(e){const t=Vo(e);if(!t.length)return[];const n=[];return k.forEach((i,o)=>{var h;const r=ki(i),a=Ze(i)||"",d=`${r} ${a}`.toLowerCase();t.every(g=>d.includes(g))&&n.push({type:"model",modelIndex:o,modelTitle:r,modelId:a}),(Array.isArray((h=i.data)==null?void 0:h.categories)?i.data.categories:[]).forEach(g=>{const N=(g.title||g.id||"").toString();(g.items||[]).forEach(C=>{const x=(C.name||C.id||"").toString(),F=`${x} ${C.id||""} ${N}`.toLowerCase();t.every(pe=>F.includes(pe))&&n.push({type:"item",modelIndex:o,modelTitle:r,modelId:a,itemId:C.id,itemName:x,categoryTitle:N})})})}),n.slice(0,Ei)}function Ro(e){if(!$)return;$.innerHTML="";const t=(e||"").toString();if(!t.trim()){$.hidden=!0;return}if(!k.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",$.appendChild(i),$.hidden=!1;return}const n=Is(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",$.appendChild(i),$.hidden=!1;return}n.forEach(i=>{const o=document.createElement("button");o.type="button",o.className="search-result",o.dataset.modelIndex=String(i.modelIndex),i.itemId&&(o.dataset.itemId=i.itemId),i.type&&(o.dataset.type=i.type),i.modelIndex===v&&(!i.itemId||O===i.itemId)&&o.classList.add("is-active");const r=document.createElement("div");r.className="search-result__primary";const a=document.createElement("span");a.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",r.appendChild(a);const d=document.createElement("span");d.className="search-result__badge",d.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",r.appendChild(d);const p=document.createElement("div");p.className="search-result__meta";const h=document.createElement("span");if(h.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,p.appendChild(h),i.type==="item"&&i.itemId){const g=document.createElement("span");g.textContent=`Item ID: ${i.itemId}`,p.appendChild(g)}else if(i.type==="model"){const g=document.createElement("span");g.textContent="Matches model title",p.appendChild(g)}o.appendChild(r),o.appendChild(p),$.appendChild(o)}),$.hidden=!1}function Po(e){ks(e||""),Ro(e||"")}function Cs(e){!e||!Number.isInteger(e.modelIndex)||(lt(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(v!==e.modelIndex)return;const t=(n=ie.get(e.itemId))==null?void 0:n.el;t&&(ut(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function lt(e){if(yt(),hn(),Fe=null,at=null,oe=null,me=null,e<0||e>=k.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}pn=!0,v=e,console.log("[Blockscape] active model:",Pe(k[e]),"(index",e+" )"),Ii(),en(),dt(),st(),Se&&Po(Se.value||""),ve.updateAvailability()}function en(){if(V.innerHTML="",!k.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",V.appendChild(e);return}k.forEach((e,t)=>{var N;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===v?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===v?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const r=document.createElement("span");r.className="model-nav-title",r.textContent=ki(e),o.appendChild(r);const a=Ze(e);if(a){const C=document.createElement("span");C.className="model-nav-id",C.textContent=a,o.appendChild(C)}const d=Array.isArray((N=e.data)==null?void 0:N.categories)?e.data.categories:[],p=d.reduce((C,x)=>C+(x.items||[]).length,0),h=document.createElement("span");h.className="model-nav-meta";const g=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";h.textContent=`${d.length} cat · ${p} items${g}`,i.appendChild(o),i.appendChild(h),n.appendChild(i),V.appendChild(n)}),ve.updateAvailability()}function dt(){if(v<0){s.value="",G&&(G.disabled=!0);return}const e=k[v];s.value=JSON.stringify(e.data,null,2),G&&(G.disabled=!Ci(e))}function xs(e){try{return JSON.parse(e)}catch{return null}}function As(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const o=i.map((g,N)=>!g||typeof g!="object"?null:(Zt(g,{titleHint:`${t} #${N+1}`}),{obj:g,idx:N})).filter(Boolean);if(!o.length)return[];const r=o[0].obj,{seriesTitleOverride:a}=n;let d=a||r.title||`${t} series`;a&&!r.title&&(r.title=a);const p={id:Xt(),title:d,data:r,apicurioVersions:o.map(({obj:g,idx:N})=>({version:String(N+1),data:g})),apicurioActiveVersionIndex:0,isSeries:!0},h=gt(p,{seriesName:d,fallbackTitle:d});return h&&(p.id=h),[p]}function Uo(e,t="Pasted",n={}){return Array.isArray(e)?As(e,t,n):!e||typeof e!="object"?[]:(Zt(e,{titleHint:`${t} #1`}),[{id:Xt(),title:e.title||`${t} #1`,data:e}])}function tn(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const o=xs(i);if(o){let a=n;if(Array.isArray(o)&&n.promptForSeriesName){const p=ss(o,t),h=rs(p);a={...n,promptForSeriesName:!1,seriesTitleOverride:h||p}}const d=Uo(o,t,a);if(d.length)return d}return i.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,d)=>{const p=JSON.parse(a);return Zt(p,{titleHint:`${t} #${d+1}`}),{id:Xt(),title:p.title||`${t} #${d+1}`,data:p}})}function Ns(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function nn(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!Ns(e)}function Ls(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function Do(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(be)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(be)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(be)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=tn(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let i=null;return n.forEach(o=>{const r=jt(o,{versionLabel:"editor"});i==null&&(i=r)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function Ho(e="storage"){const t=Do();return!t||typeof t.index!="number"?!1:(lt(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function Ts(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let i;try{const a=Br(t);i=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=Uo(i.data,i.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let r=null;return o.forEach(a=>{const d=a.isSeries?i.title||a.title:null,p=jt({...a,apicurioArtifactName:d||a.apicurioArtifactName},{versionLabel:"shared"});r==null&&(r=p)}),r}async function Bs(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await Ri(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function $s(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(r=>(r.items||[]).forEach(a=>{i.add(a.id);const d=new Set(a.deps||[]);(e.links||[]).forEach(p=>{p.from===a.id&&d.add(p.to)}),t.set(a.id,d),d.forEach(p=>{n.has(p)||n.set(p,new Set),n.get(p).add(a.id)})}));const o=new Set;return n.forEach((r,a)=>{((r==null?void 0:r.size)||0)>=2&&o.add(a)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:i}}function Os(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const o=n.getContext("2d"),r=(e||"?").charAt(0).toUpperCase(),a=Bo(e,t),d=gs(a);return o.fillStyle=a,o.beginPath(),o.arc(i/2,i/2,i/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=d,o.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(r,i/2,i/2),n.toDataURL("image/png")}function on(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Fo(e){const t=on(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Ms(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var a,d;const o=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();o&&t.set(o,i);const r=(((d=n==null?void 0:n.data)==null?void 0:d.seriesId)??"").toString().trim();r&&!t.has(r)&&t.set(r,i)}),t}const jo=new WeakMap;function Vs(e,t){var $e;if(!(($e=e==null?void 0:e.apicurioVersions)!=null&&$e[t]))return null;const n=e.apicurioVersions[t],i=n.data,o=oi(i),r=jo.get(n);if(r&&r.fingerprint===o)return r.dataUrl;const a=160,d=90,p=document.createElement("canvas");p.width=a,p.height=d;const h=p.getContext("2d");h.fillStyle="#f8fafc",h.fillRect(0,0,a,d),h.strokeStyle="#e5e7eb",h.strokeRect(.5,.5,a-1,d-1);const g=Array.isArray(i==null?void 0:i.categories)?i.categories:[],N=Math.max(g.length,1),C=a/N,x=8,F=8,pe=4;g.forEach((Ne,Te)=>{const _t=Te*C+C/2,Oe=Array.isArray(Ne.items)?Ne.items:[],Me=Math.max(Oe.length,1);Oe.forEach((St,rn)=>{const qt=x+(rn+.5)*((d-x-F)/Me);h.beginPath(),h.arc(_t,qt,pe,0,Math.PI*2);const kt=Bo(St.name||St.id||"",St.color);h.fillStyle=kt,h.strokeStyle="rgba(15,23,42,0.25)",h.fill(),h.stroke()})});const Ae=p.toDataURL("image/png");return jo.set(n,{fingerprint:o,dataUrl:Ae}),Ae}function Ti(e,t){var d;if(hn(),e<0||e>=k.length)return!1;const n=k[e];if(!((d=n==null?void 0:n.apicurioVersions)!=null&&d.length)||!xo(e))return!1;const o=n.apicurioVersions.length,r=(t%o+o)%o,a=n.apicurioVersions[r];return a!=null&&a.data?(n.apicurioActiveVersionIndex=r,n.data=a.data,pn=!0,O=null,xe=null,rt(),dt(),st(),!0):!1}function Bi(e){var i;if(!e||v<0)return!1;const t=k[v];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return!1;const n=on(t);return n===-1?!1:Ti(v,n+e)}function Rs(e,t){if(hn(),e<0||e>=k.length)return!1;const n=k[e];if(!Array.isArray(n==null?void 0:n.apicurioVersions)||n.apicurioVersions.length<=1)return alert("A series needs at least one map. Add another before removing this one."),!1;if(!xo(e))return!1;const i=Math.min(Math.max(t,0),n.apicurioVersions.length-1),o=on(n),[r]=n.apicurioVersions.splice(i,1);if(!r)return!1;let a=o;i===o?a=Math.min(i,n.apicurioVersions.length-1):i<o&&(a=Math.max(0,o-1)),n.apicurioActiveVersionIndex=Math.max(0,a);const d=n.apicurioVersions[n.apicurioActiveVersionIndex];return n.data=(d==null?void 0:d.data)||n.data,n.isSeries=n.apicurioVersions.length>1,lt(e),!0}function Ps(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||Ze(e)||"Artifact",n.title="Double-click to rename this series",n.setAttribute("role","button"),n.tabIndex=0,n.addEventListener("dblclick",()=>{var F;const C=k[v];!((F=C==null?void 0:C.apicurioVersions)!=null&&F.length)||!as(C)||(en(),dt(),st())}),t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const o=on(e),r=Fo(e)||"latest";i.textContent=`No. in series ${r} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const a=document.createElement("div");a.className="version-nav__controls";const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Previous",d.addEventListener("click",()=>Bi(-1));const p=document.createElement("button");p.type="button",p.className="version-nav__button",p.textContent="Next",p.addEventListener("click",()=>Bi(1)),a.appendChild(d),a.appendChild(p),t.appendChild(a);const h=document.createElement("div");h.className="version-nav__thumbs",e.apicurioVersions.forEach((C,x)=>{var _t;const F=document.createElement("button");F.type="button",F.className="version-nav__thumb",x===o&&F.classList.add("is-active");const pe=Vs(e,x);if(pe){const Oe=document.createElement("img");Oe.src=pe,Oe.alt=`Version ${x+1}`,F.appendChild(Oe)}const Ae=document.createElement("div");Ae.className="version-nav__thumb-label";const $e=document.createElement("span");$e.className="version-nav__thumb-label-text";const Ne=(((_t=C==null?void 0:C.data)==null?void 0:_t.id)??(C==null?void 0:C.id)??"").toString().trim(),Te=Ne||(C!=null&&C.version?`v${C.version}`:`${x+1}`);if($e.textContent=Te,Ae.title=Ne||Te,Ae.appendChild($e),F.appendChild(Ae),Ws(Ae,$e),e.apicurioVersions.length>1){const Oe=document.createElement("span");Oe.className="version-nav__thumb-remove",Oe.title=`Remove ${Te} from this series`,Oe.setAttribute("aria-label",`Remove ${Te} from this series`),Oe.setAttribute("role","button"),Oe.tabIndex=-1,Oe.textContent="×",Oe.addEventListener("click",Me=>{Me.stopPropagation(),Me.preventDefault(),window.confirm(`Remove ${Te} from this series?`)&&Rs(v,x)}),F.appendChild(Oe)}F.addEventListener("click",()=>Ti(v,x)),zs(F,C),h.appendChild(F)});const g=document.createElement("button");g.type="button",g.className="version-nav__thumb version-nav__thumb--add",g.title="Create a new version from this map",g.addEventListener("click",()=>{try{const C=Lo({versionLabel:"manual"});lt(C)}catch(C){alert((C==null?void 0:C.message)||"Unable to create a new version right now.")}});const N=document.createElement("span");return N.className="version-nav__thumb-add-icon",N.textContent="+",g.appendChild(N),h.appendChild(g),t.appendChild(h),t}function gn(){var dr,ur,pr;if(!R)return;Dt(),Array.isArray(R.m.categories)||(R.m.categories=[]),console.log("[Blockscape] rendering categories=",R.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!R.m.abstract,"- value:",R.m.abstract?R.m.abstract.substring(0,50)+"...":"none"),u.innerHTML="",ie.clear(),Je.clear(),Kt=[],ri(k[v],{versionLabel:"1"});const e=Ps(k[v]);e&&u.appendChild(e),I.setAttribute("width",window.innerWidth),I.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=R.m.title&&R.m.title.trim()||Pe(k[v]),t.appendChild(n),((dr=k[v])!=null&&dr.isSeries||(pr=(ur=k[v])==null?void 0:ur.apicurioVersions)!=null&&pr.length)&&gt(k[v],{seriesName:k[v].title||R.m.title||Pe(k[v])});const i=Fo(k[v]),o=In(k[v]),r=(R.m.id??"").toString().trim(),a=document.createElement("div");a.className="blockscape-model-meta__details";const d=(b,z)=>{if(!z)return;const U=document.createElement("div");U.className="blockscape-model-id";const ye=document.createElement("span");ye.className="blockscape-model-id__label",ye.textContent=b;const ze=document.createElement("span");ze.className="blockscape-model-id__value",ze.textContent=z,U.append(ye,ze),a.appendChild(U)};d("Series ID",o),d("Model ID",r),d("No. in series",i),a.childElementCount&&t.appendChild(a),u.appendChild(t);const p=document.createElement("div");p.className="blockscape-tabs";const h=document.createElement("div");h.className="blockscape-tablist",h.setAttribute("role","tablist"),p.appendChild(h);const g=document.createElement("div");g.className="blockscape-tabpanels",p.appendChild(g);const N=document.createElement("div"),C=document.createElement("div"),x=document.createElement("div"),F=document.createElement("div");let pe="";const Ae=Ms(k[v]),$e=on(k[v]);Pt=null,un="";const Ne=[{id:"map",label:"Map",panel:N},{id:"abstract",label:"Info",panel:C},{id:"source",label:"Settings",panel:x},{id:"apicurio",label:"Apicurio",panel:F}],Te=typeof ve.isEnabled=="function"?ve.isEnabled():!1,_t=b=>{if(!I)return;const z=b==="map";I.hidden=!z,z?($i(),vn()):I.innerHTML=""};Ne.forEach((b,z)=>{const U=document.createElement("button");U.type="button",U.id=`tab-${b.id}`,U.className="blockscape-tab"+(z===0?" is-active":""),U.setAttribute("role","tab"),U.setAttribute("aria-controls",`panel-${b.id}`),U.setAttribute("aria-selected",z===0?"true":"false"),U.textContent=b.label,b.id==="apicurio"&&!Te&&(U.hidden=!0,U.tabIndex=-1,U.setAttribute("aria-hidden","true"),U.style.display="none"),b.button=U,h.appendChild(U),b.panel.id=`panel-${b.id}`,b.panel.classList.add("blockscape-tabpanel"),b.panel.setAttribute("role","tabpanel"),b.panel.setAttribute("aria-labelledby",U.id),b.panel.hidden=z!==0,z===0&&b.panel.classList.add("is-active"),g.appendChild(b.panel)});const Oe=b=>{qe=b,Ne.forEach(z=>{const U=z.id===b;z.button.classList.toggle("is-active",U),z.button.setAttribute("aria-selected",U?"true":"false"),z.panel.classList.toggle("is-active",U),z.panel.hidden=!U}),_t(b)},Me=Ne.find(b=>b.id==="apicurio"),St=b=>{if(!Me||!Me.button||!Me.panel)return;const z=!!b;if(Me.button.hidden=!z,Me.button.tabIndex=z?0:-1,Me.button.setAttribute("aria-hidden",z?"false":"true"),Me.button.style.display=z?"":"none",z){const U=qe==="apicurio";Me.button.classList.toggle("is-active",U),Me.button.setAttribute("aria-selected",U?"true":"false"),Me.panel.classList.toggle("is-active",U),Me.panel.hidden=!U}else{const U=Me.panel.classList.contains("is-active");if(Me.button.classList.remove("is-active"),Me.button.setAttribute("aria-selected","false"),Me.panel.classList.remove("is-active"),Me.panel.hidden=!0,U){const ye=Ne.find(ze=>ze.id!=="apicurio");ye&&Oe(ye.id)}}fn&&(fn.checked=z)};Ne.forEach(b=>{b.button.addEventListener("click",()=>{Dt(),Oe(b.id)}),b.id==="abstract"&&(Pt=b.button,b.button.addEventListener("mouseenter",()=>Jn(b.button,pe,{offset:12})),b.button.addEventListener("mouseleave",Dt),b.button.addEventListener("focus",()=>Jn(b.button,pe,{offset:12})),b.button.addEventListener("blur",Dt))});const qt=(b=>{const z=Ne.find(ye=>ye.id===qe);if(z&&(z.id!=="apicurio"||b))return z.id;const U=Ne.find(ye=>ye.id!=="apicurio"||b);return(U==null?void 0:U.id)||Ne[0].id})(Te);Oe(qt),St(Te),typeof ve.onEnabledChange=="function"&&ve.onEnabledChange(St),u.appendChild(p);const kt=document.createElement("div");kt.className="blockscape-render",N.appendChild(kt);const Vt=document.createElement("div");if(Vt.className="blockscape-abstract-panel",R.m.abstract){console.log("[Blockscape] Rendering abstract content");const b=document.createElement("div");b.className="blockscape-abstract",b.innerHTML=R.m.abstract,Ea(b),Vt.appendChild(b),pe=b.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const b=document.createElement("div");b.className="blockscape-abstract-placeholder",b.textContent="No abstract has been provided for this model.",Vt.appendChild(b),pe=b.outerHTML}un=pe,C.appendChild(Vt);const Et=document.createElement("div");Et.className="blockscape-source-panel";const Ge=document.createElement("div");Ge.className="blockscape-settings-panel";const En=document.createElement("p");En.className="blockscape-settings-panel__title",En.textContent="Feature toggles",Ge.appendChild(En);const It=({id:b,label:z,hint:U,checked:ye,className:ze="",onChange:Ce})=>{const ht=document.createElement("label");ht.className=["settings-toggle",ze].filter(Boolean).join(" ");const Tt=document.createElement("input");Tt.type="checkbox",Tt.id=b,Tt.checked=ye;const Ue=document.createElement("span");Ue.className="settings-toggle__text";const Bt=document.createElement("span");if(Bt.className="settings-toggle__label",Bt.textContent=z,Ue.appendChild(Bt),U){const an=document.createElement("span");an.className="settings-toggle__hint",an.textContent=U,Ue.appendChild(an)}return ht.appendChild(Tt),ht.appendChild(Ue),typeof Ce=="function"&&Tt.addEventListener("change",()=>Ce(Tt.checked)),{row:ht,input:Tt}},sn=()=>{u.querySelectorAll(".tile").forEach(b=>{const z=b.dataset.id,U=No(z);if(!(U!=null&&U.item))return;const ye=Vi(U.item.external),ze=Go(U.item,{externalMeta:ye,seriesIdLookup:Ae});zo(b,ze,{hasExternal:!!ye.url||ye.isExternal})})},{row:Wn}=It({id:"toggleSecondaryLinks",label:"Show indirect links",checked:nt,className:"map-controls__toggle",onChange:b=>{nt=b,O?ut(O):(Mi(),vn())}});Ge.appendChild(Wn);const{row:Ia}=It({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:ke,className:"map-controls__toggle",onChange:b=>{ke=b,qo()}});Ge.appendChild(Ia);const nr=[],{row:Ca}=It({id:"toggleObsidianLinks",label:"Obsidian",hint:"Make tiles open Obsidian when no external URL exists.",checked:ot,className:"map-controls__toggle",onChange:b=>{const z=Un(b);ts(z),nr.forEach(U=>{U.disabled=!z}),sn()}});Ge.appendChild(Ca);const Pi=document.createElement("div");Pi.className="settings-radio";const Ui=document.createElement("div");Ui.className="settings-radio__label",Ui.textContent="Obsidian link format";const Di=document.createElement("div");Di.className="settings-radio__hint",Di.textContent="Use the tile title or id when building Obsidian links.";const Hi=document.createElement("div");Hi.className="settings-radio__options";const ir=(b,z)=>{const U=document.createElement("label");U.className="settings-radio__option";const ye=document.createElement("input");ye.type="radio",ye.name="obsidianLinkMode",ye.value=b,ye.checked=Ut===b,ye.disabled=!ot,ye.addEventListener("change",()=>{if(!ye.checked)return;const Ce=Pn(b);Qr(Ce),sn()});const ze=document.createElement("span");ze.textContent=z,U.append(ye,ze),nr.push(ye),Hi.appendChild(U)};ir(Xe,"Use title"),ir(ue,"Use id"),Pi.append(Ui,Hi,Di),Ge.appendChild(Pi);const ai=document.createElement("label");ai.className="settings-text",ai.setAttribute("for","obsidianVaultInput");const Fi=document.createElement("div");Fi.className="settings-text__text";const ji=document.createElement("span");ji.className="settings-text__label",ji.textContent="Obsidian vault";const Ji=document.createElement("span");Ji.className="settings-text__hint",Ji.textContent="Optional. Set the vault name to avoid duplicates.",Fi.append(ji,Ji);const Wt=document.createElement("input");Wt.type="text",Wt.id="obsidianVaultInput",Wt.className="settings-text__input",Wt.placeholder="Vault name",Wt.value=Ot,Wt.addEventListener("input",()=>{const b=Dn(Wt.value);is(b),sn()}),ai.append(Fi,Wt),Ge.appendChild(ai);const qi=document.createElement("p");qi.className="settings-note",qi.innerHTML='Requires the Obsidian <a href="https://vinzent03.github.io/obsidian-advanced-uri/" target="_blank" rel="noreferrer noopener">Advanced URI</a> plugin for create/open behavior.',Ge.appendChild(qi);const or=b=>`${(b/1e3).toFixed(1)}s`,ci=document.createElement("label");ci.className="settings-slider",ci.setAttribute("for","seriesNavDoubleClickWait");const Wi=document.createElement("div");Wi.className="settings-slider__text";const Gi=document.createElement("span");Gi.className="settings-slider__label",Gi.textContent="Series double-click wait";const zi=document.createElement("span");zi.className="settings-slider__hint",zi.textContent="Time window to double-click into another map version.",Wi.append(Gi,zi);const li=document.createElement("span");li.className="settings-slider__value",li.textContent=or(mn);const Ct=document.createElement("input");Ct.type="range",Ct.id="seriesNavDoubleClickWait",Ct.className="settings-slider__input",Ct.min=String(So),Ct.max=String(ko),Ct.step="50",Ct.value=String(mn),Ct.setAttribute("aria-label","Adjust double-click wait for series navigation"),Ct.addEventListener("input",()=>{const b=Rn(parseInt(Ct.value,10));li.textContent=or(b),Yr(b)}),ci.append(Wi,li,Ct),Ge.appendChild(ci);const rr=b=>`${Math.round((b-1)*100)}%`,di=document.createElement("label");di.className="settings-slider",di.setAttribute("for","hoverScaleSlider");const Ki=document.createElement("div");Ki.className="settings-slider__text";const Yi=document.createElement("span");Yi.className="settings-slider__label",Yi.textContent="Hover zoom";const Xi=document.createElement("span");Xi.className="settings-slider__hint",Xi.textContent="Expand tiles on hover to see more detail.",Ki.append(Yi,Xi);const ui=document.createElement("span");ui.className="settings-slider__value",ui.textContent=rr(it);const xt=document.createElement("input");xt.type="range",xt.id="hoverScaleSlider",xt.className="settings-slider__input",xt.min=String(ei),xt.max=String(ti),xt.step="0.1",xt.value=String(it),xt.setAttribute("aria-label","Adjust hover zoom"),xt.addEventListener("input",()=>{const b=Bn(parseFloat(xt.value));ui.textContent=rr(b),Ur(b),O&&Hn()}),di.append(Ki,ui,xt),Ge.appendChild(di);const sr=b=>b===1?"Default":`${Math.round(b*100)}%`,pi=document.createElement("label");pi.className="settings-slider",pi.setAttribute("for","tileCompactnessSlider");const Zi=document.createElement("div");Zi.className="settings-slider__text";const Qi=document.createElement("span");Qi.className="settings-slider__label",Qi.textContent="Tile compactness";const eo=document.createElement("span");eo.className="settings-slider__hint",eo.textContent="Adjust padding, gap, and logo size for tiles.",Zi.append(Qi,eo);const fi=document.createElement("span");fi.className="settings-slider__value",fi.textContent=sr(Ie);const At=document.createElement("input");At.type="range",At.id="tileCompactnessSlider",At.className="settings-slider__input",At.min=String(_e),At.max=String(He),At.step="0.05",At.value=String(Ie),At.setAttribute("aria-label","Adjust tile compactness"),At.addEventListener("input",()=>{const b=$n(parseFloat(At.value));fi.textContent=sr(b),Hr(b),O&&Hn()}),pi.append(Zi,fi,At),Ge.appendChild(pi);const{row:xa}=It({id:"titleWrapToggle",label:"Wrap titles",hint:"Allow long titles to wrap instead of truncating.",checked:et!=="nowrap",className:"map-controls__toggle",onChange:b=>{const z=b?"wrap":"nowrap";Vn(z),Gr(z)}});Ge.appendChild(xa);const ar=b=>`${Math.round((b-1)*100)}% extra`,mi=document.createElement("label");mi.className="settings-slider",mi.setAttribute("for","titleHoverWidthSlider");const to=document.createElement("div");to.className="settings-slider__text";const no=document.createElement("span");no.className="settings-slider__label",no.textContent="Title width on hover";const io=document.createElement("span");io.className="settings-slider__hint",io.textContent="Give titles more room horizontally when zoomed.",to.append(no,io);const hi=document.createElement("span");hi.className="settings-slider__value",hi.textContent=ar(We);const Nt=document.createElement("input");Nt.type="range",Nt.id="titleHoverWidthSlider",Nt.className="settings-slider__input",Nt.min=String(m),Nt.max=String(L),Nt.step="0.05",Nt.value=String(We),Nt.setAttribute("aria-label","Adjust title width boost on hover"),Nt.addEventListener("input",()=>{const b=On(parseFloat(Nt.value));hi.textContent=ar(b),jr(b)}),mi.append(to,hi,Nt),Ge.appendChild(mi);const cr=b=>`${Math.round(b*100)}% of hover zoom`,gi=document.createElement("label");gi.className="settings-slider",gi.setAttribute("for","titleZoomPortionSlider");const oo=document.createElement("div");oo.className="settings-slider__text";const ro=document.createElement("span");ro.className="settings-slider__label",ro.textContent="Title zoom influence";const so=document.createElement("span");so.className="settings-slider__hint",so.textContent="How much the title scales relative to tile hover zoom.",oo.append(ro,so);const bi=document.createElement("span");bi.className="settings-slider__value",bi.textContent=cr(mt);const Lt=document.createElement("input");Lt.type="range",Lt.id="titleZoomPortionSlider",Lt.className="settings-slider__input",Lt.min=String(M),Lt.max=String(re),Lt.step="0.05",Lt.value=String(mt),Lt.setAttribute("aria-label","Adjust how much titles scale on hover"),Lt.addEventListener("input",()=>{const b=Mn(parseFloat(Lt.value));bi.textContent=cr(b),qr(b)}),gi.append(oo,bi,Lt),Ge.appendChild(gi);const Aa=typeof ve.isEnabled=="function"?ve.isEnabled():!1,{row:Na,input:La}=It({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:Aa,className:"apicurio-toggle",onChange:b=>{typeof ve.setEnabled=="function"&&ve.setEnabled(b)}});if(fn=La,Ge.appendChild(Na),Et.appendChild(Ge),l)l.hidden=!1,l.classList.remove("pf-v5-c-page__main-section"),Et.appendChild(l);else{const b=document.createElement("p");b.className="muted",b.textContent="Source editor unavailable.",Et.appendChild(b)}x.appendChild(Et),ve.mount(F);let lr=0;R.m.categories.forEach(b=>{const z=document.createElement("section");z.className="category",z.dataset.cat=b.id;const U=document.createElement("div");U.className="cat-head",U.dataset.cat=b.id,U.tabIndex=0,U.title="Select category",U.innerHTML=`<div class="cat-title">${wn(b.title||b.id)}</div>
                          <div class="muted cat-count">${(b.items||[]).length} items</div>`,U.addEventListener("click",()=>Mt(b.id)),U.addEventListener("keydown",Ce=>{(Ce.key==="Enter"||Ce.key===" ")&&(Ce.preventDefault(),Mt(b.id))}),U.addEventListener("focus",()=>Mt(b.id,{scrollIntoView:!1})),z.appendChild(U);const ye=document.createElement("div");ye.className="grid",z.appendChild(ye),(b.items||[]).forEach(Ce=>{lr+=1;const ht=Vi(Ce.external),Tt=Go(Ce,{externalMeta:ht,seriesIdLookup:Ae}),Ue=document.createElement("div");if(Ue.className=ht.isExternal?"tile external":"tile",Ue.tabIndex=0,Ue.dataset.id=Ce.id,Ue.dataset.globalIndex=String(lr),ht.url&&(Ue.dataset.externalUrl=ht.url),Ae.has(Ce.id)){const zn=Ae.get(Ce.id);Ue.dataset.seriesVersionIndex=String(zn),Ue.classList.add("tile--series-link");const Ta=zn===$e?"Current map in this series":`Open version ${zn+1} in this series`;Ue.title=Ta}Tt&&(Ue.dataset.obsidianUrl=Tt);const Bt=document.createElement("img");Bt.className="logo",Ce.logo?(Bt.src=Ce.logo,Bt.alt=Ce.name||Ce.id):(Bt.alt="",Bt.style.opacity=1,Bt.src=Os(Ce.name||Ce.id,Ce.color));const an=document.createElement("div");an.className="name",an.textContent=Ce.name||Ce.id;const ao=document.createElement("div");ao.className="tile-id",ao.textContent=Ce.id||"";const co=document.createElement("div");co.className="badge",co.textContent="reused";const _n=document.createElement("button");_n.type="button",_n.className="tile-delete",_n.setAttribute("aria-label",`Delete ${Ce.name||Ce.id}`),_n.textContent="×",_n.addEventListener("click",zn=>{zn.stopPropagation(),ba(Ce.id)}),ht.url&&Ue.appendChild(qs(ht.url)),zo(Ue,Tt,{hasExternal:ht.isExternal||!!ht.url}),Ue.appendChild(_n),Ue.appendChild(Bt),Ue.appendChild(an),Ue.appendChild(ao),Ue.appendChild(co),ye.appendChild(Ue),ie.set(Ce.id,{el:Ue,catId:b.id,rect:null})}),kt.appendChild(z),Je.set(b.id,{el:z,headEl:U});const ze=document.createElement("button");ze.type="button",ze.className="tile-add",ze.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',ze.addEventListener("click",()=>ra(b.id)),ye.appendChild(ze)});const Gn=document.createElement("button");Gn.type="button",Gn.className="category-add",Gn.innerHTML='<span class="category-add__icon" aria-hidden="true">+</span><span class="category-add__label">Add category</span><span class="category-add__hint">(Insert)</span>',Gn.addEventListener("click",()=>Zo()),kt.appendChild(Gn),qo(),Us(),$i(),vn(),bn(),Ks()}function Us(){u.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",n=>{var g;if(typeof n.button=="number"&&n.button!==0)return;yt();const i=e.dataset.id,o=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,r=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,a=k[v],d=a?on(a):-1,p=((g=a==null?void 0:a.apicurioVersions)==null?void 0:g.length)>1&&Number.isInteger(o)&&o!==d,h=vt&&vt.id===i&&vt.targetVersionIndex===o;if(vt&&!h&&hn(),p)if(h){if(hn(),Ti(v,o))return}else ws(i,o,a);else Number.isInteger(r)&&r>0&&r%5===0&&xi("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",i),O===i&&!(p&&h)){jn();return}ut(i)}),e.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())});const t=()=>{O&&Hn()};e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",t),e.addEventListener("focus",t),e.addEventListener("blur",t),e.draggable=!0,e.addEventListener("dragstart",Qs),e.addEventListener("dragend",ea)}),u.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",ta),e.addEventListener("drop",oa),e.addEventListener("dragenter",na),e.addEventListener("dragleave",ia)}),Mo||(Mo=!0,window.addEventListener("resize",Hn),window.addEventListener("scroll",Hn,{passive:!0}),window.addEventListener("resize",Ko)),document.getElementById("clear").onclick=()=>jn()}function $i(){ie.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function Jo(e,{includeSecondary:t=nt}={}){if(!e||!R)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(R.fwd.get(e)||[]),i=new Set(R.rev.get(e)||[]),o=new Set,r=new Set,a=[],d=new Set,p=(h,g,N,C)=>{if(!h||!g)return;const x=`${h}->${g}:${N}:${C}`;d.has(x)||(d.add(x),a.push({from:h,to:g,type:N,depth:C}))};return n.forEach(h=>p(e,h,"dep",1)),i.forEach(h=>p(e,h,"revdep",1)),t&&new Set([...n,...i]).forEach(g=>{(R.fwd.get(g)||new Set).forEach(x=>{const F=x===e;F||o.add(x),F||p(g,x,"dep",2)}),(R.rev.get(g)||new Set).forEach(x=>{const F=x===e;F||r.add(x),F||p(g,x,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:o,secondaryRevs:r,edges:a}}function si(e,t){const n=ie.get(e);n&&n.el.classList.add(t)}function ut(e){var d,p,h;if(!e)return;oe=null,O=e,me=null,xe=Jo(e),rt(),Mi(),bn();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:o}=xe;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const r=ie.get(e);r&&r.el.classList.add("selected"),t.forEach(g=>si(g,"dep")),n.forEach(g=>si(g,"revdep")),i.forEach(g=>{!t.has(g)&&g!==e&&si(g,"dep-indirect")}),o.forEach(g=>{!n.has(g)&&!t.has(g)&&g!==e&&si(g,"revdep-indirect")}),vn();const a=(h=(p=(d=ie.get(e))==null?void 0:d.el)==null?void 0:p.dataset)==null?void 0:h.externalUrl;a&&xi("This item has link to",Rt,a)}function Mt(e,{scrollIntoView:t=!0,preserveEntryHint:n=!1}={}){var a,d;if(!((a=R==null?void 0:R.m)!=null&&a.categories)||!e)return!1;const o=(R.m.categories||[]).find(p=>p.id===e);if(!o)return!1;yt(),Oi(),n||(me=null),oe=o.id,rt(),bn();const r=Je.get(o.id);return t&&(r!=null&&r.el)&&(r.el.scrollIntoView({behavior:"smooth",block:"center"}),(d=r.headEl)==null||d.focus({preventScroll:!0})),!0}function bn(){if(Je.forEach(({el:t,headEl:n})=>{t.classList.remove("category--selected"),n&&n.removeAttribute("aria-current")}),!oe)return;const e=Je.get(oe);if(!(e!=null&&e.el)){oe=null,me=null,rt();return}e.el.classList.add("category--selected"),e.headEl&&e.headEl.setAttribute("aria-current","true")}function Fn(){if(oe)return oe;const e=O?ie.get(O):null;return e!=null&&e.catId?e.catId:null}function Ds(e){var r,a,d,p;if(!((a=(r=R==null?void 0:R.m)==null?void 0:r.categories)!=null&&a.length)||!e)return!1;const t=R.m.categories,n=Fn();let i=t.findIndex(h=>h.id===n);if(i===-1){const h=((d=t.find(g=>(g.items||[]).length))==null?void 0:d.id)||((p=t[0])==null?void 0:p.id);return h?Mt(h):!1}const o=i+e;return o<0||o>=t.length?!1:Mt(t[o].id)}function Oi(){O=null,xe=null,Mi(),vn()}function Hs(){oe=null,me=null,bn()}function jn(){Oi(),Hs(),me=null,rt()}function Mi(){u.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function qo(){R!=null&&R.reusedLocal&&R.reusedLocal.forEach(e=>{const t=ie.get(e);if(!t)return;t.el.classList.toggle("reused",ke);const n=t.el.querySelector(".badge");n&&(n.style.display=ke?"inline-block":"none")})}function vn(){for(;I.firstChild;)I.removeChild(I.firstChild);if(!O||I.hidden)return;xe=Jo(O),xe.edges.forEach(t=>{var N,C;const n=(N=ie.get(t.from))==null?void 0:N.rect,i=(C=ie.get(t.to))==null?void 0:C.rect;if(!n||!i)return;const o=Wo(n),r=Wo(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),d=(o.x+r.x)/2,p=o.y,h=(o.x+r.x)/2,g=r.y;a.setAttribute("d",`M ${o.x},${o.y} C ${d},${p} ${h},${g} ${r.x},${r.y}`),a.setAttribute("fill","none"),a.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),a.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),a.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&a.setAttribute("stroke-dasharray","4 3"),a.setAttribute("vector-effect","non-scaling-stroke"),I.appendChild(a)})}function Wo(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function wn(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Fs(e){const t=(e??"").toString().trim();if(!t)return"";const n=t.endsWith(".md")?t:`${t}.md`,i=new URLSearchParams;return i.set("filepath",n),i.set("data"," "),i.set("mode","append"),Ot&&i.set("vault",Ot),`obsidian://advanced-uri?${i.toString()}`}function js(e){return e?Ut===ue?e.id??e.name??"":e.name??e.id??"":""}function Go(e,{externalMeta:t,seriesIdLookup:n}={}){var r;if(!ot||!e||(t??Vi(e.external)).isExternal||(r=n==null?void 0:n.has)!=null&&r.call(n,e.id))return"";const o=js(e);return Fs(o)}function Vi(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function Js(e){const t=document.createElement("button");return t.type="button",t.className="external-link obsidian-link",t.setAttribute("aria-label","Open in Obsidian"),t.title=e,t.textContent="O",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function qs(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function zo(e,t,{hasExternal:n=!1}={}){if(!e)return;const i=e.querySelector(".obsidian-link");if(!t||n){i&&i.remove(),e.removeAttribute("data-obsidian-url");return}if(e.dataset.obsidianUrl=t,i){i.title=t;return}e.appendChild(Js(t))}function Ko(){Nn||(Nn=requestAnimationFrame(()=>{Nn=null,Kt=Kt.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),Kt.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function Ws(e,t){!e||!t||(Kt.push({labelEl:e,textEl:t}),Ko())}function Gs(e,t){var r,a;const n=[`<div class="version-nav__tooltip-title">${wn(t)}</div>`],i=((e==null?void 0:e.version)??((r=e==null?void 0:e.data)==null?void 0:r.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${wn(i)}</div>`);const o=(((a=e==null?void 0:e.data)==null?void 0:a.abstract)??"").toString().trim();return o?n.push(`<div class="version-nav__tooltip-body">${o}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function Jn(e,t,{offset:n=8}={}){!E||!e||!t||(E.innerHTML=t,E.hidden=!1,E.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),o=E.getBoundingClientRect(),r=window.scrollX||document.documentElement.scrollLeft,a=window.scrollY||document.documentElement.scrollTop;let d=i.left+i.width/2-o.width/2+r,p=i.top-o.height-n+a;d<r+n&&(d=r+n);const h=r+window.innerWidth-o.width-n;d>h&&(d=h),p<a+n&&(p=i.bottom+n+a),E.style.left=`${d}px`,E.style.top=`${p}px`,E.classList.add("is-visible")}))}function Dt(){dn&&(clearTimeout(dn),dn=null),E&&(E.classList.remove("is-visible"),E.setAttribute("aria-hidden","true"),E.hidden=!0)}function zs(e,t){if(!e)return;const n=Pe((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=Gs(t,n);let o=null;const r=()=>{o&&(clearTimeout(o),o=null)},a=()=>{$t=e,Jn(e,`<div class="version-nav__tooltip-title">${wn(n)}</div>`,{offset:10})},d=()=>{r(),o=setTimeout(()=>{$t===e&&Jn(e,i,{offset:10})},Zn)},p=()=>{a(),d()},h=()=>{$t!==e&&a(),d()},g=()=>{r(),$t===e&&($t=null,Dt())};e.addEventListener("mouseenter",p),e.addEventListener("focus",p),e.addEventListener("pointermove",h),e.addEventListener("mouseleave",g),e.addEventListener("blur",g),e.addEventListener("click",g)}function Ks(){pn&&(pn=!1,!(!Pt||!un)&&(Dt(),Jn(Pt,un,{offset:12}),dn=setTimeout(()=>{Dt(),Ys()},1e3)))}function Ys(){Pt&&(zt&&(clearTimeout(zt),zt=null),Pt.classList.add("blockscape-tab--twinkle"),zt=setTimeout(()=>{Pt.classList.remove("blockscape-tab--twinkle"),zt=null},1400))}window.addEventListener("scroll",Dt,!0),window.addEventListener("resize",Dt);function yt(){T&&(T.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),T.setAttribute("aria-hidden","true"),T.hidden=!0,Yo([]))}function Xs(e,t){T&&(te={x:e,y:t},T.hidden=!1,T.setAttribute("aria-hidden","false"),T.classList.add("is-visible"),yn(e,t))}function yn(e,t){if(!T)return;const n=12;T.style.left=`${e+n}px`,T.style.top=`${t+n}px`;const i=T.getBoundingClientRect();let o=i.left,r=i.top;i.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(r=Math.max(n,window.innerHeight-i.height-n)),T.style.left=`${o}px`,T.style.top=`${r}px`}function Yo(e=[]){fe&&(fe.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),fe.appendChild(n)}),fe.hidden=e.length===0)}async function Zs(e,t){var g;if(!T)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((g=t.querySelector(".name"))==null?void 0:g.textContent)||n||"Preview",o=n?`${n}.html`:"",r=o?`items/${o}`:"",a=++Be,d=t.dataset.externalUrl||"",p=t.dataset.obsidianUrl||"",h=[{label:"Edit",title:"Edit this item",onClick:()=>{yt(),Qt.open(n)}}];if(d&&h.push({label:"Open link ↗",title:d,onClick:()=>window.open(d,"_blank","noopener")}),p&&h.push({label:"Open in Obsidian",title:p,onClick:()=>window.open(p,"_blank","noopener")}),Yo(h),n&&ut(n),ae.textContent=i,q.innerHTML='<div class="item-preview__status">Loading…</div>',T.classList.remove("item-preview--has-frame"),T.classList.add("item-preview--expanded"),Xs(e.clientX,e.clientY),!r){q.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',yn(te.x,te.y);return}try{const N=await fetch(r,{cache:"no-cache"});if(!N.ok)throw new Error(`HTTP ${N.status}`);const C=await N.text();if(a!==Be)return;if(!C.trim()){q.innerHTML=`<div class="item-preview__status">No content in <code>${wn(o)}</code>.</div>`,yn(te.x,te.y);return}const F=document.createElement("iframe");F.className="item-preview__frame",F.title=`${i} details`,F.srcdoc=C,q.innerHTML="",q.appendChild(F),T.classList.add("item-preview--has-frame"),yn(te.x,te.y)}catch(N){if(a!==Be)return;q.innerHTML=`<div class="item-preview__status">No preview available for <strong>${wn(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${r}`,N),yn(te.x,te.y)}}he&&he.addEventListener("click",yt),B&&B.addEventListener("click",()=>{_s()}),ce&&ce.addEventListener("click",()=>{Ss()}),le&&le.addEventListener("click",Ai),Ee&&Ee.addEventListener("click",Ai),De&&De.addEventListener("click",Ni),Qe&&Qe.addEventListener("click",Ni),u&&u.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!u.contains(t)||Zs(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!T||T.hidden||T.contains(e.target)||yt()}),Ve&&Ve.addEventListener("click",()=>{To("button")}),W&&W.addEventListener("click",()=>{if(v<0){alert("Load or select a model before creating a version.");return}try{const e=Lo({versionLabel:"map edit"});lt(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),H&&H.addEventListener("click",async()=>{var r;if(v<0||!k[v]){alert("Select or load a model before sharing.");return}const e={title:Pe(k[v],"Shared Model"),data:k[v].data};let t;try{t=Tr(JSON.stringify(e))}catch(a){console.error("[Blockscape] share encode failed",a),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(a){console.warn("[Blockscape] failed to update URL for share",a),window.location.hash=n.hash}let o=!1;if((r=navigator.clipboard)!=null&&r.writeText)try{await navigator.clipboard.writeText(i),o=!0}catch(a){console.warn("[Blockscape] clipboard write failed",a)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),X&&X.addEventListener("click",()=>{const e=(s.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};O&&(n.selectedItemId=O),localStorage.setItem(be,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";O&&(t=`editor.html?selected=${encodeURIComponent(O)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==be||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||Ho("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===Ye&&Ho("message")})),document.addEventListener("keydown",e=>{var n,i,o,r,a,d,p,h,g,N;if(Es()){e.key==="Escape"&&(e.preventDefault(),Ai());return}if(!(Y!=null&&Y.hidden)&&e.key==="Escape"){e.preventDefault(),Ni();return}if(!((n=Qt==null?void 0:Qt.isOpen)!=null&&n.call(Qt))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const C=k[v],x=((i=C==null?void 0:C.apicurioVersions)==null?void 0:i.length)>1;To("shortcut",x);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!nn())return;if(fa()){e.preventDefault();return}}if(e.key==="Escape"){let C=!1;T&&!T.hidden&&(yt(),C=!0),(O||oe)&&(jn(),C=!0),C&&e.preventDefault()}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!nn())return;const C=e.key==="ArrowLeft"?-1:1;if(e.altKey)return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){Bi(C)&&e.preventDefault();return}if(e.ctrlKey||e.metaKey)return;if(oe&&!e.shiftKey){e.preventDefault();return}e.shiftKey?aa(C)&&e.preventDefault():ca(C)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!nn())return;const C=e.key==="ArrowUp"?-1:1;if((e.ctrlKey||e.metaKey)&&!e.altKey){pa(C)&&e.preventDefault();return}if(e.altKey)return;if(oe&&!O&&!e.shiftKey){if(da(C)){e.preventDefault();return}if(Ds(C)){e.preventDefault();return}}e.shiftKey?ua(C)&&e.preventDefault():la(C)&&e.preventDefault()}if(e.key==="Delete"){if(!nn()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const C=oe?ga():!1,x=C?!0:Qo();(C||x)&&e.preventDefault()}if(e.key==="F2"){if(!nn())return;const C=oe&&!O&&oe||!O&&((d=(a=(r=(o=e.target)==null?void 0:o.closest)==null?void 0:r.call(o,".category"))==null?void 0:a.dataset)==null?void 0:d.cat)||null;if(C&&!O&&sa(C)){e.preventDefault();return}const x=O||((N=(g=(h=(p=e.target)==null?void 0:p.closest)==null?void 0:h.call(p,".tile"))==null?void 0:g.dataset)==null?void 0:N.id);x&&Qt.open(x)&&e.preventDefault()}if(e.key==="Insert"){if(!nn()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;Zo()&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!T||T.hidden||yn(te.x,te.y)}),window.addEventListener("scroll",()=>{!T||T.hidden||yt()},!0);let Jt=null,qn=null;function Qs(e){yt(),Jt=e.target.dataset.id,qn=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:Jt,categoryId:qn})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",Jt,"from",qn)}function ea(e){e.target.classList.remove("dragging"),u.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),u.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),Jt=null,qn=null}function ta(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function na(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function ia(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function oa(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!Jt||!i)return;const r=Array.from(t.querySelectorAll(".tile")).filter(a=>a.dataset.id!==Jt).find(a=>{const d=a.getBoundingClientRect();return e.clientY<d.top+d.height/2});Xo(Jt,r?r.dataset.id:null,i),gn(),console.log("[Blockscape] drop completed",Jt,"from",qn,"to",i)}function Xo(e,t,n){if(v<0)return;const o=k[v].data.categories||[],r=o.find(g=>(g.items||[]).some(N=>N.id===e)),a=o.find(g=>g.id===n);if(!r||!a)return;r.items=r.items||[],a.items=a.items||[];const d=r.items.findIndex(g=>g.id===e);if(d===-1)return;const[p]=r.items.splice(d,1);let h=a.items.length;if(t){const g=a.items.findIndex(N=>N.id===t);g!==-1&&(h=g)}a.items.splice(h,0,p),dt(),st()}function ra(e){if(v<0||!e)return;const t=k[v].data,i=(t.categories||[]).find(p=>p.id===e);if(!i)return;i.items=i.items||[];const o=`New item ${i.items.length+1}`,a={id:ds(`${e}-${i.items.length+1}`,t),name:o,deps:[]};i.items.push(a),dt(),st(),yt(),ut(a.id);const d=ie.get(a.id);d!=null&&d.el&&d.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",a.id,"to",e)}function Zo(){if(v<0)return!1;const e=k[v].data;e.categories=e.categories||[];const t=`New category ${e.categories.length+1}`,n=us(t,e),i={id:n,title:t,items:[]};return e.categories.push(i),oe=n,O=null,xe=null,me=null,dt(),st(),Mt(n),console.log("[Blockscape] added category",n),!0}function sa(e=Fn()){if(v<0||!e)return!1;const t=fs.open(e);return t&&(O=null,xe=null,rt()),t}function aa(e){if(!O||v<0||!e)return!1;const n=k[v].data.categories||[],i=ie.get(O);let o=null;if(i!=null&&i.catId&&(o=n.find(p=>p.id===i.catId)),o||(o=n.find(p=>(p.items||[]).some(h=>h.id===O))),!o)return!1;o.items=o.items||[];const r=o.items.findIndex(p=>p.id===O);if(r===-1)return!1;const a=r+e;if(a<0||a>=o.items.length)return!1;const[d]=o.items.splice(r,1);return o.items.splice(a,0,d),dt(),st(),gn(),ut(O),!0}function ca(e){if(!R||!R.m||!e)return!1;const t=R.m.categories||[];if(!t.length)return!1;const n=()=>{const p=t.find(h=>(h.items||[]).length);return p?{category:p,item:p.items[0]}:null};if(!O){const p=n();return p?(ut(p.item.id),!0):!1}const i=ie.get(O);let o=null;if(i!=null&&i.catId&&(o=t.find(p=>p.id===i.catId)),o||(o=t.find(p=>(p.items||[]).some(h=>h.id===O))),!o){const p=n();return p?(ut(p.item.id),!0):!1}const r=o.items||[];if(!r.length)return!1;const a=r.findIndex(p=>p.id===O);if(a===-1)return!1;const d=a+e;return d<0||d>=r.length?!1:(ut(r[d].id),!0)}function la(e){if(!R||!R.m||!e)return!1;const t=R.m.categories||[];if(!t.length)return!1;const n=Fn();let i=t.findIndex(a=>a.id===n),o=i+e;if(i===-1&&(o=e>0?0:t.length-1),o<0||o>=t.length)return!1;const r=t[o];if(O){const d=(t[i].items||[]).findIndex(p=>p.id===O);me={catId:r.id,position:d===-1?0:d}}else me=null;return Mt(r.id,{preserveEntryHint:!0})}function da(e){var r;if(!oe||!((r=R==null?void 0:R.m)!=null&&r.categories)||!e)return!1;const n=(R.m.categories||[]).find(a=>a.id===oe);if(!n)return!1;const i=n.items||[];if(!i.length)return!1;let o=e>0?0:Math.max(0,i.length-1);return(me==null?void 0:me.catId)===n.id&&(o=Math.min(i.length-1,Math.max(0,me.position||0))),me=null,ut(i[o].id),!0}function ua(e){if(!O||v<0||!e)return!1;const n=k[v].data.categories||[];if(!n.length)return!1;const i=ie.get(O);let o=-1;if(i!=null&&i.catId&&(o=n.findIndex(N=>N.id===i.catId)),o===-1&&(o=n.findIndex(N=>(N.items||[]).some(C=>C.id===O))),o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const a=n[o],d=n[r];if(!d)return!1;a.items=a.items||[],d.items=d.items||[];const p=a.items.findIndex(N=>N.id===O);if(p===-1)return!1;const h=Math.min(d.items.length,Math.max(0,p)),g=h<d.items.length?d.items[h].id:null;return Xo(O,g,d.id),gn(),ut(O),!0}function pa(e){if(v<0||!e)return!1;const n=k[v].data.categories||[];if(!n.length)return!1;const i=Fn();if(!i)return!1;const o=n.findIndex(d=>d.id===i);if(o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const[a]=n.splice(o,1);return n.splice(r,0,a),oe=a.id,Oi(),me=null,rt(),dt(),st(),bn(),console.log("[Blockscape] moved category",a.id,"from",o,"to",r),!0}function fa(){if(v<0)return!1;const e=k[v],t=Ze(e)||(e?e.id:null),n=[];if(Fe&&t===Fe.modelId&&n.push({...Fe,type:"item"}),at&&t===at.modelId&&n.push({...at,type:"category"}),!n.length)return!1;const i=n.reduce((o,r)=>o?(r.ts||0)>(o.ts||0)?r:o:r,null);if(!i)return!1;if(i.type==="category"){if(ha(i))return!0}else if(i.type==="item"&&ma(i))return!0;return!1}function ma(e){const t=k[v],n=Ze(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const r=(t.data.categories||[]).find(d=>d.id===e.categoryId);if(!r)return!1;r.items=r.items||[];const a=Math.min(Math.max(e.index,0),r.items.length);return r.items.splice(a,0,e.item),Fe=null,yt(),O=null,xe=null,rt(),dt(),st(),gn(),ut(e.item.id),console.log("[Blockscape] undo delete restored",e.item.id),!0}function ha(e){const t=k[v],n=Ze(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const i=t.data;i.categories=i.categories||[];const o=Math.min(Math.max(e.index,0),i.categories.length);return i.categories.splice(o,0,e.category),at=null,O=null,xe=null,oe=e.category.id,me=null,rt(),dt(),st(),bn(),Mt(e.category.id),console.log("[Blockscape] undo delete restored category",e.category.id),!0}function Qo(){if(!O||v<0)return!1;const t=k[v].data.categories||[];if(!t.length)return!1;const n=ie.get(O);let i=null;if(n!=null&&n.catId&&(i=t.find(h=>h.id===n.catId)),i||(i=t.find(h=>(h.items||[]).some(g=>g.id===O))),!i||!Array.isArray(i.items))return!1;const o=i.items.findIndex(h=>h.id===O);if(o===-1)return!1;const r=i.items.splice(o,1)[0];if(!r)return!1;const a=k[v];Fe={item:r,categoryId:i.id,index:o,modelId:Ze(a)||(a?a.id:null),ts:Date.now()};const p=(()=>{var g;if(i.items.length){const N=Math.min(o,i.items.length-1);return((g=i.items[N])==null?void 0:g.id)||null}const h=t.findIndex(N=>N.id===i.id);if(h===-1)return null;for(let N=h+1;N<t.length;N++){const C=t[N].items||[];if(C.length)return C[0].id}for(let N=h-1;N>=0;N--){const C=t[N].items||[];if(C.length)return C[0].id}return null})();return yt(),O=null,xe=null,me=null,rt(),dt(),st(),gn(),p?ut(p):jn(),console.log("[Blockscape] removed item",r.id),!0}function ga(){var d,p;const e=Fn();if(!e||v<0)return!1;const n=k[v].data.categories||[];if(!n.length)return!1;const i=n.findIndex(h=>h.id===e);if(i===-1)return!1;const[o]=n.splice(i,1);if(!o)return!1;const r=k[v];at={category:o,index:i,modelId:Ze(r)||(r?r.id:null),ts:Date.now()},oe=null,O=null,xe=null,me=null,rt(),dt(),st();const a=((d=n[i])==null?void 0:d.id)||((p=n[i-1])==null?void 0:p.id)||null;return a?Mt(a):jn(),console.log("[Blockscape] removed category",o.id),!0}function ba(e){if(!e)return!1;const t=O;O=e;const n=Qo();return n||(O=t,rt()),n}j&&j.addEventListener("click",async()=>{const e=s.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await Io(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),G&&G.addEventListener("click",async()=>{const e=ms();if(!e){alert("No series available to copy. Create another version first.");return}await Io(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),Le&&Le.addEventListener("click",async()=>{try{const e=await Or();if(!e){alert("Clipboard is empty.");return}s.value=e,s.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=tn(s.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const o=jt(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=o)}),v===-1&&t!=null?lt(t):en()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(v<0){alert("No active model selected.");return}try{const t=JSON.parse(s.value);if(Zt(t,{titleHint:Pe(k[v]),idHint:Ze(k[v])||Pe(k[v])}),k[v].data=t,k[v].title=t.title||k[v].title,k[v].isSeries||((e=k[v].apicurioVersions)==null?void 0:e.length)>1){const n=k[v].title||Pe(k[v]);gt(k[v],{seriesName:n,fallbackTitle:n})}Ii(),console.log("[Blockscape] replaced active model:",Pe(k[v])),st(),ve.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const o=await i.text(),r=i.name.replace(/\.[^.]+$/,"")||"File",a=tn(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models in file:",i.name);continue}a.forEach((d,p)=>{var pe;const h=(((pe=d.data)==null?void 0:pe.title)??"").toString().trim(),g=a.length>1?`${i.name} #${p+1}`:i.name,N=`${r} series`,C=d.isSeries?N:null;let x={...d};if(d.isSeries){const Ae=C||h||d.title||g||"unknown";x.title=Ae;const $e=ln(Ae||"unknown");ii(x,$e),gt(x,{seriesName:Ae,fallbackTitle:"unknown"}),x.apicurioArtifactName=x.apicurioArtifactName||Ae}else x.title=h||g;const F=jt({...x,apicurioArtifactName:x.apicurioArtifactName||C||x.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=F)})}v===-1&&n!=null?lt(n):en()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",va);function va(e){var o;if(!nn())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Ls(t))return;let n=[];try{n=tn(t,"Clipboard",{promptForSeriesName:!0})}catch(r){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",r);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((r,a)=>{const d=jt(r,{versionLabel:n.length>1?`paste #${a+1}`:"paste"});i==null&&(i=d)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&lt(i)}V.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(bs(),lt(n))}),document.getElementById("removeModel").onclick=()=>{if(v<0)return;const e=Pe(k[v]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",Pe(k[v])),k.splice(v,1),!k.length){v=-1,R=null,u.innerHTML="",I.innerHTML="",s.value="",en(),Ii();return}const n=Math.min(v,k.length-1);lt(n)},Se&&(Se.addEventListener("input",e=>{Po(e.target.value||"")}),Se.addEventListener("focus",()=>{Se.value&&Se.value.trim()&&Ro(Se.value)})),$&&$.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;Cs({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!$||$.hidden)return;const t=e.target;$.contains(t)||Se&&(t===Se||Se.contains(t))||($.hidden=!0)}),y&&J&&K&&y.addEventListener("submit",async e=>{e.preventDefault();const t=J.value.trim();if(!t){alert("Please enter a URL"),J.focus();return}const n=await Ri(t);if(typeof n=="number"){lt(n),J.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!J||!t)return;let n=null;J.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=J.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function st(){if(!(v<0))try{R=$s(k[v].data),gn()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function wa(){const e=["comms.bs","planets.bs","styleguide.bs"],t=n=>wi?wi.endsWith("/")?`${wi}${n}`:`${wi}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const o=await i.text(),r=n.replace(/\.[^.]+$/,"")||"Model",a=tn(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models found in",n);continue}a.forEach(d=>{let p={...d};if(d.isSeries){const h=`${r} series`;p={...d,title:h,apicurioArtifactName:h};const g=ln(h||"unknown");ii(p,g),gt(p,{seriesName:h,fallbackTitle:"unknown"})}jt(p,{versionLabel:n})}),console.log(`[Blockscape] loaded ${a.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}en()}async function ya(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const o=await fetch(e,i);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function Ea(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>_a(i)),e.querySelectorAll("a[href]").forEach(i=>{const o=i.getAttribute("href");tr(o)&&er(i,o)})}function _a(e){var d,p;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(p=(d=e.parentNode)==null?void 0:d.closest)!=null&&p.call(d,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let o;for(;(o=n.exec(t))!==null;)i.push({url:o[0],index:o.index});if(!i.length)return;const r=document.createDocumentFragment();let a=0;i.forEach(({url:h,index:g})=>{g>a&&r.appendChild(document.createTextNode(t.slice(a,g))),r.appendChild(Sa(h)),a=g+h.length}),a<t.length&&r.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(r,e)}function Sa(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",tr(e)&&er(t,e),t}function er(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>ka(n,t,e)))}async function ka(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await Ri(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function tr(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function Ri(e){try{console.log("[Blockscape] loading from URL:",e);const t=await ya(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=tn(t,i)}catch(a){throw new Error(`Invalid JSON payload: ${a.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let r=null;return o.forEach((a,d)=>{var x;const p=(((x=a.data)==null?void 0:x.title)??"").toString().trim(),h=o.length>1?`${i} #${d+1}`:i,g=a.isSeries?`${i} series`:null;let N={...a};if(a.isSeries){const F=g||p||N.title||h;N={...a,title:F,apicurioArtifactName:F||a.apicurioArtifactName};const pe=ln(F||"unknown");ii(N,pe),gt(N,{seriesName:F||g||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:pe,url:e,baseName:i,seriesTitle:F})}const C=jt({...N,title:p||N.title||h,apicurioArtifactName:N.apicurioArtifactName||g||a.apicurioArtifactName},{versionLabel:i});r==null&&(r=C)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,i),v===-1&&r!=null?lt(r):en(),r}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=tn(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let o=null;i.forEach(g=>{const N=jt(g,{versionLabel:"seed"});o==null&&(o=N)}),await wa();const r=await Bs(),a=Do(),d=a==null?void 0:a.index,p=Ts();lt(typeof r=="number"?r:typeof p=="number"?p:typeof d=="number"?d:o??0)})()}function tc(s){let l;return{c(){l=D("div"),l.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',w(l,"id","shortcutHelp"),w(l,"class","shortcut-help"),l.hidden=!0,w(l,"aria-hidden","true"),w(l,"role","dialog"),w(l,"aria-modal","true"),w(l,"aria-labelledby","shortcutHelpTitle")},m(u,I){tt(u,l,I)},p:Ht,i:Ht,o:Ht,d(u){u&&Ke(l)}}}class nc extends _o{constructor(l){super(),Eo(this,l,null,tc,wo,{})}}const ic=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function Er(s){let l,u,I,E,V,T,y,J;return{c(){l=D("div"),u=D("div"),I=D("a"),E=yo("Open Blockscape GPT"),V=se(),T=D("div"),T.textContent="Paste the copied prompt into that chat.",y=se(),J=D("div"),J.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',w(I,"href",rc),w(I,"target","_blank"),w(I,"rel","noreferrer"),w(T,"class","new-panel__hint"),w(u,"class","new-panel__link"),w(J,"class","new-panel__link new-panel__link--disabled"),w(l,"class","new-panel__links")},m(K,ae){tt(K,l,ae),A(l,u),A(u,I),A(I,E),A(u,V),A(u,T),A(l,y),A(l,J)},p:Ht,d(K){K&&Ke(l)}}}function _r(s){let l,u,I,E,V,T;return{c(){l=D("div"),u=D("div"),u.textContent="Generated prompt",I=se(),E=D("textarea"),w(u,"class","new-panel__prompt-label"),w(E,"class","pf-v5-c-form-control new-panel__textarea"),w(E,"rows","4"),E.readOnly=!0,w(l,"class","new-panel__prompt")},m(y,J){tt(y,l,J),A(l,u),A(l,I),A(l,E),xn(E,s[4]),V||(T=cn(E,"input",s[12]),V=!0)},p(y,J){J&16&&xn(E,y[4])},d(y){y&&Ke(l),V=!1,T()}}}function oc(s){let l,u,I,E,V,T,y,J,K,ae,q,fe,he,Ve,H,W,X,j,G,Le,B,ce,ee,ge,le,Ee,Y,De,Qe,Se,$,be,Ye,je,k,v,ve,R,ie,Je,O,oe,xe,me,nt,ke=s[2]==="gpt"&&Er(),Be=s[4]&&s[5]&&_r(s);return xe=Ra(s[10][0]),{c(){l=D("div"),u=D("div"),I=se(),E=D("div"),V=D("div"),V.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',T=se(),y=D("form"),J=D("div"),K=D("label"),K.textContent="Domain",ae=se(),q=D("p"),q.textContent="Describe what you want to create a map for.",fe=se(),he=D("textarea"),Ve=se(),H=D("div"),W=D("label"),X=D("input"),j=se(),G=D("span"),G.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,Le=se(),B=D("fieldset"),ce=D("legend"),ce.textContent="Target",ee=se(),ge=D("p"),ge.textContent="Choose where you plan to use the prompt.",le=se(),Ee=D("label"),Y=D("input"),De=se(),Qe=D("div"),Qe.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',Se=se(),$=D("label"),be=D("input"),Ye=se(),je=D("div"),je.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',k=se(),v=D("div"),ve=D("button"),ve.textContent="Copy prompt",R=se(),ie=D("div"),Je=yo(s[3]),O=se(),ke&&ke.c(),oe=se(),Be&&Be.c(),w(u,"id","newPanelBackdrop"),w(u,"class","shortcut-help__backdrop"),w(V,"class","shortcut-help__header"),w(K,"for","newDomain"),w(q,"class","new-panel__hint"),w(he,"id","newDomain"),w(he,"class","pf-v5-c-form-control new-panel__textarea"),w(he,"rows","4"),he.required=!0,w(he,"placeholder","Ex: Companies building open-source geospatial tools"),w(J,"class","new-panel__field"),w(X,"id","seriesToggle"),w(X,"type","checkbox"),w(W,"class","new-panel__toggle"),w(W,"for","seriesToggle"),w(H,"class","new-panel__field"),w(ge,"class","new-panel__hint"),w(Y,"type","radio"),w(Y,"name","target"),Y.__value="gpt",xn(Y,Y.__value),w(Ee,"class","new-panel__option"),w(be,"type","radio"),w(be,"name","target"),be.__value="plain",xn(be,be.__value),w($,"class","new-panel__option"),w(B,"class","new-panel__field"),w(ve,"class","pf-v5-c-button pf-m-primary"),w(ve,"type","submit"),w(ie,"class","new-panel__status"),w(ie,"aria-live","polite"),w(v,"class","new-panel__actions"),w(y,"class","shortcut-help__list new-panel__form"),w(E,"class","shortcut-help__panel"),w(E,"tabindex","-1"),w(l,"id","newPanel"),w(l,"class","shortcut-help"),l.hidden=!0,w(l,"aria-hidden","true"),w(l,"role","dialog"),w(l,"aria-modal","true"),w(l,"aria-labelledby","newPanelTitle"),xe.p(Y,be)},m(te,qe){tt(te,l,qe),A(l,u),A(l,I),A(l,E),A(E,V),A(E,T),A(E,y),A(y,J),A(J,K),A(J,ae),A(J,q),A(J,fe),A(J,he),xn(he,s[0]),A(y,Ve),A(y,H),A(H,W),A(W,X),X.checked=s[1],A(W,j),A(W,G),A(y,Le),A(y,B),A(B,ce),A(B,ee),A(B,ge),A(B,le),A(B,Ee),A(Ee,Y),Y.checked=Y.__value===s[2],A(Ee,De),A(Ee,Qe),A(B,Se),A(B,$),A($,be),be.checked=be.__value===s[2],A($,Ye),A($,je),A(y,k),A(y,v),A(v,ve),A(v,R),A(v,ie),A(ie,Je),A(y,O),ke&&ke.m(y,null),A(y,oe),Be&&Be.m(y,null),me||(nt=[cn(he,"input",s[7]),cn(X,"change",s[8]),cn(Y,"change",s[9]),cn(be,"change",s[11]),cn(y,"submit",Va(s[6]))],me=!0)},p(te,[qe]){qe&1&&xn(he,te[0]),qe&2&&(X.checked=te[1]),qe&4&&(Y.checked=Y.__value===te[2]),qe&4&&(be.checked=be.__value===te[2]),qe&8&&Ua(Je,te[3]),te[2]==="gpt"?ke?ke.p(te,qe):(ke=Er(),ke.c(),ke.m(y,oe)):ke&&(ke.d(1),ke=null),te[4]&&te[5]?Be?Be.p(te,qe):(Be=_r(te),Be.c(),Be.m(y,null)):Be&&(Be.d(1),Be=null)},i:Ht,o:Ht,d(te){te&&Ke(l),ke&&ke.d(),Be&&Be.d(),xe.r(),me=!1,Xn(nt)}}}const rc="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function sc(s,l,u){let I="",E=!1,V="gpt",T="",y="",J=!1;const K=()=>{var j;return typeof navigator<"u"&&!!((j=navigator.clipboard)!=null&&j.writeText)};function ae(j){const G=j||"[DOMAIN]",Le=E?"series":"map",ce=ic.replaceAll("[DOMAIN NAME]",G).replaceAll("[DOMAIN]",G).replaceAll("[map|series]",Le).split(`
`),ee=`Generate a **blockscape ${Le}** for the domain of ${G}.`,ge=ce.findIndex(Ee=>Ee.toLowerCase().includes("generate a **blockscape value")||Ee.toLowerCase().includes("generate a blockscape [map|series]")||Ee.toLowerCase().startsWith("generate a blockscape"));ge>=0?ce[ge]=ee:ce.unshift(ee);const le=E?`

User requested a series (return an array of models).`:"";return`${ce.join(`
`).trim()}${le}`}async function q(j){j.preventDefault();const G=I.trim();if(u(3,T=""),u(5,J=V!=="gpt"),!G){u(3,T="Add a domain to generate a prompt."),u(4,y="");return}if(V==="gpt"?u(4,y=`${E?"Create a series":"Create a map"} for ${G}`):(u(4,y=ae(G)),u(5,J=!0)),!K()){u(3,T="Clipboard access is unavailable. Copy the prompt below."),u(5,J=!0);return}try{await navigator.clipboard.writeText(y),u(3,T=V==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),V==="gpt"&&u(5,J=!1)}catch(B){console.warn("[Blockscape] clipboard write failed",B),u(3,T="Copy failed. Use the prompt below."),u(5,J=!0)}}const fe=[[]];function he(){I=this.value,u(0,I)}function Ve(){E=this.checked,u(1,E)}function H(){V=this.__value,u(2,V)}function W(){V=this.__value,u(2,V)}function X(){y=this.value,u(4,y)}return[I,E,V,T,y,J,q,he,Ve,H,fe,W,X]}class ac extends _o{constructor(l){super(),Eo(this,l,sc,oc,wo,{})}}const{document:Sr}=Ma;function cc(s){let l,u,I,E,V,T,y,J,K,ae,q,fe,he,Ve,H,W,X,j,G,Le,B,ce,ee,ge,le,Ee,Y,De,Qe,Se,$,be,Ye,je,k,v,ve,R,ie,Je,O,oe=`<script id="seed" type="application/json">${s[1]}<\/script>`,xe,me,nt,ke,Be,te,qe,Fe,at,bt,ct,Rt,vt;return Fe=new nc({}),bt=new ac({}),{c(){l=D("link"),u=se(),I=D("div"),E=D("header"),V=D("div"),T=D("div"),y=D("div"),J=D("div"),J.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',K=se(),ae=D("div"),q=D("div"),fe=D("button"),he=D("span"),he.textContent="Toggle search and edit tools",Ve=se(),H=D("span"),H.textContent="▾",W=se(),X=D("button"),X.textContent="New",j=se(),G=D("form"),G.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',Le=se(),B=D("label"),B.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',ce=se(),ee=D("button"),ee.textContent="Help",ge=se(),le=D("div"),Ee=D("div"),Ee.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',Y=se(),De=D("button"),De.textContent="Edit",Qe=se(),Se=D("button"),Se.textContent="Share",je=se(),k=D("div"),k.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',v=se(),ve=D("main"),ve.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,R=se(),ie=D("footer"),ie.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',Je=se(),O=new Da(!1),xe=se(),me=Cr("svg"),nt=se(),ke=D("div"),Be=se(),te=D("div"),te.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',qe=se(),br(Fe.$$.fragment),at=se(),br(bt.$$.fragment),Sr.title="Blockscape — simple landscape-style tiles",w(l,"rel","icon"),w(l,"type","image/svg+xml"),w(l,"href","./favicon.svg"),w(J,"class","blockscape-brand"),w(he,"class","sr-only"),w(H,"class","blockscape-toolbar__toggle-icon"),w(H,"aria-hidden","true"),w(fe,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),w(fe,"type","button"),w(fe,"aria-expanded",s[0]),w(fe,"aria-controls","blockscapeHeaderExtras"),w(X,"id","newPanelButton"),w(X,"class","pf-v5-c-button pf-m-primary"),w(X,"type","button"),w(X,"title","Create something new"),w(G,"id","urlForm"),w(G,"class","blockscape-url-form"),w(G,"autocomplete","on"),G.noValidate=!0,w(B,"class","pf-v5-c-button pf-m-primary blockscape-file"),w(ee,"id","helpButton"),w(ee,"class","pf-v5-c-button pf-m-primary"),w(ee,"type","button"),w(ee,"title","Show keyboard shortcuts"),w(q,"class","blockscape-toolbar__primary"),w(Ee,"class","blockscape-search"),w(De,"id","openInEditor"),w(De,"class","pf-v5-c-button pf-m-secondary"),w(De,"type","button"),w(De,"title","Open current JSON in the editor"),w(Se,"id","shareModel"),w(Se,"class","pf-v5-c-button pf-m-secondary"),w(Se,"type","button"),w(Se,"title","Copy a shareable URL for this model"),w(le,"id","blockscapeHeaderExtras"),w(le,"class","blockscape-toolbar__extras"),le.hidden=$=!s[0],w(le,"aria-hidden",be=!s[0]),w(ae,"class","blockscape-toolbar__controls"),w(ae,"data-expanded",Ye=s[0]?"true":"false"),w(k,"class","blockscape-legend"),w(k,"role","presentation"),w(y,"class","blockscape-toolbar"),w(T,"class","pf-v5-c-masthead__content"),w(V,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),w(E,"class","pf-v5-c-page__header"),w(ve,"class","pf-v5-c-page__main"),w(ie,"class","pf-v5-c-page__footer blockscape-footer"),w(I,"class","pf-v5-c-page"),O.a=xe,w(me,"id","overlay"),w(me,"class","svg-layer"),w(ke,"id","tabTooltip"),w(ke,"class","blockscape-tab-tooltip"),ke.hidden=!0,w(ke,"aria-hidden","true"),w(te,"id","itemPreview"),w(te,"class","item-preview"),te.hidden=!0,w(te,"aria-hidden","true")},m(ne,we){A(Sr.head,l),tt(ne,u,we),tt(ne,I,we),A(I,E),A(E,V),A(V,T),A(T,y),A(y,J),A(y,K),A(y,ae),A(ae,q),A(q,fe),A(fe,he),A(fe,Ve),A(fe,H),A(q,W),A(q,X),A(q,j),A(q,G),A(q,Le),A(q,B),A(q,ce),A(q,ee),A(ae,ge),A(ae,le),A(le,Ee),A(le,Y),A(le,De),A(le,Qe),A(le,Se),A(y,je),A(y,k),A(I,v),A(I,ve),A(I,R),A(I,ie),tt(ne,Je,we),O.m(oe,ne,we),tt(ne,xe,we),tt(ne,me,we),tt(ne,nt,we),tt(ne,ke,we),tt(ne,Be,we),tt(ne,te,we),tt(ne,qe,we),bo(Fe,ne,we),tt(ne,at,we),bo(bt,ne,we),ct=!0,Rt||(vt=cn(fe,"click",s[2]),Rt=!0)},p(ne,[we]){(!ct||we&1)&&w(fe,"aria-expanded",ne[0]),(!ct||we&1&&$!==($=!ne[0]))&&(le.hidden=$),(!ct||we&1&&be!==(be=!ne[0]))&&w(le,"aria-hidden",be),(!ct||we&1&&Ye!==(Ye=ne[0]?"true":"false"))&&w(ae,"data-expanded",Ye)},i(ne){ct||(go(Fe.$$.fragment,ne),go(bt.$$.fragment,ne),ct=!0)},o(ne){gr(Fe.$$.fragment,ne),gr(bt.$$.fragment,ne),ct=!1},d(ne){ne&&(Ke(u),Ke(I),Ke(Je),O.d(),Ke(xe),Ke(me),Ke(nt),Ke(ke),Ke(Be),Ke(te),Ke(qe),Ke(at)),Ke(l),vo(Fe,ne),vo(bt,ne),Rt=!1,vt()}}}function lc(s,l,u){const I=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let E=!1;const V=()=>{if(u(0,E=!E),!E){const T=document.getElementById("search");T&&T.value&&(T.value="",T.dispatchEvent(new Event("input",{bubbles:!0})))}};return Fa(()=>{ec()}),[E,I,V]}class dc extends _o{constructor(l){super(),Eo(this,l,lc,cc,wo,{})}}const uc=document.getElementById("root");new dc({target:uc});
