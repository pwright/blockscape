var qs=Object.defineProperty;var Gs=(s,c,f)=>c in s?qs(s,c,{enumerable:!0,configurable:!0,writable:!0,value:f}):s[c]=f;var cn=(s,c,f)=>Gs(s,typeof c!="symbol"?c+"":c,f);(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const k of document.querySelectorAll('link[rel="modulepreload"]'))x(k);new MutationObserver(k=>{for(const F of k)if(F.type==="childList")for(const T of F.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&x(T)}).observe(document,{childList:!0,subtree:!0});function f(k){const F={};return k.integrity&&(F.integrity=k.integrity),k.referrerPolicy&&(F.referrerPolicy=k.referrerPolicy),k.crossOrigin==="use-credentials"?F.credentials="include":k.crossOrigin==="anonymous"?F.credentials="omit":F.credentials="same-origin",F}function x(k){if(k.ep)return;k.ep=!0;const F=f(k);fetch(k.href,F)}})();function tn(){}function Or(s){return s()}function kr(){return Object.create(null)}function di(s){s.forEach(Or)}function Mr(s){return typeof s=="function"}function Io(s,c){return s!=s?c==c:s!==c||s&&typeof s=="object"||typeof s=="function"}function zs(s){return Object.keys(s).length===0}const Ks=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function y(s,c){s.appendChild(c)}function ct(s,c,f){s.insertBefore(c,f||null)}function tt(s){s.parentNode&&s.parentNode.removeChild(s)}function $(s){return document.createElement(s)}function Pr(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function xo(s){return document.createTextNode(s)}function X(){return xo(" ")}function En(s,c,f,x){return s.addEventListener(c,f,x),()=>s.removeEventListener(c,f,x)}function Ys(s){return function(c){return c.preventDefault(),s.call(this,c)}}function m(s,c,f){f==null?s.removeAttribute(c):s.getAttribute(c)!==f&&s.setAttribute(c,f)}function Xs(s){let c;return{p(...f){c=f,c.forEach(x=>s.push(x))},r(){c.forEach(f=>s.splice(s.indexOf(f),1))}}}function Zs(s){return Array.from(s.childNodes)}function Qs(s,c){c=""+c,s.data!==c&&(s.data=c)}function _n(s,c){s.value=c??""}class el{constructor(c=!1){cn(this,"is_svg",!1);cn(this,"e");cn(this,"n");cn(this,"t");cn(this,"a");this.is_svg=c,this.e=this.n=null}c(c){this.h(c)}m(c,f,x=null){this.e||(this.is_svg?this.e=Pr(f.nodeName):this.e=$(f.nodeType===11?"TEMPLATE":f.nodeName),this.t=f.tagName!=="TEMPLATE"?f:f.content,this.c(c)),this.i(x)}h(c){this.e.innerHTML=c,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(c){for(let f=0;f<this.n.length;f+=1)ct(this.t,this.n[f],c)}p(c){this.d(),this.h(c),this.i(this.a)}d(){this.n.forEach(tt)}}let ci;function li(s){ci=s}function tl(){if(!ci)throw new Error("Function called outside component initialization");return ci}function nl(s){tl().$$.on_mount.push(s)}const On=[],Sr=[];let Mn=[];const Cr=[],il=Promise.resolve();let Eo=!1;function ol(){Eo||(Eo=!0,il.then(Rr))}function _o(s){Mn.push(s)}const bo=new Set;let Tn=0;function Rr(){if(Tn!==0)return;const s=ci;do{try{for(;Tn<On.length;){const c=On[Tn];Tn++,li(c),rl(c.$$)}}catch(c){throw On.length=0,Tn=0,c}for(li(null),On.length=0,Tn=0;Sr.length;)Sr.pop()();for(let c=0;c<Mn.length;c+=1){const f=Mn[c];bo.has(f)||(bo.add(f),f())}Mn.length=0}while(On.length);for(;Cr.length;)Cr.pop()();Eo=!1,bo.clear(),li(s)}function rl(s){if(s.fragment!==null){s.update(),di(s.before_update);const c=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,c),s.after_update.forEach(_o)}}function al(s){const c=[],f=[];Mn.forEach(x=>s.indexOf(x)===-1?c.push(x):f.push(x)),f.forEach(x=>x()),Mn=c}const Ni=new Set;let sl;function ko(s,c){s&&s.i&&(Ni.delete(s),s.i(c))}function Ir(s,c,f,x){if(s&&s.o){if(Ni.has(s))return;Ni.add(s),sl.c.push(()=>{Ni.delete(s)}),s.o(c)}}function xr(s){s&&s.c()}function So(s,c,f){const{fragment:x,after_update:k}=s.$$;x&&x.m(c,f),_o(()=>{const F=s.$$.on_mount.map(Or).filter(Mr);s.$$.on_destroy?s.$$.on_destroy.push(...F):di(F),s.$$.on_mount=[]}),k.forEach(_o)}function Co(s,c){const f=s.$$;f.fragment!==null&&(al(f.after_update),di(f.on_destroy),f.fragment&&f.fragment.d(c),f.on_destroy=f.fragment=null,f.ctx=[])}function ll(s,c){s.$$.dirty[0]===-1&&(On.push(s),ol(),s.$$.dirty.fill(0)),s.$$.dirty[c/31|0]|=1<<c%31}function Ao(s,c,f,x,k,F,T=null,E=[-1]){const z=ci;li(s);const te=s.$$={fragment:null,ctx:[],props:F,update:tn,not_equal:k,bound:kr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(c.context||(z?z.$$.context:[])),callbacks:kr(),dirty:E,skip_bound:!1,root:c.target||z.$$.root};T&&T(te.root);let ce=!1;if(te.ctx=f?f(s,c.props||{},(K,he,...be)=>{const Ue=be.length?be[0]:he;return te.ctx&&k(te.ctx[K],te.ctx[K]=Ue)&&(!te.skip_bound&&te.bound[K]&&te.bound[K](Ue),ce&&ll(s,K)),he}):[],te.update(),ce=!0,di(te.before_update),te.fragment=x?x(te.ctx):!1,c.target){if(c.hydrate){const K=Zs(c.target);te.fragment&&te.fragment.l(K),K.forEach(tt)}else te.fragment&&te.fragment.c();c.intro&&ko(s.$$.fragment),So(s,c.target,c.anchor),Rr()}li(z)}class Lo{constructor(){cn(this,"$$");cn(this,"$$set")}$destroy(){Co(this,1),this.$destroy=tn}$on(c,f){if(!Mr(f))return tn;const x=this.$$.callbacks[c]||(this.$$.callbacks[c]=[]);return x.push(f),()=>{const k=x.indexOf(f);k!==-1&&x.splice(k,1)}}$set(c){this.$$set&&!zs(c)&&(this.$$.skip_bound=!0,this.$$set(c),this.$$.skip_bound=!1)}}const cl="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(cl);const Ar="blockscape:apicurioConfig",vo="http://localhost:8080/apis/registry/v3",Ai="bs",Lr="-series",wo=!1,yo=!1;function dl({models:s,getActiveIndex:c,setActive:f,ensureModelMetadata:x,ensureSeriesId:k,getModelId:F,getSeriesId:T,getModelTitle:E,computeJsonFingerprint:z,uid:te}){let ce=null,K=null,he=null,be=null,Ue=null,q=null,Y=null,ie=null,G=null,Z=null;const Me=new Set,O={baseUrl:vo,groupId:Ai,authToken:"",enabled:wo,useSemver:yo},pe=new Map,ae=new Map;function we(l){return(l||"").toString().trim().replace(/\/+$/,"")}function fe(l){return`${(l||"").toString().trim()||Ai}${Lr}`}function ye(){return!!(O.baseUrl&&O.groupId)}function ne(){return O.enabled!==!1}function Fe(){Me.forEach(l=>{try{l(ne())}catch(u){console.warn("[Blockscape] failed to run Apicurio enabled listener",u)}})}function ot(l){return typeof l=="function"&&Me.add(l),()=>Me.delete(l)}function ke(){he&&(he.value=O.baseUrl||""),be&&(be.value=O.groupId||""),Ue&&(Ue.value=O.authToken||""),q&&(q.checked=ne()),Y&&(Y.checked=!!O.useSemver)}function V(l="",u="muted"){ie&&(ie.textContent=l||"",ie.classList.remove("is-error","is-success"),u==="error"?ie.classList.add("is-error"):u==="success"&&ie.classList.add("is-success"))}function de(l){if(!Z||(Z.innerHTML="",!l))return;const u=document.createElement("p");u.className="apicurio-hint",u.textContent=l,Z.appendChild(u)}function Ge(l){pe.clear(),ae.clear(),de(l)}function me(){const l=c(),u=ne(),S=ye(),_=l>=0?s[l]:null,g=!!(_!=null&&_.apicurioVersions&&_.apicurioVersions.length>1);if(ce){const A=ce.dataset.loading==="true",H=u&&S&&l>=0&&!!Re(s[l]);ce.disabled=!u||A||!H,u?A||(ce.textContent="Push to Apicurio"):ce.textContent="Enable Apicurio to push"}if(G){const A=G.dataset.loading==="true",H=u&&S&&g&&!!Re(_);G.disabled=!H||A,G.hidden=!g,u?A||(G.textContent="Push series"):G.textContent="Enable Apicurio to push series"}if(K){const A=K.dataset.loading==="true",H=u&&S;K.disabled=!H||A,A||(u?S?K.textContent="List artifacts":K.textContent="Enter details to list":K.textContent="Enable Apicurio to list")}}function Ie(){ke(),ne()?ye()?(V("Apicurio push is ready when a model is selected.","muted"),pe.size||de("Click “List artifacts” to browse the current group.")):(V("Enter Apicurio connection details to enable push.","muted"),Ge("Enter registry details to browse artifacts.")):(V("Apicurio integration is off. Enable it to allow pushes.","muted"),Ge("Apicurio integration is disabled.")),me()}function je(){if(window!=null&&window.localStorage)try{localStorage.setItem(Ar,JSON.stringify(O))}catch(l){console.warn("[Blockscape] unable to persist Apicurio settings",l)}}function Je(){let l={};if(window!=null&&window.localStorage)try{const A=localStorage.getItem(Ar);if(A){const H=JSON.parse(A);H&&typeof H=="object"&&(l=H)}}catch(A){console.warn("[Blockscape] failed to restore Apicurio settings",A)}const u=we(l.baseUrl??vo),S=(l.groupId??Ai).toString().trim();let _=wo,g=yo;typeof l.enabled=="boolean"?_=l.enabled:typeof l.enabled=="string"&&(_=l.enabled==="true"),typeof l.useSemver=="boolean"?g=l.useSemver:typeof l.useSemver=="string"&&(g=l.useSemver==="true"),O.baseUrl=u||vo,O.groupId=S||Ai,O.authToken=(l.authToken??"").toString().trim(),O.enabled=_,O.useSemver=g,Ie(),Fe()}function Pe(){const l={Accept:"application/json"},u=(O.authToken||"").trim();return u&&(l.Authorization=/\s/.test(u)?u:`Bearer ${u}`),l}function ue(l,u,{title:S,description:_,version:g}={}){const A={artifactId:l,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:u},metadata:{properties:{}}}};g&&(A.firstVersion.version=g),S&&(A.name=S),_&&(A.description=_);try{const H=JSON.parse(u),U=H==null?void 0:H.seriesId;U&&typeof U=="string"&&(A.firstVersion.metadata.properties.seriesId=U)}catch{}return A}function ze(l,{version:u}={}){const S={content:{contentType:"application/json",content:l},metadata:{properties:{}}};try{const _=JSON.parse(l),g=_==null?void 0:_.seriesId;g&&typeof g=="string"&&(S.metadata.properties.seriesId=g)}catch{}return u&&(S.version=u),S}function Ct(l){if(l==null)return null;const u=String(l).trim();if(!u)return null;const S=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(u);if(S)return{major:Number(S[1]),minor:Number(S[2]),patch:Number(S[3])};const _=/^v?(\d+)$/.exec(u);return _?{major:Number(_[1]),minor:0,patch:0}:null}function Qe(l){return`${l.major}.${l.minor}.${l.patch}`}function C(l,u){return!l&&!u?0:l?u?l.major!==u.major?l.major-u.major:l.minor!==u.minor?l.minor-u.minor:l.patch-u.patch:1:-1}function b(l=[]){let u=null;if(l.forEach(_=>{const g=Ct((_==null?void 0:_.version)??_);g&&(!u||C(g,u)>0)&&(u=g)}),!u)return"1.0.0";const S={...u,patch:u.patch+1};return Qe(S)}function Re(l,{seriesName:u,fallbackTitle:S}={}){var A;if(!l)return null;const _=u||l.title||l.apicurioArtifactName||E(l),g=S||_;if(typeof k=="function"&&(l.isSeries||((A=l.apicurioVersions)==null?void 0:A.length)>1)&&k(l,{seriesName:_,fallbackTitle:g}),typeof T=="function"){const H=T(l,{seriesName:_,fallbackTitle:g});if(H)return H}return F(l)}function R(l){return Array.isArray(l)?l:Array.isArray(l==null?void 0:l.artifacts)?l.artifacts:Array.isArray(l==null?void 0:l.items)?l.items:Array.isArray(l==null?void 0:l.results)?l.results:[]}function se(l){return Array.isArray(l)?l:Array.isArray(l==null?void 0:l.versions)?l.versions:Array.isArray(l==null?void 0:l.items)?l.items:[]}function Be(l=[]){if(!Array.isArray(l)||!l.length)return null;const u=[...l].filter(Boolean);return u.sort((S,_)=>{const g=S!=null&&S.createdOn?new Date(S.createdOn).getTime():0,A=_!=null&&_.createdOn?new Date(_.createdOn).getTime():0;if(g!==A)return A-g;const H=Number(S==null?void 0:S.version),U=Number(_==null?void 0:_.version),oe=Number.isFinite(H),D=Number.isFinite(U);if(oe&&D&&H!==U)return U-H;const W=String((S==null?void 0:S.version)??"");return String((_==null?void 0:_.version)??"").localeCompare(W,void 0,{numeric:!0})}),u[0]||null}function M(l){if(!l)return l;let u=l;if(!Array.isArray(l==null?void 0:l.categories)){const _=l==null?void 0:l.content;if(typeof _=="string")try{u=JSON.parse(_)}catch(g){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",g)}else _&&typeof _=="object"&&(u=_)}return u}async function Ee(l,u,S){const _=encodeURIComponent(u),g=encodeURIComponent(S),A=`${l}/groups/${_}/artifacts/${g}`,H=Pe();H.Accept="application/json";const U=await fetch(A,{method:"GET",headers:H});if(!U.ok){let oe=U.statusText||"Unknown error";try{const D=await U.text();D&&(oe=D.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${U.status}): ${oe}`)}return U.json()}async function $e(l,u,S){const _=encodeURIComponent(u),g=encodeURIComponent(S),A=`${l}/groups/${_}/artifacts/${g}/versions?limit=50&order=desc`,H=Pe();H.Accept="application/json";const U=await fetch(A,{method:"GET",headers:H});if(!U.ok){let D=U.statusText||"Unknown error";try{const W=await U.text();W&&(D=W.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${U.status}): ${D}`)}const oe=await U.json();return se(oe).filter(D=>D&&D.version!=null)}async function Oe(l,u,S,_="latest"){const g=encodeURIComponent(u),A=encodeURIComponent(S),H=encodeURIComponent(_||"latest"),U=`${l}/groups/${g}/artifacts/${A}/versions/${H}/content`,oe=Pe();oe.Accept="application/json, application/*+json, */*;q=0.8";const D=await fetch(U,{method:"GET",headers:oe});if(!D.ok){let De=D.statusText||"Unknown error";try{const le=await D.text();le&&(De=le.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${D.status}): ${De}`)}const W=await D.text();let _e=null;try{_e=JSON.parse(W)}catch{throw new Error("Artifact content is not valid JSON.")}return M(_e)}async function Xt(l,u,S,_="latest"){const g=await Oe(l,u,S,_);return{data:g,fingerprint:z(g)}}async function gt(l,u,S){try{const g=await $e(l,u,S);if(g!=null&&g.length){ae.set(S,g);const A=Be(g);if((A==null?void 0:A.version)!=null)return A.version}}catch(g){console.warn("[Blockscape] compare-version: unable to fetch versions list",g)}try{const g=await Ee(l,u,S);if((g==null?void 0:g.version)!=null)return g.version}catch(g){console.warn("[Blockscape] compare-version: unable to fetch metadata",g)}const _=ae.get(S);if(_&&_.length){const g=Be(_);if((g==null?void 0:g.version)!=null)return g.version}return"latest"}async function $t(l,u,S,_){if(!O.useSemver)return null;if(!_)return"1.0.0";try{const g=await $e(l,u,S);return b(g)}catch(g){throw new Error(`Unable to compute next semantic version: ${g.message}`)}}function rt(l=document){ce=l.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),G=l.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),K=l.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),he=l.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),be=l.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),Ue=l.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),q=l.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),Y=l.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),ie=l.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),Z=l.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function It(){O.baseUrl=we((he==null?void 0:he.value)??O.baseUrl),O.groupId=((be==null?void 0:be.value)??"").trim(),O.authToken=((Ue==null?void 0:Ue.value)??"").trim(),je(),Ie()}function Ke(l){O.enabled=l!==!1,je(),Ie(),Fe()}function Ot(){Ke(q?q.checked:wo)}function xt(){O.useSemver=Y?Y.checked:yo,je(),Ie()}function un(){[he,be,Ue].forEach(l=>{l&&l.addEventListener("input",It)}),ce&&ce.addEventListener("click",()=>{nn()}),G&&G.addEventListener("click",()=>{Lt()}),q&&q.addEventListener("change",Ot),Y&&Y.addEventListener("change",xt),K&&K.addEventListener("click",Vt),Z&&Z.addEventListener("click",l=>{const u=l.target.closest("[data-artifact-version]");if(u){l.stopPropagation();const g=u.dataset.artifactId,A=u.dataset.artifactVersion;g&&A&&Ut(g,A);return}const S=l.target.closest("[data-artifact-load-all]");if(S){l.stopPropagation(),S.dataset.artifactId&&ut();return}const _=l.target.closest("[data-artifact-trigger]");if(_){const g=_.dataset.artifactId;if(!g)return;Rt(g)}})}function Zt(){const l=document.createElement("div");return l.className="blockscape-registry-panel",l.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,l}function Mt(l){if(!l)return;l.innerHTML="";const u=Zt();l.appendChild(u),rt(l),un(),Ie()}function bt(l){if(!Z)return;if(Z.innerHTML="",!l.length){de("No artifacts found in this group.");return}const u=g=>{const A=document.createElement("section");A.className="apicurio-artifact-section";const H=document.createElement("h3");H.textContent=g,A.appendChild(H);const U=document.createElement("ul");return U.className="apicurio-artifact-list",A.appendChild(U),{section:A,list:U}},S=u("Series artifacts"),_=u("Artifacts");l.forEach(g=>{if(!(g!=null&&g.artifactId))return;const H=g._groupId&&g._groupId.endsWith(Lr)?S.list:_.list,U=document.createElement("li"),oe=document.createElement("button");oe.type="button",oe.className="apicurio-artifact",oe.dataset.artifactId=g.artifactId,oe.dataset.artifactTrigger="toggle";const D=document.createElement("span");D.className="apicurio-artifact-title",D.textContent=g.artifactId,oe.appendChild(D);const W=[];if(g.name&&W.push(g.name),g.version!=null&&W.push(`v${g.version}`),g.type&&W.push(g.type),g._groupId&&W.push(g._groupId),W.length){const le=document.createElement("span");le.className="apicurio-artifact-meta",le.textContent=W.join(" • "),oe.appendChild(le)}if(g.description){const le=document.createElement("span");le.className="apicurio-artifact-meta",le.textContent=g.description,oe.appendChild(le)}U.appendChild(oe);const _e=document.createElement("div");_e.className="apicurio-version-list",_e.dataset.versionPanel=g.artifactId,_e.hidden=!0;const De=document.createElement("p");De.className="apicurio-hint",De.textContent="Click to load the latest or open versions.",_e.appendChild(De),U.appendChild(_e),H.appendChild(U)}),S.list.children.length&&Z.appendChild(S.section),_.list.children.length&&Z.appendChild(_.section)}function dt(l){return Z?Z.querySelector(`[data-version-panel="${l}"]`):null}function Xe(l,u){if(!l||(l.innerHTML="",!u))return;const S=document.createElement("p");S.className="apicurio-hint",S.textContent=u,l.appendChild(S)}function Pt(l,u){const S=dt(l);if(S){if(S.innerHTML="",!u.length){Xe(S,"No versions found for this artifact.");return}u.forEach(_=>{const g=document.createElement("button");g.type="button",g.className="apicurio-version-button",g.dataset.artifactId=l,g.dataset.artifactVersion=_.version;const A=[`Version ${_.version}`];if(_.createdOn){const H=new Date(_.createdOn);isNaN(H)||A.push(H.toISOString().slice(0,10))}g.textContent=A.join(" — "),S.appendChild(g)})}}async function Rt(l){const u=dt(l);if(!u)return;if(u.dataset.open==="true"){u.hidden=!0,u.dataset.open="false";return}if(u.hidden=!1,u.dataset.open="true",u.dataset.loaded!=="true"){if(!ye()){Xe(u,"Enter registry details first.");return}Xe(u,"Loading versions…");try{const _=we(O.baseUrl),g=pe.get(l),A=O.groupId.trim(),H=(g==null?void 0:g._groupId)||A,U=await $e(_,H,l);ae.set(l,U),u.dataset.loaded="true",Pt(l,U)}catch(_){console.error("[Blockscape] failed to load versions",_),Xe(u,`Unable to fetch versions: ${_.message}`)}}}function yt(l,u){var _;const S=s.findIndex(g=>g.apicurioArtifactId===l);if(S!==-1){const g=s[S].id;s[S]={...u,id:g||u.id},((_=s[S].apicurioVersions)==null?void 0:_.length)>1&&(s[S].isSeries=!0),f(S)}else s.push(u),f(s.length-1)}async function At(l,u,S,_){const g=encodeURIComponent(u),A=encodeURIComponent(S),H=`${l}/groups/${g}/artifacts/${A}`;try{const U=await fetch(H,{method:"GET",headers:_});if(U.status===404)return!1;if(U.ok)return!0;throw U.status===401||U.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${U.status} while checking the artifact.`)}catch(U){throw U instanceof TypeError?new Error("Network error while contacting Apicurio registry."):U}}async function nn(){var H;if(!ce||ce.dataset.loading==="true")return;if(!ne()){V("Apicurio integration is off. Enable it first.","error");return}if(!ye()){V("Enter the registry base URL and group ID before pushing.","error");return}const l=c();if(l<0||!s[l]){V("No active model to push.","error");return}const u=Re(s[l],{fallbackTitle:E(s[l])});if(!u){V("Active model needs an id before pushing.","error");return}const S=we(O.baseUrl),_=O.groupId.trim(),g=JSON.stringify(s[l].data,null,2),A=Pe();ce.dataset.loading="true",ce.textContent="Pushing…",ce.disabled=!0,V("Pushing to Apicurio…","muted");try{const U=await At(S,_,u,A),oe=z(s[l].data);if(U)try{const xe=await gt(S,_,u),{data:at,fingerprint:st}=await Xt(S,_,u,xe);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",xe),console.log("local fingerprint",oe),console.log("registry fingerprint",st),console.log("local payload",s[l].data),console.log("registry payload",at),console.groupEnd(),oe&&st&&oe===st){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){V("Push cancelled (content matches the latest registry version).","muted");return}V("Pushing identical content by user choice.","muted")}else st?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):V("Unable to compare with registry content (skipping confirmation).","muted")}catch(xe){console.warn("[Blockscape] unable to compare registry content before push",xe),V("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const D=O.useSemver?await $t(S,_,u,U):null;if(O.useSemver&&!D)throw new Error("Semantic versioning is enabled but no version could be computed.");const W=encodeURIComponent(_),_e=encodeURIComponent(u),De=U?`${S}/groups/${W}/artifacts/${_e}/versions`:`${S}/groups/${W}/artifacts`,le={...A,"Content-Type":"application/json"};D&&(le["X-Registry-Version"]=D,V(`Pushing to Apicurio as version ${D}…`,"muted"));const Et=U?ze(g,{version:D}):ue(u,g,{title:E(s[l]),description:(H=s[l].data)==null?void 0:H.abstract,version:D}),_t=await fetch(De,{method:"POST",headers:le,body:JSON.stringify(Et)});if(!_t.ok){let xe=_t.statusText||"Unknown error";try{const at=await _t.text();at&&(xe=at.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${_t.status}): ${xe}`)}let Ze=null;try{Ze=await _t.json()}catch{Ze=null}const ve=(Ze==null?void 0:Ze.version)||(Ze==null?void 0:Ze.globalId)||"",We=U?"Updated":"Created",Nt=ve?` (version ${ve})`:"";V(`${We} ${u}${Nt}`,"success")}catch(U){console.error("[Blockscape] Apicurio push failed",U),V(`Apicurio push failed: ${U.message}`,"error")}finally{ce.dataset.loading="false",me()}}async function Lt(){var D,W;if(!G||G.dataset.loading==="true")return;if(!ne()){V("Apicurio integration is off. Enable it first.","error");return}if(!ye()){V("Enter the registry base URL and group ID before pushing.","error");return}const l=c(),u=l>=0?s[l]:null;if(!u||!u.apicurioVersions||u.apicurioVersions.length<2){V("Series push requires a model with multiple versions.","error");return}const S=Re(u,{seriesName:u.title||u.apicurioArtifactName||E(u)});if(!S){V("Active series needs an id before pushing.","error");return}typeof k=="function"&&k(u,{seriesName:u.title||u.apicurioArtifactName||E(u)});const _=we(O.baseUrl),g=O.groupId.trim(),A=u.apicurioVersions.map(_e=>_e.data),H=JSON.stringify(A,null,2),U=Pe(),oe=fe(g);G.dataset.loading="true",G.textContent="Pushing…",G.disabled=!0,V("Pushing series to Apicurio…","muted");try{const _e=await At(_,oe,S,U),De=z(A);if(_e)try{const Tt=await gt(_,oe,S),{data:pn,fingerprint:on}=await Xt(_,oe,S,Tt);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",Tt),console.log("local fingerprint",De),console.log("registry fingerprint",on),console.log("local payload (series)",A),console.log("registry payload",pn),console.groupEnd(),De&&on&&De===on){if(!window.confirm("The current registry version matches this series. Push anyway?")){V("Series push cancelled (content matches latest).","muted");return}V("Pushing identical series by user choice.","muted")}else on?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):V("Unable to compare with registry content (skipping confirmation).","muted")}catch(Tt){console.warn("[Blockscape] unable to compare registry content before series push",Tt),V("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const le=O.useSemver?await $t(_,oe,S,_e):null;if(O.useSemver&&!le)throw new Error("Semantic versioning is enabled but no version could be computed.");const Et=encodeURIComponent(oe),_t=encodeURIComponent(S),Ze=_e?`${_}/groups/${Et}/artifacts/${_t}/versions`:`${_}/groups/${Et}/artifacts`,ve={...U,"Content-Type":"application/json"};le&&(ve["X-Registry-Version"]=le,V(`Pushing series to Apicurio as version ${le}…`,"muted"));const We=_e?ze(H,{version:le}):ue(S,H,{title:u.apicurioArtifactName||((D=u.data)==null?void 0:D.title)||S,description:(W=u.data)==null?void 0:W.abstract,version:le}),Nt=await fetch(Ze,{method:"POST",headers:ve,body:JSON.stringify(We)});if(!Nt.ok){let Tt=Nt.statusText||"Unknown error";try{const pn=await Nt.text();pn&&(Tt=pn.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${Nt.status}): ${Tt}`)}let xe=null;try{xe=await Nt.json()}catch{xe=null}const at=(xe==null?void 0:xe.version)||(xe==null?void 0:xe.globalId)||"",st=_e?"Updated":"Created",Kt=at?` (version ${at})`:"";V(`${st} ${S} series${Kt}`,"success")}catch(_e){console.error("[Blockscape] Apicurio series push failed",_e),V(`Apicurio series push failed: ${_e.message}`,"error")}finally{G.dataset.loading="false",me()}}async function Vt(){if(!K||K.dataset.loading==="true")return;if(!ne()){V("Enable Apicurio integration to list artifacts.","error");return}if(!ye()){V("Enter registry base URL and group ID before listing.","error");return}const l=we(O.baseUrl),u=O.groupId.trim(),S=fe(u),_=[{groupId:u,label:"base"},{groupId:S,label:"series"}];K.dataset.loading="true",K.textContent="Listing…",K.disabled=!0,V("Listing artifacts…","muted"),de("Contacting registry…");try{const g=Pe();g.Accept="application/json";const A=[];for(const U of _){const oe=encodeURIComponent(U.groupId),D=`${l}/groups/${oe}/artifacts?limit=50&offset=0`,W=await fetch(D,{method:"GET",headers:g});if(!W.ok){let le=W.statusText||"Unknown error";try{const Et=await W.text();Et&&(le=Et.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${U.groupId} (${W.status}): ${le}`);continue}const _e=await W.json(),De=R(_e).filter(le=>le&&le.artifactId);De.forEach(le=>{le&&(le._groupId=U.groupId)}),A.push(...De)}pe.clear(),ae.clear(),A.forEach(U=>{U!=null&&U.artifactId&&pe.set(U.artifactId,U)}),bt(A);const H=A.length;V(H?`Found ${H} artifact${H===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",H?"success":"muted")}catch(g){console.error("[Blockscape] failed to list artifacts",g),Ge("Unable to list artifacts."),V(`Listing failed: ${g.message}`,"error")}finally{K.dataset.loading="false",me()}}async function Ut(l,u=null){var _e,De,le,Et,_t,Ze;if(!l)return;if(!ne()){V("Enable Apicurio integration to load artifacts.","error");return}if(!ye()){V("Enter registry connection details before loading artifacts.","error");return}const S=we(O.baseUrl),_=O.groupId.trim(),g=l&&((_e=pe.get(l))==null?void 0:_e._groupId)||_;let A=pe.get(l);const H=async()=>{try{const ve=await Ee(S,g,l);return ve!=null&&ve.artifactId&&pe.set(l,ve),ve}catch(ve){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",ve),ve}};if(!A)try{A=await H()}catch(ve){V(`Failed to fetch artifact metadata: ${ve.message}`,"error");return}const U=ae.get(l)||[];let oe="latest",D="latest";if(u)oe=u,D=u;else{if(!A||A.version==null)try{A=await H()}catch(ve){V(`Failed to fetch artifact metadata: ${ve.message}`,"error");return}oe=(A==null?void 0:A.version)||"latest",D=(A==null?void 0:A.version)||"latest"}const W=U.find(ve=>String(ve.version)===String(oe));(W==null?void 0:W.version)!=null&&(D=W.version),V(`Loading artifact ${l}…`,"muted");try{const ve=await Oe(S,g,l,oe),We=pe.get(l)||A||{},Nt=Array.isArray(ve);let xe=null;if(Nt){const at=ve.map((Kt,Tt)=>(x(Kt,{titleHint:We.name||l,idHint:l}),{version:String(Tt+1),data:Kt,createdOn:(W==null?void 0:W.createdOn)||We.createdOn}));xe={id:te(),title:((le=(De=at[0])==null?void 0:De.data)==null?void 0:le.title)||We.name||l,data:(Et=at[0])==null?void 0:Et.data,apicurioArtifactId:l,apicurioArtifactName:We.name||"",apicurioVersions:at,apicurioActiveVersionIndex:0,isSeries:!0};const st=((_t=We==null?void 0:We.properties)==null?void 0:_t.seriesId)||l;typeof k=="function"&&k(xe,{seriesName:st,fallbackTitle:st}),V(`Loaded series artifact ${l}.`,"success")}else{x(ve,{titleHint:We.name||l,idHint:l});const at={version:D,data:ve,createdOn:(W==null?void 0:W.createdOn)||We.createdOn};xe={id:te(),title:ve.title||We.name||l,data:ve,apicurioArtifactId:l,apicurioArtifactName:We.name||"",apicurioVersions:[at],apicurioActiveVersionIndex:0};const st=(Ze=We==null?void 0:We.properties)==null?void 0:Ze.seriesId;st&&typeof k=="function"&&k(xe,{seriesName:st,fallbackTitle:st});const Kt=D?` (version ${D})`:"";V(`Loaded artifact ${l}${Kt}.`,"success")}yt(l,xe)}catch(ve){console.error("[Blockscape] failed to load artifact",ve),V(`Failed to load artifact: ${ve.message}`,"error")}}async function ut(l){}return{hydrateConfig:Je,mount:Mt,updateAvailability:me,isEnabled:ne,setEnabled:Ke,onEnabledChange:ot}}function Bn(s,c){if(typeof s!="function")throw new Error(`[itemEditor] expected ${c} to be a function`)}function ul(s,{excludeId:c}={}){if(!s)return[];const f=s.split(/[\s,]+/).map(k=>k.trim()).filter(Boolean),x=[];return f.forEach(k=>{c&&k===c||x.includes(k)||x.push(k)}),x}function pl(s,c,f){if(!c||!f||c===f)return;((s==null?void 0:s.categories)||[]).forEach(k=>{(k.items||[]).forEach(F=>{Array.isArray(F.deps)&&(F.deps=F.deps.map(T=>T===c?f:T))})}),Array.isArray(s==null?void 0:s.links)&&s.links.forEach(k=>{k.from===c&&(k.from=f),k.to===c&&(k.to=f)})}function fl({findItemAndCategoryById:s,collectAllItemIds:c,updateItemReferences:f,loadActiveIntoEditor:x,rebuildFromActive:k,select:F,onSelectionRenamed:T}={}){Bn(s,"findItemAndCategoryById"),Bn(c,"collectAllItemIds"),Bn(f,"updateItemReferences"),Bn(x,"loadActiveIntoEditor"),Bn(k,"rebuildFromActive"),Bn(F,"select");const E={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function z(q){if(E.fields.errorEl){if(!q){E.fields.errorEl.hidden=!0,E.fields.errorEl.textContent="";return}E.fields.errorEl.hidden=!1,E.fields.errorEl.textContent=q}}function te(){E.wrapper&&(E.wrapper.hidden=!0,E.wrapper.setAttribute("aria-hidden","true"),z(""),E.categoryId=null,E.itemId=null,E.modelData=null,document.body.classList.remove("item-editor-open"))}function ce(){E.wrapper&&(E.wrapper.hidden=!1,E.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var q,Y;(q=E.fields.nameInput)==null||q.focus(),(Y=E.fields.nameInput)==null||Y.select()}))}function K(q){var we;if(!E.modelData||!E.categoryId||!E.itemId)throw new Error("No item loaded.");const ie=(((we=E.modelData)==null?void 0:we.categories)||[]).find(fe=>fe.id===E.categoryId);if(!ie)throw new Error("Category not found.");ie.items=ie.items||[];const G=ie.items.find(fe=>fe.id===E.itemId);if(!G)throw new Error("Item not found.");const Z=(q.id||"").trim();if(!Z)throw new Error("ID is required.");const Me=c(E.modelData);if(Z!==G.id&&Me.has(Z))throw new Error("Another item already uses that ID.");G.id=Z;const O=(q.name||"").trim();G.name=O||G.id;const pe=(q.logo||"").trim();if(pe?G.logo=pe:delete G.logo,q.externalFlag&&!q.external)G.external=!0;else{const fe=(q.external??"").toString().trim();fe?G.external=fe:delete G.external}const ae=(q.color||"").trim();return ae?G.color=ae:delete G.color,G.deps=Array.isArray(q.deps)?q.deps:[],G.id!==q.originalId&&typeof T=="function"&&T(q.originalId,G.id),f(E.modelData,q.originalId,G.id),x(),k(),F(G.id),G.id}function he(){if(!E.fields||!E.fields.idInput)return!1;const q=(E.fields.idInput.value||"").trim(),Y={originalId:E.itemId,id:q,name:E.fields.nameInput.value||"",logo:E.fields.logoInput.value||"",external:E.fields.externalInput.value||"",externalFlag:E.fields.externalFlagInput.checked,color:E.fields.colorInput.value||"",deps:ul(E.fields.depsInput.value,{excludeId:q})};try{return K(Y),te(),!0}catch(ie){return console.warn("[itemEditor] item edit failed",ie),z((ie==null?void 0:ie.message)||"Unable to save item."),!1}}function be(){if(E.wrapper)return E.wrapper;const q=document.createElement("div");q.className="item-editor-modal",q.hidden=!0,q.setAttribute("role","dialog"),q.setAttribute("aria-modal","true");const Y=document.createElement("div");Y.className="item-editor-modal__backdrop",q.appendChild(Y);const ie=document.createElement("div");ie.className="item-editor",q.appendChild(ie);const G=document.createElement("div");G.className="item-editor__header";const Z=document.createElement("h2");Z.className="item-editor__title",Z.textContent="Edit item";const Me=document.createElement("button");Me.type="button",Me.className="item-editor__close",Me.setAttribute("aria-label","Close item editor"),Me.textContent="×",G.appendChild(Z),G.appendChild(Me),ie.appendChild(G);const O=document.createElement("form");O.className="item-editor__form",ie.appendChild(O);const pe=document.createElement("div");pe.className="item-editor__meta",pe.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',O.appendChild(pe);const ae=document.createElement("div");ae.className="item-editor__error",ae.hidden=!0,O.appendChild(ae);const we=(ue,ze,Ct)=>{const Qe=document.createElement("label");Qe.className="item-editor__field";const C=document.createElement("span");if(C.className="item-editor__label",C.textContent=ue,Qe.appendChild(C),ze.classList.add("item-editor__control"),Qe.appendChild(ze),Ct){const b=document.createElement("div");b.className="item-editor__hint",b.textContent=Ct,Qe.appendChild(b)}return Qe},fe=document.createElement("input");fe.type="text",fe.required=!0,O.appendChild(we("ID",fe,"Unique identifier used for links and dependencies."));const ye=document.createElement("input");ye.type="text",O.appendChild(we("Name",ye,"Visible label shown on the tile."));const ne=document.createElement("input");ne.type="url",ne.inputMode="url",ne.placeholder="https://…",O.appendChild(we("Logo URL",ne,"Optional image URL."));const Fe=document.createElement("input");Fe.type="url",Fe.inputMode="url",Fe.placeholder="https://…",O.appendChild(we("External link",Fe,"Shown with ↗ icon and in preview."));const ot=document.createElement("div");ot.className="item-editor__checkbox";const ke=document.createElement("label");ke.className="item-editor__checkbox-row";const V=document.createElement("input");V.type="checkbox";const de=document.createElement("span");de.textContent="Mark as external without link";const Ge=document.createElement("div");Ge.className="item-editor__hint",Ge.textContent="Keeps dashed border even without a URL.",ke.appendChild(V),ke.appendChild(de),ot.appendChild(ke),ot.appendChild(Ge),O.appendChild(ot);const me=document.createElement("input");me.type="text",me.placeholder="#2563eb",O.appendChild(we("Color",me,"Optional badge color (hex or CSS color)."));const Ie=document.createElement("textarea");Ie.rows=2,Ie.placeholder="Comma or space separated ids",O.appendChild(we("Dependencies",Ie,"Use item IDs, separated by commas or spaces."));const je=document.createElement("div");je.className="item-editor__actions";const Je=document.createElement("button");Je.type="button",Je.className="pf-v5-c-button pf-m-tertiary",Je.textContent="Cancel";const Pe=document.createElement("button");return Pe.type="submit",Pe.className="pf-v5-c-button pf-m-primary",Pe.textContent="Save",je.appendChild(Je),je.appendChild(Pe),O.appendChild(je),E.wrapper=q,E.fields={idInput:fe,nameInput:ye,logoInput:ne,externalInput:Fe,externalFlagInput:V,colorInput:me,depsInput:Ie,categoryValue:pe.querySelector(".item-editor__meta-value"),errorEl:ae},Je.addEventListener("click",te),Me.addEventListener("click",te),Y.addEventListener("click",te),O.addEventListener("submit",ue=>{ue.preventDefault(),he()}),document.addEventListener("keydown",ue=>{ue.key==="Escape"&&!q.hidden&&(ue.preventDefault(),ue.stopPropagation(),te())}),document.body.appendChild(q),q}function Ue(q){const Y=s(q);return Y?(be(),E.categoryId=Y.category.id,E.itemId=Y.item.id,E.modelData=Y.modelData,E.fields.categoryValue.textContent=Y.category.title||Y.category.id,E.fields.idInput.value=Y.item.id||"",E.fields.nameInput.value=Y.item.name||"",E.fields.logoInput.value=Y.item.logo||"",E.fields.externalInput.value=typeof Y.item.external=="string"?Y.item.external:"",E.fields.externalFlagInput.checked=Y.item.external===!0,E.fields.colorInput.value=Y.item.color||"",E.fields.depsInput.value=Array.isArray(Y.item.deps)?Y.item.deps.join(", "):"",z(""),F(Y.item.id),ce(),!0):!1}return{open:Ue,hide:te,isOpen:()=>!!E.wrapper&&!E.wrapper.hidden}}function Nr(s,c="series"){return(s||c).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||c}function dn(s,c="series"){const f=Nr(s,c).replace(/\./g,"-");return f.replace(/-series$/i,"").replace(/-+$/,"")||f||Nr(c,"series")}function Vr(s,{seriesName:c,fallbackTitle:f="unknown"}={}){var E,z;const k=[s==null?void 0:s.seriesId,(E=s==null?void 0:s.data)==null?void 0:E.seriesId,s==null?void 0:s.apicurioArtifactId,c,s==null?void 0:s.title,s==null?void 0:s.apicurioArtifactName,(z=s==null?void 0:s.data)==null?void 0:z.title,f].map(te=>(te??"").toString().trim()),F=k.findIndex(Boolean),T=F!==-1?k[F]:"";return T?(console.log("[Series] deriveSeriesId: picked base",{base:T,sourceIndex:F,candidates:k}),dn(T,f)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:f}),null)}function St(s,{seriesName:c,fallbackTitle:f="unknown"}={}){if(!s||typeof s!="object")return null;const x=Vr(s,{seriesName:c,fallbackTitle:f});return x?(s.seriesId=x,s.apicurioArtifactId||(s.apicurioArtifactId=x),x):null}function $n(s,c={}){var k,F;if(!s)return null;const f=s.isSeries||((k=s.apicurioVersions)==null?void 0:k.length)>1||s.seriesId||((F=s.data)==null?void 0:F.seriesId)||s.apicurioArtifactId;if(!f&&!c.force)return null;const x=Vr(s,c);return x||(f?dn(c.fallbackTitle||"unknown"):null)}const Li=typeof import.meta<"u"&&"./"||"";function ml(){console.log("[Blockscape] init");const s=document.getElementById("jsonBox"),c=document.querySelector(".blockscape-json-panel"),f=document.getElementById("app"),x=document.getElementById("overlay"),k=document.getElementById("tabTooltip"),F=document.getElementById("modelList"),T=document.getElementById("itemPreview"),E=document.getElementById("urlForm"),z=document.getElementById("urlInput"),te=document.getElementById("loadUrl"),ce=T.querySelector(".item-preview__title"),K=T.querySelector(".item-preview__body"),he=T.querySelector(".item-preview__actions"),be=T.querySelector(".item-preview__close"),Ue=document.getElementById("downloadJson"),q=document.getElementById("shareModel"),Y=document.getElementById("createVersion"),ie=document.getElementById("openInEditor"),G=document.getElementById("copyJson"),Z=document.getElementById("copySeries"),Me=document.getElementById("pasteJson"),O=document.getElementById("helpButton"),pe=document.getElementById("newPanelButton"),ae=document.getElementById("shortcutHelp"),we=document.getElementById("shortcutHelpList"),fe=document.getElementById("shortcutHelpClose"),ye=document.getElementById("shortcutHelpBackdrop"),ne=document.getElementById("newPanel"),Fe=document.getElementById("newPanelClose"),ot=document.getElementById("newPanelBackdrop"),ke=document.getElementById("search"),V=document.getElementById("searchResults"),de=document.getElementById("localBackendPanel"),Ge=document.getElementById("localBackendStatus"),me=document.getElementById("localFileList"),Ie=document.getElementById("localDirSelect"),je=document.getElementById("refreshLocalFiles"),Je=document.getElementById("loadLocalFile"),Pe=document.getElementById("saveLocalFile"),ue=document.getElementById("localSavePath"),ze="blockscape:editorPayload",Ct="blockscape:editorTransfer",Qe=document.title;de&&(de.hidden=!0),s.value=document.getElementById("seed").textContent.trim();let C=[],b=-1;const Re=dl({models:C,getActiveIndex:()=>b,setActive:ft,ensureModelMetadata:mn,getModelId:nt,getSeriesId:$n,ensureSeriesId:St,getModelTitle:Ve,computeJsonFingerprint:mi,uid:fn});let R=null,se=new Map,Be=new Map,M=null,Ee=null,$e=null,Oe=null,Xt=!0,gt=!1,$t=0,rt={x:0,y:0},It="map",Ke=null,Ot=null,xt=!1,un=null;const Zt=2e3;let Mt=null,bt=null,dt=null,Xe=null,Pt=null,Rt=null,yt=null,At="",nn=!1,Lt=null,Vt=null,Ut=null,ut=[],l=null;const u=qr(),S=u.detect(),_=30,g=1e3,A="blockscape:hoverScale",H=1.5,U=1,oe=2.5,D="blockscape:titleWrap",W="blockscape:titleHoverWidth",_e="blockscape:titleHoverTextPortion",De="wrap",le=1.3,Et=1,_t=1.6,Ze=.25,ve=0,We=.6,Nt="blockscape:tileCompactness",xe=1,at=.75,st=1.25,Kt="blockscape:obsidianLinksEnabled",Tt="blockscape:obsidianLinkMode",pn="blockscape:obsidianVault",on="title",Pn="id",ui=on;let Rn=H,Vn=xe,No=De,Un=le,Dn=Ze,Hn=!1,pi=ui,Fn="";const To="blockscape:seriesNavDoubleClickMs",jn=900,Bo=300,$o=4e3;let kn=jn;Re.hydrateConfig(),Qr(),ta(),sa(),ia(),ra(),da(),ha(),fa(),ba(),pt();function fn(){return Math.random().toString(36).slice(2,10)}function Ur(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function Dr(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function Hr(e){return Ur(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Fr(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),Dr(t)}function jr(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}function Jr(){if(typeof window>"u"||!window.location)return!1;const e=new URL(window.location.href),n=e.pathname.replace(/\/+$/,"").split("/").filter(Boolean).pop()||"",i=e.searchParams.get("server");return n.toLowerCase()==="server"||i&&["1","true","yes","on"].includes(i.toLowerCase())}function Wr(){return typeof window>"u"||!window.location?!1:(window.location.hostname||"").toLowerCase().endsWith("github.io")}function qr(){const e=()=>typeof window>"u"||!window.location?{}:{host:window.location.host,path:window.location.pathname,search:window.location.search,hash:window.location.hash};function t(B,P={}){console.log("[Blockscape][local-backend]",B,{...e(),...P})}if(Wr())return t("Disabled on github.io host"),de&&(de.hidden=!0),{detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1};if(!Jr()||!de||!Ge)return t("Opt-in flag missing or panel unavailable"),de&&(de.hidden=!0),{detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1};if(!de||!Ge)return{detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1};let i=!1,o="",r=[],a=[],d="";function p(B){if(!B)return"";const P=B.split("/").filter(Boolean);return P.pop(),P.join("/")}function h(B,{error:P=!1}={}){Ge.textContent=B,Ge.style.color=P?"#b42318":"",t("Status",{text:B,error:P})}function v(B){const P=(B||"").trim().replace(/\\/g,"/").replace(/^\/+/,"");return!P||P.includes("..")?null:P.toLowerCase().endsWith(".bs")?P:`${P}.bs`}function N(){var P;if(b>=0&&((P=C[b])!=null&&P.sourcePath))return C[b].sourcePath;if(b<0)return"blockscape.bs";const B=Ve(C[b])||"blockscape";return`${dn(B,"blockscape")}.bs`}function I(){var B;ue&&(ue.placeholder=N(),(B=C[b])!=null&&B.sourcePath&&(ue.value=C[b].sourcePath))}function L(){if(!Ie)return;Ie.innerHTML="";const B=document.createElement("option");B.value="",B.textContent="All (~/blockscape)",Ie.appendChild(B),a.forEach(Q=>{const ge=document.createElement("option");ge.value=Q,ge.textContent=Q||"(root)",Ie.appendChild(ge)});const P=a.includes(d)?d:"";Ie.value=P,d=P}function j(){if(!me)return;me.innerHTML="";const B=d?r.filter(P=>P.path.startsWith(`${d}/`)):r;if(!B.length){const P=document.createElement("option");P.disabled=!0,P.textContent="No .bs files found yet",me.appendChild(P),me.disabled=!0;return}me.disabled=!1,B.forEach(P=>{const Q=document.createElement("option");Q.value=P.path;const ge=P.mtimeMs?new Date(P.mtimeMs).toLocaleString():"";Q.textContent=ge?`${P.path} · ${ge}`:P.path,me.appendChild(Q)}),o&&Array.from(me.options).forEach(P=>{P.value===o&&(P.selected=!0)}),!me.value&&me.options.length&&(me.options[0].selected=!0)}function re(B){i=!1,r=[],j(),de.hidden=!0,B&&h(B,{error:!0}),t("Panel hidden",{message:B})}async function Ae({silent:B=!1}={}){try{t("Health check start");const P=await fetch("/api/health",{cache:"no-store"});if(!P.ok)throw new Error(`HTTP ${P.status}`);const Q=await P.json();if(i=!!(Q!=null&&Q.ok),!i)throw new Error("Health check failed");return de.hidden=!1,B||h(Q.root?`Local server ready (root: ${Q.root})`:"Local server ready"),t("Health check ok",{payload:Q}),!0}catch(P){return B||console.log("[Blockscape] local backend health failed",P),re("Local server unavailable"),!1}}async function Se(){if(i&&me){h("Loading files…");try{const B=await fetch("/api/files",{cache:"no-store"});if(!B.ok)throw new Error(`HTTP ${B.status}`);r=((await B.json()).files||[]).slice().sort((ge,Ye)=>{const lt=(ge==null?void 0:ge.mtimeMs)||0,it=(Ye==null?void 0:Ye.mtimeMs)||0;return lt===it?(ge.path||"").localeCompare(Ye.path||""):it-lt});const Q=new Set;r.forEach(ge=>{Q.add(p(ge.path))}),a=Array.from(Q).filter(ge=>ge!=="").sort(),d&&!Q.has(d)&&(d=""),!d&&o&&(d=p(o)),L(),j(),h(r.length?`Browsing ${r.length} file(s) in ~/blockscape`:"No .bs files in ~/blockscape yet")}catch(B){console.warn("[Blockscape] local backend refresh failed",B),re("Local server unavailable")}}}async function Le(){i=!1,re(),h("Checking for local server…");try{return t("Detect start"),await Ae()?(I(),await Se(),!0):!1}catch(B){return i=!1,console.log("[Blockscape] local backend not detected",B),t("Detect failed",{err:B}),!1}}async function Ne(){if(!i||!me)return;const B=Array.from(me.selectedOptions||[]).map(Q=>Q.value).filter(Boolean);if(!B.length){alert("Select one or more files to load from ~/blockscape.");return}let P=null;for(const Q of B)try{h(`Loading ${Q}…`);const ge=await fetch(`/api/file?path=${encodeURIComponent(Q)}`,{cache:"no-store"});if(!ge.ok)throw new Error(`HTTP ${ge.status}`);const Ye=await ge.json(),lt=JSON.stringify(Ye.data??Ye,null,2),it=rn(lt,Q,{seriesTitleOverride:`${Q} series`});if(!it.length)throw new Error("No models found in file");it.forEach((ht,qe)=>{ht.sourcePath=Q;const sn=Qt(ht,{versionLabel:it.length>1?`${Q} #${qe+1}`:Q});P==null&&(P=sn)}),o=Q}catch(ge){console.error("[Blockscape] failed to load from local server",ge),alert(`Local load failed for ${Q}: ${ge.message}`)}P!=null&&ft(P),h(`Loaded ${B.length} file(s)`),j()}async function kt(){var P;if(!i)return;if(b<0){alert("No active model to save.");return}const B=v(ue==null?void 0:ue.value)||v((P=C[b])==null?void 0:P.sourcePath)||N();if(!B){alert("Enter a relative path (no ..) to save under ~/blockscape.");return}try{const Q=JSON.stringify(C[b].data,null,2);h(`Saving to ${B}…`);const ge=await fetch(`/api/file?path=${encodeURIComponent(B)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:Q});if(!ge.ok)throw new Error(`HTTP ${ge.status}`);const Ye=await ge.json();o=Ye.path||B,C[b].sourcePath=Ye.path||B,h(`Saved to ${Ye.path||B}`),await Se()}catch(Q){console.error("[Blockscape] local save failed",Q),alert(`Local save failed: ${Q.message}`),re("Local server unavailable")}}return je&&(je.onclick=()=>Se()),Je&&(Je.onclick=()=>Ne()),Pe&&(Pe.onclick=()=>kt()),me&&ue&&(me.addEventListener("change",()=>{const B=Array.from(me.selectedOptions||[])[0];B!=null&&B.value&&(ue.value=B.value)}),me.addEventListener("dblclick",()=>{Ne()})),Ie&&Ie.addEventListener("change",()=>{d=Ie.value||"",j()}),{detect:Le,refresh:Se,updateActiveSavePlaceholder:I,isAvailable:()=>i}}async function Oo(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function Gr(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function Jn(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function zr(e){return Number.isFinite(e)?Math.min(oe,Math.max(U,e)):H}function pt(){if(!f)return;const e=!!M||!!Ee;f.classList.toggle("blockscape-has-selection",e)}function Wn(e){return Rn=zr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-scale",Rn),Rn}function Kr(e){return Number.isFinite(e)?Math.min(st,Math.max(at,e)):xe}function qn(e){return Vn=Kr(e),document.documentElement.style.setProperty("--blockscape-tile-compactness",Vn),Vn}function Yr(e){return Number.isFinite(e)?Math.min(_t,Math.max(Et,e)):le}function Gn(e){return Un=Yr(e),document.documentElement.style.setProperty("--blockscape-title-hover-width-multiplier",Un),Un}function Xr(e){return Number.isFinite(e)?Math.min(We,Math.max(ve,e)):Ze}function zn(e){return Dn=Xr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-text-portion",Dn),Dn}function Kn(e){const t=e==="nowrap"?"nowrap":"wrap";No=t;const n=t==="nowrap"?"nowrap":"normal",i=t==="nowrap"?"nowrap":"normal";return document.documentElement.style.setProperty("--blockscape-title-white-space",n),document.documentElement.style.setProperty("--blockscape-title-text-wrap",i),t}function Zr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(A,String(e))}catch(t){console.warn("[Blockscape] failed to persist hover scale",t)}}function Qr(){if(typeof window>"u"||!window.localStorage)return Wn(H);try{const e=window.localStorage.getItem(A);if(!e)return Wn(H);const t=parseFloat(e);return Wn(t)}catch(e){return console.warn("[Blockscape] failed to read hover scale",e),Wn(H)}}function ea(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Nt,String(e))}catch(t){console.warn("[Blockscape] failed to persist tile compactness",t)}}function ta(){if(typeof window>"u"||!window.localStorage)return qn(xe);try{const e=window.localStorage.getItem(Nt);if(!e)return qn(xe);const t=parseFloat(e);return qn(t)}catch(e){return console.warn("[Blockscape] failed to read tile compactness",e),qn(xe)}}function na(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(W,String(e))}catch(t){console.warn("[Blockscape] failed to persist title hover width",t)}}function ia(){if(typeof window>"u"||!window.localStorage)return Gn(le);try{const e=window.localStorage.getItem(W);if(!e)return Gn(le);const t=parseFloat(e);return Gn(t)}catch(e){return console.warn("[Blockscape] failed to read title hover width",e),Gn(le)}}function oa(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(_e,String(e))}catch(t){console.warn("[Blockscape] failed to persist title text zoom",t)}}function ra(){if(typeof window>"u"||!window.localStorage)return zn(Ze);try{const e=window.localStorage.getItem(_e);if(!e)return zn(Ze);const t=parseFloat(e);return zn(t)}catch(e){return console.warn("[Blockscape] failed to read title text zoom",e),zn(Ze)}}function aa(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(D,e)}catch(t){console.warn("[Blockscape] failed to persist title wrap mode",t)}}function sa(){if(typeof window>"u"||!window.localStorage)return Kn(De);try{const e=window.localStorage.getItem(D);return Kn(e||De)}catch(e){return console.warn("[Blockscape] failed to read title wrap mode",e),Kn(De)}}function la(e){return Number.isFinite(e)?Math.min($o,Math.max(Bo,e)):jn}function Yn(e){return kn=la(e),kn}function ca(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(To,String(e))}catch(t){console.warn("[Blockscape] failed to persist series double-click wait",t)}}function da(){if(typeof window>"u"||!window.localStorage)return Yn(jn);try{const e=window.localStorage.getItem(To);if(!e)return Yn(jn);const t=parseInt(e,10);return Yn(t)}catch(e){return console.warn("[Blockscape] failed to read series double-click wait",e),Yn(jn)}}function ua(e){return e===Pn?Pn:on}function Xn(e){return pi=ua(e),pi}function pa(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Tt,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian link mode",t)}}function fa(){if(typeof window>"u"||!window.localStorage)return Xn(ui);try{const e=window.localStorage.getItem(Tt);return Xn(e||ui)}catch(e){return console.warn("[Blockscape] failed to read Obsidian link mode",e),Xn(ui)}}function Zn(e){return Hn=!!e,Hn}function ma(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Kt,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist Obsidian toggle",t)}}function ha(){if(typeof window>"u"||!window.localStorage)return Zn(!1);try{const e=window.localStorage.getItem(Kt);return e==null?Zn(!1):Zn(e==="1")}catch(e){return console.warn("[Blockscape] failed to read Obsidian toggle",e),Zn(!1)}}function Qn(e){return Fn=(e??"").toString().trim(),Fn}function ga(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(pn,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian vault",t)}}function ba(){if(typeof window>"u"||!window.localStorage)return Qn("");try{const e=window.localStorage.getItem(pn);return Qn(e||"")}catch(e){return console.warn("[Blockscape] failed to read Obsidian vault",e),Qn("")}}function va(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function wa(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(r=>r&&typeof r=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function fi(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t,e.data&&typeof e.data=="object"&&(e.data.seriesId=t),Array.isArray(e.apicurioVersions)&&e.apicurioVersions.forEach(n=>{n!=null&&n.data&&typeof n.data=="object"&&(n.data.seriesId=t)}))}function ya(e){if(!e||typeof window>"u"||typeof window.prompt!="function")return!1;const t=(e.title??e.apicurioArtifactName??"").toString().trim()||Bi(e,"Series"),n=window.prompt("Series name",t);if(n==null)return!1;const i=n.trim();if(!i)return!1;const o=$n(e,{seriesName:i,fallbackTitle:i})||dn(i,i),r=window.prompt("Series ID (used for linking and downloads)",o);if(r==null)return!1;const a=dn(r.trim()||i,i||"series");return e.title=i,e.apicurioArtifactName=i,fi(e,a),!0}function Ti(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>Ti(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${Ti(e[i])}`).join(",")}}`}function Mo(e){try{return Ti(e)}catch{return""}}function mi(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=Mo(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=Mo(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const Ea=[{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Move up/down through items, pausing on category headers before entering the next category at the same relative position."},{keys:[["Cmd/Ctrl","Arrow Up"],["Cmd/Ctrl","Arrow Down"]],description:"Reorder the selected category (or the category that holds the selected item)."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Cmd/Ctrl","Arrow Left"],["Cmd/Ctrl","Arrow Right"]],description:"Switch to the previous or next map when viewing a series."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile or category."},{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["F2"]],description:"Edit the selected item; when a category (not an item) is selected, open the category editor."},{keys:[["Delete"]],description:"Delete the selected item or category (use Cmd/Ctrl+Z to undo)."},{keys:[["Insert"]],description:"Add a new category at the bottom of the map."},{keys:[["Escape"]],description:"Unselect item or close the open preview popover."}];function mn(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const r=n||e.title||t||"model",a=Jn(r).replace(/\./g,"-");e.id=a||`model-${fn()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function _a(e){return JSON.parse(JSON.stringify(e))}function Ve(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function Bi(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const o=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(o)return o;const r=nt(e);return r?`${r} series`:t}return Ve(e,t)}function nt(e){var o;const t=$n(e);if(t)return t;const n=(o=e==null?void 0:e.data)==null?void 0:o.id;return n&&n.toString().trim()||null}function ka(e){if(!(e!=null&&e.sourcePath))return null;try{const t=e.sourcePath.split("/").filter(Boolean);return t.length?t[t.length-1]:e.sourcePath}catch{return e.sourcePath}}function Po(e){var d;if(e<0||e>=C.length||!s)return!0;const t=C[e],n=(s.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}mn(i,{titleHint:Ve(t),idHint:nt(t)});const o=mi(t.data),r=mi(i);if(o===r)return!0;t.data=i;const a=vn(t);return a>=0&&((d=t.apicurioVersions)!=null&&d[a])&&(t.apicurioVersions[a].data=i),!0}function Ro(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function Vo(e){if(b<0||!e)return null;const t=C[b].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const r=(i.items||[]).find(a=>a.id===e);if(r)return{category:i,item:r,modelData:t}}return null}function Sa(e,t){const n=Ro(t);let i=Jn(e||"item");if(!n.has(i))return i;const o=()=>fn().slice(0,4);for(;n.has(i);)i=`${Jn(e||"item")}-${o()}`;return i}function Ca(e="category",t){const n=(t==null?void 0:t.categories)||[],i=Jn(e||"category"),o=d=>n.some(p=>p.id===d);let r=i||`category-${fn()}`;if(!o(r))return r;let a=n.length+1;for(;o(`${i}-${a}`);)a+=1;return`${i}-${a}`}const hn=fl({findItemAndCategoryById:Vo,collectAllItemIds:Ro,updateItemReferences:pl,loadActiveIntoEditor:vt,rebuildFromActive:mt,select:e=>wt(e),onSelectionRenamed:(e,t)=>{var n;M===e&&(M=t,pt()),((n=Ke==null?void 0:Ke.item)==null?void 0:n.id)===e&&(Ke.item.id=t)}});function Ia({getActiveModelData:e,loadActiveIntoEditor:t,rebuildFromActive:n,selectCategory:i,onCategoryRenamed:o}){const r={wrapper:null,fields:{},categoryId:null,modelData:null},a=L=>{if(r.fields.errorEl){if(!L){r.fields.errorEl.hidden=!0,r.fields.errorEl.textContent="";return}r.fields.errorEl.hidden=!1,r.fields.errorEl.textContent=L}},d=()=>{r.wrapper&&(r.wrapper.hidden=!0,r.wrapper.setAttribute("aria-hidden","true"),a(""),r.categoryId=null,r.modelData=null,document.body.classList.remove("category-editor-open"))},p=()=>{r.wrapper&&(r.wrapper.hidden=!1,r.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("category-editor-open"),requestAnimationFrame(()=>{var L,j;(L=r.fields.titleInput)==null||L.focus(),(j=r.fields.titleInput)==null||j.select()}))},h=()=>{if(!r.modelData||!r.categoryId)throw new Error("No category loaded.");const L=r.modelData.categories||[],j=L.find(Ne=>Ne.id===r.categoryId);if(!j)throw new Error("Category not found.");const re=(r.fields.idInput.value||"").trim();if(!re)throw new Error("ID is required.");const Ae=(r.fields.titleInput.value||"").trim();if(L.some(Ne=>Ne.id===re&&Ne.id!==j.id))throw new Error("Another category already uses that ID.");const Le=j.id;return j.id=re,j.title=Ae||j.id,Le!==re&&typeof o=="function"&&o(Le,re),t(),n(),i(re,{scrollIntoView:!0}),!0},v=()=>{try{return h(),d(),!0}catch(L){return console.warn("[CategoryEditor] save failed",L),a((L==null?void 0:L.message)||"Unable to save category."),!1}},N=()=>{if(r.wrapper)return r.wrapper;const L=document.createElement("div");L.className="item-editor-modal category-editor-modal",L.hidden=!0,L.setAttribute("role","dialog"),L.setAttribute("aria-modal","true");const j=document.createElement("div");j.className="item-editor-modal__backdrop",L.appendChild(j);const re=document.createElement("div");re.className="item-editor",L.appendChild(re);const Ae=document.createElement("div");Ae.className="item-editor__header";const Se=document.createElement("h2");Se.className="item-editor__title",Se.textContent="Edit category";const Le=document.createElement("button");Le.type="button",Le.className="item-editor__close",Le.setAttribute("aria-label","Close category editor"),Le.textContent="×",Ae.appendChild(Se),Ae.appendChild(Le),re.appendChild(Ae);const Ne=document.createElement("form");Ne.className="item-editor__form",re.appendChild(Ne);const kt=document.createElement("div");kt.className="item-editor__meta",kt.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',Ne.appendChild(kt);const B=document.createElement("div");B.className="item-editor__error",B.hidden=!0,Ne.appendChild(B);const P=(ht,qe,sn)=>{const Dt=document.createElement("label");Dt.className="item-editor__field";const wn=document.createElement("span");if(wn.className="item-editor__label",wn.textContent=ht,Dt.appendChild(wn),qe.classList.add("item-editor__control"),Dt.appendChild(qe),sn){const ri=document.createElement("div");ri.className="item-editor__hint",ri.textContent=sn,Dt.appendChild(ri)}return Dt},Q=document.createElement("input");Q.type="text",Ne.appendChild(P("Title",Q,"Display label shown in the map."));const ge=document.createElement("input");ge.type="text",ge.required=!0,Ne.appendChild(P("ID",ge,"Unique identifier for this category (used in URLs and references)."));const Ye=document.createElement("div");Ye.className="item-editor__actions";const lt=document.createElement("button");lt.type="submit",lt.className="item-editor__action item-editor__action--primary",lt.textContent="Save";const it=document.createElement("button");return it.type="button",it.className="item-editor__action",it.textContent="Cancel",Ye.appendChild(lt),Ye.appendChild(it),Ne.appendChild(Ye),Ne.addEventListener("submit",ht=>{ht.preventDefault(),v()}),it.addEventListener("click",d),Le.addEventListener("click",d),j.addEventListener("click",d),L.addEventListener("keydown",ht=>{ht.key==="Escape"&&(ht.preventDefault(),d())}),document.body.appendChild(L),r.wrapper=L,r.fields={titleInput:Q,idInput:ge,errorEl:B,metaLabel:kt.querySelector(".item-editor__meta-value")},L};return{open:L=>{if(!L||!N())return!1;const re=e(),Se=((re==null?void 0:re.categories)||[]).find(Le=>Le.id===L);return Se?(r.categoryId=Se.id,r.modelData=re,r.fields.metaLabel.textContent=Se.title||Se.id||"Category",r.fields.titleInput.value=Se.title||Se.id||"",r.fields.idInput.value=Se.id||"",a(""),p(),!0):!1},hide:d,isOpen:()=>!!r.wrapper&&r.wrapper.hidden===!1}}const xa=Ia({getActiveModelData:()=>{var e;return(e=C[b])==null?void 0:e.data},loadActiveIntoEditor:vt,rebuildFromActive:mt,selectCategory:(e,t={})=>Yt(e,t),onCategoryRenamed:(e,t)=>{Ee===e&&(Ee=t,pt())}});function hi(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const i={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[i],e.apicurioActiveVersionIndex=0;const o=e.title||Ve(e);return St(e,{seriesName:o,fallbackTitle:o}),e.isSeries=!0,e}function Qt(e,{versionLabel:t,createdOn:n}={}){var p,h,v;if(e!=null&&e.isSeries||((p=e==null?void 0:e.apicurioVersions)==null?void 0:p.length)>1){const N=e.title||Ve(e);St(e,{seriesName:N,fallbackTitle:N})}const i=nt(e);if(!i)return hi(e,{versionLabel:t||"1",createdOn:n}),C.push(e),C.length-1;const o=C.findIndex(N=>nt(N)===i);if(o===-1)return hi(e,{versionLabel:t||"1",createdOn:n}),C.push(e),C.length-1;const r=C[o];if(!Array.isArray(r.apicurioVersions)||!r.apicurioVersions.length){r.apicurioVersions=[{version:"1",data:r.data,createdOn:(v=(h=r.apicurioVersions)==null?void 0:h[0])==null?void 0:v.createdOn}],r.apicurioActiveVersionIndex=0;const N=r.title||Ve(r);St(r,{seriesName:N,fallbackTitle:N})}const a=String(r.apicurioVersions.length+1);r.apicurioVersions.push({version:a,data:e.data,createdOn:n||new Date().toISOString()}),r.apicurioActiveVersionIndex=r.apicurioVersions.length-1,r.data=e.data,r.title=Ve(e)||r.title,r.isSeries=!0;const d=r.title||Ve(r);return St(r,{seriesName:d,fallbackTitle:d}),o}function Uo({versionLabel:e}={}){var a;if(b<0||!C[b])throw new Error("Load or select a model before creating a version.");const t=C[b];hi(t,{versionLabel:"1"});let n;try{n=_a(t.data)}catch(d){throw console.warn("[Blockscape] failed to clone active model for versioning",d),new Error("Could not copy the current model.")}mn(n,{titleHint:Ve(t),idHint:nt(t)||$n(t)});const o={version:e||String((((a=t.apicurioVersions)==null?void 0:a.length)||0)+1),data:n,createdOn:new Date().toISOString()};t.apicurioVersions.push(o),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=n,t.isSeries=!0;const r=t.title||Ve(t);return St(t,{seriesName:r,fallbackTitle:r}),b}function $i(){const e=b>=0&&C[b]?C[b]:null,t=nt(e);document.title=t?`${t}-blockscape`:Qe}function Oi(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||Ve(e);return St(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function Aa(){const e=C[b],t=Oi(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function Do(e="shortcut",t=!1){const n=s.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=C[b],o=t?Oi(i):null,r=!!o,a=r?JSON.stringify(o,null,2):n,d=$n(i),p=nt(i),h=d||p||Ve(i,"blockscape"),v=r?"-series":"",N=`${Jn(h)}${v}.bs`;return jr(N,a),console.log(`[Blockscape] saved JSON (${e}):`,N),!0}const La={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function Ho(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return La[n]||"#9ca3af"}function Na(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(p=>p+p).join(""):t,i=parseInt(n,16),o=i>>16&255,r=i>>8&255,a=i&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(r/255,2.2)+.0722*Math.pow(a/255,2.2)>.35?"#111111":"#ffffff"}function Ta(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function Fo(){if(dt)return;dt=document.createElement("div"),dt.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",Xe=document.createElement("span"),Xe.className="series-nav-notice__text",dt.appendChild(e),dt.appendChild(Xe),document.body.appendChild(dt)}function jo(){Pt&&(clearTimeout(Pt),Pt=null),dt&&dt.classList.remove("is-visible"),Xe&&(Xe.textContent="")}function Sn(){Mt=null,bt&&(clearTimeout(bt),bt=null),jo()}function Ba(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function $a(e,t,n){Fo(),Mt={id:e,targetVersionIndex:t},bt&&clearTimeout(bt),bt=setTimeout(()=>{bt=null,Sn()},kn);const i=Ba(n,t);Mi(`Click again to open ${i} in this series.`,kn)}function Mi(e,t=Zt,n=null){if(Fo(),Xe.textContent="",Xe.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener",o.textContent=n,Xe.appendChild(i),Xe.appendChild(o)}dt.classList.add("is-visible"),Pt&&clearTimeout(Pt),Pt=setTimeout(()=>jo(),t)}function Oa(){we&&(we.innerHTML="",Ea.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((o,r)=>{if(r>0){const d=document.createElement("span");d.className="shortcut-help__or",d.textContent="or",n.appendChild(d)}const a=document.createElement("div");a.className="shortcut-help__combo",o.forEach((d,p)=>{if(p>0){const v=document.createElement("span");v.className="shortcut-help__sep",v.textContent="+",a.appendChild(v)}const h=document.createElement("kbd");h.className="shortcut-help__key",h.textContent=d,a.appendChild(h)}),n.appendChild(a)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),we.appendChild(t)}),xt=!0)}function Ma(){return!!ae&&ae.hidden===!1}function Pa(){if(!ae)return;xt||Oa(),un=document.activeElement,ae.hidden=!1,ae.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=ae.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Pi(){if(!ae||ae.hidden)return;ae.hidden=!0,ae.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=un;e!=null&&e.focus?e.focus({preventScroll:!0}):O!=null&&O.focus&&O.focus({preventScroll:!0})}function Ra(){if(!ne)return;ne.hidden=!1,ne.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=ne.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Ri(){!ne||ne.hidden||(ne.hidden=!0,ne.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),pe!=null&&pe.focus&&pe.focus({preventScroll:!0}))}let Vi=!1;function ei(){Vi||(Vi=!0,requestAnimationFrame(()=>{Vi=!1,Hi(),xn()}))}let Jo=!1;function Wo(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Va(e){const t=Wo(e);if(!t.length){f.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}f.querySelectorAll(".tile").forEach(n=>{var a;const i=(((a=n.querySelector(".name"))==null?void 0:a.textContent)||"").toLowerCase(),o=(n.dataset.id||"").toLowerCase(),r=t.every(d=>i.includes(d)||o.includes(d));n.style.opacity=r?"1":"0.2"})}function Ua(e){const t=Wo(e);if(!t.length)return[];const n=[];return C.forEach((i,o)=>{var h;const r=Bi(i),a=nt(i)||"",d=`${r} ${a}`.toLowerCase();t.every(v=>d.includes(v))&&n.push({type:"model",modelIndex:o,modelTitle:r,modelId:a}),(Array.isArray((h=i.data)==null?void 0:h.categories)?i.data.categories:[]).forEach(v=>{const N=(v.title||v.id||"").toString();(v.items||[]).forEach(I=>{const L=(I.name||I.id||"").toString(),j=`${L} ${I.id||""} ${N}`.toLowerCase();t.every(re=>j.includes(re))&&n.push({type:"item",modelIndex:o,modelTitle:r,modelId:a,itemId:I.id,itemName:L,categoryTitle:N})})})}),n.slice(0,_)}function qo(e){if(!V)return;V.innerHTML="";const t=(e||"").toString();if(!t.trim()){V.hidden=!0;return}if(!C.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",V.appendChild(i),V.hidden=!1;return}const n=Ua(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",V.appendChild(i),V.hidden=!1;return}n.forEach(i=>{const o=document.createElement("button");o.type="button",o.className="search-result",o.dataset.modelIndex=String(i.modelIndex),i.itemId&&(o.dataset.itemId=i.itemId),i.type&&(o.dataset.type=i.type),i.modelIndex===b&&(!i.itemId||M===i.itemId)&&o.classList.add("is-active");const r=document.createElement("div");r.className="search-result__primary";const a=document.createElement("span");a.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",r.appendChild(a);const d=document.createElement("span");d.className="search-result__badge",d.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",r.appendChild(d);const p=document.createElement("div");p.className="search-result__meta";const h=document.createElement("span");if(h.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,p.appendChild(h),i.type==="item"&&i.itemId){const v=document.createElement("span");v.textContent=`Item ID: ${i.itemId}`,p.appendChild(v)}else if(i.type==="model"){const v=document.createElement("span");v.textContent="Matches model title",p.appendChild(v)}o.appendChild(r),o.appendChild(p),V.appendChild(o)}),V.hidden=!1}function Go(e){Va(e||""),qo(e||"")}function Da(e){!e||!Number.isInteger(e.modelIndex)||(ft(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(b!==e.modelIndex)return;const t=(n=se.get(e.itemId))==null?void 0:n.el;t&&(wt(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function ft(e){if(Bt(),Sn(),Ke=null,Ot=null,Ee=null,Oe=null,e<0||e>=C.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}nn=!0,b=e,console.log("[Blockscape] active model:",Ve(C[e]),"(index",e+" )"),$i(),gn(),vt(),mt(),ke&&Go(ke.value||""),u.updateActiveSavePlaceholder(),Re.updateAvailability()}function gn(){if(F.innerHTML="",!C.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",F.appendChild(e);return}C.forEach((e,t)=>{var N;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===b?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===b?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const r=document.createElement("span");r.className="model-nav-title",r.textContent=Bi(e),o.appendChild(r);const a=ka(e)||nt(e);if(a){const I=document.createElement("span");I.className="model-nav-id",I.textContent=a,o.appendChild(I)}const d=Array.isArray((N=e.data)==null?void 0:N.categories)?e.data.categories:[],p=d.reduce((I,L)=>I+(L.items||[]).length,0),h=document.createElement("span");h.className="model-nav-meta";const v=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} maps`:"";h.textContent=`${d.length} cat · ${p} items${v}`,i.appendChild(o),i.appendChild(h),n.appendChild(i),F.appendChild(n)}),Re.updateAvailability()}function vt(){if(b<0){s.value="",Z&&(Z.disabled=!0);return}const e=C[b];s.value=JSON.stringify(e.data,null,2),Z&&(Z.disabled=!Oi(e))}function Ha(e){try{return JSON.parse(e)}catch{return null}}function Fa(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const o=i.map((v,N)=>!v||typeof v!="object"?null:(mn(v,{titleHint:`${t} #${N+1}`}),{obj:v,idx:N})).filter(Boolean);if(!o.length)return[];const r=o[0].obj,{seriesTitleOverride:a}=n;let d=a||r.title||`${t} series`;a&&!r.title&&(r.title=a);const p={id:fn(),title:d,data:r,apicurioVersions:o.map(({obj:v,idx:N})=>({version:String(N+1),data:v})),apicurioActiveVersionIndex:0,isSeries:!0},h=St(p,{seriesName:d,fallbackTitle:d});return h&&(p.id=h),[p]}function zo(e,t="Pasted",n={}){return Array.isArray(e)?Fa(e,t,n):!e||typeof e!="object"?[]:(mn(e,{titleHint:`${t} #1`}),[{id:fn(),title:e.title||`${t} #1`,data:e}])}function rn(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const o=Ha(i);if(o){let a=n;if(Array.isArray(o)&&n.promptForSeriesName){const p=wa(o,t),h=va(p);a={...n,promptForSeriesName:!1,seriesTitleOverride:h||p}}const d=zo(o,t,a);if(d.length)return d}return i.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,d)=>{const p=JSON.parse(a);return mn(p,{titleHint:`${t} #${d+1}`}),{id:fn(),title:p.title||`${t} #${d+1}`,data:p}})}function ja(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function bn(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!ja(e)}function Ja(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function Ko(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(ze)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(ze)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(ze)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=rn(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let i=null;return n.forEach(o=>{const r=Qt(o,{versionLabel:"editor"});i==null&&(i=r)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function Yo(e="storage"){const t=Ko();return!t||typeof t.index!="number"?!1:(ft(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function Wa(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let i;try{const a=Fr(t);i=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=zo(i.data,i.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let r=null;return o.forEach(a=>{const d=a.isSeries?i.title||a.title:null,p=Qt({...a,apicurioArtifactName:d||a.apicurioArtifactName},{versionLabel:"shared"});r==null&&(r=p)}),r}async function qa(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await Ji(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function Ga(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(r=>(r.items||[]).forEach(a=>{i.add(a.id);const d=new Set(a.deps||[]);(e.links||[]).forEach(p=>{p.from===a.id&&d.add(p.to)}),t.set(a.id,d),d.forEach(p=>{n.has(p)||n.set(p,new Set),n.get(p).add(a.id)})}));const o=new Set;return n.forEach((r,a)=>{((r==null?void 0:r.size)||0)>=2&&o.add(a)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:i}}function za(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const o=n.getContext("2d"),r=(e||"?").charAt(0).toUpperCase(),a=Ho(e,t),d=Na(a);return o.fillStyle=a,o.beginPath(),o.arc(i/2,i/2,i/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=d,o.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(r,i/2,i/2),n.toDataURL("image/png")}function vn(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Xo(e){const t=vn(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Ka(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var a,d;const o=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();o&&t.set(o,i);const r=(((d=n==null?void 0:n.data)==null?void 0:d.seriesId)??"").toString().trim();r&&!t.has(r)&&t.set(r,i)}),t}const Zo=new WeakMap;function Ya(e,t){var Se;if(!((Se=e==null?void 0:e.apicurioVersions)!=null&&Se[t]))return null;const n=e.apicurioVersions[t],i=n.data,o=mi(i),r=Zo.get(n);if(r&&r.fingerprint===o)return r.dataUrl;const a=160,d=90,p=document.createElement("canvas");p.width=a,p.height=d;const h=p.getContext("2d");h.fillStyle="#f8fafc",h.fillRect(0,0,a,d),h.strokeStyle="#e5e7eb",h.strokeRect(.5,.5,a-1,d-1);const v=Array.isArray(i==null?void 0:i.categories)?i.categories:[],N=Math.max(v.length,1),I=a/N,L=8,j=8,re=4;v.forEach((Le,Ne)=>{const kt=Ne*I+I/2,B=Array.isArray(Le.items)?Le.items:[],P=Math.max(B.length,1);B.forEach((Q,ge)=>{const Ye=L+(ge+.5)*((d-L-j)/P);h.beginPath(),h.arc(kt,Ye,re,0,Math.PI*2);const lt=Ho(Q.name||Q.id||"",Q.color);h.fillStyle=lt,h.strokeStyle="rgba(15,23,42,0.25)",h.fill(),h.stroke()})});const Ae=p.toDataURL("image/png");return Zo.set(n,{fingerprint:o,dataUrl:Ae}),Ae}function Ui(e,t){var d;if(Sn(),e<0||e>=C.length)return!1;const n=C[e];if(!((d=n==null?void 0:n.apicurioVersions)!=null&&d.length)||!Po(e))return!1;const o=n.apicurioVersions.length,r=(t%o+o)%o,a=n.apicurioVersions[r];return a!=null&&a.data?(n.apicurioActiveVersionIndex=r,n.data=a.data,nn=!0,M=null,$e=null,pt(),vt(),mt(),!0):!1}function Di(e){var i;if(!e||b<0)return!1;const t=C[b];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return!1;const n=vn(t);return n===-1?!1:Ui(b,n+e)}function Xa(e,t){if(Sn(),e<0||e>=C.length)return!1;const n=C[e];if(!Array.isArray(n==null?void 0:n.apicurioVersions)||n.apicurioVersions.length<=1)return alert("A series needs at least one map. Add another before removing this one."),!1;if(!Po(e))return!1;const i=Math.min(Math.max(t,0),n.apicurioVersions.length-1),o=vn(n),[r]=n.apicurioVersions.splice(i,1);if(!r)return!1;let a=o;i===o?a=Math.min(i,n.apicurioVersions.length-1):i<o&&(a=Math.max(0,o-1)),n.apicurioActiveVersionIndex=Math.max(0,a);const d=n.apicurioVersions[n.apicurioActiveVersionIndex];return n.data=(d==null?void 0:d.data)||n.data,n.isSeries=n.apicurioVersions.length>1,ft(e),!0}function Za(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||nt(e)||"Artifact",n.title="Double-click to rename this series",n.setAttribute("role","button"),n.tabIndex=0,n.addEventListener("dblclick",()=>{var j;const I=C[b];!((j=I==null?void 0:I.apicurioVersions)!=null&&j.length)||!ya(I)||(gn(),vt(),mt())}),t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const o=vn(e),r=Xo(e)||"latest";i.textContent=`No. in series ${r} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const a=document.createElement("div");a.className="version-nav__controls";const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Previous",d.addEventListener("click",()=>Di(-1));const p=document.createElement("button");p.type="button",p.className="version-nav__button",p.textContent="Next",p.addEventListener("click",()=>Di(1)),a.appendChild(d),a.appendChild(p),t.appendChild(a);const h=document.createElement("div");h.className="version-nav__thumbs",e.apicurioVersions.forEach((I,L)=>{var kt;const j=document.createElement("button");j.type="button",j.className="version-nav__thumb",L===o&&j.classList.add("is-active");const re=Ya(e,L);if(re){const B=document.createElement("img");B.src=re,B.alt=`Version ${L+1}`,j.appendChild(B)}const Ae=document.createElement("div");Ae.className="version-nav__thumb-label";const Se=document.createElement("span");Se.className="version-nav__thumb-label-text";const Le=(((kt=I==null?void 0:I.data)==null?void 0:kt.id)??(I==null?void 0:I.id)??"").toString().trim(),Ne=Le||(I!=null&&I.version?`v${I.version}`:`${L+1}`);if(Se.textContent=Ne,Ae.title=Le||Ne,Ae.appendChild(Se),j.appendChild(Ae),as(Ae,Se),e.apicurioVersions.length>1){const B=document.createElement("span");B.className="version-nav__thumb-remove",B.title=`Remove ${Ne} from this series`,B.setAttribute("aria-label",`Remove ${Ne} from this series`),B.setAttribute("role","button"),B.tabIndex=-1,B.textContent="×",B.addEventListener("click",P=>{P.stopPropagation(),P.preventDefault(),window.confirm(`Remove ${Ne} from this series?`)&&Xa(b,L)}),j.appendChild(B)}j.addEventListener("click",()=>Ui(b,L)),ls(j,I),h.appendChild(j)});const v=document.createElement("button");v.type="button",v.className="version-nav__thumb version-nav__thumb--add",v.title="Create a new version from this map",v.addEventListener("click",()=>{try{const I=Uo({versionLabel:"manual"});ft(I)}catch(I){alert((I==null?void 0:I.message)||"Unable to create a new version right now.")}});const N=document.createElement("span");return N.className="version-nav__thumb-add-icon",N.textContent="+",v.appendChild(N),h.appendChild(v),t.appendChild(h),t}function Cn(){var yr,Er,_r;if(!R)return;en(),Array.isArray(R.m.categories)||(R.m.categories=[]),console.log("[Blockscape] rendering categories=",R.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!R.m.abstract,"- value:",R.m.abstract?R.m.abstract.substring(0,50)+"...":"none"),f.innerHTML="",se.clear(),Be.clear(),ut=[],hi(C[b],{versionLabel:"1"});const e=Za(C[b]);e&&f.appendChild(e),x.setAttribute("width",window.innerWidth),x.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=R.m.title&&R.m.title.trim()||Ve(C[b]),t.appendChild(n),((yr=C[b])!=null&&yr.isSeries||(_r=(Er=C[b])==null?void 0:Er.apicurioVersions)!=null&&_r.length)&&St(C[b],{seriesName:C[b].title||R.m.title||Ve(C[b])});const i=Xo(C[b]),o=$n(C[b]),r=(R.m.id??"").toString().trim(),a=document.createElement("div");a.className="blockscape-model-meta__details";const d=(w,ee)=>{if(!ee)return;const J=document.createElement("div");J.className="blockscape-model-id";const Ce=document.createElement("span");Ce.className="blockscape-model-id__label",Ce.textContent=w;const et=document.createElement("span");et.className="blockscape-model-id__value",et.textContent=ee,J.append(Ce,et),a.appendChild(J)};d("Series ID",o),d("Model ID",r),d("No. in series",i),a.childElementCount&&t.appendChild(a),f.appendChild(t);const p=document.createElement("div");p.className="blockscape-tabs";const h=document.createElement("div");h.className="blockscape-tablist",h.setAttribute("role","tablist"),p.appendChild(h);const v=document.createElement("div");v.className="blockscape-tabpanels",p.appendChild(v);const N=document.createElement("div"),I=document.createElement("div"),L=document.createElement("div"),j=document.createElement("div");let re="";const Ae=Ka(C[b]),Se=vn(C[b]);yt=null,At="";const Le=[{id:"map",label:"Map",panel:N},{id:"abstract",label:"Info",panel:I},{id:"source",label:"Settings",panel:L},{id:"apicurio",label:"Apicurio",panel:j}],Ne=typeof Re.isEnabled=="function"?Re.isEnabled():!1,kt=w=>{if(!x)return;const ee=w==="map";x.hidden=!ee,ee?(Hi(),xn()):x.innerHTML=""};Le.forEach((w,ee)=>{const J=document.createElement("button");J.type="button",J.id=`tab-${w.id}`,J.className="blockscape-tab"+(ee===0?" is-active":""),J.setAttribute("role","tab"),J.setAttribute("aria-controls",`panel-${w.id}`),J.setAttribute("aria-selected",ee===0?"true":"false"),J.textContent=w.label,w.id==="apicurio"&&!Ne&&(J.hidden=!0,J.tabIndex=-1,J.setAttribute("aria-hidden","true"),J.style.display="none"),w.button=J,h.appendChild(J),w.panel.id=`panel-${w.id}`,w.panel.classList.add("blockscape-tabpanel"),w.panel.setAttribute("role","tabpanel"),w.panel.setAttribute("aria-labelledby",J.id),w.panel.hidden=ee!==0,ee===0&&w.panel.classList.add("is-active"),v.appendChild(w.panel)});const B=w=>{It=w,Le.forEach(ee=>{const J=ee.id===w;ee.button.classList.toggle("is-active",J),ee.button.setAttribute("aria-selected",J?"true":"false"),ee.panel.classList.toggle("is-active",J),ee.panel.hidden=!J}),kt(w)},P=Le.find(w=>w.id==="apicurio"),Q=w=>{if(!P||!P.button||!P.panel)return;const ee=!!w;if(P.button.hidden=!ee,P.button.tabIndex=ee?0:-1,P.button.setAttribute("aria-hidden",ee?"false":"true"),P.button.style.display=ee?"":"none",ee){const J=It==="apicurio";P.button.classList.toggle("is-active",J),P.button.setAttribute("aria-selected",J?"true":"false"),P.panel.classList.toggle("is-active",J),P.panel.hidden=!J}else{const J=P.panel.classList.contains("is-active");if(P.button.classList.remove("is-active"),P.button.setAttribute("aria-selected","false"),P.panel.classList.remove("is-active"),P.panel.hidden=!0,J){const Ce=Le.find(et=>et.id!=="apicurio");Ce&&B(Ce.id)}}Vt&&(Vt.checked=ee)};Le.forEach(w=>{w.button.addEventListener("click",()=>{en(),B(w.id)}),w.id==="abstract"&&(yt=w.button,w.button.addEventListener("mouseenter",()=>ii(w.button,re,{offset:12})),w.button.addEventListener("mouseleave",en),w.button.addEventListener("focus",()=>ii(w.button,re,{offset:12})),w.button.addEventListener("blur",en))});const Ye=(w=>{const ee=Le.find(Ce=>Ce.id===It);if(ee&&(ee.id!=="apicurio"||w))return ee.id;const J=Le.find(Ce=>Ce.id!=="apicurio"||w);return(J==null?void 0:J.id)||Le[0].id})(Ne);B(Ye),Q(Ne),typeof Re.onEnabledChange=="function"&&Re.onEnabledChange(Q),f.appendChild(p);const lt=document.createElement("div");lt.className="blockscape-render",N.appendChild(lt);const it=document.createElement("div");if(it.className="blockscape-abstract-panel",R.m.abstract){console.log("[Blockscape] Rendering abstract content");const w=document.createElement("div");w.className="blockscape-abstract",w.innerHTML=R.m.abstract,Ms(w),it.appendChild(w),re=w.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const w=document.createElement("div");w.className="blockscape-abstract-placeholder",w.textContent="No abstract has been provided for this model.",it.appendChild(w),re=w.outerHTML}At=re,I.appendChild(it);const ht=document.createElement("div");ht.className="blockscape-source-panel";const qe=document.createElement("div");qe.className="blockscape-settings-panel";const sn=document.createElement("p");sn.className="blockscape-settings-panel__title",sn.textContent="Feature toggles",qe.appendChild(sn);const Dt=({id:w,label:ee,hint:J,checked:Ce,className:et="",onChange:Te})=>{const qt=document.createElement("label");qt.className=["settings-toggle",et].filter(Boolean).join(" ");const Gt=document.createElement("input");Gt.type="checkbox",Gt.id=w,Gt.checked=Ce;const He=document.createElement("span");He.className="settings-toggle__text";const zt=document.createElement("span");if(zt.className="settings-toggle__label",zt.textContent=ee,He.appendChild(zt),J){const yn=document.createElement("span");yn.className="settings-toggle__hint",yn.textContent=J,He.appendChild(yn)}return qt.appendChild(Gt),qt.appendChild(He),typeof Te=="function"&&Gt.addEventListener("change",()=>Te(Gt.checked)),{row:qt,input:Gt}},wn=()=>{f.querySelectorAll(".tile").forEach(w=>{const ee=w.dataset.id,J=Vo(ee);if(!(J!=null&&J.item))return;const Ce=ir(J.item.external),et=nr(J.item,{externalMeta:Ce,seriesIdLookup:Ae});or(w,et)})},{row:ri}=Dt({id:"toggleSecondaryLinks",label:"Show indirect links",checked:Xt,className:"map-controls__toggle",onChange:w=>{Xt=w,M?wt(M):(ji(),xn())}});qe.appendChild(ri);const{row:Us}=Dt({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:gt,className:"map-controls__toggle",onChange:w=>{gt=w,er()}});qe.appendChild(Us);const pr=[],{row:Ds}=Dt({id:"toggleObsidianLinks",label:"Obsidian",hint:"Make tiles open Obsidian when no external URL exists.",checked:Hn,className:"map-controls__toggle",onChange:w=>{const ee=Zn(w);ma(ee),pr.forEach(J=>{J.disabled=!ee}),wn()}});qe.appendChild(Ds);const Wi=document.createElement("div");Wi.className="settings-radio";const qi=document.createElement("div");qi.className="settings-radio__label",qi.textContent="Obsidian link format";const Gi=document.createElement("div");Gi.className="settings-radio__hint",Gi.textContent="Use the tile title or id when building Obsidian links.";const zi=document.createElement("div");zi.className="settings-radio__options";const fr=(w,ee)=>{const J=document.createElement("label");J.className="settings-radio__option";const Ce=document.createElement("input");Ce.type="radio",Ce.name="obsidianLinkMode",Ce.value=w,Ce.checked=pi===w,Ce.disabled=!Hn,Ce.addEventListener("change",()=>{if(!Ce.checked)return;const Te=Xn(w);pa(Te),wn()});const et=document.createElement("span");et.textContent=ee,J.append(Ce,et),pr.push(Ce),zi.appendChild(J)};fr(on,"Use title"),fr(Pn,"Use id"),Wi.append(qi,zi,Gi),qe.appendChild(Wi);const bi=document.createElement("label");bi.className="settings-text",bi.setAttribute("for","obsidianVaultInput");const Ki=document.createElement("div");Ki.className="settings-text__text";const Yi=document.createElement("span");Yi.className="settings-text__label",Yi.textContent="Obsidian vault";const Xi=document.createElement("span");Xi.className="settings-text__hint",Xi.textContent="Optional. Set the vault name to avoid duplicates.",Ki.append(Yi,Xi);const ln=document.createElement("input");ln.type="text",ln.id="obsidianVaultInput",ln.className="settings-text__input",ln.placeholder="Vault name",ln.value=Fn,ln.addEventListener("input",()=>{const w=Qn(ln.value);ga(w),wn()}),bi.append(Ki,ln),qe.appendChild(bi);const Zi=document.createElement("p");Zi.className="settings-note",Zi.innerHTML='Requires the Obsidian <a href="https://vinzent03.github.io/obsidian-advanced-uri/" target="_blank" rel="noreferrer noopener">Advanced URI</a> plugin for create/open behavior.',qe.appendChild(Zi);const mr=w=>`${(w/1e3).toFixed(1)}s`,vi=document.createElement("label");vi.className="settings-slider",vi.setAttribute("for","seriesNavDoubleClickWait");const Qi=document.createElement("div");Qi.className="settings-slider__text";const eo=document.createElement("span");eo.className="settings-slider__label",eo.textContent="Series double-click wait";const to=document.createElement("span");to.className="settings-slider__hint",to.textContent="Time window to double-click into another map version.",Qi.append(eo,to);const wi=document.createElement("span");wi.className="settings-slider__value",wi.textContent=mr(kn);const Ht=document.createElement("input");Ht.type="range",Ht.id="seriesNavDoubleClickWait",Ht.className="settings-slider__input",Ht.min=String(Bo),Ht.max=String($o),Ht.step="50",Ht.value=String(kn),Ht.setAttribute("aria-label","Adjust double-click wait for series navigation"),Ht.addEventListener("input",()=>{const w=Yn(parseInt(Ht.value,10));wi.textContent=mr(w),ca(w)}),vi.append(Qi,wi,Ht),qe.appendChild(vi);const hr=w=>`${Math.round((w-1)*100)}%`,yi=document.createElement("label");yi.className="settings-slider",yi.setAttribute("for","hoverScaleSlider");const no=document.createElement("div");no.className="settings-slider__text";const io=document.createElement("span");io.className="settings-slider__label",io.textContent="Hover zoom";const oo=document.createElement("span");oo.className="settings-slider__hint",oo.textContent="Expand tiles on hover to see more detail.",no.append(io,oo);const Ei=document.createElement("span");Ei.className="settings-slider__value",Ei.textContent=hr(Rn);const Ft=document.createElement("input");Ft.type="range",Ft.id="hoverScaleSlider",Ft.className="settings-slider__input",Ft.min=String(U),Ft.max=String(oe),Ft.step="0.1",Ft.value=String(Rn),Ft.setAttribute("aria-label","Adjust hover zoom"),Ft.addEventListener("input",()=>{const w=Wn(parseFloat(Ft.value));Ei.textContent=hr(w),Zr(w),M&&ei()}),yi.append(no,Ei,Ft),qe.appendChild(yi);const gr=w=>w===1?"Default":`${Math.round(w*100)}%`,_i=document.createElement("label");_i.className="settings-slider",_i.setAttribute("for","tileCompactnessSlider");const ro=document.createElement("div");ro.className="settings-slider__text";const ao=document.createElement("span");ao.className="settings-slider__label",ao.textContent="Tile compactness";const so=document.createElement("span");so.className="settings-slider__hint",so.textContent="Adjust padding, gap, and logo size for tiles.",ro.append(ao,so);const ki=document.createElement("span");ki.className="settings-slider__value",ki.textContent=gr(Vn);const jt=document.createElement("input");jt.type="range",jt.id="tileCompactnessSlider",jt.className="settings-slider__input",jt.min=String(at),jt.max=String(st),jt.step="0.05",jt.value=String(Vn),jt.setAttribute("aria-label","Adjust tile compactness"),jt.addEventListener("input",()=>{const w=qn(parseFloat(jt.value));ki.textContent=gr(w),ea(w),M&&ei()}),_i.append(ro,ki,jt),qe.appendChild(_i);const{row:Hs}=Dt({id:"titleWrapToggle",label:"Wrap titles",hint:"Allow long titles to wrap instead of truncating.",checked:No!=="nowrap",className:"map-controls__toggle",onChange:w=>{const ee=w?"wrap":"nowrap";Kn(ee),aa(ee)}});qe.appendChild(Hs);const br=w=>`${Math.round((w-1)*100)}% extra`,Si=document.createElement("label");Si.className="settings-slider",Si.setAttribute("for","titleHoverWidthSlider");const lo=document.createElement("div");lo.className="settings-slider__text";const co=document.createElement("span");co.className="settings-slider__label",co.textContent="Title width on hover";const uo=document.createElement("span");uo.className="settings-slider__hint",uo.textContent="Give titles more room horizontally when zoomed.",lo.append(co,uo);const Ci=document.createElement("span");Ci.className="settings-slider__value",Ci.textContent=br(Un);const Jt=document.createElement("input");Jt.type="range",Jt.id="titleHoverWidthSlider",Jt.className="settings-slider__input",Jt.min=String(Et),Jt.max=String(_t),Jt.step="0.05",Jt.value=String(Un),Jt.setAttribute("aria-label","Adjust title width boost on hover"),Jt.addEventListener("input",()=>{const w=Gn(parseFloat(Jt.value));Ci.textContent=br(w),na(w)}),Si.append(lo,Ci,Jt),qe.appendChild(Si);const vr=w=>`${Math.round(w*100)}% of hover zoom`,Ii=document.createElement("label");Ii.className="settings-slider",Ii.setAttribute("for","titleZoomPortionSlider");const po=document.createElement("div");po.className="settings-slider__text";const fo=document.createElement("span");fo.className="settings-slider__label",fo.textContent="Title zoom influence";const mo=document.createElement("span");mo.className="settings-slider__hint",mo.textContent="How much the title scales relative to tile hover zoom.",po.append(fo,mo);const xi=document.createElement("span");xi.className="settings-slider__value",xi.textContent=vr(Dn);const Wt=document.createElement("input");Wt.type="range",Wt.id="titleZoomPortionSlider",Wt.className="settings-slider__input",Wt.min=String(ve),Wt.max=String(We),Wt.step="0.05",Wt.value=String(Dn),Wt.setAttribute("aria-label","Adjust how much titles scale on hover"),Wt.addEventListener("input",()=>{const w=zn(parseFloat(Wt.value));xi.textContent=vr(w),oa(w)}),Ii.append(po,xi,Wt),qe.appendChild(Ii);const Fs=typeof Re.isEnabled=="function"?Re.isEnabled():!1,{row:js,input:Js}=Dt({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:Fs,className:"apicurio-toggle",onChange:w=>{typeof Re.setEnabled=="function"&&Re.setEnabled(w)}});if(Vt=Js,qe.appendChild(js),ht.appendChild(qe),c)c.hidden=!1,c.classList.remove("pf-v5-c-page__main-section"),ht.appendChild(c);else{const w=document.createElement("p");w.className="muted",w.textContent="Source editor unavailable.",ht.appendChild(w)}L.appendChild(ht),Re.mount(j);let wr=0;R.m.categories.forEach(w=>{const ee=document.createElement("section");ee.className="category",ee.dataset.cat=w.id;const J=document.createElement("div");J.className="cat-head",J.dataset.cat=w.id,J.tabIndex=0,J.title="Select category",J.innerHTML=`<div class="cat-title">${An(w.title||w.id)}</div>
                          <div class="muted cat-count">${(w.items||[]).length} items</div>`,J.addEventListener("click",()=>Yt(w.id)),J.addEventListener("keydown",Te=>{(Te.key==="Enter"||Te.key===" ")&&(Te.preventDefault(),Yt(w.id))}),J.addEventListener("focus",()=>Yt(w.id,{scrollIntoView:!1})),ee.appendChild(J);const Ce=document.createElement("div");Ce.className="grid",ee.appendChild(Ce),(w.items||[]).forEach(Te=>{wr+=1;const qt=ir(Te.external),Gt=nr(Te,{externalMeta:qt,seriesIdLookup:Ae}),He=document.createElement("div");if(He.className=qt.isExternal?"tile external":"tile",He.tabIndex=0,He.dataset.id=Te.id,He.dataset.globalIndex=String(wr),qt.url&&(He.dataset.externalUrl=qt.url),Ae.has(Te.id)){const si=Ae.get(Te.id);He.dataset.seriesVersionIndex=String(si),He.classList.add("tile--series-link");const Ws=si===Se?"Current map in this series":`Open version ${si+1} in this series`;He.title=Ws}Gt&&(He.dataset.obsidianUrl=Gt);const zt=document.createElement("img");zt.className="logo",Te.logo?(zt.src=Te.logo,zt.alt=Te.name||Te.id):(zt.alt="",zt.style.opacity=1,zt.src=za(Te.name||Te.id,Te.color));const yn=document.createElement("div");yn.className="name",yn.textContent=Te.name||Te.id;const ho=document.createElement("div");ho.className="tile-id",ho.textContent=Te.id||"";const go=document.createElement("div");go.className="badge",go.textContent="reused";const Nn=document.createElement("button");Nn.type="button",Nn.className="tile-delete",Nn.setAttribute("aria-label",`Delete ${Te.name||Te.id}`),Nn.textContent="×",Nn.addEventListener("click",si=>{si.stopPropagation(),Ts(Te.id)}),qt.url&&He.appendChild(rs(qt.url)),or(He,Gt),He.appendChild(Nn),He.appendChild(zt),He.appendChild(yn),He.appendChild(ho),He.appendChild(go),Ce.appendChild(He),se.set(Te.id,{el:He,catId:w.id,rect:null})}),lt.appendChild(ee),Be.set(w.id,{el:ee,headEl:J});const et=document.createElement("button");et.type="button",et.className="tile-add",et.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',et.addEventListener("click",()=>ws(w.id)),Ce.appendChild(et)});const ai=document.createElement("button");ai.type="button",ai.className="category-add",ai.innerHTML='<span class="category-add__icon" aria-hidden="true">+</span><span class="category-add__label">Add category</span><span class="category-add__hint">(Insert)</span>',ai.addEventListener("click",()=>lr()),lt.appendChild(ai),er(),Qa(),Hi(),xn(),In(),cs()}function Qa(){f.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",n=>{var v;if(typeof n.button=="number"&&n.button!==0)return;Bt();const i=e.dataset.id,o=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,r=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,a=C[b],d=a?vn(a):-1,p=((v=a==null?void 0:a.apicurioVersions)==null?void 0:v.length)>1&&Number.isInteger(o)&&o!==d,h=Mt&&Mt.id===i&&Mt.targetVersionIndex===o;if(Mt&&!h&&Sn(),p)if(h){if(Sn(),Ui(b,o))return}else $a(i,o,a);else Number.isInteger(r)&&r>0&&r%5===0&&Mi("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",i),M===i&&!(p&&h)){ni();return}wt(i)}),e.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())});const t=()=>{M&&ei()};e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",t),e.addEventListener("focus",t),e.addEventListener("blur",t),e.draggable=!0,e.addEventListener("dragstart",fs),e.addEventListener("dragend",ms)}),f.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",hs),e.addEventListener("drop",vs),e.addEventListener("dragenter",gs),e.addEventListener("dragleave",bs)}),Jo||(Jo=!0,window.addEventListener("resize",ei),window.addEventListener("scroll",ei,{passive:!0}),window.addEventListener("resize",rr)),document.getElementById("clear").onclick=()=>ni()}function Hi(){se.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function Qo(e,{includeSecondary:t=Xt}={}){if(!e||!R)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(R.fwd.get(e)||[]),i=new Set(R.rev.get(e)||[]),o=new Set,r=new Set,a=[],d=new Set,p=(h,v,N,I)=>{if(!h||!v)return;const L=`${h}->${v}:${N}:${I}`;d.has(L)||(d.add(L),a.push({from:h,to:v,type:N,depth:I}))};return n.forEach(h=>p(e,h,"dep",1)),i.forEach(h=>p(e,h,"revdep",1)),t&&new Set([...n,...i]).forEach(v=>{(R.fwd.get(v)||new Set).forEach(L=>{const j=L===e;j||o.add(L),j||p(v,L,"dep",2)}),(R.rev.get(v)||new Set).forEach(L=>{const j=L===e;j||r.add(L),j||p(v,L,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:o,secondaryRevs:r,edges:a}}function gi(e,t){const n=se.get(e);n&&n.el.classList.add(t)}function wt(e){var d,p,h;if(!e)return;Ee=null,M=e,Oe=null,$e=Qo(e),pt(),ji(),In();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:o}=$e;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const r=se.get(e);r&&r.el.classList.add("selected"),t.forEach(v=>gi(v,"dep")),n.forEach(v=>gi(v,"revdep")),i.forEach(v=>{!t.has(v)&&v!==e&&gi(v,"dep-indirect")}),o.forEach(v=>{!n.has(v)&&!t.has(v)&&v!==e&&gi(v,"revdep-indirect")}),xn();const a=(h=(p=(d=se.get(e))==null?void 0:d.el)==null?void 0:p.dataset)==null?void 0:h.externalUrl;a&&Mi("This item has link to",Zt,a)}function Yt(e,{scrollIntoView:t=!0,preserveEntryHint:n=!1}={}){var a,d;if(!((a=R==null?void 0:R.m)!=null&&a.categories)||!e)return!1;const o=(R.m.categories||[]).find(p=>p.id===e);if(!o)return!1;Bt(),Fi(),n||(Oe=null),Ee=o.id,pt(),In();const r=Be.get(o.id);return t&&(r!=null&&r.el)&&(r.el.scrollIntoView({behavior:"smooth",block:"center"}),(d=r.headEl)==null||d.focus({preventScroll:!0})),!0}function In(){if(Be.forEach(({el:t,headEl:n})=>{t.classList.remove("category--selected"),n&&n.removeAttribute("aria-current")}),!Ee)return;const e=Be.get(Ee);if(!(e!=null&&e.el)){Ee=null,Oe=null,pt();return}e.el.classList.add("category--selected"),e.headEl&&e.headEl.setAttribute("aria-current","true")}function ti(){if(Ee)return Ee;const e=M?se.get(M):null;return e!=null&&e.catId?e.catId:null}function es(e){var r,a,d,p;if(!((a=(r=R==null?void 0:R.m)==null?void 0:r.categories)!=null&&a.length)||!e)return!1;const t=R.m.categories,n=ti();let i=t.findIndex(h=>h.id===n);if(i===-1){const h=((d=t.find(v=>(v.items||[]).length))==null?void 0:d.id)||((p=t[0])==null?void 0:p.id);return h?Yt(h):!1}const o=i+e;return o<0||o>=t.length?!1:Yt(t[o].id)}function Fi(){M=null,$e=null,ji(),xn()}function ts(){Ee=null,Oe=null,In()}function ni(){Fi(),ts(),Oe=null,pt()}function ji(){f.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function er(){R!=null&&R.reusedLocal&&R.reusedLocal.forEach(e=>{const t=se.get(e);if(!t)return;t.el.classList.toggle("reused",gt);const n=t.el.querySelector(".badge");n&&(n.style.display=gt?"inline-block":"none")})}function xn(){for(;x.firstChild;)x.removeChild(x.firstChild);if(!M||x.hidden)return;$e=Qo(M),$e.edges.forEach(t=>{var N,I;const n=(N=se.get(t.from))==null?void 0:N.rect,i=(I=se.get(t.to))==null?void 0:I.rect;if(!n||!i)return;const o=tr(n),r=tr(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),d=(o.x+r.x)/2,p=o.y,h=(o.x+r.x)/2,v=r.y;a.setAttribute("d",`M ${o.x},${o.y} C ${d},${p} ${h},${v} ${r.x},${r.y}`),a.setAttribute("fill","none"),a.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),a.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),a.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&a.setAttribute("stroke-dasharray","4 3"),a.setAttribute("vector-effect","non-scaling-stroke"),x.appendChild(a)})}function tr(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function An(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function ns(e){const t=(e??"").toString().trim();if(!t)return"";const n=t.endsWith(".md")?t:`${t}.md`,i=new URLSearchParams;return i.set("filepath",n),i.set("data"," "),i.set("mode","append"),Fn&&i.set("vault",Fn),`obsidian://advanced-uri?${i.toString()}`}function is(e){return e?pi===Pn?e.id??e.name??"":e.name??e.id??"":""}function nr(e,{externalMeta:t,seriesIdLookup:n}={}){var o;if(!Hn||!e||(o=n==null?void 0:n.has)!=null&&o.call(n,e.id))return"";const i=is(e);return ns(i)}function ir(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function os(e){const t=document.createElement("button");return t.type="button",t.className="external-link obsidian-link",t.setAttribute("aria-label","Open in Obsidian"),t.title=e,t.textContent="O",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function rs(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function or(e,t){if(!e)return;const n=e.querySelector(".obsidian-link");if(!t){n&&n.remove(),e.removeAttribute("data-obsidian-url");return}if(e.dataset.obsidianUrl=t,n){n.title=t;return}e.appendChild(os(t))}function rr(){l||(l=requestAnimationFrame(()=>{l=null,ut=ut.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),ut.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function as(e,t){!e||!t||(ut.push({labelEl:e,textEl:t}),rr())}function ss(e,t){var r,a;const n=[`<div class="version-nav__tooltip-title">${An(t)}</div>`],i=((e==null?void 0:e.version)??((r=e==null?void 0:e.data)==null?void 0:r.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${An(i)}</div>`);const o=(((a=e==null?void 0:e.data)==null?void 0:a.abstract)??"").toString().trim();return o?n.push(`<div class="version-nav__tooltip-body">${o}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function ii(e,t,{offset:n=8}={}){!k||!e||!t||(k.innerHTML=t,k.hidden=!1,k.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),o=k.getBoundingClientRect(),r=window.scrollX||document.documentElement.scrollLeft,a=window.scrollY||document.documentElement.scrollTop;let d=i.left+i.width/2-o.width/2+r,p=i.top-o.height-n+a;d<r+n&&(d=r+n);const h=r+window.innerWidth-o.width-n;d>h&&(d=h),p<a+n&&(p=i.bottom+n+a),k.style.left=`${d}px`,k.style.top=`${p}px`,k.classList.add("is-visible")}))}function en(){Rt&&(clearTimeout(Rt),Rt=null),k&&(k.classList.remove("is-visible"),k.setAttribute("aria-hidden","true"),k.hidden=!0)}function ls(e,t){if(!e)return;const n=Ve((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=ss(t,n);let o=null;const r=()=>{o&&(clearTimeout(o),o=null)},a=()=>{Ut=e,ii(e,`<div class="version-nav__tooltip-title">${An(n)}</div>`,{offset:10})},d=()=>{r(),o=setTimeout(()=>{Ut===e&&ii(e,i,{offset:10})},g)},p=()=>{a(),d()},h=()=>{Ut!==e&&a(),d()},v=()=>{r(),Ut===e&&(Ut=null,en())};e.addEventListener("mouseenter",p),e.addEventListener("focus",p),e.addEventListener("pointermove",h),e.addEventListener("mouseleave",v),e.addEventListener("blur",v),e.addEventListener("click",v)}function cs(){nn&&(nn=!1,!(!yt||!At)&&(en(),ii(yt,At,{offset:12}),Rt=setTimeout(()=>{en(),ds()},1e3)))}function ds(){yt&&(Lt&&(clearTimeout(Lt),Lt=null),yt.classList.add("blockscape-tab--twinkle"),Lt=setTimeout(()=>{yt.classList.remove("blockscape-tab--twinkle"),Lt=null},1400))}window.addEventListener("scroll",en,!0),window.addEventListener("resize",en);function Bt(){T&&(T.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),T.setAttribute("aria-hidden","true"),T.hidden=!0,ar([]))}function us(e,t){T&&(rt={x:e,y:t},T.hidden=!1,T.setAttribute("aria-hidden","false"),T.classList.add("is-visible"),Ln(e,t))}function Ln(e,t){if(!T)return;const n=12;T.style.left=`${e+n}px`,T.style.top=`${t+n}px`;const i=T.getBoundingClientRect();let o=i.left,r=i.top;i.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(r=Math.max(n,window.innerHeight-i.height-n)),T.style.left=`${o}px`,T.style.top=`${r}px`}function ar(e=[]){he&&(he.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),he.appendChild(n)}),he.hidden=e.length===0)}async function ps(e,t){var v;if(!T)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((v=t.querySelector(".name"))==null?void 0:v.textContent)||n||"Preview",o=n?`${n}.html`:"",r=o?`items/${o}`:"",a=++$t,d=t.dataset.externalUrl||"",p=t.dataset.obsidianUrl||"",h=[{label:"Edit",title:"Edit this item",onClick:()=>{Bt(),hn.open(n)}}];if(d&&h.push({label:"Open link ↗",title:d,onClick:()=>window.open(d,"_blank","noopener")}),p&&h.push({label:"Open in Obsidian",title:p,onClick:()=>window.open(p,"_blank","noopener")}),ar(h),n&&wt(n),ce.textContent=i,K.innerHTML='<div class="item-preview__status">Loading…</div>',T.classList.remove("item-preview--has-frame"),T.classList.add("item-preview--expanded"),us(e.clientX,e.clientY),!r){K.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',Ln(rt.x,rt.y);return}try{const N=await fetch(r,{cache:"no-cache"});if(!N.ok)throw new Error(`HTTP ${N.status}`);const I=await N.text();if(a!==$t)return;if(!I.trim()){K.innerHTML=`<div class="item-preview__status">No content in <code>${An(o)}</code>.</div>`,Ln(rt.x,rt.y);return}const j=document.createElement("iframe");j.className="item-preview__frame",j.title=`${i} details`,j.srcdoc=I,K.innerHTML="",K.appendChild(j),T.classList.add("item-preview--has-frame"),Ln(rt.x,rt.y)}catch(N){if(a!==$t)return;K.innerHTML=`<div class="item-preview__status">No preview available for <strong>${An(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${r}`,N),Ln(rt.x,rt.y)}}be&&be.addEventListener("click",Bt),O&&O.addEventListener("click",()=>{Pa()}),pe&&pe.addEventListener("click",()=>{Ra()}),fe&&fe.addEventListener("click",Pi),ye&&ye.addEventListener("click",Pi),Fe&&Fe.addEventListener("click",Ri),ot&&ot.addEventListener("click",Ri),f&&f.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!f.contains(t)||ps(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!T||T.hidden||T.contains(e.target)||Bt()}),Ue&&Ue.addEventListener("click",()=>{Do("button")}),Y&&Y.addEventListener("click",()=>{if(b<0){alert("Load or select a model before creating a version.");return}try{const e=Uo({versionLabel:"map edit"});ft(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),q&&q.addEventListener("click",async()=>{var r;if(b<0||!C[b]){alert("Select or load a model before sharing.");return}const e={title:Ve(C[b],"Shared Model"),data:C[b].data};let t;try{t=Hr(JSON.stringify(e))}catch(a){console.error("[Blockscape] share encode failed",a),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(a){console.warn("[Blockscape] failed to update URL for share",a),window.location.hash=n.hash}let o=!1;if((r=navigator.clipboard)!=null&&r.writeText)try{await navigator.clipboard.writeText(i),o=!0}catch(a){console.warn("[Blockscape] clipboard write failed",a)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),ie&&ie.addEventListener("click",()=>{const e=(s.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};M&&(n.selectedItemId=M),localStorage.setItem(ze,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";M&&(t=`editor.html?selected=${encodeURIComponent(M)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==ze||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||Yo("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===Ct&&Yo("message")})),document.addEventListener("keydown",e=>{var n,i,o,r,a,d,p,h,v,N;if(Ma()){e.key==="Escape"&&(e.preventDefault(),Pi());return}if(!(ne!=null&&ne.hidden)&&e.key==="Escape"){e.preventDefault(),Ri();return}if(!((n=hn==null?void 0:hn.isOpen)!=null&&n.call(hn))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const I=C[b],L=((i=I==null?void 0:I.apicurioVersions)==null?void 0:i.length)>1;Do("shortcut",L);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!bn())return;if(xs()){e.preventDefault();return}}if(e.key==="Escape"){let I=!1;T&&!T.hidden&&(Bt(),I=!0),(M||Ee)&&(ni(),I=!0),I&&e.preventDefault()}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!bn())return;const I=e.key==="ArrowLeft"?-1:1;if(e.altKey)return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){Di(I)&&e.preventDefault();return}if(e.ctrlKey||e.metaKey)return;if(Ee&&!e.shiftKey){e.preventDefault();return}e.shiftKey?Es(I)&&e.preventDefault():_s(I)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!bn())return;const I=e.key==="ArrowUp"?-1:1;if((e.ctrlKey||e.metaKey)&&!e.altKey){Is(I)&&e.preventDefault();return}if(e.altKey)return;if(Ee&&!M&&!e.shiftKey){if(Ss(I)){e.preventDefault();return}if(es(I)){e.preventDefault();return}}e.shiftKey?Cs(I)&&e.preventDefault():ks(I)&&e.preventDefault()}if(e.key==="Delete"){if(!bn()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const I=Ee?Ns():!1,L=I?!0:cr();(I||L)&&e.preventDefault()}if(e.key==="F2"){if(!bn())return;const I=Ee&&!M&&Ee||!M&&((d=(a=(r=(o=e.target)==null?void 0:o.closest)==null?void 0:r.call(o,".category"))==null?void 0:a.dataset)==null?void 0:d.cat)||null;if(I&&!M&&ys(I)){e.preventDefault();return}const L=M||((N=(v=(h=(p=e.target)==null?void 0:p.closest)==null?void 0:h.call(p,".tile"))==null?void 0:v.dataset)==null?void 0:N.id);L&&hn.open(L)&&e.preventDefault()}if(e.key==="Insert"){if(!bn()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;lr()&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!T||T.hidden||Ln(rt.x,rt.y)}),window.addEventListener("scroll",()=>{!T||T.hidden||Bt()},!0);let an=null,oi=null;function fs(e){Bt(),an=e.target.dataset.id,oi=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:an,categoryId:oi})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",an,"from",oi)}function ms(e){e.target.classList.remove("dragging"),f.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),f.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),an=null,oi=null}function hs(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function gs(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function bs(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function vs(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!an||!i)return;const r=Array.from(t.querySelectorAll(".tile")).filter(a=>a.dataset.id!==an).find(a=>{const d=a.getBoundingClientRect();return e.clientY<d.top+d.height/2});sr(an,r?r.dataset.id:null,i),Cn(),console.log("[Blockscape] drop completed",an,"from",oi,"to",i)}function sr(e,t,n){if(b<0)return;const o=C[b].data.categories||[],r=o.find(v=>(v.items||[]).some(N=>N.id===e)),a=o.find(v=>v.id===n);if(!r||!a)return;r.items=r.items||[],a.items=a.items||[];const d=r.items.findIndex(v=>v.id===e);if(d===-1)return;const[p]=r.items.splice(d,1);let h=a.items.length;if(t){const v=a.items.findIndex(N=>N.id===t);v!==-1&&(h=v)}a.items.splice(h,0,p),vt(),mt()}function ws(e){if(b<0||!e)return;const t=C[b].data,i=(t.categories||[]).find(p=>p.id===e);if(!i)return;i.items=i.items||[];const o=`New item ${i.items.length+1}`,a={id:Sa(`${e}-${i.items.length+1}`,t),name:o,deps:[]};i.items.push(a),vt(),mt(),Bt(),wt(a.id);const d=se.get(a.id);d!=null&&d.el&&d.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",a.id,"to",e)}function lr(){if(b<0)return!1;const e=C[b].data;e.categories=e.categories||[];const t=`New category ${e.categories.length+1}`,n=Ca(t,e),i={id:n,title:t,items:[]};return e.categories.push(i),Ee=n,M=null,$e=null,Oe=null,vt(),mt(),Yt(n),console.log("[Blockscape] added category",n),!0}function ys(e=ti()){if(b<0||!e)return!1;const t=xa.open(e);return t&&(M=null,$e=null,pt()),t}function Es(e){if(!M||b<0||!e)return!1;const n=C[b].data.categories||[],i=se.get(M);let o=null;if(i!=null&&i.catId&&(o=n.find(p=>p.id===i.catId)),o||(o=n.find(p=>(p.items||[]).some(h=>h.id===M))),!o)return!1;o.items=o.items||[];const r=o.items.findIndex(p=>p.id===M);if(r===-1)return!1;const a=r+e;if(a<0||a>=o.items.length)return!1;const[d]=o.items.splice(r,1);return o.items.splice(a,0,d),vt(),mt(),Cn(),wt(M),!0}function _s(e){if(!R||!R.m||!e)return!1;const t=R.m.categories||[];if(!t.length)return!1;const n=()=>{const p=t.find(h=>(h.items||[]).length);return p?{category:p,item:p.items[0]}:null};if(!M){const p=n();return p?(wt(p.item.id),!0):!1}const i=se.get(M);let o=null;if(i!=null&&i.catId&&(o=t.find(p=>p.id===i.catId)),o||(o=t.find(p=>(p.items||[]).some(h=>h.id===M))),!o){const p=n();return p?(wt(p.item.id),!0):!1}const r=o.items||[];if(!r.length)return!1;const a=r.findIndex(p=>p.id===M);if(a===-1)return!1;const d=a+e;return d<0||d>=r.length?!1:(wt(r[d].id),!0)}function ks(e){if(!R||!R.m||!e)return!1;const t=R.m.categories||[];if(!t.length)return!1;const n=ti();let i=t.findIndex(a=>a.id===n),o=i+e;if(i===-1&&(o=e>0?0:t.length-1),o<0||o>=t.length)return!1;const r=t[o];if(M){const d=(t[i].items||[]).findIndex(p=>p.id===M);Oe={catId:r.id,position:d===-1?0:d}}else Oe=null;return Yt(r.id,{preserveEntryHint:!0})}function Ss(e){var r;if(!Ee||!((r=R==null?void 0:R.m)!=null&&r.categories)||!e)return!1;const n=(R.m.categories||[]).find(a=>a.id===Ee);if(!n)return!1;const i=n.items||[];if(!i.length)return!1;let o=e>0?0:Math.max(0,i.length-1);return(Oe==null?void 0:Oe.catId)===n.id&&(o=Math.min(i.length-1,Math.max(0,Oe.position||0))),Oe=null,wt(i[o].id),!0}function Cs(e){if(!M||b<0||!e)return!1;const n=C[b].data.categories||[];if(!n.length)return!1;const i=se.get(M);let o=-1;if(i!=null&&i.catId&&(o=n.findIndex(N=>N.id===i.catId)),o===-1&&(o=n.findIndex(N=>(N.items||[]).some(I=>I.id===M))),o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const a=n[o],d=n[r];if(!d)return!1;a.items=a.items||[],d.items=d.items||[];const p=a.items.findIndex(N=>N.id===M);if(p===-1)return!1;const h=Math.min(d.items.length,Math.max(0,p)),v=h<d.items.length?d.items[h].id:null;return sr(M,v,d.id),Cn(),wt(M),!0}function Is(e){if(b<0||!e)return!1;const n=C[b].data.categories||[];if(!n.length)return!1;const i=ti();if(!i)return!1;const o=n.findIndex(d=>d.id===i);if(o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const[a]=n.splice(o,1);return n.splice(r,0,a),Ee=a.id,Fi(),Oe=null,pt(),vt(),mt(),In(),console.log("[Blockscape] moved category",a.id,"from",o,"to",r),!0}function xs(){if(b<0)return!1;const e=C[b],t=nt(e)||(e?e.id:null),n=[];if(Ke&&t===Ke.modelId&&n.push({...Ke,type:"item"}),Ot&&t===Ot.modelId&&n.push({...Ot,type:"category"}),!n.length)return!1;const i=n.reduce((o,r)=>o?(r.ts||0)>(o.ts||0)?r:o:r,null);if(!i)return!1;if(i.type==="category"){if(Ls(i))return!0}else if(i.type==="item"&&As(i))return!0;return!1}function As(e){const t=C[b],n=nt(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const r=(t.data.categories||[]).find(d=>d.id===e.categoryId);if(!r)return!1;r.items=r.items||[];const a=Math.min(Math.max(e.index,0),r.items.length);return r.items.splice(a,0,e.item),Ke=null,Bt(),M=null,$e=null,pt(),vt(),mt(),Cn(),wt(e.item.id),console.log("[Blockscape] undo delete restored",e.item.id),!0}function Ls(e){const t=C[b],n=nt(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const i=t.data;i.categories=i.categories||[];const o=Math.min(Math.max(e.index,0),i.categories.length);return i.categories.splice(o,0,e.category),Ot=null,M=null,$e=null,Ee=e.category.id,Oe=null,pt(),vt(),mt(),In(),Yt(e.category.id),console.log("[Blockscape] undo delete restored category",e.category.id),!0}function cr(){if(!M||b<0)return!1;const t=C[b].data.categories||[];if(!t.length)return!1;const n=se.get(M);let i=null;if(n!=null&&n.catId&&(i=t.find(h=>h.id===n.catId)),i||(i=t.find(h=>(h.items||[]).some(v=>v.id===M))),!i||!Array.isArray(i.items))return!1;const o=i.items.findIndex(h=>h.id===M);if(o===-1)return!1;const r=i.items.splice(o,1)[0];if(!r)return!1;const a=C[b];Ke={item:r,categoryId:i.id,index:o,modelId:nt(a)||(a?a.id:null),ts:Date.now()};const p=(()=>{var v;if(i.items.length){const N=Math.min(o,i.items.length-1);return((v=i.items[N])==null?void 0:v.id)||null}const h=t.findIndex(N=>N.id===i.id);if(h===-1)return null;for(let N=h+1;N<t.length;N++){const I=t[N].items||[];if(I.length)return I[0].id}for(let N=h-1;N>=0;N--){const I=t[N].items||[];if(I.length)return I[0].id}return null})();return Bt(),M=null,$e=null,Oe=null,pt(),vt(),mt(),Cn(),p?wt(p):ni(),console.log("[Blockscape] removed item",r.id),!0}function Ns(){var d,p;const e=ti();if(!e||b<0)return!1;const n=C[b].data.categories||[];if(!n.length)return!1;const i=n.findIndex(h=>h.id===e);if(i===-1)return!1;const[o]=n.splice(i,1);if(!o)return!1;const r=C[b];Ot={category:o,index:i,modelId:nt(r)||(r?r.id:null),ts:Date.now()},Ee=null,M=null,$e=null,Oe=null,pt(),vt(),mt();const a=((d=n[i])==null?void 0:d.id)||((p=n[i-1])==null?void 0:p.id)||null;return a?Yt(a):ni(),console.log("[Blockscape] removed category",o.id),!0}function Ts(e){if(!e)return!1;const t=M;M=e;const n=cr();return n||(M=t,pt()),n}G&&G.addEventListener("click",async()=>{const e=s.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await Oo(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),Z&&Z.addEventListener("click",async()=>{const e=Aa();if(!e){alert("No series available to copy. Create another version first.");return}await Oo(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),Me&&Me.addEventListener("click",async()=>{try{const e=await Gr();if(!e){alert("Clipboard is empty.");return}s.value=e,s.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=rn(s.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const o=Qt(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=o)}),b===-1&&t!=null?ft(t):gn()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(b<0){alert("No active model selected.");return}try{const t=JSON.parse(s.value);if(mn(t,{titleHint:Ve(C[b]),idHint:nt(C[b])||Ve(C[b])}),C[b].data=t,C[b].title=t.title||C[b].title,C[b].isSeries||((e=C[b].apicurioVersions)==null?void 0:e.length)>1){const n=C[b].title||Ve(C[b]);St(C[b],{seriesName:n,fallbackTitle:n})}$i(),console.log("[Blockscape] replaced active model:",Ve(C[b])),mt(),Re.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const o=await i.text(),r=i.name.replace(/\.[^.]+$/,"")||"File",a=rn(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models in file:",i.name);continue}a.forEach((d,p)=>{var re;const h=(((re=d.data)==null?void 0:re.title)??"").toString().trim(),v=a.length>1?`${i.name} #${p+1}`:i.name,N=`${r} series`,I=d.isSeries?N:null;let L={...d};if(d.isSeries){const Ae=I||h||d.title||v||"unknown";L.title=Ae;const Se=dn(Ae||"unknown");fi(L,Se),St(L,{seriesName:Ae,fallbackTitle:"unknown"}),L.apicurioArtifactName=L.apicurioArtifactName||Ae}else L.title=h||v;const j=Qt({...L,apicurioArtifactName:L.apicurioArtifactName||I||L.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=j)})}b===-1&&n!=null?ft(n):gn()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",Bs);function Bs(e){var o;if(!bn())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Ja(t))return;let n=[];try{n=rn(t,"Clipboard",{promptForSeriesName:!0})}catch(r){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",r);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((r,a)=>{const d=Qt(r,{versionLabel:n.length>1?`paste #${a+1}`:"paste"});i==null&&(i=d)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&ft(i)}F.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(Ta(),ft(n))}),document.getElementById("removeModel").onclick=()=>{if(b<0)return;const e=Ve(C[b]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",Ve(C[b])),C.splice(b,1),!C.length){b=-1,R=null,f.innerHTML="",x.innerHTML="",s.value="",gn(),$i();return}const n=Math.min(b,C.length-1);ft(n)},ke&&(ke.addEventListener("input",e=>{Go(e.target.value||"")}),ke.addEventListener("focus",()=>{ke.value&&ke.value.trim()&&qo(ke.value)})),V&&V.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;Da({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!V||V.hidden)return;const t=e.target;V.contains(t)||ke&&(t===ke||ke.contains(t))||(V.hidden=!0)}),E&&z&&te&&E.addEventListener("submit",async e=>{e.preventDefault();const t=z.value.trim();if(!t){alert("Please enter a URL"),z.focus();return}const n=await Ji(t);if(typeof n=="number"){ft(n),z.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!z||!t)return;let n=null;z.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=z.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function mt(){if(!(b<0))try{R=Ga(C[b].data),Cn()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function $s(){const e=["comms.bs","planets.bs","styleguide.bs","blockscape-features.bs"],t=n=>Li?Li.endsWith("/")?`${Li}${n}`:`${Li}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const o=await i.text(),r=n.replace(/\.[^.]+$/,"")||"Model",a=rn(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models found in",n);continue}a.forEach(d=>{let p={...d};if(d.isSeries){const h=`${r} series`;p={...d,title:h,apicurioArtifactName:h};const v=dn(h||"unknown");fi(p,v),St(p,{seriesName:h,fallbackTitle:"unknown"})}Qt(p,{versionLabel:n})}),console.log(`[Blockscape] loaded ${a.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}gn()}async function Os(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const o=await fetch(e,i);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function Ms(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>Ps(i)),e.querySelectorAll("a[href]").forEach(i=>{const o=i.getAttribute("href");ur(o)&&dr(i,o)})}function Ps(e){var d,p;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(p=(d=e.parentNode)==null?void 0:d.closest)!=null&&p.call(d,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let o;for(;(o=n.exec(t))!==null;)i.push({url:o[0],index:o.index});if(!i.length)return;const r=document.createDocumentFragment();let a=0;i.forEach(({url:h,index:v})=>{v>a&&r.appendChild(document.createTextNode(t.slice(a,v))),r.appendChild(Rs(h)),a=v+h.length}),a<t.length&&r.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(r,e)}function Rs(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",ur(e)&&dr(t,e),t}function dr(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>Vs(n,t,e)))}async function Vs(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await Ji(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function ur(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function Ji(e){try{console.log("[Blockscape] loading from URL:",e);const t=await Os(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=rn(t,i)}catch(a){throw new Error(`Invalid JSON payload: ${a.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let r=null;return o.forEach((a,d)=>{var L;const p=(((L=a.data)==null?void 0:L.title)??"").toString().trim(),h=o.length>1?`${i} #${d+1}`:i,v=a.isSeries?`${i} series`:null;let N={...a};if(a.isSeries){const j=v||p||N.title||h;N={...a,title:j,apicurioArtifactName:j||a.apicurioArtifactName};const re=dn(j||"unknown");fi(N,re),St(N,{seriesName:j||v||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:re,url:e,baseName:i,seriesTitle:j})}const I=Qt({...N,title:p||N.title||h,apicurioArtifactName:N.apicurioArtifactName||v||a.apicurioArtifactName},{versionLabel:i});r==null&&(r=I)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,i),b===-1&&r!=null?ft(r):gn(),r}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=rn(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let o=null;i.forEach(N=>{const I=Qt(N,{versionLabel:"seed"});o==null&&(o=I)}),await S||await $s();const a=await qa(),d=Ko(),p=d==null?void 0:d.index,h=Wa();ft(typeof a=="number"?a:typeof h=="number"?h:typeof p=="number"?p:o??0)})()}function hl(s){let c;return{c(){c=$("div"),c.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',m(c,"id","shortcutHelp"),m(c,"class","shortcut-help"),c.hidden=!0,m(c,"aria-hidden","true"),m(c,"role","dialog"),m(c,"aria-modal","true"),m(c,"aria-labelledby","shortcutHelpTitle")},m(f,x){ct(f,c,x)},p:tn,i:tn,o:tn,d(f){f&&tt(c)}}}class gl extends Lo{constructor(c){super(),Ao(this,c,null,hl,Io,{})}}const bl=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function Tr(s){let c,f,x,k,F,T,E,z;return{c(){c=$("div"),f=$("div"),x=$("a"),k=xo("Open Blockscape GPT"),F=X(),T=$("div"),T.textContent="Paste the copied prompt into that chat.",E=X(),z=$("div"),z.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',m(x,"href",wl),m(x,"target","_blank"),m(x,"rel","noreferrer"),m(T,"class","new-panel__hint"),m(f,"class","new-panel__link"),m(z,"class","new-panel__link new-panel__link--disabled"),m(c,"class","new-panel__links")},m(te,ce){ct(te,c,ce),y(c,f),y(f,x),y(x,k),y(f,F),y(f,T),y(c,E),y(c,z)},p:tn,d(te){te&&tt(c)}}}function Br(s){let c,f,x,k,F,T;return{c(){c=$("div"),f=$("div"),f.textContent="Generated prompt",x=X(),k=$("textarea"),m(f,"class","new-panel__prompt-label"),m(k,"class","pf-v5-c-form-control new-panel__textarea"),m(k,"rows","4"),k.readOnly=!0,m(c,"class","new-panel__prompt")},m(E,z){ct(E,c,z),y(c,f),y(c,x),y(c,k),_n(k,s[4]),F||(T=En(k,"input",s[12]),F=!0)},p(E,z){z&16&&_n(k,E[4])},d(E){E&&tt(c),F=!1,T()}}}function vl(s){let c,f,x,k,F,T,E,z,te,ce,K,he,be,Ue,q,Y,ie,G,Z,Me,O,pe,ae,we,fe,ye,ne,Fe,ot,ke,V,de,Ge,me,Ie,je,Je,Pe,ue,ze,Ct,Qe,C,b,Re,R=s[2]==="gpt"&&Tr(),se=s[4]&&s[5]&&Br(s);return C=Xs(s[10][0]),{c(){c=$("div"),f=$("div"),x=X(),k=$("div"),F=$("div"),F.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',T=X(),E=$("form"),z=$("div"),te=$("label"),te.textContent="Domain",ce=X(),K=$("p"),K.textContent="Describe what you want to create a map for.",he=X(),be=$("textarea"),Ue=X(),q=$("div"),Y=$("label"),ie=$("input"),G=X(),Z=$("span"),Z.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,Me=X(),O=$("fieldset"),pe=$("legend"),pe.textContent="Target",ae=X(),we=$("p"),we.textContent="Choose where you plan to use the prompt.",fe=X(),ye=$("label"),ne=$("input"),Fe=X(),ot=$("div"),ot.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',ke=X(),V=$("label"),de=$("input"),Ge=X(),me=$("div"),me.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',Ie=X(),je=$("div"),Je=$("button"),Je.textContent="Copy prompt",Pe=X(),ue=$("div"),ze=xo(s[3]),Ct=X(),R&&R.c(),Qe=X(),se&&se.c(),m(f,"id","newPanelBackdrop"),m(f,"class","shortcut-help__backdrop"),m(F,"class","shortcut-help__header"),m(te,"for","newDomain"),m(K,"class","new-panel__hint"),m(be,"id","newDomain"),m(be,"class","pf-v5-c-form-control new-panel__textarea"),m(be,"rows","4"),be.required=!0,m(be,"placeholder","Ex: Companies building open-source geospatial tools"),m(z,"class","new-panel__field"),m(ie,"id","seriesToggle"),m(ie,"type","checkbox"),m(Y,"class","new-panel__toggle"),m(Y,"for","seriesToggle"),m(q,"class","new-panel__field"),m(we,"class","new-panel__hint"),m(ne,"type","radio"),m(ne,"name","target"),ne.__value="gpt",_n(ne,ne.__value),m(ye,"class","new-panel__option"),m(de,"type","radio"),m(de,"name","target"),de.__value="plain",_n(de,de.__value),m(V,"class","new-panel__option"),m(O,"class","new-panel__field"),m(Je,"class","pf-v5-c-button pf-m-primary"),m(Je,"type","submit"),m(ue,"class","new-panel__status"),m(ue,"aria-live","polite"),m(je,"class","new-panel__actions"),m(E,"class","shortcut-help__list new-panel__form"),m(k,"class","shortcut-help__panel"),m(k,"tabindex","-1"),m(c,"id","newPanel"),m(c,"class","shortcut-help"),c.hidden=!0,m(c,"aria-hidden","true"),m(c,"role","dialog"),m(c,"aria-modal","true"),m(c,"aria-labelledby","newPanelTitle"),C.p(ne,de)},m(Be,M){ct(Be,c,M),y(c,f),y(c,x),y(c,k),y(k,F),y(k,T),y(k,E),y(E,z),y(z,te),y(z,ce),y(z,K),y(z,he),y(z,be),_n(be,s[0]),y(E,Ue),y(E,q),y(q,Y),y(Y,ie),ie.checked=s[1],y(Y,G),y(Y,Z),y(E,Me),y(E,O),y(O,pe),y(O,ae),y(O,we),y(O,fe),y(O,ye),y(ye,ne),ne.checked=ne.__value===s[2],y(ye,Fe),y(ye,ot),y(O,ke),y(O,V),y(V,de),de.checked=de.__value===s[2],y(V,Ge),y(V,me),y(E,Ie),y(E,je),y(je,Je),y(je,Pe),y(je,ue),y(ue,ze),y(E,Ct),R&&R.m(E,null),y(E,Qe),se&&se.m(E,null),b||(Re=[En(be,"input",s[7]),En(ie,"change",s[8]),En(ne,"change",s[9]),En(de,"change",s[11]),En(E,"submit",Ys(s[6]))],b=!0)},p(Be,[M]){M&1&&_n(be,Be[0]),M&2&&(ie.checked=Be[1]),M&4&&(ne.checked=ne.__value===Be[2]),M&4&&(de.checked=de.__value===Be[2]),M&8&&Qs(ze,Be[3]),Be[2]==="gpt"?R?R.p(Be,M):(R=Tr(),R.c(),R.m(E,Qe)):R&&(R.d(1),R=null),Be[4]&&Be[5]?se?se.p(Be,M):(se=Br(Be),se.c(),se.m(E,null)):se&&(se.d(1),se=null)},i:tn,o:tn,d(Be){Be&&tt(c),R&&R.d(),se&&se.d(),C.r(),b=!1,di(Re)}}}const wl="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function yl(s,c,f){let x="",k=!1,F="gpt",T="",E="",z=!1;const te=()=>{var G;return typeof navigator<"u"&&!!((G=navigator.clipboard)!=null&&G.writeText)};function ce(G){const Z=G||"[DOMAIN]",Me=k?"series":"map",pe=bl.replaceAll("[DOMAIN NAME]",Z).replaceAll("[DOMAIN]",Z).replaceAll("[map|series]",Me).split(`
`),ae=`Generate a **blockscape ${Me}** for the domain of ${Z}.`,we=pe.findIndex(ye=>ye.toLowerCase().includes("generate a **blockscape value")||ye.toLowerCase().includes("generate a blockscape [map|series]")||ye.toLowerCase().startsWith("generate a blockscape"));we>=0?pe[we]=ae:pe.unshift(ae);const fe=k?`

User requested a series (return an array of models).`:"";return`${pe.join(`
`).trim()}${fe}`}async function K(G){G.preventDefault();const Z=x.trim();if(f(3,T=""),f(5,z=F!=="gpt"),!Z){f(3,T="Add a domain to generate a prompt."),f(4,E="");return}if(F==="gpt"?f(4,E=`${k?"Create a series":"Create a map"} for ${Z}`):(f(4,E=ce(Z)),f(5,z=!0)),!te()){f(3,T="Clipboard access is unavailable. Copy the prompt below."),f(5,z=!0);return}try{await navigator.clipboard.writeText(E),f(3,T=F==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),F==="gpt"&&f(5,z=!1)}catch(O){console.warn("[Blockscape] clipboard write failed",O),f(3,T="Copy failed. Use the prompt below."),f(5,z=!0)}}const he=[[]];function be(){x=this.value,f(0,x)}function Ue(){k=this.checked,f(1,k)}function q(){F=this.__value,f(2,F)}function Y(){F=this.__value,f(2,F)}function ie(){E=this.value,f(4,E)}return[x,k,F,T,E,z,K,be,Ue,q,he,Y,ie]}class El extends Lo{constructor(c){super(),Ao(this,c,yl,vl,Io,{})}}const{document:$r}=Ks;function _l(s){let c,f,x,k,F,T,E,z,te,ce,K,he,be,Ue,q,Y,ie,G,Z,Me,O,pe,ae,we,fe,ye,ne,Fe,ot,ke,V,de,Ge,me,Ie,je,Je,Pe,ue,ze,Ct,Qe,C,b,Re,R,se,Be,M,Ee,$e,Oe,Xt,gt,$t,rt,It,Ke,Ot,xt,un,Zt,Mt,bt,dt,Xe,Pt,Rt,yt,At,nn=`<script id="seed" type="application/json">${s[1]}<\/script>`,Lt,Vt,Ut,ut,l,u,S,_,g,A,H,U,oe;return _=new gl({}),A=new El({}),{c(){c=$("link"),f=X(),x=$("div"),k=$("header"),F=$("div"),T=$("div"),E=$("div"),z=$("div"),z.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',te=X(),ce=$("div"),K=$("div"),he=$("button"),be=$("span"),be.textContent="Toggle search and edit tools",Ue=X(),q=$("span"),q.textContent="▾",Y=X(),ie=$("button"),ie.textContent="New",G=X(),Z=$("form"),Z.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',Me=X(),O=$("label"),O.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',pe=X(),ae=$("button"),ae.textContent="Help",we=X(),fe=$("div"),ye=$("div"),ye.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',ne=X(),Fe=$("button"),Fe.textContent="Edit",ot=X(),ke=$("button"),ke.textContent="Share",me=X(),Ie=$("div"),Ie.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',je=X(),Je=$("main"),Pe=$("div"),ue=$("aside"),ze=$("div"),ze.textContent="Models",Ct=X(),Qe=$("ul"),C=X(),b=$("div"),b.innerHTML='<button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button>',Re=X(),R=$("section"),se=$("div"),se.textContent="Local files",Be=X(),M=$("p"),M.textContent="Checking for local server…",Ee=X(),$e=$("div"),Oe=$("label"),Oe.textContent="Blockscape files under ~/blockscape",Xt=X(),gt=$("div"),$t=$("label"),$t.textContent="Folder",rt=X(),It=$("select"),Ke=$("option"),Ke.textContent="All (~/blockscape)",Ot=X(),xt=$("select"),un=X(),Zt=$("div"),Zt.innerHTML='<button id="refreshLocalFiles" class="pf-v5-c-button pf-m-tertiary" type="button">Refresh</button> <button id="loadLocalFile" class="pf-v5-c-button pf-m-secondary" type="button">Load</button>',Mt=X(),bt=$("div"),bt.innerHTML='<label for="localSavePath">Save active map to ~/blockscape</label> <input id="localSavePath" class="pf-v5-c-form-control" type="text" placeholder="my-map.bs"/> <button id="saveLocalFile" class="pf-v5-c-button pf-m-primary" type="button">Save</button>',dt=X(),Xe=$("div"),Xe.innerHTML=`<section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section>`,Pt=X(),Rt=$("footer"),Rt.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',yt=X(),At=new el(!1),Lt=X(),Vt=Pr("svg"),Ut=X(),ut=$("div"),l=X(),u=$("div"),u.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',S=X(),xr(_.$$.fragment),g=X(),xr(A.$$.fragment),$r.title="Blockscape — simple landscape-style tiles",m(c,"rel","icon"),m(c,"type","image/svg+xml"),m(c,"href","./favicon.svg"),m(z,"class","blockscape-brand"),m(be,"class","sr-only"),m(q,"class","blockscape-toolbar__toggle-icon"),m(q,"aria-hidden","true"),m(he,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),m(he,"type","button"),m(he,"aria-expanded",s[0]),m(he,"aria-controls","blockscapeHeaderExtras"),m(ie,"id","newPanelButton"),m(ie,"class","pf-v5-c-button pf-m-primary"),m(ie,"type","button"),m(ie,"title","Create something new"),m(Z,"id","urlForm"),m(Z,"class","blockscape-url-form"),m(Z,"autocomplete","on"),Z.noValidate=!0,m(O,"class","pf-v5-c-button pf-m-primary blockscape-file"),m(ae,"id","helpButton"),m(ae,"class","pf-v5-c-button pf-m-primary"),m(ae,"type","button"),m(ae,"title","Show keyboard shortcuts"),m(K,"class","blockscape-toolbar__primary"),m(ye,"class","blockscape-search"),m(Fe,"id","openInEditor"),m(Fe,"class","pf-v5-c-button pf-m-secondary"),m(Fe,"type","button"),m(Fe,"title","Open current JSON in the editor"),m(ke,"id","shareModel"),m(ke,"class","pf-v5-c-button pf-m-secondary"),m(ke,"type","button"),m(ke,"title","Copy a shareable URL for this model"),m(fe,"id","blockscapeHeaderExtras"),m(fe,"class","blockscape-toolbar__extras"),fe.hidden=V=!s[0],m(fe,"aria-hidden",de=!s[0]),m(ce,"class","blockscape-toolbar__controls"),m(ce,"data-expanded",Ge=s[0]?"true":"false"),m(Ie,"class","blockscape-legend"),m(Ie,"role","presentation"),m(E,"class","blockscape-toolbar"),m(T,"class","pf-v5-c-masthead__content"),m(F,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),m(k,"class","pf-v5-c-page__header"),m(ze,"class","sidebar-heading"),m(Qe,"id","modelList"),m(Qe,"class","model-nav-list"),m(b,"class","model-actions"),m(se,"class","sidebar-heading"),m(M,"id","localBackendStatus"),m(M,"class","local-backend__status muted"),m(Oe,"class","sr-only"),m(Oe,"for","localFileList"),m($t,"for","localDirSelect"),Ke.__value="",_n(Ke,Ke.__value),m(It,"id","localDirSelect"),m(It,"class","pf-v5-c-form-control"),m(It,"aria-label","Folder filter"),m(gt,"class","local-backend__dir"),m(xt,"id","localFileList"),m(xt,"class","pf-v5-c-form-control"),m(xt,"size","12"),xt.multiple=!0,m(xt,"aria-label","Blockscape files on local server"),m(Zt,"class","local-backend__actions"),m($e,"class","local-backend__list"),m(bt,"class","local-backend__save"),m(R,"id","localBackendPanel"),m(R,"class","local-backend"),R.hidden=!0,m(ue,"class","blockscape-sidebar"),m(ue,"aria-label","Models"),m(Xe,"class","blockscape-main"),m(Pe,"class","blockscape-content"),m(Je,"class","pf-v5-c-page__main"),m(Rt,"class","pf-v5-c-page__footer blockscape-footer"),m(x,"class","pf-v5-c-page"),At.a=Lt,m(Vt,"id","overlay"),m(Vt,"class","svg-layer"),m(ut,"id","tabTooltip"),m(ut,"class","blockscape-tab-tooltip"),ut.hidden=!0,m(ut,"aria-hidden","true"),m(u,"id","itemPreview"),m(u,"class","item-preview"),u.hidden=!0,m(u,"aria-hidden","true")},m(D,W){y($r.head,c),ct(D,f,W),ct(D,x,W),y(x,k),y(k,F),y(F,T),y(T,E),y(E,z),y(E,te),y(E,ce),y(ce,K),y(K,he),y(he,be),y(he,Ue),y(he,q),y(K,Y),y(K,ie),y(K,G),y(K,Z),y(K,Me),y(K,O),y(K,pe),y(K,ae),y(ce,we),y(ce,fe),y(fe,ye),y(fe,ne),y(fe,Fe),y(fe,ot),y(fe,ke),y(E,me),y(E,Ie),y(x,je),y(x,Je),y(Je,Pe),y(Pe,ue),y(ue,ze),y(ue,Ct),y(ue,Qe),y(ue,C),y(ue,b),y(ue,Re),y(ue,R),y(R,se),y(R,Be),y(R,M),y(R,Ee),y(R,$e),y($e,Oe),y($e,Xt),y($e,gt),y(gt,$t),y(gt,rt),y(gt,It),y(It,Ke),y($e,Ot),y($e,xt),y($e,un),y($e,Zt),y(R,Mt),y(R,bt),y(Pe,dt),y(Pe,Xe),y(x,Pt),y(x,Rt),ct(D,yt,W),At.m(nn,D,W),ct(D,Lt,W),ct(D,Vt,W),ct(D,Ut,W),ct(D,ut,W),ct(D,l,W),ct(D,u,W),ct(D,S,W),So(_,D,W),ct(D,g,W),So(A,D,W),H=!0,U||(oe=En(he,"click",s[2]),U=!0)},p(D,[W]){(!H||W&1)&&m(he,"aria-expanded",D[0]),(!H||W&1&&V!==(V=!D[0]))&&(fe.hidden=V),(!H||W&1&&de!==(de=!D[0]))&&m(fe,"aria-hidden",de),(!H||W&1&&Ge!==(Ge=D[0]?"true":"false"))&&m(ce,"data-expanded",Ge)},i(D){H||(ko(_.$$.fragment,D),ko(A.$$.fragment,D),H=!0)},o(D){Ir(_.$$.fragment,D),Ir(A.$$.fragment,D),H=!1},d(D){D&&(tt(f),tt(x),tt(yt),At.d(),tt(Lt),tt(Vt),tt(Ut),tt(ut),tt(l),tt(u),tt(S),tt(g)),tt(c),Co(_,D),Co(A,D),U=!1,oe()}}}function kl(s,c,f){const x=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let k=!1;const F=()=>{if(f(0,k=!k),!k){const T=document.getElementById("search");T&&T.value&&(T.value="",T.dispatchEvent(new Event("input",{bubbles:!0})))}};return nl(()=>{ml()}),[k,x,F]}class Sl extends Lo{constructor(c){super(),Ao(this,c,kl,_l,Io,{})}}const Cl=document.getElementById("root");new Sl({target:Cl});
