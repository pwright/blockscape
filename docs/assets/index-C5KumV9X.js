var js=Object.defineProperty;var Js=(s,c,p)=>c in s?js(s,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):s[c]=p;var Zt=(s,c,p)=>Js(s,typeof c!="symbol"?c+"":c,p);(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))I(E);new MutationObserver(E=>{for(const R of E)if(R.type==="childList")for(const B of R.addedNodes)B.tagName==="LINK"&&B.rel==="modulepreload"&&I(B)}).observe(document,{childList:!0,subtree:!0});function p(E){const R={};return E.integrity&&(R.integrity=E.integrity),E.referrerPolicy&&(R.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?R.credentials="include":E.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function I(E){if(E.ep)return;E.ep=!0;const R=p(E);fetch(E.href,R)}})();function Gt(){}function Br(s){return s()}function Er(){return Object.create(null)}function ai(s){s.forEach(Br)}function $r(s){return typeof s=="function"}function So(s,c){return s!=s?c==c:s!==c||s&&typeof s=="object"||typeof s=="function"}function Ws(s){return Object.keys(s).length===0}const qs=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function N(s,c){s.appendChild(c)}function rt(s,c,p){s.insertBefore(c,p||null)}function Ke(s){s.parentNode&&s.parentNode.removeChild(s)}function H(s){return document.createElement(s)}function Or(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Io(s){return document.createTextNode(s)}function se(){return Io(" ")}function fn(s,c,p,I){return s.addEventListener(c,p,I),()=>s.removeEventListener(c,p,I)}function Gs(s){return function(c){return c.preventDefault(),s.call(this,c)}}function w(s,c,p){p==null?s.removeAttribute(c):s.getAttribute(c)!==p&&s.setAttribute(c,p)}function zs(s){let c;return{p(...p){c=p,c.forEach(I=>s.push(I))},r(){c.forEach(p=>s.splice(s.indexOf(p),1))}}}function Ks(s){return Array.from(s.childNodes)}function Ys(s,c){c=""+c,s.data!==c&&(s.data=c)}function Nn(s,c){s.value=c??""}class Xs{constructor(c=!1){Zt(this,"is_svg",!1);Zt(this,"e");Zt(this,"n");Zt(this,"t");Zt(this,"a");this.is_svg=c,this.e=this.n=null}c(c){this.h(c)}m(c,p,I=null){this.e||(this.is_svg?this.e=Or(p.nodeName):this.e=H(p.nodeType===11?"TEMPLATE":p.nodeName),this.t=p.tagName!=="TEMPLATE"?p:p.content,this.c(c)),this.i(I)}h(c){this.e.innerHTML=c,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(c){for(let p=0;p<this.n.length;p+=1)rt(this.t,this.n[p],c)}p(c){this.d(),this.h(c),this.i(this.a)}d(){this.n.forEach(Ke)}}let ri;function oi(s){ri=s}function Zs(){if(!ri)throw new Error("Function called outside component initialization");return ri}function Qs(s){Zs().$$.on_mount.push(s)}const Ln=[],_r=[];let Tn=[];const kr=[],el=Promise.resolve();let wo=!1;function tl(){wo||(wo=!0,el.then(Mr))}function yo(s){Tn.push(s)}const ho=new Set;let Cn=0;function Mr(){if(Cn!==0)return;const s=ri;do{try{for(;Cn<Ln.length;){const c=Ln[Cn];Cn++,oi(c),nl(c.$$)}}catch(c){throw Ln.length=0,Cn=0,c}for(oi(null),Ln.length=0,Cn=0;_r.length;)_r.pop()();for(let c=0;c<Tn.length;c+=1){const p=Tn[c];ho.has(p)||(ho.add(p),p())}Tn.length=0}while(Ln.length);for(;kr.length;)kr.pop()();wo=!1,ho.clear(),oi(s)}function nl(s){if(s.fragment!==null){s.update(),ai(s.before_update);const c=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,c),s.after_update.forEach(yo)}}function il(s){const c=[],p=[];Tn.forEach(I=>s.indexOf(I)===-1?c.push(I):p.push(I)),p.forEach(I=>I()),Tn=c}const Ai=new Set;let ol;function Eo(s,c){s&&s.i&&(Ai.delete(s),s.i(c))}function Sr(s,c,p,I){if(s&&s.o){if(Ai.has(s))return;Ai.add(s),ol.c.push(()=>{Ai.delete(s)}),s.o(c)}}function Ir(s){s&&s.c()}function _o(s,c,p){const{fragment:I,after_update:E}=s.$$;I&&I.m(c,p),yo(()=>{const R=s.$$.on_mount.map(Br).filter($r);s.$$.on_destroy?s.$$.on_destroy.push(...R):ai(R),s.$$.on_mount=[]}),E.forEach(yo)}function ko(s,c){const p=s.$$;p.fragment!==null&&(il(p.after_update),ai(p.on_destroy),p.fragment&&p.fragment.d(c),p.on_destroy=p.fragment=null,p.ctx=[])}function rl(s,c){s.$$.dirty[0]===-1&&(Ln.push(s),tl(),s.$$.dirty.fill(0)),s.$$.dirty[c/31|0]|=1<<c%31}function Co(s,c,p,I,E,R,B=null,y=[-1]){const q=ri;oi(s);const X=s.$$={fragment:null,ctx:[],props:R,update:Gt,not_equal:E,bound:Er(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(c.context||(q?q.$$.context:[])),callbacks:Er(),dirty:y,skip_bound:!1,root:c.target||q.$$.root};B&&B(X.root);let le=!1;if(X.ctx=p?p(s,c.props||{},(G,he,...ge)=>{const Ve=ge.length?ge[0]:he;return X.ctx&&E(X.ctx[G],X.ctx[G]=Ve)&&(!X.skip_bound&&X.bound[G]&&X.bound[G](Ve),le&&rl(s,G)),he}):[],X.update(),le=!0,ai(X.before_update),X.fragment=I?I(X.ctx):!1,c.target){if(c.hydrate){const G=Ks(c.target);X.fragment&&X.fragment.l(G),G.forEach(Ke)}else X.fragment&&X.fragment.c();c.intro&&Eo(s.$$.fragment),_o(s,c.target,c.anchor),Mr()}oi(q)}class xo{constructor(){Zt(this,"$$");Zt(this,"$$set")}$destroy(){ko(this,1),this.$destroy=Gt}$on(c,p){if(!$r(p))return Gt;const I=this.$$.callbacks[c]||(this.$$.callbacks[c]=[]);return I.push(p),()=>{const E=I.indexOf(p);E!==-1&&I.splice(E,1)}}$set(c){this.$$set&&!Ws(c)&&(this.$$.skip_bound=!0,this.$$set(c),this.$$.skip_bound=!1)}}const al="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(al);const Cr="blockscape:apicurioConfig",go="http://localhost:8080/apis/registry/v3",Ci="bs",xr="-series",bo=!1,vo=!1;function sl({models:s,getActiveIndex:c,setActive:p,ensureModelMetadata:I,ensureSeriesId:E,getModelId:R,getSeriesId:B,getModelTitle:y,computeJsonFingerprint:q,uid:X}){let le=null,G=null,he=null,ge=null,Ve=null,D=null,z=null,Q=null,J=null,K=null;const $e=new Set,$={baseUrl:go,groupId:Ci,authToken:"",enabled:bo,useSemver:vo},ue=new Map,re=new Map;function we(l){return(l||"").toString().trim().replace(/\/+$/,"")}function pe(l){return`${(l||"").toString().trim()||Ci}${xr}`}function _e(){return!!($.baseUrl&&$.groupId)}function Z(){return $.enabled!==!1}function He(){$e.forEach(l=>{try{l(Z())}catch(f){console.warn("[Blockscape] failed to run Apicurio enabled listener",f)}})}function Ze(l){return typeof l=="function"&&$e.add(l),()=>$e.delete(l)}function ke(){he&&(he.value=$.baseUrl||""),ge&&(ge.value=$.groupId||""),Ve&&(Ve.value=$.authToken||""),D&&(D.checked=Z()),z&&(z.checked=!!$.useSemver)}function M(l="",f="muted"){Q&&(Q.textContent=l||"",Q.classList.remove("is-error","is-success"),f==="error"?Q.classList.add("is-error"):f==="success"&&Q.classList.add("is-success"))}function ce(l){if(!K||(K.innerHTML="",!l))return;const f=document.createElement("p");f.className="apicurio-hint",f.textContent=l,K.appendChild(f)}function qe(l){ue.clear(),re.clear(),ce(l)}function ye(){const l=c(),f=Z(),k=_e(),_=l>=0?s[l]:null,m=!!(_!=null&&_.apicurioVersions&&_.apicurioVersions.length>1);if(le){const T=le.dataset.loading==="true",j=f&&k&&l>=0&&!!W(s[l]);le.disabled=!f||T||!j,f?T||(le.textContent="Push to Apicurio"):le.textContent="Enable Apicurio to push"}if(J){const T=J.dataset.loading==="true",j=f&&k&&m&&!!W(_);J.disabled=!j||T,J.hidden=!m,f?T||(J.textContent="Push series"):J.textContent="Enable Apicurio to push series"}if(G){const T=G.dataset.loading==="true",j=f&&k;G.disabled=!j||T,T||(f?k?G.textContent="List artifacts":G.textContent="Enter details to list":G.textContent="Enable Apicurio to list")}}function De(){ke(),Z()?_e()?(M("Apicurio push is ready when a model is selected.","muted"),ue.size||ce("Click “List artifacts” to browse the current group.")):(M("Enter Apicurio connection details to enable push.","muted"),qe("Enter registry details to browse artifacts.")):(M("Apicurio integration is off. Enable it to allow pushes.","muted"),qe("Apicurio integration is disabled.")),ye()}function je(){if(window!=null&&window.localStorage)try{localStorage.setItem(Cr,JSON.stringify($))}catch(l){console.warn("[Blockscape] unable to persist Apicurio settings",l)}}function Je(){let l={};if(window!=null&&window.localStorage)try{const T=localStorage.getItem(Cr);if(T){const j=JSON.parse(T);j&&typeof j=="object"&&(l=j)}}catch(T){console.warn("[Blockscape] failed to restore Apicurio settings",T)}const f=we(l.baseUrl??go),k=(l.groupId??Ci).toString().trim();let _=bo,m=vo;typeof l.enabled=="boolean"?_=l.enabled:typeof l.enabled=="string"&&(_=l.enabled==="true"),typeof l.useSemver=="boolean"?m=l.useSemver:typeof l.useSemver=="string"&&(m=l.useSemver==="true"),$.baseUrl=f||go,$.groupId=k||Ci,$.authToken=(l.authToken??"").toString().trim(),$.enabled=_,$.useSemver=m,De(),He()}function Oe(){const l={Accept:"application/json"},f=($.authToken||"").trim();return f&&(l.Authorization=/\s/.test(f)?f:`Bearer ${f}`),l}function Ne(l,f,{title:k,description:_,version:m}={}){const T={artifactId:l,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:f},metadata:{properties:{}}}};m&&(T.firstVersion.version=m),k&&(T.name=k),_&&(T.description=_);try{const j=JSON.parse(f),P=j==null?void 0:j.seriesId;P&&typeof P=="string"&&(T.firstVersion.metadata.properties.seriesId=P)}catch{}return T}function at(l,{version:f}={}){const k={content:{contentType:"application/json",content:l},metadata:{properties:{}}};try{const _=JSON.parse(l),m=_==null?void 0:_.seriesId;m&&typeof m=="string"&&(k.metadata.properties.seriesId=m)}catch{}return f&&(k.version=f),k}function dt(l){if(l==null)return null;const f=String(l).trim();if(!f)return null;const k=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(f);if(k)return{major:Number(k[1]),minor:Number(k[2]),patch:Number(k[3])};const _=/^v?(\d+)$/.exec(f);return _?{major:Number(_[1]),minor:0,patch:0}:null}function S(l){return`${l.major}.${l.minor}.${l.patch}`}function v(l,f){return!l&&!f?0:l?f?l.major!==f.major?l.major-f.major:l.minor!==f.minor?l.minor-f.minor:l.patch-f.patch:1:-1}function Se(l=[]){let f=null;if(l.forEach(_=>{const m=dt((_==null?void 0:_.version)??_);m&&(!f||v(m,f)>0)&&(f=m)}),!f)return"1.0.0";const k={...f,patch:f.patch+1};return S(k)}function W(l,{seriesName:f,fallbackTitle:k}={}){var T;if(!l)return null;const _=f||l.title||l.apicurioArtifactName||y(l),m=k||_;if(typeof E=="function"&&(l.isSeries||((T=l.apicurioVersions)==null?void 0:T.length)>1)&&E(l,{seriesName:_,fallbackTitle:m}),typeof B=="function"){const j=B(l,{seriesName:_,fallbackTitle:m});if(j)return j}return R(l)}function ne(l){return Array.isArray(l)?l:Array.isArray(l==null?void 0:l.artifacts)?l.artifacts:Array.isArray(l==null?void 0:l.items)?l.items:Array.isArray(l==null?void 0:l.results)?l.results:[]}function Te(l){return Array.isArray(l)?l:Array.isArray(l==null?void 0:l.versions)?l.versions:Array.isArray(l==null?void 0:l.items)?l.items:[]}function L(l=[]){if(!Array.isArray(l)||!l.length)return null;const f=[...l].filter(Boolean);return f.sort((k,_)=>{const m=k!=null&&k.createdOn?new Date(k.createdOn).getTime():0,T=_!=null&&_.createdOn?new Date(_.createdOn).getTime():0;if(m!==T)return T-m;const j=Number(k==null?void 0:k.version),P=Number(_==null?void 0:_.version),ae=Number.isFinite(j),ee=Number.isFinite(P);if(ae&&ee&&j!==P)return P-j;const ie=String((k==null?void 0:k.version)??"");return String((_==null?void 0:_.version)??"").localeCompare(ie,void 0,{numeric:!0})}),f[0]||null}function oe(l){if(!l)return l;let f=l;if(!Array.isArray(l==null?void 0:l.categories)){const _=l==null?void 0:l.content;if(typeof _=="string")try{f=JSON.parse(_)}catch(m){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",m)}else _&&typeof _=="object"&&(f=_)}return f}async function Fe(l,f,k){const _=encodeURIComponent(f),m=encodeURIComponent(k),T=`${l}/groups/${_}/artifacts/${m}`,j=Oe();j.Accept="application/json";const P=await fetch(T,{method:"GET",headers:j});if(!P.ok){let ae=P.statusText||"Unknown error";try{const ee=await P.text();ee&&(ae=ee.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${P.status}): ${ae}`)}return P.json()}async function Be(l,f,k){const _=encodeURIComponent(f),m=encodeURIComponent(k),T=`${l}/groups/${_}/artifacts/${m}/versions?limit=50&order=desc`,j=Oe();j.Accept="application/json";const P=await fetch(T,{method:"GET",headers:j});if(!P.ok){let ee=P.statusText||"Unknown error";try{const ie=await P.text();ie&&(ee=ie.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${P.status}): ${ee}`)}const ae=await P.json();return Te(ae).filter(ee=>ee&&ee.version!=null)}async function ft(l,f,k,_="latest"){const m=encodeURIComponent(f),T=encodeURIComponent(k),j=encodeURIComponent(_||"latest"),P=`${l}/groups/${m}/artifacts/${T}/versions/${j}/content`,ae=Oe();ae.Accept="application/json, application/*+json, */*;q=0.8";const ee=await fetch(P,{method:"GET",headers:ae});if(!ee.ok){let We=ee.statusText||"Unknown error";try{const me=await ee.text();me&&(We=me.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${ee.status}): ${We}`)}const ie=await ee.text();let be=null;try{be=JSON.parse(ie)}catch{throw new Error("Artifact content is not valid JSON.")}return oe(be)}async function Qe(l,f,k,_="latest"){const m=await ft(l,f,k,_);return{data:m,fingerprint:q(m)}}async function Ot(l,f,k){try{const m=await Be(l,f,k);if(m!=null&&m.length){re.set(k,m);const T=L(m);if((T==null?void 0:T.version)!=null)return T.version}}catch(m){console.warn("[Blockscape] compare-version: unable to fetch versions list",m)}try{const m=await Fe(l,f,k);if((m==null?void 0:m.version)!=null)return m.version}catch(m){console.warn("[Blockscape] compare-version: unable to fetch metadata",m)}const _=re.get(k);if(_&&_.length){const m=L(_);if((m==null?void 0:m.version)!=null)return m.version}return"latest"}async function Ye(l,f,k,_){if(!$.useSemver)return null;if(!_)return"1.0.0";try{const m=await Be(l,f,k);return Se(m)}catch(m){throw new Error(`Unable to compute next semantic version: ${m.message}`)}}function fe(l=document){le=l.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),J=l.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),G=l.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),he=l.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),ge=l.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),Ve=l.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),D=l.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),z=l.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),Q=l.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),K=l.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function Ee(){$.baseUrl=we((he==null?void 0:he.value)??$.baseUrl),$.groupId=((ge==null?void 0:ge.value)??"").trim(),$.authToken=((Ve==null?void 0:Ve.value)??"").trim(),je(),De()}function Ut(l){$.enabled=l!==!1,je(),De(),He()}function si(){Ut(D?D.checked:bo)}function li(){$.useSemver=z?z.checked:vo,je(),De()}function ci(){[he,ge,Ve].forEach(l=>{l&&l.addEventListener("input",Ee)}),le&&le.addEventListener("click",()=>{tn()}),J&&J.addEventListener("click",()=>{Bn()}),D&&D.addEventListener("change",si),z&&z.addEventListener("change",li),G&&G.addEventListener("click",nn),K&&K.addEventListener("click",l=>{const f=l.target.closest("[data-artifact-version]");if(f){l.stopPropagation();const m=f.dataset.artifactId,T=f.dataset.artifactVersion;m&&T&&on(m,T);return}const k=l.target.closest("[data-artifact-load-all]");if(k){l.stopPropagation(),k.dataset.artifactId&&$n();return}const _=l.target.closest("[data-artifact-trigger]");if(_){const m=_.dataset.artifactId;if(!m)return;Dt(m)}})}function zt(){const l=document.createElement("div");return l.className="blockscape-registry-panel",l.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,l}function Ht(l){if(!l)return;l.innerHTML="";const f=zt();l.appendChild(f),fe(l),ci(),De()}function _t(l){if(!K)return;if(K.innerHTML="",!l.length){ce("No artifacts found in this group.");return}const f=m=>{const T=document.createElement("section");T.className="apicurio-artifact-section";const j=document.createElement("h3");j.textContent=m,T.appendChild(j);const P=document.createElement("ul");return P.className="apicurio-artifact-list",T.appendChild(P),{section:T,list:P}},k=f("Series artifacts"),_=f("Artifacts");l.forEach(m=>{if(!(m!=null&&m.artifactId))return;const j=m._groupId&&m._groupId.endsWith(xr)?k.list:_.list,P=document.createElement("li"),ae=document.createElement("button");ae.type="button",ae.className="apicurio-artifact",ae.dataset.artifactId=m.artifactId,ae.dataset.artifactTrigger="toggle";const ee=document.createElement("span");ee.className="apicurio-artifact-title",ee.textContent=m.artifactId,ae.appendChild(ee);const ie=[];if(m.name&&ie.push(m.name),m.version!=null&&ie.push(`v${m.version}`),m.type&&ie.push(m.type),m._groupId&&ie.push(m._groupId),ie.length){const me=document.createElement("span");me.className="apicurio-artifact-meta",me.textContent=ie.join(" • "),ae.appendChild(me)}if(m.description){const me=document.createElement("span");me.className="apicurio-artifact-meta",me.textContent=m.description,ae.appendChild(me)}P.appendChild(ae);const be=document.createElement("div");be.className="apicurio-version-list",be.dataset.versionPanel=m.artifactId,be.hidden=!0;const We=document.createElement("p");We.className="apicurio-hint",We.textContent="Click to load the latest or open versions.",be.appendChild(We),P.appendChild(be),j.appendChild(P)}),k.list.children.length&&K.appendChild(k.section),_.list.children.length&&K.appendChild(_.section)}function vt(l){return K?K.querySelector(`[data-version-panel="${l}"]`):null}function kt(l,f){if(!l||(l.innerHTML="",!f))return;const k=document.createElement("p");k.className="apicurio-hint",k.textContent=f,l.appendChild(k)}function mn(l,f){const k=vt(l);if(k){if(k.innerHTML="",!f.length){kt(k,"No versions found for this artifact.");return}f.forEach(_=>{const m=document.createElement("button");m.type="button",m.className="apicurio-version-button",m.dataset.artifactId=l,m.dataset.artifactVersion=_.version;const T=[`Version ${_.version}`];if(_.createdOn){const j=new Date(_.createdOn);isNaN(j)||T.push(j.toISOString().slice(0,10))}m.textContent=T.join(" — "),k.appendChild(m)})}}async function Dt(l){const f=vt(l);if(!f)return;if(f.dataset.open==="true"){f.hidden=!0,f.dataset.open="false";return}if(f.hidden=!1,f.dataset.open="true",f.dataset.loaded!=="true"){if(!_e()){kt(f,"Enter registry details first.");return}kt(f,"Loading versions…");try{const _=we($.baseUrl),m=ue.get(l),T=$.groupId.trim(),j=(m==null?void 0:m._groupId)||T,P=await Be(_,j,l);re.set(l,P),f.dataset.loaded="true",mn(l,P)}catch(_){console.error("[Blockscape] failed to load versions",_),kt(f,`Unable to fetch versions: ${_.message}`)}}}function hn(l,f){var _;const k=s.findIndex(m=>m.apicurioArtifactId===l);if(k!==-1){const m=s[k].id;s[k]={...f,id:m||f.id},((_=s[k].apicurioVersions)==null?void 0:_.length)>1&&(s[k].isSeries=!0),p(k)}else s.push(f),p(s.length-1)}async function en(l,f,k,_){const m=encodeURIComponent(f),T=encodeURIComponent(k),j=`${l}/groups/${m}/artifacts/${T}`;try{const P=await fetch(j,{method:"GET",headers:_});if(P.status===404)return!1;if(P.ok)return!0;throw P.status===401||P.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${P.status} while checking the artifact.`)}catch(P){throw P instanceof TypeError?new Error("Network error while contacting Apicurio registry."):P}}async function tn(){var j;if(!le||le.dataset.loading==="true")return;if(!Z()){M("Apicurio integration is off. Enable it first.","error");return}if(!_e()){M("Enter the registry base URL and group ID before pushing.","error");return}const l=c();if(l<0||!s[l]){M("No active model to push.","error");return}const f=W(s[l],{fallbackTitle:y(s[l])});if(!f){M("Active model needs an id before pushing.","error");return}const k=we($.baseUrl),_=$.groupId.trim(),m=JSON.stringify(s[l].data,null,2),T=Oe();le.dataset.loading="true",le.textContent="Pushing…",le.disabled=!0,M("Pushing to Apicurio…","muted");try{const P=await en(k,_,f,T),ae=q(s[l].data);if(P)try{const Me=await Ot(k,_,f),{data:nt,fingerprint:it}=await Qe(k,_,f,Me);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",Me),console.log("local fingerprint",ae),console.log("registry fingerprint",it),console.log("local payload",s[l].data),console.log("registry payload",nt),console.groupEnd(),ae&&it&&ae===it){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){M("Push cancelled (content matches the latest registry version).","muted");return}M("Pushing identical content by user choice.","muted")}else it?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):M("Unable to compare with registry content (skipping confirmation).","muted")}catch(Me){console.warn("[Blockscape] unable to compare registry content before push",Me),M("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const ee=$.useSemver?await Ye(k,_,f,P):null;if($.useSemver&&!ee)throw new Error("Semantic versioning is enabled but no version could be computed.");const ie=encodeURIComponent(_),be=encodeURIComponent(f),We=P?`${k}/groups/${ie}/artifacts/${be}/versions`:`${k}/groups/${ie}/artifacts`,me={...T,"Content-Type":"application/json"};ee&&(me["X-Registry-Version"]=ee,M(`Pushing to Apicurio as version ${ee}…`,"muted"));const et=P?at(m,{version:ee}):Ne(f,m,{title:y(s[l]),description:(j=s[l].data)==null?void 0:j.abstract,version:ee}),mt=await fetch(We,{method:"POST",headers:me,body:JSON.stringify(et)});if(!mt.ok){let Me=mt.statusText||"Unknown error";try{const nt=await mt.text();nt&&(Me=nt.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${mt.status}): ${Me}`)}let tt=null;try{tt=await mt.json()}catch{tt=null}const ve=(tt==null?void 0:tt.version)||(tt==null?void 0:tt.globalId)||"",Pe=P?"Updated":"Created",wt=ve?` (version ${ve})`:"";M(`${Pe} ${f}${wt}`,"success")}catch(P){console.error("[Blockscape] Apicurio push failed",P),M(`Apicurio push failed: ${P.message}`,"error")}finally{le.dataset.loading="false",ye()}}async function Bn(){var ee,ie;if(!J||J.dataset.loading==="true")return;if(!Z()){M("Apicurio integration is off. Enable it first.","error");return}if(!_e()){M("Enter the registry base URL and group ID before pushing.","error");return}const l=c(),f=l>=0?s[l]:null;if(!f||!f.apicurioVersions||f.apicurioVersions.length<2){M("Series push requires a model with multiple versions.","error");return}const k=W(f,{seriesName:f.title||f.apicurioArtifactName||y(f)});if(!k){M("Active series needs an id before pushing.","error");return}typeof E=="function"&&E(f,{seriesName:f.title||f.apicurioArtifactName||y(f)});const _=we($.baseUrl),m=$.groupId.trim(),T=f.apicurioVersions.map(be=>be.data),j=JSON.stringify(T,null,2),P=Oe(),ae=pe(m);J.dataset.loading="true",J.textContent="Pushing…",J.disabled=!0,M("Pushing series to Apicurio…","muted");try{const be=await en(_,ae,k,P),We=q(T);if(be)try{const ht=await Ot(_,ae,k),{data:Ft,fingerprint:jt}=await Qe(_,ae,k,ht);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",ht),console.log("local fingerprint",We),console.log("registry fingerprint",jt),console.log("local payload (series)",T),console.log("registry payload",Ft),console.groupEnd(),We&&jt&&We===jt){if(!window.confirm("The current registry version matches this series. Push anyway?")){M("Series push cancelled (content matches latest).","muted");return}M("Pushing identical series by user choice.","muted")}else jt?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):M("Unable to compare with registry content (skipping confirmation).","muted")}catch(ht){console.warn("[Blockscape] unable to compare registry content before series push",ht),M("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const me=$.useSemver?await Ye(_,ae,k,be):null;if($.useSemver&&!me)throw new Error("Semantic versioning is enabled but no version could be computed.");const et=encodeURIComponent(ae),mt=encodeURIComponent(k),tt=be?`${_}/groups/${et}/artifacts/${mt}/versions`:`${_}/groups/${et}/artifacts`,ve={...P,"Content-Type":"application/json"};me&&(ve["X-Registry-Version"]=me,M(`Pushing series to Apicurio as version ${me}…`,"muted"));const Pe=be?at(j,{version:me}):Ne(k,j,{title:f.apicurioArtifactName||((ee=f.data)==null?void 0:ee.title)||k,description:(ie=f.data)==null?void 0:ie.abstract,version:me}),wt=await fetch(tt,{method:"POST",headers:ve,body:JSON.stringify(Pe)});if(!wt.ok){let ht=wt.statusText||"Unknown error";try{const Ft=await wt.text();Ft&&(ht=Ft.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${wt.status}): ${ht}`)}let Me=null;try{Me=await wt.json()}catch{Me=null}const nt=(Me==null?void 0:Me.version)||(Me==null?void 0:Me.globalId)||"",it=be?"Updated":"Created",Mt=nt?` (version ${nt})`:"";M(`${it} ${k} series${Mt}`,"success")}catch(be){console.error("[Blockscape] Apicurio series push failed",be),M(`Apicurio series push failed: ${be.message}`,"error")}finally{J.dataset.loading="false",ye()}}async function nn(){if(!G||G.dataset.loading==="true")return;if(!Z()){M("Enable Apicurio integration to list artifacts.","error");return}if(!_e()){M("Enter registry base URL and group ID before listing.","error");return}const l=we($.baseUrl),f=$.groupId.trim(),k=pe(f),_=[{groupId:f,label:"base"},{groupId:k,label:"series"}];G.dataset.loading="true",G.textContent="Listing…",G.disabled=!0,M("Listing artifacts…","muted"),ce("Contacting registry…");try{const m=Oe();m.Accept="application/json";const T=[];for(const P of _){const ae=encodeURIComponent(P.groupId),ee=`${l}/groups/${ae}/artifacts?limit=50&offset=0`,ie=await fetch(ee,{method:"GET",headers:m});if(!ie.ok){let me=ie.statusText||"Unknown error";try{const et=await ie.text();et&&(me=et.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${P.groupId} (${ie.status}): ${me}`);continue}const be=await ie.json(),We=ne(be).filter(me=>me&&me.artifactId);We.forEach(me=>{me&&(me._groupId=P.groupId)}),T.push(...We)}ue.clear(),re.clear(),T.forEach(P=>{P!=null&&P.artifactId&&ue.set(P.artifactId,P)}),_t(T);const j=T.length;M(j?`Found ${j} artifact${j===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",j?"success":"muted")}catch(m){console.error("[Blockscape] failed to list artifacts",m),qe("Unable to list artifacts."),M(`Listing failed: ${m.message}`,"error")}finally{G.dataset.loading="false",ye()}}async function on(l,f=null){var be,We,me,et,mt,tt;if(!l)return;if(!Z()){M("Enable Apicurio integration to load artifacts.","error");return}if(!_e()){M("Enter registry connection details before loading artifacts.","error");return}const k=we($.baseUrl),_=$.groupId.trim(),m=l&&((be=ue.get(l))==null?void 0:be._groupId)||_;let T=ue.get(l);const j=async()=>{try{const ve=await Fe(k,m,l);return ve!=null&&ve.artifactId&&ue.set(l,ve),ve}catch(ve){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",ve),ve}};if(!T)try{T=await j()}catch(ve){M(`Failed to fetch artifact metadata: ${ve.message}`,"error");return}const P=re.get(l)||[];let ae="latest",ee="latest";if(f)ae=f,ee=f;else{if(!T||T.version==null)try{T=await j()}catch(ve){M(`Failed to fetch artifact metadata: ${ve.message}`,"error");return}ae=(T==null?void 0:T.version)||"latest",ee=(T==null?void 0:T.version)||"latest"}const ie=P.find(ve=>String(ve.version)===String(ae));(ie==null?void 0:ie.version)!=null&&(ee=ie.version),M(`Loading artifact ${l}…`,"muted");try{const ve=await ft(k,m,l,ae),Pe=ue.get(l)||T||{},wt=Array.isArray(ve);let Me=null;if(wt){const nt=ve.map((Mt,ht)=>(I(Mt,{titleHint:Pe.name||l,idHint:l}),{version:String(ht+1),data:Mt,createdOn:(ie==null?void 0:ie.createdOn)||Pe.createdOn}));Me={id:X(),title:((me=(We=nt[0])==null?void 0:We.data)==null?void 0:me.title)||Pe.name||l,data:(et=nt[0])==null?void 0:et.data,apicurioArtifactId:l,apicurioArtifactName:Pe.name||"",apicurioVersions:nt,apicurioActiveVersionIndex:0,isSeries:!0};const it=((mt=Pe==null?void 0:Pe.properties)==null?void 0:mt.seriesId)||l;typeof E=="function"&&E(Me,{seriesName:it,fallbackTitle:it}),M(`Loaded series artifact ${l}.`,"success")}else{I(ve,{titleHint:Pe.name||l,idHint:l});const nt={version:ee,data:ve,createdOn:(ie==null?void 0:ie.createdOn)||Pe.createdOn};Me={id:X(),title:ve.title||Pe.name||l,data:ve,apicurioArtifactId:l,apicurioArtifactName:Pe.name||"",apicurioVersions:[nt],apicurioActiveVersionIndex:0};const it=(tt=Pe==null?void 0:Pe.properties)==null?void 0:tt.seriesId;it&&typeof E=="function"&&E(Me,{seriesName:it,fallbackTitle:it});const Mt=ee?` (version ${ee})`:"";M(`Loaded artifact ${l}${Mt}.`,"success")}hn(l,Me)}catch(ve){console.error("[Blockscape] failed to load artifact",ve),M(`Failed to load artifact: ${ve.message}`,"error")}}async function $n(l){}return{hydrateConfig:Je,mount:Ht,updateAvailability:ye,isEnabled:Z,setEnabled:Ut,onEnabledChange:Ze}}function xn(s,c){if(typeof s!="function")throw new Error(`[itemEditor] expected ${c} to be a function`)}function ll(s,{excludeId:c}={}){if(!s)return[];const p=s.split(/[\s,]+/).map(E=>E.trim()).filter(Boolean),I=[];return p.forEach(E=>{c&&E===c||I.includes(E)||I.push(E)}),I}function cl(s,c,p){if(!c||!p||c===p)return;((s==null?void 0:s.categories)||[]).forEach(E=>{(E.items||[]).forEach(R=>{Array.isArray(R.deps)&&(R.deps=R.deps.map(B=>B===c?p:B))})}),Array.isArray(s==null?void 0:s.links)&&s.links.forEach(E=>{E.from===c&&(E.from=p),E.to===c&&(E.to=p)})}function dl({findItemAndCategoryById:s,collectAllItemIds:c,updateItemReferences:p,loadActiveIntoEditor:I,rebuildFromActive:E,select:R,onSelectionRenamed:B}={}){xn(s,"findItemAndCategoryById"),xn(c,"collectAllItemIds"),xn(p,"updateItemReferences"),xn(I,"loadActiveIntoEditor"),xn(E,"rebuildFromActive"),xn(R,"select");const y={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function q(D){if(y.fields.errorEl){if(!D){y.fields.errorEl.hidden=!0,y.fields.errorEl.textContent="";return}y.fields.errorEl.hidden=!1,y.fields.errorEl.textContent=D}}function X(){y.wrapper&&(y.wrapper.hidden=!0,y.wrapper.setAttribute("aria-hidden","true"),q(""),y.categoryId=null,y.itemId=null,y.modelData=null,document.body.classList.remove("item-editor-open"))}function le(){y.wrapper&&(y.wrapper.hidden=!1,y.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var D,z;(D=y.fields.nameInput)==null||D.focus(),(z=y.fields.nameInput)==null||z.select()}))}function G(D){var we;if(!y.modelData||!y.categoryId||!y.itemId)throw new Error("No item loaded.");const Q=(((we=y.modelData)==null?void 0:we.categories)||[]).find(pe=>pe.id===y.categoryId);if(!Q)throw new Error("Category not found.");Q.items=Q.items||[];const J=Q.items.find(pe=>pe.id===y.itemId);if(!J)throw new Error("Item not found.");const K=(D.id||"").trim();if(!K)throw new Error("ID is required.");const $e=c(y.modelData);if(K!==J.id&&$e.has(K))throw new Error("Another item already uses that ID.");J.id=K;const $=(D.name||"").trim();J.name=$||J.id;const ue=(D.logo||"").trim();if(ue?J.logo=ue:delete J.logo,D.externalFlag&&!D.external)J.external=!0;else{const pe=(D.external??"").toString().trim();pe?J.external=pe:delete J.external}const re=(D.color||"").trim();return re?J.color=re:delete J.color,J.deps=Array.isArray(D.deps)?D.deps:[],J.id!==D.originalId&&typeof B=="function"&&B(D.originalId,J.id),p(y.modelData,D.originalId,J.id),I(),E(),R(J.id),J.id}function he(){if(!y.fields||!y.fields.idInput)return!1;const D=(y.fields.idInput.value||"").trim(),z={originalId:y.itemId,id:D,name:y.fields.nameInput.value||"",logo:y.fields.logoInput.value||"",external:y.fields.externalInput.value||"",externalFlag:y.fields.externalFlagInput.checked,color:y.fields.colorInput.value||"",deps:ll(y.fields.depsInput.value,{excludeId:D})};try{return G(z),X(),!0}catch(Q){return console.warn("[itemEditor] item edit failed",Q),q((Q==null?void 0:Q.message)||"Unable to save item."),!1}}function ge(){if(y.wrapper)return y.wrapper;const D=document.createElement("div");D.className="item-editor-modal",D.hidden=!0,D.setAttribute("role","dialog"),D.setAttribute("aria-modal","true");const z=document.createElement("div");z.className="item-editor-modal__backdrop",D.appendChild(z);const Q=document.createElement("div");Q.className="item-editor",D.appendChild(Q);const J=document.createElement("div");J.className="item-editor__header";const K=document.createElement("h2");K.className="item-editor__title",K.textContent="Edit item";const $e=document.createElement("button");$e.type="button",$e.className="item-editor__close",$e.setAttribute("aria-label","Close item editor"),$e.textContent="×",J.appendChild(K),J.appendChild($e),Q.appendChild(J);const $=document.createElement("form");$.className="item-editor__form",Q.appendChild($);const ue=document.createElement("div");ue.className="item-editor__meta",ue.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',$.appendChild(ue);const re=document.createElement("div");re.className="item-editor__error",re.hidden=!0,$.appendChild(re);const we=(Ne,at,dt)=>{const S=document.createElement("label");S.className="item-editor__field";const v=document.createElement("span");if(v.className="item-editor__label",v.textContent=Ne,S.appendChild(v),at.classList.add("item-editor__control"),S.appendChild(at),dt){const Se=document.createElement("div");Se.className="item-editor__hint",Se.textContent=dt,S.appendChild(Se)}return S},pe=document.createElement("input");pe.type="text",pe.required=!0,$.appendChild(we("ID",pe,"Unique identifier used for links and dependencies."));const _e=document.createElement("input");_e.type="text",$.appendChild(we("Name",_e,"Visible label shown on the tile."));const Z=document.createElement("input");Z.type="url",Z.inputMode="url",Z.placeholder="https://…",$.appendChild(we("Logo URL",Z,"Optional image URL."));const He=document.createElement("input");He.type="url",He.inputMode="url",He.placeholder="https://…",$.appendChild(we("External link",He,"Shown with ↗ icon and in preview."));const Ze=document.createElement("div");Ze.className="item-editor__checkbox";const ke=document.createElement("label");ke.className="item-editor__checkbox-row";const M=document.createElement("input");M.type="checkbox";const ce=document.createElement("span");ce.textContent="Mark as external without link";const qe=document.createElement("div");qe.className="item-editor__hint",qe.textContent="Keeps dashed border even without a URL.",ke.appendChild(M),ke.appendChild(ce),Ze.appendChild(ke),Ze.appendChild(qe),$.appendChild(Ze);const ye=document.createElement("input");ye.type="text",ye.placeholder="#2563eb",$.appendChild(we("Color",ye,"Optional badge color (hex or CSS color)."));const De=document.createElement("textarea");De.rows=2,De.placeholder="Comma or space separated ids",$.appendChild(we("Dependencies",De,"Use item IDs, separated by commas or spaces."));const je=document.createElement("div");je.className="item-editor__actions";const Je=document.createElement("button");Je.type="button",Je.className="pf-v5-c-button pf-m-tertiary",Je.textContent="Cancel";const Oe=document.createElement("button");return Oe.type="submit",Oe.className="pf-v5-c-button pf-m-primary",Oe.textContent="Save",je.appendChild(Je),je.appendChild(Oe),$.appendChild(je),y.wrapper=D,y.fields={idInput:pe,nameInput:_e,logoInput:Z,externalInput:He,externalFlagInput:M,colorInput:ye,depsInput:De,categoryValue:ue.querySelector(".item-editor__meta-value"),errorEl:re},Je.addEventListener("click",X),$e.addEventListener("click",X),z.addEventListener("click",X),$.addEventListener("submit",Ne=>{Ne.preventDefault(),he()}),document.addEventListener("keydown",Ne=>{Ne.key==="Escape"&&!D.hidden&&(Ne.preventDefault(),Ne.stopPropagation(),X())}),document.body.appendChild(D),D}function Ve(D){const z=s(D);return z?(ge(),y.categoryId=z.category.id,y.itemId=z.item.id,y.modelData=z.modelData,y.fields.categoryValue.textContent=z.category.title||z.category.id,y.fields.idInput.value=z.item.id||"",y.fields.nameInput.value=z.item.name||"",y.fields.logoInput.value=z.item.logo||"",y.fields.externalInput.value=typeof z.item.external=="string"?z.item.external:"",y.fields.externalFlagInput.checked=z.item.external===!0,y.fields.colorInput.value=z.item.color||"",y.fields.depsInput.value=Array.isArray(z.item.deps)?z.item.deps.join(", "):"",q(""),R(z.item.id),le(),!0):!1}return{open:Ve,hide:X,isOpen:()=>!!y.wrapper&&!y.wrapper.hidden}}function Ar(s,c="series"){return(s||c).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||c}function Qt(s,c="series"){const p=Ar(s,c).replace(/\./g,"-");return p.replace(/-series$/i,"").replace(/-+$/,"")||p||Ar(c,"series")}function Pr(s,{seriesName:c,fallbackTitle:p="unknown"}={}){var y,q;const E=[s==null?void 0:s.seriesId,(y=s==null?void 0:s.data)==null?void 0:y.seriesId,s==null?void 0:s.apicurioArtifactId,c,s==null?void 0:s.title,s==null?void 0:s.apicurioArtifactName,(q=s==null?void 0:s.data)==null?void 0:q.title,p].map(X=>(X??"").toString().trim()),R=E.findIndex(Boolean),B=R!==-1?E[R]:"";return B?(console.log("[Series] deriveSeriesId: picked base",{base:B,sourceIndex:R,candidates:E}),Qt(B,p)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:p}),null)}function bt(s,{seriesName:c,fallbackTitle:p="unknown"}={}){if(!s||typeof s!="object")return null;const I=Pr(s,{seriesName:c,fallbackTitle:p});return I?(s.seriesId=I,s.apicurioArtifactId||(s.apicurioArtifactId=I),I):null}function An(s,c={}){var E,R;if(!s)return null;const p=s.isSeries||((E=s.apicurioVersions)==null?void 0:E.length)>1||s.seriesId||((R=s.data)==null?void 0:R.seriesId)||s.apicurioArtifactId;if(!p&&!c.force)return null;const I=Pr(s,c);return I||(p?Qt(c.fallbackTitle||"unknown"):null)}const xi=typeof import.meta<"u"&&"./"||"";function ul(){console.log("[Blockscape] init");const s=document.getElementById("jsonBox"),c=document.querySelector(".blockscape-json-panel"),p=document.getElementById("app"),I=document.getElementById("overlay"),E=document.getElementById("tabTooltip"),R=document.getElementById("modelList"),B=document.getElementById("itemPreview"),y=document.getElementById("urlForm"),q=document.getElementById("urlInput"),X=document.getElementById("loadUrl"),le=B.querySelector(".item-preview__title"),G=B.querySelector(".item-preview__body"),he=B.querySelector(".item-preview__actions"),ge=B.querySelector(".item-preview__close"),Ve=document.getElementById("downloadJson"),D=document.getElementById("shareModel"),z=document.getElementById("createVersion"),Q=document.getElementById("openInEditor"),J=document.getElementById("copyJson"),K=document.getElementById("copySeries"),$e=document.getElementById("pasteJson"),$=document.getElementById("helpButton"),ue=document.getElementById("newPanelButton"),re=document.getElementById("shortcutHelp"),we=document.getElementById("shortcutHelpList"),pe=document.getElementById("shortcutHelpClose"),_e=document.getElementById("shortcutHelpBackdrop"),Z=document.getElementById("newPanel"),He=document.getElementById("newPanelClose"),Ze=document.getElementById("newPanelBackdrop"),ke=document.getElementById("search"),M=document.getElementById("searchResults"),ce=document.getElementById("localBackendPanel"),qe=document.getElementById("localBackendStatus"),ye=document.getElementById("localFileList"),De=document.getElementById("refreshLocalFiles"),je=document.getElementById("loadLocalFile"),Je=document.getElementById("saveLocalFile"),Oe=document.getElementById("localSavePath"),Ne="blockscape:editorPayload",at="blockscape:editorTransfer",dt=document.title;ce&&(ce.hidden=!0),s.value=document.getElementById("seed").textContent.trim();let S=[],v=-1;const Se=sl({models:S,getActiveIndex:()=>v,setActive:lt,ensureModelMetadata:an,getModelId:Xe,getSeriesId:An,ensureSeriesId:bt,getModelTitle:Re,computeJsonFingerprint:pi,uid:rn});let W=null,ne=new Map,Te=new Map,L=null,oe=null,Fe=null,Be=null,ft=!0,Qe=!1,Ot=0,Ye={x:0,y:0},fe="map",Ee=null,Ut=null,si=!1,li=null;const ci=2e3;let zt=null,Ht=null,_t=null,vt=null,kt=null,mn=null,Dt=null,hn="",en=!1,tn=null,Bn=null,nn=null,on=[],$n=null;const l=Jr(),f=30,k=1e3,_="blockscape:hoverScale",m=1.5,T=1,j=2.5,P="blockscape:titleWrap",ae="blockscape:titleHoverWidth",ee="blockscape:titleHoverTextPortion",ie="wrap",be=1.3,We=1,me=1.6,et=.25,mt=0,tt=.6,ve="blockscape:tileCompactness",Pe=1,wt=.75,Me=1.25,nt="blockscape:obsidianLinksEnabled",it="blockscape:obsidianLinkMode",Mt="blockscape:obsidianVault",ht="title",Ft="id",jt=ht;let gn=m,On=Pe,Ao=ie,Mn=be,Pn=et,Rn=!1,di=jt,Vn="";const Lo="blockscape:seriesNavDoubleClickMs",Un=900,No=300,To=4e3;let bn=Un;Se.hydrateConfig(),Xr(),Qr(),ra(),ta(),ia(),la(),fa(),ua(),ha(),st();function rn(){return Math.random().toString(36).slice(2,10)}function Rr(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function Vr(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function Ur(e){return Rr(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Hr(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),Vr(t)}function Dr(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}function Fr(){if(typeof window>"u"||!window.location)return!1;const e=new URL(window.location.href),n=e.pathname.replace(/\/+$/,"").split("/").filter(Boolean).pop()||"",i=e.searchParams.get("server");return n.toLowerCase()==="server"||i&&["1","true","yes","on"].includes(i.toLowerCase())}function jr(){return typeof window>"u"||!window.location?!1:(window.location.hostname||"").toLowerCase().endsWith("github.io")}function Jr(){const e=()=>typeof window>"u"||!window.location?{}:{host:window.location.host,path:window.location.pathname,search:window.location.search,hash:window.location.hash};function t(O,V={}){console.log("[Blockscape][local-backend]",O,{...e(),...V})}if(jr())return t("Disabled on github.io host"),ce&&(ce.hidden=!0),{detect(){},refresh(){},updateActiveSavePlaceholder(){}};if(!Fr()||!ce||!qe)return t("Opt-in flag missing or panel unavailable"),ce&&(ce.hidden=!0),{detect(){},refresh(){},updateActiveSavePlaceholder(){}};if(!ce||!qe)return{detect(){},refresh(){},updateActiveSavePlaceholder(){}};let i=!1,o="",r=[];function a(O,{error:V=!1}={}){qe.textContent=O,qe.style.color=V?"#b42318":"",t("Status",{text:O,error:V})}function d(O){const V=(O||"").trim().replace(/\\/g,"/").replace(/^\/+/,"");return!V||V.includes("..")?null:V.toLowerCase().endsWith(".bs")?V:`${V}.bs`}function u(){if(v<0)return"blockscape.bs";const O=Re(S[v])||"blockscape";return`${Qt(O,"blockscape")}.bs`}function h(){Oe&&(Oe.placeholder=u())}function g(){if(ye){if(ye.innerHTML="",!r.length){const O=document.createElement("option");O.disabled=!0,O.textContent="No .bs files found yet",ye.appendChild(O),ye.disabled=!0;return}ye.disabled=!1,r.forEach(O=>{const V=document.createElement("option");V.value=O.path;const te=O.mtimeMs?new Date(O.mtimeMs).toLocaleString():"";V.textContent=te?`${O.path} · ${te}`:O.path,ye.appendChild(V)}),o&&(ye.value=o)}}function A(O){i=!1,r=[],g(),ce.hidden=!0,O&&a(O,{error:!0}),t("Panel hidden",{message:O})}async function C({silent:O=!1}={}){try{t("Health check start");const V=await fetch("/api/health",{cache:"no-store"});if(!V.ok)throw new Error(`HTTP ${V.status}`);const te=await V.json();if(i=!!(te!=null&&te.ok),!i)throw new Error("Health check failed");return ce.hidden=!1,O||a(te.root?`Local server ready (root: ${te.root})`:"Local server ready"),t("Health check ok",{payload:te}),!0}catch(V){return O||console.log("[Blockscape] local backend health failed",V),A("Local server unavailable"),!1}}async function x(){if(i&&ye){a("Loading files…");try{const O=await fetch("/api/files",{cache:"no-store"});if(!O.ok)throw new Error(`HTTP ${O.status}`);r=(await O.json()).files||[],g(),a(r.length?`Browsing ${r.length} file(s) in ~/blockscape`:"No .bs files in ~/blockscape yet")}catch(O){console.warn("[Blockscape] local backend refresh failed",O),A("Local server unavailable")}}}async function F(){i=!1,A(),a("Checking for local server…");try{if(t("Detect start"),!await C())return;h(),await x()}catch(O){i=!1,console.log("[Blockscape] local backend not detected",O),t("Detect failed",{err:O})}}async function de(){if(!i||!ye)return;const O=ye.value;if(!O){alert("Select a file to load from ~/blockscape.");return}try{a(`Loading ${O}…`);const V=await fetch(`/api/file?path=${encodeURIComponent(O)}`,{cache:"no-store"});if(!V.ok)throw new Error(`HTTP ${V.status}`);const te=await V.json(),ot=JSON.stringify(te.data??te,null,2),Ae=Kt(ot,O,{seriesTitleOverride:`${O} series`});if(!Ae.length)throw new Error("No models found in file");let Ie=null;Ae.forEach((gt,qt)=>{const Rt=Jt(gt,{versionLabel:Ae.length>1?`${O} #${qt+1}`:O});Ie==null&&(Ie=Rt)}),Ie!=null&&lt(Ie),a(`Loaded ${O}`),o=O,g()}catch(V){console.error("[Blockscape] failed to load from local server",V),alert(`Local load failed: ${V.message}`),A("Local server unavailable")}}async function xe(){if(!i)return;if(v<0){alert("No active model to save.");return}const O=d(Oe==null?void 0:Oe.value)||u();if(!O){alert("Enter a relative path (no ..) to save under ~/blockscape.");return}try{const V=JSON.stringify(S[v].data,null,2);a(`Saving to ${O}…`);const te=await fetch(`/api/file?path=${encodeURIComponent(O)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:V});if(!te.ok)throw new Error(`HTTP ${te.status}`);const ot=await te.json();o=ot.path||O,a(`Saved to ${ot.path||O}`),await x()}catch(V){console.error("[Blockscape] local save failed",V),alert(`Local save failed: ${V.message}`),A("Local server unavailable")}}return De&&(De.onclick=()=>x()),je&&(je.onclick=()=>de()),Je&&(Je.onclick=()=>xe()),ye&&Oe&&ye.addEventListener("change",()=>{ye.value&&(Oe.value=ye.value)}),{detect:F,refresh:x,updateActiveSavePlaceholder:h}}async function Bo(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function Wr(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function Hn(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function qr(e){return Number.isFinite(e)?Math.min(j,Math.max(T,e)):m}function st(){if(!p)return;const e=!!L||!!oe;p.classList.toggle("blockscape-has-selection",e)}function Dn(e){return gn=qr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-scale",gn),gn}function Gr(e){return Number.isFinite(e)?Math.min(Me,Math.max(wt,e)):Pe}function Fn(e){return On=Gr(e),document.documentElement.style.setProperty("--blockscape-tile-compactness",On),On}function zr(e){return Number.isFinite(e)?Math.min(me,Math.max(We,e)):be}function jn(e){return Mn=zr(e),document.documentElement.style.setProperty("--blockscape-title-hover-width-multiplier",Mn),Mn}function Kr(e){return Number.isFinite(e)?Math.min(tt,Math.max(mt,e)):et}function Jn(e){return Pn=Kr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-text-portion",Pn),Pn}function Wn(e){const t=e==="nowrap"?"nowrap":"wrap";Ao=t;const n=t==="nowrap"?"nowrap":"normal",i=t==="nowrap"?"nowrap":"normal";return document.documentElement.style.setProperty("--blockscape-title-white-space",n),document.documentElement.style.setProperty("--blockscape-title-text-wrap",i),t}function Yr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(_,String(e))}catch(t){console.warn("[Blockscape] failed to persist hover scale",t)}}function Xr(){if(typeof window>"u"||!window.localStorage)return Dn(m);try{const e=window.localStorage.getItem(_);if(!e)return Dn(m);const t=parseFloat(e);return Dn(t)}catch(e){return console.warn("[Blockscape] failed to read hover scale",e),Dn(m)}}function Zr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ve,String(e))}catch(t){console.warn("[Blockscape] failed to persist tile compactness",t)}}function Qr(){if(typeof window>"u"||!window.localStorage)return Fn(Pe);try{const e=window.localStorage.getItem(ve);if(!e)return Fn(Pe);const t=parseFloat(e);return Fn(t)}catch(e){return console.warn("[Blockscape] failed to read tile compactness",e),Fn(Pe)}}function ea(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ae,String(e))}catch(t){console.warn("[Blockscape] failed to persist title hover width",t)}}function ta(){if(typeof window>"u"||!window.localStorage)return jn(be);try{const e=window.localStorage.getItem(ae);if(!e)return jn(be);const t=parseFloat(e);return jn(t)}catch(e){return console.warn("[Blockscape] failed to read title hover width",e),jn(be)}}function na(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ee,String(e))}catch(t){console.warn("[Blockscape] failed to persist title text zoom",t)}}function ia(){if(typeof window>"u"||!window.localStorage)return Jn(et);try{const e=window.localStorage.getItem(ee);if(!e)return Jn(et);const t=parseFloat(e);return Jn(t)}catch(e){return console.warn("[Blockscape] failed to read title text zoom",e),Jn(et)}}function oa(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(P,e)}catch(t){console.warn("[Blockscape] failed to persist title wrap mode",t)}}function ra(){if(typeof window>"u"||!window.localStorage)return Wn(ie);try{const e=window.localStorage.getItem(P);return Wn(e||ie)}catch(e){return console.warn("[Blockscape] failed to read title wrap mode",e),Wn(ie)}}function aa(e){return Number.isFinite(e)?Math.min(To,Math.max(No,e)):Un}function qn(e){return bn=aa(e),bn}function sa(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Lo,String(e))}catch(t){console.warn("[Blockscape] failed to persist series double-click wait",t)}}function la(){if(typeof window>"u"||!window.localStorage)return qn(Un);try{const e=window.localStorage.getItem(Lo);if(!e)return qn(Un);const t=parseInt(e,10);return qn(t)}catch(e){return console.warn("[Blockscape] failed to read series double-click wait",e),qn(Un)}}function ca(e){return e===Ft?Ft:ht}function Gn(e){return di=ca(e),di}function da(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(it,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian link mode",t)}}function ua(){if(typeof window>"u"||!window.localStorage)return Gn(jt);try{const e=window.localStorage.getItem(it);return Gn(e||jt)}catch(e){return console.warn("[Blockscape] failed to read Obsidian link mode",e),Gn(jt)}}function zn(e){return Rn=!!e,Rn}function pa(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(nt,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist Obsidian toggle",t)}}function fa(){if(typeof window>"u"||!window.localStorage)return zn(!1);try{const e=window.localStorage.getItem(nt);return e==null?zn(!1):zn(e==="1")}catch(e){return console.warn("[Blockscape] failed to read Obsidian toggle",e),zn(!1)}}function Kn(e){return Vn=(e??"").toString().trim(),Vn}function ma(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Mt,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian vault",t)}}function ha(){if(typeof window>"u"||!window.localStorage)return Kn("");try{const e=window.localStorage.getItem(Mt);return Kn(e||"")}catch(e){return console.warn("[Blockscape] failed to read Obsidian vault",e),Kn("")}}function ga(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function ba(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(r=>r&&typeof r=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function ui(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t,e.data&&typeof e.data=="object"&&(e.data.seriesId=t),Array.isArray(e.apicurioVersions)&&e.apicurioVersions.forEach(n=>{n!=null&&n.data&&typeof n.data=="object"&&(n.data.seriesId=t)}))}function va(e){if(!e||typeof window>"u"||typeof window.prompt!="function")return!1;const t=(e.title??e.apicurioArtifactName??"").toString().trim()||Ni(e,"Series"),n=window.prompt("Series name",t);if(n==null)return!1;const i=n.trim();if(!i)return!1;const o=An(e,{seriesName:i,fallbackTitle:i})||Qt(i,i),r=window.prompt("Series ID (used for linking and downloads)",o);if(r==null)return!1;const a=Qt(r.trim()||i,i||"series");return e.title=i,e.apicurioArtifactName=i,ui(e,a),!0}function Li(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>Li(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${Li(e[i])}`).join(",")}}`}function $o(e){try{return Li(e)}catch{return""}}function pi(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=$o(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=$o(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const wa=[{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Move up/down through items, pausing on category headers before entering the next category at the same relative position."},{keys:[["Cmd/Ctrl","Arrow Up"],["Cmd/Ctrl","Arrow Down"]],description:"Reorder the selected category (or the category that holds the selected item)."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Cmd/Ctrl","Arrow Left"],["Cmd/Ctrl","Arrow Right"]],description:"Switch to the previous or next map when viewing a series."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile or category."},{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["F2"]],description:"Edit the selected item; when a category (not an item) is selected, open the category editor."},{keys:[["Delete"]],description:"Delete the selected item or category (use Cmd/Ctrl+Z to undo)."},{keys:[["Insert"]],description:"Add a new category at the bottom of the map."},{keys:[["Escape"]],description:"Unselect item or close the open preview popover."}];function an(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const r=n||e.title||t||"model",a=Hn(r).replace(/\./g,"-");e.id=a||`model-${rn()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function ya(e){return JSON.parse(JSON.stringify(e))}function Re(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function Ni(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const o=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(o)return o;const r=Xe(e);return r?`${r} series`:t}return Re(e,t)}function Xe(e){var o;const t=An(e);if(t)return t;const n=(o=e==null?void 0:e.data)==null?void 0:o.id;return n&&n.toString().trim()||null}function Oo(e){var d;if(e<0||e>=S.length||!s)return!0;const t=S[e],n=(s.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}an(i,{titleHint:Re(t),idHint:Xe(t)});const o=pi(t.data),r=pi(i);if(o===r)return!0;t.data=i;const a=dn(t);return a>=0&&((d=t.apicurioVersions)!=null&&d[a])&&(t.apicurioVersions[a].data=i),!0}function Mo(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function Po(e){if(v<0||!e)return null;const t=S[v].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const r=(i.items||[]).find(a=>a.id===e);if(r)return{category:i,item:r,modelData:t}}return null}function Ea(e,t){const n=Mo(t);let i=Hn(e||"item");if(!n.has(i))return i;const o=()=>rn().slice(0,4);for(;n.has(i);)i=`${Hn(e||"item")}-${o()}`;return i}function _a(e="category",t){const n=(t==null?void 0:t.categories)||[],i=Hn(e||"category"),o=d=>n.some(u=>u.id===d);let r=i||`category-${rn()}`;if(!o(r))return r;let a=n.length+1;for(;o(`${i}-${a}`);)a+=1;return`${i}-${a}`}const sn=dl({findItemAndCategoryById:Po,collectAllItemIds:Mo,updateItemReferences:cl,loadActiveIntoEditor:ut,rebuildFromActive:ct,select:e=>pt(e),onSelectionRenamed:(e,t)=>{var n;L===e&&(L=t,st()),((n=Ee==null?void 0:Ee.item)==null?void 0:n.id)===e&&(Ee.item.id=t)}});function ka({getActiveModelData:e,loadActiveIntoEditor:t,rebuildFromActive:n,selectCategory:i,onCategoryRenamed:o}){const r={wrapper:null,fields:{},categoryId:null,modelData:null},a=x=>{if(r.fields.errorEl){if(!x){r.fields.errorEl.hidden=!0,r.fields.errorEl.textContent="";return}r.fields.errorEl.hidden=!1,r.fields.errorEl.textContent=x}},d=()=>{r.wrapper&&(r.wrapper.hidden=!0,r.wrapper.setAttribute("aria-hidden","true"),a(""),r.categoryId=null,r.modelData=null,document.body.classList.remove("category-editor-open"))},u=()=>{r.wrapper&&(r.wrapper.hidden=!1,r.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("category-editor-open"),requestAnimationFrame(()=>{var x,F;(x=r.fields.titleInput)==null||x.focus(),(F=r.fields.titleInput)==null||F.select()}))},h=()=>{if(!r.modelData||!r.categoryId)throw new Error("No category loaded.");const x=r.modelData.categories||[],F=x.find(te=>te.id===r.categoryId);if(!F)throw new Error("Category not found.");const de=(r.fields.idInput.value||"").trim();if(!de)throw new Error("ID is required.");const xe=(r.fields.titleInput.value||"").trim();if(x.some(te=>te.id===de&&te.id!==F.id))throw new Error("Another category already uses that ID.");const V=F.id;return F.id=de,F.title=xe||F.id,V!==de&&typeof o=="function"&&o(V,de),t(),n(),i(de,{scrollIntoView:!0}),!0},g=()=>{try{return h(),d(),!0}catch(x){return console.warn("[CategoryEditor] save failed",x),a((x==null?void 0:x.message)||"Unable to save category."),!1}},A=()=>{if(r.wrapper)return r.wrapper;const x=document.createElement("div");x.className="item-editor-modal category-editor-modal",x.hidden=!0,x.setAttribute("role","dialog"),x.setAttribute("aria-modal","true");const F=document.createElement("div");F.className="item-editor-modal__backdrop",x.appendChild(F);const de=document.createElement("div");de.className="item-editor",x.appendChild(de);const xe=document.createElement("div");xe.className="item-editor__header";const O=document.createElement("h2");O.className="item-editor__title",O.textContent="Edit category";const V=document.createElement("button");V.type="button",V.className="item-editor__close",V.setAttribute("aria-label","Close category editor"),V.textContent="×",xe.appendChild(O),xe.appendChild(V),de.appendChild(xe);const te=document.createElement("form");te.className="item-editor__form",de.appendChild(te);const ot=document.createElement("div");ot.className="item-editor__meta",ot.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',te.appendChild(ot);const Ae=document.createElement("div");Ae.className="item-editor__error",Ae.hidden=!0,te.appendChild(Ae);const Ie=(Et,Ge,Sn)=>{const It=document.createElement("label");It.className="item-editor__field";const un=document.createElement("span");if(un.className="item-editor__label",un.textContent=Et,It.appendChild(un),Ge.classList.add("item-editor__control"),It.appendChild(Ge),Sn){const ti=document.createElement("div");ti.className="item-editor__hint",ti.textContent=Sn,It.appendChild(ti)}return It},gt=document.createElement("input");gt.type="text",te.appendChild(Ie("Title",gt,"Display label shown in the map."));const qt=document.createElement("input");qt.type="text",qt.required=!0,te.appendChild(Ie("ID",qt,"Unique identifier for this category (used in URLs and references)."));const Rt=document.createElement("div");Rt.className="item-editor__actions";const St=document.createElement("button");St.type="submit",St.className="item-editor__action item-editor__action--primary",St.textContent="Save";const Vt=document.createElement("button");return Vt.type="button",Vt.className="item-editor__action",Vt.textContent="Cancel",Rt.appendChild(St),Rt.appendChild(Vt),te.appendChild(Rt),te.addEventListener("submit",Et=>{Et.preventDefault(),g()}),Vt.addEventListener("click",d),V.addEventListener("click",d),F.addEventListener("click",d),x.addEventListener("keydown",Et=>{Et.key==="Escape"&&(Et.preventDefault(),d())}),document.body.appendChild(x),r.wrapper=x,r.fields={titleInput:gt,idInput:qt,errorEl:Ae,metaLabel:ot.querySelector(".item-editor__meta-value")},x};return{open:x=>{if(!x||!A())return!1;const de=e(),O=((de==null?void 0:de.categories)||[]).find(V=>V.id===x);return O?(r.categoryId=O.id,r.modelData=de,r.fields.metaLabel.textContent=O.title||O.id||"Category",r.fields.titleInput.value=O.title||O.id||"",r.fields.idInput.value=O.id||"",a(""),u(),!0):!1},hide:d,isOpen:()=>!!r.wrapper&&r.wrapper.hidden===!1}}const Sa=ka({getActiveModelData:()=>{var e;return(e=S[v])==null?void 0:e.data},loadActiveIntoEditor:ut,rebuildFromActive:ct,selectCategory:(e,t={})=>Pt(e,t),onCategoryRenamed:(e,t)=>{oe===e&&(oe=t,st())}});function fi(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const i={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[i],e.apicurioActiveVersionIndex=0;const o=e.title||Re(e);return bt(e,{seriesName:o,fallbackTitle:o}),e.isSeries=!0,e}function Jt(e,{versionLabel:t,createdOn:n}={}){var u,h,g;if(e!=null&&e.isSeries||((u=e==null?void 0:e.apicurioVersions)==null?void 0:u.length)>1){const A=e.title||Re(e);bt(e,{seriesName:A,fallbackTitle:A})}const i=Xe(e);if(!i)return fi(e,{versionLabel:t||"1",createdOn:n}),S.push(e),S.length-1;const o=S.findIndex(A=>Xe(A)===i);if(o===-1)return fi(e,{versionLabel:t||"1",createdOn:n}),S.push(e),S.length-1;const r=S[o];if(!Array.isArray(r.apicurioVersions)||!r.apicurioVersions.length){r.apicurioVersions=[{version:"1",data:r.data,createdOn:(g=(h=r.apicurioVersions)==null?void 0:h[0])==null?void 0:g.createdOn}],r.apicurioActiveVersionIndex=0;const A=r.title||Re(r);bt(r,{seriesName:A,fallbackTitle:A})}const a=String(r.apicurioVersions.length+1);r.apicurioVersions.push({version:a,data:e.data,createdOn:n||new Date().toISOString()}),r.apicurioActiveVersionIndex=r.apicurioVersions.length-1,r.data=e.data,r.title=Re(e)||r.title,r.isSeries=!0;const d=r.title||Re(r);return bt(r,{seriesName:d,fallbackTitle:d}),o}function Ro({versionLabel:e}={}){var a;if(v<0||!S[v])throw new Error("Load or select a model before creating a version.");const t=S[v];fi(t,{versionLabel:"1"});let n;try{n=ya(t.data)}catch(d){throw console.warn("[Blockscape] failed to clone active model for versioning",d),new Error("Could not copy the current model.")}an(n,{titleHint:Re(t),idHint:Xe(t)||An(t)});const o={version:e||String((((a=t.apicurioVersions)==null?void 0:a.length)||0)+1),data:n,createdOn:new Date().toISOString()};t.apicurioVersions.push(o),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=n,t.isSeries=!0;const r=t.title||Re(t);return bt(t,{seriesName:r,fallbackTitle:r}),v}function Ti(){const e=v>=0&&S[v]?S[v]:null,t=Xe(e);document.title=t?`${t}-blockscape`:dt}function Bi(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||Re(e);return bt(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function Ia(){const e=S[v],t=Bi(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function Vo(e="shortcut",t=!1){const n=s.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=S[v],o=t?Bi(i):null,r=!!o,a=r?JSON.stringify(o,null,2):n,d=An(i),u=Xe(i),h=d||u||Re(i,"blockscape"),g=r?"-series":"",A=`${Hn(h)}${g}.bs`;return Dr(A,a),console.log(`[Blockscape] saved JSON (${e}):`,A),!0}const Ca={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function Uo(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return Ca[n]||"#9ca3af"}function xa(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(u=>u+u).join(""):t,i=parseInt(n,16),o=i>>16&255,r=i>>8&255,a=i&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(r/255,2.2)+.0722*Math.pow(a/255,2.2)>.35?"#111111":"#ffffff"}function Aa(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function Ho(){if(_t)return;_t=document.createElement("div"),_t.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",vt=document.createElement("span"),vt.className="series-nav-notice__text",_t.appendChild(e),_t.appendChild(vt),document.body.appendChild(_t)}function Do(){kt&&(clearTimeout(kt),kt=null),_t&&_t.classList.remove("is-visible"),vt&&(vt.textContent="")}function vn(){zt=null,Ht&&(clearTimeout(Ht),Ht=null),Do()}function La(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function Na(e,t,n){Ho(),zt={id:e,targetVersionIndex:t},Ht&&clearTimeout(Ht),Ht=setTimeout(()=>{Ht=null,vn()},bn);const i=La(n,t);$i(`Click again to open ${i} in this series.`,bn)}function $i(e,t=ci,n=null){if(Ho(),vt.textContent="",vt.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener",o.textContent=n,vt.appendChild(i),vt.appendChild(o)}_t.classList.add("is-visible"),kt&&clearTimeout(kt),kt=setTimeout(()=>Do(),t)}function Ta(){we&&(we.innerHTML="",wa.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((o,r)=>{if(r>0){const d=document.createElement("span");d.className="shortcut-help__or",d.textContent="or",n.appendChild(d)}const a=document.createElement("div");a.className="shortcut-help__combo",o.forEach((d,u)=>{if(u>0){const g=document.createElement("span");g.className="shortcut-help__sep",g.textContent="+",a.appendChild(g)}const h=document.createElement("kbd");h.className="shortcut-help__key",h.textContent=d,a.appendChild(h)}),n.appendChild(a)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),we.appendChild(t)}),si=!0)}function Ba(){return!!re&&re.hidden===!1}function $a(){if(!re)return;si||Ta(),li=document.activeElement,re.hidden=!1,re.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=re.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Oi(){if(!re||re.hidden)return;re.hidden=!0,re.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=li;e!=null&&e.focus?e.focus({preventScroll:!0}):$!=null&&$.focus&&$.focus({preventScroll:!0})}function Oa(){if(!Z)return;Z.hidden=!1,Z.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Z.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Mi(){!Z||Z.hidden||(Z.hidden=!0,Z.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),ue!=null&&ue.focus&&ue.focus({preventScroll:!0}))}let Pi=!1;function Yn(){Pi||(Pi=!0,requestAnimationFrame(()=>{Pi=!1,Ui(),En()}))}let Fo=!1;function jo(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Ma(e){const t=jo(e);if(!t.length){p.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}p.querySelectorAll(".tile").forEach(n=>{var a;const i=(((a=n.querySelector(".name"))==null?void 0:a.textContent)||"").toLowerCase(),o=(n.dataset.id||"").toLowerCase(),r=t.every(d=>i.includes(d)||o.includes(d));n.style.opacity=r?"1":"0.2"})}function Pa(e){const t=jo(e);if(!t.length)return[];const n=[];return S.forEach((i,o)=>{var h;const r=Ni(i),a=Xe(i)||"",d=`${r} ${a}`.toLowerCase();t.every(g=>d.includes(g))&&n.push({type:"model",modelIndex:o,modelTitle:r,modelId:a}),(Array.isArray((h=i.data)==null?void 0:h.categories)?i.data.categories:[]).forEach(g=>{const A=(g.title||g.id||"").toString();(g.items||[]).forEach(C=>{const x=(C.name||C.id||"").toString(),F=`${x} ${C.id||""} ${A}`.toLowerCase();t.every(de=>F.includes(de))&&n.push({type:"item",modelIndex:o,modelTitle:r,modelId:a,itemId:C.id,itemName:x,categoryTitle:A})})})}),n.slice(0,f)}function Jo(e){if(!M)return;M.innerHTML="";const t=(e||"").toString();if(!t.trim()){M.hidden=!0;return}if(!S.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",M.appendChild(i),M.hidden=!1;return}const n=Pa(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",M.appendChild(i),M.hidden=!1;return}n.forEach(i=>{const o=document.createElement("button");o.type="button",o.className="search-result",o.dataset.modelIndex=String(i.modelIndex),i.itemId&&(o.dataset.itemId=i.itemId),i.type&&(o.dataset.type=i.type),i.modelIndex===v&&(!i.itemId||L===i.itemId)&&o.classList.add("is-active");const r=document.createElement("div");r.className="search-result__primary";const a=document.createElement("span");a.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",r.appendChild(a);const d=document.createElement("span");d.className="search-result__badge",d.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",r.appendChild(d);const u=document.createElement("div");u.className="search-result__meta";const h=document.createElement("span");if(h.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,u.appendChild(h),i.type==="item"&&i.itemId){const g=document.createElement("span");g.textContent=`Item ID: ${i.itemId}`,u.appendChild(g)}else if(i.type==="model"){const g=document.createElement("span");g.textContent="Matches model title",u.appendChild(g)}o.appendChild(r),o.appendChild(u),M.appendChild(o)}),M.hidden=!1}function Wo(e){Ma(e||""),Jo(e||"")}function Ra(e){!e||!Number.isInteger(e.modelIndex)||(lt(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(v!==e.modelIndex)return;const t=(n=ne.get(e.itemId))==null?void 0:n.el;t&&(pt(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function lt(e){if(yt(),vn(),Ee=null,Ut=null,oe=null,Be=null,e<0||e>=S.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}en=!0,v=e,console.log("[Blockscape] active model:",Re(S[e]),"(index",e+" )"),Ti(),ln(),ut(),ct(),ke&&Wo(ke.value||""),l.updateActiveSavePlaceholder(),Se.updateAvailability()}function ln(){if(R.innerHTML="",!S.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",R.appendChild(e);return}S.forEach((e,t)=>{var A;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===v?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===v?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const r=document.createElement("span");r.className="model-nav-title",r.textContent=Ni(e),o.appendChild(r);const a=Xe(e);if(a){const C=document.createElement("span");C.className="model-nav-id",C.textContent=a,o.appendChild(C)}const d=Array.isArray((A=e.data)==null?void 0:A.categories)?e.data.categories:[],u=d.reduce((C,x)=>C+(x.items||[]).length,0),h=document.createElement("span");h.className="model-nav-meta";const g=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} maps`:"";h.textContent=`${d.length} cat · ${u} items${g}`,i.appendChild(o),i.appendChild(h),n.appendChild(i),R.appendChild(n)}),Se.updateAvailability()}function ut(){if(v<0){s.value="",K&&(K.disabled=!0);return}const e=S[v];s.value=JSON.stringify(e.data,null,2),K&&(K.disabled=!Bi(e))}function Va(e){try{return JSON.parse(e)}catch{return null}}function Ua(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const o=i.map((g,A)=>!g||typeof g!="object"?null:(an(g,{titleHint:`${t} #${A+1}`}),{obj:g,idx:A})).filter(Boolean);if(!o.length)return[];const r=o[0].obj,{seriesTitleOverride:a}=n;let d=a||r.title||`${t} series`;a&&!r.title&&(r.title=a);const u={id:rn(),title:d,data:r,apicurioVersions:o.map(({obj:g,idx:A})=>({version:String(A+1),data:g})),apicurioActiveVersionIndex:0,isSeries:!0},h=bt(u,{seriesName:d,fallbackTitle:d});return h&&(u.id=h),[u]}function qo(e,t="Pasted",n={}){return Array.isArray(e)?Ua(e,t,n):!e||typeof e!="object"?[]:(an(e,{titleHint:`${t} #1`}),[{id:rn(),title:e.title||`${t} #1`,data:e}])}function Kt(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const o=Va(i);if(o){let a=n;if(Array.isArray(o)&&n.promptForSeriesName){const u=ba(o,t),h=ga(u);a={...n,promptForSeriesName:!1,seriesTitleOverride:h||u}}const d=qo(o,t,a);if(d.length)return d}return i.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,d)=>{const u=JSON.parse(a);return an(u,{titleHint:`${t} #${d+1}`}),{id:rn(),title:u.title||`${t} #${d+1}`,data:u}})}function Ha(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function cn(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!Ha(e)}function Da(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function Go(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(Ne)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(Ne)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(Ne)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=Kt(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let i=null;return n.forEach(o=>{const r=Jt(o,{versionLabel:"editor"});i==null&&(i=r)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function zo(e="storage"){const t=Go();return!t||typeof t.index!="number"?!1:(lt(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function Fa(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let i;try{const a=Hr(t);i=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=qo(i.data,i.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let r=null;return o.forEach(a=>{const d=a.isSeries?i.title||a.title:null,u=Jt({...a,apicurioArtifactName:d||a.apicurioArtifactName},{versionLabel:"shared"});r==null&&(r=u)}),r}async function ja(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await Fi(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function Ja(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(r=>(r.items||[]).forEach(a=>{i.add(a.id);const d=new Set(a.deps||[]);(e.links||[]).forEach(u=>{u.from===a.id&&d.add(u.to)}),t.set(a.id,d),d.forEach(u=>{n.has(u)||n.set(u,new Set),n.get(u).add(a.id)})}));const o=new Set;return n.forEach((r,a)=>{((r==null?void 0:r.size)||0)>=2&&o.add(a)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:i}}function Wa(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const o=n.getContext("2d"),r=(e||"?").charAt(0).toUpperCase(),a=Uo(e,t),d=xa(a);return o.fillStyle=a,o.beginPath(),o.arc(i/2,i/2,i/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=d,o.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(r,i/2,i/2),n.toDataURL("image/png")}function dn(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Ko(e){const t=dn(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function qa(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var a,d;const o=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();o&&t.set(o,i);const r=(((d=n==null?void 0:n.data)==null?void 0:d.seriesId)??"").toString().trim();r&&!t.has(r)&&t.set(r,i)}),t}const Yo=new WeakMap;function Ga(e,t){var O;if(!((O=e==null?void 0:e.apicurioVersions)!=null&&O[t]))return null;const n=e.apicurioVersions[t],i=n.data,o=pi(i),r=Yo.get(n);if(r&&r.fingerprint===o)return r.dataUrl;const a=160,d=90,u=document.createElement("canvas");u.width=a,u.height=d;const h=u.getContext("2d");h.fillStyle="#f8fafc",h.fillRect(0,0,a,d),h.strokeStyle="#e5e7eb",h.strokeRect(.5,.5,a-1,d-1);const g=Array.isArray(i==null?void 0:i.categories)?i.categories:[],A=Math.max(g.length,1),C=a/A,x=8,F=8,de=4;g.forEach((V,te)=>{const ot=te*C+C/2,Ae=Array.isArray(V.items)?V.items:[],Ie=Math.max(Ae.length,1);Ae.forEach((gt,qt)=>{const Rt=x+(qt+.5)*((d-x-F)/Ie);h.beginPath(),h.arc(ot,Rt,de,0,Math.PI*2);const St=Uo(gt.name||gt.id||"",gt.color);h.fillStyle=St,h.strokeStyle="rgba(15,23,42,0.25)",h.fill(),h.stroke()})});const xe=u.toDataURL("image/png");return Yo.set(n,{fingerprint:o,dataUrl:xe}),xe}function Ri(e,t){var d;if(vn(),e<0||e>=S.length)return!1;const n=S[e];if(!((d=n==null?void 0:n.apicurioVersions)!=null&&d.length)||!Oo(e))return!1;const o=n.apicurioVersions.length,r=(t%o+o)%o,a=n.apicurioVersions[r];return a!=null&&a.data?(n.apicurioActiveVersionIndex=r,n.data=a.data,en=!0,L=null,Fe=null,st(),ut(),ct(),!0):!1}function Vi(e){var i;if(!e||v<0)return!1;const t=S[v];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return!1;const n=dn(t);return n===-1?!1:Ri(v,n+e)}function za(e,t){if(vn(),e<0||e>=S.length)return!1;const n=S[e];if(!Array.isArray(n==null?void 0:n.apicurioVersions)||n.apicurioVersions.length<=1)return alert("A series needs at least one map. Add another before removing this one."),!1;if(!Oo(e))return!1;const i=Math.min(Math.max(t,0),n.apicurioVersions.length-1),o=dn(n),[r]=n.apicurioVersions.splice(i,1);if(!r)return!1;let a=o;i===o?a=Math.min(i,n.apicurioVersions.length-1):i<o&&(a=Math.max(0,o-1)),n.apicurioActiveVersionIndex=Math.max(0,a);const d=n.apicurioVersions[n.apicurioActiveVersionIndex];return n.data=(d==null?void 0:d.data)||n.data,n.isSeries=n.apicurioVersions.length>1,lt(e),!0}function Ka(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||Xe(e)||"Artifact",n.title="Double-click to rename this series",n.setAttribute("role","button"),n.tabIndex=0,n.addEventListener("dblclick",()=>{var F;const C=S[v];!((F=C==null?void 0:C.apicurioVersions)!=null&&F.length)||!va(C)||(ln(),ut(),ct())}),t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const o=dn(e),r=Ko(e)||"latest";i.textContent=`No. in series ${r} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const a=document.createElement("div");a.className="version-nav__controls";const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Previous",d.addEventListener("click",()=>Vi(-1));const u=document.createElement("button");u.type="button",u.className="version-nav__button",u.textContent="Next",u.addEventListener("click",()=>Vi(1)),a.appendChild(d),a.appendChild(u),t.appendChild(a);const h=document.createElement("div");h.className="version-nav__thumbs",e.apicurioVersions.forEach((C,x)=>{var ot;const F=document.createElement("button");F.type="button",F.className="version-nav__thumb",x===o&&F.classList.add("is-active");const de=Ga(e,x);if(de){const Ae=document.createElement("img");Ae.src=de,Ae.alt=`Version ${x+1}`,F.appendChild(Ae)}const xe=document.createElement("div");xe.className="version-nav__thumb-label";const O=document.createElement("span");O.className="version-nav__thumb-label-text";const V=(((ot=C==null?void 0:C.data)==null?void 0:ot.id)??(C==null?void 0:C.id)??"").toString().trim(),te=V||(C!=null&&C.version?`v${C.version}`:`${x+1}`);if(O.textContent=te,xe.title=V||te,xe.appendChild(O),F.appendChild(xe),is(xe,O),e.apicurioVersions.length>1){const Ae=document.createElement("span");Ae.className="version-nav__thumb-remove",Ae.title=`Remove ${te} from this series`,Ae.setAttribute("aria-label",`Remove ${te} from this series`),Ae.setAttribute("role","button"),Ae.tabIndex=-1,Ae.textContent="×",Ae.addEventListener("click",Ie=>{Ie.stopPropagation(),Ie.preventDefault(),window.confirm(`Remove ${te} from this series?`)&&za(v,x)}),F.appendChild(Ae)}F.addEventListener("click",()=>Ri(v,x)),rs(F,C),h.appendChild(F)});const g=document.createElement("button");g.type="button",g.className="version-nav__thumb version-nav__thumb--add",g.title="Create a new version from this map",g.addEventListener("click",()=>{try{const C=Ro({versionLabel:"manual"});lt(C)}catch(C){alert((C==null?void 0:C.message)||"Unable to create a new version right now.")}});const A=document.createElement("span");return A.className="version-nav__thumb-add-icon",A.textContent="+",g.appendChild(A),h.appendChild(g),t.appendChild(h),t}function wn(){var vr,wr,yr;if(!W)return;Wt(),Array.isArray(W.m.categories)||(W.m.categories=[]),console.log("[Blockscape] rendering categories=",W.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!W.m.abstract,"- value:",W.m.abstract?W.m.abstract.substring(0,50)+"...":"none"),p.innerHTML="",ne.clear(),Te.clear(),on=[],fi(S[v],{versionLabel:"1"});const e=Ka(S[v]);e&&p.appendChild(e),I.setAttribute("width",window.innerWidth),I.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=W.m.title&&W.m.title.trim()||Re(S[v]),t.appendChild(n),((vr=S[v])!=null&&vr.isSeries||(yr=(wr=S[v])==null?void 0:wr.apicurioVersions)!=null&&yr.length)&&bt(S[v],{seriesName:S[v].title||W.m.title||Re(S[v])});const i=Ko(S[v]),o=An(S[v]),r=(W.m.id??"").toString().trim(),a=document.createElement("div");a.className="blockscape-model-meta__details";const d=(b,Y)=>{if(!Y)return;const U=document.createElement("div");U.className="blockscape-model-id";const Ce=document.createElement("span");Ce.className="blockscape-model-id__label",Ce.textContent=b;const ze=document.createElement("span");ze.className="blockscape-model-id__value",ze.textContent=Y,U.append(Ce,ze),a.appendChild(U)};d("Series ID",o),d("Model ID",r),d("No. in series",i),a.childElementCount&&t.appendChild(a),p.appendChild(t);const u=document.createElement("div");u.className="blockscape-tabs";const h=document.createElement("div");h.className="blockscape-tablist",h.setAttribute("role","tablist"),u.appendChild(h);const g=document.createElement("div");g.className="blockscape-tabpanels",u.appendChild(g);const A=document.createElement("div"),C=document.createElement("div"),x=document.createElement("div"),F=document.createElement("div");let de="";const xe=qa(S[v]),O=dn(S[v]);Dt=null,hn="";const V=[{id:"map",label:"Map",panel:A},{id:"abstract",label:"Info",panel:C},{id:"source",label:"Settings",panel:x},{id:"apicurio",label:"Apicurio",panel:F}],te=typeof Se.isEnabled=="function"?Se.isEnabled():!1,ot=b=>{if(!I)return;const Y=b==="map";I.hidden=!Y,Y?(Ui(),En()):I.innerHTML=""};V.forEach((b,Y)=>{const U=document.createElement("button");U.type="button",U.id=`tab-${b.id}`,U.className="blockscape-tab"+(Y===0?" is-active":""),U.setAttribute("role","tab"),U.setAttribute("aria-controls",`panel-${b.id}`),U.setAttribute("aria-selected",Y===0?"true":"false"),U.textContent=b.label,b.id==="apicurio"&&!te&&(U.hidden=!0,U.tabIndex=-1,U.setAttribute("aria-hidden","true"),U.style.display="none"),b.button=U,h.appendChild(U),b.panel.id=`panel-${b.id}`,b.panel.classList.add("blockscape-tabpanel"),b.panel.setAttribute("role","tabpanel"),b.panel.setAttribute("aria-labelledby",U.id),b.panel.hidden=Y!==0,Y===0&&b.panel.classList.add("is-active"),g.appendChild(b.panel)});const Ae=b=>{fe=b,V.forEach(Y=>{const U=Y.id===b;Y.button.classList.toggle("is-active",U),Y.button.setAttribute("aria-selected",U?"true":"false"),Y.panel.classList.toggle("is-active",U),Y.panel.hidden=!U}),ot(b)},Ie=V.find(b=>b.id==="apicurio"),gt=b=>{if(!Ie||!Ie.button||!Ie.panel)return;const Y=!!b;if(Ie.button.hidden=!Y,Ie.button.tabIndex=Y?0:-1,Ie.button.setAttribute("aria-hidden",Y?"false":"true"),Ie.button.style.display=Y?"":"none",Y){const U=fe==="apicurio";Ie.button.classList.toggle("is-active",U),Ie.button.setAttribute("aria-selected",U?"true":"false"),Ie.panel.classList.toggle("is-active",U),Ie.panel.hidden=!U}else{const U=Ie.panel.classList.contains("is-active");if(Ie.button.classList.remove("is-active"),Ie.button.setAttribute("aria-selected","false"),Ie.panel.classList.remove("is-active"),Ie.panel.hidden=!0,U){const Ce=V.find(ze=>ze.id!=="apicurio");Ce&&Ae(Ce.id)}}Bn&&(Bn.checked=Y)};V.forEach(b=>{b.button.addEventListener("click",()=>{Wt(),Ae(b.id)}),b.id==="abstract"&&(Dt=b.button,b.button.addEventListener("mouseenter",()=>Qn(b.button,de,{offset:12})),b.button.addEventListener("mouseleave",Wt),b.button.addEventListener("focus",()=>Qn(b.button,de,{offset:12})),b.button.addEventListener("blur",Wt))});const Rt=(b=>{const Y=V.find(Ce=>Ce.id===fe);if(Y&&(Y.id!=="apicurio"||b))return Y.id;const U=V.find(Ce=>Ce.id!=="apicurio"||b);return(U==null?void 0:U.id)||V[0].id})(te);Ae(Rt),gt(te),typeof Se.onEnabledChange=="function"&&Se.onEnabledChange(gt),p.appendChild(u);const St=document.createElement("div");St.className="blockscape-render",A.appendChild(St);const Vt=document.createElement("div");if(Vt.className="blockscape-abstract-panel",W.m.abstract){console.log("[Blockscape] Rendering abstract content");const b=document.createElement("div");b.className="blockscape-abstract",b.innerHTML=W.m.abstract,Bs(b),Vt.appendChild(b),de=b.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const b=document.createElement("div");b.className="blockscape-abstract-placeholder",b.textContent="No abstract has been provided for this model.",Vt.appendChild(b),de=b.outerHTML}hn=de,C.appendChild(Vt);const Et=document.createElement("div");Et.className="blockscape-source-panel";const Ge=document.createElement("div");Ge.className="blockscape-settings-panel";const Sn=document.createElement("p");Sn.className="blockscape-settings-panel__title",Sn.textContent="Feature toggles",Ge.appendChild(Sn);const It=({id:b,label:Y,hint:U,checked:Ce,className:ze="",onChange:Le})=>{const Tt=document.createElement("label");Tt.className=["settings-toggle",ze].filter(Boolean).join(" ");const Bt=document.createElement("input");Bt.type="checkbox",Bt.id=b,Bt.checked=Ce;const Ue=document.createElement("span");Ue.className="settings-toggle__text";const $t=document.createElement("span");if($t.className="settings-toggle__label",$t.textContent=Y,Ue.appendChild($t),U){const pn=document.createElement("span");pn.className="settings-toggle__hint",pn.textContent=U,Ue.appendChild(pn)}return Tt.appendChild(Bt),Tt.appendChild(Ue),typeof Le=="function"&&Bt.addEventListener("change",()=>Le(Bt.checked)),{row:Tt,input:Bt}},un=()=>{p.querySelectorAll(".tile").forEach(b=>{const Y=b.dataset.id,U=Po(Y);if(!(U!=null&&U.item))return;const Ce=tr(U.item.external),ze=er(U.item,{externalMeta:Ce,seriesIdLookup:xe});nr(b,ze)})},{row:ti}=It({id:"toggleSecondaryLinks",label:"Show indirect links",checked:ft,className:"map-controls__toggle",onChange:b=>{ft=b,L?pt(L):(Di(),En())}});Ge.appendChild(ti);const{row:Ps}=It({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:Qe,className:"map-controls__toggle",onChange:b=>{Qe=b,Zo()}});Ge.appendChild(Ps);const dr=[],{row:Rs}=It({id:"toggleObsidianLinks",label:"Obsidian",hint:"Make tiles open Obsidian when no external URL exists.",checked:Rn,className:"map-controls__toggle",onChange:b=>{const Y=zn(b);pa(Y),dr.forEach(U=>{U.disabled=!Y}),un()}});Ge.appendChild(Rs);const ji=document.createElement("div");ji.className="settings-radio";const Ji=document.createElement("div");Ji.className="settings-radio__label",Ji.textContent="Obsidian link format";const Wi=document.createElement("div");Wi.className="settings-radio__hint",Wi.textContent="Use the tile title or id when building Obsidian links.";const qi=document.createElement("div");qi.className="settings-radio__options";const ur=(b,Y)=>{const U=document.createElement("label");U.className="settings-radio__option";const Ce=document.createElement("input");Ce.type="radio",Ce.name="obsidianLinkMode",Ce.value=b,Ce.checked=di===b,Ce.disabled=!Rn,Ce.addEventListener("change",()=>{if(!Ce.checked)return;const Le=Gn(b);da(Le),un()});const ze=document.createElement("span");ze.textContent=Y,U.append(Ce,ze),dr.push(Ce),qi.appendChild(U)};ur(ht,"Use title"),ur(Ft,"Use id"),ji.append(Ji,qi,Wi),Ge.appendChild(ji);const hi=document.createElement("label");hi.className="settings-text",hi.setAttribute("for","obsidianVaultInput");const Gi=document.createElement("div");Gi.className="settings-text__text";const zi=document.createElement("span");zi.className="settings-text__label",zi.textContent="Obsidian vault";const Ki=document.createElement("span");Ki.className="settings-text__hint",Ki.textContent="Optional. Set the vault name to avoid duplicates.",Gi.append(zi,Ki);const Xt=document.createElement("input");Xt.type="text",Xt.id="obsidianVaultInput",Xt.className="settings-text__input",Xt.placeholder="Vault name",Xt.value=Vn,Xt.addEventListener("input",()=>{const b=Kn(Xt.value);ma(b),un()}),hi.append(Gi,Xt),Ge.appendChild(hi);const Yi=document.createElement("p");Yi.className="settings-note",Yi.innerHTML='Requires the Obsidian <a href="https://vinzent03.github.io/obsidian-advanced-uri/" target="_blank" rel="noreferrer noopener">Advanced URI</a> plugin for create/open behavior.',Ge.appendChild(Yi);const pr=b=>`${(b/1e3).toFixed(1)}s`,gi=document.createElement("label");gi.className="settings-slider",gi.setAttribute("for","seriesNavDoubleClickWait");const Xi=document.createElement("div");Xi.className="settings-slider__text";const Zi=document.createElement("span");Zi.className="settings-slider__label",Zi.textContent="Series double-click wait";const Qi=document.createElement("span");Qi.className="settings-slider__hint",Qi.textContent="Time window to double-click into another map version.",Xi.append(Zi,Qi);const bi=document.createElement("span");bi.className="settings-slider__value",bi.textContent=pr(bn);const Ct=document.createElement("input");Ct.type="range",Ct.id="seriesNavDoubleClickWait",Ct.className="settings-slider__input",Ct.min=String(No),Ct.max=String(To),Ct.step="50",Ct.value=String(bn),Ct.setAttribute("aria-label","Adjust double-click wait for series navigation"),Ct.addEventListener("input",()=>{const b=qn(parseInt(Ct.value,10));bi.textContent=pr(b),sa(b)}),gi.append(Xi,bi,Ct),Ge.appendChild(gi);const fr=b=>`${Math.round((b-1)*100)}%`,vi=document.createElement("label");vi.className="settings-slider",vi.setAttribute("for","hoverScaleSlider");const eo=document.createElement("div");eo.className="settings-slider__text";const to=document.createElement("span");to.className="settings-slider__label",to.textContent="Hover zoom";const no=document.createElement("span");no.className="settings-slider__hint",no.textContent="Expand tiles on hover to see more detail.",eo.append(to,no);const wi=document.createElement("span");wi.className="settings-slider__value",wi.textContent=fr(gn);const xt=document.createElement("input");xt.type="range",xt.id="hoverScaleSlider",xt.className="settings-slider__input",xt.min=String(T),xt.max=String(j),xt.step="0.1",xt.value=String(gn),xt.setAttribute("aria-label","Adjust hover zoom"),xt.addEventListener("input",()=>{const b=Dn(parseFloat(xt.value));wi.textContent=fr(b),Yr(b),L&&Yn()}),vi.append(eo,wi,xt),Ge.appendChild(vi);const mr=b=>b===1?"Default":`${Math.round(b*100)}%`,yi=document.createElement("label");yi.className="settings-slider",yi.setAttribute("for","tileCompactnessSlider");const io=document.createElement("div");io.className="settings-slider__text";const oo=document.createElement("span");oo.className="settings-slider__label",oo.textContent="Tile compactness";const ro=document.createElement("span");ro.className="settings-slider__hint",ro.textContent="Adjust padding, gap, and logo size for tiles.",io.append(oo,ro);const Ei=document.createElement("span");Ei.className="settings-slider__value",Ei.textContent=mr(On);const At=document.createElement("input");At.type="range",At.id="tileCompactnessSlider",At.className="settings-slider__input",At.min=String(wt),At.max=String(Me),At.step="0.05",At.value=String(On),At.setAttribute("aria-label","Adjust tile compactness"),At.addEventListener("input",()=>{const b=Fn(parseFloat(At.value));Ei.textContent=mr(b),Zr(b),L&&Yn()}),yi.append(io,Ei,At),Ge.appendChild(yi);const{row:Vs}=It({id:"titleWrapToggle",label:"Wrap titles",hint:"Allow long titles to wrap instead of truncating.",checked:Ao!=="nowrap",className:"map-controls__toggle",onChange:b=>{const Y=b?"wrap":"nowrap";Wn(Y),oa(Y)}});Ge.appendChild(Vs);const hr=b=>`${Math.round((b-1)*100)}% extra`,_i=document.createElement("label");_i.className="settings-slider",_i.setAttribute("for","titleHoverWidthSlider");const ao=document.createElement("div");ao.className="settings-slider__text";const so=document.createElement("span");so.className="settings-slider__label",so.textContent="Title width on hover";const lo=document.createElement("span");lo.className="settings-slider__hint",lo.textContent="Give titles more room horizontally when zoomed.",ao.append(so,lo);const ki=document.createElement("span");ki.className="settings-slider__value",ki.textContent=hr(Mn);const Lt=document.createElement("input");Lt.type="range",Lt.id="titleHoverWidthSlider",Lt.className="settings-slider__input",Lt.min=String(We),Lt.max=String(me),Lt.step="0.05",Lt.value=String(Mn),Lt.setAttribute("aria-label","Adjust title width boost on hover"),Lt.addEventListener("input",()=>{const b=jn(parseFloat(Lt.value));ki.textContent=hr(b),ea(b)}),_i.append(ao,ki,Lt),Ge.appendChild(_i);const gr=b=>`${Math.round(b*100)}% of hover zoom`,Si=document.createElement("label");Si.className="settings-slider",Si.setAttribute("for","titleZoomPortionSlider");const co=document.createElement("div");co.className="settings-slider__text";const uo=document.createElement("span");uo.className="settings-slider__label",uo.textContent="Title zoom influence";const po=document.createElement("span");po.className="settings-slider__hint",po.textContent="How much the title scales relative to tile hover zoom.",co.append(uo,po);const Ii=document.createElement("span");Ii.className="settings-slider__value",Ii.textContent=gr(Pn);const Nt=document.createElement("input");Nt.type="range",Nt.id="titleZoomPortionSlider",Nt.className="settings-slider__input",Nt.min=String(mt),Nt.max=String(tt),Nt.step="0.05",Nt.value=String(Pn),Nt.setAttribute("aria-label","Adjust how much titles scale on hover"),Nt.addEventListener("input",()=>{const b=Jn(parseFloat(Nt.value));Ii.textContent=gr(b),na(b)}),Si.append(co,Ii,Nt),Ge.appendChild(Si);const Us=typeof Se.isEnabled=="function"?Se.isEnabled():!1,{row:Hs,input:Ds}=It({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:Us,className:"apicurio-toggle",onChange:b=>{typeof Se.setEnabled=="function"&&Se.setEnabled(b)}});if(Bn=Ds,Ge.appendChild(Hs),Et.appendChild(Ge),c)c.hidden=!1,c.classList.remove("pf-v5-c-page__main-section"),Et.appendChild(c);else{const b=document.createElement("p");b.className="muted",b.textContent="Source editor unavailable.",Et.appendChild(b)}x.appendChild(Et),Se.mount(F);let br=0;W.m.categories.forEach(b=>{const Y=document.createElement("section");Y.className="category",Y.dataset.cat=b.id;const U=document.createElement("div");U.className="cat-head",U.dataset.cat=b.id,U.tabIndex=0,U.title="Select category",U.innerHTML=`<div class="cat-title">${_n(b.title||b.id)}</div>
                          <div class="muted cat-count">${(b.items||[]).length} items</div>`,U.addEventListener("click",()=>Pt(b.id)),U.addEventListener("keydown",Le=>{(Le.key==="Enter"||Le.key===" ")&&(Le.preventDefault(),Pt(b.id))}),U.addEventListener("focus",()=>Pt(b.id,{scrollIntoView:!1})),Y.appendChild(U);const Ce=document.createElement("div");Ce.className="grid",Y.appendChild(Ce),(b.items||[]).forEach(Le=>{br+=1;const Tt=tr(Le.external),Bt=er(Le,{externalMeta:Tt,seriesIdLookup:xe}),Ue=document.createElement("div");if(Ue.className=Tt.isExternal?"tile external":"tile",Ue.tabIndex=0,Ue.dataset.id=Le.id,Ue.dataset.globalIndex=String(br),Tt.url&&(Ue.dataset.externalUrl=Tt.url),xe.has(Le.id)){const ii=xe.get(Le.id);Ue.dataset.seriesVersionIndex=String(ii),Ue.classList.add("tile--series-link");const Fs=ii===O?"Current map in this series":`Open version ${ii+1} in this series`;Ue.title=Fs}Bt&&(Ue.dataset.obsidianUrl=Bt);const $t=document.createElement("img");$t.className="logo",Le.logo?($t.src=Le.logo,$t.alt=Le.name||Le.id):($t.alt="",$t.style.opacity=1,$t.src=Wa(Le.name||Le.id,Le.color));const pn=document.createElement("div");pn.className="name",pn.textContent=Le.name||Le.id;const fo=document.createElement("div");fo.className="tile-id",fo.textContent=Le.id||"";const mo=document.createElement("div");mo.className="badge",mo.textContent="reused";const In=document.createElement("button");In.type="button",In.className="tile-delete",In.setAttribute("aria-label",`Delete ${Le.name||Le.id}`),In.textContent="×",In.addEventListener("click",ii=>{ii.stopPropagation(),As(Le.id)}),Tt.url&&Ue.appendChild(ns(Tt.url)),nr(Ue,Bt),Ue.appendChild(In),Ue.appendChild($t),Ue.appendChild(pn),Ue.appendChild(fo),Ue.appendChild(mo),Ce.appendChild(Ue),ne.set(Le.id,{el:Ue,catId:b.id,rect:null})}),St.appendChild(Y),Te.set(b.id,{el:Y,headEl:U});const ze=document.createElement("button");ze.type="button",ze.className="tile-add",ze.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',ze.addEventListener("click",()=>gs(b.id)),Ce.appendChild(ze)});const ni=document.createElement("button");ni.type="button",ni.className="category-add",ni.innerHTML='<span class="category-add__icon" aria-hidden="true">+</span><span class="category-add__label">Add category</span><span class="category-add__hint">(Insert)</span>',ni.addEventListener("click",()=>ar()),St.appendChild(ni),Zo(),Ya(),Ui(),En(),yn(),as()}function Ya(){p.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",n=>{var g;if(typeof n.button=="number"&&n.button!==0)return;yt();const i=e.dataset.id,o=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,r=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,a=S[v],d=a?dn(a):-1,u=((g=a==null?void 0:a.apicurioVersions)==null?void 0:g.length)>1&&Number.isInteger(o)&&o!==d,h=zt&&zt.id===i&&zt.targetVersionIndex===o;if(zt&&!h&&vn(),u)if(h){if(vn(),Ri(v,o))return}else Na(i,o,a);else Number.isInteger(r)&&r>0&&r%5===0&&$i("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",i),L===i&&!(u&&h)){Zn();return}pt(i)}),e.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())});const t=()=>{L&&Yn()};e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",t),e.addEventListener("focus",t),e.addEventListener("blur",t),e.draggable=!0,e.addEventListener("dragstart",ds),e.addEventListener("dragend",us)}),p.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",ps),e.addEventListener("drop",hs),e.addEventListener("dragenter",fs),e.addEventListener("dragleave",ms)}),Fo||(Fo=!0,window.addEventListener("resize",Yn),window.addEventListener("scroll",Yn,{passive:!0}),window.addEventListener("resize",ir)),document.getElementById("clear").onclick=()=>Zn()}function Ui(){ne.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function Xo(e,{includeSecondary:t=ft}={}){if(!e||!W)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(W.fwd.get(e)||[]),i=new Set(W.rev.get(e)||[]),o=new Set,r=new Set,a=[],d=new Set,u=(h,g,A,C)=>{if(!h||!g)return;const x=`${h}->${g}:${A}:${C}`;d.has(x)||(d.add(x),a.push({from:h,to:g,type:A,depth:C}))};return n.forEach(h=>u(e,h,"dep",1)),i.forEach(h=>u(e,h,"revdep",1)),t&&new Set([...n,...i]).forEach(g=>{(W.fwd.get(g)||new Set).forEach(x=>{const F=x===e;F||o.add(x),F||u(g,x,"dep",2)}),(W.rev.get(g)||new Set).forEach(x=>{const F=x===e;F||r.add(x),F||u(g,x,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:o,secondaryRevs:r,edges:a}}function mi(e,t){const n=ne.get(e);n&&n.el.classList.add(t)}function pt(e){var d,u,h;if(!e)return;oe=null,L=e,Be=null,Fe=Xo(e),st(),Di(),yn();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:o}=Fe;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const r=ne.get(e);r&&r.el.classList.add("selected"),t.forEach(g=>mi(g,"dep")),n.forEach(g=>mi(g,"revdep")),i.forEach(g=>{!t.has(g)&&g!==e&&mi(g,"dep-indirect")}),o.forEach(g=>{!n.has(g)&&!t.has(g)&&g!==e&&mi(g,"revdep-indirect")}),En();const a=(h=(u=(d=ne.get(e))==null?void 0:d.el)==null?void 0:u.dataset)==null?void 0:h.externalUrl;a&&$i("This item has link to",ci,a)}function Pt(e,{scrollIntoView:t=!0,preserveEntryHint:n=!1}={}){var a,d;if(!((a=W==null?void 0:W.m)!=null&&a.categories)||!e)return!1;const o=(W.m.categories||[]).find(u=>u.id===e);if(!o)return!1;yt(),Hi(),n||(Be=null),oe=o.id,st(),yn();const r=Te.get(o.id);return t&&(r!=null&&r.el)&&(r.el.scrollIntoView({behavior:"smooth",block:"center"}),(d=r.headEl)==null||d.focus({preventScroll:!0})),!0}function yn(){if(Te.forEach(({el:t,headEl:n})=>{t.classList.remove("category--selected"),n&&n.removeAttribute("aria-current")}),!oe)return;const e=Te.get(oe);if(!(e!=null&&e.el)){oe=null,Be=null,st();return}e.el.classList.add("category--selected"),e.headEl&&e.headEl.setAttribute("aria-current","true")}function Xn(){if(oe)return oe;const e=L?ne.get(L):null;return e!=null&&e.catId?e.catId:null}function Xa(e){var r,a,d,u;if(!((a=(r=W==null?void 0:W.m)==null?void 0:r.categories)!=null&&a.length)||!e)return!1;const t=W.m.categories,n=Xn();let i=t.findIndex(h=>h.id===n);if(i===-1){const h=((d=t.find(g=>(g.items||[]).length))==null?void 0:d.id)||((u=t[0])==null?void 0:u.id);return h?Pt(h):!1}const o=i+e;return o<0||o>=t.length?!1:Pt(t[o].id)}function Hi(){L=null,Fe=null,Di(),En()}function Za(){oe=null,Be=null,yn()}function Zn(){Hi(),Za(),Be=null,st()}function Di(){p.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function Zo(){W!=null&&W.reusedLocal&&W.reusedLocal.forEach(e=>{const t=ne.get(e);if(!t)return;t.el.classList.toggle("reused",Qe);const n=t.el.querySelector(".badge");n&&(n.style.display=Qe?"inline-block":"none")})}function En(){for(;I.firstChild;)I.removeChild(I.firstChild);if(!L||I.hidden)return;Fe=Xo(L),Fe.edges.forEach(t=>{var A,C;const n=(A=ne.get(t.from))==null?void 0:A.rect,i=(C=ne.get(t.to))==null?void 0:C.rect;if(!n||!i)return;const o=Qo(n),r=Qo(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),d=(o.x+r.x)/2,u=o.y,h=(o.x+r.x)/2,g=r.y;a.setAttribute("d",`M ${o.x},${o.y} C ${d},${u} ${h},${g} ${r.x},${r.y}`),a.setAttribute("fill","none"),a.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),a.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),a.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&a.setAttribute("stroke-dasharray","4 3"),a.setAttribute("vector-effect","non-scaling-stroke"),I.appendChild(a)})}function Qo(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function _n(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Qa(e){const t=(e??"").toString().trim();if(!t)return"";const n=t.endsWith(".md")?t:`${t}.md`,i=new URLSearchParams;return i.set("filepath",n),i.set("data"," "),i.set("mode","append"),Vn&&i.set("vault",Vn),`obsidian://advanced-uri?${i.toString()}`}function es(e){return e?di===Ft?e.id??e.name??"":e.name??e.id??"":""}function er(e,{externalMeta:t,seriesIdLookup:n}={}){var o;if(!Rn||!e||(o=n==null?void 0:n.has)!=null&&o.call(n,e.id))return"";const i=es(e);return Qa(i)}function tr(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function ts(e){const t=document.createElement("button");return t.type="button",t.className="external-link obsidian-link",t.setAttribute("aria-label","Open in Obsidian"),t.title=e,t.textContent="O",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function ns(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function nr(e,t){if(!e)return;const n=e.querySelector(".obsidian-link");if(!t){n&&n.remove(),e.removeAttribute("data-obsidian-url");return}if(e.dataset.obsidianUrl=t,n){n.title=t;return}e.appendChild(ts(t))}function ir(){$n||($n=requestAnimationFrame(()=>{$n=null,on=on.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),on.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function is(e,t){!e||!t||(on.push({labelEl:e,textEl:t}),ir())}function os(e,t){var r,a;const n=[`<div class="version-nav__tooltip-title">${_n(t)}</div>`],i=((e==null?void 0:e.version)??((r=e==null?void 0:e.data)==null?void 0:r.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${_n(i)}</div>`);const o=(((a=e==null?void 0:e.data)==null?void 0:a.abstract)??"").toString().trim();return o?n.push(`<div class="version-nav__tooltip-body">${o}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function Qn(e,t,{offset:n=8}={}){!E||!e||!t||(E.innerHTML=t,E.hidden=!1,E.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),o=E.getBoundingClientRect(),r=window.scrollX||document.documentElement.scrollLeft,a=window.scrollY||document.documentElement.scrollTop;let d=i.left+i.width/2-o.width/2+r,u=i.top-o.height-n+a;d<r+n&&(d=r+n);const h=r+window.innerWidth-o.width-n;d>h&&(d=h),u<a+n&&(u=i.bottom+n+a),E.style.left=`${d}px`,E.style.top=`${u}px`,E.classList.add("is-visible")}))}function Wt(){mn&&(clearTimeout(mn),mn=null),E&&(E.classList.remove("is-visible"),E.setAttribute("aria-hidden","true"),E.hidden=!0)}function rs(e,t){if(!e)return;const n=Re((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=os(t,n);let o=null;const r=()=>{o&&(clearTimeout(o),o=null)},a=()=>{nn=e,Qn(e,`<div class="version-nav__tooltip-title">${_n(n)}</div>`,{offset:10})},d=()=>{r(),o=setTimeout(()=>{nn===e&&Qn(e,i,{offset:10})},k)},u=()=>{a(),d()},h=()=>{nn!==e&&a(),d()},g=()=>{r(),nn===e&&(nn=null,Wt())};e.addEventListener("mouseenter",u),e.addEventListener("focus",u),e.addEventListener("pointermove",h),e.addEventListener("mouseleave",g),e.addEventListener("blur",g),e.addEventListener("click",g)}function as(){en&&(en=!1,!(!Dt||!hn)&&(Wt(),Qn(Dt,hn,{offset:12}),mn=setTimeout(()=>{Wt(),ss()},1e3)))}function ss(){Dt&&(tn&&(clearTimeout(tn),tn=null),Dt.classList.add("blockscape-tab--twinkle"),tn=setTimeout(()=>{Dt.classList.remove("blockscape-tab--twinkle"),tn=null},1400))}window.addEventListener("scroll",Wt,!0),window.addEventListener("resize",Wt);function yt(){B&&(B.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),B.setAttribute("aria-hidden","true"),B.hidden=!0,or([]))}function ls(e,t){B&&(Ye={x:e,y:t},B.hidden=!1,B.setAttribute("aria-hidden","false"),B.classList.add("is-visible"),kn(e,t))}function kn(e,t){if(!B)return;const n=12;B.style.left=`${e+n}px`,B.style.top=`${t+n}px`;const i=B.getBoundingClientRect();let o=i.left,r=i.top;i.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(r=Math.max(n,window.innerHeight-i.height-n)),B.style.left=`${o}px`,B.style.top=`${r}px`}function or(e=[]){he&&(he.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),he.appendChild(n)}),he.hidden=e.length===0)}async function cs(e,t){var g;if(!B)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((g=t.querySelector(".name"))==null?void 0:g.textContent)||n||"Preview",o=n?`${n}.html`:"",r=o?`items/${o}`:"",a=++Ot,d=t.dataset.externalUrl||"",u=t.dataset.obsidianUrl||"",h=[{label:"Edit",title:"Edit this item",onClick:()=>{yt(),sn.open(n)}}];if(d&&h.push({label:"Open link ↗",title:d,onClick:()=>window.open(d,"_blank","noopener")}),u&&h.push({label:"Open in Obsidian",title:u,onClick:()=>window.open(u,"_blank","noopener")}),or(h),n&&pt(n),le.textContent=i,G.innerHTML='<div class="item-preview__status">Loading…</div>',B.classList.remove("item-preview--has-frame"),B.classList.add("item-preview--expanded"),ls(e.clientX,e.clientY),!r){G.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',kn(Ye.x,Ye.y);return}try{const A=await fetch(r,{cache:"no-cache"});if(!A.ok)throw new Error(`HTTP ${A.status}`);const C=await A.text();if(a!==Ot)return;if(!C.trim()){G.innerHTML=`<div class="item-preview__status">No content in <code>${_n(o)}</code>.</div>`,kn(Ye.x,Ye.y);return}const F=document.createElement("iframe");F.className="item-preview__frame",F.title=`${i} details`,F.srcdoc=C,G.innerHTML="",G.appendChild(F),B.classList.add("item-preview--has-frame"),kn(Ye.x,Ye.y)}catch(A){if(a!==Ot)return;G.innerHTML=`<div class="item-preview__status">No preview available for <strong>${_n(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${r}`,A),kn(Ye.x,Ye.y)}}ge&&ge.addEventListener("click",yt),$&&$.addEventListener("click",()=>{$a()}),ue&&ue.addEventListener("click",()=>{Oa()}),pe&&pe.addEventListener("click",Oi),_e&&_e.addEventListener("click",Oi),He&&He.addEventListener("click",Mi),Ze&&Ze.addEventListener("click",Mi),p&&p.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!p.contains(t)||cs(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!B||B.hidden||B.contains(e.target)||yt()}),Ve&&Ve.addEventListener("click",()=>{Vo("button")}),z&&z.addEventListener("click",()=>{if(v<0){alert("Load or select a model before creating a version.");return}try{const e=Ro({versionLabel:"map edit"});lt(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),D&&D.addEventListener("click",async()=>{var r;if(v<0||!S[v]){alert("Select or load a model before sharing.");return}const e={title:Re(S[v],"Shared Model"),data:S[v].data};let t;try{t=Ur(JSON.stringify(e))}catch(a){console.error("[Blockscape] share encode failed",a),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(a){console.warn("[Blockscape] failed to update URL for share",a),window.location.hash=n.hash}let o=!1;if((r=navigator.clipboard)!=null&&r.writeText)try{await navigator.clipboard.writeText(i),o=!0}catch(a){console.warn("[Blockscape] clipboard write failed",a)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),Q&&Q.addEventListener("click",()=>{const e=(s.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};L&&(n.selectedItemId=L),localStorage.setItem(Ne,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";L&&(t=`editor.html?selected=${encodeURIComponent(L)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==Ne||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||zo("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===at&&zo("message")})),document.addEventListener("keydown",e=>{var n,i,o,r,a,d,u,h,g,A;if(Ba()){e.key==="Escape"&&(e.preventDefault(),Oi());return}if(!(Z!=null&&Z.hidden)&&e.key==="Escape"){e.preventDefault(),Mi();return}if(!((n=sn==null?void 0:sn.isOpen)!=null&&n.call(sn))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const C=S[v],x=((i=C==null?void 0:C.apicurioVersions)==null?void 0:i.length)>1;Vo("shortcut",x);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!cn())return;if(Ss()){e.preventDefault();return}}if(e.key==="Escape"){let C=!1;B&&!B.hidden&&(yt(),C=!0),(L||oe)&&(Zn(),C=!0),C&&e.preventDefault()}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!cn())return;const C=e.key==="ArrowLeft"?-1:1;if(e.altKey)return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){Vi(C)&&e.preventDefault();return}if(e.ctrlKey||e.metaKey)return;if(oe&&!e.shiftKey){e.preventDefault();return}e.shiftKey?vs(C)&&e.preventDefault():ws(C)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!cn())return;const C=e.key==="ArrowUp"?-1:1;if((e.ctrlKey||e.metaKey)&&!e.altKey){ks(C)&&e.preventDefault();return}if(e.altKey)return;if(oe&&!L&&!e.shiftKey){if(Es(C)){e.preventDefault();return}if(Xa(C)){e.preventDefault();return}}e.shiftKey?_s(C)&&e.preventDefault():ys(C)&&e.preventDefault()}if(e.key==="Delete"){if(!cn()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const C=oe?xs():!1,x=C?!0:sr();(C||x)&&e.preventDefault()}if(e.key==="F2"){if(!cn())return;const C=oe&&!L&&oe||!L&&((d=(a=(r=(o=e.target)==null?void 0:o.closest)==null?void 0:r.call(o,".category"))==null?void 0:a.dataset)==null?void 0:d.cat)||null;if(C&&!L&&bs(C)){e.preventDefault();return}const x=L||((A=(g=(h=(u=e.target)==null?void 0:u.closest)==null?void 0:h.call(u,".tile"))==null?void 0:g.dataset)==null?void 0:A.id);x&&sn.open(x)&&e.preventDefault()}if(e.key==="Insert"){if(!cn()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;ar()&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!B||B.hidden||kn(Ye.x,Ye.y)}),window.addEventListener("scroll",()=>{!B||B.hidden||yt()},!0);let Yt=null,ei=null;function ds(e){yt(),Yt=e.target.dataset.id,ei=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:Yt,categoryId:ei})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",Yt,"from",ei)}function us(e){e.target.classList.remove("dragging"),p.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),p.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),Yt=null,ei=null}function ps(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function fs(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function ms(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function hs(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!Yt||!i)return;const r=Array.from(t.querySelectorAll(".tile")).filter(a=>a.dataset.id!==Yt).find(a=>{const d=a.getBoundingClientRect();return e.clientY<d.top+d.height/2});rr(Yt,r?r.dataset.id:null,i),wn(),console.log("[Blockscape] drop completed",Yt,"from",ei,"to",i)}function rr(e,t,n){if(v<0)return;const o=S[v].data.categories||[],r=o.find(g=>(g.items||[]).some(A=>A.id===e)),a=o.find(g=>g.id===n);if(!r||!a)return;r.items=r.items||[],a.items=a.items||[];const d=r.items.findIndex(g=>g.id===e);if(d===-1)return;const[u]=r.items.splice(d,1);let h=a.items.length;if(t){const g=a.items.findIndex(A=>A.id===t);g!==-1&&(h=g)}a.items.splice(h,0,u),ut(),ct()}function gs(e){if(v<0||!e)return;const t=S[v].data,i=(t.categories||[]).find(u=>u.id===e);if(!i)return;i.items=i.items||[];const o=`New item ${i.items.length+1}`,a={id:Ea(`${e}-${i.items.length+1}`,t),name:o,deps:[]};i.items.push(a),ut(),ct(),yt(),pt(a.id);const d=ne.get(a.id);d!=null&&d.el&&d.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",a.id,"to",e)}function ar(){if(v<0)return!1;const e=S[v].data;e.categories=e.categories||[];const t=`New category ${e.categories.length+1}`,n=_a(t,e),i={id:n,title:t,items:[]};return e.categories.push(i),oe=n,L=null,Fe=null,Be=null,ut(),ct(),Pt(n),console.log("[Blockscape] added category",n),!0}function bs(e=Xn()){if(v<0||!e)return!1;const t=Sa.open(e);return t&&(L=null,Fe=null,st()),t}function vs(e){if(!L||v<0||!e)return!1;const n=S[v].data.categories||[],i=ne.get(L);let o=null;if(i!=null&&i.catId&&(o=n.find(u=>u.id===i.catId)),o||(o=n.find(u=>(u.items||[]).some(h=>h.id===L))),!o)return!1;o.items=o.items||[];const r=o.items.findIndex(u=>u.id===L);if(r===-1)return!1;const a=r+e;if(a<0||a>=o.items.length)return!1;const[d]=o.items.splice(r,1);return o.items.splice(a,0,d),ut(),ct(),wn(),pt(L),!0}function ws(e){if(!W||!W.m||!e)return!1;const t=W.m.categories||[];if(!t.length)return!1;const n=()=>{const u=t.find(h=>(h.items||[]).length);return u?{category:u,item:u.items[0]}:null};if(!L){const u=n();return u?(pt(u.item.id),!0):!1}const i=ne.get(L);let o=null;if(i!=null&&i.catId&&(o=t.find(u=>u.id===i.catId)),o||(o=t.find(u=>(u.items||[]).some(h=>h.id===L))),!o){const u=n();return u?(pt(u.item.id),!0):!1}const r=o.items||[];if(!r.length)return!1;const a=r.findIndex(u=>u.id===L);if(a===-1)return!1;const d=a+e;return d<0||d>=r.length?!1:(pt(r[d].id),!0)}function ys(e){if(!W||!W.m||!e)return!1;const t=W.m.categories||[];if(!t.length)return!1;const n=Xn();let i=t.findIndex(a=>a.id===n),o=i+e;if(i===-1&&(o=e>0?0:t.length-1),o<0||o>=t.length)return!1;const r=t[o];if(L){const d=(t[i].items||[]).findIndex(u=>u.id===L);Be={catId:r.id,position:d===-1?0:d}}else Be=null;return Pt(r.id,{preserveEntryHint:!0})}function Es(e){var r;if(!oe||!((r=W==null?void 0:W.m)!=null&&r.categories)||!e)return!1;const n=(W.m.categories||[]).find(a=>a.id===oe);if(!n)return!1;const i=n.items||[];if(!i.length)return!1;let o=e>0?0:Math.max(0,i.length-1);return(Be==null?void 0:Be.catId)===n.id&&(o=Math.min(i.length-1,Math.max(0,Be.position||0))),Be=null,pt(i[o].id),!0}function _s(e){if(!L||v<0||!e)return!1;const n=S[v].data.categories||[];if(!n.length)return!1;const i=ne.get(L);let o=-1;if(i!=null&&i.catId&&(o=n.findIndex(A=>A.id===i.catId)),o===-1&&(o=n.findIndex(A=>(A.items||[]).some(C=>C.id===L))),o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const a=n[o],d=n[r];if(!d)return!1;a.items=a.items||[],d.items=d.items||[];const u=a.items.findIndex(A=>A.id===L);if(u===-1)return!1;const h=Math.min(d.items.length,Math.max(0,u)),g=h<d.items.length?d.items[h].id:null;return rr(L,g,d.id),wn(),pt(L),!0}function ks(e){if(v<0||!e)return!1;const n=S[v].data.categories||[];if(!n.length)return!1;const i=Xn();if(!i)return!1;const o=n.findIndex(d=>d.id===i);if(o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const[a]=n.splice(o,1);return n.splice(r,0,a),oe=a.id,Hi(),Be=null,st(),ut(),ct(),yn(),console.log("[Blockscape] moved category",a.id,"from",o,"to",r),!0}function Ss(){if(v<0)return!1;const e=S[v],t=Xe(e)||(e?e.id:null),n=[];if(Ee&&t===Ee.modelId&&n.push({...Ee,type:"item"}),Ut&&t===Ut.modelId&&n.push({...Ut,type:"category"}),!n.length)return!1;const i=n.reduce((o,r)=>o?(r.ts||0)>(o.ts||0)?r:o:r,null);if(!i)return!1;if(i.type==="category"){if(Cs(i))return!0}else if(i.type==="item"&&Is(i))return!0;return!1}function Is(e){const t=S[v],n=Xe(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const r=(t.data.categories||[]).find(d=>d.id===e.categoryId);if(!r)return!1;r.items=r.items||[];const a=Math.min(Math.max(e.index,0),r.items.length);return r.items.splice(a,0,e.item),Ee=null,yt(),L=null,Fe=null,st(),ut(),ct(),wn(),pt(e.item.id),console.log("[Blockscape] undo delete restored",e.item.id),!0}function Cs(e){const t=S[v],n=Xe(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const i=t.data;i.categories=i.categories||[];const o=Math.min(Math.max(e.index,0),i.categories.length);return i.categories.splice(o,0,e.category),Ut=null,L=null,Fe=null,oe=e.category.id,Be=null,st(),ut(),ct(),yn(),Pt(e.category.id),console.log("[Blockscape] undo delete restored category",e.category.id),!0}function sr(){if(!L||v<0)return!1;const t=S[v].data.categories||[];if(!t.length)return!1;const n=ne.get(L);let i=null;if(n!=null&&n.catId&&(i=t.find(h=>h.id===n.catId)),i||(i=t.find(h=>(h.items||[]).some(g=>g.id===L))),!i||!Array.isArray(i.items))return!1;const o=i.items.findIndex(h=>h.id===L);if(o===-1)return!1;const r=i.items.splice(o,1)[0];if(!r)return!1;const a=S[v];Ee={item:r,categoryId:i.id,index:o,modelId:Xe(a)||(a?a.id:null),ts:Date.now()};const u=(()=>{var g;if(i.items.length){const A=Math.min(o,i.items.length-1);return((g=i.items[A])==null?void 0:g.id)||null}const h=t.findIndex(A=>A.id===i.id);if(h===-1)return null;for(let A=h+1;A<t.length;A++){const C=t[A].items||[];if(C.length)return C[0].id}for(let A=h-1;A>=0;A--){const C=t[A].items||[];if(C.length)return C[0].id}return null})();return yt(),L=null,Fe=null,Be=null,st(),ut(),ct(),wn(),u?pt(u):Zn(),console.log("[Blockscape] removed item",r.id),!0}function xs(){var d,u;const e=Xn();if(!e||v<0)return!1;const n=S[v].data.categories||[];if(!n.length)return!1;const i=n.findIndex(h=>h.id===e);if(i===-1)return!1;const[o]=n.splice(i,1);if(!o)return!1;const r=S[v];Ut={category:o,index:i,modelId:Xe(r)||(r?r.id:null),ts:Date.now()},oe=null,L=null,Fe=null,Be=null,st(),ut(),ct();const a=((d=n[i])==null?void 0:d.id)||((u=n[i-1])==null?void 0:u.id)||null;return a?Pt(a):Zn(),console.log("[Blockscape] removed category",o.id),!0}function As(e){if(!e)return!1;const t=L;L=e;const n=sr();return n||(L=t,st()),n}J&&J.addEventListener("click",async()=>{const e=s.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await Bo(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),K&&K.addEventListener("click",async()=>{const e=Ia();if(!e){alert("No series available to copy. Create another version first.");return}await Bo(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),$e&&$e.addEventListener("click",async()=>{try{const e=await Wr();if(!e){alert("Clipboard is empty.");return}s.value=e,s.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=Kt(s.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const o=Jt(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=o)}),v===-1&&t!=null?lt(t):ln()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(v<0){alert("No active model selected.");return}try{const t=JSON.parse(s.value);if(an(t,{titleHint:Re(S[v]),idHint:Xe(S[v])||Re(S[v])}),S[v].data=t,S[v].title=t.title||S[v].title,S[v].isSeries||((e=S[v].apicurioVersions)==null?void 0:e.length)>1){const n=S[v].title||Re(S[v]);bt(S[v],{seriesName:n,fallbackTitle:n})}Ti(),console.log("[Blockscape] replaced active model:",Re(S[v])),ct(),Se.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const o=await i.text(),r=i.name.replace(/\.[^.]+$/,"")||"File",a=Kt(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models in file:",i.name);continue}a.forEach((d,u)=>{var de;const h=(((de=d.data)==null?void 0:de.title)??"").toString().trim(),g=a.length>1?`${i.name} #${u+1}`:i.name,A=`${r} series`,C=d.isSeries?A:null;let x={...d};if(d.isSeries){const xe=C||h||d.title||g||"unknown";x.title=xe;const O=Qt(xe||"unknown");ui(x,O),bt(x,{seriesName:xe,fallbackTitle:"unknown"}),x.apicurioArtifactName=x.apicurioArtifactName||xe}else x.title=h||g;const F=Jt({...x,apicurioArtifactName:x.apicurioArtifactName||C||x.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=F)})}v===-1&&n!=null?lt(n):ln()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",Ls);function Ls(e){var o;if(!cn())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Da(t))return;let n=[];try{n=Kt(t,"Clipboard",{promptForSeriesName:!0})}catch(r){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",r);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((r,a)=>{const d=Jt(r,{versionLabel:n.length>1?`paste #${a+1}`:"paste"});i==null&&(i=d)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&lt(i)}R.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(Aa(),lt(n))}),document.getElementById("removeModel").onclick=()=>{if(v<0)return;const e=Re(S[v]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",Re(S[v])),S.splice(v,1),!S.length){v=-1,W=null,p.innerHTML="",I.innerHTML="",s.value="",ln(),Ti();return}const n=Math.min(v,S.length-1);lt(n)},ke&&(ke.addEventListener("input",e=>{Wo(e.target.value||"")}),ke.addEventListener("focus",()=>{ke.value&&ke.value.trim()&&Jo(ke.value)})),M&&M.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;Ra({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!M||M.hidden)return;const t=e.target;M.contains(t)||ke&&(t===ke||ke.contains(t))||(M.hidden=!0)}),y&&q&&X&&y.addEventListener("submit",async e=>{e.preventDefault();const t=q.value.trim();if(!t){alert("Please enter a URL"),q.focus();return}const n=await Fi(t);if(typeof n=="number"){lt(n),q.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!q||!t)return;let n=null;q.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=q.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function ct(){if(!(v<0))try{W=Ja(S[v].data),wn()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function Ns(){const e=["comms.bs","planets.bs","styleguide.bs","blockscape-features.bs"],t=n=>xi?xi.endsWith("/")?`${xi}${n}`:`${xi}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const o=await i.text(),r=n.replace(/\.[^.]+$/,"")||"Model",a=Kt(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models found in",n);continue}a.forEach(d=>{let u={...d};if(d.isSeries){const h=`${r} series`;u={...d,title:h,apicurioArtifactName:h};const g=Qt(h||"unknown");ui(u,g),bt(u,{seriesName:h,fallbackTitle:"unknown"})}Jt(u,{versionLabel:n})}),console.log(`[Blockscape] loaded ${a.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}ln()}async function Ts(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const o=await fetch(e,i);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function Bs(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>$s(i)),e.querySelectorAll("a[href]").forEach(i=>{const o=i.getAttribute("href");cr(o)&&lr(i,o)})}function $s(e){var d,u;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(u=(d=e.parentNode)==null?void 0:d.closest)!=null&&u.call(d,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let o;for(;(o=n.exec(t))!==null;)i.push({url:o[0],index:o.index});if(!i.length)return;const r=document.createDocumentFragment();let a=0;i.forEach(({url:h,index:g})=>{g>a&&r.appendChild(document.createTextNode(t.slice(a,g))),r.appendChild(Os(h)),a=g+h.length}),a<t.length&&r.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(r,e)}function Os(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",cr(e)&&lr(t,e),t}function lr(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>Ms(n,t,e)))}async function Ms(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await Fi(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function cr(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function Fi(e){try{console.log("[Blockscape] loading from URL:",e);const t=await Ts(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=Kt(t,i)}catch(a){throw new Error(`Invalid JSON payload: ${a.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let r=null;return o.forEach((a,d)=>{var x;const u=(((x=a.data)==null?void 0:x.title)??"").toString().trim(),h=o.length>1?`${i} #${d+1}`:i,g=a.isSeries?`${i} series`:null;let A={...a};if(a.isSeries){const F=g||u||A.title||h;A={...a,title:F,apicurioArtifactName:F||a.apicurioArtifactName};const de=Qt(F||"unknown");ui(A,de),bt(A,{seriesName:F||g||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:de,url:e,baseName:i,seriesTitle:F})}const C=Jt({...A,title:u||A.title||h,apicurioArtifactName:A.apicurioArtifactName||g||a.apicurioArtifactName},{versionLabel:i});r==null&&(r=C)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,i),v===-1&&r!=null?lt(r):ln(),r}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}l.detect(),async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=Kt(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let o=null;i.forEach(g=>{const A=Jt(g,{versionLabel:"seed"});o==null&&(o=A)}),await Ns();const r=await ja(),a=Go(),d=a==null?void 0:a.index,u=Fa();lt(typeof r=="number"?r:typeof u=="number"?u:typeof d=="number"?d:o??0)}()}function pl(s){let c;return{c(){c=H("div"),c.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',w(c,"id","shortcutHelp"),w(c,"class","shortcut-help"),c.hidden=!0,w(c,"aria-hidden","true"),w(c,"role","dialog"),w(c,"aria-modal","true"),w(c,"aria-labelledby","shortcutHelpTitle")},m(p,I){rt(p,c,I)},p:Gt,i:Gt,o:Gt,d(p){p&&Ke(c)}}}class fl extends xo{constructor(c){super(),Co(this,c,null,pl,So,{})}}const ml=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function Lr(s){let c,p,I,E,R,B,y,q;return{c(){c=H("div"),p=H("div"),I=H("a"),E=Io("Open Blockscape GPT"),R=se(),B=H("div"),B.textContent="Paste the copied prompt into that chat.",y=se(),q=H("div"),q.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',w(I,"href",gl),w(I,"target","_blank"),w(I,"rel","noreferrer"),w(B,"class","new-panel__hint"),w(p,"class","new-panel__link"),w(q,"class","new-panel__link new-panel__link--disabled"),w(c,"class","new-panel__links")},m(X,le){rt(X,c,le),N(c,p),N(p,I),N(I,E),N(p,R),N(p,B),N(c,y),N(c,q)},p:Gt,d(X){X&&Ke(c)}}}function Nr(s){let c,p,I,E,R,B;return{c(){c=H("div"),p=H("div"),p.textContent="Generated prompt",I=se(),E=H("textarea"),w(p,"class","new-panel__prompt-label"),w(E,"class","pf-v5-c-form-control new-panel__textarea"),w(E,"rows","4"),E.readOnly=!0,w(c,"class","new-panel__prompt")},m(y,q){rt(y,c,q),N(c,p),N(c,I),N(c,E),Nn(E,s[4]),R||(B=fn(E,"input",s[12]),R=!0)},p(y,q){q&16&&Nn(E,y[4])},d(y){y&&Ke(c),R=!1,B()}}}function hl(s){let c,p,I,E,R,B,y,q,X,le,G,he,ge,Ve,D,z,Q,J,K,$e,$,ue,re,we,pe,_e,Z,He,Ze,ke,M,ce,qe,ye,De,je,Je,Oe,Ne,at,dt,S,v,Se,W,ne=s[2]==="gpt"&&Lr(),Te=s[4]&&s[5]&&Nr(s);return v=zs(s[10][0]),{c(){c=H("div"),p=H("div"),I=se(),E=H("div"),R=H("div"),R.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',B=se(),y=H("form"),q=H("div"),X=H("label"),X.textContent="Domain",le=se(),G=H("p"),G.textContent="Describe what you want to create a map for.",he=se(),ge=H("textarea"),Ve=se(),D=H("div"),z=H("label"),Q=H("input"),J=se(),K=H("span"),K.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,$e=se(),$=H("fieldset"),ue=H("legend"),ue.textContent="Target",re=se(),we=H("p"),we.textContent="Choose where you plan to use the prompt.",pe=se(),_e=H("label"),Z=H("input"),He=se(),Ze=H("div"),Ze.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',ke=se(),M=H("label"),ce=H("input"),qe=se(),ye=H("div"),ye.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',De=se(),je=H("div"),Je=H("button"),Je.textContent="Copy prompt",Oe=se(),Ne=H("div"),at=Io(s[3]),dt=se(),ne&&ne.c(),S=se(),Te&&Te.c(),w(p,"id","newPanelBackdrop"),w(p,"class","shortcut-help__backdrop"),w(R,"class","shortcut-help__header"),w(X,"for","newDomain"),w(G,"class","new-panel__hint"),w(ge,"id","newDomain"),w(ge,"class","pf-v5-c-form-control new-panel__textarea"),w(ge,"rows","4"),ge.required=!0,w(ge,"placeholder","Ex: Companies building open-source geospatial tools"),w(q,"class","new-panel__field"),w(Q,"id","seriesToggle"),w(Q,"type","checkbox"),w(z,"class","new-panel__toggle"),w(z,"for","seriesToggle"),w(D,"class","new-panel__field"),w(we,"class","new-panel__hint"),w(Z,"type","radio"),w(Z,"name","target"),Z.__value="gpt",Nn(Z,Z.__value),w(_e,"class","new-panel__option"),w(ce,"type","radio"),w(ce,"name","target"),ce.__value="plain",Nn(ce,ce.__value),w(M,"class","new-panel__option"),w($,"class","new-panel__field"),w(Je,"class","pf-v5-c-button pf-m-primary"),w(Je,"type","submit"),w(Ne,"class","new-panel__status"),w(Ne,"aria-live","polite"),w(je,"class","new-panel__actions"),w(y,"class","shortcut-help__list new-panel__form"),w(E,"class","shortcut-help__panel"),w(E,"tabindex","-1"),w(c,"id","newPanel"),w(c,"class","shortcut-help"),c.hidden=!0,w(c,"aria-hidden","true"),w(c,"role","dialog"),w(c,"aria-modal","true"),w(c,"aria-labelledby","newPanelTitle"),v.p(Z,ce)},m(L,oe){rt(L,c,oe),N(c,p),N(c,I),N(c,E),N(E,R),N(E,B),N(E,y),N(y,q),N(q,X),N(q,le),N(q,G),N(q,he),N(q,ge),Nn(ge,s[0]),N(y,Ve),N(y,D),N(D,z),N(z,Q),Q.checked=s[1],N(z,J),N(z,K),N(y,$e),N(y,$),N($,ue),N($,re),N($,we),N($,pe),N($,_e),N(_e,Z),Z.checked=Z.__value===s[2],N(_e,He),N(_e,Ze),N($,ke),N($,M),N(M,ce),ce.checked=ce.__value===s[2],N(M,qe),N(M,ye),N(y,De),N(y,je),N(je,Je),N(je,Oe),N(je,Ne),N(Ne,at),N(y,dt),ne&&ne.m(y,null),N(y,S),Te&&Te.m(y,null),Se||(W=[fn(ge,"input",s[7]),fn(Q,"change",s[8]),fn(Z,"change",s[9]),fn(ce,"change",s[11]),fn(y,"submit",Gs(s[6]))],Se=!0)},p(L,[oe]){oe&1&&Nn(ge,L[0]),oe&2&&(Q.checked=L[1]),oe&4&&(Z.checked=Z.__value===L[2]),oe&4&&(ce.checked=ce.__value===L[2]),oe&8&&Ys(at,L[3]),L[2]==="gpt"?ne?ne.p(L,oe):(ne=Lr(),ne.c(),ne.m(y,S)):ne&&(ne.d(1),ne=null),L[4]&&L[5]?Te?Te.p(L,oe):(Te=Nr(L),Te.c(),Te.m(y,null)):Te&&(Te.d(1),Te=null)},i:Gt,o:Gt,d(L){L&&Ke(c),ne&&ne.d(),Te&&Te.d(),v.r(),Se=!1,ai(W)}}}const gl="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function bl(s,c,p){let I="",E=!1,R="gpt",B="",y="",q=!1;const X=()=>{var J;return typeof navigator<"u"&&!!((J=navigator.clipboard)!=null&&J.writeText)};function le(J){const K=J||"[DOMAIN]",$e=E?"series":"map",ue=ml.replaceAll("[DOMAIN NAME]",K).replaceAll("[DOMAIN]",K).replaceAll("[map|series]",$e).split(`
`),re=`Generate a **blockscape ${$e}** for the domain of ${K}.`,we=ue.findIndex(_e=>_e.toLowerCase().includes("generate a **blockscape value")||_e.toLowerCase().includes("generate a blockscape [map|series]")||_e.toLowerCase().startsWith("generate a blockscape"));we>=0?ue[we]=re:ue.unshift(re);const pe=E?`

User requested a series (return an array of models).`:"";return`${ue.join(`
`).trim()}${pe}`}async function G(J){J.preventDefault();const K=I.trim();if(p(3,B=""),p(5,q=R!=="gpt"),!K){p(3,B="Add a domain to generate a prompt."),p(4,y="");return}if(R==="gpt"?p(4,y=`${E?"Create a series":"Create a map"} for ${K}`):(p(4,y=le(K)),p(5,q=!0)),!X()){p(3,B="Clipboard access is unavailable. Copy the prompt below."),p(5,q=!0);return}try{await navigator.clipboard.writeText(y),p(3,B=R==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),R==="gpt"&&p(5,q=!1)}catch($){console.warn("[Blockscape] clipboard write failed",$),p(3,B="Copy failed. Use the prompt below."),p(5,q=!0)}}const he=[[]];function ge(){I=this.value,p(0,I)}function Ve(){E=this.checked,p(1,E)}function D(){R=this.__value,p(2,R)}function z(){R=this.__value,p(2,R)}function Q(){y=this.value,p(4,y)}return[I,E,R,B,y,q,G,ge,Ve,D,he,z,Q]}class vl extends xo{constructor(c){super(),Co(this,c,bl,hl,So,{})}}const{document:Tr}=qs;function wl(s){let c,p,I,E,R,B,y,q,X,le,G,he,ge,Ve,D,z,Q,J,K,$e,$,ue,re,we,pe,_e,Z,He,Ze,ke,M,ce,qe,ye,De,je,Je,Oe,Ne,at,dt,S=`<script id="seed" type="application/json">${s[1]}<\/script>`,v,Se,W,ne,Te,L,oe,Fe,Be,ft,Qe,Ot,Ye;return Fe=new fl({}),ft=new vl({}),{c(){c=H("link"),p=se(),I=H("div"),E=H("header"),R=H("div"),B=H("div"),y=H("div"),q=H("div"),q.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',X=se(),le=H("div"),G=H("div"),he=H("button"),ge=H("span"),ge.textContent="Toggle search and edit tools",Ve=se(),D=H("span"),D.textContent="▾",z=se(),Q=H("button"),Q.textContent="New",J=se(),K=H("form"),K.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',$e=se(),$=H("label"),$.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',ue=se(),re=H("button"),re.textContent="Help",we=se(),pe=H("div"),_e=H("div"),_e.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',Z=se(),He=H("button"),He.textContent="Edit",Ze=se(),ke=H("button"),ke.textContent="Share",ye=se(),De=H("div"),De.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',je=se(),Je=H("main"),Je.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div> <section id="localBackendPanel" class="local-backend" hidden=""><div class="sidebar-heading">Local files</div> <p id="localBackendStatus" class="local-backend__status muted">Checking for local server…</p> <div class="local-backend__list"><label class="sr-only" for="localFileList">Blockscape files under ~/blockscape</label> <select id="localFileList" class="pf-v5-c-form-control" size="6" aria-label="Blockscape files on local server"></select> <div class="local-backend__actions"><button id="refreshLocalFiles" class="pf-v5-c-button pf-m-tertiary" type="button">Refresh</button> <button id="loadLocalFile" class="pf-v5-c-button pf-m-secondary" type="button">Load</button></div></div> <div class="local-backend__save"><label for="localSavePath">Save active map to ~/blockscape</label> <input id="localSavePath" class="pf-v5-c-form-control" type="text" placeholder="my-map.bs"/> <button id="saveLocalFile" class="pf-v5-c-button pf-m-primary" type="button">Save</button></div></section></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,Oe=se(),Ne=H("footer"),Ne.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',at=se(),dt=new Xs(!1),v=se(),Se=Or("svg"),W=se(),ne=H("div"),Te=se(),L=H("div"),L.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',oe=se(),Ir(Fe.$$.fragment),Be=se(),Ir(ft.$$.fragment),Tr.title="Blockscape — simple landscape-style tiles",w(c,"rel","icon"),w(c,"type","image/svg+xml"),w(c,"href","./favicon.svg"),w(q,"class","blockscape-brand"),w(ge,"class","sr-only"),w(D,"class","blockscape-toolbar__toggle-icon"),w(D,"aria-hidden","true"),w(he,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),w(he,"type","button"),w(he,"aria-expanded",s[0]),w(he,"aria-controls","blockscapeHeaderExtras"),w(Q,"id","newPanelButton"),w(Q,"class","pf-v5-c-button pf-m-primary"),w(Q,"type","button"),w(Q,"title","Create something new"),w(K,"id","urlForm"),w(K,"class","blockscape-url-form"),w(K,"autocomplete","on"),K.noValidate=!0,w($,"class","pf-v5-c-button pf-m-primary blockscape-file"),w(re,"id","helpButton"),w(re,"class","pf-v5-c-button pf-m-primary"),w(re,"type","button"),w(re,"title","Show keyboard shortcuts"),w(G,"class","blockscape-toolbar__primary"),w(_e,"class","blockscape-search"),w(He,"id","openInEditor"),w(He,"class","pf-v5-c-button pf-m-secondary"),w(He,"type","button"),w(He,"title","Open current JSON in the editor"),w(ke,"id","shareModel"),w(ke,"class","pf-v5-c-button pf-m-secondary"),w(ke,"type","button"),w(ke,"title","Copy a shareable URL for this model"),w(pe,"id","blockscapeHeaderExtras"),w(pe,"class","blockscape-toolbar__extras"),pe.hidden=M=!s[0],w(pe,"aria-hidden",ce=!s[0]),w(le,"class","blockscape-toolbar__controls"),w(le,"data-expanded",qe=s[0]?"true":"false"),w(De,"class","blockscape-legend"),w(De,"role","presentation"),w(y,"class","blockscape-toolbar"),w(B,"class","pf-v5-c-masthead__content"),w(R,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),w(E,"class","pf-v5-c-page__header"),w(Je,"class","pf-v5-c-page__main"),w(Ne,"class","pf-v5-c-page__footer blockscape-footer"),w(I,"class","pf-v5-c-page"),dt.a=v,w(Se,"id","overlay"),w(Se,"class","svg-layer"),w(ne,"id","tabTooltip"),w(ne,"class","blockscape-tab-tooltip"),ne.hidden=!0,w(ne,"aria-hidden","true"),w(L,"id","itemPreview"),w(L,"class","item-preview"),L.hidden=!0,w(L,"aria-hidden","true")},m(fe,Ee){N(Tr.head,c),rt(fe,p,Ee),rt(fe,I,Ee),N(I,E),N(E,R),N(R,B),N(B,y),N(y,q),N(y,X),N(y,le),N(le,G),N(G,he),N(he,ge),N(he,Ve),N(he,D),N(G,z),N(G,Q),N(G,J),N(G,K),N(G,$e),N(G,$),N(G,ue),N(G,re),N(le,we),N(le,pe),N(pe,_e),N(pe,Z),N(pe,He),N(pe,Ze),N(pe,ke),N(y,ye),N(y,De),N(I,je),N(I,Je),N(I,Oe),N(I,Ne),rt(fe,at,Ee),dt.m(S,fe,Ee),rt(fe,v,Ee),rt(fe,Se,Ee),rt(fe,W,Ee),rt(fe,ne,Ee),rt(fe,Te,Ee),rt(fe,L,Ee),rt(fe,oe,Ee),_o(Fe,fe,Ee),rt(fe,Be,Ee),_o(ft,fe,Ee),Qe=!0,Ot||(Ye=fn(he,"click",s[2]),Ot=!0)},p(fe,[Ee]){(!Qe||Ee&1)&&w(he,"aria-expanded",fe[0]),(!Qe||Ee&1&&M!==(M=!fe[0]))&&(pe.hidden=M),(!Qe||Ee&1&&ce!==(ce=!fe[0]))&&w(pe,"aria-hidden",ce),(!Qe||Ee&1&&qe!==(qe=fe[0]?"true":"false"))&&w(le,"data-expanded",qe)},i(fe){Qe||(Eo(Fe.$$.fragment,fe),Eo(ft.$$.fragment,fe),Qe=!0)},o(fe){Sr(Fe.$$.fragment,fe),Sr(ft.$$.fragment,fe),Qe=!1},d(fe){fe&&(Ke(p),Ke(I),Ke(at),dt.d(),Ke(v),Ke(Se),Ke(W),Ke(ne),Ke(Te),Ke(L),Ke(oe),Ke(Be)),Ke(c),ko(Fe,fe),ko(ft,fe),Ot=!1,Ye()}}}function yl(s,c,p){const I=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let E=!1;const R=()=>{if(p(0,E=!E),!E){const B=document.getElementById("search");B&&B.value&&(B.value="",B.dispatchEvent(new Event("input",{bubbles:!0})))}};return Qs(()=>{ul()}),[E,I,R]}class El extends xo{constructor(c){super(),Co(this,c,yl,wl,So,{})}}const _l=document.getElementById("root");new El({target:_l});
