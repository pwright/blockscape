var Ln=Object.defineProperty;var Sn=(s,u,b)=>u in s?Ln(s,u,{enumerable:!0,configurable:!0,writable:!0,value:b}):s[u]=b;var je=(s,u,b)=>Sn(s,typeof u!="symbol"?u+"":u,b);(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))S(x);new MutationObserver(x=>{for(const V of x)if(V.type==="childList")for(const N of V.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&S(N)}).observe(document,{childList:!0,subtree:!0});function b(x){const V={};return x.integrity&&(V.integrity=x.integrity),x.referrerPolicy&&(V.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?V.credentials="include":x.crossOrigin==="anonymous"?V.credentials="omit":V.credentials="same-origin",V}function S(x){if(x.ep)return;x.ep=!0;const V=b(x);fetch(x.href,V)}})();function Qe(){}function Xt(s){return s()}function zt(){return Object.create(null)}function yt(s){s.forEach(Xt)}function Qt(s){return typeof s=="function"}function Nn(s,u){return s!=s?u==u:s!==u||s&&typeof s=="object"||typeof s=="function"}function $n(s){return Object.keys(s).length===0}function _n(s,u){s.appendChild(u)}function Ie(s,u,b){s.insertBefore(u,b||null)}function fe(s){s.parentNode&&s.parentNode.removeChild(s)}function ct(s){return document.createElement(s)}function Zt(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Bn(s){return document.createTextNode(s)}function st(){return Bn(" ")}function pe(s,u,b){b==null?s.removeAttribute(u):s.getAttribute(u)!==b&&s.setAttribute(u,b)}function Tn(s){return Array.from(s.childNodes)}class Un{constructor(u=!1){je(this,"is_svg",!1);je(this,"e");je(this,"n");je(this,"t");je(this,"a");this.is_svg=u,this.e=this.n=null}c(u){this.h(u)}m(u,b,S=null){this.e||(this.is_svg?this.e=Zt(b.nodeName):this.e=ct(b.nodeType===11?"TEMPLATE":b.nodeName),this.t=b.tagName!=="TEMPLATE"?b:b.content,this.c(u)),this.i(S)}h(u){this.e.innerHTML=u,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(u){for(let b=0;b<this.n.length;b+=1)Ie(this.t,this.n[b],u)}p(u){this.d(),this.h(u),this.i(this.a)}d(){this.n.forEach(fe)}}let dt;function lt(s){dt=s}function On(){if(!dt)throw new Error("Function called outside component initialization");return dt}function Mn(s){On().$$.on_mount.push(s)}const Xe=[],Kt=[];let Ze=[];const Wt=[],Pn=Promise.resolve();let Rt=!1;function Rn(){Rt||(Rt=!0,Pn.then(en))}function Vt(s){Ze.push(s)}const Tt=new Set;let We=0;function en(){if(We!==0)return;const s=dt;do{try{for(;We<Xe.length;){const u=Xe[We];We++,lt(u),Vn(u.$$)}}catch(u){throw Xe.length=0,We=0,u}for(lt(null),Xe.length=0,We=0;Kt.length;)Kt.pop()();for(let u=0;u<Ze.length;u+=1){const b=Ze[u];Tt.has(b)||(Tt.add(b),b())}Ze.length=0}while(Xe.length);for(;Wt.length;)Wt.pop()();Rt=!1,Tt.clear(),lt(s)}function Vn(s){if(s.fragment!==null){s.update(),yt(s.before_update);const u=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,u),s.after_update.forEach(Vt)}}function jn(s){const u=[],b=[];Ze.forEach(S=>s.indexOf(S)===-1?u.push(S):b.push(S)),b.forEach(S=>S()),Ze=u}const Dn=new Set;function Jn(s,u){s&&s.i&&(Dn.delete(s),s.i(u))}function Hn(s,u,b){const{fragment:S,after_update:x}=s.$$;S&&S.m(u,b),Vt(()=>{const V=s.$$.on_mount.map(Xt).filter(Qt);s.$$.on_destroy?s.$$.on_destroy.push(...V):yt(V),s.$$.on_mount=[]}),x.forEach(Vt)}function Fn(s,u){const b=s.$$;b.fragment!==null&&(jn(b.after_update),yt(b.on_destroy),b.fragment&&b.fragment.d(u),b.on_destroy=b.fragment=null,b.ctx=[])}function qn(s,u){s.$$.dirty[0]===-1&&(Xe.push(s),Rn(),s.$$.dirty.fill(0)),s.$$.dirty[u/31|0]|=1<<u%31}function Gn(s,u,b,S,x,V,N=null,v=[-1]){const R=dt;lt(s);const $=s.$$={fragment:null,ctx:[],props:V,update:Qe,not_equal:x,bound:zt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(u.context||(R?R.$$.context:[])),callbacks:zt(),dirty:v,skip_bound:!1,root:u.target||R.$$.root};N&&N($.root);let W=!1;if($.ctx=b?b(s,u.props||{},(J,F,...H)=>{const q=H.length?H[0]:F;return $.ctx&&x($.ctx[J],$.ctx[J]=q)&&(!$.skip_bound&&$.bound[J]&&$.bound[J](q),W&&qn(s,J)),F}):[],$.update(),W=!0,yt($.before_update),$.fragment=S?S($.ctx):!1,u.target){if(u.hydrate){const J=Tn(u.target);$.fragment&&$.fragment.l(J),J.forEach(fe)}else $.fragment&&$.fragment.c();u.intro&&Jn(s.$$.fragment),Hn(s,u.target,u.anchor),en()}lt(R)}class zn{constructor(){je(this,"$$");je(this,"$$set")}$destroy(){Fn(this,1),this.$destroy=Qe}$on(u,b){if(!Qt(b))return Qe;const S=this.$$.callbacks[u]||(this.$$.callbacks[u]=[]);return S.push(b),()=>{const x=S.indexOf(b);x!==-1&&S.splice(x,1)}}$set(u){this.$$set&&!$n(u)&&(this.$$.skip_bound=!0,this.$$set(u),this.$$.skip_bound=!1)}}const Kn="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Kn);const Yt="blockscape:apicurioConfig",Ut="http://localhost:8080/apis/registry/v3",Ot="bs",Mt=!1,Pt=!1;function Wn({models:s,getActiveIndex:u,setActive:b,ensureModelMetadata:S,getModelId:x,getModelTitle:V,computeJsonFingerprint:N,uid:v}){let R=null,$=null,W=null,J=null,F=null,H=null,q=null,_=null,O=null;const L={baseUrl:Ut,groupId:Ot,authToken:"",enabled:Mt,useSemver:Pt},j=new Map,ee=new Map;function Y(i){return(i||"").toString().trim().replace(/\/+$/,"")}function z(){return!!(L.baseUrl&&L.groupId)}function ie(){return L.enabled!==!1}function y(){W&&(W.value=L.baseUrl||""),J&&(J.value=L.groupId||""),F&&(F.value=L.authToken||""),H&&(H.checked=ie()),q&&(q.checked=!!L.useSemver)}function p(i="",l="muted"){_&&(_.textContent=i||"",_.classList.remove("is-error","is-success"),l==="error"?_.classList.add("is-error"):l==="success"&&_.classList.add("is-success"))}function X(i){if(!O||(O.innerHTML="",!i))return;const l=document.createElement("p");l.className="apicurio-hint",l.textContent=i,O.appendChild(l)}function D(i){j.clear(),ee.clear(),X(i)}function G(){const i=u(),l=ie(),f=z();if(R){const h=R.dataset.loading==="true",d=l&&f&&i>=0&&!!x(s[i]);R.disabled=!l||h||!d,l?h||(R.textContent="Push to Apicurio"):R.textContent="Enable Apicurio to push"}if($){const h=$.dataset.loading==="true",d=l&&f;$.disabled=!d||h,h||(l?f?$.textContent="List artifacts":$.textContent="Enter details to list":$.textContent="Enable Apicurio to list")}}function I(){y(),ie()?z()?(p("Apicurio push is ready when a model is selected.","muted"),j.size||X("Click “List artifacts” to browse the current group.")):(p("Enter Apicurio connection details to enable push.","muted"),D("Enter registry details to browse artifacts.")):(p("Apicurio integration is off. Enable it to allow pushes.","muted"),D("Apicurio integration is disabled.")),G()}function ce(){if(window!=null&&window.localStorage)try{localStorage.setItem(Yt,JSON.stringify(L))}catch(i){console.warn("[Blockscape] unable to persist Apicurio settings",i)}}function re(){let i={};if(window!=null&&window.localStorage)try{const w=localStorage.getItem(Yt);if(w){const B=JSON.parse(w);B&&typeof B=="object"&&(i=B)}}catch(w){console.warn("[Blockscape] failed to restore Apicurio settings",w)}const l=Y(i.baseUrl??Ut),f=(i.groupId??Ot).toString().trim();let h=Mt,d=Pt;typeof i.enabled=="boolean"?h=i.enabled:typeof i.enabled=="string"&&(h=i.enabled==="true"),typeof i.useSemver=="boolean"?d=i.useSemver:typeof i.useSemver=="string"&&(d=i.useSemver==="true"),L.baseUrl=l||Ut,L.groupId=f||Ot,L.authToken=(i.authToken??"").toString().trim(),L.enabled=h,L.useSemver=d,I()}function te(){const i={Accept:"application/json"},l=(L.authToken||"").trim();return l&&(i.Authorization=/\s/.test(l)?l:`Bearer ${l}`),i}function le(i,l,{title:f,description:h,version:d}={}){const w={artifactId:i,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:l}}};return d&&(w.firstVersion.version=d),f&&(w.name=f),h&&(w.description=h),w}function De(i,{version:l}={}){const f={content:{contentType:"application/json",content:i}};return l&&(f.version=l),f}function _e(i){if(i==null)return null;const l=String(i).trim();if(!l)return null;const f=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(l);if(f)return{major:Number(f[1]),minor:Number(f[2]),patch:Number(f[3])};const h=/^v?(\d+)$/.exec(l);return h?{major:Number(h[1]),minor:0,patch:0}:null}function Be(i){return`${i.major}.${i.minor}.${i.patch}`}function Te(i,l){return!i&&!l?0:i?l?i.major!==l.major?i.major-l.major:i.minor!==l.minor?i.minor-l.minor:i.patch-l.patch:1:-1}function Le(i=[]){let l=null;if(i.forEach(h=>{const d=_e((h==null?void 0:h.version)??h);d&&(!l||Te(d,l)>0)&&(l=d)}),!l)return"1.0.0";const f={...l,patch:l.patch+1};return Be(f)}function Ue(i){return Array.isArray(i)?i:Array.isArray(i==null?void 0:i.artifacts)?i.artifacts:Array.isArray(i==null?void 0:i.items)?i.items:Array.isArray(i==null?void 0:i.results)?i.results:[]}function me(i){return Array.isArray(i)?i:Array.isArray(i==null?void 0:i.versions)?i.versions:Array.isArray(i==null?void 0:i.items)?i.items:[]}function ye(i=[]){if(!Array.isArray(i)||!i.length)return null;const l=[...i].filter(Boolean);return l.sort((f,h)=>{const d=f!=null&&f.createdOn?new Date(f.createdOn).getTime():0,w=h!=null&&h.createdOn?new Date(h.createdOn).getTime():0;if(d!==w)return w-d;const B=Number(f==null?void 0:f.version),k=Number(h==null?void 0:h.version),T=Number.isFinite(B),A=Number.isFinite(k);if(T&&A&&B!==k)return k-B;const M=String((f==null?void 0:f.version)??"");return String((h==null?void 0:h.version)??"").localeCompare(M,void 0,{numeric:!0})}),l[0]||null}function Oe(i){if(!i)return i;let l=i;if(!Array.isArray(i==null?void 0:i.categories)){const h=i==null?void 0:i.content;if(typeof h=="string")try{l=JSON.parse(h)}catch(d){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",d)}else h&&typeof h=="object"&&(l=h)}return l}async function he(i,l,f){const h=encodeURIComponent(l),d=encodeURIComponent(f),w=`${i}/groups/${h}/artifacts/${d}`,B=te();B.Accept="application/json";const k=await fetch(w,{method:"GET",headers:B});if(!k.ok){let T=k.statusText||"Unknown error";try{const A=await k.text();A&&(T=A.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${k.status}): ${T}`)}return k.json()}async function we(i,l,f){const h=encodeURIComponent(l),d=encodeURIComponent(f),w=`${i}/groups/${h}/artifacts/${d}/versions?limit=50&order=desc`,B=te();B.Accept="application/json";const k=await fetch(w,{method:"GET",headers:B});if(!k.ok){let A=k.statusText||"Unknown error";try{const M=await k.text();M&&(A=M.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${k.status}): ${A}`)}const T=await k.json();return me(T).filter(A=>A&&A.version!=null)}async function oe(i,l,f,h="latest"){const d=encodeURIComponent(l),w=encodeURIComponent(f),B=encodeURIComponent(h||"latest"),k=`${i}/groups/${d}/artifacts/${w}/versions/${B}/content`,T=te();T.Accept="application/json, application/*+json, */*;q=0.8";const A=await fetch(k,{method:"GET",headers:T});if(!A.ok){let xe=A.statusText||"Unknown error";try{const ke=await A.text();ke&&(xe=ke.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${A.status}): ${xe}`)}const M=await A.text();let de=null;try{de=JSON.parse(M)}catch{throw new Error("Artifact content is not valid JSON.")}return Oe(de)}async function wt(i,l,f,h="latest"){const d=await oe(i,l,f,h);return{data:d,fingerprint:N(d)}}async function ae(i,l,f){try{const d=await we(i,l,f);if(d!=null&&d.length){ee.set(f,d);const w=ye(d);if((w==null?void 0:w.version)!=null)return w.version}}catch(d){console.warn("[Blockscape] compare-version: unable to fetch versions list",d)}try{const d=await he(i,l,f);if((d==null?void 0:d.version)!=null)return d.version}catch(d){console.warn("[Blockscape] compare-version: unable to fetch metadata",d)}const h=ee.get(f);if(h&&h.length){const d=ye(h);if((d==null?void 0:d.version)!=null)return d.version}return"latest"}async function Et(i,l,f,h){if(!L.useSemver)return null;if(!h)return"1.0.0";try{const d=await we(i,l,f);return Le(d)}catch(d){throw new Error(`Unable to compute next semantic version: ${d.message}`)}}function ge(i=document){R=i.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),$=i.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),W=i.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),J=i.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),F=i.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),H=i.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),q=i.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),_=i.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),O=i.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function ut(){L.baseUrl=Y((W==null?void 0:W.value)??L.baseUrl),L.groupId=((J==null?void 0:J.value)??"").trim(),L.authToken=((F==null?void 0:F.value)??"").trim(),ce(),I()}function xt(){L.enabled=H?H.checked:Mt,ce(),I()}function kt(){L.useSemver=q?q.checked:Pt,ce(),I()}function Se(){[W,J,F].forEach(i=>{i&&i.addEventListener("input",ut)}),R&&R.addEventListener("click",()=>{ft()}),H&&H.addEventListener("change",xt),q&&q.addEventListener("change",kt),$&&$.addEventListener("click",mt),O&&O.addEventListener("click",i=>{const l=i.target.closest("[data-artifact-version]");if(l){i.stopPropagation();const d=l.dataset.artifactId,w=l.dataset.artifactVersion;d&&w&&se(d,w);return}const f=i.target.closest("[data-artifact-load-all]");if(f){i.stopPropagation();const d=f.dataset.artifactId;d&&Me(d);return}const h=i.target.closest("[data-artifact-trigger]");if(h){const d=h.dataset.artifactId;if(!d)return;It(d)}})}function Ee(){const i=document.createElement("div");return i.className="blockscape-registry-panel",i.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,i}function At(i){if(!i)return;i.innerHTML="";const l=Ee();i.appendChild(l),ge(i),Se(),I()}function et(i){if(!O)return;if(O.innerHTML="",!i.length){X("No artifacts found in this group.");return}const l=document.createElement("ul");l.className="apicurio-artifact-list",i.forEach(f=>{if(!(f!=null&&f.artifactId))return;const h=document.createElement("li"),d=document.createElement("button");d.type="button",d.className="apicurio-artifact",d.dataset.artifactId=f.artifactId,d.dataset.artifactTrigger="toggle";const w=document.createElement("span");w.className="apicurio-artifact-title",w.textContent=f.artifactId,d.appendChild(w);const B=[];if(f.name&&B.push(f.name),f.version!=null&&B.push(`v${f.version}`),f.type&&B.push(f.type),B.length){const A=document.createElement("span");A.className="apicurio-artifact-meta",A.textContent=B.join(" • "),d.appendChild(A)}if(f.description){const A=document.createElement("span");A.className="apicurio-artifact-meta",A.textContent=f.description,d.appendChild(A)}h.appendChild(d);const k=document.createElement("div");k.className="apicurio-version-list",k.dataset.versionPanel=f.artifactId,k.hidden=!0;const T=document.createElement("p");T.className="apicurio-hint",T.textContent="Click above to choose a version to load.",k.appendChild(T),h.appendChild(k),l.appendChild(h)}),O.appendChild(l)}function qe(i){return O?O.querySelector(`[data-version-panel="${i}"]`):null}function Je(i,l){if(!i||(i.innerHTML="",!l))return;const f=document.createElement("p");f.className="apicurio-hint",f.textContent=l,i.appendChild(f)}function Ct(i,l){const f=qe(i);if(!f)return;if(f.innerHTML="",!l.length){Je(f,"No versions found for this artifact.");return}l.forEach(d=>{const w=document.createElement("button");w.type="button",w.className="apicurio-version-button",w.dataset.artifactId=i,w.dataset.artifactVersion=d.version;const B=[`Version ${d.version}`];if(d.createdOn){const k=new Date(d.createdOn);isNaN(k)||B.push(k.toISOString().slice(0,10))}w.textContent=B.join(" — "),f.appendChild(w)});const h=document.createElement("button");h.type="button",h.className="apicurio-version-button",h.dataset.artifactId=i,h.dataset.artifactLoadAll="true",h.textContent=`Load all (${l.length})`,f.appendChild(h)}async function It(i){const l=qe(i);if(!l)return;if(l.dataset.open==="true"){l.hidden=!0,l.dataset.open="false";return}if(l.hidden=!1,l.dataset.open="true",l.dataset.loaded!=="true"){if(!z()){Je(l,"Enter registry details first.");return}Je(l,"Loading versions…");try{const h=Y(L.baseUrl),d=L.groupId.trim(),w=await we(h,d,i);ee.set(i,w),l.dataset.loaded="true",Ct(i,w)}catch(h){console.error("[Blockscape] failed to load versions",h),Je(l,`Unable to fetch versions: ${h.message}`)}}}function pt(i,l){var h;const f=s.findIndex(d=>d.apicurioArtifactId===i);if(f!==-1){const d=s[f].id;s[f]={...l,id:d||l.id},((h=s[f].apicurioVersions)==null?void 0:h.length)>1&&(s[f].isSeries=!0),b(f)}else s.push(l),b(s.length-1)}async function tt(i,l,f,h){const d=encodeURIComponent(l),w=encodeURIComponent(f),B=`${i}/groups/${d}/artifacts/${w}`;try{const k=await fetch(B,{method:"GET",headers:h});if(k.status===404)return!1;if(k.ok)return!0;throw k.status===401||k.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${k.status} while checking the artifact.`)}catch(k){throw k instanceof TypeError?new Error("Network error while contacting Apicurio registry."):k}}async function ft(){var B;if(!R||R.dataset.loading==="true")return;if(!ie()){p("Apicurio integration is off. Enable it first.","error");return}if(!z()){p("Enter the registry base URL and group ID before pushing.","error");return}const i=u();if(i<0||!s[i]){p("No active model to push.","error");return}const l=x(s[i]);if(!l){p("Active model needs an id before pushing.","error");return}const f=Y(L.baseUrl),h=L.groupId.trim(),d=JSON.stringify(s[i].data,null,2),w=te();R.dataset.loading="true",R.textContent="Pushing…",R.disabled=!0,p("Pushing to Apicurio…","muted");try{const k=await tt(f,h,l,w),T=N(s[i].data);if(k)try{const Q=await ae(f,h,l),{data:Re,fingerprint:He}=await wt(f,h,l,Q);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",Q),console.log("local fingerprint",T),console.log("registry fingerprint",He),console.log("local payload",s[i].data),console.log("registry payload",Re),console.groupEnd(),T&&He&&T===He){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){p("Push cancelled (content matches the latest registry version).","muted");return}p("Pushing identical content by user choice.","muted")}else He?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):p("Unable to compare with registry content (skipping confirmation).","muted")}catch(Q){console.warn("[Blockscape] unable to compare registry content before push",Q),p("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const A=L.useSemver?await Et(f,h,l,k):null;if(L.useSemver&&!A)throw new Error("Semantic versioning is enabled but no version could be computed.");const M=encodeURIComponent(h),de=encodeURIComponent(l),xe=k?`${f}/groups/${M}/artifacts/${de}/versions`:`${f}/groups/${M}/artifacts`,ke={...w,"Content-Type":"application/json"};A&&(ke["X-Registry-Version"]=A,p(`Pushing to Apicurio as version ${A}…`,"muted"));const nt=k?De(d,{version:A}):le(l,d,{title:V(s[i]),description:(B=s[i].data)==null?void 0:B.abstract,version:A}),Pe=await fetch(xe,{method:"POST",headers:ke,body:JSON.stringify(nt)});if(!Pe.ok){let Q=Pe.statusText||"Unknown error";try{const Re=await Pe.text();Re&&(Q=Re.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${Pe.status}): ${Q}`)}let Ae=null;try{Ae=await Pe.json()}catch{Ae=null}const Ne=(Ae==null?void 0:Ae.version)||(Ae==null?void 0:Ae.globalId)||"",Lt=k?"Updated":"Created",rt=Ne?` (version ${Ne})`:"";p(`${Lt} ${l}${rt}`,"success")}catch(k){console.error("[Blockscape] Apicurio push failed",k),p(`Apicurio push failed: ${k.message}`,"error")}finally{R.dataset.loading="false",G()}}async function mt(){if(!$||$.dataset.loading==="true")return;if(!ie()){p("Enable Apicurio integration to list artifacts.","error");return}if(!z()){p("Enter registry base URL and group ID before listing.","error");return}const i=Y(L.baseUrl),l=L.groupId.trim(),f=encodeURIComponent(l),h=`${i}/groups/${f}/artifacts?limit=50&offset=0`;$.dataset.loading="true",$.textContent="Listing…",$.disabled=!0,p("Listing artifacts…","muted"),X("Contacting registry…");try{const d=te();d.Accept="application/json";const w=await fetch(h,{method:"GET",headers:d});if(!w.ok){let A=w.statusText||"Unknown error";try{const M=await w.text();M&&(A=M.slice(0,400))}catch{}throw new Error(`Failed to list artifacts (${w.status}): ${A}`)}const B=await w.json(),k=Ue(B).filter(A=>A&&A.artifactId);j.clear(),ee.clear(),k.forEach(A=>{A!=null&&A.artifactId&&j.set(A.artifactId,A)}),et(k);const T=k.length;p(T?`Found ${T} artifact${T===1?"":"s"}.`:"No artifacts found in this group.",T?"success":"muted")}catch(d){console.error("[Blockscape] failed to list artifacts",d),D("Unable to list artifacts."),p(`Listing failed: ${d.message}`,"error")}finally{$.dataset.loading="false",G()}}async function se(i,l=null){if(!i)return;if(!ie()){p("Enable Apicurio integration to load artifacts.","error");return}if(!z()){p("Enter registry connection details before loading artifacts.","error");return}const f=Y(L.baseUrl),h=L.groupId.trim();let d=j.get(i);const w=async()=>{try{const M=await he(f,h,i);return M!=null&&M.artifactId&&j.set(i,M),M}catch(M){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",M),M}};if(!d)try{d=await w()}catch(M){p(`Failed to fetch artifact metadata: ${M.message}`,"error");return}const B=ee.get(i)||[];let k="latest",T="latest";if(l)k=l,T=l;else{if(!d||d.version==null)try{d=await w()}catch(M){p(`Failed to fetch artifact metadata: ${M.message}`,"error");return}k=(d==null?void 0:d.version)||"latest",T=(d==null?void 0:d.version)||"latest"}const A=B.find(M=>String(M.version)===String(k));(A==null?void 0:A.version)!=null&&(T=A.version),p(`Loading artifact ${i}…`,"muted");try{const M=await oe(f,h,i,k),de=j.get(i)||d||{};S(M,{titleHint:de.name||i,idHint:i});const xe={version:T,data:M,createdOn:(A==null?void 0:A.createdOn)||de.createdOn},ke={id:v(),title:M.title||de.name||i,data:M,apicurioArtifactId:i,apicurioArtifactName:de.name||"",apicurioVersions:[xe],apicurioActiveVersionIndex:0};pt(i,ke);const nt=T?` (version ${T})`:"";p(`Loaded artifact ${i}${nt}.`,"success")}catch(M){console.error("[Blockscape] failed to load artifact",M),p(`Failed to load artifact: ${M.message}`,"error")}}async function Me(i){if(!i)return;if(!ie()){p("Enable Apicurio integration to load artifacts.","error");return}if(!z()){p("Enter registry connection details before loading artifacts.","error");return}const l=Y(L.baseUrl),f=L.groupId.trim();let h=ee.get(i);if(!h){Je(qe(i),"Loading versions…");try{h=await we(l,f,i),ee.set(i,h)}catch(T){p(`Failed to fetch versions: ${T.message}`,"error");return}}const d=(h||[]).filter(T=>T&&T.version!=null);if(!d.length){p("No versions found for this artifact.","muted");return}p(`Loading ${d.length} version(s) for ${i}…`,"muted");const w=j.get(i)||{},B=[];try{for(const T of d){const A=T.version??"latest",M=await oe(l,f,i,A);S(M,{titleHint:w.name||i,idHint:i}),B.push({version:A,createdOn:T.createdOn,data:M})}}catch(T){console.error("[Blockscape] failed to load one or more versions",T),p(`Failed to load all versions: ${T.message}`,"error");return}if(!B.length){p("No versions loaded from registry.","error");return}const k={id:v(),title:B[0].data.title||w.name||i,data:B[0].data,apicurioArtifactId:i,apicurioArtifactName:w.name||"",apicurioVersions:B,apicurioActiveVersionIndex:0};pt(i,k),p(`Loaded ${B.length} version(s) for ${i}.`,"success")}return{hydrateConfig:re,mount:At,updateAvailability:G}}function Ye(s,u){if(typeof s!="function")throw new Error(`[itemEditor] expected ${u} to be a function`)}function Yn(s,{excludeId:u}={}){if(!s)return[];const b=s.split(/[\s,]+/).map(x=>x.trim()).filter(Boolean),S=[];return b.forEach(x=>{u&&x===u||S.includes(x)||S.push(x)}),S}function Xn(s,u,b){if(!u||!b||u===b)return;((s==null?void 0:s.categories)||[]).forEach(x=>{(x.items||[]).forEach(V=>{Array.isArray(V.deps)&&(V.deps=V.deps.map(N=>N===u?b:N))})}),Array.isArray(s==null?void 0:s.links)&&s.links.forEach(x=>{x.from===u&&(x.from=b),x.to===u&&(x.to=b)})}function Qn({findItemAndCategoryById:s,collectAllItemIds:u,updateItemReferences:b,loadActiveIntoEditor:S,rebuildFromActive:x,select:V,onSelectionRenamed:N}={}){Ye(s,"findItemAndCategoryById"),Ye(u,"collectAllItemIds"),Ye(b,"updateItemReferences"),Ye(S,"loadActiveIntoEditor"),Ye(x,"rebuildFromActive"),Ye(V,"select");const v={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function R(_){if(v.fields.errorEl){if(!_){v.fields.errorEl.hidden=!0,v.fields.errorEl.textContent="";return}v.fields.errorEl.hidden=!1,v.fields.errorEl.textContent=_}}function $(){v.wrapper&&(v.wrapper.hidden=!0,v.wrapper.setAttribute("aria-hidden","true"),R(""),v.categoryId=null,v.itemId=null,v.modelData=null,document.body.classList.remove("item-editor-open"))}function W(){v.wrapper&&(v.wrapper.hidden=!1,v.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var _,O;(_=v.fields.nameInput)==null||_.focus(),(O=v.fields.nameInput)==null||O.select()}))}function J(_){var p;if(!v.modelData||!v.categoryId||!v.itemId)throw new Error("No item loaded.");const L=(((p=v.modelData)==null?void 0:p.categories)||[]).find(X=>X.id===v.categoryId);if(!L)throw new Error("Category not found.");L.items=L.items||[];const j=L.items.find(X=>X.id===v.itemId);if(!j)throw new Error("Item not found.");const ee=(_.id||"").trim();if(!ee)throw new Error("ID is required.");const Y=u(v.modelData);if(ee!==j.id&&Y.has(ee))throw new Error("Another item already uses that ID.");j.id=ee;const z=(_.name||"").trim();j.name=z||j.id;const ie=(_.logo||"").trim();if(ie?j.logo=ie:delete j.logo,_.externalFlag&&!_.external)j.external=!0;else{const X=(_.external??"").toString().trim();X?j.external=X:delete j.external}const y=(_.color||"").trim();return y?j.color=y:delete j.color,j.deps=Array.isArray(_.deps)?_.deps:[],j.id!==_.originalId&&typeof N=="function"&&N(_.originalId,j.id),b(v.modelData,_.originalId,j.id),S(),x(),V(j.id),j.id}function F(){if(!v.fields||!v.fields.idInput)return!1;const _=(v.fields.idInput.value||"").trim(),O={originalId:v.itemId,id:_,name:v.fields.nameInput.value||"",logo:v.fields.logoInput.value||"",external:v.fields.externalInput.value||"",externalFlag:v.fields.externalFlagInput.checked,color:v.fields.colorInput.value||"",deps:Yn(v.fields.depsInput.value,{excludeId:_})};try{return J(O),$(),!0}catch(L){return console.warn("[itemEditor] item edit failed",L),R((L==null?void 0:L.message)||"Unable to save item."),!1}}function H(){if(v.wrapper)return v.wrapper;const _=document.createElement("div");_.className="item-editor-modal",_.hidden=!0,_.setAttribute("role","dialog"),_.setAttribute("aria-modal","true");const O=document.createElement("div");O.className="item-editor-modal__backdrop",_.appendChild(O);const L=document.createElement("div");L.className="item-editor",_.appendChild(L);const j=document.createElement("div");j.className="item-editor__header";const ee=document.createElement("h2");ee.className="item-editor__title",ee.textContent="Edit item";const Y=document.createElement("button");Y.type="button",Y.className="item-editor__close",Y.setAttribute("aria-label","Close item editor"),Y.textContent="×",j.appendChild(ee),j.appendChild(Y),L.appendChild(j);const z=document.createElement("form");z.className="item-editor__form",L.appendChild(z);const ie=document.createElement("div");ie.className="item-editor__meta",ie.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',z.appendChild(ie);const y=document.createElement("div");y.className="item-editor__error",y.hidden=!0,z.appendChild(y);const p=(me,ye,Oe)=>{const he=document.createElement("label");he.className="item-editor__field";const we=document.createElement("span");if(we.className="item-editor__label",we.textContent=me,he.appendChild(we),ye.classList.add("item-editor__control"),he.appendChild(ye),Oe){const oe=document.createElement("div");oe.className="item-editor__hint",oe.textContent=Oe,he.appendChild(oe)}return he},X=document.createElement("input");X.type="text",X.required=!0,z.appendChild(p("ID",X,"Unique identifier used for links and dependencies."));const D=document.createElement("input");D.type="text",z.appendChild(p("Name",D,"Visible label shown on the tile."));const G=document.createElement("input");G.type="url",G.inputMode="url",G.placeholder="https://…",z.appendChild(p("Logo URL",G,"Optional image URL."));const I=document.createElement("input");I.type="url",I.inputMode="url",I.placeholder="https://…",z.appendChild(p("External link",I,"Shown with ↗ icon and in preview."));const ce=document.createElement("div");ce.className="item-editor__checkbox";const re=document.createElement("label");re.className="item-editor__checkbox-row";const te=document.createElement("input");te.type="checkbox";const le=document.createElement("span");le.textContent="Mark as external without link";const De=document.createElement("div");De.className="item-editor__hint",De.textContent="Keeps dashed border even without a URL.",re.appendChild(te),re.appendChild(le),ce.appendChild(re),ce.appendChild(De),z.appendChild(ce);const _e=document.createElement("input");_e.type="text",_e.placeholder="#2563eb",z.appendChild(p("Color",_e,"Optional badge color (hex or CSS color)."));const Be=document.createElement("textarea");Be.rows=2,Be.placeholder="Comma or space separated ids",z.appendChild(p("Dependencies",Be,"Use item IDs, separated by commas or spaces."));const Te=document.createElement("div");Te.className="item-editor__actions";const Le=document.createElement("button");Le.type="button",Le.className="pf-v5-c-button pf-m-tertiary",Le.textContent="Cancel";const Ue=document.createElement("button");return Ue.type="submit",Ue.className="pf-v5-c-button pf-m-primary",Ue.textContent="Save",Te.appendChild(Le),Te.appendChild(Ue),z.appendChild(Te),v.wrapper=_,v.fields={idInput:X,nameInput:D,logoInput:G,externalInput:I,externalFlagInput:te,colorInput:_e,depsInput:Be,categoryValue:ie.querySelector(".item-editor__meta-value"),errorEl:y},Le.addEventListener("click",$),Y.addEventListener("click",$),O.addEventListener("click",$),z.addEventListener("submit",me=>{me.preventDefault(),F()}),document.addEventListener("keydown",me=>{me.key==="Escape"&&!_.hidden&&(me.preventDefault(),me.stopPropagation(),$())}),document.body.appendChild(_),_}function q(_){const O=s(_);return O?(H(),v.categoryId=O.category.id,v.itemId=O.item.id,v.modelData=O.modelData,v.fields.categoryValue.textContent=O.category.title||O.category.id,v.fields.idInput.value=O.item.id||"",v.fields.nameInput.value=O.item.name||"",v.fields.logoInput.value=O.item.logo||"",v.fields.externalInput.value=typeof O.item.external=="string"?O.item.external:"",v.fields.externalFlagInput.checked=O.item.external===!0,v.fields.colorInput.value=O.item.color||"",v.fields.depsInput.value=Array.isArray(O.item.deps)?O.item.deps.join(", "):"",R(""),V(O.item.id),W(),!0):!1}return{open:q,hide:$,isOpen:()=>!!v.wrapper&&!v.wrapper.hidden}}const vt=typeof import.meta<"u"&&"./"||"";function Zn(){console.log("[Blockscape] init");const s=document.getElementById("jsonBox"),u=document.querySelector(".blockscape-json-panel"),b=document.getElementById("app"),S=document.getElementById("overlay"),x=document.getElementById("tabTooltip"),V=document.getElementById("modelList"),N=document.getElementById("itemPreview"),v=document.getElementById("urlForm"),R=document.getElementById("urlInput"),$=document.getElementById("loadUrl"),W=N.querySelector(".item-preview__title"),J=N.querySelector(".item-preview__body"),F=N.querySelector(".item-preview__actions"),H=N.querySelector(".item-preview__close"),q=document.getElementById("downloadJson"),_=document.getElementById("shareModel"),O=document.getElementById("createVersion"),L=document.getElementById("openInEditor"),j=document.getElementById("copyJson"),ee=document.getElementById("pasteJson"),Y="blockscape:editorPayload",z="blockscape:editorTransfer",ie=document.title;s.value=document.getElementById("seed").textContent.trim();let y=[],p=-1;const X=Wn({models:y,getActiveIndex:()=>p,setActive:se,ensureModelMetadata:oe,getModelId:ge,getModelTitle:ae,computeJsonFingerprint:we,uid:le});let D=null,G=new Map,I=null,ce=0,re={x:0,y:0},te=null;X.hydrateConfig();function le(){return Math.random().toString(36).slice(2,10)}function De(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(r=>{n+=String.fromCharCode(r)}),btoa(n)}function _e(e){const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new TextDecoder().decode(n)}function Be(e){return De(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Te(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),_e(t)}function Le(e,t){const n=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=e,o.click(),URL.revokeObjectURL(r)}async function Ue(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function me(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function ye(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function Oe(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(r=>Oe(r)).join(",")}]`:`{${Object.keys(e).sort().map(r=>`${JSON.stringify(r)}:${Oe(e[r])}`).join(",")}}`}function he(e){try{return Oe(e)}catch{return""}}function we(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=he(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=he(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}function oe(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const r=(e.title??"").toString().trim();e.title=r||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const a=n||e.title||t||"model",c=ye(a).replace(/\./g,"-");e.id=c||`model-${le()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function wt(e){return JSON.parse(JSON.stringify(e))}function ae(e,t="Untitled Model"){var r;return e&&(((r=e.data)==null?void 0:r.title)??e.title??"").toString().trim()||t}function Et(e,t="Untitled Model"){var o;const n=ge(e);return(((o=e==null?void 0:e.apicurioVersions)==null?void 0:o.length)>1||(e==null?void 0:e.isSeries))&&n?`${n} series`:ae(e,t)}function ge(e){var r;const t=(r=e==null?void 0:e.data)==null?void 0:r.id;return t&&t.toString().trim()||null}function ut(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(r=>{r!=null&&r.id&&t.add(r.id)})),t}function xt(e){if(p<0||!e)return null;const t=y[p].data,n=(t==null?void 0:t.categories)||[];for(const r of n){const a=(r.items||[]).find(c=>c.id===e);if(a)return{category:r,item:a,modelData:t}}return null}function kt(e,t){const n=ut(t);let r=ye(e||"item");if(!n.has(r))return r;const o=()=>le().slice(0,4);for(;n.has(r);)r=`${ye(e||"item")}-${o()}`;return r}const Se=Qn({findItemAndCategoryById:xt,collectAllItemIds:ut,updateItemReferences:Xn,loadActiveIntoEditor:i,rebuildFromActive:$e,select:e=>Q(e),onSelectionRenamed:(e,t)=>{var n;I===e&&(I=t),((n=te==null?void 0:te.item)==null?void 0:n.id)===e&&(te.item.id=t)}});function Ee(e,{versionLabel:t,createdOn:n}={}){var m,g;const r=ge(e);if(!r)return y.push(e),y.length-1;const o=y.findIndex(C=>ge(C)===r);if(o===-1)return y.push(e),y.length-1;const a=y[o];(!Array.isArray(a.apicurioVersions)||!a.apicurioVersions.length)&&(a.apicurioVersions=[{version:"1",data:a.data,createdOn:(g=(m=a.apicurioVersions)==null?void 0:m[0])==null?void 0:g.createdOn}],a.apicurioActiveVersionIndex=0);const c=String(a.apicurioVersions.length+1);return a.apicurioVersions.push({version:c,data:e.data,createdOn:n||new Date().toISOString()}),a.apicurioActiveVersionIndex=a.apicurioVersions.length-1,a.data=e.data,a.title=ae(e)||a.title,a.isSeries=!0,o}function At({versionLabel:e}={}){if(p<0||!y[p])throw new Error("Load or select a model before creating a version.");let t;try{t=wt(y[p].data)}catch(r){throw console.warn("[Blockscape] failed to clone active model for versioning",r),new Error("Could not copy the current model.")}return oe(t,{titleHint:ae(y[p]),idHint:ge(y[p])}),Ee({title:ae(y[p]),data:t},{versionLabel:e||"manual",createdOn:new Date().toISOString()})}function et(){const e=p>=0&&y[p]?y[p]:null,t=ge(e);document.title=t?`${t}-blockscape`:ie}function qe(e="shortcut"){const t=s.value||"";if(!t.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const n=ae(y[p],"blockscape"),r=`${ye(n)}.json`;return Le(r,t),console.log(`[Blockscape] saved JSON (${e}):`,r),!0}const Je={A:"#ef4444",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#f43f5e",P:"#e11d48",Q:"#dc2626",R:"#f59e0b",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function Ct(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return Je[n]||"#9ca3af"}function It(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(g=>g+g).join(""):t,r=parseInt(n,16),o=r>>16&255,a=r>>8&255,c=r&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(a/255,2.2)+.0722*Math.pow(c/255,2.2)>.35?"#111111":"#ffffff"}function pt(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}let tt=!1;function ft(){tt||(tt=!0,requestAnimationFrame(()=>{tt=!1,rt(),Ge()}))}let mt=!1;function se(e){if(be(),te=null,e<0||e>=y.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}p=e,console.log("[Blockscape] active model:",ae(y[e]),"(index",e+" )"),et(),Me(),i(),$e(),X.updateAvailability()}function Me(){if(V.innerHTML="",!y.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",V.appendChild(e);return}y.forEach((e,t)=>{var P;const n=document.createElement("li");n.className="model-nav-item";const r=document.createElement("button");r.type="button",r.className="model-nav-button"+(t===p?" is-active":""),r.dataset.index=String(t),r.setAttribute("aria-current",t===p?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const a=document.createElement("span");a.className="model-nav-title",a.textContent=Et(e),o.appendChild(a);const c=ge(e);if(c){const Z=document.createElement("span");Z.className="model-nav-id",Z.textContent=c,o.appendChild(Z)}const m=Array.isArray((P=e.data)==null?void 0:P.categories)?e.data.categories:[],g=m.reduce((Z,ve)=>Z+(ve.items||[]).length,0),C=document.createElement("span");C.className="model-nav-meta";const U=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";C.textContent=`${m.length} cat · ${g} items${U}`,r.appendChild(o),r.appendChild(C),n.appendChild(r),V.appendChild(n)}),X.updateAvailability()}function i(){if(p<0){s.value="";return}s.value=JSON.stringify(y[p].data,null,2)}function l(e){try{return JSON.parse(e)}catch{return null}}function f(e,t="Pasted"){const n=(e||"").trim();if(!n)return[];const r=l(n);return r?(Array.isArray(r)?r:[r]).map((c,m)=>(oe(c,{titleHint:`${t} #${m+1}`}),{id:le(),title:c.title||`${t} #${m+1}`,data:c})):n.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,c)=>{const m=JSON.parse(a);return oe(m,{titleHint:`${t} #${c+1}`}),{id:le(),title:m.title||`${t} #${c+1}`,data:m}})}function h(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function d(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!h(e)}function w(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function B(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(Y)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(Y)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(Y)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=f(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let r=null;return n.forEach(o=>{const a=Ee(o,{versionLabel:"editor"});r==null&&(r=a)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:r,count:n.length}}function k(e="storage"){const t=B();return!t||typeof t.index!="number"?!1:(se(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function T(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let r;try{const a=Te(t);r=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}return!r||typeof r!="object"||typeof r.data!="object"?(console.warn("[Blockscape] share payload missing data"),null):(oe(r.data,{titleHint:r.title||"Shared Model"}),Ee({id:le(),title:r.data.title||r.title||"Shared Model",data:r.data},{versionLabel:"shared"}))}async function A(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const r=new URLSearchParams(window.location.search);r.has("load")&&(t=r.get("load"))}if(!t)return null;try{const r=await Nt(t);return typeof r=="number"?r:null}catch(r){return console.warn("[Blockscape] load param failed",r),null}}function M(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,r=new Set;(e.categories||[]).forEach(a=>(a.items||[]).forEach(c=>{r.add(c.id);const m=new Set(c.deps||[]);(e.links||[]).forEach(g=>{g.from===c.id&&m.add(g.to)}),t.set(c.id,m),m.forEach(g=>{n.has(g)||n.set(g,new Set),n.get(g).add(c.id)})}));const o=new Set;return n.forEach((a,c)=>{((a==null?void 0:a.size)||0)>=2&&o.add(c)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:r}}function de(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),r=44;n.width=r,n.height=r;const o=n.getContext("2d"),a=(e||"?").charAt(0).toUpperCase(),c=Ct(e,t),m=It(c);return o.fillStyle=c,o.beginPath(),o.arc(r/2,r/2,r/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=m,o.font=`bold ${r*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(a,r/2,r/2),n.toDataURL("image/png")}function xe(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function ke(e){const t=xe(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function nt(e,t){var c;if(e<0||e>=y.length)return!1;const n=y[e];if(!((c=n==null?void 0:n.apicurioVersions)!=null&&c.length))return!1;const r=n.apicurioVersions.length,o=(t%r+r)%r,a=n.apicurioVersions[o];return a!=null&&a.data?(n.apicurioActiveVersionIndex=o,n.data=a.data,I=null,i(),$e(),!0):!1}function Pe(e){var r;if(!e||p<0)return;const t=y[p];if(!((r=t==null?void 0:t.apicurioVersions)!=null&&r.length))return;const n=xe(t);n!==-1&&nt(p,n+e)}function Ae(e){if(!(e!=null&&e.apicurioVersions)||e.apicurioVersions.length<=1)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||ge(e)||"Artifact",t.appendChild(n);const r=document.createElement("div");r.className="version-nav__status";const o=xe(e),a=ke(e)||"latest";r.textContent=`No. in series ${a} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(r);const c=document.createElement("div");c.className="version-nav__controls";const m=document.createElement("button");m.type="button",m.className="version-nav__button",m.textContent="Previous",m.addEventListener("click",()=>Pe(-1));const g=document.createElement("button");return g.type="button",g.className="version-nav__button",g.textContent="Next",g.addEventListener("click",()=>Pe(1)),c.appendChild(m),c.appendChild(g),t.appendChild(c),t}function Ne(){if(!D)return;ze(),Array.isArray(D.m.categories)||(D.m.categories=[]),console.log("[Blockscape] rendering categories=",D.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!D.m.abstract,"- value:",D.m.abstract?D.m.abstract.substring(0,50)+"...":"none"),b.innerHTML="",G.clear();const e=Ae(y[p]);e&&b.appendChild(e),S.setAttribute("width",window.innerWidth),S.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=D.m.title&&D.m.title.trim()||ae(y[p]),t.appendChild(n);const r=ke(y[p]),o=(D.m.id??"").toString().trim();if(o){const E=document.createElement("div");E.className="blockscape-model-id",E.textContent=`ID: ${o}`,t.appendChild(E)}if(r){const E=document.createElement("div");E.className="blockscape-model-id",E.textContent=`No. in series: ${r}`,t.appendChild(E)}b.appendChild(t);const a=document.createElement("div");a.className="blockscape-tabs";const c=document.createElement("div");c.className="blockscape-tablist",c.setAttribute("role","tablist"),a.appendChild(c);const m=document.createElement("div");m.className="blockscape-tabpanels",a.appendChild(m);const g=document.createElement("div"),C=document.createElement("div"),U=document.createElement("div"),P=document.createElement("div");let Z="";const ve=[{id:"map",label:"Map",panel:g},{id:"abstract",label:"Info",panel:C},{id:"source",label:"Source",panel:U},{id:"apicurio",label:"Apicurio",panel:P}],In=E=>{if(!S)return;const K=E==="map";S.hidden=!K,K?(rt(),Ge()):S.innerHTML=""};ve.forEach((E,K)=>{const ne=document.createElement("button");ne.type="button",ne.id=`tab-${E.id}`,ne.className="blockscape-tab"+(K===0?" is-active":""),ne.setAttribute("role","tab"),ne.setAttribute("aria-controls",`panel-${E.id}`),ne.setAttribute("aria-selected",K===0?"true":"false"),ne.textContent=E.label,E.button=ne,c.appendChild(ne),E.panel.id=`panel-${E.id}`,E.panel.classList.add("blockscape-tabpanel"),E.panel.setAttribute("role","tabpanel"),E.panel.setAttribute("aria-labelledby",ne.id),E.panel.hidden=K!==0,K===0&&E.panel.classList.add("is-active"),m.appendChild(E.panel)});const Gt=E=>{ve.forEach(K=>{const ne=K.id===E;K.button.classList.toggle("is-active",ne),K.button.setAttribute("aria-selected",ne?"true":"false"),K.panel.classList.toggle("is-active",ne),K.panel.hidden=!ne}),In(E)};ve.forEach(E=>{E.button.addEventListener("click",()=>{ze(),Gt(E.id)}),E.id==="abstract"&&(E.button.addEventListener("mouseenter",()=>Dt(E.button,Z,{offset:12})),E.button.addEventListener("mouseleave",ze),E.button.addEventListener("focus",()=>Dt(E.button,Z,{offset:12})),E.button.addEventListener("blur",ze))}),Gt(ve[0].id),b.appendChild(a);const $t=document.createElement("div");$t.className="blockscape-render",g.appendChild($t);const ht=document.createElement("div");if(ht.className="blockscape-abstract-panel",D.m.abstract){console.log("[Blockscape] Rendering abstract content");const E=document.createElement("div");E.className="blockscape-abstract",E.innerHTML=D.m.abstract,xn(E),ht.appendChild(E),Z=E.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const E=document.createElement("div");E.className="blockscape-abstract-placeholder",E.textContent="No abstract has been provided for this model.",ht.appendChild(E),Z=E.outerHTML}C.appendChild(ht);const gt=document.createElement("div");if(gt.className="blockscape-source-panel",u)u.hidden=!1,u.classList.remove("pf-v5-c-page__main-section"),gt.appendChild(u);else{const E=document.createElement("p");E.className="muted",E.textContent="Source editor unavailable.",gt.appendChild(E)}U.appendChild(gt),X.mount(P),D.m.categories.forEach(E=>{const K=document.createElement("section");K.className="category",K.dataset.cat=E.id;const ne=document.createElement("div");ne.className="cat-head",ne.innerHTML=`<div class="cat-title">${St(E.title||E.id)}</div>
                          <div class="muted cat-count">${(E.items||[]).length} items</div>`,K.appendChild(ne);const bt=document.createElement("div");bt.className="grid",K.appendChild(bt),(E.items||[]).forEach(ue=>{const at=tn(ue.external),Ce=document.createElement("div");Ce.className=at.isExternal?"tile external":"tile",Ce.tabIndex=0,Ce.dataset.id=ue.id,at.url&&(Ce.dataset.externalUrl=at.url);const Fe=document.createElement("img");Fe.className="logo",ue.logo?(Fe.src=ue.logo,Fe.alt=ue.name||ue.id):(Fe.alt="",Fe.style.opacity=1,Fe.src=de(ue.name||ue.id,ue.color));const _t=document.createElement("div");_t.className="name",_t.textContent=ue.name||ue.id;const Bt=document.createElement("div");Bt.className="badge",Bt.textContent="reused",at.url&&Ce.appendChild(nn(at.url)),Ce.appendChild(Fe),Ce.appendChild(_t),Ce.appendChild(Bt),bt.appendChild(Ce),G.set(ue.id,{el:Ce,catId:E.id,rect:null})}),$t.appendChild(K);const ot=document.createElement("button");ot.type="button",ot.className="tile-add",ot.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',ot.addEventListener("click",()=>pn(E.id)),bt.appendChild(ot)}),D.reusedLocal.forEach(E=>{const K=G.get(E);K&&(K.el.classList.add("reused"),K.el.querySelector(".badge").style.display="inline-block")}),Lt(),rt(),Ge()}function Lt(){b.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",t=>{if(typeof t.button=="number"&&t.button!==0)return;be();const n=e.dataset.id;if(console.log("[Blockscape] click",n),I===n){Re();return}Q(n)}),e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e.click())}),e.draggable=!0,e.addEventListener("dragstart",an),e.addEventListener("dragend",sn)}),b.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",cn),e.addEventListener("drop",un),e.addEventListener("dragenter",ln),e.addEventListener("dragleave",dn)}),mt||(mt=!0,window.addEventListener("resize",ft),window.addEventListener("scroll",ft,{passive:!0})),document.getElementById("clear").onclick=()=>Re()}function rt(){G.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function Q(e){I=e,He();const t=Array.from(D.fwd.get(e)||[]),n=Array.from(D.rev.get(e)||[]);console.log("[Blockscape] selecting id=",e,"deps=",t,"revs=",n);const r=G.get(e);r&&r.el.classList.add("selected"),t.forEach(o=>{const a=G.get(o);a&&a.el.classList.add("dep")}),n.forEach(o=>{const a=G.get(o);a&&a.el.classList.add("revdep")}),Ge()}function Re(){I=null,He(),Ge()}function He(){b.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","selected"))}function Ge(){var n;for(;S.firstChild;)S.removeChild(S.firstChild);if(!I||S.hidden)return;const e=(n=G.get(I))==null?void 0:n.rect;if(!e)return;new Set([...D.fwd.get(I)||[],...D.rev.get(I)||[]]).forEach(r=>{const o=G.get(r);if(!o||!o.rect)return;const a=jt(e),c=jt(o.rect),m=document.createElementNS("http://www.w3.org/2000/svg","path"),g=(a.x+c.x)/2,C=a.y,U=(a.x+c.x)/2,P=c.y,Z=(D.fwd.get(I)||new Set).has(r);m.setAttribute("d",`M ${a.x},${a.y} C ${g},${C} ${U},${P} ${c.x},${c.y}`),m.setAttribute("fill","none"),m.setAttribute("stroke",Z?"var(--blockscape-dep)":"var(--blockscape-revdep)"),m.setAttribute("stroke-opacity","0.45"),m.setAttribute("stroke-width","2"),m.setAttribute("vector-effect","non-scaling-stroke"),S.appendChild(m)})}function jt(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function St(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function tn(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function nn(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function Dt(e,t,{offset:n=8}={}){!x||!e||!t||(x.innerHTML=t,x.hidden=!1,x.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const r=e.getBoundingClientRect(),o=x.getBoundingClientRect(),a=window.scrollX||document.documentElement.scrollLeft,c=window.scrollY||document.documentElement.scrollTop;let m=r.left+r.width/2-o.width/2+a,g=r.top-o.height-n+c;m<a+n&&(m=a+n);const C=a+window.innerWidth-o.width-n;m>C&&(m=C),g<c+n&&(g=r.bottom+n+c),x.style.left=`${m}px`,x.style.top=`${g}px`,x.classList.add("is-visible")}))}function ze(){x&&(x.classList.remove("is-visible"),x.setAttribute("aria-hidden","true"),x.hidden=!0)}window.addEventListener("scroll",ze,!0),window.addEventListener("resize",ze);function be(){N&&(N.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),N.setAttribute("aria-hidden","true"),N.hidden=!0,Jt([]))}function rn(e,t){N&&(re={x:e,y:t},N.hidden=!1,N.setAttribute("aria-hidden","false"),N.classList.add("is-visible"),Ke(e,t))}function Ke(e,t){if(!N)return;const n=12;N.style.left=`${e+n}px`,N.style.top=`${t+n}px`;const r=N.getBoundingClientRect();let o=r.left,a=r.top;r.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-r.width-n)),r.bottom>window.innerHeight-n&&(a=Math.max(n,window.innerHeight-r.height-n)),N.style.left=`${o}px`,N.style.top=`${a}px`}function Jt(e=[]){F&&(F.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",r=>{r.stopPropagation(),typeof t.onClick=="function"&&t.onClick(r)}),F.appendChild(n)}),F.hidden=e.length===0)}async function on(e,t){var C;if(!N)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,r=((C=t.querySelector(".name"))==null?void 0:C.textContent)||n||"Preview",o=n?`${n}.html`:"",a=o?`items/${o}`:"",c=++ce,m=t.dataset.externalUrl||"",g=[{label:"Edit",title:"Edit this item",onClick:()=>{be(),Se.open(n)}}];if(m&&g.push({label:"Open link ↗",title:m,onClick:()=>window.open(m,"_blank","noopener")}),Jt(g),n&&Q(n),W.textContent=r,J.innerHTML='<div class="item-preview__status">Loading…</div>',N.classList.remove("item-preview--has-frame"),N.classList.add("item-preview--expanded"),rn(e.clientX,e.clientY),!a){J.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',Ke(re.x,re.y);return}try{const U=await fetch(a,{cache:"no-cache"});if(!U.ok)throw new Error(`HTTP ${U.status}`);const P=await U.text();if(c!==ce)return;if(!P.trim()){J.innerHTML=`<div class="item-preview__status">No content in <code>${St(o)}</code>.</div>`,Ke(re.x,re.y);return}const ve=document.createElement("iframe");ve.className="item-preview__frame",ve.title=`${r} details`,ve.srcdoc=P,J.innerHTML="",J.appendChild(ve),N.classList.add("item-preview--has-frame"),Ke(re.x,re.y)}catch(U){if(c!==ce)return;J.innerHTML=`<div class="item-preview__status">No preview available for <strong>${St(r)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${a}`,U),Ke(re.x,re.y)}}H&&H.addEventListener("click",be),b&&b.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!b.contains(t)||on(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!N||N.hidden||N.contains(e.target)||be()}),q&&q.addEventListener("click",()=>{qe("button")}),O&&O.addEventListener("click",()=>{if(p<0){alert("Load or select a model before creating a version.");return}try{const e=At({versionLabel:"map edit"});se(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),_&&_.addEventListener("click",async()=>{var a;if(p<0||!y[p]){alert("Select or load a model before sharing.");return}const e={title:ae(y[p],"Shared Model"),data:y[p].data};let t;try{t=Be(JSON.stringify(e))}catch(c){console.error("[Blockscape] share encode failed",c),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const r=n.toString();try{window.history.replaceState({},document.title,r)}catch(c){console.warn("[Blockscape] failed to update URL for share",c),window.location.hash=n.hash}let o=!1;if((a=navigator.clipboard)!=null&&a.writeText)try{await navigator.clipboard.writeText(r),o=!0}catch(c){console.warn("[Blockscape] clipboard write failed",c)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",r)}),L&&L.addEventListener("click",()=>{const e=(s.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};I&&(n.selectedItemId=I),localStorage.setItem(Y,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";I&&(t=`editor.html?selected=${encodeURIComponent(I)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==Y||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||k("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===z&&k("message")})),document.addEventListener("keydown",e=>{var n,r,o,a,c;if(!((n=Se==null?void 0:Se.isOpen)!=null&&n.call(Se))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault(),qe("shortcut");return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!d())return;if(bn()){e.preventDefault();return}}if(e.key==="Escape"&&N&&!N.hidden&&be(),e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!d()||e.altKey||e.ctrlKey||e.metaKey)return;const m=e.key==="ArrowLeft"?-1:1;e.shiftKey?fn(m)&&e.preventDefault():mn(m)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!d()||e.altKey||e.ctrlKey||e.metaKey)return;const m=e.key==="ArrowUp"?-1:1;e.shiftKey?gn(m)&&e.preventDefault():hn(m)&&e.preventDefault()}if(e.key==="Delete"){if(!d()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;vn()&&e.preventDefault()}if(e.key==="F2"){if(!d())return;const m=I||((c=(a=(o=(r=e.target)==null?void 0:r.closest)==null?void 0:o.call(r,".tile"))==null?void 0:a.dataset)==null?void 0:c.id);m&&Se.open(m)&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!N||N.hidden||Ke(re.x,re.y)}),window.addEventListener("scroll",()=>{!N||N.hidden||be()},!0);let Ve=null,it=null;function an(e){be(),Ve=e.target.dataset.id,it=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:Ve,categoryId:it})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",Ve,"from",it)}function sn(e){e.target.classList.remove("dragging"),b.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),b.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),Ve=null,it=null}function cn(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function ln(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function dn(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function un(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const r=n.dataset.cat;if(!Ve||!r)return;const a=Array.from(t.querySelectorAll(".tile")).filter(c=>c.dataset.id!==Ve).find(c=>{const m=c.getBoundingClientRect();return e.clientY<m.top+m.height/2});Ht(Ve,a?a.dataset.id:null,r),Ne(),console.log("[Blockscape] drop completed",Ve,"from",it,"to",r)}function Ht(e,t,n){if(p<0)return;const o=y[p].data.categories||[],a=o.find(U=>(U.items||[]).some(P=>P.id===e)),c=o.find(U=>U.id===n);if(!a||!c)return;a.items=a.items||[],c.items=c.items||[];const m=a.items.findIndex(U=>U.id===e);if(m===-1)return;const[g]=a.items.splice(m,1);let C=c.items.length;if(t){const U=c.items.findIndex(P=>P.id===t);U!==-1&&(C=U)}c.items.splice(C,0,g),i(),$e()}function pn(e){if(p<0||!e)return;const t=y[p].data,r=(t.categories||[]).find(g=>g.id===e);if(!r)return;r.items=r.items||[];const o=`New item ${r.items.length+1}`,c={id:kt(`${e}-${r.items.length+1}`,t),name:o,deps:[]};r.items.push(c),i(),$e(),be(),Q(c.id);const m=G.get(c.id);m!=null&&m.el&&m.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",c.id,"to",e)}function fn(e){if(!I||p<0||!e)return!1;const n=y[p].data.categories||[],r=G.get(I);let o=null;if(r!=null&&r.catId&&(o=n.find(g=>g.id===r.catId)),o||(o=n.find(g=>(g.items||[]).some(C=>C.id===I))),!o)return!1;o.items=o.items||[];const a=o.items.findIndex(g=>g.id===I);if(a===-1)return!1;const c=a+e;if(c<0||c>=o.items.length)return!1;const[m]=o.items.splice(a,1);return o.items.splice(c,0,m),i(),$e(),Ne(),Q(I),!0}function mn(e){if(!D||!D.m||!e)return!1;const t=D.m.categories||[];if(!t.length)return!1;const n=()=>{const g=t.find(C=>(C.items||[]).length);return g?{category:g,item:g.items[0]}:null};if(!I){const g=n();return g?(Q(g.item.id),!0):!1}const r=G.get(I);let o=null;if(r!=null&&r.catId&&(o=t.find(g=>g.id===r.catId)),o||(o=t.find(g=>(g.items||[]).some(C=>C.id===I))),!o){const g=n();return g?(Q(g.item.id),!0):!1}const a=o.items||[];if(!a.length)return!1;const c=a.findIndex(g=>g.id===I);if(c===-1)return!1;const m=c+e;return m<0||m>=a.length?!1:(Q(a[m].id),!0)}function hn(e){if(!D||!D.m||!e)return!1;const t=D.m.categories||[];if(!t.length)return!1;const n=()=>{for(const g of t)if(g.items&&g.items.length)return g.items[0].id;return null};let o=(()=>{if(!I)return-1;const g=G.get(I);if(g!=null&&g.catId){const C=t.findIndex(U=>U.id===g.catId);if(C!==-1)return C}return t.findIndex(C=>(C.items||[]).some(U=>U.id===I))})();if(o===-1){const g=n();return g?(Q(g),!0):!1}let c=(t[o].items||[]).findIndex(g=>g.id===I);c===-1&&(c=0);let m=o+e;for(;m>=0&&m<t.length;){const C=t[m].items||[];if(C.length){const U=Math.min(C.length-1,Math.max(0,c));return Q(C[U].id),!0}m+=e>0?1:-1}return!1}function gn(e){if(!I||p<0||!e)return!1;const n=y[p].data.categories||[];if(!n.length)return!1;const r=G.get(I);let o=-1;if(r!=null&&r.catId&&(o=n.findIndex(P=>P.id===r.catId)),o===-1&&(o=n.findIndex(P=>(P.items||[]).some(Z=>Z.id===I))),o===-1)return!1;const a=o+e;if(a<0||a>=n.length)return!1;const c=n[o],m=n[a];if(!m)return!1;c.items=c.items||[],m.items=m.items||[];const g=c.items.findIndex(P=>P.id===I);if(g===-1)return!1;const C=Math.min(m.items.length,Math.max(0,g)),U=C<m.items.length?m.items[C].id:null;return Ht(I,U,m.id),Ne(),Q(I),!0}function bn(){if(!te||p<0)return!1;const e=y[p];if(!e||e.id!==te.modelId)return!1;const t=te,o=(e.data.categories||[]).find(c=>c.id===t.categoryId);if(!o)return!1;o.items=o.items||[];const a=Math.min(Math.max(t.index,0),o.items.length);return o.items.splice(a,0,t.item),te=null,be(),I=null,i(),$e(),Ne(),Q(t.item.id),console.log("[Blockscape] undo delete restored",t.item.id),!0}function vn(){if(!I||p<0)return!1;const t=y[p].data.categories||[];if(!t.length)return!1;const n=G.get(I);let r=null;if(n!=null&&n.catId&&(r=t.find(C=>C.id===n.catId)),r||(r=t.find(C=>(C.items||[]).some(U=>U.id===I))),!r||!Array.isArray(r.items))return!1;const o=r.items.findIndex(C=>C.id===I);if(o===-1)return!1;const a=r.items.splice(o,1)[0];if(!a)return!1;const c=y[p];te={item:a,categoryId:r.id,index:o,modelId:c?c.id:null};const g=(()=>{var U;if(r.items.length){const P=Math.min(o,r.items.length-1);return((U=r.items[P])==null?void 0:U.id)||null}const C=t.findIndex(P=>P.id===r.id);if(C===-1)return null;for(let P=C+1;P<t.length;P++){const Z=t[P].items||[];if(Z.length)return Z[0].id}for(let P=C-1;P>=0;P--){const Z=t[P].items||[];if(Z.length)return Z[0].id}return null})();return be(),I=null,i(),$e(),Ne(),g?Q(g):Re(),console.log("[Blockscape] removed item",a.id),!0}j&&j.addEventListener("click",async()=>{const e=s.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await Ue(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),ee&&ee.addEventListener("click",async()=>{try{const e=await me();if(!e){alert("Clipboard is empty.");return}s.value=e,s.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=f(s.value,"Pasted");if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,r)=>{const o=Ee(n,{versionLabel:e.length>1?`paste #${r+1}`:"paste"});t==null&&(t=o)}),p===-1&&t!=null?se(t):Me()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{if(p<0){alert("No active model selected.");return}try{const e=JSON.parse(s.value);oe(e,{titleHint:ae(y[p]),idHint:ge(y[p])||ae(y[p])}),y[p].data=e,y[p].title=e.title||y[p].title,et(),console.log("[Blockscape] replaced active model:",ae(y[p])),$e(),X.updateAvailability()}catch(e){console.error("[Blockscape] replace error:",e),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const r of t){const o=await r.text(),a=f(o,r.name.replace(/\.[^.]+$/,"")||"File");if(!a.length){console.warn("[Blockscape] no models in file:",r.name);continue}a.forEach((c,m)=>{var P;const g=(((P=c.data)==null?void 0:P.title)??"").toString().trim(),C=a.length>1?`${r.name} #${m+1}`:r.name,U=Ee({...c,title:g||C},{versionLabel:r.name});n==null&&(n=U)})}p===-1&&n!=null?se(n):Me()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",yn);function yn(e){var o;if(!d())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!w(t))return;let n=[];try{n=f(t,"Clipboard")}catch(a){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",a);return}if(!n.length)return;e.preventDefault();let r=null;n.forEach((a,c)=>{const m=Ee(a,{versionLabel:n.length>1?`paste #${c+1}`:"paste"});r==null&&(r=m)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),r!=null&&se(r)}V.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(pt(),se(n))}),document.getElementById("removeModel").onclick=()=>{if(p<0)return;if(console.log("[Blockscape] removing model:",ae(y[p])),y.splice(p,1),!y.length){p=-1,D=null,b.innerHTML="",S.innerHTML="",s.value="",Me(),et();return}const e=Math.min(p,y.length-1);se(e)},document.getElementById("search").addEventListener("input",e=>{const t=e.target.value.trim().toLowerCase();console.log("[Blockscape] search:",t),b.querySelectorAll(".tile").forEach(n=>{const r=n.querySelector(".name").textContent.toLowerCase();n.style.opacity=!t||r.includes(t)?1:.2})}),v&&R&&$&&v.addEventListener("submit",async e=>{e.preventDefault();const t=R.value.trim();if(!t){alert("Please enter a URL"),R.focus();return}const n=await Nt(t);if(typeof n=="number"){se(n),R.value="";const r=document.getElementById("urlHint");r&&(r.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!R||!t)return;let n=null;R.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=R.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function $e(){if(!(p<0))try{D=M(y[p].data),Ne()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function wn(){const e=["NFR.bs","planets.bs","letters.bs"],t=n=>vt?vt.endsWith("/")?`${vt}${n}`:`${vt}/${n}`:n;for(const n of e)try{const r=await fetch(t(n),{cache:"no-store"});if(!r.ok){console.warn(`[Blockscape] ${n} not fetched (${r.status}); skipping`);continue}const o=await r.text(),a=n.replace(/\.[^.]+$/,"")||"Model",c=f(o,a);if(!c.length){console.warn("[Blockscape] no models found in",n);continue}c.forEach(m=>{Ee(m,{versionLabel:n})}),console.log(`[Blockscape] loaded ${c.length} model(s) from ${n}`)}catch(r){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",r)}Me()}async function En(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const r of t)try{console.log(`[Blockscape] fetching ${e} with cache="${r.cache??"default"}"`);const o=await fetch(e,r);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function xn(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(r=>kn(r)),e.querySelectorAll("a[href]").forEach(r=>{const o=r.getAttribute("href");qt(o)&&Ft(r,o)})}function kn(e){var m,g;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(g=(m=e.parentNode)==null?void 0:m.closest)!=null&&g.call(m,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,r=[];let o;for(;(o=n.exec(t))!==null;)r.push({url:o[0],index:o.index});if(!r.length)return;const a=document.createDocumentFragment();let c=0;r.forEach(({url:C,index:U})=>{U>c&&a.appendChild(document.createTextNode(t.slice(c,U))),a.appendChild(An(C)),c=U+C.length}),c<t.length&&a.appendChild(document.createTextNode(t.slice(c))),e.parentNode.replaceChild(a,e)}function An(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",qt(e)&&Ft(t,e),t}function Ft(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>Cn(n,t,e)))}async function Cn(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await Nt(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function qt(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function Nt(e){try{console.log("[Blockscape] loading from URL:",e);const t=await En(e),r=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=f(t,r)}catch(c){throw new Error(`Invalid JSON payload: ${c.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let a=null;return o.forEach((c,m)=>{var P;const g=(((P=c.data)==null?void 0:P.title)??"").toString().trim(),C=o.length>1?`${r} #${m+1}`:r,U=Ee({...c,title:g||C},{versionLabel:r});a==null&&(a=U)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,r),p===-1&&a!=null?se(a):Me(),a}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const r=JSON.parse(n);oe(r,{titleHint:r.title||"Blockscape",idHint:r.id||"blockscape"}),y.push({id:le(),title:r.title||"Blockscape",data:r}),await wn();const o=await A(),a=B(),c=a==null?void 0:a.index,m=T();se(typeof o=="number"?o:typeof m=="number"?m:typeof c=="number"?c:0)})()}function er(s){let u,b,S,x,V,N=`<script id="seed" type="application/json">${s[0]}<\/script>`,v,R,$,W,J,F;return{c(){u=ct("link"),b=st(),S=ct("div"),S.innerHTML=`<header class="pf-v5-c-page__header"><div class="pf-v5-c-masthead pf-m-display-inline blockscape-masthead"><div class="pf-v5-c-masthead__content"><div class="blockscape-toolbar"><div class="blockscape-brand"><h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></div> <div class="blockscape-toolbar__controls"><label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <form id="urlForm" class="blockscape-url-form" autocomplete="on" novalidate=""><label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-secondary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div></form> <label class="pf-v5-c-button pf-m-secondary blockscape-file"><span>Load File(s)</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/></label> <button id="openInEditor" class="pf-v5-c-button pf-m-primary" type="button" title="Open current JSON in the editor">Edit</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button> <button id="shareModel" class="pf-v5-c-button pf-m-primary" type="button" title="Copy a shareable URL for this model">Share</button></div> <div class="blockscape-legend" role="presentation"><span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span></div></div></div></div></header> <main class="pf-v5-c-page__main"><div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code> to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div></main>`,x=st(),V=new Un(!1),v=st(),R=Zt("svg"),$=st(),W=ct("div"),J=st(),F=ct("div"),F.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',document.title="Blockscape — simple landscape-style tiles",pe(u,"rel","icon"),pe(u,"type","image/svg+xml"),pe(u,"href","./favicon.svg"),pe(S,"class","pf-v5-c-page"),V.a=v,pe(R,"id","overlay"),pe(R,"class","svg-layer"),pe(W,"id","tabTooltip"),pe(W,"class","blockscape-tab-tooltip"),W.hidden=!0,pe(W,"aria-hidden","true"),pe(F,"id","itemPreview"),pe(F,"class","item-preview"),F.hidden=!0,pe(F,"aria-hidden","true")},m(H,q){_n(document.head,u),Ie(H,b,q),Ie(H,S,q),Ie(H,x,q),V.m(N,H,q),Ie(H,v,q),Ie(H,R,q),Ie(H,$,q),Ie(H,W,q),Ie(H,J,q),Ie(H,F,q)},p:Qe,i:Qe,o:Qe,d(H){H&&(fe(b),fe(S),fe(x),V.d(),fe(v),fe(R),fe($),fe(W),fe(J),fe(F)),fe(u)}}}function tr(s){const u=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;return Mn(()=>{Zn()}),[u]}class nr extends zn{constructor(u){super(),Gn(this,u,tr,er,Nn,{})}}const rr=document.getElementById("root");new nr({target:rr});
