var Un=Object.defineProperty;var Mn=(s,f,b)=>f in s?Un(s,f,{enumerable:!0,configurable:!0,writable:!0,value:b}):s[f]=b;var De=(s,f,b)=>Mn(s,typeof f!="symbol"?f+"":f,b);(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))S(x);new MutationObserver(x=>{for(const R of x)if(R.type==="childList")for(const N of R.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&S(N)}).observe(document,{childList:!0,subtree:!0});function b(x){const R={};return x.integrity&&(R.integrity=x.integrity),x.referrerPolicy&&(R.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?R.credentials="include":x.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function S(x){if(x.ep)return;x.ep=!0;const R=b(x);fetch(x.href,R)}})();function Qe(){}function nn(s){return s()}function Qt(){return Object.create(null)}function Et(s){s.forEach(nn)}function rn(s){return typeof s=="function"}function On(s,f){return s!=s?f==f:s!==f||s&&typeof s=="object"||typeof s=="function"}function Pn(s){return Object.keys(s).length===0}function Vn(s,f){s.appendChild(f)}function Ae(s,f,b){s.insertBefore(f,b||null)}function me(s){s.parentNode&&s.parentNode.removeChild(s)}function ct(s){return document.createElement(s)}function on(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Rn(s){return document.createTextNode(s)}function st(){return Rn(" ")}function fe(s,f,b){b==null?s.removeAttribute(f):s.getAttribute(f)!==b&&s.setAttribute(f,b)}function jn(s){return Array.from(s.childNodes)}class Dn{constructor(f=!1){De(this,"is_svg",!1);De(this,"e");De(this,"n");De(this,"t");De(this,"a");this.is_svg=f,this.e=this.n=null}c(f){this.h(f)}m(f,b,S=null){this.e||(this.is_svg?this.e=on(b.nodeName):this.e=ct(b.nodeType===11?"TEMPLATE":b.nodeName),this.t=b.tagName!=="TEMPLATE"?b:b.content,this.c(f)),this.i(S)}h(f){this.e.innerHTML=f,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(f){for(let b=0;b<this.n.length;b+=1)Ae(this.t,this.n[b],f)}p(f){this.d(),this.h(f),this.i(this.a)}d(){this.n.forEach(me)}}let dt;function lt(s){dt=s}function Jn(){if(!dt)throw new Error("Function called outside component initialization");return dt}function Fn(s){Jn().$$.on_mount.push(s)}const Xe=[],Zt=[];let Ze=[];const en=[],Hn=Promise.resolve();let Jt=!1;function qn(){Jt||(Jt=!0,Hn.then(an))}function Ft(s){Ze.push(s)}const Pt=new Set;let We=0;function an(){if(We!==0)return;const s=dt;do{try{for(;We<Xe.length;){const f=Xe[We];We++,lt(f),Gn(f.$$)}}catch(f){throw Xe.length=0,We=0,f}for(lt(null),Xe.length=0,We=0;Zt.length;)Zt.pop()();for(let f=0;f<Ze.length;f+=1){const b=Ze[f];Pt.has(b)||(Pt.add(b),b())}Ze.length=0}while(Xe.length);for(;en.length;)en.pop()();Jt=!1,Pt.clear(),lt(s)}function Gn(s){if(s.fragment!==null){s.update(),Et(s.before_update);const f=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,f),s.after_update.forEach(Ft)}}function zn(s){const f=[],b=[];Ze.forEach(S=>s.indexOf(S)===-1?f.push(S):b.push(S)),b.forEach(S=>S()),Ze=f}const Kn=new Set;function Wn(s,f){s&&s.i&&(Kn.delete(s),s.i(f))}function Yn(s,f,b){const{fragment:S,after_update:x}=s.$$;S&&S.m(f,b),Ft(()=>{const R=s.$$.on_mount.map(nn).filter(rn);s.$$.on_destroy?s.$$.on_destroy.push(...R):Et(R),s.$$.on_mount=[]}),x.forEach(Ft)}function Xn(s,f){const b=s.$$;b.fragment!==null&&(zn(b.after_update),Et(b.on_destroy),b.fragment&&b.fragment.d(f),b.on_destroy=b.fragment=null,b.ctx=[])}function Qn(s,f){s.$$.dirty[0]===-1&&(Xe.push(s),qn(),s.$$.dirty.fill(0)),s.$$.dirty[f/31|0]|=1<<f%31}function Zn(s,f,b,S,x,R,N=null,v=[-1]){const V=dt;lt(s);const _=s.$$={fragment:null,ctx:[],props:R,update:Qe,not_equal:x,bound:Qt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(f.context||(V?V.$$.context:[])),callbacks:Qt(),dirty:v,skip_bound:!1,root:f.target||V.$$.root};N&&N(_.root);let W=!1;if(_.ctx=b?b(s,f.props||{},(J,H,...F)=>{const q=F.length?F[0]:H;return _.ctx&&x(_.ctx[J],_.ctx[J]=q)&&(!_.skip_bound&&_.bound[J]&&_.bound[J](q),W&&Qn(s,J)),H}):[],_.update(),W=!0,Et(_.before_update),_.fragment=S?S(_.ctx):!1,f.target){if(f.hydrate){const J=jn(f.target);_.fragment&&_.fragment.l(J),J.forEach(me)}else _.fragment&&_.fragment.c();f.intro&&Wn(s.$$.fragment),Yn(s,f.target,f.anchor),an()}lt(V)}class er{constructor(){De(this,"$$");De(this,"$$set")}$destroy(){Xn(this,1),this.$destroy=Qe}$on(f,b){if(!rn(b))return Qe;const S=this.$$.callbacks[f]||(this.$$.callbacks[f]=[]);return S.push(b),()=>{const x=S.indexOf(b);x!==-1&&S.splice(x,1)}}$set(f){this.$$set&&!Pn(f)&&(this.$$.skip_bound=!0,this.$$set(f),this.$$.skip_bound=!1)}}const tr="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(tr);const tn="blockscape:apicurioConfig",Vt="http://localhost:8080/apis/registry/v3",Rt="bs",jt=!1,Dt=!1;function nr({models:s,getActiveIndex:f,setActive:b,ensureModelMetadata:S,getModelId:x,getModelTitle:R,computeJsonFingerprint:N,uid:v}){let V=null,_=null,W=null,J=null,H=null,F=null,q=null,B=null,M=null;const L={baseUrl:Vt,groupId:Rt,authToken:"",enabled:jt,useSemver:Dt},j=new Map,Z=new Map;function Y(i){return(i||"").toString().trim().replace(/\/+$/,"")}function z(){return!!(L.baseUrl&&L.groupId)}function re(){return L.enabled!==!1}function y(){W&&(W.value=L.baseUrl||""),J&&(J.value=L.groupId||""),H&&(H.value=L.authToken||""),F&&(F.checked=re()),q&&(q.checked=!!L.useSemver)}function p(i="",l="muted"){B&&(B.textContent=i||"",B.classList.remove("is-error","is-success"),l==="error"?B.classList.add("is-error"):l==="success"&&B.classList.add("is-success"))}function X(i){if(!M||(M.innerHTML="",!i))return;const l=document.createElement("p");l.className="apicurio-hint",l.textContent=i,M.appendChild(l)}function D(i){j.clear(),Z.clear(),X(i)}function G(){const i=f(),l=re(),m=z();if(V){const g=V.dataset.loading==="true",d=l&&m&&i>=0&&!!x(s[i]);V.disabled=!l||g||!d,l?g||(V.textContent="Push to Apicurio"):V.textContent="Enable Apicurio to push"}if(_){const g=_.dataset.loading==="true",d=l&&m;_.disabled=!d||g,g||(l?m?_.textContent="List artifacts":_.textContent="Enter details to list":_.textContent="Enable Apicurio to list")}}function C(){y(),re()?z()?(p("Apicurio push is ready when a model is selected.","muted"),j.size||X("Click “List artifacts” to browse the current group.")):(p("Enter Apicurio connection details to enable push.","muted"),D("Enter registry details to browse artifacts.")):(p("Apicurio integration is off. Enable it to allow pushes.","muted"),D("Apicurio integration is disabled.")),G()}function ue(){if(window!=null&&window.localStorage)try{localStorage.setItem(tn,JSON.stringify(L))}catch(i){console.warn("[Blockscape] unable to persist Apicurio settings",i)}}function ne(){let i={};if(window!=null&&window.localStorage)try{const w=localStorage.getItem(tn);if(w){const $=JSON.parse(w);$&&typeof $=="object"&&(i=$)}}catch(w){console.warn("[Blockscape] failed to restore Apicurio settings",w)}const l=Y(i.baseUrl??Vt),m=(i.groupId??Rt).toString().trim();let g=jt,d=Dt;typeof i.enabled=="boolean"?g=i.enabled:typeof i.enabled=="string"&&(g=i.enabled==="true"),typeof i.useSemver=="boolean"?d=i.useSemver:typeof i.useSemver=="string"&&(d=i.useSemver==="true"),L.baseUrl=l||Vt,L.groupId=m||Rt,L.authToken=(i.authToken??"").toString().trim(),L.enabled=g,L.useSemver=d,C()}function ee(){const i={Accept:"application/json"},l=(L.authToken||"").trim();return l&&(i.Authorization=/\s/.test(l)?l:`Bearer ${l}`),i}function he(i,l,{title:m,description:g,version:d}={}){const w={artifactId:i,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:l}}};return d&&(w.firstVersion.version=d),m&&(w.name=m),g&&(w.description=g),w}function Je(i,{version:l}={}){const m={content:{contentType:"application/json",content:i}};return l&&(m.version=l),m}function $e(i){if(i==null)return null;const l=String(i).trim();if(!l)return null;const m=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(l);if(m)return{major:Number(m[1]),minor:Number(m[2]),patch:Number(m[3])};const g=/^v?(\d+)$/.exec(l);return g?{major:Number(g[1]),minor:0,patch:0}:null}function _e(i){return`${i.major}.${i.minor}.${i.patch}`}function Be(i,l){return!i&&!l?0:i?l?i.major!==l.major?i.major-l.major:i.minor!==l.minor?i.minor-l.minor:i.patch-l.patch:1:-1}function Ie(i=[]){let l=null;if(i.forEach(g=>{const d=$e((g==null?void 0:g.version)??g);d&&(!l||Be(d,l)>0)&&(l=d)}),!l)return"1.0.0";const m={...l,patch:l.patch+1};return _e(m)}function Te(i){return Array.isArray(i)?i:Array.isArray(i==null?void 0:i.artifacts)?i.artifacts:Array.isArray(i==null?void 0:i.items)?i.items:Array.isArray(i==null?void 0:i.results)?i.results:[]}function ge(i){return Array.isArray(i)?i:Array.isArray(i==null?void 0:i.versions)?i.versions:Array.isArray(i==null?void 0:i.items)?i.items:[]}function Ee(i=[]){if(!Array.isArray(i)||!i.length)return null;const l=[...i].filter(Boolean);return l.sort((m,g)=>{const d=m!=null&&m.createdOn?new Date(m.createdOn).getTime():0,w=g!=null&&g.createdOn?new Date(g.createdOn).getTime():0;if(d!==w)return w-d;const $=Number(m==null?void 0:m.version),k=Number(g==null?void 0:g.version),U=Number.isFinite($),A=Number.isFinite(k);if(U&&A&&$!==k)return k-$;const O=String((m==null?void 0:m.version)??"");return String((g==null?void 0:g.version)??"").localeCompare(O,void 0,{numeric:!0})}),l[0]||null}function Ue(i){if(!i)return i;let l=i;if(!Array.isArray(i==null?void 0:i.categories)){const g=i==null?void 0:i.content;if(typeof g=="string")try{l=JSON.parse(g)}catch(d){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",d)}else g&&typeof g=="object"&&(l=g)}return l}async function be(i,l,m){const g=encodeURIComponent(l),d=encodeURIComponent(m),w=`${i}/groups/${g}/artifacts/${d}`,$=ee();$.Accept="application/json";const k=await fetch(w,{method:"GET",headers:$});if(!k.ok){let U=k.statusText||"Unknown error";try{const A=await k.text();A&&(U=A.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${k.status}): ${U}`)}return k.json()}async function xe(i,l,m){const g=encodeURIComponent(l),d=encodeURIComponent(m),w=`${i}/groups/${g}/artifacts/${d}/versions?limit=50&order=desc`,$=ee();$.Accept="application/json";const k=await fetch(w,{method:"GET",headers:$});if(!k.ok){let A=k.statusText||"Unknown error";try{const O=await k.text();O&&(A=O.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${k.status}): ${A}`)}const U=await k.json();return ge(U).filter(A=>A&&A.version!=null)}async function oe(i,l,m,g="latest"){const d=encodeURIComponent(l),w=encodeURIComponent(m),$=encodeURIComponent(g||"latest"),k=`${i}/groups/${d}/artifacts/${w}/versions/${$}/content`,U=ee();U.Accept="application/json, application/*+json, */*;q=0.8";const A=await fetch(k,{method:"GET",headers:U});if(!A.ok){let Oe=A.statusText||"Unknown error";try{const Le=await A.text();Le&&(Oe=Le.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${A.status}): ${Oe}`)}const O=await A.text();let pe=null;try{pe=JSON.parse(O)}catch{throw new Error("Artifact content is not valid JSON.")}return Ue(pe)}async function xt(i,l,m,g="latest"){const d=await oe(i,l,m,g);return{data:d,fingerprint:N(d)}}async function ie(i,l,m){try{const d=await xe(i,l,m);if(d!=null&&d.length){Z.set(m,d);const w=Ee(d);if((w==null?void 0:w.version)!=null)return w.version}}catch(d){console.warn("[Blockscape] compare-version: unable to fetch versions list",d)}try{const d=await be(i,l,m);if((d==null?void 0:d.version)!=null)return d.version}catch(d){console.warn("[Blockscape] compare-version: unable to fetch metadata",d)}const g=Z.get(m);if(g&&g.length){const d=Ee(g);if((d==null?void 0:d.version)!=null)return d.version}return"latest"}async function kt(i,l,m,g){if(!L.useSemver)return null;if(!g)return"1.0.0";try{const d=await xe(i,l,m);return Ie(d)}catch(d){throw new Error(`Unable to compute next semantic version: ${d.message}`)}}function ve(i=document){V=i.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),_=i.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),W=i.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),J=i.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),H=i.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),F=i.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),q=i.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),B=i.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),M=i.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function ut(){L.baseUrl=Y((W==null?void 0:W.value)??L.baseUrl),L.groupId=((J==null?void 0:J.value)??"").trim(),L.authToken=((H==null?void 0:H.value)??"").trim(),ue(),C()}function At(){L.enabled=F?F.checked:jt,ue(),C()}function It(){L.useSemver=q?q.checked:Dt,ue(),C()}function Ce(){[W,J,H].forEach(i=>{i&&i.addEventListener("input",ut)}),V&&V.addEventListener("click",()=>{ft()}),F&&F.addEventListener("change",At),q&&q.addEventListener("change",It),_&&_.addEventListener("click",mt),M&&M.addEventListener("click",i=>{const l=i.target.closest("[data-artifact-version]");if(l){i.stopPropagation();const d=l.dataset.artifactId,w=l.dataset.artifactVersion;d&&w&&le(d,w);return}const m=i.target.closest("[data-artifact-load-all]");if(m){i.stopPropagation();const d=m.dataset.artifactId;d&&Me(d);return}const g=i.target.closest("[data-artifact-trigger]");if(g){const d=g.dataset.artifactId;if(!d)return;St(d)}})}function ye(){const i=document.createElement("div");return i.className="blockscape-registry-panel",i.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,i}function Ct(i){if(!i)return;i.innerHTML="";const l=ye();i.appendChild(l),ve(i),Ce(),C()}function et(i){if(!M)return;if(M.innerHTML="",!i.length){X("No artifacts found in this group.");return}const l=document.createElement("ul");l.className="apicurio-artifact-list",i.forEach(m=>{if(!(m!=null&&m.artifactId))return;const g=document.createElement("li"),d=document.createElement("button");d.type="button",d.className="apicurio-artifact",d.dataset.artifactId=m.artifactId,d.dataset.artifactTrigger="toggle";const w=document.createElement("span");w.className="apicurio-artifact-title",w.textContent=m.artifactId,d.appendChild(w);const $=[];if(m.name&&$.push(m.name),m.version!=null&&$.push(`v${m.version}`),m.type&&$.push(m.type),$.length){const A=document.createElement("span");A.className="apicurio-artifact-meta",A.textContent=$.join(" • "),d.appendChild(A)}if(m.description){const A=document.createElement("span");A.className="apicurio-artifact-meta",A.textContent=m.description,d.appendChild(A)}g.appendChild(d);const k=document.createElement("div");k.className="apicurio-version-list",k.dataset.versionPanel=m.artifactId,k.hidden=!0;const U=document.createElement("p");U.className="apicurio-hint",U.textContent="Click above to choose a version to load.",k.appendChild(U),g.appendChild(k),l.appendChild(g)}),M.appendChild(l)}function qe(i){return M?M.querySelector(`[data-version-panel="${i}"]`):null}function Fe(i,l){if(!i||(i.innerHTML="",!l))return;const m=document.createElement("p");m.className="apicurio-hint",m.textContent=l,i.appendChild(m)}function Lt(i,l){const m=qe(i);if(!m)return;if(m.innerHTML="",!l.length){Fe(m,"No versions found for this artifact.");return}l.forEach(d=>{const w=document.createElement("button");w.type="button",w.className="apicurio-version-button",w.dataset.artifactId=i,w.dataset.artifactVersion=d.version;const $=[`Version ${d.version}`];if(d.createdOn){const k=new Date(d.createdOn);isNaN(k)||$.push(k.toISOString().slice(0,10))}w.textContent=$.join(" — "),m.appendChild(w)});const g=document.createElement("button");g.type="button",g.className="apicurio-version-button",g.dataset.artifactId=i,g.dataset.artifactLoadAll="true",g.textContent=`Load all (${l.length})`,m.appendChild(g)}async function St(i){const l=qe(i);if(!l)return;if(l.dataset.open==="true"){l.hidden=!0,l.dataset.open="false";return}if(l.hidden=!1,l.dataset.open="true",l.dataset.loaded!=="true"){if(!z()){Fe(l,"Enter registry details first.");return}Fe(l,"Loading versions…");try{const g=Y(L.baseUrl),d=L.groupId.trim(),w=await xe(g,d,i);Z.set(i,w),l.dataset.loaded="true",Lt(i,w)}catch(g){console.error("[Blockscape] failed to load versions",g),Fe(l,`Unable to fetch versions: ${g.message}`)}}}function pt(i,l){var g;const m=s.findIndex(d=>d.apicurioArtifactId===i);if(m!==-1){const d=s[m].id;s[m]={...l,id:d||l.id},((g=s[m].apicurioVersions)==null?void 0:g.length)>1&&(s[m].isSeries=!0),b(m)}else s.push(l),b(s.length-1)}async function tt(i,l,m,g){const d=encodeURIComponent(l),w=encodeURIComponent(m),$=`${i}/groups/${d}/artifacts/${w}`;try{const k=await fetch($,{method:"GET",headers:g});if(k.status===404)return!1;if(k.ok)return!0;throw k.status===401||k.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${k.status} while checking the artifact.`)}catch(k){throw k instanceof TypeError?new Error("Network error while contacting Apicurio registry."):k}}async function ft(){var $;if(!V||V.dataset.loading==="true")return;if(!re()){p("Apicurio integration is off. Enable it first.","error");return}if(!z()){p("Enter the registry base URL and group ID before pushing.","error");return}const i=f();if(i<0||!s[i]){p("No active model to push.","error");return}const l=x(s[i]);if(!l){p("Active model needs an id before pushing.","error");return}const m=Y(L.baseUrl),g=L.groupId.trim(),d=JSON.stringify(s[i].data,null,2),w=ee();V.dataset.loading="true",V.textContent="Pushing…",V.disabled=!0,p("Pushing to Apicurio…","muted");try{const k=await tt(m,g,l,w),U=N(s[i].data);if(k)try{const ae=await ie(m,g,l),{data:Ge,fingerprint:Re}=await xt(m,g,l,ae);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",ae),console.log("local fingerprint",U),console.log("registry fingerprint",Re),console.log("local payload",s[i].data),console.log("registry payload",Ge),console.groupEnd(),U&&Re&&U===Re){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){p("Push cancelled (content matches the latest registry version).","muted");return}p("Pushing identical content by user choice.","muted")}else Re?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):p("Unable to compare with registry content (skipping confirmation).","muted")}catch(ae){console.warn("[Blockscape] unable to compare registry content before push",ae),p("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const A=L.useSemver?await kt(m,g,l,k):null;if(L.useSemver&&!A)throw new Error("Semantic versioning is enabled but no version could be computed.");const O=encodeURIComponent(g),pe=encodeURIComponent(l),Oe=k?`${m}/groups/${O}/artifacts/${pe}/versions`:`${m}/groups/${O}/artifacts`,Le={...w,"Content-Type":"application/json"};A&&(Le["X-Registry-Version"]=A,p(`Pushing to Apicurio as version ${A}…`,"muted"));const Pe=k?Je(d,{version:A}):he(l,d,{title:R(s[i]),description:($=s[i].data)==null?void 0:$.abstract,version:A}),Ve=await fetch(Oe,{method:"POST",headers:Le,body:JSON.stringify(Pe)});if(!Ve.ok){let ae=Ve.statusText||"Unknown error";try{const Ge=await Ve.text();Ge&&(ae=Ge.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${Ve.status}): ${ae}`)}let ke=null;try{ke=await Ve.json()}catch{ke=null}const nt=(ke==null?void 0:ke.version)||(ke==null?void 0:ke.globalId)||"",ht=k?"Updated":"Created",Nt=nt?` (version ${nt})`:"";p(`${ht} ${l}${Nt}`,"success")}catch(k){console.error("[Blockscape] Apicurio push failed",k),p(`Apicurio push failed: ${k.message}`,"error")}finally{V.dataset.loading="false",G()}}async function mt(){if(!_||_.dataset.loading==="true")return;if(!re()){p("Enable Apicurio integration to list artifacts.","error");return}if(!z()){p("Enter registry base URL and group ID before listing.","error");return}const i=Y(L.baseUrl),l=L.groupId.trim(),m=encodeURIComponent(l),g=`${i}/groups/${m}/artifacts?limit=50&offset=0`;_.dataset.loading="true",_.textContent="Listing…",_.disabled=!0,p("Listing artifacts…","muted"),X("Contacting registry…");try{const d=ee();d.Accept="application/json";const w=await fetch(g,{method:"GET",headers:d});if(!w.ok){let A=w.statusText||"Unknown error";try{const O=await w.text();O&&(A=O.slice(0,400))}catch{}throw new Error(`Failed to list artifacts (${w.status}): ${A}`)}const $=await w.json(),k=Te($).filter(A=>A&&A.artifactId);j.clear(),Z.clear(),k.forEach(A=>{A!=null&&A.artifactId&&j.set(A.artifactId,A)}),et(k);const U=k.length;p(U?`Found ${U} artifact${U===1?"":"s"}.`:"No artifacts found in this group.",U?"success":"muted")}catch(d){console.error("[Blockscape] failed to list artifacts",d),D("Unable to list artifacts."),p(`Listing failed: ${d.message}`,"error")}finally{_.dataset.loading="false",G()}}async function le(i,l=null){if(!i)return;if(!re()){p("Enable Apicurio integration to load artifacts.","error");return}if(!z()){p("Enter registry connection details before loading artifacts.","error");return}const m=Y(L.baseUrl),g=L.groupId.trim();let d=j.get(i);const w=async()=>{try{const O=await be(m,g,i);return O!=null&&O.artifactId&&j.set(i,O),O}catch(O){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",O),O}};if(!d)try{d=await w()}catch(O){p(`Failed to fetch artifact metadata: ${O.message}`,"error");return}const $=Z.get(i)||[];let k="latest",U="latest";if(l)k=l,U=l;else{if(!d||d.version==null)try{d=await w()}catch(O){p(`Failed to fetch artifact metadata: ${O.message}`,"error");return}k=(d==null?void 0:d.version)||"latest",U=(d==null?void 0:d.version)||"latest"}const A=$.find(O=>String(O.version)===String(k));(A==null?void 0:A.version)!=null&&(U=A.version),p(`Loading artifact ${i}…`,"muted");try{const O=await oe(m,g,i,k),pe=j.get(i)||d||{};S(O,{titleHint:pe.name||i,idHint:i});const Oe={version:U,data:O,createdOn:(A==null?void 0:A.createdOn)||pe.createdOn},Le={id:v(),title:O.title||pe.name||i,data:O,apicurioArtifactId:i,apicurioArtifactName:pe.name||"",apicurioVersions:[Oe],apicurioActiveVersionIndex:0};pt(i,Le);const Pe=U?` (version ${U})`:"";p(`Loaded artifact ${i}${Pe}.`,"success")}catch(O){console.error("[Blockscape] failed to load artifact",O),p(`Failed to load artifact: ${O.message}`,"error")}}async function Me(i){if(!i)return;if(!re()){p("Enable Apicurio integration to load artifacts.","error");return}if(!z()){p("Enter registry connection details before loading artifacts.","error");return}const l=Y(L.baseUrl),m=L.groupId.trim();let g=Z.get(i);if(!g){Fe(qe(i),"Loading versions…");try{g=await xe(l,m,i),Z.set(i,g)}catch(U){p(`Failed to fetch versions: ${U.message}`,"error");return}}const d=(g||[]).filter(U=>U&&U.version!=null);if(!d.length){p("No versions found for this artifact.","muted");return}p(`Loading ${d.length} version(s) for ${i}…`,"muted");const w=j.get(i)||{},$=[];try{for(const U of d){const A=U.version??"latest",O=await oe(l,m,i,A);S(O,{titleHint:w.name||i,idHint:i}),$.push({version:A,createdOn:U.createdOn,data:O})}}catch(U){console.error("[Blockscape] failed to load one or more versions",U),p(`Failed to load all versions: ${U.message}`,"error");return}if(!$.length){p("No versions loaded from registry.","error");return}const k={id:v(),title:$[0].data.title||w.name||i,data:$[0].data,apicurioArtifactId:i,apicurioArtifactName:w.name||"",apicurioVersions:$,apicurioActiveVersionIndex:0};pt(i,k),p(`Loaded ${$.length} version(s) for ${i}.`,"success")}return{hydrateConfig:ne,mount:Ct,updateAvailability:G}}function Ye(s,f){if(typeof s!="function")throw new Error(`[itemEditor] expected ${f} to be a function`)}function rr(s,{excludeId:f}={}){if(!s)return[];const b=s.split(/[\s,]+/).map(x=>x.trim()).filter(Boolean),S=[];return b.forEach(x=>{f&&x===f||S.includes(x)||S.push(x)}),S}function ir(s,f,b){if(!f||!b||f===b)return;((s==null?void 0:s.categories)||[]).forEach(x=>{(x.items||[]).forEach(R=>{Array.isArray(R.deps)&&(R.deps=R.deps.map(N=>N===f?b:N))})}),Array.isArray(s==null?void 0:s.links)&&s.links.forEach(x=>{x.from===f&&(x.from=b),x.to===f&&(x.to=b)})}function or({findItemAndCategoryById:s,collectAllItemIds:f,updateItemReferences:b,loadActiveIntoEditor:S,rebuildFromActive:x,select:R,onSelectionRenamed:N}={}){Ye(s,"findItemAndCategoryById"),Ye(f,"collectAllItemIds"),Ye(b,"updateItemReferences"),Ye(S,"loadActiveIntoEditor"),Ye(x,"rebuildFromActive"),Ye(R,"select");const v={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function V(B){if(v.fields.errorEl){if(!B){v.fields.errorEl.hidden=!0,v.fields.errorEl.textContent="";return}v.fields.errorEl.hidden=!1,v.fields.errorEl.textContent=B}}function _(){v.wrapper&&(v.wrapper.hidden=!0,v.wrapper.setAttribute("aria-hidden","true"),V(""),v.categoryId=null,v.itemId=null,v.modelData=null,document.body.classList.remove("item-editor-open"))}function W(){v.wrapper&&(v.wrapper.hidden=!1,v.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var B,M;(B=v.fields.nameInput)==null||B.focus(),(M=v.fields.nameInput)==null||M.select()}))}function J(B){var p;if(!v.modelData||!v.categoryId||!v.itemId)throw new Error("No item loaded.");const L=(((p=v.modelData)==null?void 0:p.categories)||[]).find(X=>X.id===v.categoryId);if(!L)throw new Error("Category not found.");L.items=L.items||[];const j=L.items.find(X=>X.id===v.itemId);if(!j)throw new Error("Item not found.");const Z=(B.id||"").trim();if(!Z)throw new Error("ID is required.");const Y=f(v.modelData);if(Z!==j.id&&Y.has(Z))throw new Error("Another item already uses that ID.");j.id=Z;const z=(B.name||"").trim();j.name=z||j.id;const re=(B.logo||"").trim();if(re?j.logo=re:delete j.logo,B.externalFlag&&!B.external)j.external=!0;else{const X=(B.external??"").toString().trim();X?j.external=X:delete j.external}const y=(B.color||"").trim();return y?j.color=y:delete j.color,j.deps=Array.isArray(B.deps)?B.deps:[],j.id!==B.originalId&&typeof N=="function"&&N(B.originalId,j.id),b(v.modelData,B.originalId,j.id),S(),x(),R(j.id),j.id}function H(){if(!v.fields||!v.fields.idInput)return!1;const B=(v.fields.idInput.value||"").trim(),M={originalId:v.itemId,id:B,name:v.fields.nameInput.value||"",logo:v.fields.logoInput.value||"",external:v.fields.externalInput.value||"",externalFlag:v.fields.externalFlagInput.checked,color:v.fields.colorInput.value||"",deps:rr(v.fields.depsInput.value,{excludeId:B})};try{return J(M),_(),!0}catch(L){return console.warn("[itemEditor] item edit failed",L),V((L==null?void 0:L.message)||"Unable to save item."),!1}}function F(){if(v.wrapper)return v.wrapper;const B=document.createElement("div");B.className="item-editor-modal",B.hidden=!0,B.setAttribute("role","dialog"),B.setAttribute("aria-modal","true");const M=document.createElement("div");M.className="item-editor-modal__backdrop",B.appendChild(M);const L=document.createElement("div");L.className="item-editor",B.appendChild(L);const j=document.createElement("div");j.className="item-editor__header";const Z=document.createElement("h2");Z.className="item-editor__title",Z.textContent="Edit item";const Y=document.createElement("button");Y.type="button",Y.className="item-editor__close",Y.setAttribute("aria-label","Close item editor"),Y.textContent="×",j.appendChild(Z),j.appendChild(Y),L.appendChild(j);const z=document.createElement("form");z.className="item-editor__form",L.appendChild(z);const re=document.createElement("div");re.className="item-editor__meta",re.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',z.appendChild(re);const y=document.createElement("div");y.className="item-editor__error",y.hidden=!0,z.appendChild(y);const p=(ge,Ee,Ue)=>{const be=document.createElement("label");be.className="item-editor__field";const xe=document.createElement("span");if(xe.className="item-editor__label",xe.textContent=ge,be.appendChild(xe),Ee.classList.add("item-editor__control"),be.appendChild(Ee),Ue){const oe=document.createElement("div");oe.className="item-editor__hint",oe.textContent=Ue,be.appendChild(oe)}return be},X=document.createElement("input");X.type="text",X.required=!0,z.appendChild(p("ID",X,"Unique identifier used for links and dependencies."));const D=document.createElement("input");D.type="text",z.appendChild(p("Name",D,"Visible label shown on the tile."));const G=document.createElement("input");G.type="url",G.inputMode="url",G.placeholder="https://…",z.appendChild(p("Logo URL",G,"Optional image URL."));const C=document.createElement("input");C.type="url",C.inputMode="url",C.placeholder="https://…",z.appendChild(p("External link",C,"Shown with ↗ icon and in preview."));const ue=document.createElement("div");ue.className="item-editor__checkbox";const ne=document.createElement("label");ne.className="item-editor__checkbox-row";const ee=document.createElement("input");ee.type="checkbox";const he=document.createElement("span");he.textContent="Mark as external without link";const Je=document.createElement("div");Je.className="item-editor__hint",Je.textContent="Keeps dashed border even without a URL.",ne.appendChild(ee),ne.appendChild(he),ue.appendChild(ne),ue.appendChild(Je),z.appendChild(ue);const $e=document.createElement("input");$e.type="text",$e.placeholder="#2563eb",z.appendChild(p("Color",$e,"Optional badge color (hex or CSS color)."));const _e=document.createElement("textarea");_e.rows=2,_e.placeholder="Comma or space separated ids",z.appendChild(p("Dependencies",_e,"Use item IDs, separated by commas or spaces."));const Be=document.createElement("div");Be.className="item-editor__actions";const Ie=document.createElement("button");Ie.type="button",Ie.className="pf-v5-c-button pf-m-tertiary",Ie.textContent="Cancel";const Te=document.createElement("button");return Te.type="submit",Te.className="pf-v5-c-button pf-m-primary",Te.textContent="Save",Be.appendChild(Ie),Be.appendChild(Te),z.appendChild(Be),v.wrapper=B,v.fields={idInput:X,nameInput:D,logoInput:G,externalInput:C,externalFlagInput:ee,colorInput:$e,depsInput:_e,categoryValue:re.querySelector(".item-editor__meta-value"),errorEl:y},Ie.addEventListener("click",_),Y.addEventListener("click",_),M.addEventListener("click",_),z.addEventListener("submit",ge=>{ge.preventDefault(),H()}),document.addEventListener("keydown",ge=>{ge.key==="Escape"&&!B.hidden&&(ge.preventDefault(),ge.stopPropagation(),_())}),document.body.appendChild(B),B}function q(B){const M=s(B);return M?(F(),v.categoryId=M.category.id,v.itemId=M.item.id,v.modelData=M.modelData,v.fields.categoryValue.textContent=M.category.title||M.category.id,v.fields.idInput.value=M.item.id||"",v.fields.nameInput.value=M.item.name||"",v.fields.logoInput.value=M.item.logo||"",v.fields.externalInput.value=typeof M.item.external=="string"?M.item.external:"",v.fields.externalFlagInput.checked=M.item.external===!0,v.fields.colorInput.value=M.item.color||"",v.fields.depsInput.value=Array.isArray(M.item.deps)?M.item.deps.join(", "):"",V(""),R(M.item.id),W(),!0):!1}return{open:q,hide:_,isOpen:()=>!!v.wrapper&&!v.wrapper.hidden}}const wt=typeof import.meta<"u"&&"./"||"";function ar(){console.log("[Blockscape] init");const s=document.getElementById("jsonBox"),f=document.querySelector(".blockscape-json-panel"),b=document.getElementById("app"),S=document.getElementById("overlay"),x=document.getElementById("tabTooltip"),R=document.getElementById("modelList"),N=document.getElementById("itemPreview"),v=document.getElementById("urlForm"),V=document.getElementById("urlInput"),_=document.getElementById("loadUrl"),W=N.querySelector(".item-preview__title"),J=N.querySelector(".item-preview__body"),H=N.querySelector(".item-preview__actions"),F=N.querySelector(".item-preview__close"),q=document.getElementById("downloadJson"),B=document.getElementById("shareModel"),M=document.getElementById("createVersion"),L=document.getElementById("openInEditor"),j=document.getElementById("copyJson"),Z=document.getElementById("pasteJson"),Y="blockscape:editorPayload",z="blockscape:editorTransfer",re=document.title;s.value=document.getElementById("seed").textContent.trim();let y=[],p=-1;const X=nr({models:y,getActiveIndex:()=>p,setActive:le,ensureModelMetadata:oe,getModelId:ve,getModelTitle:ie,computeJsonFingerprint:xe,uid:he});let D=null,G=new Map,C=null,ue=0,ne={x:0,y:0},ee=null;X.hydrateConfig();function he(){return Math.random().toString(36).slice(2,10)}function Je(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(r=>{n+=String.fromCharCode(r)}),btoa(n)}function $e(e){const t=atob(e),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return new TextDecoder().decode(n)}function _e(e){return Je(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Be(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),$e(t)}function Ie(e,t){const n=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=e,o.click(),URL.revokeObjectURL(r)}async function Te(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function ge(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function Ee(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function Ue(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(r=>Ue(r)).join(",")}]`:`{${Object.keys(e).sort().map(r=>`${JSON.stringify(r)}:${Ue(e[r])}`).join(",")}}`}function be(e){try{return Ue(e)}catch{return""}}function xe(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=be(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=be(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}function oe(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const r=(e.title??"").toString().trim();e.title=r||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const a=n||e.title||t||"model",c=Ee(a).replace(/\./g,"-");e.id=c||`model-${he()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function xt(e){return JSON.parse(JSON.stringify(e))}function ie(e,t="Untitled Model"){var r;return e&&(((r=e.data)==null?void 0:r.title)??e.title??"").toString().trim()||t}function kt(e,t="Untitled Model"){var o;const n=ve(e);return(((o=e==null?void 0:e.apicurioVersions)==null?void 0:o.length)>1||(e==null?void 0:e.isSeries))&&n?`${n} series`:ie(e,t)}function ve(e){var r;const t=(r=e==null?void 0:e.data)==null?void 0:r.id;return t&&t.toString().trim()||null}function ut(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(r=>{r!=null&&r.id&&t.add(r.id)})),t}function At(e){if(p<0||!e)return null;const t=y[p].data,n=(t==null?void 0:t.categories)||[];for(const r of n){const a=(r.items||[]).find(c=>c.id===e);if(a)return{category:r,item:a,modelData:t}}return null}function It(e,t){const n=ut(t);let r=Ee(e||"item");if(!n.has(r))return r;const o=()=>he().slice(0,4);for(;n.has(r);)r=`${Ee(e||"item")}-${o()}`;return r}const Ce=or({findItemAndCategoryById:At,collectAllItemIds:ut,updateItemReferences:ir,loadActiveIntoEditor:i,rebuildFromActive:Se,select:e=>se(e),onSelectionRenamed:(e,t)=>{var n;C===e&&(C=t),((n=ee==null?void 0:ee.item)==null?void 0:n.id)===e&&(ee.item.id=t)}});function ye(e,{versionLabel:t,createdOn:n}={}){var u,h;const r=ve(e);if(!r)return y.push(e),y.length-1;const o=y.findIndex(I=>ve(I)===r);if(o===-1)return y.push(e),y.length-1;const a=y[o];(!Array.isArray(a.apicurioVersions)||!a.apicurioVersions.length)&&(a.apicurioVersions=[{version:"1",data:a.data,createdOn:(h=(u=a.apicurioVersions)==null?void 0:u[0])==null?void 0:h.createdOn}],a.apicurioActiveVersionIndex=0);const c=String(a.apicurioVersions.length+1);return a.apicurioVersions.push({version:c,data:e.data,createdOn:n||new Date().toISOString()}),a.apicurioActiveVersionIndex=a.apicurioVersions.length-1,a.data=e.data,a.title=ie(e)||a.title,a.isSeries=!0,o}function Ct({versionLabel:e}={}){if(p<0||!y[p])throw new Error("Load or select a model before creating a version.");let t;try{t=xt(y[p].data)}catch(r){throw console.warn("[Blockscape] failed to clone active model for versioning",r),new Error("Could not copy the current model.")}return oe(t,{titleHint:ie(y[p]),idHint:ve(y[p])}),ye({title:ie(y[p]),data:t},{versionLabel:e||"manual",createdOn:new Date().toISOString()})}function et(){const e=p>=0&&y[p]?y[p]:null,t=ve(e);document.title=t?`${t}-blockscape`:re}function qe(e="shortcut"){const t=s.value||"";if(!t.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const n=ie(y[p],"blockscape"),r=`${Ee(n)}.json`;return Ie(r,t),console.log(`[Blockscape] saved JSON (${e}):`,r),!0}const Fe={A:"#ef4444",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#f43f5e",P:"#e11d48",Q:"#dc2626",R:"#f59e0b",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function Lt(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return Fe[n]||"#9ca3af"}function St(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(h=>h+h).join(""):t,r=parseInt(n,16),o=r>>16&255,a=r>>8&255,c=r&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(a/255,2.2)+.0722*Math.pow(c/255,2.2)>.35?"#111111":"#ffffff"}function pt(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}let tt=!1;function ft(){tt||(tt=!0,requestAnimationFrame(()=>{tt=!1,Re(),rt()}))}let mt=!1;function le(e){if(we(),ee=null,e<0||e>=y.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}p=e,console.log("[Blockscape] active model:",ie(y[e]),"(index",e+" )"),et(),Me(),i(),Se(),X.updateAvailability()}function Me(){if(R.innerHTML="",!y.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",R.appendChild(e);return}y.forEach((e,t)=>{var P;const n=document.createElement("li");n.className="model-nav-item";const r=document.createElement("button");r.type="button",r.className="model-nav-button"+(t===p?" is-active":""),r.dataset.index=String(t),r.setAttribute("aria-current",t===p?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const a=document.createElement("span");a.className="model-nav-title",a.textContent=kt(e),o.appendChild(a);const c=ve(e);if(c){const Q=document.createElement("span");Q.className="model-nav-id",Q.textContent=c,o.appendChild(Q)}const u=Array.isArray((P=e.data)==null?void 0:P.categories)?e.data.categories:[],h=u.reduce((Q,Ne)=>Q+(Ne.items||[]).length,0),I=document.createElement("span");I.className="model-nav-meta";const T=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";I.textContent=`${u.length} cat · ${h} items${T}`,r.appendChild(o),r.appendChild(I),n.appendChild(r),R.appendChild(n)}),X.updateAvailability()}function i(){if(p<0){s.value="";return}s.value=JSON.stringify(y[p].data,null,2)}function l(e){try{return JSON.parse(e)}catch{return null}}function m(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return[];const r=n.map((u,h)=>!u||typeof u!="object"?null:(oe(u,{titleHint:`${t} #${h+1}`}),{obj:u,idx:h})).filter(Boolean);if(!r.length)return[];const o=r[0].obj,a=o.title||`${t} series`;return[{id:he(),title:a,data:o,apicurioVersions:r.map(({obj:u,idx:h})=>({version:String(h+1),data:u})),apicurioActiveVersionIndex:0,isSeries:!0}]}function g(e,t="Pasted"){return Array.isArray(e)?m(e,t):!e||typeof e!="object"?[]:(oe(e,{titleHint:`${t} #1`}),[{id:he(),title:e.title||`${t} #1`,data:e}])}function d(e,t="Pasted"){const n=(e||"").trim();if(!n)return[];const r=l(n);if(r){const a=g(r,t);if(a.length)return a}return n.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,c)=>{const u=JSON.parse(a);return oe(u,{titleHint:`${t} #${c+1}`}),{id:he(),title:u.title||`${t} #${c+1}`,data:u}})}function w(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function $(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!w(e)}function k(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function U(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(Y)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(Y)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(Y)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=d(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let r=null;return n.forEach(o=>{const a=ye(o,{versionLabel:"editor"});r==null&&(r=a)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:r,count:n.length}}function A(e="storage"){const t=U();return!t||typeof t.index!="number"?!1:(le(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function O(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const c=new URLSearchParams(window.location.search);c.has("share")&&(t=c.get("share"))}if(!t)return null;let r;try{const c=Be(t);r=JSON.parse(c)}catch(c){return console.warn("[Blockscape] failed to decode share token",c),null}if(!r||typeof r!="object"||r.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=g(r.data,r.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let a=null;return o.forEach(c=>{const u=ye(c,{versionLabel:"shared"});a==null&&(a=u)}),a}async function pe(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const r=new URLSearchParams(window.location.search);r.has("load")&&(t=r.get("load"))}if(!t)return null;try{const r=await Bt(t);return typeof r=="number"?r:null}catch(r){return console.warn("[Blockscape] load param failed",r),null}}function Oe(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,r=new Set;(e.categories||[]).forEach(a=>(a.items||[]).forEach(c=>{r.add(c.id);const u=new Set(c.deps||[]);(e.links||[]).forEach(h=>{h.from===c.id&&u.add(h.to)}),t.set(c.id,u),u.forEach(h=>{n.has(h)||n.set(h,new Set),n.get(h).add(c.id)})}));const o=new Set;return n.forEach((a,c)=>{((a==null?void 0:a.size)||0)>=2&&o.add(c)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:r}}function Le(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),r=44;n.width=r,n.height=r;const o=n.getContext("2d"),a=(e||"?").charAt(0).toUpperCase(),c=Lt(e,t),u=St(c);return o.fillStyle=c,o.beginPath(),o.arc(r/2,r/2,r/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=u,o.font=`bold ${r*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(a,r/2,r/2),n.toDataURL("image/png")}function Pe(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Ve(e){const t=Pe(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function ke(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,r)=>{var a;const o=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();o&&t.set(o,r)}),t}function nt(e,t){var c;if(e<0||e>=y.length)return!1;const n=y[e];if(!((c=n==null?void 0:n.apicurioVersions)!=null&&c.length))return!1;const r=n.apicurioVersions.length,o=(t%r+r)%r,a=n.apicurioVersions[o];return a!=null&&a.data?(n.apicurioActiveVersionIndex=o,n.data=a.data,C=null,i(),Se(),!0):!1}function ht(e){var r;if(!e||p<0)return;const t=y[p];if(!((r=t==null?void 0:t.apicurioVersions)!=null&&r.length))return;const n=Pe(t);n!==-1&&nt(p,n+e)}function Nt(e){if(!(e!=null&&e.apicurioVersions)||e.apicurioVersions.length<=1)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||ve(e)||"Artifact",t.appendChild(n);const r=document.createElement("div");r.className="version-nav__status";const o=Pe(e),a=Ve(e)||"latest";r.textContent=`No. in series ${a} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(r);const c=document.createElement("div");c.className="version-nav__controls";const u=document.createElement("button");u.type="button",u.className="version-nav__button",u.textContent="Previous",u.addEventListener("click",()=>ht(-1));const h=document.createElement("button");return h.type="button",h.className="version-nav__button",h.textContent="Next",h.addEventListener("click",()=>ht(1)),c.appendChild(u),c.appendChild(h),t.appendChild(c),t}function ae(){if(!D)return;ze(),Array.isArray(D.m.categories)||(D.m.categories=[]),console.log("[Blockscape] rendering categories=",D.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!D.m.abstract,"- value:",D.m.abstract?D.m.abstract.substring(0,50)+"...":"none"),b.innerHTML="",G.clear();const e=Nt(y[p]);e&&b.appendChild(e),S.setAttribute("width",window.innerWidth),S.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=D.m.title&&D.m.title.trim()||ie(y[p]),t.appendChild(n);const r=Ve(y[p]),o=(D.m.id??"").toString().trim();if(o){const E=document.createElement("div");E.className="blockscape-model-id",E.textContent=`ID: ${o}`,t.appendChild(E)}if(r){const E=document.createElement("div");E.className="blockscape-model-id",E.textContent=`No. in series: ${r}`,t.appendChild(E)}b.appendChild(t);const a=document.createElement("div");a.className="blockscape-tabs";const c=document.createElement("div");c.className="blockscape-tablist",c.setAttribute("role","tablist"),a.appendChild(c);const u=document.createElement("div");u.className="blockscape-tabpanels",a.appendChild(u);const h=document.createElement("div"),I=document.createElement("div"),T=document.createElement("div"),P=document.createElement("div");let Q="";const Ne=ke(y[p]),_n=Pe(y[p]),gt=[{id:"map",label:"Map",panel:h},{id:"abstract",label:"Info",panel:I},{id:"source",label:"Source",panel:T},{id:"apicurio",label:"Apicurio",panel:P}],Bn=E=>{if(!S)return;const K=E==="map";S.hidden=!K,K?(Re(),rt()):S.innerHTML=""};gt.forEach((E,K)=>{const te=document.createElement("button");te.type="button",te.id=`tab-${E.id}`,te.className="blockscape-tab"+(K===0?" is-active":""),te.setAttribute("role","tab"),te.setAttribute("aria-controls",`panel-${E.id}`),te.setAttribute("aria-selected",K===0?"true":"false"),te.textContent=E.label,E.button=te,c.appendChild(te),E.panel.id=`panel-${E.id}`,E.panel.classList.add("blockscape-tabpanel"),E.panel.setAttribute("role","tabpanel"),E.panel.setAttribute("aria-labelledby",te.id),E.panel.hidden=K!==0,K===0&&E.panel.classList.add("is-active"),u.appendChild(E.panel)});const Xt=E=>{gt.forEach(K=>{const te=K.id===E;K.button.classList.toggle("is-active",te),K.button.setAttribute("aria-selected",te?"true":"false"),K.panel.classList.toggle("is-active",te),K.panel.hidden=!te}),Bn(E)};gt.forEach(E=>{E.button.addEventListener("click",()=>{ze(),Xt(E.id)}),E.id==="abstract"&&(E.button.addEventListener("mouseenter",()=>Gt(E.button,Q,{offset:12})),E.button.addEventListener("mouseleave",ze),E.button.addEventListener("focus",()=>Gt(E.button,Q,{offset:12})),E.button.addEventListener("blur",ze))}),Xt(gt[0].id),b.appendChild(a);const Tt=document.createElement("div");Tt.className="blockscape-render",h.appendChild(Tt);const bt=document.createElement("div");if(bt.className="blockscape-abstract-panel",D.m.abstract){console.log("[Blockscape] Rendering abstract content");const E=document.createElement("div");E.className="blockscape-abstract",E.innerHTML=D.m.abstract,Ln(E),bt.appendChild(E),Q=E.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const E=document.createElement("div");E.className="blockscape-abstract-placeholder",E.textContent="No abstract has been provided for this model.",bt.appendChild(E),Q=E.outerHTML}I.appendChild(bt);const vt=document.createElement("div");if(vt.className="blockscape-source-panel",f)f.hidden=!1,f.classList.remove("pf-v5-c-page__main-section"),vt.appendChild(f);else{const E=document.createElement("p");E.className="muted",E.textContent="Source editor unavailable.",vt.appendChild(E)}T.appendChild(vt),X.mount(P),D.m.categories.forEach(E=>{const K=document.createElement("section");K.className="category",K.dataset.cat=E.id;const te=document.createElement("div");te.className="cat-head",te.innerHTML=`<div class="cat-title">${_t(E.title||E.id)}</div>
                          <div class="muted cat-count">${(E.items||[]).length} items</div>`,K.appendChild(te);const yt=document.createElement("div");yt.className="grid",K.appendChild(yt),(E.items||[]).forEach(ce=>{const at=sn(ce.external),de=document.createElement("div");if(de.className=at.isExternal?"tile external":"tile",de.tabIndex=0,de.dataset.id=ce.id,at.url&&(de.dataset.externalUrl=at.url),Ne.has(ce.id)){const Ot=Ne.get(ce.id);de.dataset.seriesVersionIndex=String(Ot),de.classList.add("tile--series-link");const Tn=Ot===_n?"Current map in this series":`Open version ${Ot+1} in this series`;de.title=Tn}const He=document.createElement("img");He.className="logo",ce.logo?(He.src=ce.logo,He.alt=ce.name||ce.id):(He.alt="",He.style.opacity=1,He.src=Le(ce.name||ce.id,ce.color));const Ut=document.createElement("div");Ut.className="name",Ut.textContent=ce.name||ce.id;const Mt=document.createElement("div");Mt.className="badge",Mt.textContent="reused",at.url&&de.appendChild(cn(at.url)),de.appendChild(He),de.appendChild(Ut),de.appendChild(Mt),yt.appendChild(de),G.set(ce.id,{el:de,catId:E.id,rect:null})}),Tt.appendChild(K);const ot=document.createElement("button");ot.type="button",ot.className="tile-add",ot.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',ot.addEventListener("click",()=>bn(E.id)),yt.appendChild(ot)}),D.reusedLocal.forEach(E=>{const K=G.get(E);K&&(K.el.classList.add("reused"),K.el.querySelector(".badge").style.display="inline-block")}),Ge(),Re(),rt()}function Ge(){b.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",t=>{if(typeof t.button=="number"&&t.button!==0)return;if(we(),e.dataset.seriesVersionIndex!=null){const r=parseInt(e.dataset.seriesVersionIndex,10);if(Number.isInteger(r)&&nt(p,r))return}const n=e.dataset.id;if(console.log("[Blockscape] click",n),C===n){$t();return}se(n)}),e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e.click())}),e.draggable=!0,e.addEventListener("dragstart",un),e.addEventListener("dragend",pn)}),b.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",fn),e.addEventListener("drop",gn),e.addEventListener("dragenter",mn),e.addEventListener("dragleave",hn)}),mt||(mt=!0,window.addEventListener("resize",ft),window.addEventListener("scroll",ft,{passive:!0})),document.getElementById("clear").onclick=()=>$t()}function Re(){G.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function se(e){C=e,Ht();const t=Array.from(D.fwd.get(e)||[]),n=Array.from(D.rev.get(e)||[]);console.log("[Blockscape] selecting id=",e,"deps=",t,"revs=",n);const r=G.get(e);r&&r.el.classList.add("selected"),t.forEach(o=>{const a=G.get(o);a&&a.el.classList.add("dep")}),n.forEach(o=>{const a=G.get(o);a&&a.el.classList.add("revdep")}),rt()}function $t(){C=null,Ht(),rt()}function Ht(){b.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","selected"))}function rt(){var n;for(;S.firstChild;)S.removeChild(S.firstChild);if(!C||S.hidden)return;const e=(n=G.get(C))==null?void 0:n.rect;if(!e)return;new Set([...D.fwd.get(C)||[],...D.rev.get(C)||[]]).forEach(r=>{const o=G.get(r);if(!o||!o.rect)return;const a=qt(e),c=qt(o.rect),u=document.createElementNS("http://www.w3.org/2000/svg","path"),h=(a.x+c.x)/2,I=a.y,T=(a.x+c.x)/2,P=c.y,Q=(D.fwd.get(C)||new Set).has(r);u.setAttribute("d",`M ${a.x},${a.y} C ${h},${I} ${T},${P} ${c.x},${c.y}`),u.setAttribute("fill","none"),u.setAttribute("stroke",Q?"var(--blockscape-dep)":"var(--blockscape-revdep)"),u.setAttribute("stroke-opacity","0.45"),u.setAttribute("stroke-width","2"),u.setAttribute("vector-effect","non-scaling-stroke"),S.appendChild(u)})}function qt(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function _t(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function sn(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function cn(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function Gt(e,t,{offset:n=8}={}){!x||!e||!t||(x.innerHTML=t,x.hidden=!1,x.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const r=e.getBoundingClientRect(),o=x.getBoundingClientRect(),a=window.scrollX||document.documentElement.scrollLeft,c=window.scrollY||document.documentElement.scrollTop;let u=r.left+r.width/2-o.width/2+a,h=r.top-o.height-n+c;u<a+n&&(u=a+n);const I=a+window.innerWidth-o.width-n;u>I&&(u=I),h<c+n&&(h=r.bottom+n+c),x.style.left=`${u}px`,x.style.top=`${h}px`,x.classList.add("is-visible")}))}function ze(){x&&(x.classList.remove("is-visible"),x.setAttribute("aria-hidden","true"),x.hidden=!0)}window.addEventListener("scroll",ze,!0),window.addEventListener("resize",ze);function we(){N&&(N.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),N.setAttribute("aria-hidden","true"),N.hidden=!0,zt([]))}function ln(e,t){N&&(ne={x:e,y:t},N.hidden=!1,N.setAttribute("aria-hidden","false"),N.classList.add("is-visible"),Ke(e,t))}function Ke(e,t){if(!N)return;const n=12;N.style.left=`${e+n}px`,N.style.top=`${t+n}px`;const r=N.getBoundingClientRect();let o=r.left,a=r.top;r.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-r.width-n)),r.bottom>window.innerHeight-n&&(a=Math.max(n,window.innerHeight-r.height-n)),N.style.left=`${o}px`,N.style.top=`${a}px`}function zt(e=[]){H&&(H.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",r=>{r.stopPropagation(),typeof t.onClick=="function"&&t.onClick(r)}),H.appendChild(n)}),H.hidden=e.length===0)}async function dn(e,t){var I;if(!N)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,r=((I=t.querySelector(".name"))==null?void 0:I.textContent)||n||"Preview",o=n?`${n}.html`:"",a=o?`items/${o}`:"",c=++ue,u=t.dataset.externalUrl||"",h=[{label:"Edit",title:"Edit this item",onClick:()=>{we(),Ce.open(n)}}];if(u&&h.push({label:"Open link ↗",title:u,onClick:()=>window.open(u,"_blank","noopener")}),zt(h),n&&se(n),W.textContent=r,J.innerHTML='<div class="item-preview__status">Loading…</div>',N.classList.remove("item-preview--has-frame"),N.classList.add("item-preview--expanded"),ln(e.clientX,e.clientY),!a){J.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',Ke(ne.x,ne.y);return}try{const T=await fetch(a,{cache:"no-cache"});if(!T.ok)throw new Error(`HTTP ${T.status}`);const P=await T.text();if(c!==ue)return;if(!P.trim()){J.innerHTML=`<div class="item-preview__status">No content in <code>${_t(o)}</code>.</div>`,Ke(ne.x,ne.y);return}const Ne=document.createElement("iframe");Ne.className="item-preview__frame",Ne.title=`${r} details`,Ne.srcdoc=P,J.innerHTML="",J.appendChild(Ne),N.classList.add("item-preview--has-frame"),Ke(ne.x,ne.y)}catch(T){if(c!==ue)return;J.innerHTML=`<div class="item-preview__status">No preview available for <strong>${_t(r)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${a}`,T),Ke(ne.x,ne.y)}}F&&F.addEventListener("click",we),b&&b.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!b.contains(t)||dn(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!N||N.hidden||N.contains(e.target)||we()}),q&&q.addEventListener("click",()=>{qe("button")}),M&&M.addEventListener("click",()=>{if(p<0){alert("Load or select a model before creating a version.");return}try{const e=Ct({versionLabel:"map edit"});le(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),B&&B.addEventListener("click",async()=>{var a;if(p<0||!y[p]){alert("Select or load a model before sharing.");return}const e={title:ie(y[p],"Shared Model"),data:y[p].data};let t;try{t=_e(JSON.stringify(e))}catch(c){console.error("[Blockscape] share encode failed",c),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const r=n.toString();try{window.history.replaceState({},document.title,r)}catch(c){console.warn("[Blockscape] failed to update URL for share",c),window.location.hash=n.hash}let o=!1;if((a=navigator.clipboard)!=null&&a.writeText)try{await navigator.clipboard.writeText(r),o=!0}catch(c){console.warn("[Blockscape] clipboard write failed",c)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",r)}),L&&L.addEventListener("click",()=>{const e=(s.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};C&&(n.selectedItemId=C),localStorage.setItem(Y,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";C&&(t=`editor.html?selected=${encodeURIComponent(C)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==Y||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||A("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===z&&A("message")})),document.addEventListener("keydown",e=>{var n,r,o,a,c;if(!((n=Ce==null?void 0:Ce.isOpen)!=null&&n.call(Ce))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault(),qe("shortcut");return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!$())return;if(xn()){e.preventDefault();return}}if(e.key==="Escape"&&N&&!N.hidden&&we(),e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!$()||e.altKey||e.ctrlKey||e.metaKey)return;const u=e.key==="ArrowLeft"?-1:1;e.shiftKey?vn(u)&&e.preventDefault():yn(u)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!$()||e.altKey||e.ctrlKey||e.metaKey)return;const u=e.key==="ArrowUp"?-1:1;e.shiftKey?En(u)&&e.preventDefault():wn(u)&&e.preventDefault()}if(e.key==="Delete"){if(!$()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;kn()&&e.preventDefault()}if(e.key==="F2"){if(!$())return;const u=C||((c=(a=(o=(r=e.target)==null?void 0:r.closest)==null?void 0:o.call(r,".tile"))==null?void 0:a.dataset)==null?void 0:c.id);u&&Ce.open(u)&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!N||N.hidden||Ke(ne.x,ne.y)}),window.addEventListener("scroll",()=>{!N||N.hidden||we()},!0);let je=null,it=null;function un(e){we(),je=e.target.dataset.id,it=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:je,categoryId:it})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",je,"from",it)}function pn(e){e.target.classList.remove("dragging"),b.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),b.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),je=null,it=null}function fn(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function mn(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function hn(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function gn(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const r=n.dataset.cat;if(!je||!r)return;const a=Array.from(t.querySelectorAll(".tile")).filter(c=>c.dataset.id!==je).find(c=>{const u=c.getBoundingClientRect();return e.clientY<u.top+u.height/2});Kt(je,a?a.dataset.id:null,r),ae(),console.log("[Blockscape] drop completed",je,"from",it,"to",r)}function Kt(e,t,n){if(p<0)return;const o=y[p].data.categories||[],a=o.find(T=>(T.items||[]).some(P=>P.id===e)),c=o.find(T=>T.id===n);if(!a||!c)return;a.items=a.items||[],c.items=c.items||[];const u=a.items.findIndex(T=>T.id===e);if(u===-1)return;const[h]=a.items.splice(u,1);let I=c.items.length;if(t){const T=c.items.findIndex(P=>P.id===t);T!==-1&&(I=T)}c.items.splice(I,0,h),i(),Se()}function bn(e){if(p<0||!e)return;const t=y[p].data,r=(t.categories||[]).find(h=>h.id===e);if(!r)return;r.items=r.items||[];const o=`New item ${r.items.length+1}`,c={id:It(`${e}-${r.items.length+1}`,t),name:o,deps:[]};r.items.push(c),i(),Se(),we(),se(c.id);const u=G.get(c.id);u!=null&&u.el&&u.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",c.id,"to",e)}function vn(e){if(!C||p<0||!e)return!1;const n=y[p].data.categories||[],r=G.get(C);let o=null;if(r!=null&&r.catId&&(o=n.find(h=>h.id===r.catId)),o||(o=n.find(h=>(h.items||[]).some(I=>I.id===C))),!o)return!1;o.items=o.items||[];const a=o.items.findIndex(h=>h.id===C);if(a===-1)return!1;const c=a+e;if(c<0||c>=o.items.length)return!1;const[u]=o.items.splice(a,1);return o.items.splice(c,0,u),i(),Se(),ae(),se(C),!0}function yn(e){if(!D||!D.m||!e)return!1;const t=D.m.categories||[];if(!t.length)return!1;const n=()=>{const h=t.find(I=>(I.items||[]).length);return h?{category:h,item:h.items[0]}:null};if(!C){const h=n();return h?(se(h.item.id),!0):!1}const r=G.get(C);let o=null;if(r!=null&&r.catId&&(o=t.find(h=>h.id===r.catId)),o||(o=t.find(h=>(h.items||[]).some(I=>I.id===C))),!o){const h=n();return h?(se(h.item.id),!0):!1}const a=o.items||[];if(!a.length)return!1;const c=a.findIndex(h=>h.id===C);if(c===-1)return!1;const u=c+e;return u<0||u>=a.length?!1:(se(a[u].id),!0)}function wn(e){if(!D||!D.m||!e)return!1;const t=D.m.categories||[];if(!t.length)return!1;const n=()=>{for(const h of t)if(h.items&&h.items.length)return h.items[0].id;return null};let o=(()=>{if(!C)return-1;const h=G.get(C);if(h!=null&&h.catId){const I=t.findIndex(T=>T.id===h.catId);if(I!==-1)return I}return t.findIndex(I=>(I.items||[]).some(T=>T.id===C))})();if(o===-1){const h=n();return h?(se(h),!0):!1}let c=(t[o].items||[]).findIndex(h=>h.id===C);c===-1&&(c=0);let u=o+e;for(;u>=0&&u<t.length;){const I=t[u].items||[];if(I.length){const T=Math.min(I.length-1,Math.max(0,c));return se(I[T].id),!0}u+=e>0?1:-1}return!1}function En(e){if(!C||p<0||!e)return!1;const n=y[p].data.categories||[];if(!n.length)return!1;const r=G.get(C);let o=-1;if(r!=null&&r.catId&&(o=n.findIndex(P=>P.id===r.catId)),o===-1&&(o=n.findIndex(P=>(P.items||[]).some(Q=>Q.id===C))),o===-1)return!1;const a=o+e;if(a<0||a>=n.length)return!1;const c=n[o],u=n[a];if(!u)return!1;c.items=c.items||[],u.items=u.items||[];const h=c.items.findIndex(P=>P.id===C);if(h===-1)return!1;const I=Math.min(u.items.length,Math.max(0,h)),T=I<u.items.length?u.items[I].id:null;return Kt(C,T,u.id),ae(),se(C),!0}function xn(){if(!ee||p<0)return!1;const e=y[p];if(!e||e.id!==ee.modelId)return!1;const t=ee,o=(e.data.categories||[]).find(c=>c.id===t.categoryId);if(!o)return!1;o.items=o.items||[];const a=Math.min(Math.max(t.index,0),o.items.length);return o.items.splice(a,0,t.item),ee=null,we(),C=null,i(),Se(),ae(),se(t.item.id),console.log("[Blockscape] undo delete restored",t.item.id),!0}function kn(){if(!C||p<0)return!1;const t=y[p].data.categories||[];if(!t.length)return!1;const n=G.get(C);let r=null;if(n!=null&&n.catId&&(r=t.find(I=>I.id===n.catId)),r||(r=t.find(I=>(I.items||[]).some(T=>T.id===C))),!r||!Array.isArray(r.items))return!1;const o=r.items.findIndex(I=>I.id===C);if(o===-1)return!1;const a=r.items.splice(o,1)[0];if(!a)return!1;const c=y[p];ee={item:a,categoryId:r.id,index:o,modelId:c?c.id:null};const h=(()=>{var T;if(r.items.length){const P=Math.min(o,r.items.length-1);return((T=r.items[P])==null?void 0:T.id)||null}const I=t.findIndex(P=>P.id===r.id);if(I===-1)return null;for(let P=I+1;P<t.length;P++){const Q=t[P].items||[];if(Q.length)return Q[0].id}for(let P=I-1;P>=0;P--){const Q=t[P].items||[];if(Q.length)return Q[0].id}return null})();return we(),C=null,i(),Se(),ae(),h?se(h):$t(),console.log("[Blockscape] removed item",a.id),!0}j&&j.addEventListener("click",async()=>{const e=s.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await Te(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),Z&&Z.addEventListener("click",async()=>{try{const e=await ge();if(!e){alert("Clipboard is empty.");return}s.value=e,s.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=d(s.value,"Pasted");if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,r)=>{const o=ye(n,{versionLabel:e.length>1?`paste #${r+1}`:"paste"});t==null&&(t=o)}),p===-1&&t!=null?le(t):Me()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{if(p<0){alert("No active model selected.");return}try{const e=JSON.parse(s.value);oe(e,{titleHint:ie(y[p]),idHint:ve(y[p])||ie(y[p])}),y[p].data=e,y[p].title=e.title||y[p].title,et(),console.log("[Blockscape] replaced active model:",ie(y[p])),Se(),X.updateAvailability()}catch(e){console.error("[Blockscape] replace error:",e),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const r of t){const o=await r.text(),a=d(o,r.name.replace(/\.[^.]+$/,"")||"File");if(!a.length){console.warn("[Blockscape] no models in file:",r.name);continue}a.forEach((c,u)=>{var P;const h=(((P=c.data)==null?void 0:P.title)??"").toString().trim(),I=a.length>1?`${r.name} #${u+1}`:r.name,T=ye({...c,title:h||I},{versionLabel:r.name});n==null&&(n=T)})}p===-1&&n!=null?le(n):Me()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",An);function An(e){var o;if(!$())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!k(t))return;let n=[];try{n=d(t,"Clipboard")}catch(a){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",a);return}if(!n.length)return;e.preventDefault();let r=null;n.forEach((a,c)=>{const u=ye(a,{versionLabel:n.length>1?`paste #${c+1}`:"paste"});r==null&&(r=u)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),r!=null&&le(r)}R.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(pt(),le(n))}),document.getElementById("removeModel").onclick=()=>{if(p<0)return;if(console.log("[Blockscape] removing model:",ie(y[p])),y.splice(p,1),!y.length){p=-1,D=null,b.innerHTML="",S.innerHTML="",s.value="",Me(),et();return}const e=Math.min(p,y.length-1);le(e)},document.getElementById("search").addEventListener("input",e=>{const t=e.target.value.trim().toLowerCase();console.log("[Blockscape] search:",t),b.querySelectorAll(".tile").forEach(n=>{const r=n.querySelector(".name").textContent.toLowerCase();n.style.opacity=!t||r.includes(t)?1:.2})}),v&&V&&_&&v.addEventListener("submit",async e=>{e.preventDefault();const t=V.value.trim();if(!t){alert("Please enter a URL"),V.focus();return}const n=await Bt(t);if(typeof n=="number"){le(n),V.value="";const r=document.getElementById("urlHint");r&&(r.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!V||!t)return;let n=null;V.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=V.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function Se(){if(!(p<0))try{D=Oe(y[p].data),ae()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function In(){const e=["NFR.bs","planets.bs","letters.bs"],t=n=>wt?wt.endsWith("/")?`${wt}${n}`:`${wt}/${n}`:n;for(const n of e)try{const r=await fetch(t(n),{cache:"no-store"});if(!r.ok){console.warn(`[Blockscape] ${n} not fetched (${r.status}); skipping`);continue}const o=await r.text(),a=n.replace(/\.[^.]+$/,"")||"Model",c=d(o,a);if(!c.length){console.warn("[Blockscape] no models found in",n);continue}c.forEach(u=>{ye(u,{versionLabel:n})}),console.log(`[Blockscape] loaded ${c.length} model(s) from ${n}`)}catch(r){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",r)}Me()}async function Cn(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const r of t)try{console.log(`[Blockscape] fetching ${e} with cache="${r.cache??"default"}"`);const o=await fetch(e,r);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function Ln(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(r=>Sn(r)),e.querySelectorAll("a[href]").forEach(r=>{const o=r.getAttribute("href");Yt(o)&&Wt(r,o)})}function Sn(e){var u,h;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(h=(u=e.parentNode)==null?void 0:u.closest)!=null&&h.call(u,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,r=[];let o;for(;(o=n.exec(t))!==null;)r.push({url:o[0],index:o.index});if(!r.length)return;const a=document.createDocumentFragment();let c=0;r.forEach(({url:I,index:T})=>{T>c&&a.appendChild(document.createTextNode(t.slice(c,T))),a.appendChild(Nn(I)),c=T+I.length}),c<t.length&&a.appendChild(document.createTextNode(t.slice(c))),e.parentNode.replaceChild(a,e)}function Nn(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",Yt(e)&&Wt(t,e),t}function Wt(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>$n(n,t,e)))}async function $n(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await Bt(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function Yt(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function Bt(e){try{console.log("[Blockscape] loading from URL:",e);const t=await Cn(e),r=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=d(t,r)}catch(c){throw new Error(`Invalid JSON payload: ${c.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let a=null;return o.forEach((c,u)=>{var P;const h=(((P=c.data)==null?void 0:P.title)??"").toString().trim(),I=o.length>1?`${r} #${u+1}`:r,T=ye({...c,title:h||I},{versionLabel:r});a==null&&(a=T)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,r),p===-1&&a!=null?le(a):Me(),a}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const r=d(n,"Blockscape");if(!r.length)throw new Error("Seed template could not be parsed.");let o=null;r.forEach(T=>{const P=ye(T,{versionLabel:"seed"});o==null&&(o=P)}),await In();const a=await pe(),c=U(),u=c==null?void 0:c.index,h=O();le(typeof a=="number"?a:typeof h=="number"?h:typeof u=="number"?u:o??0)})()}function sr(s){let f,b,S,x,R,N=`<script id="seed" type="application/json">${s[0]}<\/script>`,v,V,_,W,J,H;return{c(){f=ct("link"),b=st(),S=ct("div"),S.innerHTML=`<header class="pf-v5-c-page__header"><div class="pf-v5-c-masthead pf-m-display-inline blockscape-masthead"><div class="pf-v5-c-masthead__content"><div class="blockscape-toolbar"><div class="blockscape-brand"><h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></div> <div class="blockscape-toolbar__controls"><label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <form id="urlForm" class="blockscape-url-form" autocomplete="on" novalidate=""><label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-secondary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div></form> <label class="pf-v5-c-button pf-m-secondary blockscape-file"><span>Load File(s)</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/></label> <button id="openInEditor" class="pf-v5-c-button pf-m-primary" type="button" title="Open current JSON in the editor">Edit</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button> <button id="shareModel" class="pf-v5-c-button pf-m-primary" type="button" title="Copy a shareable URL for this model">Share</button></div> <div class="blockscape-legend" role="presentation"><span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span></div></div></div></div></header> <main class="pf-v5-c-page__main"><div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div></main>`,x=st(),R=new Dn(!1),v=st(),V=on("svg"),_=st(),W=ct("div"),J=st(),H=ct("div"),H.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',document.title="Blockscape — simple landscape-style tiles",fe(f,"rel","icon"),fe(f,"type","image/svg+xml"),fe(f,"href","./favicon.svg"),fe(S,"class","pf-v5-c-page"),R.a=v,fe(V,"id","overlay"),fe(V,"class","svg-layer"),fe(W,"id","tabTooltip"),fe(W,"class","blockscape-tab-tooltip"),W.hidden=!0,fe(W,"aria-hidden","true"),fe(H,"id","itemPreview"),fe(H,"class","item-preview"),H.hidden=!0,fe(H,"aria-hidden","true")},m(F,q){Vn(document.head,f),Ae(F,b,q),Ae(F,S,q),Ae(F,x,q),R.m(N,F,q),Ae(F,v,q),Ae(F,V,q),Ae(F,_,q),Ae(F,W,q),Ae(F,J,q),Ae(F,H,q)},p:Qe,i:Qe,o:Qe,d(F){F&&(me(b),me(S),me(x),R.d(),me(v),me(V),me(_),me(W),me(J),me(H)),me(f)}}}function cr(s){const f=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;return Fn(()=>{ar()}),[f]}class lr extends er{constructor(f){super(),Zn(this,f,cr,sr,On,{})}}const dr=document.getElementById("root");new lr({target:dr});
