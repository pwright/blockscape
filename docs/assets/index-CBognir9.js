var Vo=Object.defineProperty;var Ho=(o,l,p)=>l in o?Vo(o,l,{enumerable:!0,configurable:!0,writable:!0,value:p}):o[l]=p;var Et=(o,l,p)=>Ho(o,typeof l!="symbol"?l+"":l,p);(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))_(w);new MutationObserver(w=>{for(const $ of w)if($.type==="childList")for(const I of $.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&_(I)}).observe(document,{childList:!0,subtree:!0});function p(w){const $={};return w.integrity&&($.integrity=w.integrity),w.referrerPolicy&&($.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?$.credentials="include":w.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function _(w){if(w.ep)return;w.ep=!0;const $=p(w);fetch(w.href,$)}})();function vt(){}function Ti(o){return o()}function yi(){return Object.create(null)}function on(o){o.forEach(Ti)}function $i(o){return typeof o=="function"}function Gn(o,l){return o!=o?l==l:o!==l||o&&typeof o=="object"||typeof o=="function"}function Do(o){return Object.keys(o).length===0}const Fo=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function S(o,l){o.appendChild(l)}function Ke(o,l,p){o.insertBefore(l,p||null)}function De(o){o.parentNode&&o.parentNode.removeChild(o)}function M(o){return document.createElement(o)}function Bi(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function zn(o){return document.createTextNode(o)}function ne(){return zn(" ")}function Nt(o,l,p,_){return o.addEventListener(l,p,_),()=>o.removeEventListener(l,p,_)}function Jo(o){return function(l){return l.preventDefault(),o.call(this,l)}}function b(o,l,p){p==null?o.removeAttribute(l):o.getAttribute(l)!==p&&o.setAttribute(l,p)}function jo(o){let l;return{p(...p){l=p,l.forEach(_=>o.push(_))},r(){l.forEach(p=>o.splice(o.indexOf(p),1))}}}function qo(o){return Array.from(o.childNodes)}function Go(o,l){l=""+l,o.data!==l&&(o.data=l)}function Gt(o,l){o.value=l??""}class zo{constructor(l=!1){Et(this,"is_svg",!1);Et(this,"e");Et(this,"n");Et(this,"t");Et(this,"a");this.is_svg=l,this.e=this.n=null}c(l){this.h(l)}m(l,p,_=null){this.e||(this.is_svg?this.e=Bi(p.nodeName):this.e=M(p.nodeType===11?"TEMPLATE":p.nodeName),this.t=p.tagName!=="TEMPLATE"?p:p.content,this.c(l)),this.i(_)}h(l){this.e.innerHTML=l,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(l){for(let p=0;p<this.n.length;p+=1)Ke(this.t,this.n[p],l)}p(l){this.d(),this.h(l),this.i(this.a)}d(){this.n.forEach(De)}}let nn;function en(o){nn=o}function Ko(){if(!nn)throw new Error("Function called outside component initialization");return nn}function Wo(o){Ko().$$.on_mount.push(o)}const qt=[],Ei=[];let zt=[];const ki=[],Yo=Promise.resolve();let Dn=!1;function Xo(){Dn||(Dn=!0,Yo.then(Oi))}function Fn(o){zt.push(o)}const Un=new Set;let Jt=0;function Oi(){if(Jt!==0)return;const o=nn;do{try{for(;Jt<qt.length;){const l=qt[Jt];Jt++,en(l),Zo(l.$$)}}catch(l){throw qt.length=0,Jt=0,l}for(en(null),qt.length=0,Jt=0;Ei.length;)Ei.pop()();for(let l=0;l<zt.length;l+=1){const p=zt[l];Un.has(p)||(Un.add(p),p())}zt.length=0}while(qt.length);for(;ki.length;)ki.pop()();Dn=!1,Un.clear(),en(o)}function Zo(o){if(o.fragment!==null){o.update(),on(o.before_update);const l=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,l),o.after_update.forEach(Fn)}}function Qo(o){const l=[],p=[];zt.forEach(_=>o.indexOf(_)===-1?l.push(_):p.push(_)),p.forEach(_=>_()),zt=l}const mn=new Set;let er;function Jn(o,l){o&&o.i&&(mn.delete(o),o.i(l))}function _i(o,l,p,_){if(o&&o.o){if(mn.has(o))return;mn.add(o),er.c.push(()=>{mn.delete(o)}),o.o(l)}}function xi(o){o&&o.c()}function jn(o,l,p){const{fragment:_,after_update:w}=o.$$;_&&_.m(l,p),Fn(()=>{const $=o.$$.on_mount.map(Ti).filter($i);o.$$.on_destroy?o.$$.on_destroy.push(...$):on($),o.$$.on_mount=[]}),w.forEach(Fn)}function qn(o,l){const p=o.$$;p.fragment!==null&&(Qo(p.after_update),on(p.on_destroy),p.fragment&&p.fragment.d(l),p.on_destroy=p.fragment=null,p.ctx=[])}function tr(o,l){o.$$.dirty[0]===-1&&(qt.push(o),Xo(),o.$$.dirty.fill(0)),o.$$.dirty[l/31|0]|=1<<l%31}function Kn(o,l,p,_,w,$,I=null,v=[-1]){const H=nn;en(o);const z=o.$$={fragment:null,ctx:[],props:$,update:vt,not_equal:w,bound:yi(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(H?H.$$.context:[])),callbacks:yi(),dirty:v,skip_bound:!1,root:l.target||H.$$.root};I&&I(z.root);let ie=!1;if(z.ctx=p?p(o,l.props||{},(D,ae,...le)=>{const xe=le.length?le[0]:ae;return z.ctx&&w(z.ctx[D],z.ctx[D]=xe)&&(!z.skip_bound&&z.bound[D]&&z.bound[D](xe),ie&&tr(o,D)),ae}):[],z.update(),ie=!0,on(z.before_update),z.fragment=_?_(z.ctx):!1,l.target){if(l.hydrate){const D=qo(l.target);z.fragment&&z.fragment.l(D),D.forEach(De)}else z.fragment&&z.fragment.c();l.intro&&Jn(o.$$.fragment),jn(o,l.target,l.anchor),Oi()}en(H)}class Wn{constructor(){Et(this,"$$");Et(this,"$$set")}$destroy(){qn(this,1),this.$destroy=vt}$on(l,p){if(!$i(p))return vt;const _=this.$$.callbacks[l]||(this.$$.callbacks[l]=[]);return _.push(p),()=>{const w=_.indexOf(p);w!==-1&&_.splice(w,1)}}$set(l){this.$$set&&!Do(l)&&(this.$$.skip_bound=!0,this.$$set(l),this.$$.skip_bound=!1)}}const nr="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(nr);const Si="blockscape:apicurioConfig",Rn="http://localhost:8080/apis/registry/v3",un="bs",Ii="-series",Vn=!1,Hn=!1;function ir({models:o,getActiveIndex:l,setActive:p,ensureModelMetadata:_,ensureSeriesId:w,getModelId:$,getSeriesId:I,getModelTitle:v,computeJsonFingerprint:H,uid:z}){let ie=null,D=null,ae=null,le=null,xe=null,U=null,F=null,W=null,R=null,j=null;const ke=new Set,A={baseUrl:Rn,groupId:un,authToken:"",enabled:Vn,useSemver:Hn},oe=new Map,Q=new Map;function de(s){return(s||"").toString().trim().replace(/\/+$/,"")}function re(s){return`${(s||"").toString().trim()||un}${Ii}`}function he(){return!!(A.baseUrl&&A.groupId)}function K(){return A.enabled!==!1}function Ce(){ke.forEach(s=>{try{s(K())}catch(f){console.warn("[Blockscape] failed to run Apicurio enabled listener",f)}})}function Ge(s){return typeof s=="function"&&ke.add(s),()=>ke.delete(s)}function be(){ae&&(ae.value=A.baseUrl||""),le&&(le.value=A.groupId||""),xe&&(xe.value=A.authToken||""),U&&(U.checked=K()),F&&(F.checked=!!A.useSemver)}function N(s="",f="muted"){W&&(W.textContent=s||"",W.classList.remove("is-error","is-success"),f==="error"?W.classList.add("is-error"):f==="success"&&W.classList.add("is-success"))}function ue(s){if(!j||(j.innerHTML="",!s))return;const f=document.createElement("p");f.className="apicurio-hint",f.textContent=s,j.appendChild(f)}function Fe(s){oe.clear(),Q.clear(),ue(s)}function Oe(){const s=l(),f=K(),y=he(),E=s>=0?o[s]:null,m=!!(E!=null&&E.apicurioVersions&&E.apicurioVersions.length>1);if(ie){const C=ie.dataset.loading==="true",O=f&&y&&s>=0&&!!Se(o[s]);ie.disabled=!f||C||!O,f?C||(ie.textContent="Push to Apicurio"):ie.textContent="Enable Apicurio to push"}if(R){const C=R.dataset.loading==="true",O=f&&y&&m&&!!Se(E);R.disabled=!O||C,R.hidden=!m,f?C||(R.textContent="Push series"):R.textContent="Enable Apicurio to push series"}if(D){const C=D.dataset.loading==="true",O=f&&y;D.disabled=!O||C,C||(f?y?D.textContent="List artifacts":D.textContent="Enter details to list":D.textContent="Enable Apicurio to list")}}function x(){be(),K()?he()?(N("Apicurio push is ready when a model is selected.","muted"),oe.size||ue("Click “List artifacts” to browse the current group.")):(N("Enter Apicurio connection details to enable push.","muted"),Fe("Enter registry details to browse artifacts.")):(N("Apicurio integration is off. Enable it to allow pushes.","muted"),Fe("Apicurio integration is disabled.")),Oe()}function k(){if(window!=null&&window.localStorage)try{localStorage.setItem(Si,JSON.stringify(A))}catch(s){console.warn("[Blockscape] unable to persist Apicurio settings",s)}}function pe(){let s={};if(window!=null&&window.localStorage)try{const C=localStorage.getItem(Si);if(C){const O=JSON.parse(C);O&&typeof O=="object"&&(s=O)}}catch(C){console.warn("[Blockscape] failed to restore Apicurio settings",C)}const f=de(s.baseUrl??Rn),y=(s.groupId??un).toString().trim();let E=Vn,m=Hn;typeof s.enabled=="boolean"?E=s.enabled:typeof s.enabled=="string"&&(E=s.enabled==="true"),typeof s.useSemver=="boolean"?m=s.useSemver:typeof s.useSemver=="string"&&(m=s.useSemver==="true"),A.baseUrl=f||Rn,A.groupId=y||un,A.authToken=(s.authToken??"").toString().trim(),A.enabled=E,A.useSemver=m,x(),Ce()}function J(){const s={Accept:"application/json"},f=(A.authToken||"").trim();return f&&(s.Authorization=/\s/.test(f)?f:`Bearer ${f}`),s}function te(s,f,{title:y,description:E,version:m}={}){const C={artifactId:s,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:f},metadata:{properties:{}}}};m&&(C.firstVersion.version=m),y&&(C.name=y),E&&(C.description=E);try{const O=JSON.parse(f),B=O==null?void 0:O.seriesId;B&&typeof B=="string"&&(C.firstVersion.metadata.properties.seriesId=B)}catch{}return C}function V(s,{version:f}={}){const y={content:{contentType:"application/json",content:s},metadata:{properties:{}}};try{const E=JSON.parse(s),m=E==null?void 0:E.seriesId;m&&typeof m=="string"&&(y.metadata.properties.seriesId=m)}catch{}return f&&(y.version=f),y}function Ne(s){if(s==null)return null;const f=String(s).trim();if(!f)return null;const y=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(f);if(y)return{major:Number(y[1]),minor:Number(y[2]),patch:Number(y[3])};const E=/^v?(\d+)$/.exec(f);return E?{major:Number(E[1]),minor:0,patch:0}:null}function Je(s){return`${s.major}.${s.minor}.${s.patch}`}function Me(s,f){return!s&&!f?0:s?f?s.major!==f.major?s.major-f.major:s.minor!==f.minor?s.minor-f.minor:s.patch-f.patch:1:-1}function Pe(s=[]){let f=null;if(s.forEach(E=>{const m=Ne((E==null?void 0:E.version)??E);m&&(!f||Me(m,f)>0)&&(f=m)}),!f)return"1.0.0";const y={...f,patch:f.patch+1};return Je(y)}function Se(s,{seriesName:f,fallbackTitle:y}={}){var C;if(!s)return null;const E=f||s.title||s.apicurioArtifactName||v(s),m=y||E;if(typeof w=="function"&&(s.isSeries||((C=s.apicurioVersions)==null?void 0:C.length)>1)&&w(s,{seriesName:E,fallbackTitle:m}),typeof I=="function"){const O=I(s,{seriesName:E,fallbackTitle:m});if(O)return O}return $(s)}function we(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.artifacts)?s.artifacts:Array.isArray(s==null?void 0:s.items)?s.items:Array.isArray(s==null?void 0:s.results)?s.results:[]}function me(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.versions)?s.versions:Array.isArray(s==null?void 0:s.items)?s.items:[]}function ge(s=[]){if(!Array.isArray(s)||!s.length)return null;const f=[...s].filter(Boolean);return f.sort((y,E)=>{const m=y!=null&&y.createdOn?new Date(y.createdOn).getTime():0,C=E!=null&&E.createdOn?new Date(E.createdOn).getTime():0;if(m!==C)return C-m;const O=Number(y==null?void 0:y.version),B=Number(E==null?void 0:E.version),P=Number.isFinite(O),Y=Number.isFinite(B);if(P&&Y&&O!==B)return B-O;const q=String((y==null?void 0:y.version)??"");return String((E==null?void 0:E.version)??"").localeCompare(q,void 0,{numeric:!0})}),f[0]||null}function Re(s){if(!s)return s;let f=s;if(!Array.isArray(s==null?void 0:s.categories)){const E=s==null?void 0:s.content;if(typeof E=="string")try{f=JSON.parse(E)}catch(m){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",m)}else E&&typeof E=="object"&&(f=E)}return f}async function it(s,f,y){const E=encodeURIComponent(f),m=encodeURIComponent(y),C=`${s}/groups/${E}/artifacts/${m}`,O=J();O.Accept="application/json";const B=await fetch(C,{method:"GET",headers:O});if(!B.ok){let P=B.statusText||"Unknown error";try{const Y=await B.text();Y&&(P=Y.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${B.status}): ${P}`)}return B.json()}async function Xe(s,f,y){const E=encodeURIComponent(f),m=encodeURIComponent(y),C=`${s}/groups/${E}/artifacts/${m}/versions?limit=50&order=desc`,O=J();O.Accept="application/json";const B=await fetch(C,{method:"GET",headers:O});if(!B.ok){let Y=B.statusText||"Unknown error";try{const q=await B.text();q&&(Y=q.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${B.status}): ${Y}`)}const P=await B.json();return me(P).filter(Y=>Y&&Y.version!=null)}async function Ue(s,f,y,E="latest"){const m=encodeURIComponent(f),C=encodeURIComponent(y),O=encodeURIComponent(E||"latest"),B=`${s}/groups/${m}/artifacts/${C}/versions/${O}/content`,P=J();P.Accept="application/json, application/*+json, */*;q=0.8";const Y=await fetch(B,{method:"GET",headers:P});if(!Y.ok){let $e=Y.statusText||"Unknown error";try{const ce=await Y.text();ce&&($e=ce.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${Y.status}): ${$e}`)}const q=await Y.text();let ve=null;try{ve=JSON.parse(q)}catch{throw new Error("Artifact content is not valid JSON.")}return Re(ve)}async function Te(s,f,y,E="latest"){const m=await Ue(s,f,y,E);return{data:m,fingerprint:H(m)}}async function Qe(s,f,y){try{const m=await Xe(s,f,y);if(m!=null&&m.length){Q.set(y,m);const C=ge(m);if((C==null?void 0:C.version)!=null)return C.version}}catch(m){console.warn("[Blockscape] compare-version: unable to fetch versions list",m)}try{const m=await it(s,f,y);if((m==null?void 0:m.version)!=null)return m.version}catch(m){console.warn("[Blockscape] compare-version: unable to fetch metadata",m)}const E=Q.get(y);if(E&&E.length){const m=ge(E);if((m==null?void 0:m.version)!=null)return m.version}return"latest"}async function ut(s,f,y,E){if(!A.useSemver)return null;if(!E)return"1.0.0";try{const m=await Xe(s,f,y);return Pe(m)}catch(m){throw new Error(`Unable to compute next semantic version: ${m.message}`)}}function ee(s=document){ie=s.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),R=s.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),D=s.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),ae=s.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),le=s.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),xe=s.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),U=s.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),F=s.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),W=s.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),j=s.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function ye(){A.baseUrl=de((ae==null?void 0:ae.value)??A.baseUrl),A.groupId=((le==null?void 0:le.value)??"").trim(),A.authToken=((xe==null?void 0:xe.value)??"").trim(),k(),x()}function kt(s){A.enabled=s!==!1,k(),x(),Ce()}function _t(){kt(U?U.checked:Vn)}function Kt(){A.useSemver=F?F.checked:Hn,k(),x()}function xt(){[ae,le,xe].forEach(s=>{s&&s.addEventListener("input",ye)}),ie&&ie.addEventListener("click",()=>{wn()}),R&&R.addEventListener("click",()=>{an()}),U&&U.addEventListener("change",_t),F&&F.addEventListener("change",Kt),D&&D.addEventListener("click",yn),j&&j.addEventListener("click",s=>{const f=s.target.closest("[data-artifact-version]");if(f){s.stopPropagation();const m=f.dataset.artifactId,C=f.dataset.artifactVersion;m&&C&&Tt(m,C);return}const y=s.target.closest("[data-artifact-load-all]");if(y){s.stopPropagation(),y.dataset.artifactId&&En();return}const E=s.target.closest("[data-artifact-trigger]");if(E){const m=E.dataset.artifactId;if(!m)return;bn(m)}})}function St(){const s=document.createElement("div");return s.className="blockscape-registry-panel",s.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,s}function Wt(s){if(!s)return;s.innerHTML="";const f=St();s.appendChild(f),ee(s),xt(),x()}function hn(s){if(!j)return;if(j.innerHTML="",!s.length){ue("No artifacts found in this group.");return}const f=m=>{const C=document.createElement("section");C.className="apicurio-artifact-section";const O=document.createElement("h3");O.textContent=m,C.appendChild(O);const B=document.createElement("ul");return B.className="apicurio-artifact-list",C.appendChild(B),{section:C,list:B}},y=f("Series artifacts"),E=f("Artifacts");s.forEach(m=>{if(!(m!=null&&m.artifactId))return;const O=m._groupId&&m._groupId.endsWith(Ii)?y.list:E.list,B=document.createElement("li"),P=document.createElement("button");P.type="button",P.className="apicurio-artifact",P.dataset.artifactId=m.artifactId,P.dataset.artifactTrigger="toggle";const Y=document.createElement("span");Y.className="apicurio-artifact-title",Y.textContent=m.artifactId,P.appendChild(Y);const q=[];if(m.name&&q.push(m.name),m.version!=null&&q.push(`v${m.version}`),m.type&&q.push(m.type),m._groupId&&q.push(m._groupId),q.length){const ce=document.createElement("span");ce.className="apicurio-artifact-meta",ce.textContent=q.join(" • "),P.appendChild(ce)}if(m.description){const ce=document.createElement("span");ce.className="apicurio-artifact-meta",ce.textContent=m.description,P.appendChild(ce)}B.appendChild(P);const ve=document.createElement("div");ve.className="apicurio-version-list",ve.dataset.versionPanel=m.artifactId,ve.hidden=!0;const $e=document.createElement("p");$e.className="apicurio-hint",$e.textContent="Click to load the latest or open versions.",ve.appendChild($e),B.appendChild(ve),O.appendChild(B)}),y.list.children.length&&j.appendChild(y.section),E.list.children.length&&j.appendChild(E.section)}function rn(s){return j?j.querySelector(`[data-version-panel="${s}"]`):null}function at(s,f){if(!s||(s.innerHTML="",!f))return;const y=document.createElement("p");y.className="apicurio-hint",y.textContent=f,s.appendChild(y)}function gn(s,f){const y=rn(s);if(y){if(y.innerHTML="",!f.length){at(y,"No versions found for this artifact.");return}f.forEach(E=>{const m=document.createElement("button");m.type="button",m.className="apicurio-version-button",m.dataset.artifactId=s,m.dataset.artifactVersion=E.version;const C=[`Version ${E.version}`];if(E.createdOn){const O=new Date(E.createdOn);isNaN(O)||C.push(O.toISOString().slice(0,10))}m.textContent=C.join(" — "),y.appendChild(m)})}}async function bn(s){const f=rn(s);if(!f)return;if(f.dataset.open==="true"){f.hidden=!0,f.dataset.open="false";return}if(f.hidden=!1,f.dataset.open="true",f.dataset.loaded!=="true"){if(!he()){at(f,"Enter registry details first.");return}at(f,"Loading versions…");try{const E=de(A.baseUrl),m=oe.get(s),C=A.groupId.trim(),O=(m==null?void 0:m._groupId)||C,B=await Xe(E,O,s);Q.set(s,B),f.dataset.loaded="true",gn(s,B)}catch(E){console.error("[Blockscape] failed to load versions",E),at(f,`Unable to fetch versions: ${E.message}`)}}}function vn(s,f){var E;const y=o.findIndex(m=>m.apicurioArtifactId===s);if(y!==-1){const m=o[y].id;o[y]={...f,id:m||f.id},((E=o[y].apicurioVersions)==null?void 0:E.length)>1&&(o[y].isSeries=!0),p(y)}else o.push(f),p(o.length-1)}async function sn(s,f,y,E){const m=encodeURIComponent(f),C=encodeURIComponent(y),O=`${s}/groups/${m}/artifacts/${C}`;try{const B=await fetch(O,{method:"GET",headers:E});if(B.status===404)return!1;if(B.ok)return!0;throw B.status===401||B.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${B.status} while checking the artifact.`)}catch(B){throw B instanceof TypeError?new Error("Network error while contacting Apicurio registry."):B}}async function wn(){var O;if(!ie||ie.dataset.loading==="true")return;if(!K()){N("Apicurio integration is off. Enable it first.","error");return}if(!he()){N("Enter the registry base URL and group ID before pushing.","error");return}const s=l();if(s<0||!o[s]){N("No active model to push.","error");return}const f=Se(o[s],{fallbackTitle:v(o[s])});if(!f){N("Active model needs an id before pushing.","error");return}const y=de(A.baseUrl),E=A.groupId.trim(),m=JSON.stringify(o[s].data,null,2),C=J();ie.dataset.loading="true",ie.textContent="Pushing…",ie.disabled=!0,N("Pushing to Apicurio…","muted");try{const B=await sn(y,E,f,C),P=H(o[s].data);if(B)try{const _e=await Qe(y,E,f),{data:ze,fingerprint:We}=await Te(y,E,f,_e);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",_e),console.log("local fingerprint",P),console.log("registry fingerprint",We),console.log("local payload",o[s].data),console.log("registry payload",ze),console.groupEnd(),P&&We&&P===We){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){N("Push cancelled (content matches the latest registry version).","muted");return}N("Pushing identical content by user choice.","muted")}else We?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):N("Unable to compare with registry content (skipping confirmation).","muted")}catch(_e){console.warn("[Blockscape] unable to compare registry content before push",_e),N("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const Y=A.useSemver?await ut(y,E,f,B):null;if(A.useSemver&&!Y)throw new Error("Semantic versioning is enabled but no version could be computed.");const q=encodeURIComponent(E),ve=encodeURIComponent(f),$e=B?`${y}/groups/${q}/artifacts/${ve}/versions`:`${y}/groups/${q}/artifacts`,ce={...C,"Content-Type":"application/json"};Y&&(ce["X-Registry-Version"]=Y,N(`Pushing to Apicurio as version ${Y}…`,"muted"));const ot=B?V(m,{version:Y}):te(f,m,{title:v(o[s]),description:(O=o[s].data)==null?void 0:O.abstract,version:Y}),Ve=await fetch($e,{method:"POST",headers:ce,body:JSON.stringify(ot)});if(!Ve.ok){let _e=Ve.statusText||"Unknown error";try{const ze=await Ve.text();ze&&(_e=ze.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${Ve.status}): ${_e}`)}let Ie=null;try{Ie=await Ve.json()}catch{Ie=null}const fe=(Ie==null?void 0:Ie.version)||(Ie==null?void 0:Ie.globalId)||"",Ae=B?"Updated":"Created",et=fe?` (version ${fe})`:"";N(`${Ae} ${f}${et}`,"success")}catch(B){console.error("[Blockscape] Apicurio push failed",B),N(`Apicurio push failed: ${B.message}`,"error")}finally{ie.dataset.loading="false",Oe()}}async function an(){var Y,q;if(!R||R.dataset.loading==="true")return;if(!K()){N("Apicurio integration is off. Enable it first.","error");return}if(!he()){N("Enter the registry base URL and group ID before pushing.","error");return}const s=l(),f=s>=0?o[s]:null;if(!f||!f.apicurioVersions||f.apicurioVersions.length<2){N("Series push requires a model with multiple versions.","error");return}const y=Se(f,{seriesName:f.title||f.apicurioArtifactName||v(f)});if(!y){N("Active series needs an id before pushing.","error");return}typeof w=="function"&&w(f,{seriesName:f.title||f.apicurioArtifactName||v(f)});const E=de(A.baseUrl),m=A.groupId.trim(),C=f.apicurioVersions.map(ve=>ve.data),O=JSON.stringify(C,null,2),B=J(),P=re(m);R.dataset.loading="true",R.textContent="Pushing…",R.disabled=!0,N("Pushing series to Apicurio…","muted");try{const ve=await sn(E,P,y,B),$e=H(C);if(ve)try{const ct=await Qe(E,P,y),{data:$t,fingerprint:It}=await Te(E,P,y,ct);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",ct),console.log("local fingerprint",$e),console.log("registry fingerprint",It),console.log("local payload (series)",C),console.log("registry payload",$t),console.groupEnd(),$e&&It&&$e===It){if(!window.confirm("The current registry version matches this series. Push anyway?")){N("Series push cancelled (content matches latest).","muted");return}N("Pushing identical series by user choice.","muted")}else It?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):N("Unable to compare with registry content (skipping confirmation).","muted")}catch(ct){console.warn("[Blockscape] unable to compare registry content before series push",ct),N("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const ce=A.useSemver?await ut(E,P,y,ve):null;if(A.useSemver&&!ce)throw new Error("Semantic versioning is enabled but no version could be computed.");const ot=encodeURIComponent(P),Ve=encodeURIComponent(y),Ie=ve?`${E}/groups/${ot}/artifacts/${Ve}/versions`:`${E}/groups/${ot}/artifacts`,fe={...B,"Content-Type":"application/json"};ce&&(fe["X-Registry-Version"]=ce,N(`Pushing series to Apicurio as version ${ce}…`,"muted"));const Ae=ve?V(O,{version:ce}):te(y,O,{title:f.apicurioArtifactName||((Y=f.data)==null?void 0:Y.title)||y,description:(q=f.data)==null?void 0:q.abstract,version:ce}),et=await fetch(Ie,{method:"POST",headers:fe,body:JSON.stringify(Ae)});if(!et.ok){let ct=et.statusText||"Unknown error";try{const $t=await et.text();$t&&(ct=$t.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${et.status}): ${ct}`)}let _e=null;try{_e=await et.json()}catch{_e=null}const ze=(_e==null?void 0:_e.version)||(_e==null?void 0:_e.globalId)||"",We=ve?"Updated":"Created",pt=ze?` (version ${ze})`:"";N(`${We} ${y} series${pt}`,"success")}catch(ve){console.error("[Blockscape] Apicurio series push failed",ve),N(`Apicurio series push failed: ${ve.message}`,"error")}finally{R.dataset.loading="false",Oe()}}async function yn(){if(!D||D.dataset.loading==="true")return;if(!K()){N("Enable Apicurio integration to list artifacts.","error");return}if(!he()){N("Enter registry base URL and group ID before listing.","error");return}const s=de(A.baseUrl),f=A.groupId.trim(),y=re(f),E=[{groupId:f,label:"base"},{groupId:y,label:"series"}];D.dataset.loading="true",D.textContent="Listing…",D.disabled=!0,N("Listing artifacts…","muted"),ue("Contacting registry…");try{const m=J();m.Accept="application/json";const C=[];for(const B of E){const P=encodeURIComponent(B.groupId),Y=`${s}/groups/${P}/artifacts?limit=50&offset=0`,q=await fetch(Y,{method:"GET",headers:m});if(!q.ok){let ce=q.statusText||"Unknown error";try{const ot=await q.text();ot&&(ce=ot.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${B.groupId} (${q.status}): ${ce}`);continue}const ve=await q.json(),$e=we(ve).filter(ce=>ce&&ce.artifactId);$e.forEach(ce=>{ce&&(ce._groupId=B.groupId)}),C.push(...$e)}oe.clear(),Q.clear(),C.forEach(B=>{B!=null&&B.artifactId&&oe.set(B.artifactId,B)}),hn(C);const O=C.length;N(O?`Found ${O} artifact${O===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",O?"success":"muted")}catch(m){console.error("[Blockscape] failed to list artifacts",m),Fe("Unable to list artifacts."),N(`Listing failed: ${m.message}`,"error")}finally{D.dataset.loading="false",Oe()}}async function Tt(s,f=null){var ve,$e,ce,ot,Ve,Ie;if(!s)return;if(!K()){N("Enable Apicurio integration to load artifacts.","error");return}if(!he()){N("Enter registry connection details before loading artifacts.","error");return}const y=de(A.baseUrl),E=A.groupId.trim(),m=s&&((ve=oe.get(s))==null?void 0:ve._groupId)||E;let C=oe.get(s);const O=async()=>{try{const fe=await it(y,m,s);return fe!=null&&fe.artifactId&&oe.set(s,fe),fe}catch(fe){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",fe),fe}};if(!C)try{C=await O()}catch(fe){N(`Failed to fetch artifact metadata: ${fe.message}`,"error");return}const B=Q.get(s)||[];let P="latest",Y="latest";if(f)P=f,Y=f;else{if(!C||C.version==null)try{C=await O()}catch(fe){N(`Failed to fetch artifact metadata: ${fe.message}`,"error");return}P=(C==null?void 0:C.version)||"latest",Y=(C==null?void 0:C.version)||"latest"}const q=B.find(fe=>String(fe.version)===String(P));(q==null?void 0:q.version)!=null&&(Y=q.version),N(`Loading artifact ${s}…`,"muted");try{const fe=await Ue(y,m,s,P),Ae=oe.get(s)||C||{},et=Array.isArray(fe);let _e=null;if(et){const ze=fe.map((pt,ct)=>(_(pt,{titleHint:Ae.name||s,idHint:s}),{version:String(ct+1),data:pt,createdOn:(q==null?void 0:q.createdOn)||Ae.createdOn}));_e={id:z(),title:((ce=($e=ze[0])==null?void 0:$e.data)==null?void 0:ce.title)||Ae.name||s,data:(ot=ze[0])==null?void 0:ot.data,apicurioArtifactId:s,apicurioArtifactName:Ae.name||"",apicurioVersions:ze,apicurioActiveVersionIndex:0,isSeries:!0};const We=((Ve=Ae==null?void 0:Ae.properties)==null?void 0:Ve.seriesId)||s;typeof w=="function"&&w(_e,{seriesName:We,fallbackTitle:We}),N(`Loaded series artifact ${s}.`,"success")}else{_(fe,{titleHint:Ae.name||s,idHint:s});const ze={version:Y,data:fe,createdOn:(q==null?void 0:q.createdOn)||Ae.createdOn};_e={id:z(),title:fe.title||Ae.name||s,data:fe,apicurioArtifactId:s,apicurioArtifactName:Ae.name||"",apicurioVersions:[ze],apicurioActiveVersionIndex:0};const We=(Ie=Ae==null?void 0:Ae.properties)==null?void 0:Ie.seriesId;We&&typeof w=="function"&&w(_e,{seriesName:We,fallbackTitle:We});const pt=Y?` (version ${Y})`:"";N(`Loaded artifact ${s}${pt}.`,"success")}vn(s,_e)}catch(fe){console.error("[Blockscape] failed to load artifact",fe),N(`Failed to load artifact: ${fe.message}`,"error")}}async function En(s){}return{hydrateConfig:pe,mount:Wt,updateAvailability:Oe,isEnabled:K,setEnabled:kt,onEnabledChange:Ge}}function jt(o,l){if(typeof o!="function")throw new Error(`[itemEditor] expected ${l} to be a function`)}function or(o,{excludeId:l}={}){if(!o)return[];const p=o.split(/[\s,]+/).map(w=>w.trim()).filter(Boolean),_=[];return p.forEach(w=>{l&&w===l||_.includes(w)||_.push(w)}),_}function rr(o,l,p){if(!l||!p||l===p)return;((o==null?void 0:o.categories)||[]).forEach(w=>{(w.items||[]).forEach($=>{Array.isArray($.deps)&&($.deps=$.deps.map(I=>I===l?p:I))})}),Array.isArray(o==null?void 0:o.links)&&o.links.forEach(w=>{w.from===l&&(w.from=p),w.to===l&&(w.to=p)})}function sr({findItemAndCategoryById:o,collectAllItemIds:l,updateItemReferences:p,loadActiveIntoEditor:_,rebuildFromActive:w,select:$,onSelectionRenamed:I}={}){jt(o,"findItemAndCategoryById"),jt(l,"collectAllItemIds"),jt(p,"updateItemReferences"),jt(_,"loadActiveIntoEditor"),jt(w,"rebuildFromActive"),jt($,"select");const v={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function H(U){if(v.fields.errorEl){if(!U){v.fields.errorEl.hidden=!0,v.fields.errorEl.textContent="";return}v.fields.errorEl.hidden=!1,v.fields.errorEl.textContent=U}}function z(){v.wrapper&&(v.wrapper.hidden=!0,v.wrapper.setAttribute("aria-hidden","true"),H(""),v.categoryId=null,v.itemId=null,v.modelData=null,document.body.classList.remove("item-editor-open"))}function ie(){v.wrapper&&(v.wrapper.hidden=!1,v.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var U,F;(U=v.fields.nameInput)==null||U.focus(),(F=v.fields.nameInput)==null||F.select()}))}function D(U){var de;if(!v.modelData||!v.categoryId||!v.itemId)throw new Error("No item loaded.");const W=(((de=v.modelData)==null?void 0:de.categories)||[]).find(re=>re.id===v.categoryId);if(!W)throw new Error("Category not found.");W.items=W.items||[];const R=W.items.find(re=>re.id===v.itemId);if(!R)throw new Error("Item not found.");const j=(U.id||"").trim();if(!j)throw new Error("ID is required.");const ke=l(v.modelData);if(j!==R.id&&ke.has(j))throw new Error("Another item already uses that ID.");R.id=j;const A=(U.name||"").trim();R.name=A||R.id;const oe=(U.logo||"").trim();if(oe?R.logo=oe:delete R.logo,U.externalFlag&&!U.external)R.external=!0;else{const re=(U.external??"").toString().trim();re?R.external=re:delete R.external}const Q=(U.color||"").trim();return Q?R.color=Q:delete R.color,R.deps=Array.isArray(U.deps)?U.deps:[],R.id!==U.originalId&&typeof I=="function"&&I(U.originalId,R.id),p(v.modelData,U.originalId,R.id),_(),w(),$(R.id),R.id}function ae(){if(!v.fields||!v.fields.idInput)return!1;const U=(v.fields.idInput.value||"").trim(),F={originalId:v.itemId,id:U,name:v.fields.nameInput.value||"",logo:v.fields.logoInput.value||"",external:v.fields.externalInput.value||"",externalFlag:v.fields.externalFlagInput.checked,color:v.fields.colorInput.value||"",deps:or(v.fields.depsInput.value,{excludeId:U})};try{return D(F),z(),!0}catch(W){return console.warn("[itemEditor] item edit failed",W),H((W==null?void 0:W.message)||"Unable to save item."),!1}}function le(){if(v.wrapper)return v.wrapper;const U=document.createElement("div");U.className="item-editor-modal",U.hidden=!0,U.setAttribute("role","dialog"),U.setAttribute("aria-modal","true");const F=document.createElement("div");F.className="item-editor-modal__backdrop",U.appendChild(F);const W=document.createElement("div");W.className="item-editor",U.appendChild(W);const R=document.createElement("div");R.className="item-editor__header";const j=document.createElement("h2");j.className="item-editor__title",j.textContent="Edit item";const ke=document.createElement("button");ke.type="button",ke.className="item-editor__close",ke.setAttribute("aria-label","Close item editor"),ke.textContent="×",R.appendChild(j),R.appendChild(ke),W.appendChild(R);const A=document.createElement("form");A.className="item-editor__form",W.appendChild(A);const oe=document.createElement("div");oe.className="item-editor__meta",oe.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',A.appendChild(oe);const Q=document.createElement("div");Q.className="item-editor__error",Q.hidden=!0,A.appendChild(Q);const de=(te,V,Ne)=>{const Je=document.createElement("label");Je.className="item-editor__field";const Me=document.createElement("span");if(Me.className="item-editor__label",Me.textContent=te,Je.appendChild(Me),V.classList.add("item-editor__control"),Je.appendChild(V),Ne){const Pe=document.createElement("div");Pe.className="item-editor__hint",Pe.textContent=Ne,Je.appendChild(Pe)}return Je},re=document.createElement("input");re.type="text",re.required=!0,A.appendChild(de("ID",re,"Unique identifier used for links and dependencies."));const he=document.createElement("input");he.type="text",A.appendChild(de("Name",he,"Visible label shown on the tile."));const K=document.createElement("input");K.type="url",K.inputMode="url",K.placeholder="https://…",A.appendChild(de("Logo URL",K,"Optional image URL."));const Ce=document.createElement("input");Ce.type="url",Ce.inputMode="url",Ce.placeholder="https://…",A.appendChild(de("External link",Ce,"Shown with ↗ icon and in preview."));const Ge=document.createElement("div");Ge.className="item-editor__checkbox";const be=document.createElement("label");be.className="item-editor__checkbox-row";const N=document.createElement("input");N.type="checkbox";const ue=document.createElement("span");ue.textContent="Mark as external without link";const Fe=document.createElement("div");Fe.className="item-editor__hint",Fe.textContent="Keeps dashed border even without a URL.",be.appendChild(N),be.appendChild(ue),Ge.appendChild(be),Ge.appendChild(Fe),A.appendChild(Ge);const Oe=document.createElement("input");Oe.type="text",Oe.placeholder="#2563eb",A.appendChild(de("Color",Oe,"Optional badge color (hex or CSS color)."));const x=document.createElement("textarea");x.rows=2,x.placeholder="Comma or space separated ids",A.appendChild(de("Dependencies",x,"Use item IDs, separated by commas or spaces."));const k=document.createElement("div");k.className="item-editor__actions";const pe=document.createElement("button");pe.type="button",pe.className="pf-v5-c-button pf-m-tertiary",pe.textContent="Cancel";const J=document.createElement("button");return J.type="submit",J.className="pf-v5-c-button pf-m-primary",J.textContent="Save",k.appendChild(pe),k.appendChild(J),A.appendChild(k),v.wrapper=U,v.fields={idInput:re,nameInput:he,logoInput:K,externalInput:Ce,externalFlagInput:N,colorInput:Oe,depsInput:x,categoryValue:oe.querySelector(".item-editor__meta-value"),errorEl:Q},pe.addEventListener("click",z),ke.addEventListener("click",z),F.addEventListener("click",z),A.addEventListener("submit",te=>{te.preventDefault(),ae()}),document.addEventListener("keydown",te=>{te.key==="Escape"&&!U.hidden&&(te.preventDefault(),te.stopPropagation(),z())}),document.body.appendChild(U),U}function xe(U){const F=o(U);return F?(le(),v.categoryId=F.category.id,v.itemId=F.item.id,v.modelData=F.modelData,v.fields.categoryValue.textContent=F.category.title||F.category.id,v.fields.idInput.value=F.item.id||"",v.fields.nameInput.value=F.item.name||"",v.fields.logoInput.value=F.item.logo||"",v.fields.externalInput.value=typeof F.item.external=="string"?F.item.external:"",v.fields.externalFlagInput.checked=F.item.external===!0,v.fields.colorInput.value=F.item.color||"",v.fields.depsInput.value=Array.isArray(F.item.deps)?F.item.deps.join(", "):"",H(""),$(F.item.id),ie(),!0):!1}return{open:xe,hide:z,isOpen:()=>!!v.wrapper&&!v.wrapper.hidden}}function Ci(o,l="series"){return(o||l).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||l}function tn(o,l="series"){const p=Ci(o,l).replace(/\./g,"-");return p.replace(/-series$/i,"").replace(/-+$/,"")||p||Ci(l,"series")}function Mi(o,{seriesName:l,fallbackTitle:p="unknown"}={}){var v,H;const w=[o==null?void 0:o.seriesId,(v=o==null?void 0:o.data)==null?void 0:v.seriesId,o==null?void 0:o.apicurioArtifactId,l,o==null?void 0:o.title,o==null?void 0:o.apicurioArtifactName,(H=o==null?void 0:o.data)==null?void 0:H.title,p].map(z=>(z??"").toString().trim()),$=w.findIndex(Boolean),I=$!==-1?w[$]:"";return I?(console.log("[Series] deriveSeriesId: picked base",{base:I,sourceIndex:$,candidates:w}),tn(I,p)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:p}),null)}function dt(o,{seriesName:l,fallbackTitle:p="unknown"}={}){if(!o||typeof o!="object")return null;const _=Mi(o,{seriesName:l,fallbackTitle:p});return _?(o.seriesId=_,o.apicurioArtifactId||(o.apicurioArtifactId=_),_):null}function pn(o,l={}){var w,$;if(!o)return null;const p=o.isSeries||((w=o.apicurioVersions)==null?void 0:w.length)>1||o.seriesId||(($=o.data)==null?void 0:$.seriesId)||o.apicurioArtifactId;if(!p&&!l.force)return null;const _=Mi(o,l);return _||(p?tn(l.fallbackTitle||"unknown"):null)}const fn=typeof import.meta<"u"&&"./"||"";function ar(){console.log("[Blockscape] init");const o=document.getElementById("jsonBox"),l=document.querySelector(".blockscape-json-panel"),p=document.getElementById("app"),_=document.getElementById("overlay"),w=document.getElementById("tabTooltip"),$=document.getElementById("modelList"),I=document.getElementById("itemPreview"),v=document.getElementById("urlForm"),H=document.getElementById("urlInput"),z=document.getElementById("loadUrl"),ie=I.querySelector(".item-preview__title"),D=I.querySelector(".item-preview__body"),ae=I.querySelector(".item-preview__actions"),le=I.querySelector(".item-preview__close"),xe=document.getElementById("downloadJson"),U=document.getElementById("shareModel"),F=document.getElementById("createVersion"),W=document.getElementById("openInEditor"),R=document.getElementById("copyJson"),j=document.getElementById("copySeries"),ke=document.getElementById("pasteJson"),A=document.getElementById("helpButton"),oe=document.getElementById("newPanelButton"),Q=document.getElementById("shortcutHelp"),de=document.getElementById("shortcutHelpList"),re=document.getElementById("shortcutHelpClose"),he=document.getElementById("shortcutHelpBackdrop"),K=document.getElementById("newPanel"),Ce=document.getElementById("newPanelClose"),Ge=document.getElementById("newPanelBackdrop"),be=document.getElementById("search"),N=document.getElementById("searchResults"),ue="blockscape:editorPayload",Fe="blockscape:editorTransfer",Oe=document.title;o.value=document.getElementById("seed").textContent.trim();let x=[],k=-1;const pe=ir({models:x,getActiveIndex:()=>k,setActive:rt,ensureModelMetadata:O,getModelId:q,getSeriesId:pn,ensureSeriesId:dt,getModelTitle:P,computeJsonFingerprint:m,uid:at});let J=null,te=new Map,V=null,Ne=null,Je=!0,Me=!1,Pe=0,Se={x:0,y:0},we="map",me=null,ge=!1,Re=null;const it=2e3;let Xe=null,Ue=null,Te=null,Qe=null,ut=null,ee=null,ye="",kt=!1,_t=null,Kt=null,xt=null,St=[],Wt=null;const hn=30,rn=1e3;pe.hydrateConfig();function at(){return Math.random().toString(36).slice(2,10)}function gn(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function bn(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function vn(e){return gn(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function sn(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),bn(t)}function wn(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=e,r.click(),URL.revokeObjectURL(i)}async function an(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function yn(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function Tt(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function En(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function s(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(c=>c&&typeof c=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function f(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t)}function y(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>y(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${y(e[i])}`).join(",")}}`}function E(e){try{return y(e)}catch{return""}}function m(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=E(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=E(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const C=[{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile."},{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Jump to the previous or next category while keeping position where possible."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Delete"]],description:"Delete the selected item (use Cmd/Ctrl+Z to undo)."},{keys:[["F2"]],description:"Open the item editor for the selected tile."},{keys:[["Escape"]],description:"Close the open preview popover."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."}];function O(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const r=(e.id??"").toString().trim();if(r)e.id=r;else{const c=n||e.title||t||"model",a=Tt(c).replace(/\./g,"-");e.id=a||`model-${at()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function B(e){return JSON.parse(JSON.stringify(e))}function P(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function Y(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const r=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(r)return r;const c=q(e);return c?`${c} series`:t}return P(e,t)}function q(e){var r;const t=pn(e);if(t)return t;const n=(r=e==null?void 0:e.data)==null?void 0:r.id;return n&&n.toString().trim()||null}function ve(e){var u;if(e<0||e>=x.length||!o)return!0;const t=x[e],n=(o.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}O(i,{titleHint:P(t),idHint:q(t)});const r=m(t.data),c=m(i);if(r===c)return!0;t.data=i;const a=Mt(t);return a>=0&&((u=t.apicurioVersions)!=null&&u[a])&&(t.apicurioVersions[a].data=i),!0}function $e(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function ce(e){if(k<0||!e)return null;const t=x[k].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const c=(i.items||[]).find(a=>a.id===e);if(c)return{category:i,item:c,modelData:t}}return null}function ot(e,t){const n=$e(t);let i=Tt(e||"item");if(!n.has(i))return i;const r=()=>at().slice(0,4);for(;n.has(i);)i=`${Tt(e||"item")}-${r()}`;return i}const Ve=sr({findItemAndCategoryById:ce,collectAllItemIds:$e,updateItemReferences:rr,loadActiveIntoEditor:wt,rebuildFromActive:ht,select:e=>Ye(e),onSelectionRenamed:(e,t)=>{var n;V===e&&(V=t),((n=me==null?void 0:me.item)==null?void 0:n.id)===e&&(me.item.id=t)}});function Ie(e,{versionLabel:t,createdOn:n}={}){var d,h,g;if(e!=null&&e.isSeries||((d=e==null?void 0:e.apicurioVersions)==null?void 0:d.length)>1){const L=e.title||P(e);dt(e,{seriesName:L,fallbackTitle:L})}const i=q(e);if(!i)return x.push(e),x.length-1;const r=x.findIndex(L=>q(L)===i);if(r===-1)return x.push(e),x.length-1;const c=x[r];if(!Array.isArray(c.apicurioVersions)||!c.apicurioVersions.length){c.apicurioVersions=[{version:"1",data:c.data,createdOn:(g=(h=c.apicurioVersions)==null?void 0:h[0])==null?void 0:g.createdOn}],c.apicurioActiveVersionIndex=0;const L=c.title||P(c);dt(c,{seriesName:L,fallbackTitle:L})}const a=String(c.apicurioVersions.length+1);c.apicurioVersions.push({version:a,data:e.data,createdOn:n||new Date().toISOString()}),c.apicurioActiveVersionIndex=c.apicurioVersions.length-1,c.data=e.data,c.title=P(e)||c.title,c.isSeries=!0;const u=c.title||P(c);return dt(c,{seriesName:u,fallbackTitle:u}),r}function fe({versionLabel:e}={}){if(k<0||!x[k])throw new Error("Load or select a model before creating a version.");let t;try{t=B(x[k].data)}catch(i){throw console.warn("[Blockscape] failed to clone active model for versioning",i),new Error("Could not copy the current model.")}return O(t,{titleHint:P(x[k]),idHint:q(x[k])}),Ie({title:P(x[k]),data:t},{versionLabel:e||"manual",createdOn:new Date().toISOString()})}function Ae(){const e=k>=0&&x[k]?x[k]:null,t=q(e);document.title=t?`${t}-blockscape`:Oe}function et(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||P(e);return dt(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function _e(){const e=x[k],t=et(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function ze(e="shortcut",t=!1){const n=o.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=x[k],r=t?et(i):null,c=!!r,a=c?JSON.stringify(r,null,2):n,u=c&&pn(i)||P(i,"blockscape"),d=c?"-series":"",h=`${Tt(u)}${d}.json`;return wn(h,a),console.log(`[Blockscape] saved JSON (${e}):`,h),!0}const We={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function pt(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return We[n]||"#9ca3af"}function ct(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(d=>d+d).join(""):t,i=parseInt(n,16),r=i>>16&255,c=i>>8&255,a=i&255;return .2126*Math.pow(r/255,2.2)+.7152*Math.pow(c/255,2.2)+.0722*Math.pow(a/255,2.2)>.35?"#111111":"#ffffff"}function $t(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function It(){if(Ue)return;Ue=document.createElement("div"),Ue.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",Te=document.createElement("span"),Te.className="series-nav-notice__text",Ue.appendChild(e),Ue.appendChild(Te),document.body.appendChild(Ue)}function kn(){Qe&&(clearTimeout(Qe),Qe=null),Ue&&Ue.classList.remove("is-visible"),Te&&(Te.textContent="")}function cn(){Xe=null,kn()}function Pi(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function Ui(e,t,n){It(),Xe={id:e,targetVersionIndex:t};const i=Pi(n,t);_n(`Click again to open ${i} in this series.`)}function _n(e,t=it,n=null){if(It(),Te.textContent="",Te.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),r=document.createElement("a");r.href=n,r.target="_blank",r.rel="noopener",r.textContent=n,Te.appendChild(i),Te.appendChild(r)}Ue.classList.add("is-visible"),Qe&&clearTimeout(Qe),Qe=setTimeout(()=>kn(),t)}function Ri(){de&&(de.innerHTML="",C.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((r,c)=>{if(c>0){const u=document.createElement("span");u.className="shortcut-help__or",u.textContent="or",n.appendChild(u)}const a=document.createElement("div");a.className="shortcut-help__combo",r.forEach((u,d)=>{if(d>0){const g=document.createElement("span");g.className="shortcut-help__sep",g.textContent="+",a.appendChild(g)}const h=document.createElement("kbd");h.className="shortcut-help__key",h.textContent=u,a.appendChild(h)}),n.appendChild(a)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),de.appendChild(t)}),ge=!0)}function Vi(){return!!Q&&Q.hidden===!1}function Hi(){if(!Q)return;ge||Ri(),Re=document.activeElement,Q.hidden=!1,Q.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Q.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function xn(){if(!Q||Q.hidden)return;Q.hidden=!0,Q.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=Re;e!=null&&e.focus?e.focus({preventScroll:!0}):A!=null&&A.focus&&A.focus({preventScroll:!0})}function Di(){if(!K)return;K.hidden=!1,K.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=K.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Sn(){!K||K.hidden||(K.hidden=!0,K.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),oe!=null&&oe.focus&&oe.focus({preventScroll:!0}))}let In=!1;function Yn(){In||(In=!0,requestAnimationFrame(()=>{In=!1,An(),Ut()}))}let Xn=!1;function Zn(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Fi(e){const t=Zn(e);if(!t.length){p.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}p.querySelectorAll(".tile").forEach(n=>{var a;const i=(((a=n.querySelector(".name"))==null?void 0:a.textContent)||"").toLowerCase(),r=(n.dataset.id||"").toLowerCase(),c=t.every(u=>i.includes(u)||r.includes(u));n.style.opacity=c?"1":"0.2"})}function Ji(e){const t=Zn(e);if(!t.length)return[];const n=[];return x.forEach((i,r)=>{var h;const c=Y(i),a=q(i)||"",u=`${c} ${a}`.toLowerCase();t.every(g=>u.includes(g))&&n.push({type:"model",modelIndex:r,modelTitle:c,modelId:a}),(Array.isArray((h=i.data)==null?void 0:h.categories)?i.data.categories:[]).forEach(g=>{const L=(g.title||g.id||"").toString();(g.items||[]).forEach(G=>{const X=(G.name||G.id||"").toString(),Ee=`${X} ${G.id||""} ${L}`.toLowerCase();t.every(Be=>Ee.includes(Be))&&n.push({type:"item",modelIndex:r,modelTitle:c,modelId:a,itemId:G.id,itemName:X,categoryTitle:L})})})}),n.slice(0,hn)}function Qn(e){if(!N)return;N.innerHTML="";const t=(e||"").toString();if(!t.trim()){N.hidden=!0;return}if(!x.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",N.appendChild(i),N.hidden=!1;return}const n=Ji(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",N.appendChild(i),N.hidden=!1;return}n.forEach(i=>{const r=document.createElement("button");r.type="button",r.className="search-result",r.dataset.modelIndex=String(i.modelIndex),i.itemId&&(r.dataset.itemId=i.itemId),i.type&&(r.dataset.type=i.type),i.modelIndex===k&&(!i.itemId||V===i.itemId)&&r.classList.add("is-active");const c=document.createElement("div");c.className="search-result__primary";const a=document.createElement("span");a.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",c.appendChild(a);const u=document.createElement("span");u.className="search-result__badge",u.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",c.appendChild(u);const d=document.createElement("div");d.className="search-result__meta";const h=document.createElement("span");if(h.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,d.appendChild(h),i.type==="item"&&i.itemId){const g=document.createElement("span");g.textContent=`Item ID: ${i.itemId}`,d.appendChild(g)}else if(i.type==="model"){const g=document.createElement("span");g.textContent="Matches model title",d.appendChild(g)}r.appendChild(c),r.appendChild(d),N.appendChild(r)}),N.hidden=!1}function ei(e){Fi(e||""),Qn(e||"")}function ji(e){!e||!Number.isInteger(e.modelIndex)||(rt(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(k!==e.modelIndex)return;const t=(n=te.get(e.itemId))==null?void 0:n.el;t&&(Ye(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function rt(e){if(lt(),cn(),me=null,e<0||e>=x.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}kt=!0,k=e,console.log("[Blockscape] active model:",P(x[e]),"(index",e+" )"),Ae(),Bt(),wt(),ht(),be&&ei(be.value||""),pe.updateAvailability()}function Bt(){if($.innerHTML="",!x.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",$.appendChild(e);return}x.forEach((e,t)=>{var L;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===k?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===k?"true":"false");const r=document.createElement("span");r.className="model-nav-label";const c=document.createElement("span");c.className="model-nav-title",c.textContent=Y(e),r.appendChild(c);const a=q(e);if(a){const G=document.createElement("span");G.className="model-nav-id",G.textContent=a,r.appendChild(G)}const u=Array.isArray((L=e.data)==null?void 0:L.categories)?e.data.categories:[],d=u.reduce((G,X)=>G+(X.items||[]).length,0),h=document.createElement("span");h.className="model-nav-meta";const g=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";h.textContent=`${u.length} cat · ${d} items${g}`,i.appendChild(r),i.appendChild(h),n.appendChild(i),$.appendChild(n)}),pe.updateAvailability()}function wt(){if(k<0){o.value="",j&&(j.disabled=!0);return}const e=x[k];o.value=JSON.stringify(e.data,null,2),j&&(j.disabled=!et(e))}function qi(e){try{return JSON.parse(e)}catch{return null}}function Gi(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const r=i.map((g,L)=>!g||typeof g!="object"?null:(O(g,{titleHint:`${t} #${L+1}`}),{obj:g,idx:L})).filter(Boolean);if(!r.length)return[];const c=r[0].obj,{seriesTitleOverride:a}=n;let u=a||c.title||`${t} series`;a&&!c.title&&(c.title=a);const d={id:at(),title:u,data:c,apicurioVersions:r.map(({obj:g,idx:L})=>({version:String(L+1),data:g})),apicurioActiveVersionIndex:0,isSeries:!0},h=dt(d,{seriesName:u,fallbackTitle:u});return h&&(d.id=h),[d]}function ti(e,t="Pasted",n={}){return Array.isArray(e)?Gi(e,t,n):!e||typeof e!="object"?[]:(O(e,{titleHint:`${t} #1`}),[{id:at(),title:e.title||`${t} #1`,data:e}])}function Ct(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const r=qi(i);if(r){let a=n;if(Array.isArray(r)&&n.promptForSeriesName){const d=s(r,t),h=En(d);a={...n,promptForSeriesName:!1,seriesTitleOverride:h||d}}const u=ti(r,t,a);if(u.length)return u}return i.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,u)=>{const d=JSON.parse(a);return O(d,{titleHint:`${t} #${u+1}`}),{id:at(),title:d.title||`${t} #${u+1}`,data:d}})}function zi(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function Ot(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!zi(e)}function Ki(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function ni(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(ue)}catch(r){return console.warn("[Blockscape] failed to access editor payload",r),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(r){console.warn("[Blockscape] invalid payload JSON",r);try{localStorage.removeItem(ue)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(ue)}catch(r){console.warn("[Blockscape] failed to clear editor payload",r)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=Ct(t.text,t.title||"Editor Export")}catch(r){return console.warn("[Blockscape] could not parse payload text",r),null}if(!n.length)return null;let i=null;return n.forEach(r=>{const c=Ie(r,{versionLabel:"editor"});i==null&&(i=c)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function ii(e="storage"){const t=ni();return!t||typeof t.index!="number"?!1:(rt(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function Wi(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let i;try{const a=sn(t);i=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const r=ti(i.data,i.title||"Shared Model");if(!r.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let c=null;return r.forEach(a=>{const u=a.isSeries?i.title||a.title:null,d=Ie({...a,apicurioArtifactName:u||a.apicurioArtifactName},{versionLabel:"shared"});c==null&&(c=d)}),c}async function Yi(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await Tn(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function Xi(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(c=>(c.items||[]).forEach(a=>{i.add(a.id);const u=new Set(a.deps||[]);(e.links||[]).forEach(d=>{d.from===a.id&&u.add(d.to)}),t.set(a.id,u),u.forEach(d=>{n.has(d)||n.set(d,new Set),n.get(d).add(a.id)})}));const r=new Set;return n.forEach((c,a)=>{((c==null?void 0:c.size)||0)>=2&&r.add(a)}),{m:e,fwd:t,rev:n,reusedLocal:r,seen:i}}function Zi(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const r=n.getContext("2d"),c=(e||"?").charAt(0).toUpperCase(),a=pt(e,t),u=ct(a);return r.fillStyle=a,r.beginPath(),r.arc(i/2,i/2,i/2-2,0,2*Math.PI),r.fill(),r.strokeStyle="rgba(0,0,0,0.15)",r.lineWidth=1,r.stroke(),r.fillStyle=u,r.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,r.textAlign="center",r.textBaseline="middle",r.fillText(c,i/2,i/2),n.toDataURL("image/png")}function Mt(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function oi(e){const t=Mt(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Qi(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var a,u;const r=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();r&&t.set(r,i);const c=(((u=n==null?void 0:n.data)==null?void 0:u.seriesId)??"").toString().trim();c&&!t.has(c)&&t.set(c,i)}),t}const ri=new WeakMap;function eo(e,t){var gt;if(!((gt=e==null?void 0:e.apicurioVersions)!=null&&gt[t]))return null;const n=e.apicurioVersions[t],i=n.data,r=m(i),c=ri.get(n);if(c&&c.fingerprint===r)return c.dataUrl;const a=160,u=90,d=document.createElement("canvas");d.width=a,d.height=u;const h=d.getContext("2d");h.fillStyle="#f8fafc",h.fillRect(0,0,a,u),h.strokeStyle="#e5e7eb",h.strokeRect(.5,.5,a-1,u-1);const g=Array.isArray(i==null?void 0:i.categories)?i.categories:[],L=Math.max(g.length,1),G=a/L,X=8,Ee=8,Be=4;g.forEach((Ze,bt)=>{const $n=bt*G+G/2,Ht=Array.isArray(Ze.items)?Ze.items:[],He=Math.max(Ht.length,1);Ht.forEach((Dt,hi)=>{const Bn=X+(hi+.5)*((u-X-Ee)/He);h.beginPath(),h.arc($n,Bn,Be,0,Math.PI*2);const Zt=pt(Dt.name||Dt.id||"",Dt.color);h.fillStyle=Zt,h.strokeStyle="rgba(15,23,42,0.25)",h.fill(),h.stroke()})});const tt=d.toDataURL("image/png");return ri.set(n,{fingerprint:r,dataUrl:tt}),tt}function Cn(e,t){var u;if(cn(),e<0||e>=x.length)return!1;const n=x[e];if(!((u=n==null?void 0:n.apicurioVersions)!=null&&u.length)||!ve(e))return!1;const r=n.apicurioVersions.length,c=(t%r+r)%r,a=n.apicurioVersions[c];return a!=null&&a.data?(n.apicurioActiveVersionIndex=c,n.data=a.data,kt=!0,V=null,Ne=null,wt(),ht(),!0):!1}function si(e){var i;if(!e||k<0)return;const t=x[k];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return;const n=Mt(t);n!==-1&&Cn(k,n+e)}function to(e){if(!(e!=null&&e.apicurioVersions)||e.apicurioVersions.length<=1)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||q(e)||"Artifact",t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const r=Mt(e),c=oi(e)||"latest";i.textContent=`No. in series ${c} (${r+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const a=document.createElement("div");a.className="version-nav__controls";const u=document.createElement("button");u.type="button",u.className="version-nav__button",u.textContent="Previous",u.addEventListener("click",()=>si(-1));const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Next",d.addEventListener("click",()=>si(1)),a.appendChild(u),a.appendChild(d),t.appendChild(a);const h=document.createElement("div");return h.className="version-nav__thumbs",e.apicurioVersions.forEach((g,L)=>{var Ze;const G=document.createElement("button");G.type="button",G.className="version-nav__thumb",L===r&&G.classList.add("is-active");const X=eo(e,L);if(X){const bt=document.createElement("img");bt.src=X,bt.alt=`Version ${L+1}`,G.appendChild(bt)}const Ee=document.createElement("div");Ee.className="version-nav__thumb-label";const Be=document.createElement("span");Be.className="version-nav__thumb-label-text";const tt=(((Ze=g==null?void 0:g.data)==null?void 0:Ze.id)??(g==null?void 0:g.id)??"").toString().trim(),gt=tt||(g!=null&&g.version?`v${g.version}`:`${L+1}`);Be.textContent=gt,Ee.title=tt||gt,Ee.appendChild(Be),G.appendChild(Ee),ro(Ee,Be),G.addEventListener("click",()=>Cn(k,L)),ao(G,g),h.appendChild(G)}),t.appendChild(h),t}function Pt(){var bi,vi,wi;if(!J)return;mt(),Array.isArray(J.m.categories)||(J.m.categories=[]),console.log("[Blockscape] rendering categories=",J.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!J.m.abstract,"- value:",J.m.abstract?J.m.abstract.substring(0,50)+"...":"none"),p.innerHTML="",te.clear(),St=[];const e=to(x[k]);e&&p.appendChild(e),_.setAttribute("width",window.innerWidth),_.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=J.m.title&&J.m.title.trim()||P(x[k]),t.appendChild(n),((bi=x[k])!=null&&bi.isSeries||((wi=(vi=x[k])==null?void 0:vi.apicurioVersions)==null?void 0:wi.length)>1)&&dt(x[k],{seriesName:x[k].title||J.m.title||P(x[k])});const i=oi(x[k]),r=pn(x[k]),c=(J.m.id??"").toString().trim(),a=document.createElement("div");a.className="blockscape-model-meta__details";const u=(T,se)=>{if(!se)return;const Z=document.createElement("div");Z.className="blockscape-model-id";const je=document.createElement("span");je.className="blockscape-model-id__label",je.textContent=T;const nt=document.createElement("span");nt.className="blockscape-model-id__value",nt.textContent=se,Z.append(je,nt),a.appendChild(Z)};u("Series ID",r),u("Model ID",c),u("No. in series",i),a.childElementCount&&t.appendChild(a),p.appendChild(t);const d=document.createElement("div");d.className="blockscape-tabs";const h=document.createElement("div");h.className="blockscape-tablist",h.setAttribute("role","tablist"),d.appendChild(h);const g=document.createElement("div");g.className="blockscape-tabpanels",d.appendChild(g);const L=document.createElement("div"),G=document.createElement("div"),X=document.createElement("div"),Ee=document.createElement("div");let Be="";const tt=Qi(x[k]),gt=Mt(x[k]);ee=null,ye="";const Ze=[{id:"map",label:"Map",panel:L},{id:"abstract",label:"Info",panel:G},{id:"source",label:"Settings",panel:X},{id:"apicurio",label:"Apicurio",panel:Ee}],bt=typeof pe.isEnabled=="function"?pe.isEnabled():!1,$n=T=>{if(!_)return;const se=T==="map";_.hidden=!se,se?(An(),Ut()):_.innerHTML=""};Ze.forEach((T,se)=>{const Z=document.createElement("button");Z.type="button",Z.id=`tab-${T.id}`,Z.className="blockscape-tab"+(se===0?" is-active":""),Z.setAttribute("role","tab"),Z.setAttribute("aria-controls",`panel-${T.id}`),Z.setAttribute("aria-selected",se===0?"true":"false"),Z.textContent=T.label,T.id==="apicurio"&&!bt&&(Z.hidden=!0,Z.tabIndex=-1,Z.setAttribute("aria-hidden","true"),Z.style.display="none"),T.button=Z,h.appendChild(Z),T.panel.id=`panel-${T.id}`,T.panel.classList.add("blockscape-tabpanel"),T.panel.setAttribute("role","tabpanel"),T.panel.setAttribute("aria-labelledby",Z.id),T.panel.hidden=se!==0,se===0&&T.panel.classList.add("is-active"),g.appendChild(T.panel)});const Ht=T=>{we=T,Ze.forEach(se=>{const Z=se.id===T;se.button.classList.toggle("is-active",Z),se.button.setAttribute("aria-selected",Z?"true":"false"),se.panel.classList.toggle("is-active",Z),se.panel.hidden=!Z}),$n(T)},He=Ze.find(T=>T.id==="apicurio"),Dt=T=>{if(!He||!He.button||!He.panel)return;const se=!!T;if(He.button.hidden=!se,He.button.tabIndex=se?0:-1,He.button.setAttribute("aria-hidden",se?"false":"true"),He.button.style.display=se?"":"none",se){const Z=we==="apicurio";He.button.classList.toggle("is-active",Z),He.button.setAttribute("aria-selected",Z?"true":"false"),He.panel.classList.toggle("is-active",Z),He.panel.hidden=!Z}else{const Z=He.panel.classList.contains("is-active");if(He.button.classList.remove("is-active"),He.button.setAttribute("aria-selected","false"),He.panel.classList.remove("is-active"),He.panel.hidden=!0,Z){const je=Ze.find(nt=>nt.id!=="apicurio");je&&Ht(je.id)}}Kt&&(Kt.checked=se)};Ze.forEach(T=>{T.button.addEventListener("click",()=>{mt(),Ht(T.id)}),T.id==="abstract"&&(ee=T.button,T.button.addEventListener("mouseenter",()=>Yt(T.button,Be,{offset:12})),T.button.addEventListener("mouseleave",mt),T.button.addEventListener("focus",()=>Yt(T.button,Be,{offset:12})),T.button.addEventListener("blur",mt))});const Bn=(T=>{const se=Ze.find(je=>je.id===we);if(se&&(se.id!=="apicurio"||T))return se.id;const Z=Ze.find(je=>je.id!=="apicurio"||T);return(Z==null?void 0:Z.id)||Ze[0].id})(bt);Ht(Bn),Dt(bt),typeof pe.onEnabledChange=="function"&&pe.onEnabledChange(Dt),p.appendChild(d);const Zt=document.createElement("div");Zt.className="blockscape-render",L.appendChild(Zt);const dn=document.createElement("div");if(dn.className="blockscape-abstract-panel",J.m.abstract){console.log("[Blockscape] Rendering abstract content");const T=document.createElement("div");T.className="blockscape-abstract",T.innerHTML=J.m.abstract,Lo(T),dn.appendChild(T),Be=T.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const T=document.createElement("div");T.className="blockscape-abstract-placeholder",T.textContent="No abstract has been provided for this model.",dn.appendChild(T),Be=T.outerHTML}ye=Be,G.appendChild(dn);const Qt=document.createElement("div");Qt.className="blockscape-source-panel";const Ft=document.createElement("div");Ft.className="blockscape-settings-panel";const On=document.createElement("p");On.className="blockscape-settings-panel__title",On.textContent="Feature toggles",Ft.appendChild(On);const Mn=({id:T,label:se,hint:Z,checked:je,className:nt="",onChange:qe})=>{const ft=document.createElement("label");ft.className=["settings-toggle",nt].filter(Boolean).join(" ");const Le=document.createElement("input");Le.type="checkbox",Le.id=T,Le.checked=je;const st=document.createElement("span");st.className="settings-toggle__text";const At=document.createElement("span");if(At.className="settings-toggle__label",At.textContent=se,st.appendChild(At),Z){const Lt=document.createElement("span");Lt.className="settings-toggle__hint",Lt.textContent=Z,st.appendChild(Lt)}return ft.appendChild(Le),ft.appendChild(st),typeof qe=="function"&&Le.addEventListener("change",()=>qe(Le.checked)),{row:ft,input:Le}},{row:Bo}=Mn({id:"toggleSecondaryLinks",label:"Show indirect links",checked:Je,className:"map-controls__toggle",onChange:T=>{Je=T,V?Ye(V):(Nn(),Ut())}});Ft.appendChild(Bo);const{row:Oo}=Mn({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:Me,className:"map-controls__toggle",onChange:T=>{Me=T,ci()}});Ft.appendChild(Oo);const Mo=typeof pe.isEnabled=="function"?pe.isEnabled():!1,{row:Po,input:Uo}=Mn({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:Mo,className:"apicurio-toggle",onChange:T=>{typeof pe.setEnabled=="function"&&pe.setEnabled(T)}});if(Kt=Uo,Ft.appendChild(Po),Qt.appendChild(Ft),l)l.hidden=!1,l.classList.remove("pf-v5-c-page__main-section"),Qt.appendChild(l);else{const T=document.createElement("p");T.className="muted",T.textContent="Source editor unavailable.",Qt.appendChild(T)}X.appendChild(Qt),pe.mount(Ee);let gi=0;J.m.categories.forEach(T=>{const se=document.createElement("section");se.className="category",se.dataset.cat=T.id;const Z=document.createElement("div");Z.className="cat-head",Z.innerHTML=`<div class="cat-title">${Rt(T.title||T.id)}</div>
                          <div class="muted cat-count">${(T.items||[]).length} items</div>`,se.appendChild(Z);const je=document.createElement("div");je.className="grid",se.appendChild(je),(T.items||[]).forEach(qe=>{gi+=1;const ft=io(qe.external),Le=document.createElement("div");if(Le.className=ft.isExternal?"tile external":"tile",Le.tabIndex=0,Le.dataset.id=qe.id,Le.dataset.globalIndex=String(gi),ft.url&&(Le.dataset.externalUrl=ft.url),tt.has(qe.id)){const Pn=tt.get(qe.id);Le.dataset.seriesVersionIndex=String(Pn),Le.classList.add("tile--series-link");const Ro=Pn===gt?"Current map in this series":`Open version ${Pn+1} in this series`;Le.title=Ro}const st=document.createElement("img");st.className="logo",qe.logo?(st.src=qe.logo,st.alt=qe.name||qe.id):(st.alt="",st.style.opacity=1,st.src=Zi(qe.name||qe.id,qe.color));const At=document.createElement("div");At.className="name",At.textContent=qe.name||qe.id;const Lt=document.createElement("div");Lt.className="badge",Lt.textContent="reused",ft.url&&Le.appendChild(oo(ft.url)),Le.appendChild(st),Le.appendChild(At),Le.appendChild(Lt),je.appendChild(Le),te.set(qe.id,{el:Le,catId:T.id,rect:null})}),Zt.appendChild(se);const nt=document.createElement("button");nt.type="button",nt.className="tile-add",nt.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',nt.addEventListener("click",()=>wo(T.id)),je.appendChild(nt)}),ci(),no(),An(),Ut(),co()}function no(){p.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",t=>{var h;if(typeof t.button=="number"&&t.button!==0)return;lt();const n=e.dataset.id,i=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,r=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,c=x[k],a=c?Mt(c):-1,u=((h=c==null?void 0:c.apicurioVersions)==null?void 0:h.length)>1&&Number.isInteger(i)&&i!==a,d=Xe&&Xe.id===n&&Xe.targetVersionIndex===i;if(Xe&&!d&&cn(),u)if(d){if(cn(),Cn(k,i))return}else Ui(n,i,c);else Number.isInteger(r)&&r>0&&r%5===0&&_n("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",n),V===n&&!(u&&d)){Ln();return}Ye(n)}),e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e.click())}),e.draggable=!0,e.addEventListener("dragstart",fo),e.addEventListener("dragend",mo)}),p.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",ho),e.addEventListener("drop",vo),e.addEventListener("dragenter",go),e.addEventListener("dragleave",bo)}),Xn||(Xn=!0,window.addEventListener("resize",Yn),window.addEventListener("scroll",Yn,{passive:!0}),window.addEventListener("resize",di)),document.getElementById("clear").onclick=()=>Ln()}function An(){te.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function ai(e,{includeSecondary:t=Je}={}){if(!e||!J)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(J.fwd.get(e)||[]),i=new Set(J.rev.get(e)||[]),r=new Set,c=new Set,a=[],u=new Set,d=(h,g,L,G)=>{if(!h||!g)return;const X=`${h}->${g}:${L}:${G}`;u.has(X)||(u.add(X),a.push({from:h,to:g,type:L,depth:G}))};return n.forEach(h=>d(e,h,"dep",1)),i.forEach(h=>d(e,h,"revdep",1)),t&&new Set([...n,...i]).forEach(g=>{(J.fwd.get(g)||new Set).forEach(X=>{const Ee=X===e;Ee||r.add(X),Ee||d(g,X,"dep",2)}),(J.rev.get(g)||new Set).forEach(X=>{const Ee=X===e;Ee||c.add(X),Ee||d(g,X,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:r,secondaryRevs:c,edges:a}}function ln(e,t){const n=te.get(e);n&&n.el.classList.add(t)}function Ye(e){var u,d,h;V=e,Ne=ai(e),Nn();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:r}=Ne;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const c=te.get(e);c&&c.el.classList.add("selected"),t.forEach(g=>ln(g,"dep")),n.forEach(g=>ln(g,"revdep")),i.forEach(g=>{!t.has(g)&&g!==e&&ln(g,"dep-indirect")}),r.forEach(g=>{!n.has(g)&&!t.has(g)&&g!==e&&ln(g,"revdep-indirect")}),Ut();const a=(h=(d=(u=te.get(e))==null?void 0:u.el)==null?void 0:d.dataset)==null?void 0:h.externalUrl;a&&_n("This item has link to",it,a)}function Ln(){V=null,Ne=null,Nn(),Ut()}function Nn(){p.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function ci(){J!=null&&J.reusedLocal&&J.reusedLocal.forEach(e=>{const t=te.get(e);if(!t)return;t.el.classList.toggle("reused",Me);const n=t.el.querySelector(".badge");n&&(n.style.display=Me?"inline-block":"none")})}function Ut(){for(;_.firstChild;)_.removeChild(_.firstChild);if(!V||_.hidden)return;Ne=ai(V),Ne.edges.forEach(t=>{var L,G;const n=(L=te.get(t.from))==null?void 0:L.rect,i=(G=te.get(t.to))==null?void 0:G.rect;if(!n||!i)return;const r=li(n),c=li(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),u=(r.x+c.x)/2,d=r.y,h=(r.x+c.x)/2,g=c.y;a.setAttribute("d",`M ${r.x},${r.y} C ${u},${d} ${h},${g} ${c.x},${c.y}`),a.setAttribute("fill","none"),a.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),a.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),a.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&a.setAttribute("stroke-dasharray","4 3"),a.setAttribute("vector-effect","non-scaling-stroke"),_.appendChild(a)})}function li(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function Rt(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function io(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function oo(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function di(){Wt||(Wt=requestAnimationFrame(()=>{Wt=null,St=St.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),St.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function ro(e,t){!e||!t||(St.push({labelEl:e,textEl:t}),di())}function so(e,t){var c,a;const n=[`<div class="version-nav__tooltip-title">${Rt(t)}</div>`],i=((e==null?void 0:e.version)??((c=e==null?void 0:e.data)==null?void 0:c.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${Rt(i)}</div>`);const r=(((a=e==null?void 0:e.data)==null?void 0:a.abstract)??"").toString().trim();return r?n.push(`<div class="version-nav__tooltip-body">${r}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function Yt(e,t,{offset:n=8}={}){!w||!e||!t||(w.innerHTML=t,w.hidden=!1,w.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),r=w.getBoundingClientRect(),c=window.scrollX||document.documentElement.scrollLeft,a=window.scrollY||document.documentElement.scrollTop;let u=i.left+i.width/2-r.width/2+c,d=i.top-r.height-n+a;u<c+n&&(u=c+n);const h=c+window.innerWidth-r.width-n;u>h&&(u=h),d<a+n&&(d=i.bottom+n+a),w.style.left=`${u}px`,w.style.top=`${d}px`,w.classList.add("is-visible")}))}function mt(){ut&&(clearTimeout(ut),ut=null),w&&(w.classList.remove("is-visible"),w.setAttribute("aria-hidden","true"),w.hidden=!0)}function ao(e,t){if(!e)return;const n=P((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=so(t,n);let r=null;const c=()=>{r&&(clearTimeout(r),r=null)},a=()=>{xt=e,Yt(e,`<div class="version-nav__tooltip-title">${Rt(n)}</div>`,{offset:10})},u=()=>{c(),r=setTimeout(()=>{xt===e&&Yt(e,i,{offset:10})},rn)},d=()=>{a(),u()},h=()=>{xt!==e&&a(),u()},g=()=>{c(),xt===e&&(xt=null,mt())};e.addEventListener("mouseenter",d),e.addEventListener("focus",d),e.addEventListener("pointermove",h),e.addEventListener("mouseleave",g),e.addEventListener("blur",g),e.addEventListener("click",g)}function co(){kt&&(kt=!1,!(!ee||!ye)&&(mt(),Yt(ee,ye,{offset:12}),ut=setTimeout(()=>{mt(),lo()},1e3)))}function lo(){ee&&(_t&&(clearTimeout(_t),_t=null),ee.classList.add("blockscape-tab--twinkle"),_t=setTimeout(()=>{ee.classList.remove("blockscape-tab--twinkle"),_t=null},1400))}window.addEventListener("scroll",mt,!0),window.addEventListener("resize",mt);function lt(){I&&(I.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),I.setAttribute("aria-hidden","true"),I.hidden=!0,ui([]))}function uo(e,t){I&&(Se={x:e,y:t},I.hidden=!1,I.setAttribute("aria-hidden","false"),I.classList.add("is-visible"),Vt(e,t))}function Vt(e,t){if(!I)return;const n=12;I.style.left=`${e+n}px`,I.style.top=`${t+n}px`;const i=I.getBoundingClientRect();let r=i.left,c=i.top;i.right>window.innerWidth-n&&(r=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(c=Math.max(n,window.innerHeight-i.height-n)),I.style.left=`${r}px`,I.style.top=`${c}px`}function ui(e=[]){ae&&(ae.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),ae.appendChild(n)}),ae.hidden=e.length===0)}async function po(e,t){var h;if(!I)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((h=t.querySelector(".name"))==null?void 0:h.textContent)||n||"Preview",r=n?`${n}.html`:"",c=r?`items/${r}`:"",a=++Pe,u=t.dataset.externalUrl||"",d=[{label:"Edit",title:"Edit this item",onClick:()=>{lt(),Ve.open(n)}}];if(u&&d.push({label:"Open link ↗",title:u,onClick:()=>window.open(u,"_blank","noopener")}),ui(d),n&&Ye(n),ie.textContent=i,D.innerHTML='<div class="item-preview__status">Loading…</div>',I.classList.remove("item-preview--has-frame"),I.classList.add("item-preview--expanded"),uo(e.clientX,e.clientY),!c){D.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',Vt(Se.x,Se.y);return}try{const g=await fetch(c,{cache:"no-cache"});if(!g.ok)throw new Error(`HTTP ${g.status}`);const L=await g.text();if(a!==Pe)return;if(!L.trim()){D.innerHTML=`<div class="item-preview__status">No content in <code>${Rt(r)}</code>.</div>`,Vt(Se.x,Se.y);return}const X=document.createElement("iframe");X.className="item-preview__frame",X.title=`${i} details`,X.srcdoc=L,D.innerHTML="",D.appendChild(X),I.classList.add("item-preview--has-frame"),Vt(Se.x,Se.y)}catch(g){if(a!==Pe)return;D.innerHTML=`<div class="item-preview__status">No preview available for <strong>${Rt(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${c}`,g),Vt(Se.x,Se.y)}}le&&le.addEventListener("click",lt),A&&A.addEventListener("click",()=>{Hi()}),oe&&oe.addEventListener("click",()=>{Di()}),re&&re.addEventListener("click",xn),he&&he.addEventListener("click",xn),Ce&&Ce.addEventListener("click",Sn),Ge&&Ge.addEventListener("click",Sn),p&&p.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!p.contains(t)||po(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!I||I.hidden||I.contains(e.target)||lt()}),xe&&xe.addEventListener("click",()=>{ze("button")}),F&&F.addEventListener("click",()=>{if(k<0){alert("Load or select a model before creating a version.");return}try{const e=fe({versionLabel:"map edit"});rt(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),U&&U.addEventListener("click",async()=>{var c;if(k<0||!x[k]){alert("Select or load a model before sharing.");return}const e={title:P(x[k],"Shared Model"),data:x[k].data};let t;try{t=vn(JSON.stringify(e))}catch(a){console.error("[Blockscape] share encode failed",a),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(a){console.warn("[Blockscape] failed to update URL for share",a),window.location.hash=n.hash}let r=!1;if((c=navigator.clipboard)!=null&&c.writeText)try{await navigator.clipboard.writeText(i),r=!0}catch(a){console.warn("[Blockscape] clipboard write failed",a)}r?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),W&&W.addEventListener("click",()=>{const e=(o.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};V&&(n.selectedItemId=V),localStorage.setItem(ue,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";V&&(t=`editor.html?selected=${encodeURIComponent(V)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==ue||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||ii("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===Fe&&ii("message")})),document.addEventListener("keydown",e=>{var n,i,r,c,a,u;if(Vi()){e.key==="Escape"&&(e.preventDefault(),xn());return}if(!(K!=null&&K.hidden)&&e.key==="Escape"){e.preventDefault(),Sn();return}if(!((n=Ve==null?void 0:Ve.isOpen)!=null&&n.call(Ve))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const d=x[k],h=((i=d==null?void 0:d.apicurioVersions)==null?void 0:i.length)>1;ze("shortcut",h);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!Ot())return;if(xo()){e.preventDefault();return}}if(e.key==="Escape"&&I&&!I.hidden&&lt(),e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!Ot()||e.altKey||e.ctrlKey||e.metaKey)return;const d=e.key==="ArrowLeft"?-1:1;e.shiftKey?yo(d)&&e.preventDefault():Eo(d)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!Ot()||e.altKey||e.ctrlKey||e.metaKey)return;const d=e.key==="ArrowUp"?-1:1;e.shiftKey?_o(d)&&e.preventDefault():ko(d)&&e.preventDefault()}if(e.key==="Delete"){if(!Ot()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;So()&&e.preventDefault()}if(e.key==="F2"){if(!Ot())return;const d=V||((u=(a=(c=(r=e.target)==null?void 0:r.closest)==null?void 0:c.call(r,".tile"))==null?void 0:a.dataset)==null?void 0:u.id);d&&Ve.open(d)&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!I||I.hidden||Vt(Se.x,Se.y)}),window.addEventListener("scroll",()=>{!I||I.hidden||lt()},!0);let yt=null,Xt=null;function fo(e){lt(),yt=e.target.dataset.id,Xt=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:yt,categoryId:Xt})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",yt,"from",Xt)}function mo(e){e.target.classList.remove("dragging"),p.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),p.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),yt=null,Xt=null}function ho(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function go(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function bo(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function vo(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!yt||!i)return;const c=Array.from(t.querySelectorAll(".tile")).filter(a=>a.dataset.id!==yt).find(a=>{const u=a.getBoundingClientRect();return e.clientY<u.top+u.height/2});pi(yt,c?c.dataset.id:null,i),Pt(),console.log("[Blockscape] drop completed",yt,"from",Xt,"to",i)}function pi(e,t,n){if(k<0)return;const r=x[k].data.categories||[],c=r.find(g=>(g.items||[]).some(L=>L.id===e)),a=r.find(g=>g.id===n);if(!c||!a)return;c.items=c.items||[],a.items=a.items||[];const u=c.items.findIndex(g=>g.id===e);if(u===-1)return;const[d]=c.items.splice(u,1);let h=a.items.length;if(t){const g=a.items.findIndex(L=>L.id===t);g!==-1&&(h=g)}a.items.splice(h,0,d),wt(),ht()}function wo(e){if(k<0||!e)return;const t=x[k].data,i=(t.categories||[]).find(d=>d.id===e);if(!i)return;i.items=i.items||[];const r=`New item ${i.items.length+1}`,a={id:ot(`${e}-${i.items.length+1}`,t),name:r,deps:[]};i.items.push(a),wt(),ht(),lt(),Ye(a.id);const u=te.get(a.id);u!=null&&u.el&&u.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",a.id,"to",e)}function yo(e){if(!V||k<0||!e)return!1;const n=x[k].data.categories||[],i=te.get(V);let r=null;if(i!=null&&i.catId&&(r=n.find(d=>d.id===i.catId)),r||(r=n.find(d=>(d.items||[]).some(h=>h.id===V))),!r)return!1;r.items=r.items||[];const c=r.items.findIndex(d=>d.id===V);if(c===-1)return!1;const a=c+e;if(a<0||a>=r.items.length)return!1;const[u]=r.items.splice(c,1);return r.items.splice(a,0,u),wt(),ht(),Pt(),Ye(V),!0}function Eo(e){if(!J||!J.m||!e)return!1;const t=J.m.categories||[];if(!t.length)return!1;const n=()=>{const d=t.find(h=>(h.items||[]).length);return d?{category:d,item:d.items[0]}:null};if(!V){const d=n();return d?(Ye(d.item.id),!0):!1}const i=te.get(V);let r=null;if(i!=null&&i.catId&&(r=t.find(d=>d.id===i.catId)),r||(r=t.find(d=>(d.items||[]).some(h=>h.id===V))),!r){const d=n();return d?(Ye(d.item.id),!0):!1}const c=r.items||[];if(!c.length)return!1;const a=c.findIndex(d=>d.id===V);if(a===-1)return!1;const u=a+e;return u<0||u>=c.length?!1:(Ye(c[u].id),!0)}function ko(e){if(!J||!J.m||!e)return!1;const t=J.m.categories||[];if(!t.length)return!1;const n=()=>{for(const d of t)if(d.items&&d.items.length)return d.items[0].id;return null};let r=(()=>{if(!V)return-1;const d=te.get(V);if(d!=null&&d.catId){const h=t.findIndex(g=>g.id===d.catId);if(h!==-1)return h}return t.findIndex(h=>(h.items||[]).some(g=>g.id===V))})();if(r===-1){const d=n();return d?(Ye(d),!0):!1}let a=(t[r].items||[]).findIndex(d=>d.id===V);a===-1&&(a=0);let u=r+e;for(;u>=0&&u<t.length;){const h=t[u].items||[];if(h.length){const g=Math.min(h.length-1,Math.max(0,a));return Ye(h[g].id),!0}u+=e>0?1:-1}return!1}function _o(e){if(!V||k<0||!e)return!1;const n=x[k].data.categories||[];if(!n.length)return!1;const i=te.get(V);let r=-1;if(i!=null&&i.catId&&(r=n.findIndex(L=>L.id===i.catId)),r===-1&&(r=n.findIndex(L=>(L.items||[]).some(G=>G.id===V))),r===-1)return!1;const c=r+e;if(c<0||c>=n.length)return!1;const a=n[r],u=n[c];if(!u)return!1;a.items=a.items||[],u.items=u.items||[];const d=a.items.findIndex(L=>L.id===V);if(d===-1)return!1;const h=Math.min(u.items.length,Math.max(0,d)),g=h<u.items.length?u.items[h].id:null;return pi(V,g,u.id),Pt(),Ye(V),!0}function xo(){if(!me||k<0)return!1;const e=x[k];if(!e||e.id!==me.modelId)return!1;const t=me,r=(e.data.categories||[]).find(a=>a.id===t.categoryId);if(!r)return!1;r.items=r.items||[];const c=Math.min(Math.max(t.index,0),r.items.length);return r.items.splice(c,0,t.item),me=null,lt(),V=null,Ne=null,wt(),ht(),Pt(),Ye(t.item.id),console.log("[Blockscape] undo delete restored",t.item.id),!0}function So(){if(!V||k<0)return!1;const t=x[k].data.categories||[];if(!t.length)return!1;const n=te.get(V);let i=null;if(n!=null&&n.catId&&(i=t.find(h=>h.id===n.catId)),i||(i=t.find(h=>(h.items||[]).some(g=>g.id===V))),!i||!Array.isArray(i.items))return!1;const r=i.items.findIndex(h=>h.id===V);if(r===-1)return!1;const c=i.items.splice(r,1)[0];if(!c)return!1;const a=x[k];me={item:c,categoryId:i.id,index:r,modelId:a?a.id:null};const d=(()=>{var g;if(i.items.length){const L=Math.min(r,i.items.length-1);return((g=i.items[L])==null?void 0:g.id)||null}const h=t.findIndex(L=>L.id===i.id);if(h===-1)return null;for(let L=h+1;L<t.length;L++){const G=t[L].items||[];if(G.length)return G[0].id}for(let L=h-1;L>=0;L--){const G=t[L].items||[];if(G.length)return G[0].id}return null})();return lt(),V=null,Ne=null,wt(),ht(),Pt(),d?Ye(d):Ln(),console.log("[Blockscape] removed item",c.id),!0}R&&R.addEventListener("click",async()=>{const e=o.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await an(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),j&&j.addEventListener("click",async()=>{const e=_e();if(!e){alert("No series available to copy. Create another version first.");return}await an(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),ke&&ke.addEventListener("click",async()=>{try{const e=await yn();if(!e){alert("Clipboard is empty.");return}o.value=e,o.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=Ct(o.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const r=Ie(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=r)}),k===-1&&t!=null?rt(t):Bt()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(k<0){alert("No active model selected.");return}try{const t=JSON.parse(o.value);if(O(t,{titleHint:P(x[k]),idHint:q(x[k])||P(x[k])}),x[k].data=t,x[k].title=t.title||x[k].title,x[k].isSeries||((e=x[k].apicurioVersions)==null?void 0:e.length)>1){const n=x[k].title||P(x[k]);dt(x[k],{seriesName:n,fallbackTitle:n})}Ae(),console.log("[Blockscape] replaced active model:",P(x[k])),ht(),pe.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const r=await i.text(),c=i.name.replace(/\.[^.]+$/,"")||"File",a=Ct(r,c,{seriesTitleOverride:`${c} series`});if(!a.length){console.warn("[Blockscape] no models in file:",i.name);continue}a.forEach((u,d)=>{var Be;const h=(((Be=u.data)==null?void 0:Be.title)??"").toString().trim(),g=a.length>1?`${i.name} #${d+1}`:i.name,L=`${c} series`,G=u.isSeries?L:null;let X={...u};if(u.isSeries){const tt=G||h||u.title||g||"unknown";X.title=tt;const gt=tn(tt||"unknown");f(X,gt),dt(X,{seriesName:tt,fallbackTitle:"unknown"}),X.apicurioArtifactName=X.apicurioArtifactName||tt}else X.title=h||g;const Ee=Ie({...X,apicurioArtifactName:X.apicurioArtifactName||G||X.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=Ee)})}k===-1&&n!=null?rt(n):Bt()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",Io);function Io(e){var r;if(!Ot())return;const t=((r=e.clipboardData)==null?void 0:r.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Ki(t))return;let n=[];try{n=Ct(t,"Clipboard",{promptForSeriesName:!0})}catch(c){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",c);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((c,a)=>{const u=Ie(c,{versionLabel:n.length>1?`paste #${a+1}`:"paste"});i==null&&(i=u)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&rt(i)}$.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&($t(),rt(n))}),document.getElementById("removeModel").onclick=()=>{if(k<0)return;const e=P(x[k]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",P(x[k])),x.splice(k,1),!x.length){k=-1,J=null,p.innerHTML="",_.innerHTML="",o.value="",Bt(),Ae();return}const n=Math.min(k,x.length-1);rt(n)},be&&(be.addEventListener("input",e=>{ei(e.target.value||"")}),be.addEventListener("focus",()=>{be.value&&be.value.trim()&&Qn(be.value)})),N&&N.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;ji({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!N||N.hidden)return;const t=e.target;N.contains(t)||be&&(t===be||be.contains(t))||(N.hidden=!0)}),v&&H&&z&&v.addEventListener("submit",async e=>{e.preventDefault();const t=H.value.trim();if(!t){alert("Please enter a URL"),H.focus();return}const n=await Tn(t);if(typeof n=="number"){rt(n),H.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!H||!t)return;let n=null;H.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const r=H.value.slice(-12);t.textContent=r?`…${r}`:""},300)})}();function ht(){if(!(k<0))try{J=Xi(x[k].data),Pt()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function Co(){const e=["comms.bs","planets.bs","styleguide.bs"],t=n=>fn?fn.endsWith("/")?`${fn}${n}`:`${fn}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const r=await i.text(),c=n.replace(/\.[^.]+$/,"")||"Model",a=Ct(r,c,{seriesTitleOverride:`${c} series`});if(!a.length){console.warn("[Blockscape] no models found in",n);continue}a.forEach(u=>{let d={...u};if(u.isSeries){const h=`${c} series`;d={...u,title:h,apicurioArtifactName:h};const g=tn(h||"unknown");f(d,g),dt(d,{seriesName:h,fallbackTitle:"unknown"})}Ie(d,{versionLabel:n})}),console.log(`[Blockscape] loaded ${a.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}Bt()}async function Ao(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const r=await fetch(e,i);if(r.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return await r.text()}catch(r){n=r}throw n||new Error("Unable to fetch URL")}function Lo(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>No(i)),e.querySelectorAll("a[href]").forEach(i=>{const r=i.getAttribute("href");mi(r)&&fi(i,r)})}function No(e){var u,d;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(d=(u=e.parentNode)==null?void 0:u.closest)!=null&&d.call(u,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let r;for(;(r=n.exec(t))!==null;)i.push({url:r[0],index:r.index});if(!i.length)return;const c=document.createDocumentFragment();let a=0;i.forEach(({url:h,index:g})=>{g>a&&c.appendChild(document.createTextNode(t.slice(a,g))),c.appendChild(To(h)),a=g+h.length}),a<t.length&&c.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(c,e)}function To(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",mi(e)&&fi(t,e),t}function fi(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>$o(n,t,e)))}async function $o(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await Tn(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function mi(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function Tn(e){try{console.log("[Blockscape] loading from URL:",e);const t=await Ao(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let r;try{r=Ct(t,i)}catch(a){throw new Error(`Invalid JSON payload: ${a.message}`)}if(!r.length)throw new Error("No JSON objects found in response.");let c=null;return r.forEach((a,u)=>{var X;const d=(((X=a.data)==null?void 0:X.title)??"").toString().trim(),h=r.length>1?`${i} #${u+1}`:i,g=a.isSeries?`${i} series`:null;let L={...a};if(a.isSeries){const Ee=g||d||L.title||h;L={...a,title:Ee,apicurioArtifactName:Ee||a.apicurioArtifactName};const Be=tn(Ee||"unknown");f(L,Be),dt(L,{seriesName:Ee||g||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:Be,url:e,baseName:i,seriesTitle:Ee})}const G=Ie({...L,title:d||L.title||h,apicurioArtifactName:L.apicurioArtifactName||g||a.apicurioArtifactName},{versionLabel:i});c==null&&(c=G)}),console.log(`[Blockscape] loaded ${r.length} model(s) from URL:`,i),k===-1&&c!=null?rt(c):Bt(),c}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=Ct(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let r=null;i.forEach(g=>{const L=Ie(g,{versionLabel:"seed"});r==null&&(r=L)}),await Co();const c=await Yi(),a=ni(),u=a==null?void 0:a.index,d=Wi();rt(typeof c=="number"?c:typeof d=="number"?d:typeof u=="number"?u:r??0)})()}function cr(o){let l;return{c(){l=M("div"),l.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',b(l,"id","shortcutHelp"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","shortcutHelpTitle")},m(p,_){Ke(p,l,_)},p:vt,i:vt,o:vt,d(p){p&&De(l)}}}class lr extends Wn{constructor(l){super(),Kn(this,l,null,cr,Gn,{})}}const dr=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function Ai(o){let l,p,_,w,$,I,v,H;return{c(){l=M("div"),p=M("div"),_=M("a"),w=zn("Open Blockscape GPT"),$=ne(),I=M("div"),I.textContent="Paste the copied prompt into that chat.",v=ne(),H=M("div"),H.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',b(_,"href",pr),b(_,"target","_blank"),b(_,"rel","noreferrer"),b(I,"class","new-panel__hint"),b(p,"class","new-panel__link"),b(H,"class","new-panel__link new-panel__link--disabled"),b(l,"class","new-panel__links")},m(z,ie){Ke(z,l,ie),S(l,p),S(p,_),S(_,w),S(p,$),S(p,I),S(l,v),S(l,H)},p:vt,d(z){z&&De(l)}}}function Li(o){let l,p,_,w,$,I;return{c(){l=M("div"),p=M("div"),p.textContent="Generated prompt",_=ne(),w=M("textarea"),b(p,"class","new-panel__prompt-label"),b(w,"class","pf-v5-c-form-control new-panel__textarea"),b(w,"rows","4"),w.readOnly=!0,b(l,"class","new-panel__prompt")},m(v,H){Ke(v,l,H),S(l,p),S(l,_),S(l,w),Gt(w,o[4]),$||(I=Nt(w,"input",o[12]),$=!0)},p(v,H){H&16&&Gt(w,v[4])},d(v){v&&De(l),$=!1,I()}}}function ur(o){let l,p,_,w,$,I,v,H,z,ie,D,ae,le,xe,U,F,W,R,j,ke,A,oe,Q,de,re,he,K,Ce,Ge,be,N,ue,Fe,Oe,x,k,pe,J,te,V,Ne,Je,Me,Pe,Se,we=o[2]==="gpt"&&Ai(),me=o[4]&&o[5]&&Li(o);return Me=jo(o[10][0]),{c(){l=M("div"),p=M("div"),_=ne(),w=M("div"),$=M("div"),$.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',I=ne(),v=M("form"),H=M("div"),z=M("label"),z.textContent="Domain",ie=ne(),D=M("p"),D.textContent="Describe what you want to create a map for.",ae=ne(),le=M("textarea"),xe=ne(),U=M("div"),F=M("label"),W=M("input"),R=ne(),j=M("span"),j.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,ke=ne(),A=M("fieldset"),oe=M("legend"),oe.textContent="Target",Q=ne(),de=M("p"),de.textContent="Choose where you plan to use the prompt.",re=ne(),he=M("label"),K=M("input"),Ce=ne(),Ge=M("div"),Ge.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',be=ne(),N=M("label"),ue=M("input"),Fe=ne(),Oe=M("div"),Oe.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',x=ne(),k=M("div"),pe=M("button"),pe.textContent="Copy prompt",J=ne(),te=M("div"),V=zn(o[3]),Ne=ne(),we&&we.c(),Je=ne(),me&&me.c(),b(p,"id","newPanelBackdrop"),b(p,"class","shortcut-help__backdrop"),b($,"class","shortcut-help__header"),b(z,"for","newDomain"),b(D,"class","new-panel__hint"),b(le,"id","newDomain"),b(le,"class","pf-v5-c-form-control new-panel__textarea"),b(le,"rows","4"),le.required=!0,b(le,"placeholder","Ex: Companies building open-source geospatial tools"),b(H,"class","new-panel__field"),b(W,"id","seriesToggle"),b(W,"type","checkbox"),b(F,"class","new-panel__toggle"),b(F,"for","seriesToggle"),b(U,"class","new-panel__field"),b(de,"class","new-panel__hint"),b(K,"type","radio"),b(K,"name","target"),K.__value="gpt",Gt(K,K.__value),b(he,"class","new-panel__option"),b(ue,"type","radio"),b(ue,"name","target"),ue.__value="plain",Gt(ue,ue.__value),b(N,"class","new-panel__option"),b(A,"class","new-panel__field"),b(pe,"class","pf-v5-c-button pf-m-primary"),b(pe,"type","submit"),b(te,"class","new-panel__status"),b(te,"aria-live","polite"),b(k,"class","new-panel__actions"),b(v,"class","shortcut-help__list new-panel__form"),b(w,"class","shortcut-help__panel"),b(w,"tabindex","-1"),b(l,"id","newPanel"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","newPanelTitle"),Me.p(K,ue)},m(ge,Re){Ke(ge,l,Re),S(l,p),S(l,_),S(l,w),S(w,$),S(w,I),S(w,v),S(v,H),S(H,z),S(H,ie),S(H,D),S(H,ae),S(H,le),Gt(le,o[0]),S(v,xe),S(v,U),S(U,F),S(F,W),W.checked=o[1],S(F,R),S(F,j),S(v,ke),S(v,A),S(A,oe),S(A,Q),S(A,de),S(A,re),S(A,he),S(he,K),K.checked=K.__value===o[2],S(he,Ce),S(he,Ge),S(A,be),S(A,N),S(N,ue),ue.checked=ue.__value===o[2],S(N,Fe),S(N,Oe),S(v,x),S(v,k),S(k,pe),S(k,J),S(k,te),S(te,V),S(v,Ne),we&&we.m(v,null),S(v,Je),me&&me.m(v,null),Pe||(Se=[Nt(le,"input",o[7]),Nt(W,"change",o[8]),Nt(K,"change",o[9]),Nt(ue,"change",o[11]),Nt(v,"submit",Jo(o[6]))],Pe=!0)},p(ge,[Re]){Re&1&&Gt(le,ge[0]),Re&2&&(W.checked=ge[1]),Re&4&&(K.checked=K.__value===ge[2]),Re&4&&(ue.checked=ue.__value===ge[2]),Re&8&&Go(V,ge[3]),ge[2]==="gpt"?we?we.p(ge,Re):(we=Ai(),we.c(),we.m(v,Je)):we&&(we.d(1),we=null),ge[4]&&ge[5]?me?me.p(ge,Re):(me=Li(ge),me.c(),me.m(v,null)):me&&(me.d(1),me=null)},i:vt,o:vt,d(ge){ge&&De(l),we&&we.d(),me&&me.d(),Me.r(),Pe=!1,on(Se)}}}const pr="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function fr(o,l,p){let _="",w=!1,$="gpt",I="",v="",H=!1;const z=()=>{var R;return typeof navigator<"u"&&!!((R=navigator.clipboard)!=null&&R.writeText)};function ie(R){const j=R||"[DOMAIN]",ke=w?"series":"map",oe=dr.replaceAll("[DOMAIN NAME]",j).replaceAll("[DOMAIN]",j).replaceAll("[map|series]",ke).split(`
`),Q=`Generate a **blockscape ${ke}** for the domain of ${j}.`,de=oe.findIndex(he=>he.toLowerCase().includes("generate a **blockscape value")||he.toLowerCase().includes("generate a blockscape [map|series]")||he.toLowerCase().startsWith("generate a blockscape"));de>=0?oe[de]=Q:oe.unshift(Q);const re=w?`

User requested a series (return an array of models).`:"";return`${oe.join(`
`).trim()}${re}`}async function D(R){R.preventDefault();const j=_.trim();if(p(3,I=""),p(5,H=$!=="gpt"),!j){p(3,I="Add a domain to generate a prompt."),p(4,v="");return}if($==="gpt"?p(4,v=`${w?"Create a series":"Create a map"} for ${j}`):(p(4,v=ie(j)),p(5,H=!0)),!z()){p(3,I="Clipboard access is unavailable. Copy the prompt below."),p(5,H=!0);return}try{await navigator.clipboard.writeText(v),p(3,I=$==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),$==="gpt"&&p(5,H=!1)}catch(A){console.warn("[Blockscape] clipboard write failed",A),p(3,I="Copy failed. Use the prompt below."),p(5,H=!0)}}const ae=[[]];function le(){_=this.value,p(0,_)}function xe(){w=this.checked,p(1,w)}function U(){$=this.__value,p(2,$)}function F(){$=this.__value,p(2,$)}function W(){v=this.value,p(4,v)}return[_,w,$,I,v,H,D,le,xe,U,ae,F,W]}class mr extends Wn{constructor(l){super(),Kn(this,l,fr,ur,Gn,{})}}const{document:Ni}=Fo;function hr(o){let l,p,_,w,$,I,v,H,z,ie,D,ae,le,xe,U,F,W,R,j,ke,A,oe,Q,de,re,he,K,Ce,Ge,be,N,ue,Fe,Oe,x,k,pe,J,te,V,Ne,Je=`<script id="seed" type="application/json">${o[1]}<\/script>`,Me,Pe,Se,we,me,ge,Re,it,Xe,Ue,Te,Qe,ut;return it=new lr({}),Ue=new mr({}),{c(){l=M("link"),p=ne(),_=M("div"),w=M("header"),$=M("div"),I=M("div"),v=M("div"),H=M("div"),H.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',z=ne(),ie=M("div"),D=M("div"),ae=M("button"),le=M("span"),le.textContent="Toggle search and edit tools",xe=ne(),U=M("span"),U.textContent="▾",F=ne(),W=M("button"),W.textContent="New",R=ne(),j=M("form"),j.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',ke=ne(),A=M("label"),A.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',oe=ne(),Q=M("button"),Q.textContent="Help",de=ne(),re=M("div"),he=M("div"),he.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',K=ne(),Ce=M("button"),Ce.textContent="Edit",Ge=ne(),be=M("button"),be.textContent="Share",Oe=ne(),x=M("div"),x.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',k=ne(),pe=M("main"),pe.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,J=ne(),te=M("footer"),te.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',V=ne(),Ne=new zo(!1),Me=ne(),Pe=Bi("svg"),Se=ne(),we=M("div"),me=ne(),ge=M("div"),ge.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',Re=ne(),xi(it.$$.fragment),Xe=ne(),xi(Ue.$$.fragment),Ni.title="Blockscape — simple landscape-style tiles",b(l,"rel","icon"),b(l,"type","image/svg+xml"),b(l,"href","./favicon.svg"),b(H,"class","blockscape-brand"),b(le,"class","sr-only"),b(U,"class","blockscape-toolbar__toggle-icon"),b(U,"aria-hidden","true"),b(ae,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),b(ae,"type","button"),b(ae,"aria-expanded",o[0]),b(ae,"aria-controls","blockscapeHeaderExtras"),b(W,"id","newPanelButton"),b(W,"class","pf-v5-c-button pf-m-primary"),b(W,"type","button"),b(W,"title","Create something new"),b(j,"id","urlForm"),b(j,"class","blockscape-url-form"),b(j,"autocomplete","on"),j.noValidate=!0,b(A,"class","pf-v5-c-button pf-m-primary blockscape-file"),b(Q,"id","helpButton"),b(Q,"class","pf-v5-c-button pf-m-primary"),b(Q,"type","button"),b(Q,"title","Show keyboard shortcuts"),b(D,"class","blockscape-toolbar__primary"),b(he,"class","blockscape-search"),b(Ce,"id","openInEditor"),b(Ce,"class","pf-v5-c-button pf-m-secondary"),b(Ce,"type","button"),b(Ce,"title","Open current JSON in the editor"),b(be,"id","shareModel"),b(be,"class","pf-v5-c-button pf-m-secondary"),b(be,"type","button"),b(be,"title","Copy a shareable URL for this model"),b(re,"id","blockscapeHeaderExtras"),b(re,"class","blockscape-toolbar__extras"),re.hidden=N=!o[0],b(re,"aria-hidden",ue=!o[0]),b(ie,"class","blockscape-toolbar__controls"),b(ie,"data-expanded",Fe=o[0]?"true":"false"),b(x,"class","blockscape-legend"),b(x,"role","presentation"),b(v,"class","blockscape-toolbar"),b(I,"class","pf-v5-c-masthead__content"),b($,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),b(w,"class","pf-v5-c-page__header"),b(pe,"class","pf-v5-c-page__main"),b(te,"class","pf-v5-c-page__footer blockscape-footer"),b(_,"class","pf-v5-c-page"),Ne.a=Me,b(Pe,"id","overlay"),b(Pe,"class","svg-layer"),b(we,"id","tabTooltip"),b(we,"class","blockscape-tab-tooltip"),we.hidden=!0,b(we,"aria-hidden","true"),b(ge,"id","itemPreview"),b(ge,"class","item-preview"),ge.hidden=!0,b(ge,"aria-hidden","true")},m(ee,ye){S(Ni.head,l),Ke(ee,p,ye),Ke(ee,_,ye),S(_,w),S(w,$),S($,I),S(I,v),S(v,H),S(v,z),S(v,ie),S(ie,D),S(D,ae),S(ae,le),S(ae,xe),S(ae,U),S(D,F),S(D,W),S(D,R),S(D,j),S(D,ke),S(D,A),S(D,oe),S(D,Q),S(ie,de),S(ie,re),S(re,he),S(re,K),S(re,Ce),S(re,Ge),S(re,be),S(v,Oe),S(v,x),S(_,k),S(_,pe),S(_,J),S(_,te),Ke(ee,V,ye),Ne.m(Je,ee,ye),Ke(ee,Me,ye),Ke(ee,Pe,ye),Ke(ee,Se,ye),Ke(ee,we,ye),Ke(ee,me,ye),Ke(ee,ge,ye),Ke(ee,Re,ye),jn(it,ee,ye),Ke(ee,Xe,ye),jn(Ue,ee,ye),Te=!0,Qe||(ut=Nt(ae,"click",o[2]),Qe=!0)},p(ee,[ye]){(!Te||ye&1)&&b(ae,"aria-expanded",ee[0]),(!Te||ye&1&&N!==(N=!ee[0]))&&(re.hidden=N),(!Te||ye&1&&ue!==(ue=!ee[0]))&&b(re,"aria-hidden",ue),(!Te||ye&1&&Fe!==(Fe=ee[0]?"true":"false"))&&b(ie,"data-expanded",Fe)},i(ee){Te||(Jn(it.$$.fragment,ee),Jn(Ue.$$.fragment,ee),Te=!0)},o(ee){_i(it.$$.fragment,ee),_i(Ue.$$.fragment,ee),Te=!1},d(ee){ee&&(De(p),De(_),De(V),Ne.d(),De(Me),De(Pe),De(Se),De(we),De(me),De(ge),De(Re),De(Xe)),De(l),qn(it,ee),qn(Ue,ee),Qe=!1,ut()}}}function gr(o,l,p){const _=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let w=!1;const $=()=>{if(p(0,w=!w),!w){const I=document.getElementById("search");I&&I.value&&(I.value="",I.dispatchEvent(new Event("input",{bubbles:!0})))}};return Wo(()=>{ar()}),[w,_,$]}class br extends Wn{constructor(l){super(),Kn(this,l,gr,hr,Gn,{})}}const vr=document.getElementById("root");new br({target:vr});
