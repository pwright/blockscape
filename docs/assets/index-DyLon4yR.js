var To=Object.defineProperty;var $o=(o,a,p)=>a in o?To(o,a,{enumerable:!0,configurable:!0,writable:!0,value:p}):o[a]=p;var wt=(o,a,p)=>$o(o,typeof a!="symbol"?a+"":a,p);(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))x(y);new MutationObserver(y=>{for(const T of y)if(T.type==="childList")for(const C of T.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&x(C)}).observe(document,{childList:!0,subtree:!0});function p(y){const T={};return y.integrity&&(T.integrity=y.integrity),y.referrerPolicy&&(T.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?T.credentials="include":y.crossOrigin==="anonymous"?T.credentials="omit":T.credentials="same-origin",T}function x(y){if(y.ep)return;y.ep=!0;const T=p(y);fetch(y.href,T)}})();function ft(){}function Bi(o){return o()}function ki(){return Object.create(null)}function tn(o){o.forEach(Bi)}function Oi(o){return typeof o=="function"}function Kn(o,a){return o!=o?a==a:o!==a||o&&typeof o=="object"||typeof o=="function"}function Bo(o){return Object.keys(o).length===0}const Oo=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function _(o,a){o.appendChild(a)}function je(o,a,p){o.insertBefore(a,p||null)}function Me(o){o.parentNode&&o.parentNode.removeChild(o)}function O(o){return document.createElement(o)}function Ui(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function Wn(o){return document.createTextNode(o)}function te(){return Wn(" ")}function xt(o,a,p,x){return o.addEventListener(a,p,x),()=>o.removeEventListener(a,p,x)}function Uo(o){return function(a){return a.preventDefault(),o.call(this,a)}}function v(o,a,p){p==null?o.removeAttribute(a):o.getAttribute(a)!==p&&o.setAttribute(a,p)}function Mo(o){let a;return{p(...p){a=p,a.forEach(x=>o.push(x))},r(){a.forEach(p=>o.splice(o.indexOf(p),1))}}}function Po(o){return Array.from(o.childNodes)}function Ro(o,a){a=""+a,o.data!==a&&(o.data=a)}function Ft(o,a){o.value=a??""}class Vo{constructor(a=!1){wt(this,"is_svg",!1);wt(this,"e");wt(this,"n");wt(this,"t");wt(this,"a");this.is_svg=a,this.e=this.n=null}c(a){this.h(a)}m(a,p,x=null){this.e||(this.is_svg?this.e=Ui(p.nodeName):this.e=O(p.nodeType===11?"TEMPLATE":p.nodeName),this.t=p.tagName!=="TEMPLATE"?p:p.content,this.c(a)),this.i(x)}h(a){this.e.innerHTML=a,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(a){for(let p=0;p<this.n.length;p+=1)je(this.t,this.n[p],a)}p(a){this.d(),this.h(a),this.i(this.a)}d(){this.n.forEach(Me)}}let en;function Zt(o){en=o}function Ho(){if(!en)throw new Error("Function called outside component initialization");return en}function Do(o){Ho().$$.on_mount.push(o)}const Dt=[],xi=[];let Jt=[];const Ii=[],Fo=Promise.resolve();let Jn=!1;function Jo(){Jn||(Jn=!0,Fo.then(Mi))}function jn(o){Jt.push(o)}const Vn=new Set;let Vt=0;function Mi(){if(Vt!==0)return;const o=en;do{try{for(;Vt<Dt.length;){const a=Dt[Vt];Vt++,Zt(a),jo(a.$$)}}catch(a){throw Dt.length=0,Vt=0,a}for(Zt(null),Dt.length=0,Vt=0;xi.length;)xi.pop()();for(let a=0;a<Jt.length;a+=1){const p=Jt[a];Vn.has(p)||(Vn.add(p),p())}Jt.length=0}while(Dt.length);for(;Ii.length;)Ii.pop()();Jn=!1,Vn.clear(),Zt(o)}function jo(o){if(o.fragment!==null){o.update(),tn(o.before_update);const a=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,a),o.after_update.forEach(jn)}}function qo(o){const a=[],p=[];Jt.forEach(x=>o.indexOf(x)===-1?a.push(x):p.push(x)),p.forEach(x=>x()),Jt=a}const hn=new Set;let Go;function qn(o,a){o&&o.i&&(hn.delete(o),o.i(a))}function Si(o,a,p,x){if(o&&o.o){if(hn.has(o))return;hn.add(o),Go.c.push(()=>{hn.delete(o)}),o.o(a)}}function _i(o){o&&o.c()}function Gn(o,a,p){const{fragment:x,after_update:y}=o.$$;x&&x.m(a,p),jn(()=>{const T=o.$$.on_mount.map(Bi).filter(Oi);o.$$.on_destroy?o.$$.on_destroy.push(...T):tn(T),o.$$.on_mount=[]}),y.forEach(jn)}function zn(o,a){const p=o.$$;p.fragment!==null&&(qo(p.after_update),tn(p.on_destroy),p.fragment&&p.fragment.d(a),p.on_destroy=p.fragment=null,p.ctx=[])}function zo(o,a){o.$$.dirty[0]===-1&&(Dt.push(o),Jo(),o.$$.dirty.fill(0)),o.$$.dirty[a/31|0]|=1<<a%31}function Yn(o,a,p,x,y,T,C=null,w=[-1]){const V=en;Zt(o);const q=o.$$={fragment:null,ctx:[],props:T,update:ft,not_equal:y,bound:ki(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(a.context||(V?V.$$.context:[])),callbacks:ki(),dirty:w,skip_bound:!1,root:a.target||V.$$.root};C&&C(q.root);let ne=!1;if(q.ctx=p?p(o,a.props||{},(H,le,...ue)=>{const Se=ue.length?ue[0]:le;return q.ctx&&y(q.ctx[H],q.ctx[H]=Se)&&(!q.skip_bound&&q.bound[H]&&q.bound[H](Se),ne&&zo(o,H)),le}):[],q.update(),ne=!0,tn(q.before_update),q.fragment=x?x(q.ctx):!1,a.target){if(a.hydrate){const H=Po(a.target);q.fragment&&q.fragment.l(H),H.forEach(Me)}else q.fragment&&q.fragment.c();a.intro&&qn(o.$$.fragment),Gn(o,a.target,a.anchor),Mi()}Zt(V)}class Xn{constructor(){wt(this,"$$");wt(this,"$$set")}$destroy(){zn(this,1),this.$destroy=ft}$on(a,p){if(!Oi(p))return ft;const x=this.$$.callbacks[a]||(this.$$.callbacks[a]=[]);return x.push(p),()=>{const y=x.indexOf(p);y!==-1&&x.splice(y,1)}}$set(a){this.$$set&&!Bo(a)&&(this.$$.skip_bound=!0,this.$$set(a),this.$$.skip_bound=!1)}}const Ko="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ko);const Ci="blockscape:apicurioConfig",Hn="http://localhost:8080/apis/registry/v3",pn="bs",Ai="-series",Dn=!1,Fn=!1;function Wo({models:o,getActiveIndex:a,setActive:p,ensureModelMetadata:x,ensureSeriesId:y,getModelId:T,getSeriesId:C,getModelTitle:w,computeJsonFingerprint:V,uid:q}){let ne=null,H=null,le=null,ue=null,Se=null,U=null,D=null,z=null,P=null,F=null;const ke=new Set,A={baseUrl:Hn,groupId:pn,authToken:"",enabled:Dn,useSemver:Fn},oe=new Map,Y=new Map;function fe(s){return(s||"").toString().trim().replace(/\/+$/,"")}function re(s){return`${(s||"").toString().trim()||pn}${Ai}`}function ge(){return!!(A.baseUrl&&A.groupId)}function G(){return A.enabled!==!1}function Ce(){ke.forEach(s=>{try{s(G())}catch(u){console.warn("[Blockscape] failed to run Apicurio enabled listener",u)}})}function De(s){return typeof s=="function"&&ke.add(s),()=>ke.delete(s)}function ve(){le&&(le.value=A.baseUrl||""),ue&&(ue.value=A.groupId||""),Se&&(Se.value=A.authToken||""),U&&(U.checked=G()),D&&(D.checked=!!A.useSemver)}function L(s="",u="muted"){z&&(z.textContent=s||"",z.classList.remove("is-error","is-success"),u==="error"?z.classList.add("is-error"):u==="success"&&z.classList.add("is-success"))}function me(s){if(!F||(F.innerHTML="",!s))return;const u=document.createElement("p");u.className="apicurio-hint",u.textContent=s,F.appendChild(u)}function Pe(s){oe.clear(),Y.clear(),me(s)}function Le(){const s=a(),u=G(),k=ge(),m=s>=0?o[s]:null,h=!!(m!=null&&m.apicurioVersions&&m.apicurioVersions.length>1);if(ne){const S=ne.dataset.loading==="true",M=u&&k&&s>=0&&!!qe(o[s]);ne.disabled=!u||S||!M,u?S||(ne.textContent="Push to Apicurio"):ne.textContent="Enable Apicurio to push"}if(P){const S=P.dataset.loading==="true",M=u&&k&&h&&!!qe(m);P.disabled=!M||S,P.hidden=!h,u?S||(P.textContent="Push series"):P.textContent="Enable Apicurio to push series"}if(H){const S=H.dataset.loading==="true",M=u&&k;H.disabled=!M||S,S||(u?k?H.textContent="List artifacts":H.textContent="Enter details to list":H.textContent="Enable Apicurio to list")}}function I(){ve(),G()?ge()?(L("Apicurio push is ready when a model is selected.","muted"),oe.size||me("Click “List artifacts” to browse the current group.")):(L("Enter Apicurio connection details to enable push.","muted"),Pe("Enter registry details to browse artifacts.")):(L("Apicurio integration is off. Enable it to allow pushes.","muted"),Pe("Apicurio integration is disabled.")),Le()}function E(){if(window!=null&&window.localStorage)try{localStorage.setItem(Ci,JSON.stringify(A))}catch(s){console.warn("[Blockscape] unable to persist Apicurio settings",s)}}function he(){let s={};if(window!=null&&window.localStorage)try{const S=localStorage.getItem(Ci);if(S){const M=JSON.parse(S);M&&typeof M=="object"&&(s=M)}}catch(S){console.warn("[Blockscape] failed to restore Apicurio settings",S)}const u=fe(s.baseUrl??Hn),k=(s.groupId??pn).toString().trim();let m=Dn,h=Fn;typeof s.enabled=="boolean"?m=s.enabled:typeof s.enabled=="string"&&(m=s.enabled==="true"),typeof s.useSemver=="boolean"?h=s.useSemver:typeof s.useSemver=="string"&&(h=s.useSemver==="true"),A.baseUrl=u||Hn,A.groupId=k||pn,A.authToken=(s.authToken??"").toString().trim(),A.enabled=m,A.useSemver=h,I(),Ce()}function J(){const s={Accept:"application/json"},u=(A.authToken||"").trim();return u&&(s.Authorization=/\s/.test(u)?u:`Bearer ${u}`),s}function X(s,u,{title:k,description:m,version:h}={}){const S={artifactId:s,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:u},metadata:{properties:{}}}};h&&(S.firstVersion.version=h),k&&(S.name=k),m&&(S.description=m);try{const M=JSON.parse(u),$=M==null?void 0:M.seriesId;$&&typeof $=="string"&&(S.firstVersion.metadata.properties.seriesId=$)}catch{}return S}function R(s,{version:u}={}){const k={content:{contentType:"application/json",content:s},metadata:{properties:{}}};try{const m=JSON.parse(s),h=m==null?void 0:m.seriesId;h&&typeof h=="string"&&(k.metadata.properties.seriesId=h)}catch{}return u&&(k.version=u),k}function Ae(s){if(s==null)return null;const u=String(s).trim();if(!u)return null;const k=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(u);if(k)return{major:Number(k[1]),minor:Number(k[2]),patch:Number(k[3])};const m=/^v?(\d+)$/.exec(u);return m?{major:Number(m[1]),minor:0,patch:0}:null}function Re(s){return`${s.major}.${s.minor}.${s.patch}`}function $e(s,u){return!s&&!u?0:s?u?s.major!==u.major?s.major-u.major:s.minor!==u.minor?s.minor-u.minor:s.patch-u.patch:1:-1}function ye(s=[]){let u=null;if(s.forEach(m=>{const h=Ae((m==null?void 0:m.version)??m);h&&(!u||$e(h,u)>0)&&(u=h)}),!u)return"1.0.0";const k={...u,patch:u.patch+1};return Re(k)}function qe(s,{seriesName:u,fallbackTitle:k}={}){var S;if(!s)return null;const m=u||s.title||s.apicurioArtifactName||w(s),h=k||m;if(typeof y=="function"&&(s.isSeries||((S=s.apicurioVersions)==null?void 0:S.length)>1)&&y(s,{seriesName:m,fallbackTitle:h}),typeof C=="function"){const M=C(s,{seriesName:m,fallbackTitle:h});if(M)return M}return T(s)}function ae(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.artifacts)?s.artifacts:Array.isArray(s==null?void 0:s.items)?s.items:Array.isArray(s==null?void 0:s.results)?s.results:[]}function _e(s){return Array.isArray(s)?s:Array.isArray(s==null?void 0:s.versions)?s.versions:Array.isArray(s==null?void 0:s.items)?s.items:[]}function be(s=[]){if(!Array.isArray(s)||!s.length)return null;const u=[...s].filter(Boolean);return u.sort((k,m)=>{const h=k!=null&&k.createdOn?new Date(k.createdOn).getTime():0,S=m!=null&&m.createdOn?new Date(m.createdOn).getTime():0;if(h!==S)return S-h;const M=Number(k==null?void 0:k.version),$=Number(m==null?void 0:m.version),Z=Number.isFinite(M),W=Number.isFinite($);if(Z&&W&&M!==$)return $-M;const Q=String((k==null?void 0:k.version)??"");return String((m==null?void 0:m.version)??"").localeCompare(Q,void 0,{numeric:!0})}),u[0]||null}function Be(s){if(!s)return s;let u=s;if(!Array.isArray(s==null?void 0:s.categories)){const m=s==null?void 0:s.content;if(typeof m=="string")try{u=JSON.parse(m)}catch(h){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",h)}else m&&typeof m=="object"&&(u=m)}return u}async function Fe(s,u,k){const m=encodeURIComponent(u),h=encodeURIComponent(k),S=`${s}/groups/${m}/artifacts/${h}`,M=J();M.Accept="application/json";const $=await fetch(S,{method:"GET",headers:M});if(!$.ok){let Z=$.statusText||"Unknown error";try{const W=await $.text();W&&(Z=W.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${$.status}): ${Z}`)}return $.json()}async function Ve(s,u,k){const m=encodeURIComponent(u),h=encodeURIComponent(k),S=`${s}/groups/${m}/artifacts/${h}/versions?limit=50&order=desc`,M=J();M.Accept="application/json";const $=await fetch(S,{method:"GET",headers:M});if(!$.ok){let W=$.statusText||"Unknown error";try{const Q=await $.text();Q&&(W=Q.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${$.status}): ${W}`)}const Z=await $.json();return _e(Z).filter(W=>W&&W.version!=null)}async function Te(s,u,k,m="latest"){const h=encodeURIComponent(u),S=encodeURIComponent(k),M=encodeURIComponent(m||"latest"),$=`${s}/groups/${h}/artifacts/${S}/versions/${M}/content`,Z=J();Z.Accept="application/json, application/*+json, */*;q=0.8";const W=await fetch($,{method:"GET",headers:Z});if(!W.ok){let we=W.statusText||"Unknown error";try{const de=await W.text();de&&(we=de.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${W.status}): ${we}`)}const Q=await W.text();let ce=null;try{ce=JSON.parse(Q)}catch{throw new Error("Artifact content is not valid JSON.")}return Be(ce)}async function Oe(s,u,k,m="latest"){const h=await Te(s,u,k,m);return{data:h,fingerprint:V(h)}}async function rt(s,u,k){try{const h=await Ve(s,u,k);if(h!=null&&h.length){Y.set(k,h);const S=be(h);if((S==null?void 0:S.version)!=null)return S.version}}catch(h){console.warn("[Blockscape] compare-version: unable to fetch versions list",h)}try{const h=await Fe(s,u,k);if((h==null?void 0:h.version)!=null)return h.version}catch(h){console.warn("[Blockscape] compare-version: unable to fetch metadata",h)}const m=Y.get(k);if(m&&m.length){const h=be(m);if((h==null?void 0:h.version)!=null)return h.version}return"latest"}async function tt(s,u,k,m){if(!A.useSemver)return null;if(!m)return"1.0.0";try{const h=await Ve(s,u,k);return ye(h)}catch(h){throw new Error(`Unable to compute next semantic version: ${h.message}`)}}function se(s=document){ne=s.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),P=s.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),H=s.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),le=s.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),ue=s.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),Se=s.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),U=s.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),D=s.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),z=s.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),F=s.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function Ee(){A.baseUrl=fe((le==null?void 0:le.value)??A.baseUrl),A.groupId=((ue==null?void 0:ue.value)??"").trim(),A.authToken=((Se==null?void 0:Se.value)??"").trim(),E(),I()}function mt(s){A.enabled=s!==!1,E(),I(),Ce()}function jt(){mt(U?U.checked:Dn)}function gn(){A.useSemver=D?D.checked:Fn,E(),I()}function ht(){[le,ue,Se].forEach(s=>{s&&s.addEventListener("input",Ee)}),ne&&ne.addEventListener("click",()=>{En()}),P&&P.addEventListener("click",()=>{qt()}),U&&U.addEventListener("change",jt),D&&D.addEventListener("change",gn),H&&H.addEventListener("click",Gt),F&&F.addEventListener("click",s=>{const u=s.target.closest("[data-artifact-version]");if(u){s.stopPropagation();const h=u.dataset.artifactId,S=u.dataset.artifactVersion;h&&S&&sn(h,S);return}const k=s.target.closest("[data-artifact-load-all]");if(k){s.stopPropagation(),k.dataset.artifactId&&_t();return}const m=s.target.closest("[data-artifact-trigger]");if(m){const h=m.dataset.artifactId;if(!h)return;yn(h)}})}function bn(){const s=document.createElement("div");return s.className="blockscape-registry-panel",s.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,s}function vn(s){if(!s)return;s.innerHTML="";const u=bn();s.appendChild(u),se(s),ht(),I()}function wn(s){if(!F)return;if(F.innerHTML="",!s.length){me("No artifacts found in this group.");return}const u=h=>{const S=document.createElement("section");S.className="apicurio-artifact-section";const M=document.createElement("h3");M.textContent=h,S.appendChild(M);const $=document.createElement("ul");return $.className="apicurio-artifact-list",S.appendChild($),{section:S,list:$}},k=u("Series artifacts"),m=u("Artifacts");s.forEach(h=>{if(!(h!=null&&h.artifactId))return;const M=h._groupId&&h._groupId.endsWith(Ai)?k.list:m.list,$=document.createElement("li"),Z=document.createElement("button");Z.type="button",Z.className="apicurio-artifact",Z.dataset.artifactId=h.artifactId,Z.dataset.artifactTrigger="toggle";const W=document.createElement("span");W.className="apicurio-artifact-title",W.textContent=h.artifactId,Z.appendChild(W);const Q=[];if(h.name&&Q.push(h.name),h.version!=null&&Q.push(`v${h.version}`),h.type&&Q.push(h.type),h._groupId&&Q.push(h._groupId),Q.length){const de=document.createElement("span");de.className="apicurio-artifact-meta",de.textContent=Q.join(" • "),Z.appendChild(de)}if(h.description){const de=document.createElement("span");de.className="apicurio-artifact-meta",de.textContent=h.description,Z.appendChild(de)}$.appendChild(Z);const ce=document.createElement("div");ce.className="apicurio-version-list",ce.dataset.versionPanel=h.artifactId,ce.hidden=!0;const we=document.createElement("p");we.className="apicurio-hint",we.textContent="Click to load the latest or open versions.",ce.appendChild(we),$.appendChild(ce),M.appendChild($)}),k.list.children.length&&F.appendChild(k.section),m.list.children.length&&F.appendChild(m.section)}function nn(s){return F?F.querySelector(`[data-version-panel="${s}"]`):null}function It(s,u){if(!s||(s.innerHTML="",!u))return;const k=document.createElement("p");k.className="apicurio-hint",k.textContent=u,s.appendChild(k)}function on(s,u){const k=nn(s);if(k){if(k.innerHTML="",!u.length){It(k,"No versions found for this artifact.");return}u.forEach(m=>{const h=document.createElement("button");h.type="button",h.className="apicurio-version-button",h.dataset.artifactId=s,h.dataset.artifactVersion=m.version;const S=[`Version ${m.version}`];if(m.createdOn){const M=new Date(m.createdOn);isNaN(M)||S.push(M.toISOString().slice(0,10))}h.textContent=S.join(" — "),k.appendChild(h)})}}async function yn(s){const u=nn(s);if(!u)return;if(u.dataset.open==="true"){u.hidden=!0,u.dataset.open="false";return}if(u.hidden=!1,u.dataset.open="true",u.dataset.loaded!=="true"){if(!ge()){It(u,"Enter registry details first.");return}It(u,"Loading versions…");try{const m=fe(A.baseUrl),h=oe.get(s),S=A.groupId.trim(),M=(h==null?void 0:h._groupId)||S,$=await Ve(m,M,s);Y.set(s,$),u.dataset.loaded="true",on(s,$)}catch(m){console.error("[Blockscape] failed to load versions",m),It(u,`Unable to fetch versions: ${m.message}`)}}}function St(s,u){var m;const k=o.findIndex(h=>h.apicurioArtifactId===s);if(k!==-1){const h=o[k].id;o[k]={...u,id:h||u.id},((m=o[k].apicurioVersions)==null?void 0:m.length)>1&&(o[k].isSeries=!0),p(k)}else o.push(u),p(o.length-1)}async function rn(s,u,k,m){const h=encodeURIComponent(u),S=encodeURIComponent(k),M=`${s}/groups/${h}/artifacts/${S}`;try{const $=await fetch(M,{method:"GET",headers:m});if($.status===404)return!1;if($.ok)return!0;throw $.status===401||$.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${$.status} while checking the artifact.`)}catch($){throw $ instanceof TypeError?new Error("Network error while contacting Apicurio registry."):$}}async function En(){var M;if(!ne||ne.dataset.loading==="true")return;if(!G()){L("Apicurio integration is off. Enable it first.","error");return}if(!ge()){L("Enter the registry base URL and group ID before pushing.","error");return}const s=a();if(s<0||!o[s]){L("No active model to push.","error");return}const u=qe(o[s],{fallbackTitle:w(o[s])});if(!u){L("Active model needs an id before pushing.","error");return}const k=fe(A.baseUrl),m=A.groupId.trim(),h=JSON.stringify(o[s].data,null,2),S=J();ne.dataset.loading="true",ne.textContent="Pushing…",ne.disabled=!0,L("Pushing to Apicurio…","muted");try{const $=await rn(k,m,u,S),Z=V(o[s].data);if($)try{const xe=await rt(k,m,u),{data:ze,fingerprint:Je}=await Oe(k,m,u,xe);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",xe),console.log("local fingerprint",Z),console.log("registry fingerprint",Je),console.log("local payload",o[s].data),console.log("registry payload",ze),console.groupEnd(),Z&&Je&&Z===Je){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){L("Push cancelled (content matches the latest registry version).","muted");return}L("Pushing identical content by user choice.","muted")}else Je?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):L("Unable to compare with registry content (skipping confirmation).","muted")}catch(xe){console.warn("[Blockscape] unable to compare registry content before push",xe),L("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const W=A.useSemver?await tt(k,m,u,$):null;if(A.useSemver&&!W)throw new Error("Semantic versioning is enabled but no version could be computed.");const Q=encodeURIComponent(m),ce=encodeURIComponent(u),we=$?`${k}/groups/${Q}/artifacts/${ce}/versions`:`${k}/groups/${Q}/artifacts`,de={...S,"Content-Type":"application/json"};W&&(de["X-Registry-Version"]=W,L(`Pushing to Apicurio as version ${W}…`,"muted"));const Ye=$?R(h,{version:W}):X(u,h,{title:w(o[s]),description:(M=o[s].data)==null?void 0:M.abstract,version:W}),Xe=await fetch(we,{method:"POST",headers:de,body:JSON.stringify(Ye)});if(!Xe.ok){let xe=Xe.statusText||"Unknown error";try{const ze=await Xe.text();ze&&(xe=ze.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${Xe.status}): ${xe}`)}let Ge=null;try{Ge=await Xe.json()}catch{Ge=null}const pe=(Ge==null?void 0:Ge.version)||(Ge==null?void 0:Ge.globalId)||"",Ne=$?"Updated":"Created",it=pe?` (version ${pe})`:"";L(`${Ne} ${u}${it}`,"success")}catch($){console.error("[Blockscape] Apicurio push failed",$),L(`Apicurio push failed: ${$.message}`,"error")}finally{ne.dataset.loading="false",Le()}}async function qt(){var W,Q;if(!P||P.dataset.loading==="true")return;if(!G()){L("Apicurio integration is off. Enable it first.","error");return}if(!ge()){L("Enter the registry base URL and group ID before pushing.","error");return}const s=a(),u=s>=0?o[s]:null;if(!u||!u.apicurioVersions||u.apicurioVersions.length<2){L("Series push requires a model with multiple versions.","error");return}const k=qe(u,{seriesName:u.title||u.apicurioArtifactName||w(u)});if(!k){L("Active series needs an id before pushing.","error");return}typeof y=="function"&&y(u,{seriesName:u.title||u.apicurioArtifactName||w(u)});const m=fe(A.baseUrl),h=A.groupId.trim(),S=u.apicurioVersions.map(ce=>ce.data),M=JSON.stringify(S,null,2),$=J(),Z=re(h);P.dataset.loading="true",P.textContent="Pushing…",P.disabled=!0,L("Pushing series to Apicurio…","muted");try{const ce=await rn(m,Z,k,$),we=V(S);if(ce)try{const Ze=await rt(m,Z,k),{data:Ct,fingerprint:At}=await Oe(m,Z,k,Ze);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",Ze),console.log("local fingerprint",we),console.log("registry fingerprint",At),console.log("local payload (series)",S),console.log("registry payload",Ct),console.groupEnd(),we&&At&&we===At){if(!window.confirm("The current registry version matches this series. Push anyway?")){L("Series push cancelled (content matches latest).","muted");return}L("Pushing identical series by user choice.","muted")}else At?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):L("Unable to compare with registry content (skipping confirmation).","muted")}catch(Ze){console.warn("[Blockscape] unable to compare registry content before series push",Ze),L("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const de=A.useSemver?await tt(m,Z,k,ce):null;if(A.useSemver&&!de)throw new Error("Semantic versioning is enabled but no version could be computed.");const Ye=encodeURIComponent(Z),Xe=encodeURIComponent(k),Ge=ce?`${m}/groups/${Ye}/artifacts/${Xe}/versions`:`${m}/groups/${Ye}/artifacts`,pe={...$,"Content-Type":"application/json"};de&&(pe["X-Registry-Version"]=de,L(`Pushing series to Apicurio as version ${de}…`,"muted"));const Ne=ce?R(M,{version:de}):X(k,M,{title:u.apicurioArtifactName||((W=u.data)==null?void 0:W.title)||k,description:(Q=u.data)==null?void 0:Q.abstract,version:de}),it=await fetch(Ge,{method:"POST",headers:pe,body:JSON.stringify(Ne)});if(!it.ok){let Ze=it.statusText||"Unknown error";try{const Ct=await it.text();Ct&&(Ze=Ct.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${it.status}): ${Ze}`)}let xe=null;try{xe=await it.json()}catch{xe=null}const ze=(xe==null?void 0:xe.version)||(xe==null?void 0:xe.globalId)||"",Je=ce?"Updated":"Created",dt=ze?` (version ${ze})`:"";L(`${Je} ${k} series${dt}`,"success")}catch(ce){console.error("[Blockscape] Apicurio series push failed",ce),L(`Apicurio series push failed: ${ce.message}`,"error")}finally{P.dataset.loading="false",Le()}}async function Gt(){if(!H||H.dataset.loading==="true")return;if(!G()){L("Enable Apicurio integration to list artifacts.","error");return}if(!ge()){L("Enter registry base URL and group ID before listing.","error");return}const s=fe(A.baseUrl),u=A.groupId.trim(),k=re(u),m=[{groupId:u,label:"base"},{groupId:k,label:"series"}];H.dataset.loading="true",H.textContent="Listing…",H.disabled=!0,L("Listing artifacts…","muted"),me("Contacting registry…");try{const h=J();h.Accept="application/json";const S=[];for(const $ of m){const Z=encodeURIComponent($.groupId),W=`${s}/groups/${Z}/artifacts?limit=50&offset=0`,Q=await fetch(W,{method:"GET",headers:h});if(!Q.ok){let de=Q.statusText||"Unknown error";try{const Ye=await Q.text();Ye&&(de=Ye.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${$.groupId} (${Q.status}): ${de}`);continue}const ce=await Q.json(),we=ae(ce).filter(de=>de&&de.artifactId);we.forEach(de=>{de&&(de._groupId=$.groupId)}),S.push(...we)}oe.clear(),Y.clear(),S.forEach($=>{$!=null&&$.artifactId&&oe.set($.artifactId,$)}),wn(S);const M=S.length;L(M?`Found ${M} artifact${M===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",M?"success":"muted")}catch(h){console.error("[Blockscape] failed to list artifacts",h),Pe("Unable to list artifacts."),L(`Listing failed: ${h.message}`,"error")}finally{H.dataset.loading="false",Le()}}async function sn(s,u=null){var ce,we,de,Ye,Xe,Ge;if(!s)return;if(!G()){L("Enable Apicurio integration to load artifacts.","error");return}if(!ge()){L("Enter registry connection details before loading artifacts.","error");return}const k=fe(A.baseUrl),m=A.groupId.trim(),h=s&&((ce=oe.get(s))==null?void 0:ce._groupId)||m;let S=oe.get(s);const M=async()=>{try{const pe=await Fe(k,h,s);return pe!=null&&pe.artifactId&&oe.set(s,pe),pe}catch(pe){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",pe),pe}};if(!S)try{S=await M()}catch(pe){L(`Failed to fetch artifact metadata: ${pe.message}`,"error");return}const $=Y.get(s)||[];let Z="latest",W="latest";if(u)Z=u,W=u;else{if(!S||S.version==null)try{S=await M()}catch(pe){L(`Failed to fetch artifact metadata: ${pe.message}`,"error");return}Z=(S==null?void 0:S.version)||"latest",W=(S==null?void 0:S.version)||"latest"}const Q=$.find(pe=>String(pe.version)===String(Z));(Q==null?void 0:Q.version)!=null&&(W=Q.version),L(`Loading artifact ${s}…`,"muted");try{const pe=await Te(k,h,s,Z),Ne=oe.get(s)||S||{},it=Array.isArray(pe);let xe=null;if(it){const ze=pe.map((dt,Ze)=>(x(dt,{titleHint:Ne.name||s,idHint:s}),{version:String(Ze+1),data:dt,createdOn:(Q==null?void 0:Q.createdOn)||Ne.createdOn}));xe={id:q(),title:((de=(we=ze[0])==null?void 0:we.data)==null?void 0:de.title)||Ne.name||s,data:(Ye=ze[0])==null?void 0:Ye.data,apicurioArtifactId:s,apicurioArtifactName:Ne.name||"",apicurioVersions:ze,apicurioActiveVersionIndex:0,isSeries:!0};const Je=((Xe=Ne==null?void 0:Ne.properties)==null?void 0:Xe.seriesId)||s;typeof y=="function"&&y(xe,{seriesName:Je,fallbackTitle:Je}),L(`Loaded series artifact ${s}.`,"success")}else{x(pe,{titleHint:Ne.name||s,idHint:s});const ze={version:W,data:pe,createdOn:(Q==null?void 0:Q.createdOn)||Ne.createdOn};xe={id:q(),title:pe.title||Ne.name||s,data:pe,apicurioArtifactId:s,apicurioArtifactName:Ne.name||"",apicurioVersions:[ze],apicurioActiveVersionIndex:0};const Je=(Ge=Ne==null?void 0:Ne.properties)==null?void 0:Ge.seriesId;Je&&typeof y=="function"&&y(xe,{seriesName:Je,fallbackTitle:Je});const dt=W?` (version ${W})`:"";L(`Loaded artifact ${s}${dt}.`,"success")}St(s,xe)}catch(pe){console.error("[Blockscape] failed to load artifact",pe),L(`Failed to load artifact: ${pe.message}`,"error")}}async function _t(s){}return{hydrateConfig:he,mount:vn,updateAvailability:Le,isEnabled:G,setEnabled:mt,onEnabledChange:De}}function Ht(o,a){if(typeof o!="function")throw new Error(`[itemEditor] expected ${a} to be a function`)}function Yo(o,{excludeId:a}={}){if(!o)return[];const p=o.split(/[\s,]+/).map(y=>y.trim()).filter(Boolean),x=[];return p.forEach(y=>{a&&y===a||x.includes(y)||x.push(y)}),x}function Xo(o,a,p){if(!a||!p||a===p)return;((o==null?void 0:o.categories)||[]).forEach(y=>{(y.items||[]).forEach(T=>{Array.isArray(T.deps)&&(T.deps=T.deps.map(C=>C===a?p:C))})}),Array.isArray(o==null?void 0:o.links)&&o.links.forEach(y=>{y.from===a&&(y.from=p),y.to===a&&(y.to=p)})}function Zo({findItemAndCategoryById:o,collectAllItemIds:a,updateItemReferences:p,loadActiveIntoEditor:x,rebuildFromActive:y,select:T,onSelectionRenamed:C}={}){Ht(o,"findItemAndCategoryById"),Ht(a,"collectAllItemIds"),Ht(p,"updateItemReferences"),Ht(x,"loadActiveIntoEditor"),Ht(y,"rebuildFromActive"),Ht(T,"select");const w={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function V(U){if(w.fields.errorEl){if(!U){w.fields.errorEl.hidden=!0,w.fields.errorEl.textContent="";return}w.fields.errorEl.hidden=!1,w.fields.errorEl.textContent=U}}function q(){w.wrapper&&(w.wrapper.hidden=!0,w.wrapper.setAttribute("aria-hidden","true"),V(""),w.categoryId=null,w.itemId=null,w.modelData=null,document.body.classList.remove("item-editor-open"))}function ne(){w.wrapper&&(w.wrapper.hidden=!1,w.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var U,D;(U=w.fields.nameInput)==null||U.focus(),(D=w.fields.nameInput)==null||D.select()}))}function H(U){var fe;if(!w.modelData||!w.categoryId||!w.itemId)throw new Error("No item loaded.");const z=(((fe=w.modelData)==null?void 0:fe.categories)||[]).find(re=>re.id===w.categoryId);if(!z)throw new Error("Category not found.");z.items=z.items||[];const P=z.items.find(re=>re.id===w.itemId);if(!P)throw new Error("Item not found.");const F=(U.id||"").trim();if(!F)throw new Error("ID is required.");const ke=a(w.modelData);if(F!==P.id&&ke.has(F))throw new Error("Another item already uses that ID.");P.id=F;const A=(U.name||"").trim();P.name=A||P.id;const oe=(U.logo||"").trim();if(oe?P.logo=oe:delete P.logo,U.externalFlag&&!U.external)P.external=!0;else{const re=(U.external??"").toString().trim();re?P.external=re:delete P.external}const Y=(U.color||"").trim();return Y?P.color=Y:delete P.color,P.deps=Array.isArray(U.deps)?U.deps:[],P.id!==U.originalId&&typeof C=="function"&&C(U.originalId,P.id),p(w.modelData,U.originalId,P.id),x(),y(),T(P.id),P.id}function le(){if(!w.fields||!w.fields.idInput)return!1;const U=(w.fields.idInput.value||"").trim(),D={originalId:w.itemId,id:U,name:w.fields.nameInput.value||"",logo:w.fields.logoInput.value||"",external:w.fields.externalInput.value||"",externalFlag:w.fields.externalFlagInput.checked,color:w.fields.colorInput.value||"",deps:Yo(w.fields.depsInput.value,{excludeId:U})};try{return H(D),q(),!0}catch(z){return console.warn("[itemEditor] item edit failed",z),V((z==null?void 0:z.message)||"Unable to save item."),!1}}function ue(){if(w.wrapper)return w.wrapper;const U=document.createElement("div");U.className="item-editor-modal",U.hidden=!0,U.setAttribute("role","dialog"),U.setAttribute("aria-modal","true");const D=document.createElement("div");D.className="item-editor-modal__backdrop",U.appendChild(D);const z=document.createElement("div");z.className="item-editor",U.appendChild(z);const P=document.createElement("div");P.className="item-editor__header";const F=document.createElement("h2");F.className="item-editor__title",F.textContent="Edit item";const ke=document.createElement("button");ke.type="button",ke.className="item-editor__close",ke.setAttribute("aria-label","Close item editor"),ke.textContent="×",P.appendChild(F),P.appendChild(ke),z.appendChild(P);const A=document.createElement("form");A.className="item-editor__form",z.appendChild(A);const oe=document.createElement("div");oe.className="item-editor__meta",oe.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',A.appendChild(oe);const Y=document.createElement("div");Y.className="item-editor__error",Y.hidden=!0,A.appendChild(Y);const fe=(X,R,Ae)=>{const Re=document.createElement("label");Re.className="item-editor__field";const $e=document.createElement("span");if($e.className="item-editor__label",$e.textContent=X,Re.appendChild($e),R.classList.add("item-editor__control"),Re.appendChild(R),Ae){const ye=document.createElement("div");ye.className="item-editor__hint",ye.textContent=Ae,Re.appendChild(ye)}return Re},re=document.createElement("input");re.type="text",re.required=!0,A.appendChild(fe("ID",re,"Unique identifier used for links and dependencies."));const ge=document.createElement("input");ge.type="text",A.appendChild(fe("Name",ge,"Visible label shown on the tile."));const G=document.createElement("input");G.type="url",G.inputMode="url",G.placeholder="https://…",A.appendChild(fe("Logo URL",G,"Optional image URL."));const Ce=document.createElement("input");Ce.type="url",Ce.inputMode="url",Ce.placeholder="https://…",A.appendChild(fe("External link",Ce,"Shown with ↗ icon and in preview."));const De=document.createElement("div");De.className="item-editor__checkbox";const ve=document.createElement("label");ve.className="item-editor__checkbox-row";const L=document.createElement("input");L.type="checkbox";const me=document.createElement("span");me.textContent="Mark as external without link";const Pe=document.createElement("div");Pe.className="item-editor__hint",Pe.textContent="Keeps dashed border even without a URL.",ve.appendChild(L),ve.appendChild(me),De.appendChild(ve),De.appendChild(Pe),A.appendChild(De);const Le=document.createElement("input");Le.type="text",Le.placeholder="#2563eb",A.appendChild(fe("Color",Le,"Optional badge color (hex or CSS color)."));const I=document.createElement("textarea");I.rows=2,I.placeholder="Comma or space separated ids",A.appendChild(fe("Dependencies",I,"Use item IDs, separated by commas or spaces."));const E=document.createElement("div");E.className="item-editor__actions";const he=document.createElement("button");he.type="button",he.className="pf-v5-c-button pf-m-tertiary",he.textContent="Cancel";const J=document.createElement("button");return J.type="submit",J.className="pf-v5-c-button pf-m-primary",J.textContent="Save",E.appendChild(he),E.appendChild(J),A.appendChild(E),w.wrapper=U,w.fields={idInput:re,nameInput:ge,logoInput:G,externalInput:Ce,externalFlagInput:L,colorInput:Le,depsInput:I,categoryValue:oe.querySelector(".item-editor__meta-value"),errorEl:Y},he.addEventListener("click",q),ke.addEventListener("click",q),D.addEventListener("click",q),A.addEventListener("submit",X=>{X.preventDefault(),le()}),document.addEventListener("keydown",X=>{X.key==="Escape"&&!U.hidden&&(X.preventDefault(),X.stopPropagation(),q())}),document.body.appendChild(U),U}function Se(U){const D=o(U);return D?(ue(),w.categoryId=D.category.id,w.itemId=D.item.id,w.modelData=D.modelData,w.fields.categoryValue.textContent=D.category.title||D.category.id,w.fields.idInput.value=D.item.id||"",w.fields.nameInput.value=D.item.name||"",w.fields.logoInput.value=D.item.logo||"",w.fields.externalInput.value=typeof D.item.external=="string"?D.item.external:"",w.fields.externalFlagInput.checked=D.item.external===!0,w.fields.colorInput.value=D.item.color||"",w.fields.depsInput.value=Array.isArray(D.item.deps)?D.item.deps.join(", "):"",V(""),T(D.item.id),ne(),!0):!1}return{open:Se,hide:q,isOpen:()=>!!w.wrapper&&!w.wrapper.hidden}}function Ni(o,a="series"){return(o||a).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||a}function Qt(o,a="series"){const p=Ni(o,a).replace(/\./g,"-");return p.replace(/-series$/i,"").replace(/-+$/,"")||p||Ni(a,"series")}function Pi(o,{seriesName:a,fallbackTitle:p="unknown"}={}){var w,V;const y=[o==null?void 0:o.seriesId,(w=o==null?void 0:o.data)==null?void 0:w.seriesId,o==null?void 0:o.apicurioArtifactId,a,o==null?void 0:o.title,o==null?void 0:o.apicurioArtifactName,(V=o==null?void 0:o.data)==null?void 0:V.title,p].map(q=>(q??"").toString().trim()),T=y.findIndex(Boolean),C=T!==-1?y[T]:"";return C?(console.log("[Series] deriveSeriesId: picked base",{base:C,sourceIndex:T,candidates:y}),Qt(C,p)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:p}),null)}function lt(o,{seriesName:a,fallbackTitle:p="unknown"}={}){if(!o||typeof o!="object")return null;const x=Pi(o,{seriesName:a,fallbackTitle:p});return x?(o.seriesId=x,o.apicurioArtifactId||(o.apicurioArtifactId=x),x):null}function fn(o,a={}){var y,T;if(!o)return null;const p=o.isSeries||((y=o.apicurioVersions)==null?void 0:y.length)>1||o.seriesId||((T=o.data)==null?void 0:T.seriesId)||o.apicurioArtifactId;if(!p&&!a.force)return null;const x=Pi(o,a);return x||(p?Qt(a.fallbackTitle||"unknown"):null)}const mn=typeof import.meta<"u"&&"./"||"";function Qo(){console.log("[Blockscape] init");const o=document.getElementById("jsonBox"),a=document.querySelector(".blockscape-json-panel"),p=document.getElementById("app"),x=document.getElementById("overlay"),y=document.getElementById("tabTooltip"),T=document.getElementById("modelList"),C=document.getElementById("itemPreview"),w=document.getElementById("urlForm"),V=document.getElementById("urlInput"),q=document.getElementById("loadUrl"),ne=C.querySelector(".item-preview__title"),H=C.querySelector(".item-preview__body"),le=C.querySelector(".item-preview__actions"),ue=C.querySelector(".item-preview__close"),Se=document.getElementById("downloadJson"),U=document.getElementById("shareModel"),D=document.getElementById("createVersion"),z=document.getElementById("openInEditor"),P=document.getElementById("copyJson"),F=document.getElementById("copySeries"),ke=document.getElementById("pasteJson"),A=document.getElementById("helpButton"),oe=document.getElementById("newPanelButton"),Y=document.getElementById("shortcutHelp"),fe=document.getElementById("shortcutHelpList"),re=document.getElementById("shortcutHelpClose"),ge=document.getElementById("shortcutHelpBackdrop"),G=document.getElementById("newPanel"),Ce=document.getElementById("newPanelClose"),De=document.getElementById("newPanelBackdrop"),ve=document.getElementById("search"),L=document.getElementById("searchResults"),me="blockscape:editorPayload",Pe="blockscape:editorTransfer",Le=document.title;o.value=document.getElementById("seed").textContent.trim();let I=[],E=-1;const he=Wo({models:I,getActiveIndex:()=>E,setActive:ot,ensureModelMetadata:u,getModelId:S,getSeriesId:fn,ensureSeriesId:lt,getModelTitle:m,computeJsonFingerprint:_t,uid:ht});let J=null,X=new Map,R=null,Ae=null,Re=!1,$e=0,ye={x:0,y:0},qe="map",ae=null,_e=!1,be=null;const Be=2e3;let Fe=null,Ve=null,Te=null,Oe=null,rt=null,tt=null,se="",Ee=!1,mt=null,jt=null;const gn=30;he.hydrateConfig();function ht(){return Math.random().toString(36).slice(2,10)}function bn(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function vn(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function wn(e){return bn(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function nn(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),vn(t)}function It(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=e,r.click(),URL.revokeObjectURL(i)}async function on(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function yn(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function St(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function rn(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function En(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(l=>l&&typeof l=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function qt(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t)}function Gt(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>Gt(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${Gt(e[i])}`).join(",")}}`}function sn(e){try{return Gt(e)}catch{return""}}function _t(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=sn(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=sn(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const s=[{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile."},{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Jump to the previous or next category while keeping position where possible."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Delete"]],description:"Delete the selected item (use Cmd/Ctrl+Z to undo)."},{keys:[["F2"]],description:"Open the item editor for the selected tile."},{keys:[["Escape"]],description:"Close the open preview popover."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."}];function u(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const r=(e.id??"").toString().trim();if(r)e.id=r;else{const l=n||e.title||t||"model",c=St(l).replace(/\./g,"-");e.id=c||`model-${ht()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function k(e){return JSON.parse(JSON.stringify(e))}function m(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function h(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const r=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(r)return r;const l=S(e);return l?`${l} series`:t}return m(e,t)}function S(e){var r;const t=fn(e);if(t)return t;const n=(r=e==null?void 0:e.data)==null?void 0:r.id;return n&&n.toString().trim()||null}function M(e){const t=(e??"").toString().trim();return t?t.split(/[^a-zA-Z0-9]+/).filter(Boolean)[0]||t:""}function $(e){var f;if(e<0||e>=I.length||!o)return!0;const t=I[e],n=(o.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}u(i,{titleHint:m(t),idHint:S(t)});const r=_t(t.data),l=_t(i);if(r===l)return!0;t.data=i;const c=Tt(t);return c>=0&&((f=t.apicurioVersions)!=null&&f[c])&&(t.apicurioVersions[c].data=i),!0}function Z(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function W(e){if(E<0||!e)return null;const t=I[E].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const l=(i.items||[]).find(c=>c.id===e);if(l)return{category:i,item:l,modelData:t}}return null}function Q(e,t){const n=Z(t);let i=St(e||"item");if(!n.has(i))return i;const r=()=>ht().slice(0,4);for(;n.has(i);)i=`${St(e||"item")}-${r()}`;return i}const ce=Zo({findItemAndCategoryById:W,collectAllItemIds:Z,updateItemReferences:Xo,loadActiveIntoEditor:gt,rebuildFromActive:pt,select:e=>Ke(e),onSelectionRenamed:(e,t)=>{var n;R===e&&(R=t),((n=ae==null?void 0:ae.item)==null?void 0:n.id)===e&&(ae.item.id=t)}});function we(e,{versionLabel:t,createdOn:n}={}){var d,g,b;if(e!=null&&e.isSeries||((d=e==null?void 0:e.apicurioVersions)==null?void 0:d.length)>1){const N=e.title||m(e);lt(e,{seriesName:N,fallbackTitle:N})}const i=S(e);if(!i)return I.push(e),I.length-1;const r=I.findIndex(N=>S(N)===i);if(r===-1)return I.push(e),I.length-1;const l=I[r];if(!Array.isArray(l.apicurioVersions)||!l.apicurioVersions.length){l.apicurioVersions=[{version:"1",data:l.data,createdOn:(b=(g=l.apicurioVersions)==null?void 0:g[0])==null?void 0:b.createdOn}],l.apicurioActiveVersionIndex=0;const N=l.title||m(l);lt(l,{seriesName:N,fallbackTitle:N})}const c=String(l.apicurioVersions.length+1);l.apicurioVersions.push({version:c,data:e.data,createdOn:n||new Date().toISOString()}),l.apicurioActiveVersionIndex=l.apicurioVersions.length-1,l.data=e.data,l.title=m(e)||l.title,l.isSeries=!0;const f=l.title||m(l);return lt(l,{seriesName:f,fallbackTitle:f}),r}function de({versionLabel:e}={}){if(E<0||!I[E])throw new Error("Load or select a model before creating a version.");let t;try{t=k(I[E].data)}catch(i){throw console.warn("[Blockscape] failed to clone active model for versioning",i),new Error("Could not copy the current model.")}return u(t,{titleHint:m(I[E]),idHint:S(I[E])}),we({title:m(I[E]),data:t},{versionLabel:e||"manual",createdOn:new Date().toISOString()})}function Ye(){const e=E>=0&&I[E]?I[E]:null,t=S(e);document.title=t?`${t}-blockscape`:Le}function Xe(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||m(e);return lt(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function Ge(){const e=I[E],t=Xe(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function pe(e="shortcut",t=!1){const n=o.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=I[E],r=t?Xe(i):null,l=!!r,c=l?JSON.stringify(r,null,2):n,f=l&&fn(i)||m(i,"blockscape"),d=l?"-series":"",g=`${St(f)}${d}.json`;return It(g,c),console.log(`[Blockscape] saved JSON (${e}):`,g),!0}const Ne={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function it(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return Ne[n]||"#9ca3af"}function xe(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(d=>d+d).join(""):t,i=parseInt(n,16),r=i>>16&255,l=i>>8&255,c=i&255;return .2126*Math.pow(r/255,2.2)+.7152*Math.pow(l/255,2.2)+.0722*Math.pow(c/255,2.2)>.35?"#111111":"#ffffff"}function ze(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function Je(){if(Ve)return;Ve=document.createElement("div"),Ve.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",Te=document.createElement("span"),Te.className="series-nav-notice__text",Ve.appendChild(e),Ve.appendChild(Te),document.body.appendChild(Ve)}function dt(){Oe&&(clearTimeout(Oe),Oe=null),Ve&&Ve.classList.remove("is-visible"),Te&&(Te.textContent="")}function Ze(){Fe=null,dt()}function Ct(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function At(e,t,n){Je(),Fe={id:e,targetVersionIndex:t};const i=Ct(n,t);an(`Click again to open ${i} in this series.`)}function an(e,t=Be,n=null){if(Je(),Te.textContent="",Te.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),r=document.createElement("a");r.href=n,r.target="_blank",r.rel="noopener",r.textContent=n,Te.appendChild(i),Te.appendChild(r)}Ve.classList.add("is-visible"),Oe&&clearTimeout(Oe),Oe=setTimeout(()=>dt(),t)}function Ri(){fe&&(fe.innerHTML="",s.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((r,l)=>{if(l>0){const f=document.createElement("span");f.className="shortcut-help__or",f.textContent="or",n.appendChild(f)}const c=document.createElement("div");c.className="shortcut-help__combo",r.forEach((f,d)=>{if(d>0){const b=document.createElement("span");b.className="shortcut-help__sep",b.textContent="+",c.appendChild(b)}const g=document.createElement("kbd");g.className="shortcut-help__key",g.textContent=f,c.appendChild(g)}),n.appendChild(c)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),fe.appendChild(t)}),_e=!0)}function Vi(){return!!Y&&Y.hidden===!1}function Hi(){if(!Y)return;_e||Ri(),be=document.activeElement,Y.hidden=!1,Y.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Y.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function kn(){if(!Y||Y.hidden)return;Y.hidden=!0,Y.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=be;e!=null&&e.focus?e.focus({preventScroll:!0}):A!=null&&A.focus&&A.focus({preventScroll:!0})}function Di(){if(!G)return;G.hidden=!1,G.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=G.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function xn(){!G||G.hidden||(G.hidden=!0,G.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),oe!=null&&oe.focus&&oe.focus({preventScroll:!0}))}let In=!1;function Zn(){In||(In=!0,requestAnimationFrame(()=>{In=!1,_n(),Bt()}))}let Qn=!1;function ei(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Fi(e){const t=ei(e);if(!t.length){p.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}p.querySelectorAll(".tile").forEach(n=>{var c;const i=(((c=n.querySelector(".name"))==null?void 0:c.textContent)||"").toLowerCase(),r=(n.dataset.id||"").toLowerCase(),l=t.every(f=>i.includes(f)||r.includes(f));n.style.opacity=l?"1":"0.2"})}function Ji(e){const t=ei(e);if(!t.length)return[];const n=[];return I.forEach((i,r)=>{var g;const l=h(i),c=S(i)||"",f=`${l} ${c}`.toLowerCase();t.every(b=>f.includes(b))&&n.push({type:"model",modelIndex:r,modelTitle:l,modelId:c}),(Array.isArray((g=i.data)==null?void 0:g.categories)?i.data.categories:[]).forEach(b=>{const N=(b.title||b.id||"").toString();(b.items||[]).forEach(j=>{const K=(j.name||j.id||"").toString(),Ie=`${K} ${j.id||""} ${N}`.toLowerCase();t.every(He=>Ie.includes(He))&&n.push({type:"item",modelIndex:r,modelTitle:l,modelId:c,itemId:j.id,itemName:K,categoryTitle:N})})})}),n.slice(0,gn)}function ti(e){if(!L)return;L.innerHTML="";const t=(e||"").toString();if(!t.trim()){L.hidden=!0;return}if(!I.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",L.appendChild(i),L.hidden=!1;return}const n=Ji(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",L.appendChild(i),L.hidden=!1;return}n.forEach(i=>{const r=document.createElement("button");r.type="button",r.className="search-result",r.dataset.modelIndex=String(i.modelIndex),i.itemId&&(r.dataset.itemId=i.itemId),i.type&&(r.dataset.type=i.type),i.modelIndex===E&&(!i.itemId||R===i.itemId)&&r.classList.add("is-active");const l=document.createElement("div");l.className="search-result__primary";const c=document.createElement("span");c.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",l.appendChild(c);const f=document.createElement("span");f.className="search-result__badge",f.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",l.appendChild(f);const d=document.createElement("div");d.className="search-result__meta";const g=document.createElement("span");if(g.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,d.appendChild(g),i.type==="item"&&i.itemId){const b=document.createElement("span");b.textContent=`Item ID: ${i.itemId}`,d.appendChild(b)}else if(i.type==="model"){const b=document.createElement("span");b.textContent="Matches model title",d.appendChild(b)}r.appendChild(l),r.appendChild(d),L.appendChild(r)}),L.hidden=!1}function ni(e){Fi(e||""),ti(e||"")}function ji(e){!e||!Number.isInteger(e.modelIndex)||(ot(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(E!==e.modelIndex)return;const t=(n=X.get(e.itemId))==null?void 0:n.el;t&&(Ke(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function ot(e){if(st(),Ze(),ae=null,e<0||e>=I.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}Ee=!0,E=e,console.log("[Blockscape] active model:",m(I[e]),"(index",e+" )"),Ye(),Nt(),gt(),pt(),ve&&ni(ve.value||""),he.updateAvailability()}function Nt(){if(T.innerHTML="",!I.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",T.appendChild(e);return}I.forEach((e,t)=>{var N;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===E?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===E?"true":"false");const r=document.createElement("span");r.className="model-nav-label";const l=document.createElement("span");l.className="model-nav-title",l.textContent=h(e),r.appendChild(l);const c=S(e);if(c){const j=document.createElement("span");j.className="model-nav-id",j.textContent=c,r.appendChild(j)}const f=Array.isArray((N=e.data)==null?void 0:N.categories)?e.data.categories:[],d=f.reduce((j,K)=>j+(K.items||[]).length,0),g=document.createElement("span");g.className="model-nav-meta";const b=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";g.textContent=`${f.length} cat · ${d} items${b}`,i.appendChild(r),i.appendChild(g),n.appendChild(i),T.appendChild(n)}),he.updateAvailability()}function gt(){if(E<0){o.value="",F&&(F.disabled=!0);return}const e=I[E];o.value=JSON.stringify(e.data,null,2),F&&(F.disabled=!Xe(e))}function qi(e){try{return JSON.parse(e)}catch{return null}}function Gi(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const r=i.map((b,N)=>!b||typeof b!="object"?null:(u(b,{titleHint:`${t} #${N+1}`}),{obj:b,idx:N})).filter(Boolean);if(!r.length)return[];const l=r[0].obj,{seriesTitleOverride:c}=n;let f=c||l.title||`${t} series`;c&&!l.title&&(l.title=c);const d={id:ht(),title:f,data:l,apicurioVersions:r.map(({obj:b,idx:N})=>({version:String(N+1),data:b})),apicurioActiveVersionIndex:0,isSeries:!0},g=lt(d,{seriesName:f,fallbackTitle:f});return g&&(d.id=g),[d]}function ii(e,t="Pasted",n={}){return Array.isArray(e)?Gi(e,t,n):!e||typeof e!="object"?[]:(u(e,{titleHint:`${t} #1`}),[{id:ht(),title:e.title||`${t} #1`,data:e}])}function yt(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const r=qi(i);if(r){let c=n;if(Array.isArray(r)&&n.promptForSeriesName){const d=En(r,t),g=rn(d);c={...n,promptForSeriesName:!1,seriesTitleOverride:g||d}}const f=ii(r,t,c);if(f.length)return f}return i.split(/^\s*(?:---|%%%)\s*$/m).map(c=>c.trim()).filter(Boolean).map((c,f)=>{const d=JSON.parse(c);return u(d,{titleHint:`${t} #${f+1}`}),{id:ht(),title:d.title||`${t} #${f+1}`,data:d}})}function zi(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function Lt(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!zi(e)}function Ki(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function oi(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(me)}catch(r){return console.warn("[Blockscape] failed to access editor payload",r),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(r){console.warn("[Blockscape] invalid payload JSON",r);try{localStorage.removeItem(me)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(me)}catch(r){console.warn("[Blockscape] failed to clear editor payload",r)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=yt(t.text,t.title||"Editor Export")}catch(r){return console.warn("[Blockscape] could not parse payload text",r),null}if(!n.length)return null;let i=null;return n.forEach(r=>{const l=we(r,{versionLabel:"editor"});i==null&&(i=l)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function ri(e="storage"){const t=oi();return!t||typeof t.index!="number"?!1:(ot(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function Wi(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const c=new URLSearchParams(window.location.search);c.has("share")&&(t=c.get("share"))}if(!t)return null;let i;try{const c=nn(t);i=JSON.parse(c)}catch(c){return console.warn("[Blockscape] failed to decode share token",c),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const r=ii(i.data,i.title||"Shared Model");if(!r.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let l=null;return r.forEach(c=>{const f=c.isSeries?i.title||c.title:null,d=we({...c,apicurioArtifactName:f||c.apicurioArtifactName},{versionLabel:"shared"});l==null&&(l=d)}),l}async function Yi(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await Tn(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function Xi(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(l=>(l.items||[]).forEach(c=>{i.add(c.id);const f=new Set(c.deps||[]);(e.links||[]).forEach(d=>{d.from===c.id&&f.add(d.to)}),t.set(c.id,f),f.forEach(d=>{n.has(d)||n.set(d,new Set),n.get(d).add(c.id)})}));const r=new Set;return n.forEach((l,c)=>{((l==null?void 0:l.size)||0)>=2&&r.add(c)}),{m:e,fwd:t,rev:n,reusedLocal:r,seen:i}}function Zi(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const r=n.getContext("2d"),l=(e||"?").charAt(0).toUpperCase(),c=it(e,t),f=xe(c);return r.fillStyle=c,r.beginPath(),r.arc(i/2,i/2,i/2-2,0,2*Math.PI),r.fill(),r.strokeStyle="rgba(0,0,0,0.15)",r.lineWidth=1,r.stroke(),r.fillStyle=f,r.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,r.textAlign="center",r.textBaseline="middle",r.fillText(l,i/2,i/2),n.toDataURL("image/png")}function Tt(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function si(e){const t=Tt(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Qi(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var c,f;const r=(((c=n==null?void 0:n.data)==null?void 0:c.id)??"").toString().trim();r&&t.set(r,i);const l=(((f=n==null?void 0:n.data)==null?void 0:f.seriesId)??"").toString().trim();l&&!t.has(l)&&t.set(l,i)}),t}const ai=new WeakMap;function eo(e,t){var ut;if(!((ut=e==null?void 0:e.apicurioVersions)!=null&&ut[t]))return null;const n=e.apicurioVersions[t],i=n.data,r=_t(i),l=ai.get(n);if(l&&l.fingerprint===r)return l.dataUrl;const c=160,f=90,d=document.createElement("canvas");d.width=c,d.height=f;const g=d.getContext("2d");g.fillStyle="#f8fafc",g.fillRect(0,0,c,f),g.strokeStyle="#e5e7eb",g.strokeRect(.5,.5,c-1,f-1);const b=Array.isArray(i==null?void 0:i.categories)?i.categories:[],N=Math.max(b.length,1),j=c/N,K=8,Ie=8,He=4;b.forEach((at,Kt)=>{const $n=Kt*j+j/2,Ut=Array.isArray(at.items)?at.items:[],Ue=Math.max(Ut.length,1);Ut.forEach((Mt,hi)=>{const Bn=K+(hi+.5)*((f-K-Ie)/Ue);g.beginPath(),g.arc($n,Bn,He,0,Math.PI*2);const Wt=it(Mt.name||Mt.id||"",Mt.color);g.fillStyle=Wt,g.strokeStyle="rgba(15,23,42,0.25)",g.fill(),g.stroke()})});const nt=d.toDataURL("image/png");return ai.set(n,{fingerprint:r,dataUrl:nt}),nt}function Sn(e,t){var f;if(Ze(),e<0||e>=I.length)return!1;const n=I[e];if(!((f=n==null?void 0:n.apicurioVersions)!=null&&f.length)||!$(e))return!1;const r=n.apicurioVersions.length,l=(t%r+r)%r,c=n.apicurioVersions[l];return c!=null&&c.data?(n.apicurioActiveVersionIndex=l,n.data=c.data,Ee=!0,R=null,Ae=null,gt(),pt(),!0):!1}function ci(e){var i;if(!e||E<0)return;const t=I[E];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return;const n=Tt(t);n!==-1&&Sn(E,n+e)}function to(e){if(!(e!=null&&e.apicurioVersions)||e.apicurioVersions.length<=1)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||S(e)||"Artifact",t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const r=Tt(e),l=si(e)||"latest";i.textContent=`No. in series ${l} (${r+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const c=document.createElement("div");c.className="version-nav__controls";const f=document.createElement("button");f.type="button",f.className="version-nav__button",f.textContent="Previous",f.addEventListener("click",()=>ci(-1));const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Next",d.addEventListener("click",()=>ci(1)),c.appendChild(f),c.appendChild(d),t.appendChild(c);const g=document.createElement("div");return g.className="version-nav__thumbs",e.apicurioVersions.forEach((b,N)=>{var nt;const j=document.createElement("button");j.type="button",j.className="version-nav__thumb",N===r&&j.classList.add("is-active");const K=eo(e,N);if(K){const ut=document.createElement("img");ut.src=K,ut.alt=`Version ${N+1}`,j.appendChild(ut)}const Ie=document.createElement("div");Ie.className="version-nav__thumb-label";const He=M(((nt=b==null?void 0:b.data)==null?void 0:nt.id)||(b==null?void 0:b.id)||"");Ie.textContent=He||(b!=null&&b.version?`v${b.version}`:`${N+1}`),j.appendChild(Ie),j.addEventListener("click",()=>Sn(E,N)),g.appendChild(j)}),t.appendChild(g),t}function $t(){var wi,yi,Ei;if(!J)return;bt(),Array.isArray(J.m.categories)||(J.m.categories=[]),console.log("[Blockscape] rendering categories=",J.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!J.m.abstract,"- value:",J.m.abstract?J.m.abstract.substring(0,50)+"...":"none"),p.innerHTML="",X.clear();const e=to(I[E]);e&&p.appendChild(e),x.setAttribute("width",window.innerWidth),x.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=J.m.title&&J.m.title.trim()||m(I[E]),t.appendChild(n),((wi=I[E])!=null&&wi.isSeries||((Ei=(yi=I[E])==null?void 0:yi.apicurioVersions)==null?void 0:Ei.length)>1)&&lt(I[E],{seriesName:I[E].title||J.m.title||m(I[E])});const i=si(I[E]),r=fn(I[E]),l=(J.m.id??"").toString().trim(),c=document.createElement("div");c.className="blockscape-model-meta__details";const f=(B,ie)=>{if(!ie)return;const ee=document.createElement("div");ee.className="blockscape-model-id";const We=document.createElement("span");We.className="blockscape-model-id__label",We.textContent=B;const ct=document.createElement("span");ct.className="blockscape-model-id__value",ct.textContent=ie,ee.append(We,ct),c.appendChild(ee)};f("Series ID",r),f("Model ID",l),f("No. in series",i),c.childElementCount&&t.appendChild(c),p.appendChild(t);const d=document.createElement("div");d.className="blockscape-tabs";const g=document.createElement("div");g.className="blockscape-tablist",g.setAttribute("role","tablist"),d.appendChild(g);const b=document.createElement("div");b.className="blockscape-tabpanels",d.appendChild(b);const N=document.createElement("div"),j=document.createElement("div"),K=document.createElement("div"),Ie=document.createElement("div");let He="";const nt=Qi(I[E]),ut=Tt(I[E]);tt=null,se="";const at=[{id:"map",label:"Map",panel:N},{id:"abstract",label:"Info",panel:j},{id:"source",label:"Settings",panel:K},{id:"apicurio",label:"Apicurio",panel:Ie}],Kt=typeof he.isEnabled=="function"?he.isEnabled():!1,$n=B=>{if(!x)return;const ie=B==="map";x.hidden=!ie,ie?(_n(),Bt()):x.innerHTML=""};at.forEach((B,ie)=>{const ee=document.createElement("button");ee.type="button",ee.id=`tab-${B.id}`,ee.className="blockscape-tab"+(ie===0?" is-active":""),ee.setAttribute("role","tab"),ee.setAttribute("aria-controls",`panel-${B.id}`),ee.setAttribute("aria-selected",ie===0?"true":"false"),ee.textContent=B.label,B.id==="apicurio"&&!Kt&&(ee.hidden=!0,ee.tabIndex=-1,ee.setAttribute("aria-hidden","true"),ee.style.display="none"),B.button=ee,g.appendChild(ee),B.panel.id=`panel-${B.id}`,B.panel.classList.add("blockscape-tabpanel"),B.panel.setAttribute("role","tabpanel"),B.panel.setAttribute("aria-labelledby",ee.id),B.panel.hidden=ie!==0,ie===0&&B.panel.classList.add("is-active"),b.appendChild(B.panel)});const Ut=B=>{qe=B,at.forEach(ie=>{const ee=ie.id===B;ie.button.classList.toggle("is-active",ee),ie.button.setAttribute("aria-selected",ee?"true":"false"),ie.panel.classList.toggle("is-active",ee),ie.panel.hidden=!ee}),$n(B)},Ue=at.find(B=>B.id==="apicurio"),Mt=B=>{if(!Ue||!Ue.button||!Ue.panel)return;const ie=!!B;if(Ue.button.hidden=!ie,Ue.button.tabIndex=ie?0:-1,Ue.button.setAttribute("aria-hidden",ie?"false":"true"),Ue.button.style.display=ie?"":"none",ie){const ee=qe==="apicurio";Ue.button.classList.toggle("is-active",ee),Ue.button.setAttribute("aria-selected",ee?"true":"false"),Ue.panel.classList.toggle("is-active",ee),Ue.panel.hidden=!ee}else{const ee=Ue.panel.classList.contains("is-active");if(Ue.button.classList.remove("is-active"),Ue.button.setAttribute("aria-selected","false"),Ue.panel.classList.remove("is-active"),Ue.panel.hidden=!0,ee){const We=at.find(ct=>ct.id!=="apicurio");We&&Ut(We.id)}}jt&&(jt.checked=ie)};at.forEach(B=>{B.button.addEventListener("click",()=>{bt(),Ut(B.id)}),B.id==="abstract"&&(tt=B.button,B.button.addEventListener("mouseenter",()=>Ln(B.button,He,{offset:12})),B.button.addEventListener("mouseleave",bt),B.button.addEventListener("focus",()=>Ln(B.button,He,{offset:12})),B.button.addEventListener("blur",bt))});const Bn=(B=>{const ie=at.find(We=>We.id===qe);if(ie&&(ie.id!=="apicurio"||B))return ie.id;const ee=at.find(We=>We.id!=="apicurio"||B);return(ee==null?void 0:ee.id)||at[0].id})(Kt);Ut(Bn),Mt(Kt),typeof he.onEnabledChange=="function"&&he.onEnabledChange(Mt),p.appendChild(d);const Wt=document.createElement("div");Wt.className="blockscape-render",N.appendChild(Wt);const ln=document.createElement("div");if(ln.className="blockscape-abstract-panel",J.m.abstract){console.log("[Blockscape] Rendering abstract content");const B=document.createElement("div");B.className="blockscape-abstract",B.innerHTML=J.m.abstract,_o(B),ln.appendChild(B),He=B.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const B=document.createElement("div");B.className="blockscape-abstract-placeholder",B.textContent="No abstract has been provided for this model.",ln.appendChild(B),He=B.outerHTML}se=He,j.appendChild(ln);const Yt=document.createElement("div");Yt.className="blockscape-source-panel";const Pt=document.createElement("div");Pt.className="blockscape-settings-panel";const On=document.createElement("p");On.className="blockscape-settings-panel__title",On.textContent="Feature toggles",Pt.appendChild(On);const dn=document.createElement("label");dn.className="map-controls__toggle";const Rt=document.createElement("input");Rt.type="checkbox",Rt.id="toggleSecondaryLinks",Rt.checked=Re;const gi=document.createElement("span");gi.textContent="Show indirect links",dn.appendChild(Rt),dn.appendChild(gi),Rt.addEventListener("change",()=>{Re=Rt.checked,R?Ke(R):(An(),Bt())}),Pt.appendChild(dn);const un=document.createElement("label");un.className="apicurio-toggle";const Et=document.createElement("input");Et.type="checkbox",Et.id="apicurioFeatureToggle",Et.checked=typeof he.isEnabled=="function"?he.isEnabled():!1,jt=Et;const bi=document.createElement("span");bi.textContent="Apicurio",un.appendChild(Et),un.appendChild(bi),Pt.appendChild(un);const Un=document.createElement("p");if(Un.className="apicurio-hint",Un.textContent="Show the Apicurio registry tab when enabled.",Pt.appendChild(Un),Et.addEventListener("change",()=>{typeof he.setEnabled=="function"&&he.setEnabled(Et.checked)}),Yt.appendChild(Pt),a)a.hidden=!1,a.classList.remove("pf-v5-c-page__main-section"),Yt.appendChild(a);else{const B=document.createElement("p");B.className="muted",B.textContent="Source editor unavailable.",Yt.appendChild(B)}K.appendChild(Yt),he.mount(Ie);let vi=0;J.m.categories.forEach(B=>{const ie=document.createElement("section");ie.className="category",ie.dataset.cat=B.id;const ee=document.createElement("div");ee.className="cat-head",ee.innerHTML=`<div class="cat-title">${Nn(B.title||B.id)}</div>
                          <div class="muted cat-count">${(B.items||[]).length} items</div>`,ie.appendChild(ee);const We=document.createElement("div");We.className="grid",ie.appendChild(We),(B.items||[]).forEach(Qe=>{vi+=1;const Xt=io(Qe.external),et=document.createElement("div");if(et.className=Xt.isExternal?"tile external":"tile",et.tabIndex=0,et.dataset.id=Qe.id,et.dataset.globalIndex=String(vi),Xt.url&&(et.dataset.externalUrl=Xt.url),nt.has(Qe.id)){const Rn=nt.get(Qe.id);et.dataset.seriesVersionIndex=String(Rn),et.classList.add("tile--series-link");const Lo=Rn===ut?"Current map in this series":`Open version ${Rn+1} in this series`;et.title=Lo}const kt=document.createElement("img");kt.className="logo",Qe.logo?(kt.src=Qe.logo,kt.alt=Qe.name||Qe.id):(kt.alt="",kt.style.opacity=1,kt.src=Zi(Qe.name||Qe.id,Qe.color));const Mn=document.createElement("div");Mn.className="name",Mn.textContent=Qe.name||Qe.id;const Pn=document.createElement("div");Pn.className="badge",Pn.textContent="reused",Xt.url&&et.appendChild(oo(Xt.url)),et.appendChild(kt),et.appendChild(Mn),et.appendChild(Pn),We.appendChild(et),X.set(Qe.id,{el:et,catId:B.id,rect:null})}),Wt.appendChild(ie);const ct=document.createElement("button");ct.type="button",ct.className="tile-add",ct.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',ct.addEventListener("click",()=>go(B.id)),We.appendChild(ct)}),J.reusedLocal.forEach(B=>{const ie=X.get(B);ie&&(ie.el.classList.add("reused"),ie.el.querySelector(".badge").style.display="inline-block")}),no(),_n(),Bt(),ro()}function no(){p.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",t=>{var g;if(typeof t.button=="number"&&t.button!==0)return;st();const n=e.dataset.id,i=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,r=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,l=I[E],c=l?Tt(l):-1,f=((g=l==null?void 0:l.apicurioVersions)==null?void 0:g.length)>1&&Number.isInteger(i)&&i!==c,d=Fe&&Fe.id===n&&Fe.targetVersionIndex===i;if(Fe&&!d&&Ze(),f)if(d){if(Ze(),Sn(E,i))return}else At(n,i,l);else Number.isInteger(r)&&r>0&&r%5===0&&an("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",n),R===n&&!(f&&d)){Cn();return}Ke(n)}),e.addEventListener("keydown",t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),e.click())}),e.draggable=!0,e.addEventListener("dragstart",lo),e.addEventListener("dragend",uo)}),p.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",po),e.addEventListener("drop",ho),e.addEventListener("dragenter",fo),e.addEventListener("dragleave",mo)}),Qn||(Qn=!0,window.addEventListener("resize",Zn),window.addEventListener("scroll",Zn,{passive:!0})),document.getElementById("clear").onclick=()=>Cn()}function _n(){X.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function li(e,{includeSecondary:t=Re}={}){if(!e||!J)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(J.fwd.get(e)||[]),i=new Set(J.rev.get(e)||[]),r=new Set,l=new Set,c=[],f=new Set,d=(g,b,N,j)=>{if(!g||!b)return;const K=`${g}->${b}:${N}:${j}`;f.has(K)||(f.add(K),c.push({from:g,to:b,type:N,depth:j}))};return n.forEach(g=>d(e,g,"dep",1)),i.forEach(g=>d(e,g,"revdep",1)),t&&new Set([...n,...i]).forEach(b=>{(J.fwd.get(b)||new Set).forEach(K=>{const Ie=K===e;Ie||r.add(K),Ie||d(b,K,"dep",2)}),(J.rev.get(b)||new Set).forEach(K=>{const Ie=K===e;Ie||l.add(K),Ie||d(b,K,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:r,secondaryRevs:l,edges:c}}function cn(e,t){const n=X.get(e);n&&n.el.classList.add(t)}function Ke(e){var f,d,g;R=e,Ae=li(e),An();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:r}=Ae;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const l=X.get(e);l&&l.el.classList.add("selected"),t.forEach(b=>cn(b,"dep")),n.forEach(b=>cn(b,"revdep")),i.forEach(b=>{!t.has(b)&&b!==e&&cn(b,"dep-indirect")}),r.forEach(b=>{!n.has(b)&&!t.has(b)&&b!==e&&cn(b,"revdep-indirect")}),Bt();const c=(g=(d=(f=X.get(e))==null?void 0:f.el)==null?void 0:d.dataset)==null?void 0:g.externalUrl;c&&an("This item has link to",Be,c)}function Cn(){R=null,Ae=null,An(),Bt()}function An(){p.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function Bt(){for(;x.firstChild;)x.removeChild(x.firstChild);if(!R||x.hidden)return;Ae=li(R),Ae.edges.forEach(t=>{var N,j;const n=(N=X.get(t.from))==null?void 0:N.rect,i=(j=X.get(t.to))==null?void 0:j.rect;if(!n||!i)return;const r=di(n),l=di(i),c=document.createElementNS("http://www.w3.org/2000/svg","path"),f=(r.x+l.x)/2,d=r.y,g=(r.x+l.x)/2,b=l.y;c.setAttribute("d",`M ${r.x},${r.y} C ${f},${d} ${g},${b} ${l.x},${l.y}`),c.setAttribute("fill","none"),c.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),c.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),c.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&c.setAttribute("stroke-dasharray","4 3"),c.setAttribute("vector-effect","non-scaling-stroke"),x.appendChild(c)})}function di(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function Nn(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function io(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function oo(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function Ln(e,t,{offset:n=8}={}){!y||!e||!t||(y.innerHTML=t,y.hidden=!1,y.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),r=y.getBoundingClientRect(),l=window.scrollX||document.documentElement.scrollLeft,c=window.scrollY||document.documentElement.scrollTop;let f=i.left+i.width/2-r.width/2+l,d=i.top-r.height-n+c;f<l+n&&(f=l+n);const g=l+window.innerWidth-r.width-n;f>g&&(f=g),d<c+n&&(d=i.bottom+n+c),y.style.left=`${f}px`,y.style.top=`${d}px`,y.classList.add("is-visible")}))}function bt(){rt&&(clearTimeout(rt),rt=null),y&&(y.classList.remove("is-visible"),y.setAttribute("aria-hidden","true"),y.hidden=!0)}function ro(){Ee&&(Ee=!1,!(!tt||!se)&&(bt(),Ln(tt,se,{offset:12}),rt=setTimeout(()=>{bt(),so()},1e3)))}function so(){tt&&(mt&&(clearTimeout(mt),mt=null),tt.classList.add("blockscape-tab--twinkle"),mt=setTimeout(()=>{tt.classList.remove("blockscape-tab--twinkle"),mt=null},1400))}window.addEventListener("scroll",bt,!0),window.addEventListener("resize",bt);function st(){C&&(C.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),C.setAttribute("aria-hidden","true"),C.hidden=!0,ui([]))}function ao(e,t){C&&(ye={x:e,y:t},C.hidden=!1,C.setAttribute("aria-hidden","false"),C.classList.add("is-visible"),Ot(e,t))}function Ot(e,t){if(!C)return;const n=12;C.style.left=`${e+n}px`,C.style.top=`${t+n}px`;const i=C.getBoundingClientRect();let r=i.left,l=i.top;i.right>window.innerWidth-n&&(r=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(l=Math.max(n,window.innerHeight-i.height-n)),C.style.left=`${r}px`,C.style.top=`${l}px`}function ui(e=[]){le&&(le.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),le.appendChild(n)}),le.hidden=e.length===0)}async function co(e,t){var g;if(!C)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((g=t.querySelector(".name"))==null?void 0:g.textContent)||n||"Preview",r=n?`${n}.html`:"",l=r?`items/${r}`:"",c=++$e,f=t.dataset.externalUrl||"",d=[{label:"Edit",title:"Edit this item",onClick:()=>{st(),ce.open(n)}}];if(f&&d.push({label:"Open link ↗",title:f,onClick:()=>window.open(f,"_blank","noopener")}),ui(d),n&&Ke(n),ne.textContent=i,H.innerHTML='<div class="item-preview__status">Loading…</div>',C.classList.remove("item-preview--has-frame"),C.classList.add("item-preview--expanded"),ao(e.clientX,e.clientY),!l){H.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',Ot(ye.x,ye.y);return}try{const b=await fetch(l,{cache:"no-cache"});if(!b.ok)throw new Error(`HTTP ${b.status}`);const N=await b.text();if(c!==$e)return;if(!N.trim()){H.innerHTML=`<div class="item-preview__status">No content in <code>${Nn(r)}</code>.</div>`,Ot(ye.x,ye.y);return}const K=document.createElement("iframe");K.className="item-preview__frame",K.title=`${i} details`,K.srcdoc=N,H.innerHTML="",H.appendChild(K),C.classList.add("item-preview--has-frame"),Ot(ye.x,ye.y)}catch(b){if(c!==$e)return;H.innerHTML=`<div class="item-preview__status">No preview available for <strong>${Nn(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${l}`,b),Ot(ye.x,ye.y)}}ue&&ue.addEventListener("click",st),A&&A.addEventListener("click",()=>{Hi()}),oe&&oe.addEventListener("click",()=>{Di()}),re&&re.addEventListener("click",kn),ge&&ge.addEventListener("click",kn),Ce&&Ce.addEventListener("click",xn),De&&De.addEventListener("click",xn),p&&p.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!p.contains(t)||co(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!C||C.hidden||C.contains(e.target)||st()}),Se&&Se.addEventListener("click",()=>{pe("button")}),D&&D.addEventListener("click",()=>{if(E<0){alert("Load or select a model before creating a version.");return}try{const e=de({versionLabel:"map edit"});ot(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),U&&U.addEventListener("click",async()=>{var l;if(E<0||!I[E]){alert("Select or load a model before sharing.");return}const e={title:m(I[E],"Shared Model"),data:I[E].data};let t;try{t=wn(JSON.stringify(e))}catch(c){console.error("[Blockscape] share encode failed",c),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(c){console.warn("[Blockscape] failed to update URL for share",c),window.location.hash=n.hash}let r=!1;if((l=navigator.clipboard)!=null&&l.writeText)try{await navigator.clipboard.writeText(i),r=!0}catch(c){console.warn("[Blockscape] clipboard write failed",c)}r?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),z&&z.addEventListener("click",()=>{const e=(o.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};R&&(n.selectedItemId=R),localStorage.setItem(me,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";R&&(t=`editor.html?selected=${encodeURIComponent(R)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==me||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||ri("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===Pe&&ri("message")})),document.addEventListener("keydown",e=>{var n,i,r,l,c,f;if(Vi()){e.key==="Escape"&&(e.preventDefault(),kn());return}if(!(G!=null&&G.hidden)&&e.key==="Escape"){e.preventDefault(),xn();return}if(!((n=ce==null?void 0:ce.isOpen)!=null&&n.call(ce))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const d=I[E],g=((i=d==null?void 0:d.apicurioVersions)==null?void 0:i.length)>1;pe("shortcut",g);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!Lt())return;if(Eo()){e.preventDefault();return}}if(e.key==="Escape"&&C&&!C.hidden&&st(),e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!Lt()||e.altKey||e.ctrlKey||e.metaKey)return;const d=e.key==="ArrowLeft"?-1:1;e.shiftKey?bo(d)&&e.preventDefault():vo(d)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!Lt()||e.altKey||e.ctrlKey||e.metaKey)return;const d=e.key==="ArrowUp"?-1:1;e.shiftKey?yo(d)&&e.preventDefault():wo(d)&&e.preventDefault()}if(e.key==="Delete"){if(!Lt()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;ko()&&e.preventDefault()}if(e.key==="F2"){if(!Lt())return;const d=R||((f=(c=(l=(r=e.target)==null?void 0:r.closest)==null?void 0:l.call(r,".tile"))==null?void 0:c.dataset)==null?void 0:f.id);d&&ce.open(d)&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!C||C.hidden||Ot(ye.x,ye.y)}),window.addEventListener("scroll",()=>{!C||C.hidden||st()},!0);let vt=null,zt=null;function lo(e){st(),vt=e.target.dataset.id,zt=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:vt,categoryId:zt})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",vt,"from",zt)}function uo(e){e.target.classList.remove("dragging"),p.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),p.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),vt=null,zt=null}function po(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function fo(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function mo(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function ho(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!vt||!i)return;const l=Array.from(t.querySelectorAll(".tile")).filter(c=>c.dataset.id!==vt).find(c=>{const f=c.getBoundingClientRect();return e.clientY<f.top+f.height/2});pi(vt,l?l.dataset.id:null,i),$t(),console.log("[Blockscape] drop completed",vt,"from",zt,"to",i)}function pi(e,t,n){if(E<0)return;const r=I[E].data.categories||[],l=r.find(b=>(b.items||[]).some(N=>N.id===e)),c=r.find(b=>b.id===n);if(!l||!c)return;l.items=l.items||[],c.items=c.items||[];const f=l.items.findIndex(b=>b.id===e);if(f===-1)return;const[d]=l.items.splice(f,1);let g=c.items.length;if(t){const b=c.items.findIndex(N=>N.id===t);b!==-1&&(g=b)}c.items.splice(g,0,d),gt(),pt()}function go(e){if(E<0||!e)return;const t=I[E].data,i=(t.categories||[]).find(d=>d.id===e);if(!i)return;i.items=i.items||[];const r=`New item ${i.items.length+1}`,c={id:Q(`${e}-${i.items.length+1}`,t),name:r,deps:[]};i.items.push(c),gt(),pt(),st(),Ke(c.id);const f=X.get(c.id);f!=null&&f.el&&f.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",c.id,"to",e)}function bo(e){if(!R||E<0||!e)return!1;const n=I[E].data.categories||[],i=X.get(R);let r=null;if(i!=null&&i.catId&&(r=n.find(d=>d.id===i.catId)),r||(r=n.find(d=>(d.items||[]).some(g=>g.id===R))),!r)return!1;r.items=r.items||[];const l=r.items.findIndex(d=>d.id===R);if(l===-1)return!1;const c=l+e;if(c<0||c>=r.items.length)return!1;const[f]=r.items.splice(l,1);return r.items.splice(c,0,f),gt(),pt(),$t(),Ke(R),!0}function vo(e){if(!J||!J.m||!e)return!1;const t=J.m.categories||[];if(!t.length)return!1;const n=()=>{const d=t.find(g=>(g.items||[]).length);return d?{category:d,item:d.items[0]}:null};if(!R){const d=n();return d?(Ke(d.item.id),!0):!1}const i=X.get(R);let r=null;if(i!=null&&i.catId&&(r=t.find(d=>d.id===i.catId)),r||(r=t.find(d=>(d.items||[]).some(g=>g.id===R))),!r){const d=n();return d?(Ke(d.item.id),!0):!1}const l=r.items||[];if(!l.length)return!1;const c=l.findIndex(d=>d.id===R);if(c===-1)return!1;const f=c+e;return f<0||f>=l.length?!1:(Ke(l[f].id),!0)}function wo(e){if(!J||!J.m||!e)return!1;const t=J.m.categories||[];if(!t.length)return!1;const n=()=>{for(const d of t)if(d.items&&d.items.length)return d.items[0].id;return null};let r=(()=>{if(!R)return-1;const d=X.get(R);if(d!=null&&d.catId){const g=t.findIndex(b=>b.id===d.catId);if(g!==-1)return g}return t.findIndex(g=>(g.items||[]).some(b=>b.id===R))})();if(r===-1){const d=n();return d?(Ke(d),!0):!1}let c=(t[r].items||[]).findIndex(d=>d.id===R);c===-1&&(c=0);let f=r+e;for(;f>=0&&f<t.length;){const g=t[f].items||[];if(g.length){const b=Math.min(g.length-1,Math.max(0,c));return Ke(g[b].id),!0}f+=e>0?1:-1}return!1}function yo(e){if(!R||E<0||!e)return!1;const n=I[E].data.categories||[];if(!n.length)return!1;const i=X.get(R);let r=-1;if(i!=null&&i.catId&&(r=n.findIndex(N=>N.id===i.catId)),r===-1&&(r=n.findIndex(N=>(N.items||[]).some(j=>j.id===R))),r===-1)return!1;const l=r+e;if(l<0||l>=n.length)return!1;const c=n[r],f=n[l];if(!f)return!1;c.items=c.items||[],f.items=f.items||[];const d=c.items.findIndex(N=>N.id===R);if(d===-1)return!1;const g=Math.min(f.items.length,Math.max(0,d)),b=g<f.items.length?f.items[g].id:null;return pi(R,b,f.id),$t(),Ke(R),!0}function Eo(){if(!ae||E<0)return!1;const e=I[E];if(!e||e.id!==ae.modelId)return!1;const t=ae,r=(e.data.categories||[]).find(c=>c.id===t.categoryId);if(!r)return!1;r.items=r.items||[];const l=Math.min(Math.max(t.index,0),r.items.length);return r.items.splice(l,0,t.item),ae=null,st(),R=null,Ae=null,gt(),pt(),$t(),Ke(t.item.id),console.log("[Blockscape] undo delete restored",t.item.id),!0}function ko(){if(!R||E<0)return!1;const t=I[E].data.categories||[];if(!t.length)return!1;const n=X.get(R);let i=null;if(n!=null&&n.catId&&(i=t.find(g=>g.id===n.catId)),i||(i=t.find(g=>(g.items||[]).some(b=>b.id===R))),!i||!Array.isArray(i.items))return!1;const r=i.items.findIndex(g=>g.id===R);if(r===-1)return!1;const l=i.items.splice(r,1)[0];if(!l)return!1;const c=I[E];ae={item:l,categoryId:i.id,index:r,modelId:c?c.id:null};const d=(()=>{var b;if(i.items.length){const N=Math.min(r,i.items.length-1);return((b=i.items[N])==null?void 0:b.id)||null}const g=t.findIndex(N=>N.id===i.id);if(g===-1)return null;for(let N=g+1;N<t.length;N++){const j=t[N].items||[];if(j.length)return j[0].id}for(let N=g-1;N>=0;N--){const j=t[N].items||[];if(j.length)return j[0].id}return null})();return st(),R=null,Ae=null,gt(),pt(),$t(),d?Ke(d):Cn(),console.log("[Blockscape] removed item",l.id),!0}P&&P.addEventListener("click",async()=>{const e=o.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await on(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),F&&F.addEventListener("click",async()=>{const e=Ge();if(!e){alert("No series available to copy. Create another version first.");return}await on(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),ke&&ke.addEventListener("click",async()=>{try{const e=await yn();if(!e){alert("Clipboard is empty.");return}o.value=e,o.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=yt(o.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const r=we(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=r)}),E===-1&&t!=null?ot(t):Nt()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(E<0){alert("No active model selected.");return}try{const t=JSON.parse(o.value);if(u(t,{titleHint:m(I[E]),idHint:S(I[E])||m(I[E])}),I[E].data=t,I[E].title=t.title||I[E].title,I[E].isSeries||((e=I[E].apicurioVersions)==null?void 0:e.length)>1){const n=I[E].title||m(I[E]);lt(I[E],{seriesName:n,fallbackTitle:n})}Ye(),console.log("[Blockscape] replaced active model:",m(I[E])),pt(),he.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const r=await i.text(),l=i.name.replace(/\.[^.]+$/,"")||"File",c=yt(r,l,{seriesTitleOverride:`${l} series`});if(!c.length){console.warn("[Blockscape] no models in file:",i.name);continue}c.forEach((f,d)=>{var He;const g=(((He=f.data)==null?void 0:He.title)??"").toString().trim(),b=c.length>1?`${i.name} #${d+1}`:i.name,N=`${l} series`,j=f.isSeries?N:null;let K={...f};if(f.isSeries){const nt=j||g||f.title||b||"unknown";K.title=nt;const ut=Qt(nt||"unknown");qt(K,ut),lt(K,{seriesName:nt,fallbackTitle:"unknown"}),K.apicurioArtifactName=K.apicurioArtifactName||nt}else K.title=g||b;const Ie=we({...K,apicurioArtifactName:K.apicurioArtifactName||j||K.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=Ie)})}E===-1&&n!=null?ot(n):Nt()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",xo);function xo(e){var r;if(!Lt())return;const t=((r=e.clipboardData)==null?void 0:r.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Ki(t))return;let n=[];try{n=yt(t,"Clipboard",{promptForSeriesName:!0})}catch(l){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",l);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((l,c)=>{const f=we(l,{versionLabel:n.length>1?`paste #${c+1}`:"paste"});i==null&&(i=f)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&ot(i)}T.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(ze(),ot(n))}),document.getElementById("removeModel").onclick=()=>{if(E<0)return;const e=m(I[E]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",m(I[E])),I.splice(E,1),!I.length){E=-1,J=null,p.innerHTML="",x.innerHTML="",o.value="",Nt(),Ye();return}const n=Math.min(E,I.length-1);ot(n)},ve&&(ve.addEventListener("input",e=>{ni(e.target.value||"")}),ve.addEventListener("focus",()=>{ve.value&&ve.value.trim()&&ti(ve.value)})),L&&L.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;ji({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!L||L.hidden)return;const t=e.target;L.contains(t)||ve&&(t===ve||ve.contains(t))||(L.hidden=!0)}),w&&V&&q&&w.addEventListener("submit",async e=>{e.preventDefault();const t=V.value.trim();if(!t){alert("Please enter a URL"),V.focus();return}const n=await Tn(t);if(typeof n=="number"){ot(n),V.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!V||!t)return;let n=null;V.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const r=V.value.slice(-12);t.textContent=r?`…${r}`:""},300)})}();function pt(){if(!(E<0))try{J=Xi(I[E].data),$t()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function Io(){const e=["comms.bs","planets.bs","styleguide.bs"],t=n=>mn?mn.endsWith("/")?`${mn}${n}`:`${mn}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const r=await i.text(),l=n.replace(/\.[^.]+$/,"")||"Model",c=yt(r,l,{seriesTitleOverride:`${l} series`});if(!c.length){console.warn("[Blockscape] no models found in",n);continue}c.forEach(f=>{let d={...f};if(f.isSeries){const g=`${l} series`;d={...f,title:g,apicurioArtifactName:g};const b=Qt(g||"unknown");qt(d,b),lt(d,{seriesName:g,fallbackTitle:"unknown"})}we(d,{versionLabel:n})}),console.log(`[Blockscape] loaded ${c.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}Nt()}async function So(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const r=await fetch(e,i);if(r.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);return await r.text()}catch(r){n=r}throw n||new Error("Unable to fetch URL")}function _o(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>Co(i)),e.querySelectorAll("a[href]").forEach(i=>{const r=i.getAttribute("href");mi(r)&&fi(i,r)})}function Co(e){var f,d;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(d=(f=e.parentNode)==null?void 0:f.closest)!=null&&d.call(f,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let r;for(;(r=n.exec(t))!==null;)i.push({url:r[0],index:r.index});if(!i.length)return;const l=document.createDocumentFragment();let c=0;i.forEach(({url:g,index:b})=>{b>c&&l.appendChild(document.createTextNode(t.slice(c,b))),l.appendChild(Ao(g)),c=b+g.length}),c<t.length&&l.appendChild(document.createTextNode(t.slice(c))),e.parentNode.replaceChild(l,e)}function Ao(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",mi(e)&&fi(t,e),t}function fi(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>No(n,t,e)))}async function No(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await Tn(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function mi(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function Tn(e){try{console.log("[Blockscape] loading from URL:",e);const t=await So(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let r;try{r=yt(t,i)}catch(c){throw new Error(`Invalid JSON payload: ${c.message}`)}if(!r.length)throw new Error("No JSON objects found in response.");let l=null;return r.forEach((c,f)=>{var K;const d=(((K=c.data)==null?void 0:K.title)??"").toString().trim(),g=r.length>1?`${i} #${f+1}`:i,b=c.isSeries?`${i} series`:null;let N={...c};if(c.isSeries){const Ie=b||d||N.title||g;N={...c,title:Ie,apicurioArtifactName:Ie||c.apicurioArtifactName};const He=Qt(Ie||"unknown");qt(N,He),lt(N,{seriesName:Ie||b||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:He,url:e,baseName:i,seriesTitle:Ie})}const j=we({...N,title:d||N.title||g,apicurioArtifactName:N.apicurioArtifactName||b||c.apicurioArtifactName},{versionLabel:i});l==null&&(l=j)}),console.log(`[Blockscape] loaded ${r.length} model(s) from URL:`,i),E===-1&&l!=null?ot(l):Nt(),l}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=yt(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let r=null;i.forEach(b=>{const N=we(b,{versionLabel:"seed"});r==null&&(r=N)}),await Io();const l=await Yi(),c=oi(),f=c==null?void 0:c.index,d=Wi();ot(typeof l=="number"?l:typeof d=="number"?d:typeof f=="number"?f:r??0)})()}function er(o){let a;return{c(){a=O("div"),a.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',v(a,"id","shortcutHelp"),v(a,"class","shortcut-help"),a.hidden=!0,v(a,"aria-hidden","true"),v(a,"role","dialog"),v(a,"aria-modal","true"),v(a,"aria-labelledby","shortcutHelpTitle")},m(p,x){je(p,a,x)},p:ft,i:ft,o:ft,d(p){p&&Me(a)}}}class tr extends Xn{constructor(a){super(),Yn(this,a,null,er,Kn,{})}}const nr=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function Li(o){let a,p,x,y,T,C,w,V;return{c(){a=O("div"),p=O("div"),x=O("a"),y=Wn("Open Blockscape GPT"),T=te(),C=O("div"),C.textContent="Paste the copied prompt into that chat.",w=te(),V=O("div"),V.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',v(x,"href",or),v(x,"target","_blank"),v(x,"rel","noreferrer"),v(C,"class","new-panel__hint"),v(p,"class","new-panel__link"),v(V,"class","new-panel__link new-panel__link--disabled"),v(a,"class","new-panel__links")},m(q,ne){je(q,a,ne),_(a,p),_(p,x),_(x,y),_(p,T),_(p,C),_(a,w),_(a,V)},p:ft,d(q){q&&Me(a)}}}function Ti(o){let a,p,x,y,T,C;return{c(){a=O("div"),p=O("div"),p.textContent="Generated prompt",x=te(),y=O("textarea"),v(p,"class","new-panel__prompt-label"),v(y,"class","pf-v5-c-form-control new-panel__textarea"),v(y,"rows","4"),y.readOnly=!0,v(a,"class","new-panel__prompt")},m(w,V){je(w,a,V),_(a,p),_(a,x),_(a,y),Ft(y,o[4]),T||(C=xt(y,"input",o[12]),T=!0)},p(w,V){V&16&&Ft(y,w[4])},d(w){w&&Me(a),T=!1,C()}}}function ir(o){let a,p,x,y,T,C,w,V,q,ne,H,le,ue,Se,U,D,z,P,F,ke,A,oe,Y,fe,re,ge,G,Ce,De,ve,L,me,Pe,Le,I,E,he,J,X,R,Ae,Re,$e,ye,qe,ae=o[2]==="gpt"&&Li(),_e=o[4]&&o[5]&&Ti(o);return $e=Mo(o[10][0]),{c(){a=O("div"),p=O("div"),x=te(),y=O("div"),T=O("div"),T.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',C=te(),w=O("form"),V=O("div"),q=O("label"),q.textContent="Domain",ne=te(),H=O("p"),H.textContent="Describe what you want to create a map for.",le=te(),ue=O("textarea"),Se=te(),U=O("div"),D=O("label"),z=O("input"),P=te(),F=O("span"),F.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,ke=te(),A=O("fieldset"),oe=O("legend"),oe.textContent="Target",Y=te(),fe=O("p"),fe.textContent="Choose where you plan to use the prompt.",re=te(),ge=O("label"),G=O("input"),Ce=te(),De=O("div"),De.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',ve=te(),L=O("label"),me=O("input"),Pe=te(),Le=O("div"),Le.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',I=te(),E=O("div"),he=O("button"),he.textContent="Copy prompt",J=te(),X=O("div"),R=Wn(o[3]),Ae=te(),ae&&ae.c(),Re=te(),_e&&_e.c(),v(p,"id","newPanelBackdrop"),v(p,"class","shortcut-help__backdrop"),v(T,"class","shortcut-help__header"),v(q,"for","newDomain"),v(H,"class","new-panel__hint"),v(ue,"id","newDomain"),v(ue,"class","pf-v5-c-form-control new-panel__textarea"),v(ue,"rows","4"),ue.required=!0,v(ue,"placeholder","Ex: Companies building open-source geospatial tools"),v(V,"class","new-panel__field"),v(z,"id","seriesToggle"),v(z,"type","checkbox"),v(D,"class","new-panel__toggle"),v(D,"for","seriesToggle"),v(U,"class","new-panel__field"),v(fe,"class","new-panel__hint"),v(G,"type","radio"),v(G,"name","target"),G.__value="gpt",Ft(G,G.__value),v(ge,"class","new-panel__option"),v(me,"type","radio"),v(me,"name","target"),me.__value="plain",Ft(me,me.__value),v(L,"class","new-panel__option"),v(A,"class","new-panel__field"),v(he,"class","pf-v5-c-button pf-m-primary"),v(he,"type","submit"),v(X,"class","new-panel__status"),v(X,"aria-live","polite"),v(E,"class","new-panel__actions"),v(w,"class","shortcut-help__list new-panel__form"),v(y,"class","shortcut-help__panel"),v(y,"tabindex","-1"),v(a,"id","newPanel"),v(a,"class","shortcut-help"),a.hidden=!0,v(a,"aria-hidden","true"),v(a,"role","dialog"),v(a,"aria-modal","true"),v(a,"aria-labelledby","newPanelTitle"),$e.p(G,me)},m(be,Be){je(be,a,Be),_(a,p),_(a,x),_(a,y),_(y,T),_(y,C),_(y,w),_(w,V),_(V,q),_(V,ne),_(V,H),_(V,le),_(V,ue),Ft(ue,o[0]),_(w,Se),_(w,U),_(U,D),_(D,z),z.checked=o[1],_(D,P),_(D,F),_(w,ke),_(w,A),_(A,oe),_(A,Y),_(A,fe),_(A,re),_(A,ge),_(ge,G),G.checked=G.__value===o[2],_(ge,Ce),_(ge,De),_(A,ve),_(A,L),_(L,me),me.checked=me.__value===o[2],_(L,Pe),_(L,Le),_(w,I),_(w,E),_(E,he),_(E,J),_(E,X),_(X,R),_(w,Ae),ae&&ae.m(w,null),_(w,Re),_e&&_e.m(w,null),ye||(qe=[xt(ue,"input",o[7]),xt(z,"change",o[8]),xt(G,"change",o[9]),xt(me,"change",o[11]),xt(w,"submit",Uo(o[6]))],ye=!0)},p(be,[Be]){Be&1&&Ft(ue,be[0]),Be&2&&(z.checked=be[1]),Be&4&&(G.checked=G.__value===be[2]),Be&4&&(me.checked=me.__value===be[2]),Be&8&&Ro(R,be[3]),be[2]==="gpt"?ae?ae.p(be,Be):(ae=Li(),ae.c(),ae.m(w,Re)):ae&&(ae.d(1),ae=null),be[4]&&be[5]?_e?_e.p(be,Be):(_e=Ti(be),_e.c(),_e.m(w,null)):_e&&(_e.d(1),_e=null)},i:ft,o:ft,d(be){be&&Me(a),ae&&ae.d(),_e&&_e.d(),$e.r(),ye=!1,tn(qe)}}}const or="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function rr(o,a,p){let x="",y=!1,T="gpt",C="",w="",V=!1;const q=()=>{var P;return typeof navigator<"u"&&!!((P=navigator.clipboard)!=null&&P.writeText)};function ne(P){const F=P||"[DOMAIN]",ke=y?"series":"map",oe=nr.replaceAll("[DOMAIN NAME]",F).replaceAll("[DOMAIN]",F).replaceAll("[map|series]",ke).split(`
`),Y=`Generate a **blockscape ${ke}** for the domain of ${F}.`,fe=oe.findIndex(ge=>ge.toLowerCase().includes("generate a **blockscape value")||ge.toLowerCase().includes("generate a blockscape [map|series]")||ge.toLowerCase().startsWith("generate a blockscape"));fe>=0?oe[fe]=Y:oe.unshift(Y);const re=y?`

User requested a series (return an array of models).`:"";return`${oe.join(`
`).trim()}${re}`}async function H(P){P.preventDefault();const F=x.trim();if(p(3,C=""),p(5,V=T!=="gpt"),!F){p(3,C="Add a domain to generate a prompt."),p(4,w="");return}if(T==="gpt"?p(4,w=`${y?"Create a series":"Create a map"} for ${F}`):(p(4,w=ne(F)),p(5,V=!0)),!q()){p(3,C="Clipboard access is unavailable. Copy the prompt below."),p(5,V=!0);return}try{await navigator.clipboard.writeText(w),p(3,C=T==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),T==="gpt"&&p(5,V=!1)}catch(A){console.warn("[Blockscape] clipboard write failed",A),p(3,C="Copy failed. Use the prompt below."),p(5,V=!0)}}const le=[[]];function ue(){x=this.value,p(0,x)}function Se(){y=this.checked,p(1,y)}function U(){T=this.__value,p(2,T)}function D(){T=this.__value,p(2,T)}function z(){w=this.value,p(4,w)}return[x,y,T,C,w,V,H,ue,Se,U,le,D,z]}class sr extends Xn{constructor(a){super(),Yn(this,a,rr,ir,Kn,{})}}const{document:$i}=Oo;function ar(o){let a,p,x,y,T,C,w,V,q,ne,H,le,ue,Se,U,D,z,P,F,ke,A,oe,Y,fe,re,ge,G,Ce,De,ve,L,me,Pe,Le,I,E,he,J,X,R,Ae,Re=`<script id="seed" type="application/json">${o[1]}<\/script>`,$e,ye,qe,ae,_e,be,Be,Fe,Ve,Te,Oe,rt,tt;return Fe=new tr({}),Te=new sr({}),{c(){a=O("link"),p=te(),x=O("div"),y=O("header"),T=O("div"),C=O("div"),w=O("div"),V=O("div"),V.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',q=te(),ne=O("div"),H=O("div"),le=O("button"),ue=O("span"),ue.textContent="Toggle search and edit tools",Se=te(),U=O("span"),U.textContent="▾",D=te(),z=O("button"),z.textContent="New",P=te(),F=O("form"),F.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',ke=te(),A=O("label"),A.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',oe=te(),Y=O("button"),Y.textContent="Help",fe=te(),re=O("div"),ge=O("div"),ge.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',G=te(),Ce=O("button"),Ce.textContent="Edit",De=te(),ve=O("button"),ve.textContent="Share",Le=te(),I=O("div"),I.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',E=te(),he=O("main"),he.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,J=te(),X=O("footer"),X.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',R=te(),Ae=new Vo(!1),$e=te(),ye=Ui("svg"),qe=te(),ae=O("div"),_e=te(),be=O("div"),be.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',Be=te(),_i(Fe.$$.fragment),Ve=te(),_i(Te.$$.fragment),$i.title="Blockscape — simple landscape-style tiles",v(a,"rel","icon"),v(a,"type","image/svg+xml"),v(a,"href","./favicon.svg"),v(V,"class","blockscape-brand"),v(ue,"class","sr-only"),v(U,"class","blockscape-toolbar__toggle-icon"),v(U,"aria-hidden","true"),v(le,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),v(le,"type","button"),v(le,"aria-expanded",o[0]),v(le,"aria-controls","blockscapeHeaderExtras"),v(z,"id","newPanelButton"),v(z,"class","pf-v5-c-button pf-m-primary"),v(z,"type","button"),v(z,"title","Create something new"),v(F,"id","urlForm"),v(F,"class","blockscape-url-form"),v(F,"autocomplete","on"),F.noValidate=!0,v(A,"class","pf-v5-c-button pf-m-primary blockscape-file"),v(Y,"id","helpButton"),v(Y,"class","pf-v5-c-button pf-m-primary"),v(Y,"type","button"),v(Y,"title","Show keyboard shortcuts"),v(H,"class","blockscape-toolbar__primary"),v(ge,"class","blockscape-search"),v(Ce,"id","openInEditor"),v(Ce,"class","pf-v5-c-button pf-m-secondary"),v(Ce,"type","button"),v(Ce,"title","Open current JSON in the editor"),v(ve,"id","shareModel"),v(ve,"class","pf-v5-c-button pf-m-secondary"),v(ve,"type","button"),v(ve,"title","Copy a shareable URL for this model"),v(re,"id","blockscapeHeaderExtras"),v(re,"class","blockscape-toolbar__extras"),re.hidden=L=!o[0],v(re,"aria-hidden",me=!o[0]),v(ne,"class","blockscape-toolbar__controls"),v(ne,"data-expanded",Pe=o[0]?"true":"false"),v(I,"class","blockscape-legend"),v(I,"role","presentation"),v(w,"class","blockscape-toolbar"),v(C,"class","pf-v5-c-masthead__content"),v(T,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),v(y,"class","pf-v5-c-page__header"),v(he,"class","pf-v5-c-page__main"),v(X,"class","pf-v5-c-page__footer blockscape-footer"),v(x,"class","pf-v5-c-page"),Ae.a=$e,v(ye,"id","overlay"),v(ye,"class","svg-layer"),v(ae,"id","tabTooltip"),v(ae,"class","blockscape-tab-tooltip"),ae.hidden=!0,v(ae,"aria-hidden","true"),v(be,"id","itemPreview"),v(be,"class","item-preview"),be.hidden=!0,v(be,"aria-hidden","true")},m(se,Ee){_($i.head,a),je(se,p,Ee),je(se,x,Ee),_(x,y),_(y,T),_(T,C),_(C,w),_(w,V),_(w,q),_(w,ne),_(ne,H),_(H,le),_(le,ue),_(le,Se),_(le,U),_(H,D),_(H,z),_(H,P),_(H,F),_(H,ke),_(H,A),_(H,oe),_(H,Y),_(ne,fe),_(ne,re),_(re,ge),_(re,G),_(re,Ce),_(re,De),_(re,ve),_(w,Le),_(w,I),_(x,E),_(x,he),_(x,J),_(x,X),je(se,R,Ee),Ae.m(Re,se,Ee),je(se,$e,Ee),je(se,ye,Ee),je(se,qe,Ee),je(se,ae,Ee),je(se,_e,Ee),je(se,be,Ee),je(se,Be,Ee),Gn(Fe,se,Ee),je(se,Ve,Ee),Gn(Te,se,Ee),Oe=!0,rt||(tt=xt(le,"click",o[2]),rt=!0)},p(se,[Ee]){(!Oe||Ee&1)&&v(le,"aria-expanded",se[0]),(!Oe||Ee&1&&L!==(L=!se[0]))&&(re.hidden=L),(!Oe||Ee&1&&me!==(me=!se[0]))&&v(re,"aria-hidden",me),(!Oe||Ee&1&&Pe!==(Pe=se[0]?"true":"false"))&&v(ne,"data-expanded",Pe)},i(se){Oe||(qn(Fe.$$.fragment,se),qn(Te.$$.fragment,se),Oe=!0)},o(se){Si(Fe.$$.fragment,se),Si(Te.$$.fragment,se),Oe=!1},d(se){se&&(Me(p),Me(x),Me(R),Ae.d(),Me($e),Me(ye),Me(qe),Me(ae),Me(_e),Me(be),Me(Be),Me(Ve)),Me(a),zn(Fe,se),zn(Te,se),rt=!1,tt()}}}function cr(o,a,p){const x=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let y=!1;const T=()=>{if(p(0,y=!y),!y){const C=document.getElementById("search");C&&C.value&&(C.value="",C.dispatchEvent(new Event("input",{bubbles:!0})))}};return Do(()=>{Qo()}),[y,x,T]}class lr extends Xn{constructor(a){super(),Yn(this,a,cr,ar,Kn,{})}}const dr=document.getElementById("root");new lr({target:dr});
