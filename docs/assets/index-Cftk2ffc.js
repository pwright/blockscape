var qs=Object.defineProperty;var Gs=(s,l,u)=>l in s?qs(s,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[l]=u;var jt=(s,l,u)=>Gs(s,typeof l!="symbol"?l+"":l,u);(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const y of document.querySelectorAll('link[rel="modulepreload"]'))S(y);new MutationObserver(y=>{for(const P of y)if(P.type==="childList")for(const L of P.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&S(L)}).observe(document,{childList:!0,subtree:!0});function u(y){const P={};return y.integrity&&(P.integrity=y.integrity),y.referrerPolicy&&(P.referrerPolicy=y.referrerPolicy),y.crossOrigin==="use-credentials"?P.credentials="include":y.crossOrigin==="anonymous"?P.credentials="omit":P.credentials="same-origin",P}function S(y){if(y.ep)return;y.ep=!0;const P=u(y);fetch(y.href,P)}})();function Vt(){}function Qo(s){return s()}function Fo(){return Object.create(null)}function Jn(s){s.forEach(Qo)}function er(s){return typeof s=="function"}function Zi(s,l){return s!=s?l==l:s!==l||s&&typeof s=="object"||typeof s=="function"}function zs(s){return Object.keys(s).length===0}const Ks=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function x(s,l){s.appendChild(l)}function et(s,l,u){s.insertBefore(l,u||null)}function Ge(s){s.parentNode&&s.parentNode.removeChild(s)}function U(s){return document.createElement(s)}function tr(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Qi(s){return document.createTextNode(s)}function ae(){return Qi(" ")}function tn(s,l,u,S){return s.addEventListener(l,u,S),()=>s.removeEventListener(l,u,S)}function Xs(s){return function(l){return l.preventDefault(),s.call(this,l)}}function b(s,l,u){u==null?s.removeAttribute(l):s.getAttribute(l)!==u&&s.setAttribute(l,u)}function Ys(s){let l;return{p(...u){l=u,l.forEach(S=>s.push(S))},r(){l.forEach(u=>s.splice(s.indexOf(u),1))}}}function Zs(s){return Array.from(s.childNodes)}function Qs(s,l){l=""+l,s.data!==l&&(s.data=l)}function En(s,l){s.value=l??""}class ea{constructor(l=!1){jt(this,"is_svg",!1);jt(this,"e");jt(this,"n");jt(this,"t");jt(this,"a");this.is_svg=l,this.e=this.n=null}c(l){this.h(l)}m(l,u,S=null){this.e||(this.is_svg?this.e=tr(u.nodeName):this.e=U(u.nodeType===11?"TEMPLATE":u.nodeName),this.t=u.tagName!=="TEMPLATE"?u:u.content,this.c(l)),this.i(S)}h(l){this.e.innerHTML=l,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(l){for(let u=0;u<this.n.length;u+=1)et(this.t,this.n[u],l)}p(l){this.d(),this.h(l),this.i(this.a)}d(){this.n.forEach(Ge)}}let jn;function Dn(s){jn=s}function ta(){if(!jn)throw new Error("Function called outside component initialization");return jn}function na(s){ta().$$.on_mount.push(s)}const yn=[],jo=[];let _n=[];const Jo=[],ia=Promise.resolve();let Gi=!1;function oa(){Gi||(Gi=!0,ia.then(nr))}function zi(s){_n.push(s)}const ji=new Set;let vn=0;function nr(){if(vn!==0)return;const s=jn;do{try{for(;vn<yn.length;){const l=yn[vn];vn++,Dn(l),ra(l.$$)}}catch(l){throw yn.length=0,vn=0,l}for(Dn(null),yn.length=0,vn=0;jo.length;)jo.pop()();for(let l=0;l<_n.length;l+=1){const u=_n[l];ji.has(u)||(ji.add(u),u())}_n.length=0}while(yn.length);for(;Jo.length;)Jo.pop()();Gi=!1,ji.clear(),Dn(s)}function ra(s){if(s.fragment!==null){s.update(),Jn(s.before_update);const l=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,l),s.after_update.forEach(zi)}}function sa(s){const l=[],u=[];_n.forEach(S=>s.indexOf(S)===-1?l.push(S):u.push(S)),u.forEach(S=>S()),_n=l}const ui=new Set;let aa;function Ki(s,l){s&&s.i&&(ui.delete(s),s.i(l))}function Wo(s,l,u,S){if(s&&s.o){if(ui.has(s))return;ui.add(s),aa.c.push(()=>{ui.delete(s)}),s.o(l)}}function qo(s){s&&s.c()}function Xi(s,l,u){const{fragment:S,after_update:y}=s.$$;S&&S.m(l,u),zi(()=>{const P=s.$$.on_mount.map(Qo).filter(er);s.$$.on_destroy?s.$$.on_destroy.push(...P):Jn(P),s.$$.on_mount=[]}),y.forEach(zi)}function Yi(s,l){const u=s.$$;u.fragment!==null&&(sa(u.after_update),Jn(u.on_destroy),u.fragment&&u.fragment.d(l),u.on_destroy=u.fragment=null,u.ctx=[])}function ca(s,l){s.$$.dirty[0]===-1&&(yn.push(s),oa(),s.$$.dirty.fill(0)),s.$$.dirty[l/31|0]|=1<<l%31}function eo(s,l,u,S,y,P,L=null,w=[-1]){const F=jn;Dn(s);const z=s.$$={fragment:null,ctx:[],props:P,update:Vt,not_equal:y,bound:Fo(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(l.context||(F?F.$$.context:[])),callbacks:Fo(),dirty:w,skip_bound:!1,root:l.target||F.$$.root};L&&L(z.root);let ce=!1;if(z.ctx=u?u(s,l.props||{},(j,fe,...he)=>{const Re=he.length?he[0]:fe;return z.ctx&&y(z.ctx[j],z.ctx[j]=Re)&&(!z.skip_bound&&z.bound[j]&&z.bound[j](Re),ce&&ca(s,j)),fe}):[],z.update(),ce=!0,Jn(z.before_update),z.fragment=S?S(z.ctx):!1,l.target){if(l.hydrate){const j=Zs(l.target);z.fragment&&z.fragment.l(j),j.forEach(Ge)}else z.fragment&&z.fragment.c();l.intro&&Ki(s.$$.fragment),Xi(s,l.target,l.anchor),nr()}Dn(F)}class to{constructor(){jt(this,"$$");jt(this,"$$set")}$destroy(){Yi(this,1),this.$destroy=Vt}$on(l,u){if(!er(u))return Vt;const S=this.$$.callbacks[l]||(this.$$.callbacks[l]=[]);return S.push(u),()=>{const y=S.indexOf(u);y!==-1&&S.splice(y,1)}}$set(l){this.$$set&&!zs(l)&&(this.$$.skip_bound=!0,this.$$set(l),this.$$.skip_bound=!1)}}const la="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(la);const Go="blockscape:apicurioConfig",Ji="http://localhost:8080/apis/registry/v3",li="bs",zo="-series",Wi=!1,qi=!1;function da({models:s,getActiveIndex:l,setActive:u,ensureModelMetadata:S,ensureSeriesId:y,getModelId:P,getSeriesId:L,getModelTitle:w,computeJsonFingerprint:F,uid:z}){let ce=null,j=null,fe=null,he=null,Re=null,H=null,J=null,X=null,D=null,W=null;const ke=new Set,T={baseUrl:Ji,groupId:li,authToken:"",enabled:Wi,useSemver:qi},le=new Map,Q=new Map;function ge(c){return(c||"").toString().trim().replace(/\/+$/,"")}function de(c){return`${(c||"").toString().trim()||li}${zo}`}function ye(){return!!(T.baseUrl&&T.groupId)}function K(){return T.enabled!==!1}function Ve(){ke.forEach(c=>{try{c(K())}catch(f){console.warn("[Blockscape] failed to run Apicurio enabled listener",f)}})}function Xe(c){return typeof c=="function"&&ke.add(c),()=>ke.delete(c)}function _e(){fe&&(fe.value=T.baseUrl||""),he&&(he.value=T.groupId||""),Re&&(Re.value=T.authToken||""),H&&(H.checked=K()),J&&(J.checked=!!T.useSemver)}function B(c="",f="muted"){X&&(X.textContent=c||"",X.classList.remove("is-error","is-success"),f==="error"?X.classList.add("is-error"):f==="success"&&X.classList.add("is-success"))}function be(c){if(!W||(W.innerHTML="",!c))return;const f=document.createElement("p");f.className="apicurio-hint",f.textContent=c,W.appendChild(f)}function ze(c){le.clear(),Q.clear(),be(c)}function je(){const c=l(),f=K(),C=ye(),E=c>=0?s[c]:null,m=!!(E!=null&&E.apicurioVersions&&E.apicurioVersions.length>1);if(ce){const N=ce.dataset.loading==="true",V=f&&C&&c>=0&&!!tt(s[c]);ce.disabled=!f||N||!V,f?N||(ce.textContent="Push to Apicurio"):ce.textContent="Enable Apicurio to push"}if(D){const N=D.dataset.loading==="true",V=f&&C&&m&&!!tt(E);D.disabled=!V||N,D.hidden=!m,f?N||(D.textContent="Push series"):D.textContent="Enable Apicurio to push series"}if(j){const N=j.dataset.loading==="true",V=f&&C;j.disabled=!V||N,N||(f?C?j.textContent="List artifacts":j.textContent="Enter details to list":j.textContent="Enable Apicurio to list")}}function I(){_e(),K()?ye()?(B("Apicurio push is ready when a model is selected.","muted"),le.size||be("Click “List artifacts” to browse the current group.")):(B("Enter Apicurio connection details to enable push.","muted"),ze("Enter registry details to browse artifacts.")):(B("Apicurio integration is off. Enable it to allow pushes.","muted"),ze("Apicurio integration is disabled.")),je()}function v(){if(window!=null&&window.localStorage)try{localStorage.setItem(Go,JSON.stringify(T))}catch(c){console.warn("[Blockscape] unable to persist Apicurio settings",c)}}function ve(){let c={};if(window!=null&&window.localStorage)try{const N=localStorage.getItem(Go);if(N){const V=JSON.parse(N);V&&typeof V=="object"&&(c=V)}}catch(N){console.warn("[Blockscape] failed to restore Apicurio settings",N)}const f=ge(c.baseUrl??Ji),C=(c.groupId??li).toString().trim();let E=Wi,m=qi;typeof c.enabled=="boolean"?E=c.enabled:typeof c.enabled=="string"&&(E=c.enabled==="true"),typeof c.useSemver=="boolean"?m=c.useSemver:typeof c.useSemver=="string"&&(m=c.useSemver==="true"),T.baseUrl=f||Ji,T.groupId=C||li,T.authToken=(c.authToken??"").toString().trim(),T.enabled=E,T.useSemver=m,I(),Ve()}function R(){const c={Accept:"application/json"},f=(T.authToken||"").trim();return f&&(c.Authorization=/\s/.test(f)?f:`Bearer ${f}`),c}function ie(c,f,{title:C,description:E,version:m}={}){const N={artifactId:c,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:f},metadata:{properties:{}}}};m&&(N.firstVersion.version=m),C&&(N.name=C),E&&(N.description=E);try{const V=JSON.parse(f),O=V==null?void 0:V.seriesId;O&&typeof O=="string"&&(N.firstVersion.metadata.properties.seriesId=O)}catch{}return N}function Je(c,{version:f}={}){const C={content:{contentType:"application/json",content:c},metadata:{properties:{}}};try{const E=JSON.parse(c),m=E==null?void 0:E.seriesId;m&&typeof m=="string"&&(C.metadata.properties.seriesId=m)}catch{}return f&&(C.version=f),C}function M(c){if(c==null)return null;const f=String(c).trim();if(!f)return null;const C=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(f);if(C)return{major:Number(C[1]),minor:Number(C[2]),patch:Number(C[3])};const E=/^v?(\d+)$/.exec(f);return E?{major:Number(E[1]),minor:0,patch:0}:null}function oe(c){return`${c.major}.${c.minor}.${c.patch}`}function Ie(c,f){return!c&&!f?0:c?f?c.major!==f.major?c.major-f.major:c.minor!==f.minor?c.minor-f.minor:c.patch-f.patch:1:-1}function me(c=[]){let f=null;if(c.forEach(E=>{const m=M((E==null?void 0:E.version)??E);m&&(!f||Ie(m,f)>0)&&(f=m)}),!f)return"1.0.0";const C={...f,patch:f.patch+1};return oe(C)}function tt(c,{seriesName:f,fallbackTitle:C}={}){var N;if(!c)return null;const E=f||c.title||c.apicurioArtifactName||w(c),m=C||E;if(typeof y=="function"&&(c.isSeries||((N=c.apicurioVersions)==null?void 0:N.length)>1)&&y(c,{seriesName:E,fallbackTitle:m}),typeof L=="function"){const V=L(c,{seriesName:E,fallbackTitle:m});if(V)return V}return P(c)}function Ce(c){return Array.isArray(c)?c:Array.isArray(c==null?void 0:c.artifacts)?c.artifacts:Array.isArray(c==null?void 0:c.items)?c.items:Array.isArray(c==null?void 0:c.results)?c.results:[]}function Le(c){return Array.isArray(c)?c:Array.isArray(c==null?void 0:c.versions)?c.versions:Array.isArray(c==null?void 0:c.items)?c.items:[]}function ee(c=[]){if(!Array.isArray(c)||!c.length)return null;const f=[...c].filter(Boolean);return f.sort((C,E)=>{const m=C!=null&&C.createdOn?new Date(C.createdOn).getTime():0,N=E!=null&&E.createdOn?new Date(E.createdOn).getTime():0;if(m!==N)return N-m;const V=Number(C==null?void 0:C.version),O=Number(E==null?void 0:E.version),re=Number.isFinite(V),Y=Number.isFinite(O);if(re&&Y&&V!==O)return O-V;const Z=String((C==null?void 0:C.version)??"");return String((E==null?void 0:E.version)??"").localeCompare(Z,void 0,{numeric:!0})}),f[0]||null}function We(c){if(!c)return c;let f=c;if(!Array.isArray(c==null?void 0:c.categories)){const E=c==null?void 0:c.content;if(typeof E=="string")try{f=JSON.parse(E)}catch(m){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",m)}else E&&typeof E=="object"&&(f=E)}return f}async function De(c,f,C){const E=encodeURIComponent(f),m=encodeURIComponent(C),N=`${c}/groups/${E}/artifacts/${m}`,V=R();V.Accept="application/json";const O=await fetch(N,{method:"GET",headers:V});if(!O.ok){let re=O.statusText||"Unknown error";try{const Y=await O.text();Y&&(re=Y.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${O.status}): ${re}`)}return O.json()}async function st(c,f,C){const E=encodeURIComponent(f),m=encodeURIComponent(C),N=`${c}/groups/${E}/artifacts/${m}/versions?limit=50&order=desc`,V=R();V.Accept="application/json";const O=await fetch(N,{method:"GET",headers:V});if(!O.ok){let Y=O.statusText||"Unknown error";try{const Z=await O.text();Z&&(Y=Z.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${O.status}): ${Y}`)}const re=await O.json();return Le(re).filter(Y=>Y&&Y.version!=null)}async function ht(c,f,C,E="latest"){const m=encodeURIComponent(f),N=encodeURIComponent(C),V=encodeURIComponent(E||"latest"),O=`${c}/groups/${m}/artifacts/${N}/versions/${V}/content`,re=R();re.Accept="application/json, application/*+json, */*;q=0.8";const Y=await fetch(O,{method:"GET",headers:re});if(!Y.ok){let Ue=Y.statusText||"Unknown error";try{const se=await Y.text();se&&(Ue=se.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${Y.status}): ${Ue}`)}const Z=await Y.text();let Ee=null;try{Ee=JSON.parse(Z)}catch{throw new Error("Artifact content is not valid JSON.")}return We(Ee)}async function at(c,f,C,E="latest"){const m=await ht(c,f,C,E);return{data:m,fingerprint:F(m)}}async function Ot(c,f,C){try{const m=await st(c,f,C);if(m!=null&&m.length){Q.set(C,m);const N=ee(m);if((N==null?void 0:N.version)!=null)return N.version}}catch(m){console.warn("[Blockscape] compare-version: unable to fetch versions list",m)}try{const m=await De(c,f,C);if((m==null?void 0:m.version)!=null)return m.version}catch(m){console.warn("[Blockscape] compare-version: unable to fetch metadata",m)}const E=Q.get(C);if(E&&E.length){const m=ee(E);if((m==null?void 0:m.version)!=null)return m.version}return"latest"}async function gt(c,f,C,E){if(!T.useSemver)return null;if(!E)return"1.0.0";try{const m=await st(c,f,C);return me(m)}catch(m){throw new Error(`Unable to compute next semantic version: ${m.message}`)}}function te(c=document){ce=c.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),D=c.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),j=c.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),fe=c.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),he=c.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),Re=c.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),H=c.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),J=c.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),X=c.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),W=c.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function we(){T.baseUrl=ge((fe==null?void 0:fe.value)??T.baseUrl),T.groupId=((he==null?void 0:he.value)??"").trim(),T.authToken=((Re==null?void 0:Re.value)??"").trim(),v(),I()}function bt(c){T.enabled=c!==!1,v(),I(),Ve()}function Ut(){bt(H?H.checked:Wi)}function nn(){T.useSemver=J?J.checked:qi,v(),I()}function Pt(){[fe,he,Re].forEach(c=>{c&&c.addEventListener("input",we)}),ce&&ce.addEventListener("click",()=>{qn()}),D&&D.addEventListener("click",()=>{qt()}),H&&H.addEventListener("change",Ut),J&&J.addEventListener("change",nn),j&&j.addEventListener("click",Gn),W&&W.addEventListener("click",c=>{const f=c.target.closest("[data-artifact-version]");if(f){c.stopPropagation();const m=f.dataset.artifactId,N=f.dataset.artifactVersion;m&&N&&zn(m,N);return}const C=c.target.closest("[data-artifact-load-all]");if(C){c.stopPropagation(),C.dataset.artifactId&&Kn();return}const E=c.target.closest("[data-artifact-trigger]");if(E){const m=E.dataset.artifactId;if(!m)return;Cn(m)}})}function on(){const c=document.createElement("div");return c.className="blockscape-registry-panel",c.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,c}function rn(c){if(!c)return;c.innerHTML="";const f=on();c.appendChild(f),te(c),Pt(),I()}function Jt(c){if(!W)return;if(W.innerHTML="",!c.length){be("No artifacts found in this group.");return}const f=m=>{const N=document.createElement("section");N.className="apicurio-artifact-section";const V=document.createElement("h3");V.textContent=m,N.appendChild(V);const O=document.createElement("ul");return O.className="apicurio-artifact-list",N.appendChild(O),{section:N,list:O}},C=f("Series artifacts"),E=f("Artifacts");c.forEach(m=>{if(!(m!=null&&m.artifactId))return;const V=m._groupId&&m._groupId.endsWith(zo)?C.list:E.list,O=document.createElement("li"),re=document.createElement("button");re.type="button",re.className="apicurio-artifact",re.dataset.artifactId=m.artifactId,re.dataset.artifactTrigger="toggle";const Y=document.createElement("span");Y.className="apicurio-artifact-title",Y.textContent=m.artifactId,re.appendChild(Y);const Z=[];if(m.name&&Z.push(m.name),m.version!=null&&Z.push(`v${m.version}`),m.type&&Z.push(m.type),m._groupId&&Z.push(m._groupId),Z.length){const se=document.createElement("span");se.className="apicurio-artifact-meta",se.textContent=Z.join(" • "),re.appendChild(se)}if(m.description){const se=document.createElement("span");se.className="apicurio-artifact-meta",se.textContent=m.description,re.appendChild(se)}O.appendChild(re);const Ee=document.createElement("div");Ee.className="apicurio-version-list",Ee.dataset.versionPanel=m.artifactId,Ee.hidden=!0;const Ue=document.createElement("p");Ue.className="apicurio-hint",Ue.textContent="Click to load the latest or open versions.",Ee.appendChild(Ue),O.appendChild(Ee),V.appendChild(O)}),C.list.children.length&&W.appendChild(C.section),E.list.children.length&&W.appendChild(E.section)}function sn(c){return W?W.querySelector(`[data-version-panel="${c}"]`):null}function Lt(c,f){if(!c||(c.innerHTML="",!f))return;const C=document.createElement("p");C.className="apicurio-hint",C.textContent=f,c.appendChild(C)}function Wt(c,f){const C=sn(c);if(C){if(C.innerHTML="",!f.length){Lt(C,"No versions found for this artifact.");return}f.forEach(E=>{const m=document.createElement("button");m.type="button",m.className="apicurio-version-button",m.dataset.artifactId=c,m.dataset.artifactVersion=E.version;const N=[`Version ${E.version}`];if(E.createdOn){const V=new Date(E.createdOn);isNaN(V)||N.push(V.toISOString().slice(0,10))}m.textContent=N.join(" — "),C.appendChild(m)})}}async function Cn(c){const f=sn(c);if(!f)return;if(f.dataset.open==="true"){f.hidden=!0,f.dataset.open="false";return}if(f.hidden=!1,f.dataset.open="true",f.dataset.loaded!=="true"){if(!ye()){Lt(f,"Enter registry details first.");return}Lt(f,"Loading versions…");try{const E=ge(T.baseUrl),m=le.get(c),N=T.groupId.trim(),V=(m==null?void 0:m._groupId)||N,O=await st(E,V,c);Q.set(c,O),f.dataset.loaded="true",Wt(c,O)}catch(E){console.error("[Blockscape] failed to load versions",E),Lt(f,`Unable to fetch versions: ${E.message}`)}}}function pi(c,f){var E;const C=s.findIndex(m=>m.apicurioArtifactId===c);if(C!==-1){const m=s[C].id;s[C]={...f,id:m||f.id},((E=s[C].apicurioVersions)==null?void 0:E.length)>1&&(s[C].isSeries=!0),u(C)}else s.push(f),u(s.length-1)}async function Wn(c,f,C,E){const m=encodeURIComponent(f),N=encodeURIComponent(C),V=`${c}/groups/${m}/artifacts/${N}`;try{const O=await fetch(V,{method:"GET",headers:E});if(O.status===404)return!1;if(O.ok)return!0;throw O.status===401||O.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${O.status} while checking the artifact.`)}catch(O){throw O instanceof TypeError?new Error("Network error while contacting Apicurio registry."):O}}async function qn(){var V;if(!ce||ce.dataset.loading==="true")return;if(!K()){B("Apicurio integration is off. Enable it first.","error");return}if(!ye()){B("Enter the registry base URL and group ID before pushing.","error");return}const c=l();if(c<0||!s[c]){B("No active model to push.","error");return}const f=tt(s[c],{fallbackTitle:w(s[c])});if(!f){B("Active model needs an id before pushing.","error");return}const C=ge(T.baseUrl),E=T.groupId.trim(),m=JSON.stringify(s[c].data,null,2),N=R();ce.dataset.loading="true",ce.textContent="Pushing…",ce.disabled=!0,B("Pushing to Apicurio…","muted");try{const O=await Wn(C,E,f,N),re=F(s[c].data);if(O)try{const xe=await Ot(C,E,f),{data:Ze,fingerprint:Fe}=await at(C,E,f,xe);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",xe),console.log("local fingerprint",re),console.log("registry fingerprint",Fe),console.log("local payload",s[c].data),console.log("registry payload",Ze),console.groupEnd(),re&&Fe&&re===Fe){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){B("Push cancelled (content matches the latest registry version).","muted");return}B("Pushing identical content by user choice.","muted")}else Fe?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):B("Unable to compare with registry content (skipping confirmation).","muted")}catch(xe){console.warn("[Blockscape] unable to compare registry content before push",xe),B("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const Y=T.useSemver?await gt(C,E,f,O):null;if(T.useSemver&&!Y)throw new Error("Semantic versioning is enabled but no version could be computed.");const Z=encodeURIComponent(E),Ee=encodeURIComponent(f),Ue=O?`${C}/groups/${Z}/artifacts/${Ee}/versions`:`${C}/groups/${Z}/artifacts`,se={...N,"Content-Type":"application/json"};Y&&(se["X-Registry-Version"]=Y,B(`Pushing to Apicurio as version ${Y}…`,"muted"));const Ye=O?Je(m,{version:Y}):ie(f,m,{title:w(s[c]),description:(V=s[c].data)==null?void 0:V.abstract,version:Y}),ut=await fetch(Ue,{method:"POST",headers:se,body:JSON.stringify(Ye)});if(!ut.ok){let xe=ut.statusText||"Unknown error";try{const Ze=await ut.text();Ze&&(xe=Ze.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${ut.status}): ${xe}`)}let qe=null;try{qe=await ut.json()}catch{qe=null}const ue=(qe==null?void 0:qe.version)||(qe==null?void 0:qe.globalId)||"",He=O?"Updated":"Created",nt=ue?` (version ${ue})`:"";B(`${He} ${f}${nt}`,"success")}catch(O){console.error("[Blockscape] Apicurio push failed",O),B(`Apicurio push failed: ${O.message}`,"error")}finally{ce.dataset.loading="false",je()}}async function qt(){var Y,Z;if(!D||D.dataset.loading==="true")return;if(!K()){B("Apicurio integration is off. Enable it first.","error");return}if(!ye()){B("Enter the registry base URL and group ID before pushing.","error");return}const c=l(),f=c>=0?s[c]:null;if(!f||!f.apicurioVersions||f.apicurioVersions.length<2){B("Series push requires a model with multiple versions.","error");return}const C=tt(f,{seriesName:f.title||f.apicurioArtifactName||w(f)});if(!C){B("Active series needs an id before pushing.","error");return}typeof y=="function"&&y(f,{seriesName:f.title||f.apicurioArtifactName||w(f)});const E=ge(T.baseUrl),m=T.groupId.trim(),N=f.apicurioVersions.map(Ee=>Ee.data),V=JSON.stringify(N,null,2),O=R(),re=de(m);D.dataset.loading="true",D.textContent="Pushing…",D.disabled=!0,B("Pushing series to Apicurio…","muted");try{const Ee=await Wn(E,re,C,O),Ue=F(N);if(Ee)try{const Et=await Ot(E,re,C),{data:an,fingerprint:cn}=await at(E,re,C,Et);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",Et),console.log("local fingerprint",Ue),console.log("registry fingerprint",cn),console.log("local payload (series)",N),console.log("registry payload",an),console.groupEnd(),Ue&&cn&&Ue===cn){if(!window.confirm("The current registry version matches this series. Push anyway?")){B("Series push cancelled (content matches latest).","muted");return}B("Pushing identical series by user choice.","muted")}else cn?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):B("Unable to compare with registry content (skipping confirmation).","muted")}catch(Et){console.warn("[Blockscape] unable to compare registry content before series push",Et),B("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const se=T.useSemver?await gt(E,re,C,Ee):null;if(T.useSemver&&!se)throw new Error("Semantic versioning is enabled but no version could be computed.");const Ye=encodeURIComponent(re),ut=encodeURIComponent(C),qe=Ee?`${E}/groups/${Ye}/artifacts/${ut}/versions`:`${E}/groups/${Ye}/artifacts`,ue={...O,"Content-Type":"application/json"};se&&(ue["X-Registry-Version"]=se,B(`Pushing series to Apicurio as version ${se}…`,"muted"));const He=Ee?Je(V,{version:se}):ie(C,V,{title:f.apicurioArtifactName||((Y=f.data)==null?void 0:Y.title)||C,description:(Z=f.data)==null?void 0:Z.abstract,version:se}),nt=await fetch(qe,{method:"POST",headers:ue,body:JSON.stringify(He)});if(!nt.ok){let Et=nt.statusText||"Unknown error";try{const an=await nt.text();an&&(Et=an.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${nt.status}): ${Et}`)}let xe=null;try{xe=await nt.json()}catch{xe=null}const Ze=(xe==null?void 0:xe.version)||(xe==null?void 0:xe.globalId)||"",Fe=Ee?"Updated":"Created",it=Ze?` (version ${Ze})`:"";B(`${Fe} ${C} series${it}`,"success")}catch(Ee){console.error("[Blockscape] Apicurio series push failed",Ee),B(`Apicurio series push failed: ${Ee.message}`,"error")}finally{D.dataset.loading="false",je()}}async function Gn(){if(!j||j.dataset.loading==="true")return;if(!K()){B("Enable Apicurio integration to list artifacts.","error");return}if(!ye()){B("Enter registry base URL and group ID before listing.","error");return}const c=ge(T.baseUrl),f=T.groupId.trim(),C=de(f),E=[{groupId:f,label:"base"},{groupId:C,label:"series"}];j.dataset.loading="true",j.textContent="Listing…",j.disabled=!0,B("Listing artifacts…","muted"),be("Contacting registry…");try{const m=R();m.Accept="application/json";const N=[];for(const O of E){const re=encodeURIComponent(O.groupId),Y=`${c}/groups/${re}/artifacts?limit=50&offset=0`,Z=await fetch(Y,{method:"GET",headers:m});if(!Z.ok){let se=Z.statusText||"Unknown error";try{const Ye=await Z.text();Ye&&(se=Ye.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${O.groupId} (${Z.status}): ${se}`);continue}const Ee=await Z.json(),Ue=Ce(Ee).filter(se=>se&&se.artifactId);Ue.forEach(se=>{se&&(se._groupId=O.groupId)}),N.push(...Ue)}le.clear(),Q.clear(),N.forEach(O=>{O!=null&&O.artifactId&&le.set(O.artifactId,O)}),Jt(N);const V=N.length;B(V?`Found ${V} artifact${V===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",V?"success":"muted")}catch(m){console.error("[Blockscape] failed to list artifacts",m),ze("Unable to list artifacts."),B(`Listing failed: ${m.message}`,"error")}finally{j.dataset.loading="false",je()}}async function zn(c,f=null){var Ee,Ue,se,Ye,ut,qe;if(!c)return;if(!K()){B("Enable Apicurio integration to load artifacts.","error");return}if(!ye()){B("Enter registry connection details before loading artifacts.","error");return}const C=ge(T.baseUrl),E=T.groupId.trim(),m=c&&((Ee=le.get(c))==null?void 0:Ee._groupId)||E;let N=le.get(c);const V=async()=>{try{const ue=await De(C,m,c);return ue!=null&&ue.artifactId&&le.set(c,ue),ue}catch(ue){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",ue),ue}};if(!N)try{N=await V()}catch(ue){B(`Failed to fetch artifact metadata: ${ue.message}`,"error");return}const O=Q.get(c)||[];let re="latest",Y="latest";if(f)re=f,Y=f;else{if(!N||N.version==null)try{N=await V()}catch(ue){B(`Failed to fetch artifact metadata: ${ue.message}`,"error");return}re=(N==null?void 0:N.version)||"latest",Y=(N==null?void 0:N.version)||"latest"}const Z=O.find(ue=>String(ue.version)===String(re));(Z==null?void 0:Z.version)!=null&&(Y=Z.version),B(`Loading artifact ${c}…`,"muted");try{const ue=await ht(C,m,c,re),He=le.get(c)||N||{},nt=Array.isArray(ue);let xe=null;if(nt){const Ze=ue.map((it,Et)=>(S(it,{titleHint:He.name||c,idHint:c}),{version:String(Et+1),data:it,createdOn:(Z==null?void 0:Z.createdOn)||He.createdOn}));xe={id:z(),title:((se=(Ue=Ze[0])==null?void 0:Ue.data)==null?void 0:se.title)||He.name||c,data:(Ye=Ze[0])==null?void 0:Ye.data,apicurioArtifactId:c,apicurioArtifactName:He.name||"",apicurioVersions:Ze,apicurioActiveVersionIndex:0,isSeries:!0};const Fe=((ut=He==null?void 0:He.properties)==null?void 0:ut.seriesId)||c;typeof y=="function"&&y(xe,{seriesName:Fe,fallbackTitle:Fe}),B(`Loaded series artifact ${c}.`,"success")}else{S(ue,{titleHint:He.name||c,idHint:c});const Ze={version:Y,data:ue,createdOn:(Z==null?void 0:Z.createdOn)||He.createdOn};xe={id:z(),title:ue.title||He.name||c,data:ue,apicurioArtifactId:c,apicurioArtifactName:He.name||"",apicurioVersions:[Ze],apicurioActiveVersionIndex:0};const Fe=(qe=He==null?void 0:He.properties)==null?void 0:qe.seriesId;Fe&&typeof y=="function"&&y(xe,{seriesName:Fe,fallbackTitle:Fe});const it=Y?` (version ${Y})`:"";B(`Loaded artifact ${c}${it}.`,"success")}pi(c,xe)}catch(ue){console.error("[Blockscape] failed to load artifact",ue),B(`Failed to load artifact: ${ue.message}`,"error")}}async function Kn(c){}return{hydrateConfig:ve,mount:rn,updateAvailability:je,isEnabled:K,setEnabled:bt,onEnabledChange:Xe}}function wn(s,l){if(typeof s!="function")throw new Error(`[itemEditor] expected ${l} to be a function`)}function ua(s,{excludeId:l}={}){if(!s)return[];const u=s.split(/[\s,]+/).map(y=>y.trim()).filter(Boolean),S=[];return u.forEach(y=>{l&&y===l||S.includes(y)||S.push(y)}),S}function pa(s,l,u){if(!l||!u||l===u)return;((s==null?void 0:s.categories)||[]).forEach(y=>{(y.items||[]).forEach(P=>{Array.isArray(P.deps)&&(P.deps=P.deps.map(L=>L===l?u:L))})}),Array.isArray(s==null?void 0:s.links)&&s.links.forEach(y=>{y.from===l&&(y.from=u),y.to===l&&(y.to=u)})}function fa({findItemAndCategoryById:s,collectAllItemIds:l,updateItemReferences:u,loadActiveIntoEditor:S,rebuildFromActive:y,select:P,onSelectionRenamed:L}={}){wn(s,"findItemAndCategoryById"),wn(l,"collectAllItemIds"),wn(u,"updateItemReferences"),wn(S,"loadActiveIntoEditor"),wn(y,"rebuildFromActive"),wn(P,"select");const w={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function F(H){if(w.fields.errorEl){if(!H){w.fields.errorEl.hidden=!0,w.fields.errorEl.textContent="";return}w.fields.errorEl.hidden=!1,w.fields.errorEl.textContent=H}}function z(){w.wrapper&&(w.wrapper.hidden=!0,w.wrapper.setAttribute("aria-hidden","true"),F(""),w.categoryId=null,w.itemId=null,w.modelData=null,document.body.classList.remove("item-editor-open"))}function ce(){w.wrapper&&(w.wrapper.hidden=!1,w.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var H,J;(H=w.fields.nameInput)==null||H.focus(),(J=w.fields.nameInput)==null||J.select()}))}function j(H){var ge;if(!w.modelData||!w.categoryId||!w.itemId)throw new Error("No item loaded.");const X=(((ge=w.modelData)==null?void 0:ge.categories)||[]).find(de=>de.id===w.categoryId);if(!X)throw new Error("Category not found.");X.items=X.items||[];const D=X.items.find(de=>de.id===w.itemId);if(!D)throw new Error("Item not found.");const W=(H.id||"").trim();if(!W)throw new Error("ID is required.");const ke=l(w.modelData);if(W!==D.id&&ke.has(W))throw new Error("Another item already uses that ID.");D.id=W;const T=(H.name||"").trim();D.name=T||D.id;const le=(H.logo||"").trim();if(le?D.logo=le:delete D.logo,H.externalFlag&&!H.external)D.external=!0;else{const de=(H.external??"").toString().trim();de?D.external=de:delete D.external}const Q=(H.color||"").trim();return Q?D.color=Q:delete D.color,D.deps=Array.isArray(H.deps)?H.deps:[],D.id!==H.originalId&&typeof L=="function"&&L(H.originalId,D.id),u(w.modelData,H.originalId,D.id),S(),y(),P(D.id),D.id}function fe(){if(!w.fields||!w.fields.idInput)return!1;const H=(w.fields.idInput.value||"").trim(),J={originalId:w.itemId,id:H,name:w.fields.nameInput.value||"",logo:w.fields.logoInput.value||"",external:w.fields.externalInput.value||"",externalFlag:w.fields.externalFlagInput.checked,color:w.fields.colorInput.value||"",deps:ua(w.fields.depsInput.value,{excludeId:H})};try{return j(J),z(),!0}catch(X){return console.warn("[itemEditor] item edit failed",X),F((X==null?void 0:X.message)||"Unable to save item."),!1}}function he(){if(w.wrapper)return w.wrapper;const H=document.createElement("div");H.className="item-editor-modal",H.hidden=!0,H.setAttribute("role","dialog"),H.setAttribute("aria-modal","true");const J=document.createElement("div");J.className="item-editor-modal__backdrop",H.appendChild(J);const X=document.createElement("div");X.className="item-editor",H.appendChild(X);const D=document.createElement("div");D.className="item-editor__header";const W=document.createElement("h2");W.className="item-editor__title",W.textContent="Edit item";const ke=document.createElement("button");ke.type="button",ke.className="item-editor__close",ke.setAttribute("aria-label","Close item editor"),ke.textContent="×",D.appendChild(W),D.appendChild(ke),X.appendChild(D);const T=document.createElement("form");T.className="item-editor__form",X.appendChild(T);const le=document.createElement("div");le.className="item-editor__meta",le.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',T.appendChild(le);const Q=document.createElement("div");Q.className="item-editor__error",Q.hidden=!0,T.appendChild(Q);const ge=(ie,Je,M)=>{const oe=document.createElement("label");oe.className="item-editor__field";const Ie=document.createElement("span");if(Ie.className="item-editor__label",Ie.textContent=ie,oe.appendChild(Ie),Je.classList.add("item-editor__control"),oe.appendChild(Je),M){const me=document.createElement("div");me.className="item-editor__hint",me.textContent=M,oe.appendChild(me)}return oe},de=document.createElement("input");de.type="text",de.required=!0,T.appendChild(ge("ID",de,"Unique identifier used for links and dependencies."));const ye=document.createElement("input");ye.type="text",T.appendChild(ge("Name",ye,"Visible label shown on the tile."));const K=document.createElement("input");K.type="url",K.inputMode="url",K.placeholder="https://…",T.appendChild(ge("Logo URL",K,"Optional image URL."));const Ve=document.createElement("input");Ve.type="url",Ve.inputMode="url",Ve.placeholder="https://…",T.appendChild(ge("External link",Ve,"Shown with ↗ icon and in preview."));const Xe=document.createElement("div");Xe.className="item-editor__checkbox";const _e=document.createElement("label");_e.className="item-editor__checkbox-row";const B=document.createElement("input");B.type="checkbox";const be=document.createElement("span");be.textContent="Mark as external without link";const ze=document.createElement("div");ze.className="item-editor__hint",ze.textContent="Keeps dashed border even without a URL.",_e.appendChild(B),_e.appendChild(be),Xe.appendChild(_e),Xe.appendChild(ze),T.appendChild(Xe);const je=document.createElement("input");je.type="text",je.placeholder="#2563eb",T.appendChild(ge("Color",je,"Optional badge color (hex or CSS color)."));const I=document.createElement("textarea");I.rows=2,I.placeholder="Comma or space separated ids",T.appendChild(ge("Dependencies",I,"Use item IDs, separated by commas or spaces."));const v=document.createElement("div");v.className="item-editor__actions";const ve=document.createElement("button");ve.type="button",ve.className="pf-v5-c-button pf-m-tertiary",ve.textContent="Cancel";const R=document.createElement("button");return R.type="submit",R.className="pf-v5-c-button pf-m-primary",R.textContent="Save",v.appendChild(ve),v.appendChild(R),T.appendChild(v),w.wrapper=H,w.fields={idInput:de,nameInput:ye,logoInput:K,externalInput:Ve,externalFlagInput:B,colorInput:je,depsInput:I,categoryValue:le.querySelector(".item-editor__meta-value"),errorEl:Q},ve.addEventListener("click",z),ke.addEventListener("click",z),J.addEventListener("click",z),T.addEventListener("submit",ie=>{ie.preventDefault(),fe()}),document.addEventListener("keydown",ie=>{ie.key==="Escape"&&!H.hidden&&(ie.preventDefault(),ie.stopPropagation(),z())}),document.body.appendChild(H),H}function Re(H){const J=s(H);return J?(he(),w.categoryId=J.category.id,w.itemId=J.item.id,w.modelData=J.modelData,w.fields.categoryValue.textContent=J.category.title||J.category.id,w.fields.idInput.value=J.item.id||"",w.fields.nameInput.value=J.item.name||"",w.fields.logoInput.value=J.item.logo||"",w.fields.externalInput.value=typeof J.item.external=="string"?J.item.external:"",w.fields.externalFlagInput.checked=J.item.external===!0,w.fields.colorInput.value=J.item.color||"",w.fields.depsInput.value=Array.isArray(J.item.deps)?J.item.deps.join(", "):"",F(""),P(J.item.id),ce(),!0):!1}return{open:Re,hide:z,isOpen:()=>!!w.wrapper&&!w.wrapper.hidden}}function Ko(s,l="series"){return(s||l).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||l}function Fn(s,l="series"){const u=Ko(s,l).replace(/\./g,"-");return u.replace(/-series$/i,"").replace(/-+$/,"")||u||Ko(l,"series")}function ir(s,{seriesName:l,fallbackTitle:u="unknown"}={}){var w,F;const y=[s==null?void 0:s.seriesId,(w=s==null?void 0:s.data)==null?void 0:w.seriesId,s==null?void 0:s.apicurioArtifactId,l,s==null?void 0:s.title,s==null?void 0:s.apicurioArtifactName,(F=s==null?void 0:s.data)==null?void 0:F.title,u].map(z=>(z??"").toString().trim()),P=y.findIndex(Boolean),L=P!==-1?y[P]:"";return L?(console.log("[Series] deriveSeriesId: picked base",{base:L,sourceIndex:P,candidates:y}),Fn(L,u)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:u}),null)}function mt(s,{seriesName:l,fallbackTitle:u="unknown"}={}){if(!s||typeof s!="object")return null;const S=ir(s,{seriesName:l,fallbackTitle:u});return S?(s.seriesId=S,s.apicurioArtifactId||(s.apicurioArtifactId=S),S):null}function Hn(s,l={}){var y,P;if(!s)return null;const u=s.isSeries||((y=s.apicurioVersions)==null?void 0:y.length)>1||s.seriesId||((P=s.data)==null?void 0:P.seriesId)||s.apicurioArtifactId;if(!u&&!l.force)return null;const S=ir(s,l);return S||(u?Fn(l.fallbackTitle||"unknown"):null)}const di=typeof import.meta<"u"&&"./"||"";function ma(){console.log("[Blockscape] init");const s=document.getElementById("jsonBox"),l=document.querySelector(".blockscape-json-panel"),u=document.getElementById("app"),S=document.getElementById("overlay"),y=document.getElementById("tabTooltip"),P=document.getElementById("modelList"),L=document.getElementById("itemPreview"),w=document.getElementById("urlForm"),F=document.getElementById("urlInput"),z=document.getElementById("loadUrl"),ce=L.querySelector(".item-preview__title"),j=L.querySelector(".item-preview__body"),fe=L.querySelector(".item-preview__actions"),he=L.querySelector(".item-preview__close"),Re=document.getElementById("downloadJson"),H=document.getElementById("shareModel"),J=document.getElementById("createVersion"),X=document.getElementById("openInEditor"),D=document.getElementById("copyJson"),W=document.getElementById("copySeries"),ke=document.getElementById("pasteJson"),T=document.getElementById("helpButton"),le=document.getElementById("newPanelButton"),Q=document.getElementById("shortcutHelp"),ge=document.getElementById("shortcutHelpList"),de=document.getElementById("shortcutHelpClose"),ye=document.getElementById("shortcutHelpBackdrop"),K=document.getElementById("newPanel"),Ve=document.getElementById("newPanelClose"),Xe=document.getElementById("newPanelBackdrop"),_e=document.getElementById("search"),B=document.getElementById("searchResults"),be="blockscape:editorPayload",ze="blockscape:editorTransfer",je=document.title;s.value=document.getElementById("seed").textContent.trim();let I=[],v=-1;const ve=da({models:I,getActiveIndex:()=>v,setActive:ct,ensureModelMetadata:Gt,getModelId:Qe,getSeriesId:Hn,ensureSeriesId:mt,getModelTitle:Te,computeJsonFingerprint:Xn,uid:it});let R=null,ie=new Map,Je=new Map,M=null,oe=null,Ie=null,me=null,tt=!0,Ce=!1,Le=0,ee={x:0,y:0},We="map",De=null,st=null,ht=!1,at=null;const Ot=2e3;let gt=null,te=null,we=null,bt=null,Ut=null,nn=null,Pt=null,on="",rn=!1,Jt=null,sn=null,Lt=null,Wt=[],Cn=null;const pi=30,Wn=1e3,qn="blockscape:hoverScale",qt=1.5,Gn=1,zn=2.5,Kn="blockscape:titleWrap",c="blockscape:titleHoverWidth",f="blockscape:titleHoverTextPortion",C="wrap",E=1.3,m=1,N=1.6,V=.25,O=0,re=.6,Y="blockscape:tileCompactness",Z=1,Ee=.75,Ue=1.25;let se=qt,Ye=Z,ut=C,qe=E,ue=V;const He="blockscape:seriesNavDoubleClickMs",nt=900,xe=300,Ze=4e3;let Fe=nt;ve.hydrateConfig(),ur(),fr(),wr(),hr(),br(),_r(),ot();function it(){return Math.random().toString(36).slice(2,10)}function Et(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function an(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function cn(e){return Et(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function no(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),an(t)}function or(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}async function io(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function rr(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function In(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function sr(e){return Number.isFinite(e)?Math.min(zn,Math.max(Gn,e)):qt}function ot(){if(!u)return;const e=!!M||!!oe;u.classList.toggle("blockscape-has-selection",e)}function Sn(e){return se=sr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-scale",se),se}function ar(e){return Number.isFinite(e)?Math.min(Ue,Math.max(Ee,e)):Z}function kn(e){return Ye=ar(e),document.documentElement.style.setProperty("--blockscape-tile-compactness",Ye),Ye}function cr(e){return Number.isFinite(e)?Math.min(N,Math.max(m,e)):E}function xn(e){return qe=cr(e),document.documentElement.style.setProperty("--blockscape-title-hover-width-multiplier",qe),qe}function lr(e){return Number.isFinite(e)?Math.min(re,Math.max(O,e)):V}function An(e){return ue=lr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-text-portion",ue),ue}function Nn(e){const t=e==="nowrap"?"nowrap":"wrap";ut=t;const n=t==="nowrap"?"nowrap":"normal",i=t==="nowrap"?"nowrap":"normal";return document.documentElement.style.setProperty("--blockscape-title-white-space",n),document.documentElement.style.setProperty("--blockscape-title-text-wrap",i),t}function dr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(qn,String(e))}catch(t){console.warn("[Blockscape] failed to persist hover scale",t)}}function ur(){if(typeof window>"u"||!window.localStorage)return Sn(qt);try{const e=window.localStorage.getItem(qn);if(!e)return Sn(qt);const t=parseFloat(e);return Sn(t)}catch(e){return console.warn("[Blockscape] failed to read hover scale",e),Sn(qt)}}function pr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Y,String(e))}catch(t){console.warn("[Blockscape] failed to persist tile compactness",t)}}function fr(){if(typeof window>"u"||!window.localStorage)return kn(Z);try{const e=window.localStorage.getItem(Y);if(!e)return kn(Z);const t=parseFloat(e);return kn(t)}catch(e){return console.warn("[Blockscape] failed to read tile compactness",e),kn(Z)}}function mr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(c,String(e))}catch(t){console.warn("[Blockscape] failed to persist title hover width",t)}}function hr(){if(typeof window>"u"||!window.localStorage)return xn(E);try{const e=window.localStorage.getItem(c);if(!e)return xn(E);const t=parseFloat(e);return xn(t)}catch(e){return console.warn("[Blockscape] failed to read title hover width",e),xn(E)}}function gr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(f,String(e))}catch(t){console.warn("[Blockscape] failed to persist title text zoom",t)}}function br(){if(typeof window>"u"||!window.localStorage)return An(V);try{const e=window.localStorage.getItem(f);if(!e)return An(V);const t=parseFloat(e);return An(t)}catch(e){return console.warn("[Blockscape] failed to read title text zoom",e),An(V)}}function vr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Kn,e)}catch(t){console.warn("[Blockscape] failed to persist title wrap mode",t)}}function wr(){if(typeof window>"u"||!window.localStorage)return Nn(C);try{const e=window.localStorage.getItem(Kn);return Nn(e||C)}catch(e){return console.warn("[Blockscape] failed to read title wrap mode",e),Nn(C)}}function yr(e){return Number.isFinite(e)?Math.min(Ze,Math.max(xe,e)):nt}function Ln(e){return Fe=yr(e),Fe}function Er(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(He,String(e))}catch(t){console.warn("[Blockscape] failed to persist series double-click wait",t)}}function _r(){if(typeof window>"u"||!window.localStorage)return Ln(nt);try{const e=window.localStorage.getItem(He);if(!e)return Ln(nt);const t=parseInt(e,10);return Ln(t)}catch(e){return console.warn("[Blockscape] failed to read series double-click wait",e),Ln(nt)}}function Cr(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function Ir(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(r=>r&&typeof r=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function fi(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t)}function mi(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>mi(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${mi(e[i])}`).join(",")}}`}function oo(e){try{return mi(e)}catch{return""}}function Xn(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=oo(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=oo(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const Sr=[{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Move up/down through items, pausing on category headers before entering the next category at the same relative position."},{keys:[["Cmd/Ctrl","Arrow Up"],["Cmd/Ctrl","Arrow Down"]],description:"Reorder the selected category (or the category that holds the selected item)."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Cmd/Ctrl","Arrow Left"],["Cmd/Ctrl","Arrow Right"]],description:"Switch to the previous or next map when viewing a series."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile or category."},{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["F2"]],description:"Edit the selected item; when a category (not an item) is selected, open the category editor."},{keys:[["Delete"]],description:"Delete the selected item or category (use Cmd/Ctrl+Z to undo)."},{keys:[["Insert"]],description:"Add a new category at the bottom of the map."},{keys:[["Escape"]],description:"Unselect item or close the open preview popover."}];function Gt(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const r=n||e.title||t||"model",a=In(r).replace(/\./g,"-");e.id=a||`model-${it()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function kr(e){return JSON.parse(JSON.stringify(e))}function Te(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function ro(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const o=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(o)return o;const r=Qe(e);return r?`${r} series`:t}return Te(e,t)}function Qe(e){var o;const t=Hn(e);if(t)return t;const n=(o=e==null?void 0:e.data)==null?void 0:o.id;return n&&n.toString().trim()||null}function so(e){var d;if(e<0||e>=I.length||!s)return!0;const t=I[e],n=(s.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}Gt(i,{titleHint:Te(t),idHint:Qe(t)});const o=Xn(t.data),r=Xn(i);if(o===r)return!0;t.data=i;const a=Yt(t);return a>=0&&((d=t.apicurioVersions)!=null&&d[a])&&(t.apicurioVersions[a].data=i),!0}function ao(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function xr(e){if(v<0||!e)return null;const t=I[v].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const r=(i.items||[]).find(a=>a.id===e);if(r)return{category:i,item:r,modelData:t}}return null}function Ar(e,t){const n=ao(t);let i=In(e||"item");if(!n.has(i))return i;const o=()=>it().slice(0,4);for(;n.has(i);)i=`${In(e||"item")}-${o()}`;return i}function Nr(e="category",t){const n=(t==null?void 0:t.categories)||[],i=In(e||"category"),o=d=>n.some(p=>p.id===d);let r=i||`category-${it()}`;if(!o(r))return r;let a=n.length+1;for(;o(`${i}-${a}`);)a+=1;return`${i}-${a}`}const zt=fa({findItemAndCategoryById:xr,collectAllItemIds:ao,updateItemReferences:pa,loadActiveIntoEditor:pt,rebuildFromActive:dt,select:e=>lt(e),onSelectionRenamed:(e,t)=>{var n;M===e&&(M=t,ot()),((n=De==null?void 0:De.item)==null?void 0:n.id)===e&&(De.item.id=t)}});function Lr({getActiveModelData:e,loadActiveIntoEditor:t,rebuildFromActive:n,selectCategory:i,onCategoryRenamed:o}){const r={wrapper:null,fields:{},categoryId:null,modelData:null},a=k=>{if(r.fields.errorEl){if(!k){r.fields.errorEl.hidden=!0,r.fields.errorEl.textContent="";return}r.fields.errorEl.hidden=!1,r.fields.errorEl.textContent=k}},d=()=>{r.wrapper&&(r.wrapper.hidden=!0,r.wrapper.setAttribute("aria-hidden","true"),a(""),r.categoryId=null,r.modelData=null,document.body.classList.remove("category-editor-open"))},p=()=>{r.wrapper&&(r.wrapper.hidden=!1,r.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("category-editor-open"),requestAnimationFrame(()=>{var k,q;(k=r.fields.titleInput)==null||k.focus(),(q=r.fields.titleInput)==null||q.select()}))},h=()=>{if(!r.modelData||!r.categoryId)throw new Error("No category loaded.");const k=r.modelData.categories||[],q=k.find(Ae=>Ae.id===r.categoryId);if(!q)throw new Error("Category not found.");const pe=(r.fields.idInput.value||"").trim();if(!pe)throw new Error("ID is required.");const $e=(r.fields.titleInput.value||"").trim();if(k.some(Ae=>Ae.id===pe&&Ae.id!==q.id))throw new Error("Another category already uses that ID.");const Se=q.id;return q.id=pe,q.title=$e||q.id,Se!==pe&&typeof o=="function"&&o(Se,pe),t(),n(),i(pe,{scrollIntoView:!0}),!0},g=()=>{try{return h(),d(),!0}catch(k){return console.warn("[CategoryEditor] save failed",k),a((k==null?void 0:k.message)||"Unable to save category."),!1}},$=()=>{if(r.wrapper)return r.wrapper;const k=document.createElement("div");k.className="item-editor-modal category-editor-modal",k.hidden=!0,k.setAttribute("role","dialog"),k.setAttribute("aria-modal","true");const q=document.createElement("div");q.className="item-editor-modal__backdrop",k.appendChild(q);const pe=document.createElement("div");pe.className="item-editor",k.appendChild(pe);const $e=document.createElement("div");$e.className="item-editor__header";const Be=document.createElement("h2");Be.className="item-editor__title",Be.textContent="Edit category";const Se=document.createElement("button");Se.type="button",Se.className="item-editor__close",Se.setAttribute("aria-label","Close category editor"),Se.textContent="×",$e.appendChild(Be),$e.appendChild(Se),pe.appendChild($e);const Ae=document.createElement("form");Ae.className="item-editor__form",pe.appendChild(Ae);const _t=document.createElement("div");_t.className="item-editor__meta",_t.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',Ae.appendChild(_t);const Me=document.createElement("div");Me.className="item-editor__error",Me.hidden=!0,Ae.appendChild(Me);const Oe=(wt,rt,gn)=>{const Bt=document.createElement("label");Bt.className="item-editor__field";const Pn=document.createElement("span");if(Pn.className="item-editor__label",Pn.textContent=wt,Bt.appendChild(Pn),rt.classList.add("item-editor__control"),Bt.appendChild(rt),gn){const Rn=document.createElement("div");Rn.className="item-editor__hint",Rn.textContent=gn,Bt.appendChild(Rn)}return Bt},Ct=document.createElement("input");Ct.type="text",Ae.appendChild(Oe("Title",Ct,"Display label shown in the map."));const Zt=document.createElement("input");Zt.type="text",Zt.required=!0,Ae.appendChild(Oe("ID",Zt,"Unique identifier for this category (used in URLs and references)."));const Ft=document.createElement("div");Ft.className="item-editor__actions";const It=document.createElement("button");It.type="submit",It.className="item-editor__action item-editor__action--primary",It.textContent="Save";const $t=document.createElement("button");return $t.type="button",$t.className="item-editor__action",$t.textContent="Cancel",Ft.appendChild(It),Ft.appendChild($t),Ae.appendChild(Ft),Ae.addEventListener("submit",wt=>{wt.preventDefault(),g()}),$t.addEventListener("click",d),Se.addEventListener("click",d),q.addEventListener("click",d),k.addEventListener("keydown",wt=>{wt.key==="Escape"&&(wt.preventDefault(),d())}),document.body.appendChild(k),r.wrapper=k,r.fields={titleInput:Ct,idInput:Zt,errorEl:Me,metaLabel:_t.querySelector(".item-editor__meta-value")},k};return{open:k=>{if(!k||!$())return!1;const pe=e(),Be=((pe==null?void 0:pe.categories)||[]).find(Se=>Se.id===k);return Be?(r.categoryId=Be.id,r.modelData=pe,r.fields.metaLabel.textContent=Be.title||Be.id||"Category",r.fields.titleInput.value=Be.title||Be.id||"",r.fields.idInput.value=Be.id||"",a(""),p(),!0):!1},hide:d,isOpen:()=>!!r.wrapper&&r.wrapper.hidden===!1}}const Tr=Lr({getActiveModelData:()=>{var e;return(e=I[v])==null?void 0:e.data},loadActiveIntoEditor:pt,rebuildFromActive:dt,selectCategory:(e,t={})=>Tt(e,t),onCategoryRenamed:(e,t)=>{oe===e&&(oe=t,ot())}});function Yn(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const i={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[i],e.apicurioActiveVersionIndex=0;const o=e.title||Te(e);return mt(e,{seriesName:o,fallbackTitle:o}),e.isSeries=!0,e}function Ht(e,{versionLabel:t,createdOn:n}={}){var p,h,g;if(e!=null&&e.isSeries||((p=e==null?void 0:e.apicurioVersions)==null?void 0:p.length)>1){const $=e.title||Te(e);mt(e,{seriesName:$,fallbackTitle:$})}const i=Qe(e);if(!i)return Yn(e,{versionLabel:t||"1",createdOn:n}),I.push(e),I.length-1;const o=I.findIndex($=>Qe($)===i);if(o===-1)return Yn(e,{versionLabel:t||"1",createdOn:n}),I.push(e),I.length-1;const r=I[o];if(!Array.isArray(r.apicurioVersions)||!r.apicurioVersions.length){r.apicurioVersions=[{version:"1",data:r.data,createdOn:(g=(h=r.apicurioVersions)==null?void 0:h[0])==null?void 0:g.createdOn}],r.apicurioActiveVersionIndex=0;const $=r.title||Te(r);mt(r,{seriesName:$,fallbackTitle:$})}const a=String(r.apicurioVersions.length+1);r.apicurioVersions.push({version:a,data:e.data,createdOn:n||new Date().toISOString()}),r.apicurioActiveVersionIndex=r.apicurioVersions.length-1,r.data=e.data,r.title=Te(e)||r.title,r.isSeries=!0;const d=r.title||Te(r);return mt(r,{seriesName:d,fallbackTitle:d}),o}function co({versionLabel:e}={}){var a;if(v<0||!I[v])throw new Error("Load or select a model before creating a version.");const t=I[v];Yn(t,{versionLabel:"1"});let n;try{n=kr(t.data)}catch(d){throw console.warn("[Blockscape] failed to clone active model for versioning",d),new Error("Could not copy the current model.")}Gt(n,{titleHint:Te(t),idHint:Qe(t)||Hn(t)});const o={version:e||String((((a=t.apicurioVersions)==null?void 0:a.length)||0)+1),data:n,createdOn:new Date().toISOString()};t.apicurioVersions.push(o),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=n,t.isSeries=!0;const r=t.title||Te(t);return mt(t,{seriesName:r,fallbackTitle:r}),v}function hi(){const e=v>=0&&I[v]?I[v]:null,t=Qe(e);document.title=t?`${t}-blockscape`:je}function gi(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||Te(e);return mt(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function $r(){const e=I[v],t=gi(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function lo(e="shortcut",t=!1){const n=s.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=I[v],o=t?gi(i):null,r=!!o,a=r?JSON.stringify(o,null,2):n,d=r&&Hn(i)||Te(i,"blockscape"),p=r?"-series":"",h=`${In(d)}${p}.json`;return or(h,a),console.log(`[Blockscape] saved JSON (${e}):`,h),!0}const Br={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function uo(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return Br[n]||"#9ca3af"}function Mr(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(p=>p+p).join(""):t,i=parseInt(n,16),o=i>>16&255,r=i>>8&255,a=i&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(r/255,2.2)+.0722*Math.pow(a/255,2.2)>.35?"#111111":"#ffffff"}function Or(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function po(){if(we)return;we=document.createElement("div"),we.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",bt=document.createElement("span"),bt.className="series-nav-notice__text",we.appendChild(e),we.appendChild(bt),document.body.appendChild(we)}function fo(){Ut&&(clearTimeout(Ut),Ut=null),we&&we.classList.remove("is-visible"),bt&&(bt.textContent="")}function ln(){gt=null,te&&(clearTimeout(te),te=null),fo()}function Pr(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function Rr(e,t,n){po(),gt={id:e,targetVersionIndex:t},te&&clearTimeout(te),te=setTimeout(()=>{te=null,ln()},Fe);const i=Pr(n,t);bi(`Click again to open ${i} in this series.`,Fe)}function bi(e,t=Ot,n=null){if(po(),bt.textContent="",bt.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener",o.textContent=n,bt.appendChild(i),bt.appendChild(o)}we.classList.add("is-visible"),Ut&&clearTimeout(Ut),Ut=setTimeout(()=>fo(),t)}function Vr(){ge&&(ge.innerHTML="",Sr.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((o,r)=>{if(r>0){const d=document.createElement("span");d.className="shortcut-help__or",d.textContent="or",n.appendChild(d)}const a=document.createElement("div");a.className="shortcut-help__combo",o.forEach((d,p)=>{if(p>0){const g=document.createElement("span");g.className="shortcut-help__sep",g.textContent="+",a.appendChild(g)}const h=document.createElement("kbd");h.className="shortcut-help__key",h.textContent=d,a.appendChild(h)}),n.appendChild(a)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),ge.appendChild(t)}),ht=!0)}function Ur(){return!!Q&&Q.hidden===!1}function Hr(){if(!Q)return;ht||Vr(),at=document.activeElement,Q.hidden=!1,Q.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Q.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function vi(){if(!Q||Q.hidden)return;Q.hidden=!0,Q.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=at;e!=null&&e.focus?e.focus({preventScroll:!0}):T!=null&&T.focus&&T.focus({preventScroll:!0})}function Dr(){if(!K)return;K.hidden=!1,K.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=K.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function wi(){!K||K.hidden||(K.hidden=!0,K.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),le!=null&&le.focus&&le.focus({preventScroll:!0}))}let yi=!1;function Tn(){yi||(yi=!0,requestAnimationFrame(()=>{yi=!1,Ci(),fn()}))}let mo=!1;function ho(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Fr(e){const t=ho(e);if(!t.length){u.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}u.querySelectorAll(".tile").forEach(n=>{var a;const i=(((a=n.querySelector(".name"))==null?void 0:a.textContent)||"").toLowerCase(),o=(n.dataset.id||"").toLowerCase(),r=t.every(d=>i.includes(d)||o.includes(d));n.style.opacity=r?"1":"0.2"})}function jr(e){const t=ho(e);if(!t.length)return[];const n=[];return I.forEach((i,o)=>{var h;const r=ro(i),a=Qe(i)||"",d=`${r} ${a}`.toLowerCase();t.every(g=>d.includes(g))&&n.push({type:"model",modelIndex:o,modelTitle:r,modelId:a}),(Array.isArray((h=i.data)==null?void 0:h.categories)?i.data.categories:[]).forEach(g=>{const $=(g.title||g.id||"").toString();(g.items||[]).forEach(A=>{const k=(A.name||A.id||"").toString(),q=`${k} ${A.id||""} ${$}`.toLowerCase();t.every(pe=>q.includes(pe))&&n.push({type:"item",modelIndex:o,modelTitle:r,modelId:a,itemId:A.id,itemName:k,categoryTitle:$})})})}),n.slice(0,pi)}function go(e){if(!B)return;B.innerHTML="";const t=(e||"").toString();if(!t.trim()){B.hidden=!0;return}if(!I.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",B.appendChild(i),B.hidden=!1;return}const n=jr(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",B.appendChild(i),B.hidden=!1;return}n.forEach(i=>{const o=document.createElement("button");o.type="button",o.className="search-result",o.dataset.modelIndex=String(i.modelIndex),i.itemId&&(o.dataset.itemId=i.itemId),i.type&&(o.dataset.type=i.type),i.modelIndex===v&&(!i.itemId||M===i.itemId)&&o.classList.add("is-active");const r=document.createElement("div");r.className="search-result__primary";const a=document.createElement("span");a.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",r.appendChild(a);const d=document.createElement("span");d.className="search-result__badge",d.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",r.appendChild(d);const p=document.createElement("div");p.className="search-result__meta";const h=document.createElement("span");if(h.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,p.appendChild(h),i.type==="item"&&i.itemId){const g=document.createElement("span");g.textContent=`Item ID: ${i.itemId}`,p.appendChild(g)}else if(i.type==="model"){const g=document.createElement("span");g.textContent="Matches model title",p.appendChild(g)}o.appendChild(r),o.appendChild(p),B.appendChild(o)}),B.hidden=!1}function bo(e){Fr(e||""),go(e||"")}function Jr(e){!e||!Number.isInteger(e.modelIndex)||(ct(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(v!==e.modelIndex)return;const t=(n=ie.get(e.itemId))==null?void 0:n.el;t&&(lt(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function ct(e){if(vt(),ln(),De=null,st=null,oe=null,me=null,e<0||e>=I.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}rn=!0,v=e,console.log("[Blockscape] active model:",Te(I[e]),"(index",e+" )"),hi(),dn(),pt(),dt(),_e&&bo(_e.value||""),ve.updateAvailability()}function dn(){if(P.innerHTML="",!I.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",P.appendChild(e);return}I.forEach((e,t)=>{var $;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===v?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===v?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const r=document.createElement("span");r.className="model-nav-title",r.textContent=ro(e),o.appendChild(r);const a=Qe(e);if(a){const A=document.createElement("span");A.className="model-nav-id",A.textContent=a,o.appendChild(A)}const d=Array.isArray(($=e.data)==null?void 0:$.categories)?e.data.categories:[],p=d.reduce((A,k)=>A+(k.items||[]).length,0),h=document.createElement("span");h.className="model-nav-meta";const g=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} versions`:"";h.textContent=`${d.length} cat · ${p} items${g}`,i.appendChild(o),i.appendChild(h),n.appendChild(i),P.appendChild(n)}),ve.updateAvailability()}function pt(){if(v<0){s.value="",W&&(W.disabled=!0);return}const e=I[v];s.value=JSON.stringify(e.data,null,2),W&&(W.disabled=!gi(e))}function Wr(e){try{return JSON.parse(e)}catch{return null}}function qr(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const o=i.map((g,$)=>!g||typeof g!="object"?null:(Gt(g,{titleHint:`${t} #${$+1}`}),{obj:g,idx:$})).filter(Boolean);if(!o.length)return[];const r=o[0].obj,{seriesTitleOverride:a}=n;let d=a||r.title||`${t} series`;a&&!r.title&&(r.title=a);const p={id:it(),title:d,data:r,apicurioVersions:o.map(({obj:g,idx:$})=>({version:String($+1),data:g})),apicurioActiveVersionIndex:0,isSeries:!0},h=mt(p,{seriesName:d,fallbackTitle:d});return h&&(p.id=h),[p]}function vo(e,t="Pasted",n={}){return Array.isArray(e)?qr(e,t,n):!e||typeof e!="object"?[]:(Gt(e,{titleHint:`${t} #1`}),[{id:it(),title:e.title||`${t} #1`,data:e}])}function Kt(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const o=Wr(i);if(o){let a=n;if(Array.isArray(o)&&n.promptForSeriesName){const p=Ir(o,t),h=Cr(p);a={...n,promptForSeriesName:!1,seriesTitleOverride:h||p}}const d=vo(o,t,a);if(d.length)return d}return i.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,d)=>{const p=JSON.parse(a);return Gt(p,{titleHint:`${t} #${d+1}`}),{id:it(),title:p.title||`${t} #${d+1}`,data:p}})}function Gr(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function Xt(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!Gr(e)}function zr(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function wo(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(be)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(be)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(be)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=Kt(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let i=null;return n.forEach(o=>{const r=Ht(o,{versionLabel:"editor"});i==null&&(i=r)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function yo(e="storage"){const t=wo();return!t||typeof t.index!="number"?!1:(ct(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function Kr(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let i;try{const a=no(t);i=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=vo(i.data,i.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let r=null;return o.forEach(a=>{const d=a.isSeries?i.title||a.title:null,p=Ht({...a,apicurioArtifactName:d||a.apicurioArtifactName},{versionLabel:"shared"});r==null&&(r=p)}),r}async function Xr(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await ki(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function Yr(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(r=>(r.items||[]).forEach(a=>{i.add(a.id);const d=new Set(a.deps||[]);(e.links||[]).forEach(p=>{p.from===a.id&&d.add(p.to)}),t.set(a.id,d),d.forEach(p=>{n.has(p)||n.set(p,new Set),n.get(p).add(a.id)})}));const o=new Set;return n.forEach((r,a)=>{((r==null?void 0:r.size)||0)>=2&&o.add(a)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:i}}function Zr(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const o=n.getContext("2d"),r=(e||"?").charAt(0).toUpperCase(),a=uo(e,t),d=Mr(a);return o.fillStyle=a,o.beginPath(),o.arc(i/2,i/2,i/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=d,o.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(r,i/2,i/2),n.toDataURL("image/png")}function Yt(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Eo(e){const t=Yt(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Qr(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var a,d;const o=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();o&&t.set(o,i);const r=(((d=n==null?void 0:n.data)==null?void 0:d.seriesId)??"").toString().trim();r&&!t.has(r)&&t.set(r,i)}),t}const _o=new WeakMap;function es(e,t){var Be;if(!((Be=e==null?void 0:e.apicurioVersions)!=null&&Be[t]))return null;const n=e.apicurioVersions[t],i=n.data,o=Xn(i),r=_o.get(n);if(r&&r.fingerprint===o)return r.dataUrl;const a=160,d=90,p=document.createElement("canvas");p.width=a,p.height=d;const h=p.getContext("2d");h.fillStyle="#f8fafc",h.fillRect(0,0,a,d),h.strokeStyle="#e5e7eb",h.strokeRect(.5,.5,a-1,d-1);const g=Array.isArray(i==null?void 0:i.categories)?i.categories:[],$=Math.max(g.length,1),A=a/$,k=8,q=8,pe=4;g.forEach((Se,Ae)=>{const _t=Ae*A+A/2,Me=Array.isArray(Se.items)?Se.items:[],Oe=Math.max(Me.length,1);Me.forEach((Ct,Zt)=>{const Ft=k+(Zt+.5)*((d-k-q)/Oe);h.beginPath(),h.arc(_t,Ft,pe,0,Math.PI*2);const It=uo(Ct.name||Ct.id||"",Ct.color);h.fillStyle=It,h.strokeStyle="rgba(15,23,42,0.25)",h.fill(),h.stroke()})});const $e=p.toDataURL("image/png");return _o.set(n,{fingerprint:o,dataUrl:$e}),$e}function Ei(e,t){var d;if(ln(),e<0||e>=I.length)return!1;const n=I[e];if(!((d=n==null?void 0:n.apicurioVersions)!=null&&d.length)||!so(e))return!1;const o=n.apicurioVersions.length,r=(t%o+o)%o,a=n.apicurioVersions[r];return a!=null&&a.data?(n.apicurioActiveVersionIndex=r,n.data=a.data,rn=!0,M=null,Ie=null,ot(),pt(),dt(),!0):!1}function _i(e){var i;if(!e||v<0)return!1;const t=I[v];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return!1;const n=Yt(t);return n===-1?!1:Ei(v,n+e)}function ts(e,t){if(ln(),e<0||e>=I.length)return!1;const n=I[e];if(!Array.isArray(n==null?void 0:n.apicurioVersions)||n.apicurioVersions.length<=1)return alert("A series needs at least one map. Add another before removing this one."),!1;if(!so(e))return!1;const i=Math.min(Math.max(t,0),n.apicurioVersions.length-1),o=Yt(n),[r]=n.apicurioVersions.splice(i,1);if(!r)return!1;let a=o;i===o?a=Math.min(i,n.apicurioVersions.length-1):i<o&&(a=Math.max(0,o-1)),n.apicurioActiveVersionIndex=Math.max(0,a);const d=n.apicurioVersions[n.apicurioActiveVersionIndex];return n.data=(d==null?void 0:d.data)||n.data,n.isSeries=n.apicurioVersions.length>1,ct(e),!0}function ns(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||Qe(e)||"Artifact",t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const o=Yt(e),r=Eo(e)||"latest";i.textContent=`No. in series ${r} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const a=document.createElement("div");a.className="version-nav__controls";const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Previous",d.addEventListener("click",()=>_i(-1));const p=document.createElement("button");p.type="button",p.className="version-nav__button",p.textContent="Next",p.addEventListener("click",()=>_i(1)),a.appendChild(d),a.appendChild(p),t.appendChild(a);const h=document.createElement("div");h.className="version-nav__thumbs",e.apicurioVersions.forEach((A,k)=>{var _t;const q=document.createElement("button");q.type="button",q.className="version-nav__thumb",k===o&&q.classList.add("is-active");const pe=es(e,k);if(pe){const Me=document.createElement("img");Me.src=pe,Me.alt=`Version ${k+1}`,q.appendChild(Me)}const $e=document.createElement("div");$e.className="version-nav__thumb-label";const Be=document.createElement("span");Be.className="version-nav__thumb-label-text";const Se=(((_t=A==null?void 0:A.data)==null?void 0:_t.id)??(A==null?void 0:A.id)??"").toString().trim(),Ae=Se||(A!=null&&A.version?`v${A.version}`:`${k+1}`);if(Be.textContent=Ae,$e.title=Se||Ae,$e.appendChild(Be),q.appendChild($e),cs($e,Be),e.apicurioVersions.length>1){const Me=document.createElement("span");Me.className="version-nav__thumb-remove",Me.title=`Remove ${Ae} from this series`,Me.setAttribute("aria-label",`Remove ${Ae} from this series`),Me.setAttribute("role","button"),Me.tabIndex=-1,Me.textContent="×",Me.addEventListener("click",Oe=>{Oe.stopPropagation(),Oe.preventDefault(),window.confirm(`Remove ${Ae} from this series?`)&&ts(v,k)}),q.appendChild(Me)}q.addEventListener("click",()=>Ei(v,k)),ds(q,A),h.appendChild(q)});const g=document.createElement("button");g.type="button",g.className="version-nav__thumb version-nav__thumb--add",g.title="Create a new version from this map",g.addEventListener("click",()=>{try{const A=co({versionLabel:"manual"});ct(A)}catch(A){alert((A==null?void 0:A.message)||"Unable to create a new version right now.")}});const $=document.createElement("span");return $.className="version-nav__thumb-add-icon",$.textContent="+",g.appendChild($),h.appendChild(g),t.appendChild(h),t}function un(){var Uo,Ho,Do;if(!R)return;Rt(),Array.isArray(R.m.categories)||(R.m.categories=[]),console.log("[Blockscape] rendering categories=",R.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!R.m.abstract,"- value:",R.m.abstract?R.m.abstract.substring(0,50)+"...":"none"),u.innerHTML="",ie.clear(),Je.clear(),Wt=[],Yn(I[v],{versionLabel:"1"});const e=ns(I[v]);e&&u.appendChild(e),S.setAttribute("width",window.innerWidth),S.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=R.m.title&&R.m.title.trim()||Te(I[v]),t.appendChild(n),((Uo=I[v])!=null&&Uo.isSeries||(Do=(Ho=I[v])==null?void 0:Ho.apicurioVersions)!=null&&Do.length)&&mt(I[v],{seriesName:I[v].title||R.m.title||Te(I[v])});const i=Eo(I[v]),o=Hn(I[v]),r=(R.m.id??"").toString().trim(),a=document.createElement("div");a.className="blockscape-model-meta__details";const d=(_,ne)=>{if(!ne)return;const G=document.createElement("div");G.className="blockscape-model-id";const Ke=document.createElement("span");Ke.className="blockscape-model-id__label",Ke.textContent=_;const ft=document.createElement("span");ft.className="blockscape-model-id__value",ft.textContent=ne,G.append(Ke,ft),a.appendChild(G)};d("Series ID",o),d("Model ID",r),d("No. in series",i),a.childElementCount&&t.appendChild(a),u.appendChild(t);const p=document.createElement("div");p.className="blockscape-tabs";const h=document.createElement("div");h.className="blockscape-tablist",h.setAttribute("role","tablist"),p.appendChild(h);const g=document.createElement("div");g.className="blockscape-tabpanels",p.appendChild(g);const $=document.createElement("div"),A=document.createElement("div"),k=document.createElement("div"),q=document.createElement("div");let pe="";const $e=Qr(I[v]),Be=Yt(I[v]);Pt=null,on="";const Se=[{id:"map",label:"Map",panel:$},{id:"abstract",label:"Info",panel:A},{id:"source",label:"Settings",panel:k},{id:"apicurio",label:"Apicurio",panel:q}],Ae=typeof ve.isEnabled=="function"?ve.isEnabled():!1,_t=_=>{if(!S)return;const ne=_==="map";S.hidden=!ne,ne?(Ci(),fn()):S.innerHTML=""};Se.forEach((_,ne)=>{const G=document.createElement("button");G.type="button",G.id=`tab-${_.id}`,G.className="blockscape-tab"+(ne===0?" is-active":""),G.setAttribute("role","tab"),G.setAttribute("aria-controls",`panel-${_.id}`),G.setAttribute("aria-selected",ne===0?"true":"false"),G.textContent=_.label,_.id==="apicurio"&&!Ae&&(G.hidden=!0,G.tabIndex=-1,G.setAttribute("aria-hidden","true"),G.style.display="none"),_.button=G,h.appendChild(G),_.panel.id=`panel-${_.id}`,_.panel.classList.add("blockscape-tabpanel"),_.panel.setAttribute("role","tabpanel"),_.panel.setAttribute("aria-labelledby",G.id),_.panel.hidden=ne!==0,ne===0&&_.panel.classList.add("is-active"),g.appendChild(_.panel)});const Me=_=>{We=_,Se.forEach(ne=>{const G=ne.id===_;ne.button.classList.toggle("is-active",G),ne.button.setAttribute("aria-selected",G?"true":"false"),ne.panel.classList.toggle("is-active",G),ne.panel.hidden=!G}),_t(_)},Oe=Se.find(_=>_.id==="apicurio"),Ct=_=>{if(!Oe||!Oe.button||!Oe.panel)return;const ne=!!_;if(Oe.button.hidden=!ne,Oe.button.tabIndex=ne?0:-1,Oe.button.setAttribute("aria-hidden",ne?"false":"true"),Oe.button.style.display=ne?"":"none",ne){const G=We==="apicurio";Oe.button.classList.toggle("is-active",G),Oe.button.setAttribute("aria-selected",G?"true":"false"),Oe.panel.classList.toggle("is-active",G),Oe.panel.hidden=!G}else{const G=Oe.panel.classList.contains("is-active");if(Oe.button.classList.remove("is-active"),Oe.button.setAttribute("aria-selected","false"),Oe.panel.classList.remove("is-active"),Oe.panel.hidden=!0,G){const Ke=Se.find(ft=>ft.id!=="apicurio");Ke&&Me(Ke.id)}}sn&&(sn.checked=ne)};Se.forEach(_=>{_.button.addEventListener("click",()=>{Rt(),Me(_.id)}),_.id==="abstract"&&(Pt=_.button,_.button.addEventListener("mouseenter",()=>Mn(_.button,pe,{offset:12})),_.button.addEventListener("mouseleave",Rt),_.button.addEventListener("focus",()=>Mn(_.button,pe,{offset:12})),_.button.addEventListener("blur",Rt))});const Ft=(_=>{const ne=Se.find(Ke=>Ke.id===We);if(ne&&(ne.id!=="apicurio"||_))return ne.id;const G=Se.find(Ke=>Ke.id!=="apicurio"||_);return(G==null?void 0:G.id)||Se[0].id})(Ae);Me(Ft),Ct(Ae),typeof ve.onEnabledChange=="function"&&ve.onEnabledChange(Ct),u.appendChild(p);const It=document.createElement("div");It.className="blockscape-render",$.appendChild(It);const $t=document.createElement("div");if($t.className="blockscape-abstract-panel",R.m.abstract){console.log("[Blockscape] Rendering abstract content");const _=document.createElement("div");_.className="blockscape-abstract",_.innerHTML=R.m.abstract,Rs(_),$t.appendChild(_),pe=_.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const _=document.createElement("div");_.className="blockscape-abstract-placeholder",_.textContent="No abstract has been provided for this model.",$t.appendChild(_),pe=_.outerHTML}on=pe,A.appendChild($t);const wt=document.createElement("div");wt.className="blockscape-source-panel";const rt=document.createElement("div");rt.className="blockscape-settings-panel";const gn=document.createElement("p");gn.className="blockscape-settings-panel__title",gn.textContent="Feature toggles",rt.appendChild(gn);const Bt=({id:_,label:ne,hint:G,checked:Ke,className:ft="",onChange:Ne})=>{const Mt=document.createElement("label");Mt.className=["settings-toggle",ft].filter(Boolean).join(" ");const Pe=document.createElement("input");Pe.type="checkbox",Pe.id=_,Pe.checked=Ke;const yt=document.createElement("span");yt.className="settings-toggle__text";const Qt=document.createElement("span");if(Qt.className="settings-toggle__label",Qt.textContent=ne,yt.appendChild(Qt),G){const en=document.createElement("span");en.className="settings-toggle__hint",en.textContent=G,yt.appendChild(en)}return Mt.appendChild(Pe),Mt.appendChild(yt),typeof Ne=="function"&&Pe.addEventListener("change",()=>Ne(Pe.checked)),{row:Mt,input:Pe}},{row:Pn}=Bt({id:"toggleSecondaryLinks",label:"Show indirect links",checked:tt,className:"map-controls__toggle",onChange:_=>{tt=_,M?lt(M):(Si(),fn())}});rt.appendChild(Pn);const{row:Rn}=Bt({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:Ce,className:"map-controls__toggle",onChange:_=>{Ce=_,Io()}});rt.appendChild(Rn);const Bo=_=>`${(_/1e3).toFixed(1)}s`,Qn=document.createElement("label");Qn.className="settings-slider",Qn.setAttribute("for","seriesNavDoubleClickWait");const xi=document.createElement("div");xi.className="settings-slider__text";const Ai=document.createElement("span");Ai.className="settings-slider__label",Ai.textContent="Series double-click wait";const Ni=document.createElement("span");Ni.className="settings-slider__hint",Ni.textContent="Time window to double-click into another map version.",xi.append(Ai,Ni);const ei=document.createElement("span");ei.className="settings-slider__value",ei.textContent=Bo(Fe);const St=document.createElement("input");St.type="range",St.id="seriesNavDoubleClickWait",St.className="settings-slider__input",St.min=String(xe),St.max=String(Ze),St.step="50",St.value=String(Fe),St.setAttribute("aria-label","Adjust double-click wait for series navigation"),St.addEventListener("input",()=>{const _=Ln(parseInt(St.value,10));ei.textContent=Bo(_),Er(_)}),Qn.append(xi,ei,St),rt.appendChild(Qn);const Mo=_=>`${Math.round((_-1)*100)}%`,ti=document.createElement("label");ti.className="settings-slider",ti.setAttribute("for","hoverScaleSlider");const Li=document.createElement("div");Li.className="settings-slider__text";const Ti=document.createElement("span");Ti.className="settings-slider__label",Ti.textContent="Hover zoom";const $i=document.createElement("span");$i.className="settings-slider__hint",$i.textContent="Expand tiles on hover to see more detail.",Li.append(Ti,$i);const ni=document.createElement("span");ni.className="settings-slider__value",ni.textContent=Mo(se);const kt=document.createElement("input");kt.type="range",kt.id="hoverScaleSlider",kt.className="settings-slider__input",kt.min=String(Gn),kt.max=String(zn),kt.step="0.1",kt.value=String(se),kt.setAttribute("aria-label","Adjust hover zoom"),kt.addEventListener("input",()=>{const _=Sn(parseFloat(kt.value));ni.textContent=Mo(_),dr(_),M&&Tn()}),ti.append(Li,ni,kt),rt.appendChild(ti);const Oo=_=>_===1?"Default":`${Math.round(_*100)}%`,ii=document.createElement("label");ii.className="settings-slider",ii.setAttribute("for","tileCompactnessSlider");const Bi=document.createElement("div");Bi.className="settings-slider__text";const Mi=document.createElement("span");Mi.className="settings-slider__label",Mi.textContent="Tile compactness";const Oi=document.createElement("span");Oi.className="settings-slider__hint",Oi.textContent="Adjust padding, gap, and logo size for tiles.",Bi.append(Mi,Oi);const oi=document.createElement("span");oi.className="settings-slider__value",oi.textContent=Oo(Ye);const xt=document.createElement("input");xt.type="range",xt.id="tileCompactnessSlider",xt.className="settings-slider__input",xt.min=String(Ee),xt.max=String(Ue),xt.step="0.05",xt.value=String(Ye),xt.setAttribute("aria-label","Adjust tile compactness"),xt.addEventListener("input",()=>{const _=kn(parseFloat(xt.value));oi.textContent=Oo(_),pr(_),M&&Tn()}),ii.append(Bi,oi,xt),rt.appendChild(ii);const{row:Ds}=Bt({id:"titleWrapToggle",label:"Wrap titles",hint:"Allow long titles to wrap instead of truncating.",checked:ut!=="nowrap",className:"map-controls__toggle",onChange:_=>{const ne=_?"wrap":"nowrap";Nn(ne),vr(ne)}});rt.appendChild(Ds);const Po=_=>`${Math.round((_-1)*100)}% extra`,ri=document.createElement("label");ri.className="settings-slider",ri.setAttribute("for","titleHoverWidthSlider");const Pi=document.createElement("div");Pi.className="settings-slider__text";const Ri=document.createElement("span");Ri.className="settings-slider__label",Ri.textContent="Title width on hover";const Vi=document.createElement("span");Vi.className="settings-slider__hint",Vi.textContent="Give titles more room horizontally when zoomed.",Pi.append(Ri,Vi);const si=document.createElement("span");si.className="settings-slider__value",si.textContent=Po(qe);const At=document.createElement("input");At.type="range",At.id="titleHoverWidthSlider",At.className="settings-slider__input",At.min=String(m),At.max=String(N),At.step="0.05",At.value=String(qe),At.setAttribute("aria-label","Adjust title width boost on hover"),At.addEventListener("input",()=>{const _=xn(parseFloat(At.value));si.textContent=Po(_),mr(_)}),ri.append(Pi,si,At),rt.appendChild(ri);const Ro=_=>`${Math.round(_*100)}% of hover zoom`,ai=document.createElement("label");ai.className="settings-slider",ai.setAttribute("for","titleZoomPortionSlider");const Ui=document.createElement("div");Ui.className="settings-slider__text";const Hi=document.createElement("span");Hi.className="settings-slider__label",Hi.textContent="Title zoom influence";const Di=document.createElement("span");Di.className="settings-slider__hint",Di.textContent="How much the title scales relative to tile hover zoom.",Ui.append(Hi,Di);const ci=document.createElement("span");ci.className="settings-slider__value",ci.textContent=Ro(ue);const Nt=document.createElement("input");Nt.type="range",Nt.id="titleZoomPortionSlider",Nt.className="settings-slider__input",Nt.min=String(O),Nt.max=String(re),Nt.step="0.05",Nt.value=String(ue),Nt.setAttribute("aria-label","Adjust how much titles scale on hover"),Nt.addEventListener("input",()=>{const _=An(parseFloat(Nt.value));ci.textContent=Ro(_),gr(_)}),ai.append(Ui,ci,Nt),rt.appendChild(ai);const Fs=typeof ve.isEnabled=="function"?ve.isEnabled():!1,{row:js,input:Js}=Bt({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:Fs,className:"apicurio-toggle",onChange:_=>{typeof ve.setEnabled=="function"&&ve.setEnabled(_)}});if(sn=Js,rt.appendChild(js),wt.appendChild(rt),l)l.hidden=!1,l.classList.remove("pf-v5-c-page__main-section"),wt.appendChild(l);else{const _=document.createElement("p");_.className="muted",_.textContent="Source editor unavailable.",wt.appendChild(_)}k.appendChild(wt),ve.mount(q);let Vo=0;R.m.categories.forEach(_=>{const ne=document.createElement("section");ne.className="category",ne.dataset.cat=_.id;const G=document.createElement("div");G.className="cat-head",G.dataset.cat=_.id,G.tabIndex=0,G.title="Select category",G.innerHTML=`<div class="cat-title">${mn(_.title||_.id)}</div>
                          <div class="muted cat-count">${(_.items||[]).length} items</div>`,G.addEventListener("click",()=>Tt(_.id)),G.addEventListener("keydown",Ne=>{(Ne.key==="Enter"||Ne.key===" ")&&(Ne.preventDefault(),Tt(_.id))}),G.addEventListener("focus",()=>Tt(_.id,{scrollIntoView:!1})),ne.appendChild(G);const Ke=document.createElement("div");Ke.className="grid",ne.appendChild(Ke),(_.items||[]).forEach(Ne=>{Vo+=1;const Mt=ss(Ne.external),Pe=document.createElement("div");if(Pe.className=Mt.isExternal?"tile external":"tile",Pe.tabIndex=0,Pe.dataset.id=Ne.id,Pe.dataset.globalIndex=String(Vo),Mt.url&&(Pe.dataset.externalUrl=Mt.url),$e.has(Ne.id)){const Un=$e.get(Ne.id);Pe.dataset.seriesVersionIndex=String(Un),Pe.classList.add("tile--series-link");const Ws=Un===Be?"Current map in this series":`Open version ${Un+1} in this series`;Pe.title=Ws}const yt=document.createElement("img");yt.className="logo",Ne.logo?(yt.src=Ne.logo,yt.alt=Ne.name||Ne.id):(yt.alt="",yt.style.opacity=1,yt.src=Zr(Ne.name||Ne.id,Ne.color));const Qt=document.createElement("div");Qt.className="name",Qt.textContent=Ne.name||Ne.id;const en=document.createElement("div");en.className="tile-id",en.textContent=Ne.id||"";const Fi=document.createElement("div");Fi.className="badge",Fi.textContent="reused";const bn=document.createElement("button");bn.type="button",bn.className="tile-delete",bn.setAttribute("aria-label",`Delete ${Ne.name||Ne.id}`),bn.textContent="×",bn.addEventListener("click",Un=>{Un.stopPropagation(),Bs(Ne.id)}),Mt.url&&Pe.appendChild(as(Mt.url)),Pe.appendChild(bn),Pe.appendChild(yt),Pe.appendChild(Qt),Pe.appendChild(en),Pe.appendChild(Fi),Ke.appendChild(Pe),ie.set(Ne.id,{el:Pe,catId:_.id,rect:null})}),It.appendChild(ne),Je.set(_.id,{el:ne,headEl:G});const ft=document.createElement("button");ft.type="button",ft.className="tile-add",ft.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',ft.addEventListener("click",()=>Es(_.id)),Ke.appendChild(ft)});const Vn=document.createElement("button");Vn.type="button",Vn.className="category-add",Vn.innerHTML='<span class="category-add__icon" aria-hidden="true">+</span><span class="category-add__label">Add category</span><span class="category-add__hint">(Insert)</span>',Vn.addEventListener("click",()=>No()),It.appendChild(Vn),Io(),is(),Ci(),fn(),pn(),us()}function is(){u.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",n=>{var g;if(typeof n.button=="number"&&n.button!==0)return;vt();const i=e.dataset.id,o=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,r=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,a=I[v],d=a?Yt(a):-1,p=((g=a==null?void 0:a.apicurioVersions)==null?void 0:g.length)>1&&Number.isInteger(o)&&o!==d,h=gt&&gt.id===i&&gt.targetVersionIndex===o;if(gt&&!h&&ln(),p)if(h){if(ln(),Ei(v,o))return}else Rr(i,o,a);else Number.isInteger(r)&&r>0&&r%5===0&&bi("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",i),M===i&&!(p&&h)){Bn();return}lt(i)}),e.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())});const t=()=>{M&&Tn()};e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",t),e.addEventListener("focus",t),e.addEventListener("blur",t),e.draggable=!0,e.addEventListener("dragstart",hs),e.addEventListener("dragend",gs)}),u.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",bs),e.addEventListener("drop",ys),e.addEventListener("dragenter",vs),e.addEventListener("dragleave",ws)}),mo||(mo=!0,window.addEventListener("resize",Tn),window.addEventListener("scroll",Tn,{passive:!0}),window.addEventListener("resize",ko)),document.getElementById("clear").onclick=()=>Bn()}function Ci(){ie.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function Co(e,{includeSecondary:t=tt}={}){if(!e||!R)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(R.fwd.get(e)||[]),i=new Set(R.rev.get(e)||[]),o=new Set,r=new Set,a=[],d=new Set,p=(h,g,$,A)=>{if(!h||!g)return;const k=`${h}->${g}:${$}:${A}`;d.has(k)||(d.add(k),a.push({from:h,to:g,type:$,depth:A}))};return n.forEach(h=>p(e,h,"dep",1)),i.forEach(h=>p(e,h,"revdep",1)),t&&new Set([...n,...i]).forEach(g=>{(R.fwd.get(g)||new Set).forEach(k=>{const q=k===e;q||o.add(k),q||p(g,k,"dep",2)}),(R.rev.get(g)||new Set).forEach(k=>{const q=k===e;q||r.add(k),q||p(g,k,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:o,secondaryRevs:r,edges:a}}function Zn(e,t){const n=ie.get(e);n&&n.el.classList.add(t)}function lt(e){var d,p,h;if(!e)return;oe=null,M=e,me=null,Ie=Co(e),ot(),Si(),pn();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:o}=Ie;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const r=ie.get(e);r&&r.el.classList.add("selected"),t.forEach(g=>Zn(g,"dep")),n.forEach(g=>Zn(g,"revdep")),i.forEach(g=>{!t.has(g)&&g!==e&&Zn(g,"dep-indirect")}),o.forEach(g=>{!n.has(g)&&!t.has(g)&&g!==e&&Zn(g,"revdep-indirect")}),fn();const a=(h=(p=(d=ie.get(e))==null?void 0:d.el)==null?void 0:p.dataset)==null?void 0:h.externalUrl;a&&bi("This item has link to",Ot,a)}function Tt(e,{scrollIntoView:t=!0,preserveEntryHint:n=!1}={}){var a,d;if(!((a=R==null?void 0:R.m)!=null&&a.categories)||!e)return!1;const o=(R.m.categories||[]).find(p=>p.id===e);if(!o)return!1;vt(),Ii(),n||(me=null),oe=o.id,ot(),pn();const r=Je.get(o.id);return t&&(r!=null&&r.el)&&(r.el.scrollIntoView({behavior:"smooth",block:"center"}),(d=r.headEl)==null||d.focus({preventScroll:!0})),!0}function pn(){if(Je.forEach(({el:t,headEl:n})=>{t.classList.remove("category--selected"),n&&n.removeAttribute("aria-current")}),!oe)return;const e=Je.get(oe);if(!(e!=null&&e.el)){oe=null,me=null,ot();return}e.el.classList.add("category--selected"),e.headEl&&e.headEl.setAttribute("aria-current","true")}function $n(){if(oe)return oe;const e=M?ie.get(M):null;return e!=null&&e.catId?e.catId:null}function os(e){var r,a,d,p;if(!((a=(r=R==null?void 0:R.m)==null?void 0:r.categories)!=null&&a.length)||!e)return!1;const t=R.m.categories,n=$n();let i=t.findIndex(h=>h.id===n);if(i===-1){const h=((d=t.find(g=>(g.items||[]).length))==null?void 0:d.id)||((p=t[0])==null?void 0:p.id);return h?Tt(h):!1}const o=i+e;return o<0||o>=t.length?!1:Tt(t[o].id)}function Ii(){M=null,Ie=null,Si(),fn()}function rs(){oe=null,me=null,pn()}function Bn(){Ii(),rs(),me=null,ot()}function Si(){u.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function Io(){R!=null&&R.reusedLocal&&R.reusedLocal.forEach(e=>{const t=ie.get(e);if(!t)return;t.el.classList.toggle("reused",Ce);const n=t.el.querySelector(".badge");n&&(n.style.display=Ce?"inline-block":"none")})}function fn(){for(;S.firstChild;)S.removeChild(S.firstChild);if(!M||S.hidden)return;Ie=Co(M),Ie.edges.forEach(t=>{var $,A;const n=($=ie.get(t.from))==null?void 0:$.rect,i=(A=ie.get(t.to))==null?void 0:A.rect;if(!n||!i)return;const o=So(n),r=So(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),d=(o.x+r.x)/2,p=o.y,h=(o.x+r.x)/2,g=r.y;a.setAttribute("d",`M ${o.x},${o.y} C ${d},${p} ${h},${g} ${r.x},${r.y}`),a.setAttribute("fill","none"),a.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),a.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),a.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&a.setAttribute("stroke-dasharray","4 3"),a.setAttribute("vector-effect","non-scaling-stroke"),S.appendChild(a)})}function So(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function mn(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function ss(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function as(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function ko(){Cn||(Cn=requestAnimationFrame(()=>{Cn=null,Wt=Wt.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),Wt.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function cs(e,t){!e||!t||(Wt.push({labelEl:e,textEl:t}),ko())}function ls(e,t){var r,a;const n=[`<div class="version-nav__tooltip-title">${mn(t)}</div>`],i=((e==null?void 0:e.version)??((r=e==null?void 0:e.data)==null?void 0:r.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${mn(i)}</div>`);const o=(((a=e==null?void 0:e.data)==null?void 0:a.abstract)??"").toString().trim();return o?n.push(`<div class="version-nav__tooltip-body">${o}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function Mn(e,t,{offset:n=8}={}){!y||!e||!t||(y.innerHTML=t,y.hidden=!1,y.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),o=y.getBoundingClientRect(),r=window.scrollX||document.documentElement.scrollLeft,a=window.scrollY||document.documentElement.scrollTop;let d=i.left+i.width/2-o.width/2+r,p=i.top-o.height-n+a;d<r+n&&(d=r+n);const h=r+window.innerWidth-o.width-n;d>h&&(d=h),p<a+n&&(p=i.bottom+n+a),y.style.left=`${d}px`,y.style.top=`${p}px`,y.classList.add("is-visible")}))}function Rt(){nn&&(clearTimeout(nn),nn=null),y&&(y.classList.remove("is-visible"),y.setAttribute("aria-hidden","true"),y.hidden=!0)}function ds(e,t){if(!e)return;const n=Te((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=ls(t,n);let o=null;const r=()=>{o&&(clearTimeout(o),o=null)},a=()=>{Lt=e,Mn(e,`<div class="version-nav__tooltip-title">${mn(n)}</div>`,{offset:10})},d=()=>{r(),o=setTimeout(()=>{Lt===e&&Mn(e,i,{offset:10})},Wn)},p=()=>{a(),d()},h=()=>{Lt!==e&&a(),d()},g=()=>{r(),Lt===e&&(Lt=null,Rt())};e.addEventListener("mouseenter",p),e.addEventListener("focus",p),e.addEventListener("pointermove",h),e.addEventListener("mouseleave",g),e.addEventListener("blur",g),e.addEventListener("click",g)}function us(){rn&&(rn=!1,!(!Pt||!on)&&(Rt(),Mn(Pt,on,{offset:12}),nn=setTimeout(()=>{Rt(),ps()},1e3)))}function ps(){Pt&&(Jt&&(clearTimeout(Jt),Jt=null),Pt.classList.add("blockscape-tab--twinkle"),Jt=setTimeout(()=>{Pt.classList.remove("blockscape-tab--twinkle"),Jt=null},1400))}window.addEventListener("scroll",Rt,!0),window.addEventListener("resize",Rt);function vt(){L&&(L.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),L.setAttribute("aria-hidden","true"),L.hidden=!0,xo([]))}function fs(e,t){L&&(ee={x:e,y:t},L.hidden=!1,L.setAttribute("aria-hidden","false"),L.classList.add("is-visible"),hn(e,t))}function hn(e,t){if(!L)return;const n=12;L.style.left=`${e+n}px`,L.style.top=`${t+n}px`;const i=L.getBoundingClientRect();let o=i.left,r=i.top;i.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(r=Math.max(n,window.innerHeight-i.height-n)),L.style.left=`${o}px`,L.style.top=`${r}px`}function xo(e=[]){fe&&(fe.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),fe.appendChild(n)}),fe.hidden=e.length===0)}async function ms(e,t){var h;if(!L)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((h=t.querySelector(".name"))==null?void 0:h.textContent)||n||"Preview",o=n?`${n}.html`:"",r=o?`items/${o}`:"",a=++Le,d=t.dataset.externalUrl||"",p=[{label:"Edit",title:"Edit this item",onClick:()=>{vt(),zt.open(n)}}];if(d&&p.push({label:"Open link ↗",title:d,onClick:()=>window.open(d,"_blank","noopener")}),xo(p),n&&lt(n),ce.textContent=i,j.innerHTML='<div class="item-preview__status">Loading…</div>',L.classList.remove("item-preview--has-frame"),L.classList.add("item-preview--expanded"),fs(e.clientX,e.clientY),!r){j.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',hn(ee.x,ee.y);return}try{const g=await fetch(r,{cache:"no-cache"});if(!g.ok)throw new Error(`HTTP ${g.status}`);const $=await g.text();if(a!==Le)return;if(!$.trim()){j.innerHTML=`<div class="item-preview__status">No content in <code>${mn(o)}</code>.</div>`,hn(ee.x,ee.y);return}const k=document.createElement("iframe");k.className="item-preview__frame",k.title=`${i} details`,k.srcdoc=$,j.innerHTML="",j.appendChild(k),L.classList.add("item-preview--has-frame"),hn(ee.x,ee.y)}catch(g){if(a!==Le)return;j.innerHTML=`<div class="item-preview__status">No preview available for <strong>${mn(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${r}`,g),hn(ee.x,ee.y)}}he&&he.addEventListener("click",vt),T&&T.addEventListener("click",()=>{Hr()}),le&&le.addEventListener("click",()=>{Dr()}),de&&de.addEventListener("click",vi),ye&&ye.addEventListener("click",vi),Ve&&Ve.addEventListener("click",wi),Xe&&Xe.addEventListener("click",wi),u&&u.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!u.contains(t)||ms(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!L||L.hidden||L.contains(e.target)||vt()}),Re&&Re.addEventListener("click",()=>{lo("button")}),J&&J.addEventListener("click",()=>{if(v<0){alert("Load or select a model before creating a version.");return}try{const e=co({versionLabel:"map edit"});ct(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),H&&H.addEventListener("click",async()=>{var r;if(v<0||!I[v]){alert("Select or load a model before sharing.");return}const e={title:Te(I[v],"Shared Model"),data:I[v].data};let t;try{t=cn(JSON.stringify(e))}catch(a){console.error("[Blockscape] share encode failed",a),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(a){console.warn("[Blockscape] failed to update URL for share",a),window.location.hash=n.hash}let o=!1;if((r=navigator.clipboard)!=null&&r.writeText)try{await navigator.clipboard.writeText(i),o=!0}catch(a){console.warn("[Blockscape] clipboard write failed",a)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),X&&X.addEventListener("click",()=>{const e=(s.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};M&&(n.selectedItemId=M),localStorage.setItem(be,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";M&&(t=`editor.html?selected=${encodeURIComponent(M)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==be||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||yo("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===ze&&yo("message")})),document.addEventListener("keydown",e=>{var n,i,o,r,a,d,p,h,g,$;if(Ur()){e.key==="Escape"&&(e.preventDefault(),vi());return}if(!(K!=null&&K.hidden)&&e.key==="Escape"){e.preventDefault(),wi();return}if(!((n=zt==null?void 0:zt.isOpen)!=null&&n.call(zt))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const A=I[v],k=((i=A==null?void 0:A.apicurioVersions)==null?void 0:i.length)>1;lo("shortcut",k);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!Xt())return;if(Ns()){e.preventDefault();return}}if(e.key==="Escape"){let A=!1;L&&!L.hidden&&(vt(),A=!0),(M||oe)&&(Bn(),A=!0),A&&e.preventDefault()}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!Xt())return;const A=e.key==="ArrowLeft"?-1:1;if(e.altKey)return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){_i(A)&&e.preventDefault();return}if(e.ctrlKey||e.metaKey)return;if(oe&&!e.shiftKey){e.preventDefault();return}e.shiftKey?Cs(A)&&e.preventDefault():Is(A)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!Xt())return;const A=e.key==="ArrowUp"?-1:1;if((e.ctrlKey||e.metaKey)&&!e.altKey){As(A)&&e.preventDefault();return}if(e.altKey)return;if(oe&&!M&&!e.shiftKey){if(ks(A)){e.preventDefault();return}if(os(A)){e.preventDefault();return}}e.shiftKey?xs(A)&&e.preventDefault():Ss(A)&&e.preventDefault()}if(e.key==="Delete"){if(!Xt()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const A=oe?$s():!1,k=A?!0:Lo();(A||k)&&e.preventDefault()}if(e.key==="F2"){if(!Xt())return;const A=oe&&!M&&oe||!M&&((d=(a=(r=(o=e.target)==null?void 0:o.closest)==null?void 0:r.call(o,".category"))==null?void 0:a.dataset)==null?void 0:d.cat)||null;if(A&&!M&&_s(A)){e.preventDefault();return}const k=M||(($=(g=(h=(p=e.target)==null?void 0:p.closest)==null?void 0:h.call(p,".tile"))==null?void 0:g.dataset)==null?void 0:$.id);k&&zt.open(k)&&e.preventDefault()}if(e.key==="Insert"){if(!Xt()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;No()&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!L||L.hidden||hn(ee.x,ee.y)}),window.addEventListener("scroll",()=>{!L||L.hidden||vt()},!0);let Dt=null,On=null;function hs(e){vt(),Dt=e.target.dataset.id,On=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:Dt,categoryId:On})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",Dt,"from",On)}function gs(e){e.target.classList.remove("dragging"),u.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),u.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),Dt=null,On=null}function bs(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function vs(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function ws(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function ys(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!Dt||!i)return;const r=Array.from(t.querySelectorAll(".tile")).filter(a=>a.dataset.id!==Dt).find(a=>{const d=a.getBoundingClientRect();return e.clientY<d.top+d.height/2});Ao(Dt,r?r.dataset.id:null,i),un(),console.log("[Blockscape] drop completed",Dt,"from",On,"to",i)}function Ao(e,t,n){if(v<0)return;const o=I[v].data.categories||[],r=o.find(g=>(g.items||[]).some($=>$.id===e)),a=o.find(g=>g.id===n);if(!r||!a)return;r.items=r.items||[],a.items=a.items||[];const d=r.items.findIndex(g=>g.id===e);if(d===-1)return;const[p]=r.items.splice(d,1);let h=a.items.length;if(t){const g=a.items.findIndex($=>$.id===t);g!==-1&&(h=g)}a.items.splice(h,0,p),pt(),dt()}function Es(e){if(v<0||!e)return;const t=I[v].data,i=(t.categories||[]).find(p=>p.id===e);if(!i)return;i.items=i.items||[];const o=`New item ${i.items.length+1}`,a={id:Ar(`${e}-${i.items.length+1}`,t),name:o,deps:[]};i.items.push(a),pt(),dt(),vt(),lt(a.id);const d=ie.get(a.id);d!=null&&d.el&&d.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",a.id,"to",e)}function No(){if(v<0)return!1;const e=I[v].data;e.categories=e.categories||[];const t=`New category ${e.categories.length+1}`,n=Nr(t,e),i={id:n,title:t,items:[]};return e.categories.push(i),oe=n,M=null,Ie=null,me=null,pt(),dt(),Tt(n),console.log("[Blockscape] added category",n),!0}function _s(e=$n()){if(v<0||!e)return!1;const t=Tr.open(e);return t&&(M=null,Ie=null,ot()),t}function Cs(e){if(!M||v<0||!e)return!1;const n=I[v].data.categories||[],i=ie.get(M);let o=null;if(i!=null&&i.catId&&(o=n.find(p=>p.id===i.catId)),o||(o=n.find(p=>(p.items||[]).some(h=>h.id===M))),!o)return!1;o.items=o.items||[];const r=o.items.findIndex(p=>p.id===M);if(r===-1)return!1;const a=r+e;if(a<0||a>=o.items.length)return!1;const[d]=o.items.splice(r,1);return o.items.splice(a,0,d),pt(),dt(),un(),lt(M),!0}function Is(e){if(!R||!R.m||!e)return!1;const t=R.m.categories||[];if(!t.length)return!1;const n=()=>{const p=t.find(h=>(h.items||[]).length);return p?{category:p,item:p.items[0]}:null};if(!M){const p=n();return p?(lt(p.item.id),!0):!1}const i=ie.get(M);let o=null;if(i!=null&&i.catId&&(o=t.find(p=>p.id===i.catId)),o||(o=t.find(p=>(p.items||[]).some(h=>h.id===M))),!o){const p=n();return p?(lt(p.item.id),!0):!1}const r=o.items||[];if(!r.length)return!1;const a=r.findIndex(p=>p.id===M);if(a===-1)return!1;const d=a+e;return d<0||d>=r.length?!1:(lt(r[d].id),!0)}function Ss(e){if(!R||!R.m||!e)return!1;const t=R.m.categories||[];if(!t.length)return!1;const n=$n();let i=t.findIndex(a=>a.id===n),o=i+e;if(i===-1&&(o=e>0?0:t.length-1),o<0||o>=t.length)return!1;const r=t[o];if(M){const d=(t[i].items||[]).findIndex(p=>p.id===M);me={catId:r.id,position:d===-1?0:d}}else me=null;return Tt(r.id,{preserveEntryHint:!0})}function ks(e){var r;if(!oe||!((r=R==null?void 0:R.m)!=null&&r.categories)||!e)return!1;const n=(R.m.categories||[]).find(a=>a.id===oe);if(!n)return!1;const i=n.items||[];if(!i.length)return!1;let o=e>0?0:Math.max(0,i.length-1);return(me==null?void 0:me.catId)===n.id&&(o=Math.min(i.length-1,Math.max(0,me.position||0))),me=null,lt(i[o].id),!0}function xs(e){if(!M||v<0||!e)return!1;const n=I[v].data.categories||[];if(!n.length)return!1;const i=ie.get(M);let o=-1;if(i!=null&&i.catId&&(o=n.findIndex($=>$.id===i.catId)),o===-1&&(o=n.findIndex($=>($.items||[]).some(A=>A.id===M))),o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const a=n[o],d=n[r];if(!d)return!1;a.items=a.items||[],d.items=d.items||[];const p=a.items.findIndex($=>$.id===M);if(p===-1)return!1;const h=Math.min(d.items.length,Math.max(0,p)),g=h<d.items.length?d.items[h].id:null;return Ao(M,g,d.id),un(),lt(M),!0}function As(e){if(v<0||!e)return!1;const n=I[v].data.categories||[];if(!n.length)return!1;const i=$n();if(!i)return!1;const o=n.findIndex(d=>d.id===i);if(o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const[a]=n.splice(o,1);return n.splice(r,0,a),oe=a.id,Ii(),me=null,ot(),pt(),dt(),pn(),console.log("[Blockscape] moved category",a.id,"from",o,"to",r),!0}function Ns(){if(v<0)return!1;const e=I[v],t=Qe(e)||(e?e.id:null),n=[];if(De&&t===De.modelId&&n.push({...De,type:"item"}),st&&t===st.modelId&&n.push({...st,type:"category"}),!n.length)return!1;const i=n.reduce((o,r)=>o?(r.ts||0)>(o.ts||0)?r:o:r,null);if(!i)return!1;if(i.type==="category"){if(Ts(i))return!0}else if(i.type==="item"&&Ls(i))return!0;return!1}function Ls(e){const t=I[v],n=Qe(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const r=(t.data.categories||[]).find(d=>d.id===e.categoryId);if(!r)return!1;r.items=r.items||[];const a=Math.min(Math.max(e.index,0),r.items.length);return r.items.splice(a,0,e.item),De=null,vt(),M=null,Ie=null,ot(),pt(),dt(),un(),lt(e.item.id),console.log("[Blockscape] undo delete restored",e.item.id),!0}function Ts(e){const t=I[v],n=Qe(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const i=t.data;i.categories=i.categories||[];const o=Math.min(Math.max(e.index,0),i.categories.length);return i.categories.splice(o,0,e.category),st=null,M=null,Ie=null,oe=e.category.id,me=null,ot(),pt(),dt(),pn(),Tt(e.category.id),console.log("[Blockscape] undo delete restored category",e.category.id),!0}function Lo(){if(!M||v<0)return!1;const t=I[v].data.categories||[];if(!t.length)return!1;const n=ie.get(M);let i=null;if(n!=null&&n.catId&&(i=t.find(h=>h.id===n.catId)),i||(i=t.find(h=>(h.items||[]).some(g=>g.id===M))),!i||!Array.isArray(i.items))return!1;const o=i.items.findIndex(h=>h.id===M);if(o===-1)return!1;const r=i.items.splice(o,1)[0];if(!r)return!1;const a=I[v];De={item:r,categoryId:i.id,index:o,modelId:Qe(a)||(a?a.id:null),ts:Date.now()};const p=(()=>{var g;if(i.items.length){const $=Math.min(o,i.items.length-1);return((g=i.items[$])==null?void 0:g.id)||null}const h=t.findIndex($=>$.id===i.id);if(h===-1)return null;for(let $=h+1;$<t.length;$++){const A=t[$].items||[];if(A.length)return A[0].id}for(let $=h-1;$>=0;$--){const A=t[$].items||[];if(A.length)return A[0].id}return null})();return vt(),M=null,Ie=null,me=null,ot(),pt(),dt(),un(),p?lt(p):Bn(),console.log("[Blockscape] removed item",r.id),!0}function $s(){var d,p;const e=$n();if(!e||v<0)return!1;const n=I[v].data.categories||[];if(!n.length)return!1;const i=n.findIndex(h=>h.id===e);if(i===-1)return!1;const[o]=n.splice(i,1);if(!o)return!1;const r=I[v];st={category:o,index:i,modelId:Qe(r)||(r?r.id:null),ts:Date.now()},oe=null,M=null,Ie=null,me=null,ot(),pt(),dt();const a=((d=n[i])==null?void 0:d.id)||((p=n[i-1])==null?void 0:p.id)||null;return a?Tt(a):Bn(),console.log("[Blockscape] removed category",o.id),!0}function Bs(e){if(!e)return!1;const t=M;M=e;const n=Lo();return n||(M=t,ot()),n}D&&D.addEventListener("click",async()=>{const e=s.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await io(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),W&&W.addEventListener("click",async()=>{const e=$r();if(!e){alert("No series available to copy. Create another version first.");return}await io(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),ke&&ke.addEventListener("click",async()=>{try{const e=await rr();if(!e){alert("Clipboard is empty.");return}s.value=e,s.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=Kt(s.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const o=Ht(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=o)}),v===-1&&t!=null?ct(t):dn()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(v<0){alert("No active model selected.");return}try{const t=JSON.parse(s.value);if(Gt(t,{titleHint:Te(I[v]),idHint:Qe(I[v])||Te(I[v])}),I[v].data=t,I[v].title=t.title||I[v].title,I[v].isSeries||((e=I[v].apicurioVersions)==null?void 0:e.length)>1){const n=I[v].title||Te(I[v]);mt(I[v],{seriesName:n,fallbackTitle:n})}hi(),console.log("[Blockscape] replaced active model:",Te(I[v])),dt(),ve.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const o=await i.text(),r=i.name.replace(/\.[^.]+$/,"")||"File",a=Kt(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models in file:",i.name);continue}a.forEach((d,p)=>{var pe;const h=(((pe=d.data)==null?void 0:pe.title)??"").toString().trim(),g=a.length>1?`${i.name} #${p+1}`:i.name,$=`${r} series`,A=d.isSeries?$:null;let k={...d};if(d.isSeries){const $e=A||h||d.title||g||"unknown";k.title=$e;const Be=Fn($e||"unknown");fi(k,Be),mt(k,{seriesName:$e,fallbackTitle:"unknown"}),k.apicurioArtifactName=k.apicurioArtifactName||$e}else k.title=h||g;const q=Ht({...k,apicurioArtifactName:k.apicurioArtifactName||A||k.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=q)})}v===-1&&n!=null?ct(n):dn()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",Ms);function Ms(e){var o;if(!Xt())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!zr(t))return;let n=[];try{n=Kt(t,"Clipboard",{promptForSeriesName:!0})}catch(r){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",r);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((r,a)=>{const d=Ht(r,{versionLabel:n.length>1?`paste #${a+1}`:"paste"});i==null&&(i=d)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&ct(i)}P.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(Or(),ct(n))}),document.getElementById("removeModel").onclick=()=>{if(v<0)return;const e=Te(I[v]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",Te(I[v])),I.splice(v,1),!I.length){v=-1,R=null,u.innerHTML="",S.innerHTML="",s.value="",dn(),hi();return}const n=Math.min(v,I.length-1);ct(n)},_e&&(_e.addEventListener("input",e=>{bo(e.target.value||"")}),_e.addEventListener("focus",()=>{_e.value&&_e.value.trim()&&go(_e.value)})),B&&B.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;Jr({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!B||B.hidden)return;const t=e.target;B.contains(t)||_e&&(t===_e||_e.contains(t))||(B.hidden=!0)}),w&&F&&z&&w.addEventListener("submit",async e=>{e.preventDefault();const t=F.value.trim();if(!t){alert("Please enter a URL"),F.focus();return}const n=await ki(t);if(typeof n=="number"){ct(n),F.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!F||!t)return;let n=null;F.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=F.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function dt(){if(!(v<0))try{R=Yr(I[v].data),un()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function Os(){const e=["comms.bs","planets.bs","styleguide.bs"],t=n=>di?di.endsWith("/")?`${di}${n}`:`${di}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const o=await i.text(),r=n.replace(/\.[^.]+$/,"")||"Model",a=Kt(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models found in",n);continue}a.forEach(d=>{let p={...d};if(d.isSeries){const h=`${r} series`;p={...d,title:h,apicurioArtifactName:h};const g=Fn(h||"unknown");fi(p,g),mt(p,{seriesName:h,fallbackTitle:"unknown"})}Ht(p,{versionLabel:n})}),console.log(`[Blockscape] loaded ${a.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}dn()}async function Ps(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const o=await fetch(e,i);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function Rs(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>Vs(i)),e.querySelectorAll("a[href]").forEach(i=>{const o=i.getAttribute("href");$o(o)&&To(i,o)})}function Vs(e){var d,p;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(p=(d=e.parentNode)==null?void 0:d.closest)!=null&&p.call(d,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let o;for(;(o=n.exec(t))!==null;)i.push({url:o[0],index:o.index});if(!i.length)return;const r=document.createDocumentFragment();let a=0;i.forEach(({url:h,index:g})=>{g>a&&r.appendChild(document.createTextNode(t.slice(a,g))),r.appendChild(Us(h)),a=g+h.length}),a<t.length&&r.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(r,e)}function Us(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",$o(e)&&To(t,e),t}function To(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>Hs(n,t,e)))}async function Hs(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await ki(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function $o(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function ki(e){try{console.log("[Blockscape] loading from URL:",e);const t=await Ps(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=Kt(t,i)}catch(a){throw new Error(`Invalid JSON payload: ${a.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let r=null;return o.forEach((a,d)=>{var k;const p=(((k=a.data)==null?void 0:k.title)??"").toString().trim(),h=o.length>1?`${i} #${d+1}`:i,g=a.isSeries?`${i} series`:null;let $={...a};if(a.isSeries){const q=g||p||$.title||h;$={...a,title:q,apicurioArtifactName:q||a.apicurioArtifactName};const pe=Fn(q||"unknown");fi($,pe),mt($,{seriesName:q||g||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:pe,url:e,baseName:i,seriesTitle:q})}const A=Ht({...$,title:p||$.title||h,apicurioArtifactName:$.apicurioArtifactName||g||a.apicurioArtifactName},{versionLabel:i});r==null&&(r=A)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,i),v===-1&&r!=null?ct(r):dn(),r}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=Kt(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let o=null;i.forEach(g=>{const $=Ht(g,{versionLabel:"seed"});o==null&&(o=$)}),await Os();const r=await Xr(),a=wo(),d=a==null?void 0:a.index,p=Kr();ct(typeof r=="number"?r:typeof p=="number"?p:typeof d=="number"?d:o??0)})()}function ha(s){let l;return{c(){l=U("div"),l.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',b(l,"id","shortcutHelp"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","shortcutHelpTitle")},m(u,S){et(u,l,S)},p:Vt,i:Vt,o:Vt,d(u){u&&Ge(l)}}}class ga extends to{constructor(l){super(),eo(this,l,null,ha,Zi,{})}}const ba=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function Xo(s){let l,u,S,y,P,L,w,F;return{c(){l=U("div"),u=U("div"),S=U("a"),y=Qi("Open Blockscape GPT"),P=ae(),L=U("div"),L.textContent="Paste the copied prompt into that chat.",w=ae(),F=U("div"),F.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',b(S,"href",wa),b(S,"target","_blank"),b(S,"rel","noreferrer"),b(L,"class","new-panel__hint"),b(u,"class","new-panel__link"),b(F,"class","new-panel__link new-panel__link--disabled"),b(l,"class","new-panel__links")},m(z,ce){et(z,l,ce),x(l,u),x(u,S),x(S,y),x(u,P),x(u,L),x(l,w),x(l,F)},p:Vt,d(z){z&&Ge(l)}}}function Yo(s){let l,u,S,y,P,L;return{c(){l=U("div"),u=U("div"),u.textContent="Generated prompt",S=ae(),y=U("textarea"),b(u,"class","new-panel__prompt-label"),b(y,"class","pf-v5-c-form-control new-panel__textarea"),b(y,"rows","4"),y.readOnly=!0,b(l,"class","new-panel__prompt")},m(w,F){et(w,l,F),x(l,u),x(l,S),x(l,y),En(y,s[4]),P||(L=tn(y,"input",s[12]),P=!0)},p(w,F){F&16&&En(y,w[4])},d(w){w&&Ge(l),P=!1,L()}}}function va(s){let l,u,S,y,P,L,w,F,z,ce,j,fe,he,Re,H,J,X,D,W,ke,T,le,Q,ge,de,ye,K,Ve,Xe,_e,B,be,ze,je,I,v,ve,R,ie,Je,M,oe,Ie,me,tt,Ce=s[2]==="gpt"&&Xo(),Le=s[4]&&s[5]&&Yo(s);return Ie=Ys(s[10][0]),{c(){l=U("div"),u=U("div"),S=ae(),y=U("div"),P=U("div"),P.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',L=ae(),w=U("form"),F=U("div"),z=U("label"),z.textContent="Domain",ce=ae(),j=U("p"),j.textContent="Describe what you want to create a map for.",fe=ae(),he=U("textarea"),Re=ae(),H=U("div"),J=U("label"),X=U("input"),D=ae(),W=U("span"),W.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,ke=ae(),T=U("fieldset"),le=U("legend"),le.textContent="Target",Q=ae(),ge=U("p"),ge.textContent="Choose where you plan to use the prompt.",de=ae(),ye=U("label"),K=U("input"),Ve=ae(),Xe=U("div"),Xe.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',_e=ae(),B=U("label"),be=U("input"),ze=ae(),je=U("div"),je.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',I=ae(),v=U("div"),ve=U("button"),ve.textContent="Copy prompt",R=ae(),ie=U("div"),Je=Qi(s[3]),M=ae(),Ce&&Ce.c(),oe=ae(),Le&&Le.c(),b(u,"id","newPanelBackdrop"),b(u,"class","shortcut-help__backdrop"),b(P,"class","shortcut-help__header"),b(z,"for","newDomain"),b(j,"class","new-panel__hint"),b(he,"id","newDomain"),b(he,"class","pf-v5-c-form-control new-panel__textarea"),b(he,"rows","4"),he.required=!0,b(he,"placeholder","Ex: Companies building open-source geospatial tools"),b(F,"class","new-panel__field"),b(X,"id","seriesToggle"),b(X,"type","checkbox"),b(J,"class","new-panel__toggle"),b(J,"for","seriesToggle"),b(H,"class","new-panel__field"),b(ge,"class","new-panel__hint"),b(K,"type","radio"),b(K,"name","target"),K.__value="gpt",En(K,K.__value),b(ye,"class","new-panel__option"),b(be,"type","radio"),b(be,"name","target"),be.__value="plain",En(be,be.__value),b(B,"class","new-panel__option"),b(T,"class","new-panel__field"),b(ve,"class","pf-v5-c-button pf-m-primary"),b(ve,"type","submit"),b(ie,"class","new-panel__status"),b(ie,"aria-live","polite"),b(v,"class","new-panel__actions"),b(w,"class","shortcut-help__list new-panel__form"),b(y,"class","shortcut-help__panel"),b(y,"tabindex","-1"),b(l,"id","newPanel"),b(l,"class","shortcut-help"),l.hidden=!0,b(l,"aria-hidden","true"),b(l,"role","dialog"),b(l,"aria-modal","true"),b(l,"aria-labelledby","newPanelTitle"),Ie.p(K,be)},m(ee,We){et(ee,l,We),x(l,u),x(l,S),x(l,y),x(y,P),x(y,L),x(y,w),x(w,F),x(F,z),x(F,ce),x(F,j),x(F,fe),x(F,he),En(he,s[0]),x(w,Re),x(w,H),x(H,J),x(J,X),X.checked=s[1],x(J,D),x(J,W),x(w,ke),x(w,T),x(T,le),x(T,Q),x(T,ge),x(T,de),x(T,ye),x(ye,K),K.checked=K.__value===s[2],x(ye,Ve),x(ye,Xe),x(T,_e),x(T,B),x(B,be),be.checked=be.__value===s[2],x(B,ze),x(B,je),x(w,I),x(w,v),x(v,ve),x(v,R),x(v,ie),x(ie,Je),x(w,M),Ce&&Ce.m(w,null),x(w,oe),Le&&Le.m(w,null),me||(tt=[tn(he,"input",s[7]),tn(X,"change",s[8]),tn(K,"change",s[9]),tn(be,"change",s[11]),tn(w,"submit",Xs(s[6]))],me=!0)},p(ee,[We]){We&1&&En(he,ee[0]),We&2&&(X.checked=ee[1]),We&4&&(K.checked=K.__value===ee[2]),We&4&&(be.checked=be.__value===ee[2]),We&8&&Qs(Je,ee[3]),ee[2]==="gpt"?Ce?Ce.p(ee,We):(Ce=Xo(),Ce.c(),Ce.m(w,oe)):Ce&&(Ce.d(1),Ce=null),ee[4]&&ee[5]?Le?Le.p(ee,We):(Le=Yo(ee),Le.c(),Le.m(w,null)):Le&&(Le.d(1),Le=null)},i:Vt,o:Vt,d(ee){ee&&Ge(l),Ce&&Ce.d(),Le&&Le.d(),Ie.r(),me=!1,Jn(tt)}}}const wa="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function ya(s,l,u){let S="",y=!1,P="gpt",L="",w="",F=!1;const z=()=>{var D;return typeof navigator<"u"&&!!((D=navigator.clipboard)!=null&&D.writeText)};function ce(D){const W=D||"[DOMAIN]",ke=y?"series":"map",le=ba.replaceAll("[DOMAIN NAME]",W).replaceAll("[DOMAIN]",W).replaceAll("[map|series]",ke).split(`
`),Q=`Generate a **blockscape ${ke}** for the domain of ${W}.`,ge=le.findIndex(ye=>ye.toLowerCase().includes("generate a **blockscape value")||ye.toLowerCase().includes("generate a blockscape [map|series]")||ye.toLowerCase().startsWith("generate a blockscape"));ge>=0?le[ge]=Q:le.unshift(Q);const de=y?`

User requested a series (return an array of models).`:"";return`${le.join(`
`).trim()}${de}`}async function j(D){D.preventDefault();const W=S.trim();if(u(3,L=""),u(5,F=P!=="gpt"),!W){u(3,L="Add a domain to generate a prompt."),u(4,w="");return}if(P==="gpt"?u(4,w=`${y?"Create a series":"Create a map"} for ${W}`):(u(4,w=ce(W)),u(5,F=!0)),!z()){u(3,L="Clipboard access is unavailable. Copy the prompt below."),u(5,F=!0);return}try{await navigator.clipboard.writeText(w),u(3,L=P==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),P==="gpt"&&u(5,F=!1)}catch(T){console.warn("[Blockscape] clipboard write failed",T),u(3,L="Copy failed. Use the prompt below."),u(5,F=!0)}}const fe=[[]];function he(){S=this.value,u(0,S)}function Re(){y=this.checked,u(1,y)}function H(){P=this.__value,u(2,P)}function J(){P=this.__value,u(2,P)}function X(){w=this.value,u(4,w)}return[S,y,P,L,w,F,j,he,Re,H,fe,J,X]}class Ea extends to{constructor(l){super(),eo(this,l,ya,va,Zi,{})}}const{document:Zo}=Ks;function _a(s){let l,u,S,y,P,L,w,F,z,ce,j,fe,he,Re,H,J,X,D,W,ke,T,le,Q,ge,de,ye,K,Ve,Xe,_e,B,be,ze,je,I,v,ve,R,ie,Je,M,oe=`<script id="seed" type="application/json">${s[1]}<\/script>`,Ie,me,tt,Ce,Le,ee,We,De,st,ht,at,Ot,gt;return De=new ga({}),ht=new Ea({}),{c(){l=U("link"),u=ae(),S=U("div"),y=U("header"),P=U("div"),L=U("div"),w=U("div"),F=U("div"),F.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',z=ae(),ce=U("div"),j=U("div"),fe=U("button"),he=U("span"),he.textContent="Toggle search and edit tools",Re=ae(),H=U("span"),H.textContent="▾",J=ae(),X=U("button"),X.textContent="New",D=ae(),W=U("form"),W.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',ke=ae(),T=U("label"),T.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',le=ae(),Q=U("button"),Q.textContent="Help",ge=ae(),de=U("div"),ye=U("div"),ye.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',K=ae(),Ve=U("button"),Ve.textContent="Edit",Xe=ae(),_e=U("button"),_e.textContent="Share",je=ae(),I=U("div"),I.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',v=ae(),ve=U("main"),ve.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,R=ae(),ie=U("footer"),ie.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',Je=ae(),M=new ea(!1),Ie=ae(),me=tr("svg"),tt=ae(),Ce=U("div"),Le=ae(),ee=U("div"),ee.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',We=ae(),qo(De.$$.fragment),st=ae(),qo(ht.$$.fragment),Zo.title="Blockscape — simple landscape-style tiles",b(l,"rel","icon"),b(l,"type","image/svg+xml"),b(l,"href","./favicon.svg"),b(F,"class","blockscape-brand"),b(he,"class","sr-only"),b(H,"class","blockscape-toolbar__toggle-icon"),b(H,"aria-hidden","true"),b(fe,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),b(fe,"type","button"),b(fe,"aria-expanded",s[0]),b(fe,"aria-controls","blockscapeHeaderExtras"),b(X,"id","newPanelButton"),b(X,"class","pf-v5-c-button pf-m-primary"),b(X,"type","button"),b(X,"title","Create something new"),b(W,"id","urlForm"),b(W,"class","blockscape-url-form"),b(W,"autocomplete","on"),W.noValidate=!0,b(T,"class","pf-v5-c-button pf-m-primary blockscape-file"),b(Q,"id","helpButton"),b(Q,"class","pf-v5-c-button pf-m-primary"),b(Q,"type","button"),b(Q,"title","Show keyboard shortcuts"),b(j,"class","blockscape-toolbar__primary"),b(ye,"class","blockscape-search"),b(Ve,"id","openInEditor"),b(Ve,"class","pf-v5-c-button pf-m-secondary"),b(Ve,"type","button"),b(Ve,"title","Open current JSON in the editor"),b(_e,"id","shareModel"),b(_e,"class","pf-v5-c-button pf-m-secondary"),b(_e,"type","button"),b(_e,"title","Copy a shareable URL for this model"),b(de,"id","blockscapeHeaderExtras"),b(de,"class","blockscape-toolbar__extras"),de.hidden=B=!s[0],b(de,"aria-hidden",be=!s[0]),b(ce,"class","blockscape-toolbar__controls"),b(ce,"data-expanded",ze=s[0]?"true":"false"),b(I,"class","blockscape-legend"),b(I,"role","presentation"),b(w,"class","blockscape-toolbar"),b(L,"class","pf-v5-c-masthead__content"),b(P,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),b(y,"class","pf-v5-c-page__header"),b(ve,"class","pf-v5-c-page__main"),b(ie,"class","pf-v5-c-page__footer blockscape-footer"),b(S,"class","pf-v5-c-page"),M.a=Ie,b(me,"id","overlay"),b(me,"class","svg-layer"),b(Ce,"id","tabTooltip"),b(Ce,"class","blockscape-tab-tooltip"),Ce.hidden=!0,b(Ce,"aria-hidden","true"),b(ee,"id","itemPreview"),b(ee,"class","item-preview"),ee.hidden=!0,b(ee,"aria-hidden","true")},m(te,we){x(Zo.head,l),et(te,u,we),et(te,S,we),x(S,y),x(y,P),x(P,L),x(L,w),x(w,F),x(w,z),x(w,ce),x(ce,j),x(j,fe),x(fe,he),x(fe,Re),x(fe,H),x(j,J),x(j,X),x(j,D),x(j,W),x(j,ke),x(j,T),x(j,le),x(j,Q),x(ce,ge),x(ce,de),x(de,ye),x(de,K),x(de,Ve),x(de,Xe),x(de,_e),x(w,je),x(w,I),x(S,v),x(S,ve),x(S,R),x(S,ie),et(te,Je,we),M.m(oe,te,we),et(te,Ie,we),et(te,me,we),et(te,tt,we),et(te,Ce,we),et(te,Le,we),et(te,ee,we),et(te,We,we),Xi(De,te,we),et(te,st,we),Xi(ht,te,we),at=!0,Ot||(gt=tn(fe,"click",s[2]),Ot=!0)},p(te,[we]){(!at||we&1)&&b(fe,"aria-expanded",te[0]),(!at||we&1&&B!==(B=!te[0]))&&(de.hidden=B),(!at||we&1&&be!==(be=!te[0]))&&b(de,"aria-hidden",be),(!at||we&1&&ze!==(ze=te[0]?"true":"false"))&&b(ce,"data-expanded",ze)},i(te){at||(Ki(De.$$.fragment,te),Ki(ht.$$.fragment,te),at=!0)},o(te){Wo(De.$$.fragment,te),Wo(ht.$$.fragment,te),at=!1},d(te){te&&(Ge(u),Ge(S),Ge(Je),M.d(),Ge(Ie),Ge(me),Ge(tt),Ge(Ce),Ge(Le),Ge(ee),Ge(We),Ge(st)),Ge(l),Yi(De,te),Yi(ht,te),Ot=!1,gt()}}}function Ca(s,l,u){const S=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let y=!1;const P=()=>{if(u(0,y=!y),!y){const L=document.getElementById("search");L&&L.value&&(L.value="",L.dispatchEvent(new Event("input",{bubbles:!0})))}};return na(()=>{ma()}),[y,S,P]}class Ia extends to{constructor(l){super(),eo(this,l,Ca,_a,Zi,{})}}const Sa=document.getElementById("root");new Ia({target:Sa});
