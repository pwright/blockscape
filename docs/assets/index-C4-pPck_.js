var Js=Object.defineProperty;var Ws=(s,c,p)=>c in s?Js(s,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):s[c]=p;var Zt=(s,c,p)=>Ws(s,typeof c!="symbol"?c+"":c,p);(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const E of document.querySelectorAll('link[rel="modulepreload"]'))I(E);new MutationObserver(E=>{for(const R of E)if(R.type==="childList")for(const $ of R.addedNodes)$.tagName==="LINK"&&$.rel==="modulepreload"&&I($)}).observe(document,{childList:!0,subtree:!0});function p(E){const R={};return E.integrity&&(R.integrity=E.integrity),E.referrerPolicy&&(R.referrerPolicy=E.referrerPolicy),E.crossOrigin==="use-credentials"?R.credentials="include":E.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function I(E){if(E.ep)return;E.ep=!0;const R=p(E);fetch(E.href,R)}})();function Gt(){}function Br(s){return s()}function Er(){return Object.create(null)}function ai(s){s.forEach(Br)}function $r(s){return typeof s=="function"}function So(s,c){return s!=s?c==c:s!==c||s&&typeof s=="object"||typeof s=="function"}function qs(s){return Object.keys(s).length===0}const Gs=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function N(s,c){s.appendChild(c)}function rt(s,c,p){s.insertBefore(c,p||null)}function Ye(s){s.parentNode&&s.parentNode.removeChild(s)}function U(s){return document.createElement(s)}function Or(s){return document.createElementNS("http://www.w3.org/2000/svg",s)}function Io(s){return document.createTextNode(s)}function se(){return Io(" ")}function fn(s,c,p,I){return s.addEventListener(c,p,I),()=>s.removeEventListener(c,p,I)}function zs(s){return function(c){return c.preventDefault(),s.call(this,c)}}function w(s,c,p){p==null?s.removeAttribute(c):s.getAttribute(c)!==p&&s.setAttribute(c,p)}function Ks(s){let c;return{p(...p){c=p,c.forEach(I=>s.push(I))},r(){c.forEach(p=>s.splice(s.indexOf(p),1))}}}function Ys(s){return Array.from(s.childNodes)}function Xs(s,c){c=""+c,s.data!==c&&(s.data=c)}function Nn(s,c){s.value=c??""}class Zs{constructor(c=!1){Zt(this,"is_svg",!1);Zt(this,"e");Zt(this,"n");Zt(this,"t");Zt(this,"a");this.is_svg=c,this.e=this.n=null}c(c){this.h(c)}m(c,p,I=null){this.e||(this.is_svg?this.e=Or(p.nodeName):this.e=U(p.nodeType===11?"TEMPLATE":p.nodeName),this.t=p.tagName!=="TEMPLATE"?p:p.content,this.c(c)),this.i(I)}h(c){this.e.innerHTML=c,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(c){for(let p=0;p<this.n.length;p+=1)rt(this.t,this.n[p],c)}p(c){this.d(),this.h(c),this.i(this.a)}d(){this.n.forEach(Ye)}}let ri;function oi(s){ri=s}function Qs(){if(!ri)throw new Error("Function called outside component initialization");return ri}function el(s){Qs().$$.on_mount.push(s)}const Ln=[],_r=[];let Tn=[];const kr=[],tl=Promise.resolve();let wo=!1;function nl(){wo||(wo=!0,tl.then(Mr))}function yo(s){Tn.push(s)}const ho=new Set;let Cn=0;function Mr(){if(Cn!==0)return;const s=ri;do{try{for(;Cn<Ln.length;){const c=Ln[Cn];Cn++,oi(c),il(c.$$)}}catch(c){throw Ln.length=0,Cn=0,c}for(oi(null),Ln.length=0,Cn=0;_r.length;)_r.pop()();for(let c=0;c<Tn.length;c+=1){const p=Tn[c];ho.has(p)||(ho.add(p),p())}Tn.length=0}while(Ln.length);for(;kr.length;)kr.pop()();wo=!1,ho.clear(),oi(s)}function il(s){if(s.fragment!==null){s.update(),ai(s.before_update);const c=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,c),s.after_update.forEach(yo)}}function ol(s){const c=[],p=[];Tn.forEach(I=>s.indexOf(I)===-1?c.push(I):p.push(I)),p.forEach(I=>I()),Tn=c}const Ai=new Set;let rl;function Eo(s,c){s&&s.i&&(Ai.delete(s),s.i(c))}function Sr(s,c,p,I){if(s&&s.o){if(Ai.has(s))return;Ai.add(s),rl.c.push(()=>{Ai.delete(s)}),s.o(c)}}function Ir(s){s&&s.c()}function _o(s,c,p){const{fragment:I,after_update:E}=s.$$;I&&I.m(c,p),yo(()=>{const R=s.$$.on_mount.map(Br).filter($r);s.$$.on_destroy?s.$$.on_destroy.push(...R):ai(R),s.$$.on_mount=[]}),E.forEach(yo)}function ko(s,c){const p=s.$$;p.fragment!==null&&(ol(p.after_update),ai(p.on_destroy),p.fragment&&p.fragment.d(c),p.on_destroy=p.fragment=null,p.ctx=[])}function al(s,c){s.$$.dirty[0]===-1&&(Ln.push(s),nl(),s.$$.dirty.fill(0)),s.$$.dirty[c/31|0]|=1<<c%31}function Co(s,c,p,I,E,R,$=null,y=[-1]){const q=ri;oi(s);const Z=s.$$={fragment:null,ctx:[],props:R,update:Gt,not_equal:E,bound:Er(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(c.context||(q?q.$$.context:[])),callbacks:Er(),dirty:y,skip_bound:!1,root:c.target||q.$$.root};$&&$(Z.root);let le=!1;if(Z.ctx=p?p(s,c.props||{},(G,he,...be)=>{const Ve=be.length?be[0]:he;return Z.ctx&&E(Z.ctx[G],Z.ctx[G]=Ve)&&(!Z.skip_bound&&Z.bound[G]&&Z.bound[G](Ve),le&&al(s,G)),he}):[],Z.update(),le=!0,ai(Z.before_update),Z.fragment=I?I(Z.ctx):!1,c.target){if(c.hydrate){const G=Ys(c.target);Z.fragment&&Z.fragment.l(G),G.forEach(Ye)}else Z.fragment&&Z.fragment.c();c.intro&&Eo(s.$$.fragment),_o(s,c.target,c.anchor),Mr()}oi(q)}class xo{constructor(){Zt(this,"$$");Zt(this,"$$set")}$destroy(){ko(this,1),this.$destroy=Gt}$on(c,p){if(!$r(p))return Gt;const I=this.$$.callbacks[c]||(this.$$.callbacks[c]=[]);return I.push(p),()=>{const E=I.indexOf(p);E!==-1&&I.splice(E,1)}}$set(c){this.$$set&&!qs(c)&&(this.$$.skip_bound=!0,this.$$set(c),this.$$.skip_bound=!1)}}const sl="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(sl);const Cr="blockscape:apicurioConfig",go="http://localhost:8080/apis/registry/v3",Ci="bs",xr="-series",bo=!1,vo=!1;function ll({models:s,getActiveIndex:c,setActive:p,ensureModelMetadata:I,ensureSeriesId:E,getModelId:R,getSeriesId:$,getModelTitle:y,computeJsonFingerprint:q,uid:Z}){let le=null,G=null,he=null,be=null,Ve=null,D=null,K=null,ee=null,J=null,Y=null;const Oe=new Set,O={baseUrl:go,groupId:Ci,authToken:"",enabled:bo,useSemver:vo},ue=new Map,re=new Map;function ye(l){return(l||"").toString().trim().replace(/\/+$/,"")}function pe(l){return`${(l||"").toString().trim()||Ci}${xr}`}function ke(){return!!(O.baseUrl&&O.groupId)}function Q(){return O.enabled!==!1}function He(){Oe.forEach(l=>{try{l(Q())}catch(f){console.warn("[Blockscape] failed to run Apicurio enabled listener",f)}})}function Qe(l){return typeof l=="function"&&Oe.add(l),()=>Oe.delete(l)}function Se(){he&&(he.value=O.baseUrl||""),be&&(be.value=O.groupId||""),Ve&&(Ve.value=O.authToken||""),D&&(D.checked=Q()),K&&(K.checked=!!O.useSemver)}function M(l="",f="muted"){ee&&(ee.textContent=l||"",ee.classList.remove("is-error","is-success"),f==="error"?ee.classList.add("is-error"):f==="success"&&ee.classList.add("is-success"))}function ce(l){if(!Y||(Y.innerHTML="",!l))return;const f=document.createElement("p");f.className="apicurio-hint",f.textContent=l,Y.appendChild(f)}function Ge(l){ue.clear(),re.clear(),ce(l)}function ge(){const l=c(),f=Q(),S=ke(),_=l>=0?s[l]:null,m=!!(_!=null&&_.apicurioVersions&&_.apicurioVersions.length>1);if(le){const B=le.dataset.loading==="true",j=f&&S&&l>=0&&!!W(s[l]);le.disabled=!f||B||!j,f?B||(le.textContent="Push to Apicurio"):le.textContent="Enable Apicurio to push"}if(J){const B=J.dataset.loading==="true",j=f&&S&&m&&!!W(_);J.disabled=!j||B,J.hidden=!m,f?B||(J.textContent="Push series"):J.textContent="Enable Apicurio to push series"}if(G){const B=G.dataset.loading==="true",j=f&&S;G.disabled=!j||B,B||(f?S?G.textContent="List artifacts":G.textContent="Enter details to list":G.textContent="Enable Apicurio to list")}}function De(){Se(),Q()?ke()?(M("Apicurio push is ready when a model is selected.","muted"),ue.size||ce("Click “List artifacts” to browse the current group.")):(M("Enter Apicurio connection details to enable push.","muted"),Ge("Enter registry details to browse artifacts.")):(M("Apicurio integration is off. Enable it to allow pushes.","muted"),Ge("Apicurio integration is disabled.")),ge()}function Je(){if(window!=null&&window.localStorage)try{localStorage.setItem(Cr,JSON.stringify(O))}catch(l){console.warn("[Blockscape] unable to persist Apicurio settings",l)}}function We(){let l={};if(window!=null&&window.localStorage)try{const B=localStorage.getItem(Cr);if(B){const j=JSON.parse(B);j&&typeof j=="object"&&(l=j)}}catch(B){console.warn("[Blockscape] failed to restore Apicurio settings",B)}const f=ye(l.baseUrl??go),S=(l.groupId??Ci).toString().trim();let _=bo,m=vo;typeof l.enabled=="boolean"?_=l.enabled:typeof l.enabled=="string"&&(_=l.enabled==="true"),typeof l.useSemver=="boolean"?m=l.useSemver:typeof l.useSemver=="string"&&(m=l.useSemver==="true"),O.baseUrl=f||go,O.groupId=S||Ci,O.authToken=(l.authToken??"").toString().trim(),O.enabled=_,O.useSemver=m,De(),He()}function Ne(){const l={Accept:"application/json"},f=(O.authToken||"").trim();return f&&(l.Authorization=/\s/.test(f)?f:`Bearer ${f}`),l}function Le(l,f,{title:S,description:_,version:m}={}){const B={artifactId:l,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:f},metadata:{properties:{}}}};m&&(B.firstVersion.version=m),S&&(B.name=S),_&&(B.description=_);try{const j=JSON.parse(f),P=j==null?void 0:j.seriesId;P&&typeof P=="string"&&(B.firstVersion.metadata.properties.seriesId=P)}catch{}return B}function at(l,{version:f}={}){const S={content:{contentType:"application/json",content:l},metadata:{properties:{}}};try{const _=JSON.parse(l),m=_==null?void 0:_.seriesId;m&&typeof m=="string"&&(S.metadata.properties.seriesId=m)}catch{}return f&&(S.version=f),S}function ut(l){if(l==null)return null;const f=String(l).trim();if(!f)return null;const S=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(f);if(S)return{major:Number(S[1]),minor:Number(S[2]),patch:Number(S[3])};const _=/^v?(\d+)$/.exec(f);return _?{major:Number(_[1]),minor:0,patch:0}:null}function k(l){return`${l.major}.${l.minor}.${l.patch}`}function g(l,f){return!l&&!f?0:l?f?l.major!==f.major?l.major-f.major:l.minor!==f.minor?l.minor-f.minor:l.patch-f.patch:1:-1}function Ie(l=[]){let f=null;if(l.forEach(_=>{const m=ut((_==null?void 0:_.version)??_);m&&(!f||g(m,f)>0)&&(f=m)}),!f)return"1.0.0";const S={...f,patch:f.patch+1};return k(S)}function W(l,{seriesName:f,fallbackTitle:S}={}){var B;if(!l)return null;const _=f||l.title||l.apicurioArtifactName||y(l),m=S||_;if(typeof E=="function"&&(l.isSeries||((B=l.apicurioVersions)==null?void 0:B.length)>1)&&E(l,{seriesName:_,fallbackTitle:m}),typeof $=="function"){const j=$(l,{seriesName:_,fallbackTitle:m});if(j)return j}return R(l)}function ne(l){return Array.isArray(l)?l:Array.isArray(l==null?void 0:l.artifacts)?l.artifacts:Array.isArray(l==null?void 0:l.items)?l.items:Array.isArray(l==null?void 0:l.results)?l.results:[]}function Te(l){return Array.isArray(l)?l:Array.isArray(l==null?void 0:l.versions)?l.versions:Array.isArray(l==null?void 0:l.items)?l.items:[]}function L(l=[]){if(!Array.isArray(l)||!l.length)return null;const f=[...l].filter(Boolean);return f.sort((S,_)=>{const m=S!=null&&S.createdOn?new Date(S.createdOn).getTime():0,B=_!=null&&_.createdOn?new Date(_.createdOn).getTime():0;if(m!==B)return B-m;const j=Number(S==null?void 0:S.version),P=Number(_==null?void 0:_.version),ae=Number.isFinite(j),te=Number.isFinite(P);if(ae&&te&&j!==P)return P-j;const ie=String((S==null?void 0:S.version)??"");return String((_==null?void 0:_.version)??"").localeCompare(ie,void 0,{numeric:!0})}),f[0]||null}function oe(l){if(!l)return l;let f=l;if(!Array.isArray(l==null?void 0:l.categories)){const _=l==null?void 0:l.content;if(typeof _=="string")try{f=JSON.parse(_)}catch(m){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",m)}else _&&typeof _=="object"&&(f=_)}return f}async function Fe(l,f,S){const _=encodeURIComponent(f),m=encodeURIComponent(S),B=`${l}/groups/${_}/artifacts/${m}`,j=Ne();j.Accept="application/json";const P=await fetch(B,{method:"GET",headers:j});if(!P.ok){let ae=P.statusText||"Unknown error";try{const te=await P.text();te&&(ae=te.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${P.status}): ${ae}`)}return P.json()}async function Be(l,f,S){const _=encodeURIComponent(f),m=encodeURIComponent(S),B=`${l}/groups/${_}/artifacts/${m}/versions?limit=50&order=desc`,j=Ne();j.Accept="application/json";const P=await fetch(B,{method:"GET",headers:j});if(!P.ok){let te=P.statusText||"Unknown error";try{const ie=await P.text();ie&&(te=ie.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${P.status}): ${te}`)}const ae=await P.json();return Te(ae).filter(te=>te&&te.version!=null)}async function mt(l,f,S,_="latest"){const m=encodeURIComponent(f),B=encodeURIComponent(S),j=encodeURIComponent(_||"latest"),P=`${l}/groups/${m}/artifacts/${B}/versions/${j}/content`,ae=Ne();ae.Accept="application/json, application/*+json, */*;q=0.8";const te=await fetch(P,{method:"GET",headers:ae});if(!te.ok){let qe=te.statusText||"Unknown error";try{const me=await te.text();me&&(qe=me.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${te.status}): ${qe}`)}const ie=await te.text();let ve=null;try{ve=JSON.parse(ie)}catch{throw new Error("Artifact content is not valid JSON.")}return oe(ve)}async function et(l,f,S,_="latest"){const m=await mt(l,f,S,_);return{data:m,fingerprint:q(m)}}async function Ot(l,f,S){try{const m=await Be(l,f,S);if(m!=null&&m.length){re.set(S,m);const B=L(m);if((B==null?void 0:B.version)!=null)return B.version}}catch(m){console.warn("[Blockscape] compare-version: unable to fetch versions list",m)}try{const m=await Fe(l,f,S);if((m==null?void 0:m.version)!=null)return m.version}catch(m){console.warn("[Blockscape] compare-version: unable to fetch metadata",m)}const _=re.get(S);if(_&&_.length){const m=L(_);if((m==null?void 0:m.version)!=null)return m.version}return"latest"}async function Xe(l,f,S,_){if(!O.useSemver)return null;if(!_)return"1.0.0";try{const m=await Be(l,f,S);return Ie(m)}catch(m){throw new Error(`Unable to compute next semantic version: ${m.message}`)}}function fe(l=document){le=l.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),J=l.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),G=l.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),he=l.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),be=l.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),Ve=l.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),D=l.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),K=l.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),ee=l.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),Y=l.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function Ee(){O.baseUrl=ye((he==null?void 0:he.value)??O.baseUrl),O.groupId=((be==null?void 0:be.value)??"").trim(),O.authToken=((Ve==null?void 0:Ve.value)??"").trim(),Je(),De()}function Ht(l){O.enabled=l!==!1,Je(),De(),He()}function si(){Ht(D?D.checked:bo)}function li(){O.useSemver=K?K.checked:vo,Je(),De()}function ci(){[he,be,Ve].forEach(l=>{l&&l.addEventListener("input",Ee)}),le&&le.addEventListener("click",()=>{tn()}),J&&J.addEventListener("click",()=>{Bn()}),D&&D.addEventListener("change",si),K&&K.addEventListener("change",li),G&&G.addEventListener("click",nn),Y&&Y.addEventListener("click",l=>{const f=l.target.closest("[data-artifact-version]");if(f){l.stopPropagation();const m=f.dataset.artifactId,B=f.dataset.artifactVersion;m&&B&&on(m,B);return}const S=l.target.closest("[data-artifact-load-all]");if(S){l.stopPropagation(),S.dataset.artifactId&&$n();return}const _=l.target.closest("[data-artifact-trigger]");if(_){const m=_.dataset.artifactId;if(!m)return;Ft(m)}})}function zt(){const l=document.createElement("div");return l.className="blockscape-registry-panel",l.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,l}function Dt(l){if(!l)return;l.innerHTML="";const f=zt();l.appendChild(f),fe(l),ci(),De()}function kt(l){if(!Y)return;if(Y.innerHTML="",!l.length){ce("No artifacts found in this group.");return}const f=m=>{const B=document.createElement("section");B.className="apicurio-artifact-section";const j=document.createElement("h3");j.textContent=m,B.appendChild(j);const P=document.createElement("ul");return P.className="apicurio-artifact-list",B.appendChild(P),{section:B,list:P}},S=f("Series artifacts"),_=f("Artifacts");l.forEach(m=>{if(!(m!=null&&m.artifactId))return;const j=m._groupId&&m._groupId.endsWith(xr)?S.list:_.list,P=document.createElement("li"),ae=document.createElement("button");ae.type="button",ae.className="apicurio-artifact",ae.dataset.artifactId=m.artifactId,ae.dataset.artifactTrigger="toggle";const te=document.createElement("span");te.className="apicurio-artifact-title",te.textContent=m.artifactId,ae.appendChild(te);const ie=[];if(m.name&&ie.push(m.name),m.version!=null&&ie.push(`v${m.version}`),m.type&&ie.push(m.type),m._groupId&&ie.push(m._groupId),ie.length){const me=document.createElement("span");me.className="apicurio-artifact-meta",me.textContent=ie.join(" • "),ae.appendChild(me)}if(m.description){const me=document.createElement("span");me.className="apicurio-artifact-meta",me.textContent=m.description,ae.appendChild(me)}P.appendChild(ae);const ve=document.createElement("div");ve.className="apicurio-version-list",ve.dataset.versionPanel=m.artifactId,ve.hidden=!0;const qe=document.createElement("p");qe.className="apicurio-hint",qe.textContent="Click to load the latest or open versions.",ve.appendChild(qe),P.appendChild(ve),j.appendChild(P)}),S.list.children.length&&Y.appendChild(S.section),_.list.children.length&&Y.appendChild(_.section)}function wt(l){return Y?Y.querySelector(`[data-version-panel="${l}"]`):null}function St(l,f){if(!l||(l.innerHTML="",!f))return;const S=document.createElement("p");S.className="apicurio-hint",S.textContent=f,l.appendChild(S)}function mn(l,f){const S=wt(l);if(S){if(S.innerHTML="",!f.length){St(S,"No versions found for this artifact.");return}f.forEach(_=>{const m=document.createElement("button");m.type="button",m.className="apicurio-version-button",m.dataset.artifactId=l,m.dataset.artifactVersion=_.version;const B=[`Version ${_.version}`];if(_.createdOn){const j=new Date(_.createdOn);isNaN(j)||B.push(j.toISOString().slice(0,10))}m.textContent=B.join(" — "),S.appendChild(m)})}}async function Ft(l){const f=wt(l);if(!f)return;if(f.dataset.open==="true"){f.hidden=!0,f.dataset.open="false";return}if(f.hidden=!1,f.dataset.open="true",f.dataset.loaded!=="true"){if(!ke()){St(f,"Enter registry details first.");return}St(f,"Loading versions…");try{const _=ye(O.baseUrl),m=ue.get(l),B=O.groupId.trim(),j=(m==null?void 0:m._groupId)||B,P=await Be(_,j,l);re.set(l,P),f.dataset.loaded="true",mn(l,P)}catch(_){console.error("[Blockscape] failed to load versions",_),St(f,`Unable to fetch versions: ${_.message}`)}}}function hn(l,f){var _;const S=s.findIndex(m=>m.apicurioArtifactId===l);if(S!==-1){const m=s[S].id;s[S]={...f,id:m||f.id},((_=s[S].apicurioVersions)==null?void 0:_.length)>1&&(s[S].isSeries=!0),p(S)}else s.push(f),p(s.length-1)}async function en(l,f,S,_){const m=encodeURIComponent(f),B=encodeURIComponent(S),j=`${l}/groups/${m}/artifacts/${B}`;try{const P=await fetch(j,{method:"GET",headers:_});if(P.status===404)return!1;if(P.ok)return!0;throw P.status===401||P.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${P.status} while checking the artifact.`)}catch(P){throw P instanceof TypeError?new Error("Network error while contacting Apicurio registry."):P}}async function tn(){var j;if(!le||le.dataset.loading==="true")return;if(!Q()){M("Apicurio integration is off. Enable it first.","error");return}if(!ke()){M("Enter the registry base URL and group ID before pushing.","error");return}const l=c();if(l<0||!s[l]){M("No active model to push.","error");return}const f=W(s[l],{fallbackTitle:y(s[l])});if(!f){M("Active model needs an id before pushing.","error");return}const S=ye(O.baseUrl),_=O.groupId.trim(),m=JSON.stringify(s[l].data,null,2),B=Ne();le.dataset.loading="true",le.textContent="Pushing…",le.disabled=!0,M("Pushing to Apicurio…","muted");try{const P=await en(S,_,f,B),ae=q(s[l].data);if(P)try{const Me=await Ot(S,_,f),{data:it,fingerprint:ot}=await et(S,_,f,Me);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",Me),console.log("local fingerprint",ae),console.log("registry fingerprint",ot),console.log("local payload",s[l].data),console.log("registry payload",it),console.groupEnd(),ae&&ot&&ae===ot){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){M("Push cancelled (content matches the latest registry version).","muted");return}M("Pushing identical content by user choice.","muted")}else ot?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):M("Unable to compare with registry content (skipping confirmation).","muted")}catch(Me){console.warn("[Blockscape] unable to compare registry content before push",Me),M("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const te=O.useSemver?await Xe(S,_,f,P):null;if(O.useSemver&&!te)throw new Error("Semantic versioning is enabled but no version could be computed.");const ie=encodeURIComponent(_),ve=encodeURIComponent(f),qe=P?`${S}/groups/${ie}/artifacts/${ve}/versions`:`${S}/groups/${ie}/artifacts`,me={...B,"Content-Type":"application/json"};te&&(me["X-Registry-Version"]=te,M(`Pushing to Apicurio as version ${te}…`,"muted"));const tt=P?at(m,{version:te}):Le(f,m,{title:y(s[l]),description:(j=s[l].data)==null?void 0:j.abstract,version:te}),ht=await fetch(qe,{method:"POST",headers:me,body:JSON.stringify(tt)});if(!ht.ok){let Me=ht.statusText||"Unknown error";try{const it=await ht.text();it&&(Me=it.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${ht.status}): ${Me}`)}let nt=null;try{nt=await ht.json()}catch{nt=null}const we=(nt==null?void 0:nt.version)||(nt==null?void 0:nt.globalId)||"",Pe=P?"Updated":"Created",yt=we?` (version ${we})`:"";M(`${Pe} ${f}${yt}`,"success")}catch(P){console.error("[Blockscape] Apicurio push failed",P),M(`Apicurio push failed: ${P.message}`,"error")}finally{le.dataset.loading="false",ge()}}async function Bn(){var te,ie;if(!J||J.dataset.loading==="true")return;if(!Q()){M("Apicurio integration is off. Enable it first.","error");return}if(!ke()){M("Enter the registry base URL and group ID before pushing.","error");return}const l=c(),f=l>=0?s[l]:null;if(!f||!f.apicurioVersions||f.apicurioVersions.length<2){M("Series push requires a model with multiple versions.","error");return}const S=W(f,{seriesName:f.title||f.apicurioArtifactName||y(f)});if(!S){M("Active series needs an id before pushing.","error");return}typeof E=="function"&&E(f,{seriesName:f.title||f.apicurioArtifactName||y(f)});const _=ye(O.baseUrl),m=O.groupId.trim(),B=f.apicurioVersions.map(ve=>ve.data),j=JSON.stringify(B,null,2),P=Ne(),ae=pe(m);J.dataset.loading="true",J.textContent="Pushing…",J.disabled=!0,M("Pushing series to Apicurio…","muted");try{const ve=await en(_,ae,S,P),qe=q(B);if(ve)try{const gt=await Ot(_,ae,S),{data:jt,fingerprint:Jt}=await et(_,ae,S,gt);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",gt),console.log("local fingerprint",qe),console.log("registry fingerprint",Jt),console.log("local payload (series)",B),console.log("registry payload",jt),console.groupEnd(),qe&&Jt&&qe===Jt){if(!window.confirm("The current registry version matches this series. Push anyway?")){M("Series push cancelled (content matches latest).","muted");return}M("Pushing identical series by user choice.","muted")}else Jt?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):M("Unable to compare with registry content (skipping confirmation).","muted")}catch(gt){console.warn("[Blockscape] unable to compare registry content before series push",gt),M("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const me=O.useSemver?await Xe(_,ae,S,ve):null;if(O.useSemver&&!me)throw new Error("Semantic versioning is enabled but no version could be computed.");const tt=encodeURIComponent(ae),ht=encodeURIComponent(S),nt=ve?`${_}/groups/${tt}/artifacts/${ht}/versions`:`${_}/groups/${tt}/artifacts`,we={...P,"Content-Type":"application/json"};me&&(we["X-Registry-Version"]=me,M(`Pushing series to Apicurio as version ${me}…`,"muted"));const Pe=ve?at(j,{version:me}):Le(S,j,{title:f.apicurioArtifactName||((te=f.data)==null?void 0:te.title)||S,description:(ie=f.data)==null?void 0:ie.abstract,version:me}),yt=await fetch(nt,{method:"POST",headers:we,body:JSON.stringify(Pe)});if(!yt.ok){let gt=yt.statusText||"Unknown error";try{const jt=await yt.text();jt&&(gt=jt.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${yt.status}): ${gt}`)}let Me=null;try{Me=await yt.json()}catch{Me=null}const it=(Me==null?void 0:Me.version)||(Me==null?void 0:Me.globalId)||"",ot=ve?"Updated":"Created",Mt=it?` (version ${it})`:"";M(`${ot} ${S} series${Mt}`,"success")}catch(ve){console.error("[Blockscape] Apicurio series push failed",ve),M(`Apicurio series push failed: ${ve.message}`,"error")}finally{J.dataset.loading="false",ge()}}async function nn(){if(!G||G.dataset.loading==="true")return;if(!Q()){M("Enable Apicurio integration to list artifacts.","error");return}if(!ke()){M("Enter registry base URL and group ID before listing.","error");return}const l=ye(O.baseUrl),f=O.groupId.trim(),S=pe(f),_=[{groupId:f,label:"base"},{groupId:S,label:"series"}];G.dataset.loading="true",G.textContent="Listing…",G.disabled=!0,M("Listing artifacts…","muted"),ce("Contacting registry…");try{const m=Ne();m.Accept="application/json";const B=[];for(const P of _){const ae=encodeURIComponent(P.groupId),te=`${l}/groups/${ae}/artifacts?limit=50&offset=0`,ie=await fetch(te,{method:"GET",headers:m});if(!ie.ok){let me=ie.statusText||"Unknown error";try{const tt=await ie.text();tt&&(me=tt.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${P.groupId} (${ie.status}): ${me}`);continue}const ve=await ie.json(),qe=ne(ve).filter(me=>me&&me.artifactId);qe.forEach(me=>{me&&(me._groupId=P.groupId)}),B.push(...qe)}ue.clear(),re.clear(),B.forEach(P=>{P!=null&&P.artifactId&&ue.set(P.artifactId,P)}),kt(B);const j=B.length;M(j?`Found ${j} artifact${j===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",j?"success":"muted")}catch(m){console.error("[Blockscape] failed to list artifacts",m),Ge("Unable to list artifacts."),M(`Listing failed: ${m.message}`,"error")}finally{G.dataset.loading="false",ge()}}async function on(l,f=null){var ve,qe,me,tt,ht,nt;if(!l)return;if(!Q()){M("Enable Apicurio integration to load artifacts.","error");return}if(!ke()){M("Enter registry connection details before loading artifacts.","error");return}const S=ye(O.baseUrl),_=O.groupId.trim(),m=l&&((ve=ue.get(l))==null?void 0:ve._groupId)||_;let B=ue.get(l);const j=async()=>{try{const we=await Fe(S,m,l);return we!=null&&we.artifactId&&ue.set(l,we),we}catch(we){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",we),we}};if(!B)try{B=await j()}catch(we){M(`Failed to fetch artifact metadata: ${we.message}`,"error");return}const P=re.get(l)||[];let ae="latest",te="latest";if(f)ae=f,te=f;else{if(!B||B.version==null)try{B=await j()}catch(we){M(`Failed to fetch artifact metadata: ${we.message}`,"error");return}ae=(B==null?void 0:B.version)||"latest",te=(B==null?void 0:B.version)||"latest"}const ie=P.find(we=>String(we.version)===String(ae));(ie==null?void 0:ie.version)!=null&&(te=ie.version),M(`Loading artifact ${l}…`,"muted");try{const we=await mt(S,m,l,ae),Pe=ue.get(l)||B||{},yt=Array.isArray(we);let Me=null;if(yt){const it=we.map((Mt,gt)=>(I(Mt,{titleHint:Pe.name||l,idHint:l}),{version:String(gt+1),data:Mt,createdOn:(ie==null?void 0:ie.createdOn)||Pe.createdOn}));Me={id:Z(),title:((me=(qe=it[0])==null?void 0:qe.data)==null?void 0:me.title)||Pe.name||l,data:(tt=it[0])==null?void 0:tt.data,apicurioArtifactId:l,apicurioArtifactName:Pe.name||"",apicurioVersions:it,apicurioActiveVersionIndex:0,isSeries:!0};const ot=((ht=Pe==null?void 0:Pe.properties)==null?void 0:ht.seriesId)||l;typeof E=="function"&&E(Me,{seriesName:ot,fallbackTitle:ot}),M(`Loaded series artifact ${l}.`,"success")}else{I(we,{titleHint:Pe.name||l,idHint:l});const it={version:te,data:we,createdOn:(ie==null?void 0:ie.createdOn)||Pe.createdOn};Me={id:Z(),title:we.title||Pe.name||l,data:we,apicurioArtifactId:l,apicurioArtifactName:Pe.name||"",apicurioVersions:[it],apicurioActiveVersionIndex:0};const ot=(nt=Pe==null?void 0:Pe.properties)==null?void 0:nt.seriesId;ot&&typeof E=="function"&&E(Me,{seriesName:ot,fallbackTitle:ot});const Mt=te?` (version ${te})`:"";M(`Loaded artifact ${l}${Mt}.`,"success")}hn(l,Me)}catch(we){console.error("[Blockscape] failed to load artifact",we),M(`Failed to load artifact: ${we.message}`,"error")}}async function $n(l){}return{hydrateConfig:We,mount:Dt,updateAvailability:ge,isEnabled:Q,setEnabled:Ht,onEnabledChange:Qe}}function xn(s,c){if(typeof s!="function")throw new Error(`[itemEditor] expected ${c} to be a function`)}function cl(s,{excludeId:c}={}){if(!s)return[];const p=s.split(/[\s,]+/).map(E=>E.trim()).filter(Boolean),I=[];return p.forEach(E=>{c&&E===c||I.includes(E)||I.push(E)}),I}function dl(s,c,p){if(!c||!p||c===p)return;((s==null?void 0:s.categories)||[]).forEach(E=>{(E.items||[]).forEach(R=>{Array.isArray(R.deps)&&(R.deps=R.deps.map($=>$===c?p:$))})}),Array.isArray(s==null?void 0:s.links)&&s.links.forEach(E=>{E.from===c&&(E.from=p),E.to===c&&(E.to=p)})}function ul({findItemAndCategoryById:s,collectAllItemIds:c,updateItemReferences:p,loadActiveIntoEditor:I,rebuildFromActive:E,select:R,onSelectionRenamed:$}={}){xn(s,"findItemAndCategoryById"),xn(c,"collectAllItemIds"),xn(p,"updateItemReferences"),xn(I,"loadActiveIntoEditor"),xn(E,"rebuildFromActive"),xn(R,"select");const y={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null};function q(D){if(y.fields.errorEl){if(!D){y.fields.errorEl.hidden=!0,y.fields.errorEl.textContent="";return}y.fields.errorEl.hidden=!1,y.fields.errorEl.textContent=D}}function Z(){y.wrapper&&(y.wrapper.hidden=!0,y.wrapper.setAttribute("aria-hidden","true"),q(""),y.categoryId=null,y.itemId=null,y.modelData=null,document.body.classList.remove("item-editor-open"))}function le(){y.wrapper&&(y.wrapper.hidden=!1,y.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var D,K;(D=y.fields.nameInput)==null||D.focus(),(K=y.fields.nameInput)==null||K.select()}))}function G(D){var ye;if(!y.modelData||!y.categoryId||!y.itemId)throw new Error("No item loaded.");const ee=(((ye=y.modelData)==null?void 0:ye.categories)||[]).find(pe=>pe.id===y.categoryId);if(!ee)throw new Error("Category not found.");ee.items=ee.items||[];const J=ee.items.find(pe=>pe.id===y.itemId);if(!J)throw new Error("Item not found.");const Y=(D.id||"").trim();if(!Y)throw new Error("ID is required.");const Oe=c(y.modelData);if(Y!==J.id&&Oe.has(Y))throw new Error("Another item already uses that ID.");J.id=Y;const O=(D.name||"").trim();J.name=O||J.id;const ue=(D.logo||"").trim();if(ue?J.logo=ue:delete J.logo,D.externalFlag&&!D.external)J.external=!0;else{const pe=(D.external??"").toString().trim();pe?J.external=pe:delete J.external}const re=(D.color||"").trim();return re?J.color=re:delete J.color,J.deps=Array.isArray(D.deps)?D.deps:[],J.id!==D.originalId&&typeof $=="function"&&$(D.originalId,J.id),p(y.modelData,D.originalId,J.id),I(),E(),R(J.id),J.id}function he(){if(!y.fields||!y.fields.idInput)return!1;const D=(y.fields.idInput.value||"").trim(),K={originalId:y.itemId,id:D,name:y.fields.nameInput.value||"",logo:y.fields.logoInput.value||"",external:y.fields.externalInput.value||"",externalFlag:y.fields.externalFlagInput.checked,color:y.fields.colorInput.value||"",deps:cl(y.fields.depsInput.value,{excludeId:D})};try{return G(K),Z(),!0}catch(ee){return console.warn("[itemEditor] item edit failed",ee),q((ee==null?void 0:ee.message)||"Unable to save item."),!1}}function be(){if(y.wrapper)return y.wrapper;const D=document.createElement("div");D.className="item-editor-modal",D.hidden=!0,D.setAttribute("role","dialog"),D.setAttribute("aria-modal","true");const K=document.createElement("div");K.className="item-editor-modal__backdrop",D.appendChild(K);const ee=document.createElement("div");ee.className="item-editor",D.appendChild(ee);const J=document.createElement("div");J.className="item-editor__header";const Y=document.createElement("h2");Y.className="item-editor__title",Y.textContent="Edit item";const Oe=document.createElement("button");Oe.type="button",Oe.className="item-editor__close",Oe.setAttribute("aria-label","Close item editor"),Oe.textContent="×",J.appendChild(Y),J.appendChild(Oe),ee.appendChild(J);const O=document.createElement("form");O.className="item-editor__form",ee.appendChild(O);const ue=document.createElement("div");ue.className="item-editor__meta",ue.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',O.appendChild(ue);const re=document.createElement("div");re.className="item-editor__error",re.hidden=!0,O.appendChild(re);const ye=(Le,at,ut)=>{const k=document.createElement("label");k.className="item-editor__field";const g=document.createElement("span");if(g.className="item-editor__label",g.textContent=Le,k.appendChild(g),at.classList.add("item-editor__control"),k.appendChild(at),ut){const Ie=document.createElement("div");Ie.className="item-editor__hint",Ie.textContent=ut,k.appendChild(Ie)}return k},pe=document.createElement("input");pe.type="text",pe.required=!0,O.appendChild(ye("ID",pe,"Unique identifier used for links and dependencies."));const ke=document.createElement("input");ke.type="text",O.appendChild(ye("Name",ke,"Visible label shown on the tile."));const Q=document.createElement("input");Q.type="url",Q.inputMode="url",Q.placeholder="https://…",O.appendChild(ye("Logo URL",Q,"Optional image URL."));const He=document.createElement("input");He.type="url",He.inputMode="url",He.placeholder="https://…",O.appendChild(ye("External link",He,"Shown with ↗ icon and in preview."));const Qe=document.createElement("div");Qe.className="item-editor__checkbox";const Se=document.createElement("label");Se.className="item-editor__checkbox-row";const M=document.createElement("input");M.type="checkbox";const ce=document.createElement("span");ce.textContent="Mark as external without link";const Ge=document.createElement("div");Ge.className="item-editor__hint",Ge.textContent="Keeps dashed border even without a URL.",Se.appendChild(M),Se.appendChild(ce),Qe.appendChild(Se),Qe.appendChild(Ge),O.appendChild(Qe);const ge=document.createElement("input");ge.type="text",ge.placeholder="#2563eb",O.appendChild(ye("Color",ge,"Optional badge color (hex or CSS color)."));const De=document.createElement("textarea");De.rows=2,De.placeholder="Comma or space separated ids",O.appendChild(ye("Dependencies",De,"Use item IDs, separated by commas or spaces."));const Je=document.createElement("div");Je.className="item-editor__actions";const We=document.createElement("button");We.type="button",We.className="pf-v5-c-button pf-m-tertiary",We.textContent="Cancel";const Ne=document.createElement("button");return Ne.type="submit",Ne.className="pf-v5-c-button pf-m-primary",Ne.textContent="Save",Je.appendChild(We),Je.appendChild(Ne),O.appendChild(Je),y.wrapper=D,y.fields={idInput:pe,nameInput:ke,logoInput:Q,externalInput:He,externalFlagInput:M,colorInput:ge,depsInput:De,categoryValue:ue.querySelector(".item-editor__meta-value"),errorEl:re},We.addEventListener("click",Z),Oe.addEventListener("click",Z),K.addEventListener("click",Z),O.addEventListener("submit",Le=>{Le.preventDefault(),he()}),document.addEventListener("keydown",Le=>{Le.key==="Escape"&&!D.hidden&&(Le.preventDefault(),Le.stopPropagation(),Z())}),document.body.appendChild(D),D}function Ve(D){const K=s(D);return K?(be(),y.categoryId=K.category.id,y.itemId=K.item.id,y.modelData=K.modelData,y.fields.categoryValue.textContent=K.category.title||K.category.id,y.fields.idInput.value=K.item.id||"",y.fields.nameInput.value=K.item.name||"",y.fields.logoInput.value=K.item.logo||"",y.fields.externalInput.value=typeof K.item.external=="string"?K.item.external:"",y.fields.externalFlagInput.checked=K.item.external===!0,y.fields.colorInput.value=K.item.color||"",y.fields.depsInput.value=Array.isArray(K.item.deps)?K.item.deps.join(", "):"",q(""),R(K.item.id),le(),!0):!1}return{open:Ve,hide:Z,isOpen:()=>!!y.wrapper&&!y.wrapper.hidden}}function Ar(s,c="series"){return(s||c).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||c}function Qt(s,c="series"){const p=Ar(s,c).replace(/\./g,"-");return p.replace(/-series$/i,"").replace(/-+$/,"")||p||Ar(c,"series")}function Pr(s,{seriesName:c,fallbackTitle:p="unknown"}={}){var y,q;const E=[s==null?void 0:s.seriesId,(y=s==null?void 0:s.data)==null?void 0:y.seriesId,s==null?void 0:s.apicurioArtifactId,c,s==null?void 0:s.title,s==null?void 0:s.apicurioArtifactName,(q=s==null?void 0:s.data)==null?void 0:q.title,p].map(Z=>(Z??"").toString().trim()),R=E.findIndex(Boolean),$=R!==-1?E[R]:"";return $?(console.log("[Series] deriveSeriesId: picked base",{base:$,sourceIndex:R,candidates:E}),Qt($,p)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:p}),null)}function vt(s,{seriesName:c,fallbackTitle:p="unknown"}={}){if(!s||typeof s!="object")return null;const I=Pr(s,{seriesName:c,fallbackTitle:p});return I?(s.seriesId=I,s.apicurioArtifactId||(s.apicurioArtifactId=I),I):null}function An(s,c={}){var E,R;if(!s)return null;const p=s.isSeries||((E=s.apicurioVersions)==null?void 0:E.length)>1||s.seriesId||((R=s.data)==null?void 0:R.seriesId)||s.apicurioArtifactId;if(!p&&!c.force)return null;const I=Pr(s,c);return I||(p?Qt(c.fallbackTitle||"unknown"):null)}const xi=typeof import.meta<"u"&&"./"||"";function pl(){console.log("[Blockscape] init");const s=document.getElementById("jsonBox"),c=document.querySelector(".blockscape-json-panel"),p=document.getElementById("app"),I=document.getElementById("overlay"),E=document.getElementById("tabTooltip"),R=document.getElementById("modelList"),$=document.getElementById("itemPreview"),y=document.getElementById("urlForm"),q=document.getElementById("urlInput"),Z=document.getElementById("loadUrl"),le=$.querySelector(".item-preview__title"),G=$.querySelector(".item-preview__body"),he=$.querySelector(".item-preview__actions"),be=$.querySelector(".item-preview__close"),Ve=document.getElementById("downloadJson"),D=document.getElementById("shareModel"),K=document.getElementById("createVersion"),ee=document.getElementById("openInEditor"),J=document.getElementById("copyJson"),Y=document.getElementById("copySeries"),Oe=document.getElementById("pasteJson"),O=document.getElementById("helpButton"),ue=document.getElementById("newPanelButton"),re=document.getElementById("shortcutHelp"),ye=document.getElementById("shortcutHelpList"),pe=document.getElementById("shortcutHelpClose"),ke=document.getElementById("shortcutHelpBackdrop"),Q=document.getElementById("newPanel"),He=document.getElementById("newPanelClose"),Qe=document.getElementById("newPanelBackdrop"),Se=document.getElementById("search"),M=document.getElementById("searchResults"),ce=document.getElementById("localBackendPanel"),Ge=document.getElementById("localBackendStatus"),ge=document.getElementById("localFileList"),De=document.getElementById("refreshLocalFiles"),Je=document.getElementById("loadLocalFile"),We=document.getElementById("saveLocalFile"),Ne=document.getElementById("localSavePath"),Le="blockscape:editorPayload",at="blockscape:editorTransfer",ut=document.title;ce&&(ce.hidden=!0),s.value=document.getElementById("seed").textContent.trim();let k=[],g=-1;const Ie=ll({models:k,getActiveIndex:()=>g,setActive:lt,ensureModelMetadata:an,getModelId:Ze,getSeriesId:An,ensureSeriesId:vt,getModelTitle:Re,computeJsonFingerprint:pi,uid:rn});let W=null,ne=new Map,Te=new Map,L=null,oe=null,Fe=null,Be=null,mt=!0,et=!1,Ot=0,Xe={x:0,y:0},fe="map",Ee=null,Ht=null,si=!1,li=null;const ci=2e3;let zt=null,Dt=null,kt=null,wt=null,St=null,mn=null,Ft=null,hn="",en=!1,tn=null,Bn=null,nn=null,on=[],$n=null;const l=Jr(),f=30,S=1e3,_="blockscape:hoverScale",m=1.5,B=1,j=2.5,P="blockscape:titleWrap",ae="blockscape:titleHoverWidth",te="blockscape:titleHoverTextPortion",ie="wrap",ve=1.3,qe=1,me=1.6,tt=.25,ht=0,nt=.6,we="blockscape:tileCompactness",Pe=1,yt=.75,Me=1.25,it="blockscape:obsidianLinksEnabled",ot="blockscape:obsidianLinkMode",Mt="blockscape:obsidianVault",gt="title",jt="id",Jt=gt;let gn=m,On=Pe,Ao=ie,Mn=ve,Pn=tt,Rn=!1,di=Jt,Vn="";const Lo="blockscape:seriesNavDoubleClickMs",Un=900,No=300,To=4e3;let bn=Un;Ie.hydrateConfig(),Xr(),Qr(),ra(),ta(),ia(),la(),fa(),ua(),ha(),st();function rn(){return Math.random().toString(36).slice(2,10)}function Rr(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(i=>{n+=String.fromCharCode(i)}),btoa(n)}function Vr(e){const t=atob(e),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return new TextDecoder().decode(n)}function Ur(e){return Rr(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function Hr(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),Vr(t)}function Dr(e,t){const n=new Blob([t],{type:"application/json"}),i=URL.createObjectURL(n),o=document.createElement("a");o.href=i,o.download=e,o.click(),URL.revokeObjectURL(i)}function Fr(){if(typeof window>"u"||!window.location)return!1;const e=new URL(window.location.href),n=e.pathname.replace(/\/+$/,"").split("/").filter(Boolean).pop()||"",i=e.searchParams.get("server");return n.toLowerCase()==="server"||i&&["1","true","yes","on"].includes(i.toLowerCase())}function jr(){return typeof window>"u"||!window.location?!1:(window.location.hostname||"").toLowerCase().endsWith("github.io")}function Jr(){const e=()=>typeof window>"u"||!window.location?{}:{host:window.location.host,path:window.location.pathname,search:window.location.search,hash:window.location.hash};function t(T,H={}){console.log("[Blockscape][local-backend]",T,{...e(),...H})}if(jr())return t("Disabled on github.io host"),ce&&(ce.hidden=!0),{detect(){},refresh(){},updateActiveSavePlaceholder(){}};if(!Fr()||!ce||!Ge)return t("Opt-in flag missing or panel unavailable"),ce&&(ce.hidden=!0),{detect(){},refresh(){},updateActiveSavePlaceholder(){}};if(!ce||!Ge)return{detect(){},refresh(){},updateActiveSavePlaceholder(){}};let i=!1,o="",r=[];function a(T,{error:H=!1}={}){Ge.textContent=T,Ge.style.color=H?"#b42318":"",t("Status",{text:T,error:H})}function d(T){const H=(T||"").trim().replace(/\\/g,"/").replace(/^\/+/,"");return!H||H.includes("..")?null:H.toLowerCase().endsWith(".bs")?H:`${H}.bs`}function u(){var H;if(g>=0&&((H=k[g])!=null&&H.sourcePath))return k[g].sourcePath;if(g<0)return"blockscape.bs";const T=Re(k[g])||"blockscape";return`${Qt(T,"blockscape")}.bs`}function h(){var T;Ne&&(Ne.placeholder=u(),(T=k[g])!=null&&T.sourcePath&&(Ne.value=k[g].sourcePath))}function b(){if(ge){if(ge.innerHTML="",!r.length){const T=document.createElement("option");T.disabled=!0,T.textContent="No .bs files found yet",ge.appendChild(T),ge.disabled=!0;return}ge.disabled=!1,r.forEach(T=>{const H=document.createElement("option");H.value=T.path;const z=T.mtimeMs?new Date(T.mtimeMs).toLocaleString():"";H.textContent=z?`${T.path} · ${z}`:T.path,ge.appendChild(H)}),o&&Array.from(ge.options).forEach(T=>{T.value===o&&(T.selected=!0)}),!ge.value&&ge.options.length&&(ge.options[0].selected=!0)}}function A(T){i=!1,r=[],b(),ce.hidden=!0,T&&a(T,{error:!0}),t("Panel hidden",{message:T})}async function C({silent:T=!1}={}){try{t("Health check start");const H=await fetch("/api/health",{cache:"no-store"});if(!H.ok)throw new Error(`HTTP ${H.status}`);const z=await H.json();if(i=!!(z!=null&&z.ok),!i)throw new Error("Health check failed");return ce.hidden=!1,T||a(z.root?`Local server ready (root: ${z.root})`:"Local server ready"),t("Health check ok",{payload:z}),!0}catch(H){return T||console.log("[Blockscape] local backend health failed",H),A("Local server unavailable"),!1}}async function x(){if(i&&ge){a("Loading files…");try{const T=await fetch("/api/files",{cache:"no-store"});if(!T.ok)throw new Error(`HTTP ${T.status}`);r=(await T.json()).files||[],b(),a(r.length?`Browsing ${r.length} file(s) in ~/blockscape`:"No .bs files in ~/blockscape yet")}catch(T){console.warn("[Blockscape] local backend refresh failed",T),A("Local server unavailable")}}}async function F(){i=!1,A(),a("Checking for local server…");try{if(t("Detect start"),!await C())return;h(),await x()}catch(T){i=!1,console.log("[Blockscape] local backend not detected",T),t("Detect failed",{err:T})}}async function de(){if(!i||!ge)return;const T=Array.from(ge.selectedOptions||[]).map(z=>z.value).filter(Boolean);if(!T.length){alert("Select one or more files to load from ~/blockscape.");return}let H=null;for(const z of T)try{a(`Loading ${z}…`);const je=await fetch(`/api/file?path=${encodeURIComponent(z)}`,{cache:"no-store"});if(!je.ok)throw new Error(`HTTP ${je.status}`);const _e=await je.json(),$e=JSON.stringify(_e.data??_e,null,2),dt=Kt($e,z,{seriesTitleOverride:`${z} series`});if(!dt.length)throw new Error("No models found in file");dt.forEach((Rt,Vt)=>{Rt.sourcePath=z;const bt=Wt(Rt,{versionLabel:dt.length>1?`${z} #${Vt+1}`:z});H==null&&(H=bt)}),o=z}catch(je){console.error("[Blockscape] failed to load from local server",je),alert(`Local load failed for ${z}: ${je.message}`)}H!=null&&lt(H),a(`Loaded ${T.length} file(s)`),b()}async function xe(){var H;if(!i)return;if(g<0){alert("No active model to save.");return}const T=d(Ne==null?void 0:Ne.value)||d((H=k[g])==null?void 0:H.sourcePath)||u();if(!T){alert("Enter a relative path (no ..) to save under ~/blockscape.");return}try{const z=JSON.stringify(k[g].data,null,2);a(`Saving to ${T}…`);const je=await fetch(`/api/file?path=${encodeURIComponent(T)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:z});if(!je.ok)throw new Error(`HTTP ${je.status}`);const _e=await je.json();o=_e.path||T,k[g].sourcePath=_e.path||T,a(`Saved to ${_e.path||T}`),await x()}catch(z){console.error("[Blockscape] local save failed",z),alert(`Local save failed: ${z.message}`),A("Local server unavailable")}}return De&&(De.onclick=()=>x()),Je&&(Je.onclick=()=>de()),We&&(We.onclick=()=>xe()),ge&&Ne&&ge.addEventListener("change",()=>{const T=Array.from(ge.selectedOptions||[])[0];T!=null&&T.value&&(Ne.value=T.value)}),{detect:F,refresh:x,updateActiveSavePlaceholder:h}}async function Bo(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function Wr(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function Hn(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function qr(e){return Number.isFinite(e)?Math.min(j,Math.max(B,e)):m}function st(){if(!p)return;const e=!!L||!!oe;p.classList.toggle("blockscape-has-selection",e)}function Dn(e){return gn=qr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-scale",gn),gn}function Gr(e){return Number.isFinite(e)?Math.min(Me,Math.max(yt,e)):Pe}function Fn(e){return On=Gr(e),document.documentElement.style.setProperty("--blockscape-tile-compactness",On),On}function zr(e){return Number.isFinite(e)?Math.min(me,Math.max(qe,e)):ve}function jn(e){return Mn=zr(e),document.documentElement.style.setProperty("--blockscape-title-hover-width-multiplier",Mn),Mn}function Kr(e){return Number.isFinite(e)?Math.min(nt,Math.max(ht,e)):tt}function Jn(e){return Pn=Kr(e),document.documentElement.style.setProperty("--blockscape-tile-hover-text-portion",Pn),Pn}function Wn(e){const t=e==="nowrap"?"nowrap":"wrap";Ao=t;const n=t==="nowrap"?"nowrap":"normal",i=t==="nowrap"?"nowrap":"normal";return document.documentElement.style.setProperty("--blockscape-title-white-space",n),document.documentElement.style.setProperty("--blockscape-title-text-wrap",i),t}function Yr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(_,String(e))}catch(t){console.warn("[Blockscape] failed to persist hover scale",t)}}function Xr(){if(typeof window>"u"||!window.localStorage)return Dn(m);try{const e=window.localStorage.getItem(_);if(!e)return Dn(m);const t=parseFloat(e);return Dn(t)}catch(e){return console.warn("[Blockscape] failed to read hover scale",e),Dn(m)}}function Zr(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(we,String(e))}catch(t){console.warn("[Blockscape] failed to persist tile compactness",t)}}function Qr(){if(typeof window>"u"||!window.localStorage)return Fn(Pe);try{const e=window.localStorage.getItem(we);if(!e)return Fn(Pe);const t=parseFloat(e);return Fn(t)}catch(e){return console.warn("[Blockscape] failed to read tile compactness",e),Fn(Pe)}}function ea(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ae,String(e))}catch(t){console.warn("[Blockscape] failed to persist title hover width",t)}}function ta(){if(typeof window>"u"||!window.localStorage)return jn(ve);try{const e=window.localStorage.getItem(ae);if(!e)return jn(ve);const t=parseFloat(e);return jn(t)}catch(e){return console.warn("[Blockscape] failed to read title hover width",e),jn(ve)}}function na(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(te,String(e))}catch(t){console.warn("[Blockscape] failed to persist title text zoom",t)}}function ia(){if(typeof window>"u"||!window.localStorage)return Jn(tt);try{const e=window.localStorage.getItem(te);if(!e)return Jn(tt);const t=parseFloat(e);return Jn(t)}catch(e){return console.warn("[Blockscape] failed to read title text zoom",e),Jn(tt)}}function oa(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(P,e)}catch(t){console.warn("[Blockscape] failed to persist title wrap mode",t)}}function ra(){if(typeof window>"u"||!window.localStorage)return Wn(ie);try{const e=window.localStorage.getItem(P);return Wn(e||ie)}catch(e){return console.warn("[Blockscape] failed to read title wrap mode",e),Wn(ie)}}function aa(e){return Number.isFinite(e)?Math.min(To,Math.max(No,e)):Un}function qn(e){return bn=aa(e),bn}function sa(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Lo,String(e))}catch(t){console.warn("[Blockscape] failed to persist series double-click wait",t)}}function la(){if(typeof window>"u"||!window.localStorage)return qn(Un);try{const e=window.localStorage.getItem(Lo);if(!e)return qn(Un);const t=parseInt(e,10);return qn(t)}catch(e){return console.warn("[Blockscape] failed to read series double-click wait",e),qn(Un)}}function ca(e){return e===jt?jt:gt}function Gn(e){return di=ca(e),di}function da(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ot,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian link mode",t)}}function ua(){if(typeof window>"u"||!window.localStorage)return Gn(Jt);try{const e=window.localStorage.getItem(ot);return Gn(e||Jt)}catch(e){return console.warn("[Blockscape] failed to read Obsidian link mode",e),Gn(Jt)}}function zn(e){return Rn=!!e,Rn}function pa(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(it,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist Obsidian toggle",t)}}function fa(){if(typeof window>"u"||!window.localStorage)return zn(!1);try{const e=window.localStorage.getItem(it);return e==null?zn(!1):zn(e==="1")}catch(e){return console.warn("[Blockscape] failed to read Obsidian toggle",e),zn(!1)}}function Kn(e){return Vn=(e??"").toString().trim(),Vn}function ma(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Mt,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian vault",t)}}function ha(){if(typeof window>"u"||!window.localStorage)return Kn("");try{const e=window.localStorage.getItem(Mt);return Kn(e||"")}catch(e){return console.warn("[Blockscape] failed to read Obsidian vault",e),Kn("")}}function ga(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function ba(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const i=n.find(r=>r&&typeof r=="object")||n[0];return((i==null?void 0:i.title)??"").toString().trim()||`${t} series`}function ui(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t,e.data&&typeof e.data=="object"&&(e.data.seriesId=t),Array.isArray(e.apicurioVersions)&&e.apicurioVersions.forEach(n=>{n!=null&&n.data&&typeof n.data=="object"&&(n.data.seriesId=t)}))}function va(e){if(!e||typeof window>"u"||typeof window.prompt!="function")return!1;const t=(e.title??e.apicurioArtifactName??"").toString().trim()||Ni(e,"Series"),n=window.prompt("Series name",t);if(n==null)return!1;const i=n.trim();if(!i)return!1;const o=An(e,{seriesName:i,fallbackTitle:i})||Qt(i,i),r=window.prompt("Series ID (used for linking and downloads)",o);if(r==null)return!1;const a=Qt(r.trim()||i,i||"series");return e.title=i,e.apicurioArtifactName=i,ui(e,a),!0}function Li(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(i=>Li(i)).join(",")}]`:`{${Object.keys(e).sort().map(i=>`${JSON.stringify(i)}:${Li(e[i])}`).join(",")}}`}function $o(e){try{return Li(e)}catch{return""}}function pi(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=$o(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=$o(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const wa=[{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Move up/down through items, pausing on category headers before entering the next category at the same relative position."},{keys:[["Cmd/Ctrl","Arrow Up"],["Cmd/Ctrl","Arrow Down"]],description:"Reorder the selected category (or the category that holds the selected item)."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Cmd/Ctrl","Arrow Left"],["Cmd/Ctrl","Arrow Right"]],description:"Switch to the previous or next map when viewing a series."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile or category."},{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["F2"]],description:"Edit the selected item; when a category (not an item) is selected, open the category editor."},{keys:[["Delete"]],description:"Delete the selected item or category (use Cmd/Ctrl+Z to undo)."},{keys:[["Insert"]],description:"Add a new category at the bottom of the map."},{keys:[["Escape"]],description:"Unselect item or close the open preview popover."}];function an(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const i=(e.title??"").toString().trim();e.title=i||t||"Untitled Model";const o=(e.id??"").toString().trim();if(o)e.id=o;else{const r=n||e.title||t||"model",a=Hn(r).replace(/\./g,"-");e.id=a||`model-${rn()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function ya(e){return JSON.parse(JSON.stringify(e))}function Re(e,t="Untitled Model"){var i;return e&&(((i=e.data)==null?void 0:i.title)??e.title??"").toString().trim()||t}function Ni(e,t="Untitled Model"){var i;if(((i=e==null?void 0:e.apicurioVersions)==null?void 0:i.length)>1||(e==null?void 0:e.isSeries)){const o=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(o)return o;const r=Ze(e);return r?`${r} series`:t}return Re(e,t)}function Ze(e){var o;const t=An(e);if(t)return t;const n=(o=e==null?void 0:e.data)==null?void 0:o.id;return n&&n.toString().trim()||null}function Ea(e){if(!(e!=null&&e.sourcePath))return null;try{const t=e.sourcePath.split("/").filter(Boolean);return t.length?t[t.length-1]:e.sourcePath}catch{return e.sourcePath}}function Oo(e){var d;if(e<0||e>=k.length||!s)return!0;const t=k[e],n=(s.value||"").trim();if(!n)return!0;let i;try{i=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}an(i,{titleHint:Re(t),idHint:Ze(t)});const o=pi(t.data),r=pi(i);if(o===r)return!0;t.data=i;const a=dn(t);return a>=0&&((d=t.apicurioVersions)!=null&&d[a])&&(t.apicurioVersions[a].data=i),!0}function Mo(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(i=>{i!=null&&i.id&&t.add(i.id)})),t}function Po(e){if(g<0||!e)return null;const t=k[g].data,n=(t==null?void 0:t.categories)||[];for(const i of n){const r=(i.items||[]).find(a=>a.id===e);if(r)return{category:i,item:r,modelData:t}}return null}function _a(e,t){const n=Mo(t);let i=Hn(e||"item");if(!n.has(i))return i;const o=()=>rn().slice(0,4);for(;n.has(i);)i=`${Hn(e||"item")}-${o()}`;return i}function ka(e="category",t){const n=(t==null?void 0:t.categories)||[],i=Hn(e||"category"),o=d=>n.some(u=>u.id===d);let r=i||`category-${rn()}`;if(!o(r))return r;let a=n.length+1;for(;o(`${i}-${a}`);)a+=1;return`${i}-${a}`}const sn=ul({findItemAndCategoryById:Po,collectAllItemIds:Mo,updateItemReferences:dl,loadActiveIntoEditor:pt,rebuildFromActive:ct,select:e=>ft(e),onSelectionRenamed:(e,t)=>{var n;L===e&&(L=t,st()),((n=Ee==null?void 0:Ee.item)==null?void 0:n.id)===e&&(Ee.item.id=t)}});function Sa({getActiveModelData:e,loadActiveIntoEditor:t,rebuildFromActive:n,selectCategory:i,onCategoryRenamed:o}){const r={wrapper:null,fields:{},categoryId:null,modelData:null},a=x=>{if(r.fields.errorEl){if(!x){r.fields.errorEl.hidden=!0,r.fields.errorEl.textContent="";return}r.fields.errorEl.hidden=!1,r.fields.errorEl.textContent=x}},d=()=>{r.wrapper&&(r.wrapper.hidden=!0,r.wrapper.setAttribute("aria-hidden","true"),a(""),r.categoryId=null,r.modelData=null,document.body.classList.remove("category-editor-open"))},u=()=>{r.wrapper&&(r.wrapper.hidden=!1,r.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("category-editor-open"),requestAnimationFrame(()=>{var x,F;(x=r.fields.titleInput)==null||x.focus(),(F=r.fields.titleInput)==null||F.select()}))},h=()=>{if(!r.modelData||!r.categoryId)throw new Error("No category loaded.");const x=r.modelData.categories||[],F=x.find(z=>z.id===r.categoryId);if(!F)throw new Error("Category not found.");const de=(r.fields.idInput.value||"").trim();if(!de)throw new Error("ID is required.");const xe=(r.fields.titleInput.value||"").trim();if(x.some(z=>z.id===de&&z.id!==F.id))throw new Error("Another category already uses that ID.");const H=F.id;return F.id=de,F.title=xe||F.id,H!==de&&typeof o=="function"&&o(H,de),t(),n(),i(de,{scrollIntoView:!0}),!0},b=()=>{try{return h(),d(),!0}catch(x){return console.warn("[CategoryEditor] save failed",x),a((x==null?void 0:x.message)||"Unable to save category."),!1}},A=()=>{if(r.wrapper)return r.wrapper;const x=document.createElement("div");x.className="item-editor-modal category-editor-modal",x.hidden=!0,x.setAttribute("role","dialog"),x.setAttribute("aria-modal","true");const F=document.createElement("div");F.className="item-editor-modal__backdrop",x.appendChild(F);const de=document.createElement("div");de.className="item-editor",x.appendChild(de);const xe=document.createElement("div");xe.className="item-editor__header";const T=document.createElement("h2");T.className="item-editor__title",T.textContent="Edit category";const H=document.createElement("button");H.type="button",H.className="item-editor__close",H.setAttribute("aria-label","Close category editor"),H.textContent="×",xe.appendChild(T),xe.appendChild(H),de.appendChild(xe);const z=document.createElement("form");z.className="item-editor__form",de.appendChild(z);const je=document.createElement("div");je.className="item-editor__meta",je.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',z.appendChild(je);const _e=document.createElement("div");_e.className="item-editor__error",_e.hidden=!0,z.appendChild(_e);const $e=(_t,ze,Sn)=>{const It=document.createElement("label");It.className="item-editor__field";const un=document.createElement("span");if(un.className="item-editor__label",un.textContent=_t,It.appendChild(un),ze.classList.add("item-editor__control"),It.appendChild(ze),Sn){const ti=document.createElement("div");ti.className="item-editor__hint",ti.textContent=Sn,It.appendChild(ti)}return It},dt=document.createElement("input");dt.type="text",z.appendChild($e("Title",dt,"Display label shown in the map."));const Rt=document.createElement("input");Rt.type="text",Rt.required=!0,z.appendChild($e("ID",Rt,"Unique identifier for this category (used in URLs and references)."));const Vt=document.createElement("div");Vt.className="item-editor__actions";const bt=document.createElement("button");bt.type="submit",bt.className="item-editor__action item-editor__action--primary",bt.textContent="Save";const Ut=document.createElement("button");return Ut.type="button",Ut.className="item-editor__action",Ut.textContent="Cancel",Vt.appendChild(bt),Vt.appendChild(Ut),z.appendChild(Vt),z.addEventListener("submit",_t=>{_t.preventDefault(),b()}),Ut.addEventListener("click",d),H.addEventListener("click",d),F.addEventListener("click",d),x.addEventListener("keydown",_t=>{_t.key==="Escape"&&(_t.preventDefault(),d())}),document.body.appendChild(x),r.wrapper=x,r.fields={titleInput:dt,idInput:Rt,errorEl:_e,metaLabel:je.querySelector(".item-editor__meta-value")},x};return{open:x=>{if(!x||!A())return!1;const de=e(),T=((de==null?void 0:de.categories)||[]).find(H=>H.id===x);return T?(r.categoryId=T.id,r.modelData=de,r.fields.metaLabel.textContent=T.title||T.id||"Category",r.fields.titleInput.value=T.title||T.id||"",r.fields.idInput.value=T.id||"",a(""),u(),!0):!1},hide:d,isOpen:()=>!!r.wrapper&&r.wrapper.hidden===!1}}const Ia=Sa({getActiveModelData:()=>{var e;return(e=k[g])==null?void 0:e.data},loadActiveIntoEditor:pt,rebuildFromActive:ct,selectCategory:(e,t={})=>Pt(e,t),onCategoryRenamed:(e,t)=>{oe===e&&(oe=t,st())}});function fi(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const i={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[i],e.apicurioActiveVersionIndex=0;const o=e.title||Re(e);return vt(e,{seriesName:o,fallbackTitle:o}),e.isSeries=!0,e}function Wt(e,{versionLabel:t,createdOn:n}={}){var u,h,b;if(e!=null&&e.isSeries||((u=e==null?void 0:e.apicurioVersions)==null?void 0:u.length)>1){const A=e.title||Re(e);vt(e,{seriesName:A,fallbackTitle:A})}const i=Ze(e);if(!i)return fi(e,{versionLabel:t||"1",createdOn:n}),k.push(e),k.length-1;const o=k.findIndex(A=>Ze(A)===i);if(o===-1)return fi(e,{versionLabel:t||"1",createdOn:n}),k.push(e),k.length-1;const r=k[o];if(!Array.isArray(r.apicurioVersions)||!r.apicurioVersions.length){r.apicurioVersions=[{version:"1",data:r.data,createdOn:(b=(h=r.apicurioVersions)==null?void 0:h[0])==null?void 0:b.createdOn}],r.apicurioActiveVersionIndex=0;const A=r.title||Re(r);vt(r,{seriesName:A,fallbackTitle:A})}const a=String(r.apicurioVersions.length+1);r.apicurioVersions.push({version:a,data:e.data,createdOn:n||new Date().toISOString()}),r.apicurioActiveVersionIndex=r.apicurioVersions.length-1,r.data=e.data,r.title=Re(e)||r.title,r.isSeries=!0;const d=r.title||Re(r);return vt(r,{seriesName:d,fallbackTitle:d}),o}function Ro({versionLabel:e}={}){var a;if(g<0||!k[g])throw new Error("Load or select a model before creating a version.");const t=k[g];fi(t,{versionLabel:"1"});let n;try{n=ya(t.data)}catch(d){throw console.warn("[Blockscape] failed to clone active model for versioning",d),new Error("Could not copy the current model.")}an(n,{titleHint:Re(t),idHint:Ze(t)||An(t)});const o={version:e||String((((a=t.apicurioVersions)==null?void 0:a.length)||0)+1),data:n,createdOn:new Date().toISOString()};t.apicurioVersions.push(o),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=n,t.isSeries=!0;const r=t.title||Re(t);return vt(t,{seriesName:r,fallbackTitle:r}),g}function Ti(){const e=g>=0&&k[g]?k[g]:null,t=Ze(e);document.title=t?`${t}-blockscape`:ut}function Bi(e){if(!e)return null;const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||Re(e);return vt(e,{seriesName:n,fallbackTitle:n}),t.map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function Ca(){const e=k[g],t=Bi(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function Vo(e="shortcut",t=!1){const n=s.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const i=k[g],o=t?Bi(i):null,r=!!o,a=r?JSON.stringify(o,null,2):n,d=An(i),u=Ze(i),h=d||u||Re(i,"blockscape"),b=r?"-series":"",A=`${Hn(h)}${b}.bs`;return Dr(A,a),console.log(`[Blockscape] saved JSON (${e}):`,A),!0}const xa={A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"};function Uo(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return xa[n]||"#9ca3af"}function Aa(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(u=>u+u).join(""):t,i=parseInt(n,16),o=i>>16&255,r=i>>8&255,a=i&255;return .2126*Math.pow(o/255,2.2)+.7152*Math.pow(r/255,2.2)+.0722*Math.pow(a/255,2.2)>.35?"#111111":"#ffffff"}function La(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function Ho(){if(kt)return;kt=document.createElement("div"),kt.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",wt=document.createElement("span"),wt.className="series-nav-notice__text",kt.appendChild(e),kt.appendChild(wt),document.body.appendChild(kt)}function Do(){St&&(clearTimeout(St),St=null),kt&&kt.classList.remove("is-visible"),wt&&(wt.textContent="")}function vn(){zt=null,Dt&&(clearTimeout(Dt),Dt=null),Do()}function Na(e,t){var i;if(!((i=e==null?void 0:e.apicurioVersions)!=null&&i[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function Ta(e,t,n){Ho(),zt={id:e,targetVersionIndex:t},Dt&&clearTimeout(Dt),Dt=setTimeout(()=>{Dt=null,vn()},bn);const i=Na(n,t);$i(`Click again to open ${i} in this series.`,bn)}function $i(e,t=ci,n=null){if(Ho(),wt.textContent="",wt.appendChild(document.createTextNode(e)),n){const i=document.createTextNode(" "),o=document.createElement("a");o.href=n,o.target="_blank",o.rel="noopener",o.textContent=n,wt.appendChild(i),wt.appendChild(o)}kt.classList.add("is-visible"),St&&clearTimeout(St),St=setTimeout(()=>Do(),t)}function Ba(){ye&&(ye.innerHTML="",wa.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((o,r)=>{if(r>0){const d=document.createElement("span");d.className="shortcut-help__or",d.textContent="or",n.appendChild(d)}const a=document.createElement("div");a.className="shortcut-help__combo",o.forEach((d,u)=>{if(u>0){const b=document.createElement("span");b.className="shortcut-help__sep",b.textContent="+",a.appendChild(b)}const h=document.createElement("kbd");h.className="shortcut-help__key",h.textContent=d,a.appendChild(h)}),n.appendChild(a)});const i=document.createElement("div");i.className="shortcut-help__desc",i.textContent=e.description,t.appendChild(n),t.appendChild(i),ye.appendChild(t)}),si=!0)}function $a(){return!!re&&re.hidden===!1}function Oa(){if(!re)return;si||Ba(),li=document.activeElement,re.hidden=!1,re.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=re.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Oi(){if(!re||re.hidden)return;re.hidden=!0,re.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=li;e!=null&&e.focus?e.focus({preventScroll:!0}):O!=null&&O.focus&&O.focus({preventScroll:!0})}function Ma(){if(!Q)return;Q.hidden=!1,Q.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Q.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Mi(){!Q||Q.hidden||(Q.hidden=!0,Q.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),ue!=null&&ue.focus&&ue.focus({preventScroll:!0}))}let Pi=!1;function Yn(){Pi||(Pi=!0,requestAnimationFrame(()=>{Pi=!1,Ui(),En()}))}let Fo=!1;function jo(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Pa(e){const t=jo(e);if(!t.length){p.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}p.querySelectorAll(".tile").forEach(n=>{var a;const i=(((a=n.querySelector(".name"))==null?void 0:a.textContent)||"").toLowerCase(),o=(n.dataset.id||"").toLowerCase(),r=t.every(d=>i.includes(d)||o.includes(d));n.style.opacity=r?"1":"0.2"})}function Ra(e){const t=jo(e);if(!t.length)return[];const n=[];return k.forEach((i,o)=>{var h;const r=Ni(i),a=Ze(i)||"",d=`${r} ${a}`.toLowerCase();t.every(b=>d.includes(b))&&n.push({type:"model",modelIndex:o,modelTitle:r,modelId:a}),(Array.isArray((h=i.data)==null?void 0:h.categories)?i.data.categories:[]).forEach(b=>{const A=(b.title||b.id||"").toString();(b.items||[]).forEach(C=>{const x=(C.name||C.id||"").toString(),F=`${x} ${C.id||""} ${A}`.toLowerCase();t.every(de=>F.includes(de))&&n.push({type:"item",modelIndex:o,modelTitle:r,modelId:a,itemId:C.id,itemName:x,categoryTitle:A})})})}),n.slice(0,f)}function Jo(e){if(!M)return;M.innerHTML="";const t=(e||"").toString();if(!t.trim()){M.hidden=!0;return}if(!k.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="Load models to search",M.appendChild(i),M.hidden=!1;return}const n=Ra(t);if(!n.length){const i=document.createElement("div");i.className="search-results__empty",i.textContent="No matches yet",M.appendChild(i),M.hidden=!1;return}n.forEach(i=>{const o=document.createElement("button");o.type="button",o.className="search-result",o.dataset.modelIndex=String(i.modelIndex),i.itemId&&(o.dataset.itemId=i.itemId),i.type&&(o.dataset.type=i.type),i.modelIndex===g&&(!i.itemId||L===i.itemId)&&o.classList.add("is-active");const r=document.createElement("div");r.className="search-result__primary";const a=document.createElement("span");a.textContent=i.type==="model"?i.modelTitle:i.itemName||i.itemId||"Item",r.appendChild(a);const d=document.createElement("span");d.className="search-result__badge",d.textContent=i.type==="item"?i.categoryTitle||"Item":"Model",r.appendChild(d);const u=document.createElement("div");u.className="search-result__meta";const h=document.createElement("span");if(h.textContent=i.modelId?`${i.modelTitle} · ${i.modelId}`:i.modelTitle,u.appendChild(h),i.type==="item"&&i.itemId){const b=document.createElement("span");b.textContent=`Item ID: ${i.itemId}`,u.appendChild(b)}else if(i.type==="model"){const b=document.createElement("span");b.textContent="Matches model title",u.appendChild(b)}o.appendChild(r),o.appendChild(u),M.appendChild(o)}),M.hidden=!1}function Wo(e){Pa(e||""),Jo(e||"")}function Va(e){!e||!Number.isInteger(e.modelIndex)||(lt(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(g!==e.modelIndex)return;const t=(n=ne.get(e.itemId))==null?void 0:n.el;t&&(ft(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function lt(e){if(Et(),vn(),Ee=null,Ht=null,oe=null,Be=null,e<0||e>=k.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}en=!0,g=e,console.log("[Blockscape] active model:",Re(k[e]),"(index",e+" )"),Ti(),ln(),pt(),ct(),Se&&Wo(Se.value||""),l.updateActiveSavePlaceholder(),Ie.updateAvailability()}function ln(){if(R.innerHTML="",!k.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",R.appendChild(e);return}k.forEach((e,t)=>{var A;const n=document.createElement("li");n.className="model-nav-item";const i=document.createElement("button");i.type="button",i.className="model-nav-button"+(t===g?" is-active":""),i.dataset.index=String(t),i.setAttribute("aria-current",t===g?"true":"false");const o=document.createElement("span");o.className="model-nav-label";const r=document.createElement("span");r.className="model-nav-title",r.textContent=Ni(e),o.appendChild(r);const a=Ea(e)||Ze(e);if(a){const C=document.createElement("span");C.className="model-nav-id",C.textContent=a,o.appendChild(C)}const d=Array.isArray((A=e.data)==null?void 0:A.categories)?e.data.categories:[],u=d.reduce((C,x)=>C+(x.items||[]).length,0),h=document.createElement("span");h.className="model-nav-meta";const b=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} maps`:"";h.textContent=`${d.length} cat · ${u} items${b}`,i.appendChild(o),i.appendChild(h),n.appendChild(i),R.appendChild(n)}),Ie.updateAvailability()}function pt(){if(g<0){s.value="",Y&&(Y.disabled=!0);return}const e=k[g];s.value=JSON.stringify(e.data,null,2),Y&&(Y.disabled=!Bi(e))}function Ua(e){try{return JSON.parse(e)}catch{return null}}function Ha(e,t="Pasted",n={}){const i=Array.isArray(e)?e:[];if(!i.length)return[];const o=i.map((b,A)=>!b||typeof b!="object"?null:(an(b,{titleHint:`${t} #${A+1}`}),{obj:b,idx:A})).filter(Boolean);if(!o.length)return[];const r=o[0].obj,{seriesTitleOverride:a}=n;let d=a||r.title||`${t} series`;a&&!r.title&&(r.title=a);const u={id:rn(),title:d,data:r,apicurioVersions:o.map(({obj:b,idx:A})=>({version:String(A+1),data:b})),apicurioActiveVersionIndex:0,isSeries:!0},h=vt(u,{seriesName:d,fallbackTitle:d});return h&&(u.id=h),[u]}function qo(e,t="Pasted",n={}){return Array.isArray(e)?Ha(e,t,n):!e||typeof e!="object"?[]:(an(e,{titleHint:`${t} #1`}),[{id:rn(),title:e.title||`${t} #1`,data:e}])}function Kt(e,t="Pasted",n={}){const i=(e||"").trim();if(!i)return[];const o=Ua(i);if(o){let a=n;if(Array.isArray(o)&&n.promptForSeriesName){const u=ba(o,t),h=ga(u);a={...n,promptForSeriesName:!1,seriesTitleOverride:h||u}}const d=qo(o,t,a);if(d.length)return d}return i.split(/^\s*(?:---|%%%)\s*$/m).map(a=>a.trim()).filter(Boolean).map((a,d)=>{const u=JSON.parse(a);return an(u,{titleHint:`${t} #${d+1}`}),{id:rn(),title:u.title||`${t} #${d+1}`,data:u}})}function Da(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function cn(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!Da(e)}function Fa(e){if(!e)return!1;const t=e.trimStart();return/^\s*(\{|\[|---|%%%)/.test(t)}function Go(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(Le)}catch(o){return console.warn("[Blockscape] failed to access editor payload",o),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(o){console.warn("[Blockscape] invalid payload JSON",o);try{localStorage.removeItem(Le)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(Le)}catch(o){console.warn("[Blockscape] failed to clear editor payload",o)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=Kt(t.text,t.title||"Editor Export")}catch(o){return console.warn("[Blockscape] could not parse payload text",o),null}if(!n.length)return null;let i=null;return n.forEach(o=>{const r=Wt(o,{versionLabel:"editor"});i==null&&(i=r)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:i,count:n.length}}function zo(e="storage"){const t=Go();return!t||typeof t.index!="number"?!1:(lt(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function ja(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const a=new URLSearchParams(window.location.search);a.has("share")&&(t=a.get("share"))}if(!t)return null;let i;try{const a=Hr(t);i=JSON.parse(a)}catch(a){return console.warn("[Blockscape] failed to decode share token",a),null}if(!i||typeof i!="object"||i.data==null)return console.warn("[Blockscape] share payload missing data"),null;const o=qo(i.data,i.title||"Shared Model");if(!o.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let r=null;return o.forEach(a=>{const d=a.isSeries?i.title||a.title:null,u=Wt({...a,apicurioArtifactName:d||a.apicurioArtifactName},{versionLabel:"shared"});r==null&&(r=u)}),r}async function Ja(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const i=new URLSearchParams(window.location.search);i.has("load")&&(t=i.get("load"))}if(!t)return null;try{const i=await Fi(t);return typeof i=="number"?i:null}catch(i){return console.warn("[Blockscape] load param failed",i),null}}function Wa(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,i=new Set;(e.categories||[]).forEach(r=>(r.items||[]).forEach(a=>{i.add(a.id);const d=new Set(a.deps||[]);(e.links||[]).forEach(u=>{u.from===a.id&&d.add(u.to)}),t.set(a.id,d),d.forEach(u=>{n.has(u)||n.set(u,new Set),n.get(u).add(a.id)})}));const o=new Set;return n.forEach((r,a)=>{((r==null?void 0:r.size)||0)>=2&&o.add(a)}),{m:e,fwd:t,rev:n,reusedLocal:o,seen:i}}function qa(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),i=44;n.width=i,n.height=i;const o=n.getContext("2d"),r=(e||"?").charAt(0).toUpperCase(),a=Uo(e,t),d=Aa(a);return o.fillStyle=a,o.beginPath(),o.arc(i/2,i/2,i/2-2,0,2*Math.PI),o.fill(),o.strokeStyle="rgba(0,0,0,0.15)",o.lineWidth=1,o.stroke(),o.fillStyle=d,o.font=`bold ${i*.5}px system-ui, -apple-system, sans-serif`,o.textAlign="center",o.textBaseline="middle",o.fillText(r,i/2,i/2),n.toDataURL("image/png")}function dn(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Ko(e){const t=dn(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function Ga(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,i)=>{var a,d;const o=(((a=n==null?void 0:n.data)==null?void 0:a.id)??"").toString().trim();o&&t.set(o,i);const r=(((d=n==null?void 0:n.data)==null?void 0:d.seriesId)??"").toString().trim();r&&!t.has(r)&&t.set(r,i)}),t}const Yo=new WeakMap;function za(e,t){var T;if(!((T=e==null?void 0:e.apicurioVersions)!=null&&T[t]))return null;const n=e.apicurioVersions[t],i=n.data,o=pi(i),r=Yo.get(n);if(r&&r.fingerprint===o)return r.dataUrl;const a=160,d=90,u=document.createElement("canvas");u.width=a,u.height=d;const h=u.getContext("2d");h.fillStyle="#f8fafc",h.fillRect(0,0,a,d),h.strokeStyle="#e5e7eb",h.strokeRect(.5,.5,a-1,d-1);const b=Array.isArray(i==null?void 0:i.categories)?i.categories:[],A=Math.max(b.length,1),C=a/A,x=8,F=8,de=4;b.forEach((H,z)=>{const je=z*C+C/2,_e=Array.isArray(H.items)?H.items:[],$e=Math.max(_e.length,1);_e.forEach((dt,Rt)=>{const Vt=x+(Rt+.5)*((d-x-F)/$e);h.beginPath(),h.arc(je,Vt,de,0,Math.PI*2);const bt=Uo(dt.name||dt.id||"",dt.color);h.fillStyle=bt,h.strokeStyle="rgba(15,23,42,0.25)",h.fill(),h.stroke()})});const xe=u.toDataURL("image/png");return Yo.set(n,{fingerprint:o,dataUrl:xe}),xe}function Ri(e,t){var d;if(vn(),e<0||e>=k.length)return!1;const n=k[e];if(!((d=n==null?void 0:n.apicurioVersions)!=null&&d.length)||!Oo(e))return!1;const o=n.apicurioVersions.length,r=(t%o+o)%o,a=n.apicurioVersions[r];return a!=null&&a.data?(n.apicurioActiveVersionIndex=r,n.data=a.data,en=!0,L=null,Fe=null,st(),pt(),ct(),!0):!1}function Vi(e){var i;if(!e||g<0)return!1;const t=k[g];if(!((i=t==null?void 0:t.apicurioVersions)!=null&&i.length))return!1;const n=dn(t);return n===-1?!1:Ri(g,n+e)}function Ka(e,t){if(vn(),e<0||e>=k.length)return!1;const n=k[e];if(!Array.isArray(n==null?void 0:n.apicurioVersions)||n.apicurioVersions.length<=1)return alert("A series needs at least one map. Add another before removing this one."),!1;if(!Oo(e))return!1;const i=Math.min(Math.max(t,0),n.apicurioVersions.length-1),o=dn(n),[r]=n.apicurioVersions.splice(i,1);if(!r)return!1;let a=o;i===o?a=Math.min(i,n.apicurioVersions.length-1):i<o&&(a=Math.max(0,o-1)),n.apicurioActiveVersionIndex=Math.max(0,a);const d=n.apicurioVersions[n.apicurioActiveVersionIndex];return n.data=(d==null?void 0:d.data)||n.data,n.isSeries=n.apicurioVersions.length>1,lt(e),!0}function Ya(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=document.createElement("div");t.className="version-nav";const n=document.createElement("div");n.className="version-nav__title",n.textContent=e.apicurioArtifactName||e.apicurioArtifactId||Ze(e)||"Artifact",n.title="Double-click to rename this series",n.setAttribute("role","button"),n.tabIndex=0,n.addEventListener("dblclick",()=>{var F;const C=k[g];!((F=C==null?void 0:C.apicurioVersions)!=null&&F.length)||!va(C)||(ln(),pt(),ct())}),t.appendChild(n);const i=document.createElement("div");i.className="version-nav__status";const o=dn(e),r=Ko(e)||"latest";i.textContent=`No. in series ${r} (${o+1} of ${e.apicurioVersions.length})`,t.appendChild(i);const a=document.createElement("div");a.className="version-nav__controls";const d=document.createElement("button");d.type="button",d.className="version-nav__button",d.textContent="Previous",d.addEventListener("click",()=>Vi(-1));const u=document.createElement("button");u.type="button",u.className="version-nav__button",u.textContent="Next",u.addEventListener("click",()=>Vi(1)),a.appendChild(d),a.appendChild(u),t.appendChild(a);const h=document.createElement("div");h.className="version-nav__thumbs",e.apicurioVersions.forEach((C,x)=>{var je;const F=document.createElement("button");F.type="button",F.className="version-nav__thumb",x===o&&F.classList.add("is-active");const de=za(e,x);if(de){const _e=document.createElement("img");_e.src=de,_e.alt=`Version ${x+1}`,F.appendChild(_e)}const xe=document.createElement("div");xe.className="version-nav__thumb-label";const T=document.createElement("span");T.className="version-nav__thumb-label-text";const H=(((je=C==null?void 0:C.data)==null?void 0:je.id)??(C==null?void 0:C.id)??"").toString().trim(),z=H||(C!=null&&C.version?`v${C.version}`:`${x+1}`);if(T.textContent=z,xe.title=H||z,xe.appendChild(T),F.appendChild(xe),os(xe,T),e.apicurioVersions.length>1){const _e=document.createElement("span");_e.className="version-nav__thumb-remove",_e.title=`Remove ${z} from this series`,_e.setAttribute("aria-label",`Remove ${z} from this series`),_e.setAttribute("role","button"),_e.tabIndex=-1,_e.textContent="×",_e.addEventListener("click",$e=>{$e.stopPropagation(),$e.preventDefault(),window.confirm(`Remove ${z} from this series?`)&&Ka(g,x)}),F.appendChild(_e)}F.addEventListener("click",()=>Ri(g,x)),as(F,C),h.appendChild(F)});const b=document.createElement("button");b.type="button",b.className="version-nav__thumb version-nav__thumb--add",b.title="Create a new version from this map",b.addEventListener("click",()=>{try{const C=Ro({versionLabel:"manual"});lt(C)}catch(C){alert((C==null?void 0:C.message)||"Unable to create a new version right now.")}});const A=document.createElement("span");return A.className="version-nav__thumb-add-icon",A.textContent="+",b.appendChild(A),h.appendChild(b),t.appendChild(h),t}function wn(){var vr,wr,yr;if(!W)return;qt(),Array.isArray(W.m.categories)||(W.m.categories=[]),console.log("[Blockscape] rendering categories=",W.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!W.m.abstract,"- value:",W.m.abstract?W.m.abstract.substring(0,50)+"...":"none"),p.innerHTML="",ne.clear(),Te.clear(),on=[],fi(k[g],{versionLabel:"1"});const e=Ya(k[g]);e&&p.appendChild(e),I.setAttribute("width",window.innerWidth),I.setAttribute("height",window.innerHeight);const t=document.createElement("div");t.className="blockscape-model-meta";const n=document.createElement("div");n.className="blockscape-model-title",n.textContent=W.m.title&&W.m.title.trim()||Re(k[g]),t.appendChild(n),((vr=k[g])!=null&&vr.isSeries||(yr=(wr=k[g])==null?void 0:wr.apicurioVersions)!=null&&yr.length)&&vt(k[g],{seriesName:k[g].title||W.m.title||Re(k[g])});const i=Ko(k[g]),o=An(k[g]),r=(W.m.id??"").toString().trim(),a=document.createElement("div");a.className="blockscape-model-meta__details";const d=(v,X)=>{if(!X)return;const V=document.createElement("div");V.className="blockscape-model-id";const Ce=document.createElement("span");Ce.className="blockscape-model-id__label",Ce.textContent=v;const Ke=document.createElement("span");Ke.className="blockscape-model-id__value",Ke.textContent=X,V.append(Ce,Ke),a.appendChild(V)};d("Series ID",o),d("Model ID",r),d("No. in series",i),a.childElementCount&&t.appendChild(a),p.appendChild(t);const u=document.createElement("div");u.className="blockscape-tabs";const h=document.createElement("div");h.className="blockscape-tablist",h.setAttribute("role","tablist"),u.appendChild(h);const b=document.createElement("div");b.className="blockscape-tabpanels",u.appendChild(b);const A=document.createElement("div"),C=document.createElement("div"),x=document.createElement("div"),F=document.createElement("div");let de="";const xe=Ga(k[g]),T=dn(k[g]);Ft=null,hn="";const H=[{id:"map",label:"Map",panel:A},{id:"abstract",label:"Info",panel:C},{id:"source",label:"Settings",panel:x},{id:"apicurio",label:"Apicurio",panel:F}],z=typeof Ie.isEnabled=="function"?Ie.isEnabled():!1,je=v=>{if(!I)return;const X=v==="map";I.hidden=!X,X?(Ui(),En()):I.innerHTML=""};H.forEach((v,X)=>{const V=document.createElement("button");V.type="button",V.id=`tab-${v.id}`,V.className="blockscape-tab"+(X===0?" is-active":""),V.setAttribute("role","tab"),V.setAttribute("aria-controls",`panel-${v.id}`),V.setAttribute("aria-selected",X===0?"true":"false"),V.textContent=v.label,v.id==="apicurio"&&!z&&(V.hidden=!0,V.tabIndex=-1,V.setAttribute("aria-hidden","true"),V.style.display="none"),v.button=V,h.appendChild(V),v.panel.id=`panel-${v.id}`,v.panel.classList.add("blockscape-tabpanel"),v.panel.setAttribute("role","tabpanel"),v.panel.setAttribute("aria-labelledby",V.id),v.panel.hidden=X!==0,X===0&&v.panel.classList.add("is-active"),b.appendChild(v.panel)});const _e=v=>{fe=v,H.forEach(X=>{const V=X.id===v;X.button.classList.toggle("is-active",V),X.button.setAttribute("aria-selected",V?"true":"false"),X.panel.classList.toggle("is-active",V),X.panel.hidden=!V}),je(v)},$e=H.find(v=>v.id==="apicurio"),dt=v=>{if(!$e||!$e.button||!$e.panel)return;const X=!!v;if($e.button.hidden=!X,$e.button.tabIndex=X?0:-1,$e.button.setAttribute("aria-hidden",X?"false":"true"),$e.button.style.display=X?"":"none",X){const V=fe==="apicurio";$e.button.classList.toggle("is-active",V),$e.button.setAttribute("aria-selected",V?"true":"false"),$e.panel.classList.toggle("is-active",V),$e.panel.hidden=!V}else{const V=$e.panel.classList.contains("is-active");if($e.button.classList.remove("is-active"),$e.button.setAttribute("aria-selected","false"),$e.panel.classList.remove("is-active"),$e.panel.hidden=!0,V){const Ce=H.find(Ke=>Ke.id!=="apicurio");Ce&&_e(Ce.id)}}Bn&&(Bn.checked=X)};H.forEach(v=>{v.button.addEventListener("click",()=>{qt(),_e(v.id)}),v.id==="abstract"&&(Ft=v.button,v.button.addEventListener("mouseenter",()=>Qn(v.button,de,{offset:12})),v.button.addEventListener("mouseleave",qt),v.button.addEventListener("focus",()=>Qn(v.button,de,{offset:12})),v.button.addEventListener("blur",qt))});const Vt=(v=>{const X=H.find(Ce=>Ce.id===fe);if(X&&(X.id!=="apicurio"||v))return X.id;const V=H.find(Ce=>Ce.id!=="apicurio"||v);return(V==null?void 0:V.id)||H[0].id})(z);_e(Vt),dt(z),typeof Ie.onEnabledChange=="function"&&Ie.onEnabledChange(dt),p.appendChild(u);const bt=document.createElement("div");bt.className="blockscape-render",A.appendChild(bt);const Ut=document.createElement("div");if(Ut.className="blockscape-abstract-panel",W.m.abstract){console.log("[Blockscape] Rendering abstract content");const v=document.createElement("div");v.className="blockscape-abstract",v.innerHTML=W.m.abstract,$s(v),Ut.appendChild(v),de=v.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const v=document.createElement("div");v.className="blockscape-abstract-placeholder",v.textContent="No abstract has been provided for this model.",Ut.appendChild(v),de=v.outerHTML}hn=de,C.appendChild(Ut);const _t=document.createElement("div");_t.className="blockscape-source-panel";const ze=document.createElement("div");ze.className="blockscape-settings-panel";const Sn=document.createElement("p");Sn.className="blockscape-settings-panel__title",Sn.textContent="Feature toggles",ze.appendChild(Sn);const It=({id:v,label:X,hint:V,checked:Ce,className:Ke="",onChange:Ae})=>{const Tt=document.createElement("label");Tt.className=["settings-toggle",Ke].filter(Boolean).join(" ");const Bt=document.createElement("input");Bt.type="checkbox",Bt.id=v,Bt.checked=Ce;const Ue=document.createElement("span");Ue.className="settings-toggle__text";const $t=document.createElement("span");if($t.className="settings-toggle__label",$t.textContent=X,Ue.appendChild($t),V){const pn=document.createElement("span");pn.className="settings-toggle__hint",pn.textContent=V,Ue.appendChild(pn)}return Tt.appendChild(Bt),Tt.appendChild(Ue),typeof Ae=="function"&&Bt.addEventListener("change",()=>Ae(Bt.checked)),{row:Tt,input:Bt}},un=()=>{p.querySelectorAll(".tile").forEach(v=>{const X=v.dataset.id,V=Po(X);if(!(V!=null&&V.item))return;const Ce=tr(V.item.external),Ke=er(V.item,{externalMeta:Ce,seriesIdLookup:xe});nr(v,Ke)})},{row:ti}=It({id:"toggleSecondaryLinks",label:"Show indirect links",checked:mt,className:"map-controls__toggle",onChange:v=>{mt=v,L?ft(L):(Di(),En())}});ze.appendChild(ti);const{row:Rs}=It({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:et,className:"map-controls__toggle",onChange:v=>{et=v,Zo()}});ze.appendChild(Rs);const dr=[],{row:Vs}=It({id:"toggleObsidianLinks",label:"Obsidian",hint:"Make tiles open Obsidian when no external URL exists.",checked:Rn,className:"map-controls__toggle",onChange:v=>{const X=zn(v);pa(X),dr.forEach(V=>{V.disabled=!X}),un()}});ze.appendChild(Vs);const ji=document.createElement("div");ji.className="settings-radio";const Ji=document.createElement("div");Ji.className="settings-radio__label",Ji.textContent="Obsidian link format";const Wi=document.createElement("div");Wi.className="settings-radio__hint",Wi.textContent="Use the tile title or id when building Obsidian links.";const qi=document.createElement("div");qi.className="settings-radio__options";const ur=(v,X)=>{const V=document.createElement("label");V.className="settings-radio__option";const Ce=document.createElement("input");Ce.type="radio",Ce.name="obsidianLinkMode",Ce.value=v,Ce.checked=di===v,Ce.disabled=!Rn,Ce.addEventListener("change",()=>{if(!Ce.checked)return;const Ae=Gn(v);da(Ae),un()});const Ke=document.createElement("span");Ke.textContent=X,V.append(Ce,Ke),dr.push(Ce),qi.appendChild(V)};ur(gt,"Use title"),ur(jt,"Use id"),ji.append(Ji,qi,Wi),ze.appendChild(ji);const hi=document.createElement("label");hi.className="settings-text",hi.setAttribute("for","obsidianVaultInput");const Gi=document.createElement("div");Gi.className="settings-text__text";const zi=document.createElement("span");zi.className="settings-text__label",zi.textContent="Obsidian vault";const Ki=document.createElement("span");Ki.className="settings-text__hint",Ki.textContent="Optional. Set the vault name to avoid duplicates.",Gi.append(zi,Ki);const Xt=document.createElement("input");Xt.type="text",Xt.id="obsidianVaultInput",Xt.className="settings-text__input",Xt.placeholder="Vault name",Xt.value=Vn,Xt.addEventListener("input",()=>{const v=Kn(Xt.value);ma(v),un()}),hi.append(Gi,Xt),ze.appendChild(hi);const Yi=document.createElement("p");Yi.className="settings-note",Yi.innerHTML='Requires the Obsidian <a href="https://vinzent03.github.io/obsidian-advanced-uri/" target="_blank" rel="noreferrer noopener">Advanced URI</a> plugin for create/open behavior.',ze.appendChild(Yi);const pr=v=>`${(v/1e3).toFixed(1)}s`,gi=document.createElement("label");gi.className="settings-slider",gi.setAttribute("for","seriesNavDoubleClickWait");const Xi=document.createElement("div");Xi.className="settings-slider__text";const Zi=document.createElement("span");Zi.className="settings-slider__label",Zi.textContent="Series double-click wait";const Qi=document.createElement("span");Qi.className="settings-slider__hint",Qi.textContent="Time window to double-click into another map version.",Xi.append(Zi,Qi);const bi=document.createElement("span");bi.className="settings-slider__value",bi.textContent=pr(bn);const Ct=document.createElement("input");Ct.type="range",Ct.id="seriesNavDoubleClickWait",Ct.className="settings-slider__input",Ct.min=String(No),Ct.max=String(To),Ct.step="50",Ct.value=String(bn),Ct.setAttribute("aria-label","Adjust double-click wait for series navigation"),Ct.addEventListener("input",()=>{const v=qn(parseInt(Ct.value,10));bi.textContent=pr(v),sa(v)}),gi.append(Xi,bi,Ct),ze.appendChild(gi);const fr=v=>`${Math.round((v-1)*100)}%`,vi=document.createElement("label");vi.className="settings-slider",vi.setAttribute("for","hoverScaleSlider");const eo=document.createElement("div");eo.className="settings-slider__text";const to=document.createElement("span");to.className="settings-slider__label",to.textContent="Hover zoom";const no=document.createElement("span");no.className="settings-slider__hint",no.textContent="Expand tiles on hover to see more detail.",eo.append(to,no);const wi=document.createElement("span");wi.className="settings-slider__value",wi.textContent=fr(gn);const xt=document.createElement("input");xt.type="range",xt.id="hoverScaleSlider",xt.className="settings-slider__input",xt.min=String(B),xt.max=String(j),xt.step="0.1",xt.value=String(gn),xt.setAttribute("aria-label","Adjust hover zoom"),xt.addEventListener("input",()=>{const v=Dn(parseFloat(xt.value));wi.textContent=fr(v),Yr(v),L&&Yn()}),vi.append(eo,wi,xt),ze.appendChild(vi);const mr=v=>v===1?"Default":`${Math.round(v*100)}%`,yi=document.createElement("label");yi.className="settings-slider",yi.setAttribute("for","tileCompactnessSlider");const io=document.createElement("div");io.className="settings-slider__text";const oo=document.createElement("span");oo.className="settings-slider__label",oo.textContent="Tile compactness";const ro=document.createElement("span");ro.className="settings-slider__hint",ro.textContent="Adjust padding, gap, and logo size for tiles.",io.append(oo,ro);const Ei=document.createElement("span");Ei.className="settings-slider__value",Ei.textContent=mr(On);const At=document.createElement("input");At.type="range",At.id="tileCompactnessSlider",At.className="settings-slider__input",At.min=String(yt),At.max=String(Me),At.step="0.05",At.value=String(On),At.setAttribute("aria-label","Adjust tile compactness"),At.addEventListener("input",()=>{const v=Fn(parseFloat(At.value));Ei.textContent=mr(v),Zr(v),L&&Yn()}),yi.append(io,Ei,At),ze.appendChild(yi);const{row:Us}=It({id:"titleWrapToggle",label:"Wrap titles",hint:"Allow long titles to wrap instead of truncating.",checked:Ao!=="nowrap",className:"map-controls__toggle",onChange:v=>{const X=v?"wrap":"nowrap";Wn(X),oa(X)}});ze.appendChild(Us);const hr=v=>`${Math.round((v-1)*100)}% extra`,_i=document.createElement("label");_i.className="settings-slider",_i.setAttribute("for","titleHoverWidthSlider");const ao=document.createElement("div");ao.className="settings-slider__text";const so=document.createElement("span");so.className="settings-slider__label",so.textContent="Title width on hover";const lo=document.createElement("span");lo.className="settings-slider__hint",lo.textContent="Give titles more room horizontally when zoomed.",ao.append(so,lo);const ki=document.createElement("span");ki.className="settings-slider__value",ki.textContent=hr(Mn);const Lt=document.createElement("input");Lt.type="range",Lt.id="titleHoverWidthSlider",Lt.className="settings-slider__input",Lt.min=String(qe),Lt.max=String(me),Lt.step="0.05",Lt.value=String(Mn),Lt.setAttribute("aria-label","Adjust title width boost on hover"),Lt.addEventListener("input",()=>{const v=jn(parseFloat(Lt.value));ki.textContent=hr(v),ea(v)}),_i.append(ao,ki,Lt),ze.appendChild(_i);const gr=v=>`${Math.round(v*100)}% of hover zoom`,Si=document.createElement("label");Si.className="settings-slider",Si.setAttribute("for","titleZoomPortionSlider");const co=document.createElement("div");co.className="settings-slider__text";const uo=document.createElement("span");uo.className="settings-slider__label",uo.textContent="Title zoom influence";const po=document.createElement("span");po.className="settings-slider__hint",po.textContent="How much the title scales relative to tile hover zoom.",co.append(uo,po);const Ii=document.createElement("span");Ii.className="settings-slider__value",Ii.textContent=gr(Pn);const Nt=document.createElement("input");Nt.type="range",Nt.id="titleZoomPortionSlider",Nt.className="settings-slider__input",Nt.min=String(ht),Nt.max=String(nt),Nt.step="0.05",Nt.value=String(Pn),Nt.setAttribute("aria-label","Adjust how much titles scale on hover"),Nt.addEventListener("input",()=>{const v=Jn(parseFloat(Nt.value));Ii.textContent=gr(v),na(v)}),Si.append(co,Ii,Nt),ze.appendChild(Si);const Hs=typeof Ie.isEnabled=="function"?Ie.isEnabled():!1,{row:Ds,input:Fs}=It({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:Hs,className:"apicurio-toggle",onChange:v=>{typeof Ie.setEnabled=="function"&&Ie.setEnabled(v)}});if(Bn=Fs,ze.appendChild(Ds),_t.appendChild(ze),c)c.hidden=!1,c.classList.remove("pf-v5-c-page__main-section"),_t.appendChild(c);else{const v=document.createElement("p");v.className="muted",v.textContent="Source editor unavailable.",_t.appendChild(v)}x.appendChild(_t),Ie.mount(F);let br=0;W.m.categories.forEach(v=>{const X=document.createElement("section");X.className="category",X.dataset.cat=v.id;const V=document.createElement("div");V.className="cat-head",V.dataset.cat=v.id,V.tabIndex=0,V.title="Select category",V.innerHTML=`<div class="cat-title">${_n(v.title||v.id)}</div>
                          <div class="muted cat-count">${(v.items||[]).length} items</div>`,V.addEventListener("click",()=>Pt(v.id)),V.addEventListener("keydown",Ae=>{(Ae.key==="Enter"||Ae.key===" ")&&(Ae.preventDefault(),Pt(v.id))}),V.addEventListener("focus",()=>Pt(v.id,{scrollIntoView:!1})),X.appendChild(V);const Ce=document.createElement("div");Ce.className="grid",X.appendChild(Ce),(v.items||[]).forEach(Ae=>{br+=1;const Tt=tr(Ae.external),Bt=er(Ae,{externalMeta:Tt,seriesIdLookup:xe}),Ue=document.createElement("div");if(Ue.className=Tt.isExternal?"tile external":"tile",Ue.tabIndex=0,Ue.dataset.id=Ae.id,Ue.dataset.globalIndex=String(br),Tt.url&&(Ue.dataset.externalUrl=Tt.url),xe.has(Ae.id)){const ii=xe.get(Ae.id);Ue.dataset.seriesVersionIndex=String(ii),Ue.classList.add("tile--series-link");const js=ii===T?"Current map in this series":`Open version ${ii+1} in this series`;Ue.title=js}Bt&&(Ue.dataset.obsidianUrl=Bt);const $t=document.createElement("img");$t.className="logo",Ae.logo?($t.src=Ae.logo,$t.alt=Ae.name||Ae.id):($t.alt="",$t.style.opacity=1,$t.src=qa(Ae.name||Ae.id,Ae.color));const pn=document.createElement("div");pn.className="name",pn.textContent=Ae.name||Ae.id;const fo=document.createElement("div");fo.className="tile-id",fo.textContent=Ae.id||"";const mo=document.createElement("div");mo.className="badge",mo.textContent="reused";const In=document.createElement("button");In.type="button",In.className="tile-delete",In.setAttribute("aria-label",`Delete ${Ae.name||Ae.id}`),In.textContent="×",In.addEventListener("click",ii=>{ii.stopPropagation(),Ls(Ae.id)}),Tt.url&&Ue.appendChild(is(Tt.url)),nr(Ue,Bt),Ue.appendChild(In),Ue.appendChild($t),Ue.appendChild(pn),Ue.appendChild(fo),Ue.appendChild(mo),Ce.appendChild(Ue),ne.set(Ae.id,{el:Ue,catId:v.id,rect:null})}),bt.appendChild(X),Te.set(v.id,{el:X,headEl:V});const Ke=document.createElement("button");Ke.type="button",Ke.className="tile-add",Ke.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',Ke.addEventListener("click",()=>bs(v.id)),Ce.appendChild(Ke)});const ni=document.createElement("button");ni.type="button",ni.className="category-add",ni.innerHTML='<span class="category-add__icon" aria-hidden="true">+</span><span class="category-add__label">Add category</span><span class="category-add__hint">(Insert)</span>',ni.addEventListener("click",()=>ar()),bt.appendChild(ni),Zo(),Xa(),Ui(),En(),yn(),ss()}function Xa(){p.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",n=>{var b;if(typeof n.button=="number"&&n.button!==0)return;Et();const i=e.dataset.id,o=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,r=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,a=k[g],d=a?dn(a):-1,u=((b=a==null?void 0:a.apicurioVersions)==null?void 0:b.length)>1&&Number.isInteger(o)&&o!==d,h=zt&&zt.id===i&&zt.targetVersionIndex===o;if(zt&&!h&&vn(),u)if(h){if(vn(),Ri(g,o))return}else Ta(i,o,a);else Number.isInteger(r)&&r>0&&r%5===0&&$i("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",i),L===i&&!(u&&h)){Zn();return}ft(i)}),e.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())});const t=()=>{L&&Yn()};e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",t),e.addEventListener("focus",t),e.addEventListener("blur",t),e.draggable=!0,e.addEventListener("dragstart",us),e.addEventListener("dragend",ps)}),p.querySelectorAll(".grid").forEach(e=>{e.addEventListener("dragover",fs),e.addEventListener("drop",gs),e.addEventListener("dragenter",ms),e.addEventListener("dragleave",hs)}),Fo||(Fo=!0,window.addEventListener("resize",Yn),window.addEventListener("scroll",Yn,{passive:!0}),window.addEventListener("resize",ir)),document.getElementById("clear").onclick=()=>Zn()}function Ui(){ne.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function Xo(e,{includeSecondary:t=mt}={}){if(!e||!W)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(W.fwd.get(e)||[]),i=new Set(W.rev.get(e)||[]),o=new Set,r=new Set,a=[],d=new Set,u=(h,b,A,C)=>{if(!h||!b)return;const x=`${h}->${b}:${A}:${C}`;d.has(x)||(d.add(x),a.push({from:h,to:b,type:A,depth:C}))};return n.forEach(h=>u(e,h,"dep",1)),i.forEach(h=>u(e,h,"revdep",1)),t&&new Set([...n,...i]).forEach(b=>{(W.fwd.get(b)||new Set).forEach(x=>{const F=x===e;F||o.add(x),F||u(b,x,"dep",2)}),(W.rev.get(b)||new Set).forEach(x=>{const F=x===e;F||r.add(x),F||u(b,x,"revdep",2)})}),{deps:n,revs:i,secondaryDeps:o,secondaryRevs:r,edges:a}}function mi(e,t){const n=ne.get(e);n&&n.el.classList.add(t)}function ft(e){var d,u,h;if(!e)return;oe=null,L=e,Be=null,Fe=Xo(e),st(),Di(),yn();const{deps:t,revs:n,secondaryDeps:i,secondaryRevs:o}=Fe;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const r=ne.get(e);r&&r.el.classList.add("selected"),t.forEach(b=>mi(b,"dep")),n.forEach(b=>mi(b,"revdep")),i.forEach(b=>{!t.has(b)&&b!==e&&mi(b,"dep-indirect")}),o.forEach(b=>{!n.has(b)&&!t.has(b)&&b!==e&&mi(b,"revdep-indirect")}),En();const a=(h=(u=(d=ne.get(e))==null?void 0:d.el)==null?void 0:u.dataset)==null?void 0:h.externalUrl;a&&$i("This item has link to",ci,a)}function Pt(e,{scrollIntoView:t=!0,preserveEntryHint:n=!1}={}){var a,d;if(!((a=W==null?void 0:W.m)!=null&&a.categories)||!e)return!1;const o=(W.m.categories||[]).find(u=>u.id===e);if(!o)return!1;Et(),Hi(),n||(Be=null),oe=o.id,st(),yn();const r=Te.get(o.id);return t&&(r!=null&&r.el)&&(r.el.scrollIntoView({behavior:"smooth",block:"center"}),(d=r.headEl)==null||d.focus({preventScroll:!0})),!0}function yn(){if(Te.forEach(({el:t,headEl:n})=>{t.classList.remove("category--selected"),n&&n.removeAttribute("aria-current")}),!oe)return;const e=Te.get(oe);if(!(e!=null&&e.el)){oe=null,Be=null,st();return}e.el.classList.add("category--selected"),e.headEl&&e.headEl.setAttribute("aria-current","true")}function Xn(){if(oe)return oe;const e=L?ne.get(L):null;return e!=null&&e.catId?e.catId:null}function Za(e){var r,a,d,u;if(!((a=(r=W==null?void 0:W.m)==null?void 0:r.categories)!=null&&a.length)||!e)return!1;const t=W.m.categories,n=Xn();let i=t.findIndex(h=>h.id===n);if(i===-1){const h=((d=t.find(b=>(b.items||[]).length))==null?void 0:d.id)||((u=t[0])==null?void 0:u.id);return h?Pt(h):!1}const o=i+e;return o<0||o>=t.length?!1:Pt(t[o].id)}function Hi(){L=null,Fe=null,Di(),En()}function Qa(){oe=null,Be=null,yn()}function Zn(){Hi(),Qa(),Be=null,st()}function Di(){p.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function Zo(){W!=null&&W.reusedLocal&&W.reusedLocal.forEach(e=>{const t=ne.get(e);if(!t)return;t.el.classList.toggle("reused",et);const n=t.el.querySelector(".badge");n&&(n.style.display=et?"inline-block":"none")})}function En(){for(;I.firstChild;)I.removeChild(I.firstChild);if(!L||I.hidden)return;Fe=Xo(L),Fe.edges.forEach(t=>{var A,C;const n=(A=ne.get(t.from))==null?void 0:A.rect,i=(C=ne.get(t.to))==null?void 0:C.rect;if(!n||!i)return;const o=Qo(n),r=Qo(i),a=document.createElementNS("http://www.w3.org/2000/svg","path"),d=(o.x+r.x)/2,u=o.y,h=(o.x+r.x)/2,b=r.y;a.setAttribute("d",`M ${o.x},${o.y} C ${d},${u} ${h},${b} ${r.x},${r.y}`),a.setAttribute("fill","none"),a.setAttribute("stroke",t.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),a.setAttribute("stroke-opacity",t.depth===1?"0.45":"0.22"),a.setAttribute("stroke-width",t.depth===1?"2":"1.5"),t.depth>1&&a.setAttribute("stroke-dasharray","4 3"),a.setAttribute("vector-effect","non-scaling-stroke"),I.appendChild(a)})}function Qo(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function _n(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function es(e){const t=(e??"").toString().trim();if(!t)return"";const n=t.endsWith(".md")?t:`${t}.md`,i=new URLSearchParams;return i.set("filepath",n),i.set("data"," "),i.set("mode","append"),Vn&&i.set("vault",Vn),`obsidian://advanced-uri?${i.toString()}`}function ts(e){return e?di===jt?e.id??e.name??"":e.name??e.id??"":""}function er(e,{externalMeta:t,seriesIdLookup:n}={}){var o;if(!Rn||!e||(o=n==null?void 0:n.has)!=null&&o.call(n,e.id))return"";const i=ts(e);return es(i)}function tr(e){if(typeof e=="string"){const t=e.trim();if(!t)return{isExternal:!1,url:""};try{const n=new URL(t);return/^https?:/i.test(n.protocol)?{isExternal:!0,url:n.toString()}:{isExternal:!1,url:""}}catch(n){return console.warn("[Blockscape] invalid external url skipped",e,n),{isExternal:!1,url:""}}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function ns(e){const t=document.createElement("button");return t.type="button",t.className="external-link obsidian-link",t.setAttribute("aria-label","Open in Obsidian"),t.title=e,t.textContent="O",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function is(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function nr(e,t){if(!e)return;const n=e.querySelector(".obsidian-link");if(!t){n&&n.remove(),e.removeAttribute("data-obsidian-url");return}if(e.dataset.obsidianUrl=t,n){n.title=t;return}e.appendChild(ns(t))}function ir(){$n||($n=requestAnimationFrame(()=>{$n=null,on=on.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),on.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const i=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${i}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function os(e,t){!e||!t||(on.push({labelEl:e,textEl:t}),ir())}function rs(e,t){var r,a;const n=[`<div class="version-nav__tooltip-title">${_n(t)}</div>`],i=((e==null?void 0:e.version)??((r=e==null?void 0:e.data)==null?void 0:r.version)??"").toString().trim();i&&n.push(`<div class="version-nav__tooltip-meta">Version ${_n(i)}</div>`);const o=(((a=e==null?void 0:e.data)==null?void 0:a.abstract)??"").toString().trim();return o?n.push(`<div class="version-nav__tooltip-body">${o}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function Qn(e,t,{offset:n=8}={}){!E||!e||!t||(E.innerHTML=t,E.hidden=!1,E.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const i=e.getBoundingClientRect(),o=E.getBoundingClientRect(),r=window.scrollX||document.documentElement.scrollLeft,a=window.scrollY||document.documentElement.scrollTop;let d=i.left+i.width/2-o.width/2+r,u=i.top-o.height-n+a;d<r+n&&(d=r+n);const h=r+window.innerWidth-o.width-n;d>h&&(d=h),u<a+n&&(u=i.bottom+n+a),E.style.left=`${d}px`,E.style.top=`${u}px`,E.classList.add("is-visible")}))}function qt(){mn&&(clearTimeout(mn),mn=null),E&&(E.classList.remove("is-visible"),E.setAttribute("aria-hidden","true"),E.hidden=!0)}function as(e,t){if(!e)return;const n=Re((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const i=rs(t,n);let o=null;const r=()=>{o&&(clearTimeout(o),o=null)},a=()=>{nn=e,Qn(e,`<div class="version-nav__tooltip-title">${_n(n)}</div>`,{offset:10})},d=()=>{r(),o=setTimeout(()=>{nn===e&&Qn(e,i,{offset:10})},S)},u=()=>{a(),d()},h=()=>{nn!==e&&a(),d()},b=()=>{r(),nn===e&&(nn=null,qt())};e.addEventListener("mouseenter",u),e.addEventListener("focus",u),e.addEventListener("pointermove",h),e.addEventListener("mouseleave",b),e.addEventListener("blur",b),e.addEventListener("click",b)}function ss(){en&&(en=!1,!(!Ft||!hn)&&(qt(),Qn(Ft,hn,{offset:12}),mn=setTimeout(()=>{qt(),ls()},1e3)))}function ls(){Ft&&(tn&&(clearTimeout(tn),tn=null),Ft.classList.add("blockscape-tab--twinkle"),tn=setTimeout(()=>{Ft.classList.remove("blockscape-tab--twinkle"),tn=null},1400))}window.addEventListener("scroll",qt,!0),window.addEventListener("resize",qt);function Et(){$&&($.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),$.setAttribute("aria-hidden","true"),$.hidden=!0,or([]))}function cs(e,t){$&&(Xe={x:e,y:t},$.hidden=!1,$.setAttribute("aria-hidden","false"),$.classList.add("is-visible"),kn(e,t))}function kn(e,t){if(!$)return;const n=12;$.style.left=`${e+n}px`,$.style.top=`${t+n}px`;const i=$.getBoundingClientRect();let o=i.left,r=i.top;i.right>window.innerWidth-n&&(o=Math.max(n,window.innerWidth-i.width-n)),i.bottom>window.innerHeight-n&&(r=Math.max(n,window.innerHeight-i.height-n)),$.style.left=`${o}px`,$.style.top=`${r}px`}function or(e=[]){he&&(he.innerHTML="",e.forEach(t=>{const n=document.createElement("button");n.type="button",n.className="item-preview__action",n.textContent=t.label||"Action",t.title&&(n.title=t.title),n.addEventListener("click",i=>{i.stopPropagation(),typeof t.onClick=="function"&&t.onClick(i)}),he.appendChild(n)}),he.hidden=e.length===0)}async function ds(e,t){var b;if(!$)return;e.stopPropagation(),e.preventDefault();const n=t.dataset.id,i=((b=t.querySelector(".name"))==null?void 0:b.textContent)||n||"Preview",o=n?`${n}.html`:"",r=o?`items/${o}`:"",a=++Ot,d=t.dataset.externalUrl||"",u=t.dataset.obsidianUrl||"",h=[{label:"Edit",title:"Edit this item",onClick:()=>{Et(),sn.open(n)}}];if(d&&h.push({label:"Open link ↗",title:d,onClick:()=>window.open(d,"_blank","noopener")}),u&&h.push({label:"Open in Obsidian",title:u,onClick:()=>window.open(u,"_blank","noopener")}),or(h),n&&ft(n),le.textContent=i,G.innerHTML='<div class="item-preview__status">Loading…</div>',$.classList.remove("item-preview--has-frame"),$.classList.add("item-preview--expanded"),cs(e.clientX,e.clientY),!r){G.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',kn(Xe.x,Xe.y);return}try{const A=await fetch(r,{cache:"no-cache"});if(!A.ok)throw new Error(`HTTP ${A.status}`);const C=await A.text();if(a!==Ot)return;if(!C.trim()){G.innerHTML=`<div class="item-preview__status">No content in <code>${_n(o)}</code>.</div>`,kn(Xe.x,Xe.y);return}const F=document.createElement("iframe");F.className="item-preview__frame",F.title=`${i} details`,F.srcdoc=C,G.innerHTML="",G.appendChild(F),$.classList.add("item-preview--has-frame"),kn(Xe.x,Xe.y)}catch(A){if(a!==Ot)return;G.innerHTML=`<div class="item-preview__status">No preview available for <strong>${_n(i)}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${r}`,A),kn(Xe.x,Xe.y)}}be&&be.addEventListener("click",Et),O&&O.addEventListener("click",()=>{Oa()}),ue&&ue.addEventListener("click",()=>{Ma()}),pe&&pe.addEventListener("click",Oi),ke&&ke.addEventListener("click",Oi),He&&He.addEventListener("click",Mi),Qe&&Qe.addEventListener("click",Mi),p&&p.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");!t||!p.contains(t)||ds(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||!$||$.hidden||$.contains(e.target)||Et()}),Ve&&Ve.addEventListener("click",()=>{Vo("button")}),K&&K.addEventListener("click",()=>{if(g<0){alert("Load or select a model before creating a version.");return}try{const e=Ro({versionLabel:"map edit"});lt(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),D&&D.addEventListener("click",async()=>{var r;if(g<0||!k[g]){alert("Select or load a model before sharing.");return}const e={title:Re(k[g],"Shared Model"),data:k[g].data};let t;try{t=Ur(JSON.stringify(e))}catch(a){console.error("[Blockscape] share encode failed",a),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const i=n.toString();try{window.history.replaceState({},document.title,i)}catch(a){console.warn("[Blockscape] failed to update URL for share",a),window.location.hash=n.hash}let o=!1;if((r=navigator.clipboard)!=null&&r.writeText)try{await navigator.clipboard.writeText(i),o=!0}catch(a){console.warn("[Blockscape] clipboard write failed",a)}o?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",i)}),ee&&ee.addEventListener("click",()=>{const e=(s.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};L&&(n.selectedItemId=L),localStorage.setItem(Le,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";L&&(t=`editor.html?selected=${encodeURIComponent(L)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==Le||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||zo("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===at&&zo("message")})),document.addEventListener("keydown",e=>{var n,i,o,r,a,d,u,h,b,A;if($a()){e.key==="Escape"&&(e.preventDefault(),Oi());return}if(!(Q!=null&&Q.hidden)&&e.key==="Escape"){e.preventDefault(),Mi();return}if(!((n=sn==null?void 0:sn.isOpen)!=null&&n.call(sn))){if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const C=k[g],x=((i=C==null?void 0:C.apicurioVersions)==null?void 0:i.length)>1;Vo("shortcut",x);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!cn())return;if(Is()){e.preventDefault();return}}if(e.key==="Escape"){let C=!1;$&&!$.hidden&&(Et(),C=!0),(L||oe)&&(Zn(),C=!0),C&&e.preventDefault()}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(!cn())return;const C=e.key==="ArrowLeft"?-1:1;if(e.altKey)return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){Vi(C)&&e.preventDefault();return}if(e.ctrlKey||e.metaKey)return;if(oe&&!e.shiftKey){e.preventDefault();return}e.shiftKey?ws(C)&&e.preventDefault():ys(C)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(!cn())return;const C=e.key==="ArrowUp"?-1:1;if((e.ctrlKey||e.metaKey)&&!e.altKey){Ss(C)&&e.preventDefault();return}if(e.altKey)return;if(oe&&!L&&!e.shiftKey){if(_s(C)){e.preventDefault();return}if(Za(C)){e.preventDefault();return}}e.shiftKey?ks(C)&&e.preventDefault():Es(C)&&e.preventDefault()}if(e.key==="Delete"){if(!cn()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const C=oe?As():!1,x=C?!0:sr();(C||x)&&e.preventDefault()}if(e.key==="F2"){if(!cn())return;const C=oe&&!L&&oe||!L&&((d=(a=(r=(o=e.target)==null?void 0:o.closest)==null?void 0:r.call(o,".category"))==null?void 0:a.dataset)==null?void 0:d.cat)||null;if(C&&!L&&vs(C)){e.preventDefault();return}const x=L||((A=(b=(h=(u=e.target)==null?void 0:u.closest)==null?void 0:h.call(u,".tile"))==null?void 0:b.dataset)==null?void 0:A.id);x&&sn.open(x)&&e.preventDefault()}if(e.key==="Insert"){if(!cn()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;ar()&&e.preventDefault()}}}),window.addEventListener("resize",()=>{!$||$.hidden||kn(Xe.x,Xe.y)}),window.addEventListener("scroll",()=>{!$||$.hidden||Et()},!0);let Yt=null,ei=null;function us(e){Et(),Yt=e.target.dataset.id,ei=e.target.closest(".category").dataset.cat,e.target.classList.add("dragging"),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify({itemId:Yt,categoryId:ei})),e.target.closest(".category").querySelector(".grid").classList.add("drag-active"),console.log("[Blockscape] drag start",Yt,"from",ei)}function ps(e){e.target.classList.remove("dragging"),p.querySelectorAll(".grid").forEach(t=>t.classList.remove("drag-active")),p.querySelectorAll(".tile").forEach(t=>t.classList.remove("drag-over")),Yt=null,ei=null}function fs(e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function ms(e){e.preventDefault();const t=e.target.closest(".grid");t&&t.classList.add("drag-active")}function hs(e){const t=e.target.closest(".grid");t&&!t.contains(e.relatedTarget)&&t.classList.remove("drag-active")}function gs(e){e.preventDefault();const t=e.target.closest(".grid");if(!t)return;const n=t.closest(".category");if(!n)return;const i=n.dataset.cat;if(!Yt||!i)return;const r=Array.from(t.querySelectorAll(".tile")).filter(a=>a.dataset.id!==Yt).find(a=>{const d=a.getBoundingClientRect();return e.clientY<d.top+d.height/2});rr(Yt,r?r.dataset.id:null,i),wn(),console.log("[Blockscape] drop completed",Yt,"from",ei,"to",i)}function rr(e,t,n){if(g<0)return;const o=k[g].data.categories||[],r=o.find(b=>(b.items||[]).some(A=>A.id===e)),a=o.find(b=>b.id===n);if(!r||!a)return;r.items=r.items||[],a.items=a.items||[];const d=r.items.findIndex(b=>b.id===e);if(d===-1)return;const[u]=r.items.splice(d,1);let h=a.items.length;if(t){const b=a.items.findIndex(A=>A.id===t);b!==-1&&(h=b)}a.items.splice(h,0,u),pt(),ct()}function bs(e){if(g<0||!e)return;const t=k[g].data,i=(t.categories||[]).find(u=>u.id===e);if(!i)return;i.items=i.items||[];const o=`New item ${i.items.length+1}`,a={id:_a(`${e}-${i.items.length+1}`,t),name:o,deps:[]};i.items.push(a),pt(),ct(),Et(),ft(a.id);const d=ne.get(a.id);d!=null&&d.el&&d.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",a.id,"to",e)}function ar(){if(g<0)return!1;const e=k[g].data;e.categories=e.categories||[];const t=`New category ${e.categories.length+1}`,n=ka(t,e),i={id:n,title:t,items:[]};return e.categories.push(i),oe=n,L=null,Fe=null,Be=null,pt(),ct(),Pt(n),console.log("[Blockscape] added category",n),!0}function vs(e=Xn()){if(g<0||!e)return!1;const t=Ia.open(e);return t&&(L=null,Fe=null,st()),t}function ws(e){if(!L||g<0||!e)return!1;const n=k[g].data.categories||[],i=ne.get(L);let o=null;if(i!=null&&i.catId&&(o=n.find(u=>u.id===i.catId)),o||(o=n.find(u=>(u.items||[]).some(h=>h.id===L))),!o)return!1;o.items=o.items||[];const r=o.items.findIndex(u=>u.id===L);if(r===-1)return!1;const a=r+e;if(a<0||a>=o.items.length)return!1;const[d]=o.items.splice(r,1);return o.items.splice(a,0,d),pt(),ct(),wn(),ft(L),!0}function ys(e){if(!W||!W.m||!e)return!1;const t=W.m.categories||[];if(!t.length)return!1;const n=()=>{const u=t.find(h=>(h.items||[]).length);return u?{category:u,item:u.items[0]}:null};if(!L){const u=n();return u?(ft(u.item.id),!0):!1}const i=ne.get(L);let o=null;if(i!=null&&i.catId&&(o=t.find(u=>u.id===i.catId)),o||(o=t.find(u=>(u.items||[]).some(h=>h.id===L))),!o){const u=n();return u?(ft(u.item.id),!0):!1}const r=o.items||[];if(!r.length)return!1;const a=r.findIndex(u=>u.id===L);if(a===-1)return!1;const d=a+e;return d<0||d>=r.length?!1:(ft(r[d].id),!0)}function Es(e){if(!W||!W.m||!e)return!1;const t=W.m.categories||[];if(!t.length)return!1;const n=Xn();let i=t.findIndex(a=>a.id===n),o=i+e;if(i===-1&&(o=e>0?0:t.length-1),o<0||o>=t.length)return!1;const r=t[o];if(L){const d=(t[i].items||[]).findIndex(u=>u.id===L);Be={catId:r.id,position:d===-1?0:d}}else Be=null;return Pt(r.id,{preserveEntryHint:!0})}function _s(e){var r;if(!oe||!((r=W==null?void 0:W.m)!=null&&r.categories)||!e)return!1;const n=(W.m.categories||[]).find(a=>a.id===oe);if(!n)return!1;const i=n.items||[];if(!i.length)return!1;let o=e>0?0:Math.max(0,i.length-1);return(Be==null?void 0:Be.catId)===n.id&&(o=Math.min(i.length-1,Math.max(0,Be.position||0))),Be=null,ft(i[o].id),!0}function ks(e){if(!L||g<0||!e)return!1;const n=k[g].data.categories||[];if(!n.length)return!1;const i=ne.get(L);let o=-1;if(i!=null&&i.catId&&(o=n.findIndex(A=>A.id===i.catId)),o===-1&&(o=n.findIndex(A=>(A.items||[]).some(C=>C.id===L))),o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const a=n[o],d=n[r];if(!d)return!1;a.items=a.items||[],d.items=d.items||[];const u=a.items.findIndex(A=>A.id===L);if(u===-1)return!1;const h=Math.min(d.items.length,Math.max(0,u)),b=h<d.items.length?d.items[h].id:null;return rr(L,b,d.id),wn(),ft(L),!0}function Ss(e){if(g<0||!e)return!1;const n=k[g].data.categories||[];if(!n.length)return!1;const i=Xn();if(!i)return!1;const o=n.findIndex(d=>d.id===i);if(o===-1)return!1;const r=o+e;if(r<0||r>=n.length)return!1;const[a]=n.splice(o,1);return n.splice(r,0,a),oe=a.id,Hi(),Be=null,st(),pt(),ct(),yn(),console.log("[Blockscape] moved category",a.id,"from",o,"to",r),!0}function Is(){if(g<0)return!1;const e=k[g],t=Ze(e)||(e?e.id:null),n=[];if(Ee&&t===Ee.modelId&&n.push({...Ee,type:"item"}),Ht&&t===Ht.modelId&&n.push({...Ht,type:"category"}),!n.length)return!1;const i=n.reduce((o,r)=>o?(r.ts||0)>(o.ts||0)?r:o:r,null);if(!i)return!1;if(i.type==="category"){if(xs(i))return!0}else if(i.type==="item"&&Cs(i))return!0;return!1}function Cs(e){const t=k[g],n=Ze(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const r=(t.data.categories||[]).find(d=>d.id===e.categoryId);if(!r)return!1;r.items=r.items||[];const a=Math.min(Math.max(e.index,0),r.items.length);return r.items.splice(a,0,e.item),Ee=null,Et(),L=null,Fe=null,st(),pt(),ct(),wn(),ft(e.item.id),console.log("[Blockscape] undo delete restored",e.item.id),!0}function xs(e){const t=k[g],n=Ze(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const i=t.data;i.categories=i.categories||[];const o=Math.min(Math.max(e.index,0),i.categories.length);return i.categories.splice(o,0,e.category),Ht=null,L=null,Fe=null,oe=e.category.id,Be=null,st(),pt(),ct(),yn(),Pt(e.category.id),console.log("[Blockscape] undo delete restored category",e.category.id),!0}function sr(){if(!L||g<0)return!1;const t=k[g].data.categories||[];if(!t.length)return!1;const n=ne.get(L);let i=null;if(n!=null&&n.catId&&(i=t.find(h=>h.id===n.catId)),i||(i=t.find(h=>(h.items||[]).some(b=>b.id===L))),!i||!Array.isArray(i.items))return!1;const o=i.items.findIndex(h=>h.id===L);if(o===-1)return!1;const r=i.items.splice(o,1)[0];if(!r)return!1;const a=k[g];Ee={item:r,categoryId:i.id,index:o,modelId:Ze(a)||(a?a.id:null),ts:Date.now()};const u=(()=>{var b;if(i.items.length){const A=Math.min(o,i.items.length-1);return((b=i.items[A])==null?void 0:b.id)||null}const h=t.findIndex(A=>A.id===i.id);if(h===-1)return null;for(let A=h+1;A<t.length;A++){const C=t[A].items||[];if(C.length)return C[0].id}for(let A=h-1;A>=0;A--){const C=t[A].items||[];if(C.length)return C[0].id}return null})();return Et(),L=null,Fe=null,Be=null,st(),pt(),ct(),wn(),u?ft(u):Zn(),console.log("[Blockscape] removed item",r.id),!0}function As(){var d,u;const e=Xn();if(!e||g<0)return!1;const n=k[g].data.categories||[];if(!n.length)return!1;const i=n.findIndex(h=>h.id===e);if(i===-1)return!1;const[o]=n.splice(i,1);if(!o)return!1;const r=k[g];Ht={category:o,index:i,modelId:Ze(r)||(r?r.id:null),ts:Date.now()},oe=null,L=null,Fe=null,Be=null,st(),pt(),ct();const a=((d=n[i])==null?void 0:d.id)||((u=n[i-1])==null?void 0:u.id)||null;return a?Pt(a):Zn(),console.log("[Blockscape] removed category",o.id),!0}function Ls(e){if(!e)return!1;const t=L;L=e;const n=sr();return n||(L=t,st()),n}J&&J.addEventListener("click",async()=>{const e=s.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await Bo(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),Y&&Y.addEventListener("click",async()=>{const e=Ca();if(!e){alert("No series available to copy. Create another version first.");return}await Bo(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),Oe&&Oe.addEventListener("click",async()=>{try{const e=await Wr();if(!e){alert("Clipboard is empty.");return}s.value=e,s.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=()=>{try{const e=Kt(s.value,"Pasted",{promptForSeriesName:!0});if(!e.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",e.length,"model(s)");let t=null;e.forEach((n,i)=>{const o=Wt(n,{versionLabel:e.length>1?`paste #${i+1}`:"paste"});t==null&&(t=o)}),g===-1&&t!=null?lt(t):ln()}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(g<0){alert("No active model selected.");return}try{const t=JSON.parse(s.value);if(an(t,{titleHint:Re(k[g]),idHint:Ze(k[g])||Re(k[g])}),k[g].data=t,k[g].title=t.title||k[g].title,k[g].isSeries||((e=k[g].apicurioVersions)==null?void 0:e.length)>1){const n=k[g].title||Re(k[g]);vt(k[g],{seriesName:n,fallbackTitle:n})}Ti(),console.log("[Blockscape] replaced active model:",Re(k[g])),ct(),Ie.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const i of t){const o=await i.text(),r=i.name.replace(/\.[^.]+$/,"")||"File",a=Kt(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models in file:",i.name);continue}a.forEach((d,u)=>{var de;const h=(((de=d.data)==null?void 0:de.title)??"").toString().trim(),b=a.length>1?`${i.name} #${u+1}`:i.name,A=`${r} series`,C=d.isSeries?A:null;let x={...d};if(d.isSeries){const xe=C||h||d.title||b||"unknown";x.title=xe;const T=Qt(xe||"unknown");ui(x,T),vt(x,{seriesName:xe,fallbackTitle:"unknown"}),x.apicurioArtifactName=x.apicurioArtifactName||xe}else x.title=h||b;const F=Wt({...x,apicurioArtifactName:x.apicurioArtifactName||C||x.apicurioArtifactName},{versionLabel:i.name});n==null&&(n=F)})}g===-1&&n!=null?lt(n):ln()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",Ns);function Ns(e){var o;if(!cn())return;const t=((o=e.clipboardData)==null?void 0:o.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Fa(t))return;let n=[];try{n=Kt(t,"Clipboard",{promptForSeriesName:!0})}catch(r){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",r);return}if(!n.length)return;e.preventDefault();let i=null;n.forEach((r,a)=>{const d=Wt(r,{versionLabel:n.length>1?`paste #${a+1}`:"paste"});i==null&&(i=d)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),i!=null&&lt(i)}R.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&(La(),lt(n))}),document.getElementById("removeModel").onclick=()=>{if(g<0)return;const e=Re(k[g]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",Re(k[g])),k.splice(g,1),!k.length){g=-1,W=null,p.innerHTML="",I.innerHTML="",s.value="",ln(),Ti();return}const n=Math.min(g,k.length-1);lt(n)},Se&&(Se.addEventListener("input",e=>{Wo(e.target.value||"")}),Se.addEventListener("focus",()=>{Se.value&&Se.value.trim()&&Jo(Se.value)})),M&&M.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),i=t.dataset.itemId;Va({modelIndex:n,itemId:i})}),document.addEventListener("click",e=>{if(!M||M.hidden)return;const t=e.target;M.contains(t)||Se&&(t===Se||Se.contains(t))||(M.hidden=!0)}),y&&q&&Z&&y.addEventListener("submit",async e=>{e.preventDefault();const t=q.value.trim();if(!t){alert("Please enter a URL"),q.focus();return}const n=await Fi(t);if(typeof n=="number"){lt(n),q.value="";const i=document.getElementById("urlHint");i&&(i.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!q||!t)return;let n=null;q.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const o=q.value.slice(-12);t.textContent=o?`…${o}`:""},300)})}();function ct(){if(!(g<0))try{W=Wa(k[g].data),wn()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function Ts(){const e=["comms.bs","planets.bs","styleguide.bs","blockscape-features.bs"],t=n=>xi?xi.endsWith("/")?`${xi}${n}`:`${xi}/${n}`:n;for(const n of e)try{const i=await fetch(t(n),{cache:"no-store"});if(!i.ok){console.warn(`[Blockscape] ${n} not fetched (${i.status}); skipping`);continue}const o=await i.text(),r=n.replace(/\.[^.]+$/,"")||"Model",a=Kt(o,r,{seriesTitleOverride:`${r} series`});if(!a.length){console.warn("[Blockscape] no models found in",n);continue}a.forEach(d=>{let u={...d};if(d.isSeries){const h=`${r} series`;u={...d,title:h,apicurioArtifactName:h};const b=Qt(h||"unknown");ui(u,b),vt(u,{seriesName:h,fallbackTitle:"unknown"})}Wt(u,{versionLabel:n})}),console.log(`[Blockscape] loaded ${a.length} model(s) from ${n}`)}catch(i){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",i)}ln()}async function Bs(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const i of t)try{console.log(`[Blockscape] fetching ${e} with cache="${i.cache??"default"}"`);const o=await fetch(e,i);if(o.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return await o.text()}catch(o){n=o}throw n||new Error("Unable to fetch URL")}function $s(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(i=>Os(i)),e.querySelectorAll("a[href]").forEach(i=>{const o=i.getAttribute("href");cr(o)&&lr(i,o)})}function Os(e){var d,u;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(u=(d=e.parentNode)==null?void 0:d.closest)!=null&&u.call(d,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,i=[];let o;for(;(o=n.exec(t))!==null;)i.push({url:o[0],index:o.index});if(!i.length)return;const r=document.createDocumentFragment();let a=0;i.forEach(({url:h,index:b})=>{b>a&&r.appendChild(document.createTextNode(t.slice(a,b))),r.appendChild(Ms(h)),a=b+h.length}),a<t.length&&r.appendChild(document.createTextNode(t.slice(a))),e.parentNode.replaceChild(r,e)}function Ms(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",cr(e)&&lr(t,e),t}function lr(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>Ps(n,t,e)))}async function Ps(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await Fi(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function cr(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function Fi(e){try{console.log("[Blockscape] loading from URL:",e);const t=await Bs(e),i=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let o;try{o=Kt(t,i)}catch(a){throw new Error(`Invalid JSON payload: ${a.message}`)}if(!o.length)throw new Error("No JSON objects found in response.");let r=null;return o.forEach((a,d)=>{var x;const u=(((x=a.data)==null?void 0:x.title)??"").toString().trim(),h=o.length>1?`${i} #${d+1}`:i,b=a.isSeries?`${i} series`:null;let A={...a};if(a.isSeries){const F=b||u||A.title||h;A={...a,title:F,apicurioArtifactName:F||a.apicurioArtifactName};const de=Qt(F||"unknown");ui(A,de),vt(A,{seriesName:F||b||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:de,url:e,baseName:i,seriesTitle:F})}const C=Wt({...A,title:u||A.title||h,apicurioArtifactName:A.apicurioArtifactName||b||a.apicurioArtifactName},{versionLabel:i});r==null&&(r=C)}),console.log(`[Blockscape] loaded ${o.length} model(s) from URL:`,i),g===-1&&r!=null?lt(r):ln(),r}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}l.detect(),async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const i=Kt(n,"Blockscape");if(!i.length)throw new Error("Seed template could not be parsed.");let o=null;i.forEach(b=>{const A=Wt(b,{versionLabel:"seed"});o==null&&(o=A)}),await Ts();const r=await Ja(),a=Go(),d=a==null?void 0:a.index,u=ja();lt(typeof r=="number"?r:typeof u=="number"?u:typeof d=="number"?d:o??0)}()}function fl(s){let c;return{c(){c=U("div"),c.innerHTML='<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>',w(c,"id","shortcutHelp"),w(c,"class","shortcut-help"),c.hidden=!0,w(c,"aria-hidden","true"),w(c,"role","dialog"),w(c,"aria-modal","true"),w(c,"aria-labelledby","shortcutHelpTitle")},m(p,I){rt(p,c,I)},p:Gt,i:Gt,o:Gt,d(p){p&&Ye(c)}}}class ml extends xo{constructor(c){super(),Co(this,c,null,fl,So,{})}}const hl=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: required string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects
    * optional \`links\`: array of \`{ "from": "id", "to": "id" }\` for cross‑category edges

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * \`deps\`: array of item \`id\`s this item **depends on** (must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\`, \`title\`, and \`abstract\` are present and non-empty.
* All \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* No extra fields beyond those listed above.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\``;function Lr(s){let c,p,I,E,R,$,y,q;return{c(){c=U("div"),p=U("div"),I=U("a"),E=Io("Open Blockscape GPT"),R=se(),$=U("div"),$.textContent="Paste the copied prompt into that chat.",y=se(),q=U("div"),q.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',w(I,"href",bl),w(I,"target","_blank"),w(I,"rel","noreferrer"),w($,"class","new-panel__hint"),w(p,"class","new-panel__link"),w(q,"class","new-panel__link new-panel__link--disabled"),w(c,"class","new-panel__links")},m(Z,le){rt(Z,c,le),N(c,p),N(p,I),N(I,E),N(p,R),N(p,$),N(c,y),N(c,q)},p:Gt,d(Z){Z&&Ye(c)}}}function Nr(s){let c,p,I,E,R,$;return{c(){c=U("div"),p=U("div"),p.textContent="Generated prompt",I=se(),E=U("textarea"),w(p,"class","new-panel__prompt-label"),w(E,"class","pf-v5-c-form-control new-panel__textarea"),w(E,"rows","4"),E.readOnly=!0,w(c,"class","new-panel__prompt")},m(y,q){rt(y,c,q),N(c,p),N(c,I),N(c,E),Nn(E,s[4]),R||($=fn(E,"input",s[12]),R=!0)},p(y,q){q&16&&Nn(E,y[4])},d(y){y&&Ye(c),R=!1,$()}}}function gl(s){let c,p,I,E,R,$,y,q,Z,le,G,he,be,Ve,D,K,ee,J,Y,Oe,O,ue,re,ye,pe,ke,Q,He,Qe,Se,M,ce,Ge,ge,De,Je,We,Ne,Le,at,ut,k,g,Ie,W,ne=s[2]==="gpt"&&Lr(),Te=s[4]&&s[5]&&Nr(s);return g=Ks(s[10][0]),{c(){c=U("div"),p=U("div"),I=se(),E=U("div"),R=U("div"),R.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',$=se(),y=U("form"),q=U("div"),Z=U("label"),Z.textContent="Domain",le=se(),G=U("p"),G.textContent="Describe what you want to create a map for.",he=se(),be=U("textarea"),Ve=se(),D=U("div"),K=U("label"),ee=U("input"),J=se(),Y=U("span"),Y.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,Oe=se(),O=U("fieldset"),ue=U("legend"),ue.textContent="Target",re=se(),ye=U("p"),ye.textContent="Choose where you plan to use the prompt.",pe=se(),ke=U("label"),Q=U("input"),He=se(),Qe=U("div"),Qe.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',Se=se(),M=U("label"),ce=U("input"),Ge=se(),ge=U("div"),ge.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',De=se(),Je=U("div"),We=U("button"),We.textContent="Copy prompt",Ne=se(),Le=U("div"),at=Io(s[3]),ut=se(),ne&&ne.c(),k=se(),Te&&Te.c(),w(p,"id","newPanelBackdrop"),w(p,"class","shortcut-help__backdrop"),w(R,"class","shortcut-help__header"),w(Z,"for","newDomain"),w(G,"class","new-panel__hint"),w(be,"id","newDomain"),w(be,"class","pf-v5-c-form-control new-panel__textarea"),w(be,"rows","4"),be.required=!0,w(be,"placeholder","Ex: Companies building open-source geospatial tools"),w(q,"class","new-panel__field"),w(ee,"id","seriesToggle"),w(ee,"type","checkbox"),w(K,"class","new-panel__toggle"),w(K,"for","seriesToggle"),w(D,"class","new-panel__field"),w(ye,"class","new-panel__hint"),w(Q,"type","radio"),w(Q,"name","target"),Q.__value="gpt",Nn(Q,Q.__value),w(ke,"class","new-panel__option"),w(ce,"type","radio"),w(ce,"name","target"),ce.__value="plain",Nn(ce,ce.__value),w(M,"class","new-panel__option"),w(O,"class","new-panel__field"),w(We,"class","pf-v5-c-button pf-m-primary"),w(We,"type","submit"),w(Le,"class","new-panel__status"),w(Le,"aria-live","polite"),w(Je,"class","new-panel__actions"),w(y,"class","shortcut-help__list new-panel__form"),w(E,"class","shortcut-help__panel"),w(E,"tabindex","-1"),w(c,"id","newPanel"),w(c,"class","shortcut-help"),c.hidden=!0,w(c,"aria-hidden","true"),w(c,"role","dialog"),w(c,"aria-modal","true"),w(c,"aria-labelledby","newPanelTitle"),g.p(Q,ce)},m(L,oe){rt(L,c,oe),N(c,p),N(c,I),N(c,E),N(E,R),N(E,$),N(E,y),N(y,q),N(q,Z),N(q,le),N(q,G),N(q,he),N(q,be),Nn(be,s[0]),N(y,Ve),N(y,D),N(D,K),N(K,ee),ee.checked=s[1],N(K,J),N(K,Y),N(y,Oe),N(y,O),N(O,ue),N(O,re),N(O,ye),N(O,pe),N(O,ke),N(ke,Q),Q.checked=Q.__value===s[2],N(ke,He),N(ke,Qe),N(O,Se),N(O,M),N(M,ce),ce.checked=ce.__value===s[2],N(M,Ge),N(M,ge),N(y,De),N(y,Je),N(Je,We),N(Je,Ne),N(Je,Le),N(Le,at),N(y,ut),ne&&ne.m(y,null),N(y,k),Te&&Te.m(y,null),Ie||(W=[fn(be,"input",s[7]),fn(ee,"change",s[8]),fn(Q,"change",s[9]),fn(ce,"change",s[11]),fn(y,"submit",zs(s[6]))],Ie=!0)},p(L,[oe]){oe&1&&Nn(be,L[0]),oe&2&&(ee.checked=L[1]),oe&4&&(Q.checked=Q.__value===L[2]),oe&4&&(ce.checked=ce.__value===L[2]),oe&8&&Xs(at,L[3]),L[2]==="gpt"?ne?ne.p(L,oe):(ne=Lr(),ne.c(),ne.m(y,k)):ne&&(ne.d(1),ne=null),L[4]&&L[5]?Te?Te.p(L,oe):(Te=Nr(L),Te.c(),Te.m(y,null)):Te&&(Te.d(1),Te=null)},i:Gt,o:Gt,d(L){L&&Ye(c),ne&&ne.d(),Te&&Te.d(),g.r(),Ie=!1,ai(W)}}}const bl="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function vl(s,c,p){let I="",E=!1,R="gpt",$="",y="",q=!1;const Z=()=>{var J;return typeof navigator<"u"&&!!((J=navigator.clipboard)!=null&&J.writeText)};function le(J){const Y=J||"[DOMAIN]",Oe=E?"series":"map",ue=hl.replaceAll("[DOMAIN NAME]",Y).replaceAll("[DOMAIN]",Y).replaceAll("[map|series]",Oe).split(`
`),re=`Generate a **blockscape ${Oe}** for the domain of ${Y}.`,ye=ue.findIndex(ke=>ke.toLowerCase().includes("generate a **blockscape value")||ke.toLowerCase().includes("generate a blockscape [map|series]")||ke.toLowerCase().startsWith("generate a blockscape"));ye>=0?ue[ye]=re:ue.unshift(re);const pe=E?`

User requested a series (return an array of models).`:"";return`${ue.join(`
`).trim()}${pe}`}async function G(J){J.preventDefault();const Y=I.trim();if(p(3,$=""),p(5,q=R!=="gpt"),!Y){p(3,$="Add a domain to generate a prompt."),p(4,y="");return}if(R==="gpt"?p(4,y=`${E?"Create a series":"Create a map"} for ${Y}`):(p(4,y=le(Y)),p(5,q=!0)),!Z()){p(3,$="Clipboard access is unavailable. Copy the prompt below."),p(5,q=!0);return}try{await navigator.clipboard.writeText(y),p(3,$=R==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),R==="gpt"&&p(5,q=!1)}catch(O){console.warn("[Blockscape] clipboard write failed",O),p(3,$="Copy failed. Use the prompt below."),p(5,q=!0)}}const he=[[]];function be(){I=this.value,p(0,I)}function Ve(){E=this.checked,p(1,E)}function D(){R=this.__value,p(2,R)}function K(){R=this.__value,p(2,R)}function ee(){y=this.value,p(4,y)}return[I,E,R,$,y,q,G,be,Ve,D,he,K,ee]}class wl extends xo{constructor(c){super(),Co(this,c,vl,gl,So,{})}}const{document:Tr}=Gs;function yl(s){let c,p,I,E,R,$,y,q,Z,le,G,he,be,Ve,D,K,ee,J,Y,Oe,O,ue,re,ye,pe,ke,Q,He,Qe,Se,M,ce,Ge,ge,De,Je,We,Ne,Le,at,ut,k=`<script id="seed" type="application/json">${s[1]}<\/script>`,g,Ie,W,ne,Te,L,oe,Fe,Be,mt,et,Ot,Xe;return Fe=new ml({}),mt=new wl({}),{c(){c=U("link"),p=se(),I=U("div"),E=U("header"),R=U("div"),$=U("div"),y=U("div"),q=U("div"),q.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/> <a href="https://github.com/pwright/blockscape" target="_blank" class="pf-v5-c-button pf-m-plain" title="View on GitHub" aria-label="View Blockscape on GitHub"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a>',Z=se(),le=U("div"),G=U("div"),he=U("button"),be=U("span"),be.textContent="Toggle search and edit tools",Ve=se(),D=U("span"),D.textContent="▾",K=se(),ee=U("button"),ee.textContent="New",J=se(),Y=U("form"),Y.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',Oe=se(),O=U("label"),O.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',ue=se(),re=U("button"),re.textContent="Help",ye=se(),pe=U("div"),ke=U("div"),ke.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',Q=se(),He=U("button"),He.textContent="Edit",Qe=se(),Se=U("button"),Se.textContent="Share",ge=se(),De=U("div"),De.innerHTML='<span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span> <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span> <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span> <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>',Je=se(),We=U("main"),We.innerHTML=`<div class="blockscape-content"><aside class="blockscape-sidebar" aria-label="Models"><div class="sidebar-heading">Models</div> <ul id="modelList" class="model-nav-list"></ul> <div class="model-actions"><button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button></div> <section id="localBackendPanel" class="local-backend" hidden=""><div class="sidebar-heading">Local files</div> <p id="localBackendStatus" class="local-backend__status muted">Checking for local server…</p> <div class="local-backend__list"><label class="sr-only" for="localFileList">Blockscape files under ~/blockscape</label> <select id="localFileList" class="pf-v5-c-form-control" size="12" multiple="" aria-label="Blockscape files on local server"></select> <div class="local-backend__actions"><button id="refreshLocalFiles" class="pf-v5-c-button pf-m-tertiary" type="button">Refresh</button> <button id="loadLocalFile" class="pf-v5-c-button pf-m-secondary" type="button">Load</button></div></div> <div class="local-backend__save"><label for="localSavePath">Save active map to ~/blockscape</label> <input id="localSavePath" class="pf-v5-c-form-control" type="text" placeholder="my-map.bs"/> <button id="saveLocalFile" class="pf-v5-c-button pf-m-primary" type="button">Save</button></div></section></aside> <div class="blockscape-main"><section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,logo?,external?:url,color?,deps:[]}}], links?:[{from,to}] }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section></div></div>`,Ne=se(),Le=U("footer"),Le.innerHTML='<div class="blockscape-footer__inner"><a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a></div>',at=se(),ut=new Zs(!1),g=se(),Ie=Or("svg"),W=se(),ne=U("div"),Te=se(),L=U("div"),L.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',oe=se(),Ir(Fe.$$.fragment),Be=se(),Ir(mt.$$.fragment),Tr.title="Blockscape — simple landscape-style tiles",w(c,"rel","icon"),w(c,"type","image/svg+xml"),w(c,"href","./favicon.svg"),w(q,"class","blockscape-brand"),w(be,"class","sr-only"),w(D,"class","blockscape-toolbar__toggle-icon"),w(D,"aria-hidden","true"),w(he,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__toggle"),w(he,"type","button"),w(he,"aria-expanded",s[0]),w(he,"aria-controls","blockscapeHeaderExtras"),w(ee,"id","newPanelButton"),w(ee,"class","pf-v5-c-button pf-m-primary"),w(ee,"type","button"),w(ee,"title","Create something new"),w(Y,"id","urlForm"),w(Y,"class","blockscape-url-form"),w(Y,"autocomplete","on"),Y.noValidate=!0,w(O,"class","pf-v5-c-button pf-m-primary blockscape-file"),w(re,"id","helpButton"),w(re,"class","pf-v5-c-button pf-m-primary"),w(re,"type","button"),w(re,"title","Show keyboard shortcuts"),w(G,"class","blockscape-toolbar__primary"),w(ke,"class","blockscape-search"),w(He,"id","openInEditor"),w(He,"class","pf-v5-c-button pf-m-secondary"),w(He,"type","button"),w(He,"title","Open current JSON in the editor"),w(Se,"id","shareModel"),w(Se,"class","pf-v5-c-button pf-m-secondary"),w(Se,"type","button"),w(Se,"title","Copy a shareable URL for this model"),w(pe,"id","blockscapeHeaderExtras"),w(pe,"class","blockscape-toolbar__extras"),pe.hidden=M=!s[0],w(pe,"aria-hidden",ce=!s[0]),w(le,"class","blockscape-toolbar__controls"),w(le,"data-expanded",Ge=s[0]?"true":"false"),w(De,"class","blockscape-legend"),w(De,"role","presentation"),w(y,"class","blockscape-toolbar"),w($,"class","pf-v5-c-masthead__content"),w(R,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),w(E,"class","pf-v5-c-page__header"),w(We,"class","pf-v5-c-page__main"),w(Le,"class","pf-v5-c-page__footer blockscape-footer"),w(I,"class","pf-v5-c-page"),ut.a=g,w(Ie,"id","overlay"),w(Ie,"class","svg-layer"),w(ne,"id","tabTooltip"),w(ne,"class","blockscape-tab-tooltip"),ne.hidden=!0,w(ne,"aria-hidden","true"),w(L,"id","itemPreview"),w(L,"class","item-preview"),L.hidden=!0,w(L,"aria-hidden","true")},m(fe,Ee){N(Tr.head,c),rt(fe,p,Ee),rt(fe,I,Ee),N(I,E),N(E,R),N(R,$),N($,y),N(y,q),N(y,Z),N(y,le),N(le,G),N(G,he),N(he,be),N(he,Ve),N(he,D),N(G,K),N(G,ee),N(G,J),N(G,Y),N(G,Oe),N(G,O),N(G,ue),N(G,re),N(le,ye),N(le,pe),N(pe,ke),N(pe,Q),N(pe,He),N(pe,Qe),N(pe,Se),N(y,ge),N(y,De),N(I,Je),N(I,We),N(I,Ne),N(I,Le),rt(fe,at,Ee),ut.m(k,fe,Ee),rt(fe,g,Ee),rt(fe,Ie,Ee),rt(fe,W,Ee),rt(fe,ne,Ee),rt(fe,Te,Ee),rt(fe,L,Ee),rt(fe,oe,Ee),_o(Fe,fe,Ee),rt(fe,Be,Ee),_o(mt,fe,Ee),et=!0,Ot||(Xe=fn(he,"click",s[2]),Ot=!0)},p(fe,[Ee]){(!et||Ee&1)&&w(he,"aria-expanded",fe[0]),(!et||Ee&1&&M!==(M=!fe[0]))&&(pe.hidden=M),(!et||Ee&1&&ce!==(ce=!fe[0]))&&w(pe,"aria-hidden",ce),(!et||Ee&1&&Ge!==(Ge=fe[0]?"true":"false"))&&w(le,"data-expanded",Ge)},i(fe){et||(Eo(Fe.$$.fragment,fe),Eo(mt.$$.fragment,fe),et=!0)},o(fe){Sr(Fe.$$.fragment,fe),Sr(mt.$$.fragment,fe),et=!1},d(fe){fe&&(Ye(p),Ye(I),Ye(at),ut.d(),Ye(g),Ye(Ie),Ye(W),Ye(ne),Ye(Te),Ye(L),Ye(oe),Ye(Be)),Ye(c),ko(Fe,fe),ko(mt,fe),Ot=!1,Xe()}}}function El(s,c,p){const I=`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let E=!1;const R=()=>{if(p(0,E=!E),!E){const $=document.getElementById("search");$&&$.value&&($.value="",$.dispatchEvent(new Event("input",{bubbles:!0})))}};return el(()=>{pl()}),[E,I,R]}class _l extends xo{constructor(c){super(),Co(this,c,El,yl,So,{})}}const kl=document.getElementById("root");new _l({target:kl});
