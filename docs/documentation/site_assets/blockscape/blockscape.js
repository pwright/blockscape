var Blockscape=function(){"use strict";var Gu=Object.defineProperty;var qu=(Tn,Tt,Zn)=>Tt in Tn?Gu(Tn,Tt,{enumerable:!0,configurable:!0,writable:!0,value:Zn}):Tn[Tt]=Zn;var Xn=(Tn,Tt,Zn)=>qu(Tn,typeof Tt!="symbol"?Tt+"":Tt,Zn);var Tn=typeof document<"u"?document.currentScript:null;function Tt(){}function Zn(r){return r()}function xr(){return Object.create(null)}function Zo(r){r.forEach(Zn)}function Ar(r){return typeof r=="function"}function _i(r,c){return r!=r?c==c:r!==c||r&&typeof r=="object"||typeof r=="function"}function El(r){return Object.keys(r).length===0}const Sl=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function _(r,c){r.appendChild(c)}function yt(r,c,f){r.insertBefore(c,f||null)}function ft(r){r.parentNode&&r.parentNode.removeChild(r)}function H(r){return document.createElement(r)}function Tr(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function ra(r){return document.createTextNode(r)}function ue(){return ra(" ")}function Qn(r,c,f,A){return r.addEventListener(c,f,A),()=>r.removeEventListener(c,f,A)}function kl(r){return function(c){return c.preventDefault(),r.call(this,c)}}function w(r,c,f){f==null?r.removeAttribute(c):r.getAttribute(c)!==f&&r.setAttribute(c,f)}function Il(r){let c;return{p(...f){c=f,c.forEach(A=>r.push(A))},r(){c.forEach(f=>r.splice(r.indexOf(f),1))}}}function _l(r){return Array.from(r.childNodes)}function Cl(r,c){c=""+c,r.data!==c&&(r.data=c)}function eo(r,c){r.value=c??""}class xl{constructor(c=!1){Xn(this,"is_svg",!1);Xn(this,"e");Xn(this,"n");Xn(this,"t");Xn(this,"a");this.is_svg=c,this.e=this.n=null}c(c){this.h(c)}m(c,f,A=null){this.e||(this.is_svg?this.e=Tr(f.nodeName):this.e=H(f.nodeType===11?"TEMPLATE":f.nodeName),this.t=f.tagName!=="TEMPLATE"?f:f.content,this.c(c)),this.i(A)}h(c){this.e.innerHTML=c,this.n=Array.from(this.e.nodeName==="TEMPLATE"?this.e.content.childNodes:this.e.childNodes)}i(c){for(let f=0;f<this.n.length;f+=1)yt(this.t,this.n[f],c)}p(c){this.d(),this.h(c),this.i(this.a)}d(){this.n.forEach(ft)}}let Qo;function ei(r){Qo=r}function Al(){if(!Qo)throw new Error("Function called outside component initialization");return Qo}function Tl(r){Al().$$.on_mount.push(r)}const bo=[],Lr=[];let wo=[];const Nr=[],Ll=Promise.resolve();let sa=!1;function Nl(){sa||(sa=!0,Ll.then(Mr))}function la(r){wo.push(r)}const ca=new Set;let vo=0;function Mr(){if(vo!==0)return;const r=Qo;do{try{for(;vo<bo.length;){const c=bo[vo];vo++,ei(c),Ml(c.$$)}}catch(c){throw bo.length=0,vo=0,c}for(ei(null),bo.length=0,vo=0;Lr.length;)Lr.pop()();for(let c=0;c<wo.length;c+=1){const f=wo[c];ca.has(f)||(ca.add(f),f())}wo.length=0}while(bo.length);for(;Nr.length;)Nr.pop()();sa=!1,ca.clear(),ei(r)}function Ml(r){if(r.fragment!==null){r.update(),Zo(r.before_update);const c=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,c),r.after_update.forEach(la)}}function Bl(r){const c=[],f=[];wo.forEach(A=>r.indexOf(A)===-1?c.push(A):f.push(A)),f.forEach(A=>A()),wo=c}const Ci=new Set;let $l;function xi(r,c){r&&r.i&&(Ci.delete(r),r.i(c))}function da(r,c,f,A){if(r&&r.o){if(Ci.has(r))return;Ci.add(r),$l.c.push(()=>{Ci.delete(r)}),r.o(c)}}function ua(r){r&&r.c()}function Ai(r,c,f){const{fragment:A,after_update:C}=r.$$;A&&A.m(c,f),la(()=>{const F=r.$$.on_mount.map(Zn).filter(Ar);r.$$.on_destroy?r.$$.on_destroy.push(...F):Zo(F),r.$$.on_mount=[]}),C.forEach(la)}function Ti(r,c){const f=r.$$;f.fragment!==null&&(Bl(f.after_update),Zo(f.on_destroy),f.fragment&&f.fragment.d(c),f.on_destroy=f.fragment=null,f.ctx=[])}function Rl(r,c){r.$$.dirty[0]===-1&&(bo.push(r),Nl(),r.$$.dirty.fill(0)),r.$$.dirty[c/31|0]|=1<<c%31}function Li(r,c,f,A,C,F,Q=null,J=[-1]){const te=Qo;ei(r);const x=r.$$={fragment:null,ctx:[],props:F,update:Tt,not_equal:C,bound:xr(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(c.context||(te?te.$$.context:[])),callbacks:xr(),dirty:J,skip_bound:!1,root:c.target||te.$$.root};Q&&Q(x.root);let re=!1;if(x.ctx=f?f(r,c.props||{},(j,ae,...Me)=>{const tt=Me.length?Me[0]:ae;return x.ctx&&C(x.ctx[j],x.ctx[j]=tt)&&(!x.skip_bound&&x.bound[j]&&x.bound[j](tt),re&&Rl(r,j)),ae}):[],x.update(),re=!0,Zo(x.before_update),x.fragment=A?A(x.ctx):!1,c.target){if(c.hydrate){const j=_l(c.target);x.fragment&&x.fragment.l(j),j.forEach(ft)}else x.fragment&&x.fragment.c();c.intro&&xi(r.$$.fragment),Ai(r,c.target,c.anchor),Mr()}ei(te)}class Ni{constructor(){Xn(this,"$$");Xn(this,"$$set")}$destroy(){Ti(this,1),this.$destroy=Tt}$on(c,f){if(!Ar(f))return Tt;const A=this.$$.callbacks[c]||(this.$$.callbacks[c]=[]);return A.push(f),()=>{const C=A.indexOf(f);C!==-1&&A.splice(C,1)}}$set(c){this.$$set&&!El(c)&&(this.$$.skip_bound=!0,this.$$set(c),this.$$.skip_bound=!1)}}const Ol="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Ol);const Br="blockscape:apicurioConfig",pa="http://localhost:8080/apis/registry/v3",Mi="bs",$r="-series",fa=!1,ma=!1;function Pl({models:r,getActiveIndex:c,setActive:f,ensureModelMetadata:A,ensureSeriesId:C,getModelId:F,getSeriesId:Q,getModelTitle:J,computeJsonFingerprint:te,uid:x}){let re=null,j=null,ae=null,Me=null,tt=null,Ge=null,je=null,ze=null,W=null,Y=null;const we=new Set,R={baseUrl:pa,groupId:Mi,authToken:"",enabled:fa,useSemver:ma},_e=new Map,Oe=new Map;function pe(d){return(d||"").toString().trim().replace(/\/+$/,"")}function at(d){return`${(d||"").toString().trim()||Mi}${$r}`}function se(){return!!(R.baseUrl&&R.groupId)}function ve(){return R.enabled!==!1}function qe(){we.forEach(d=>{try{d(ve())}catch(y){console.warn("[Blockscape] failed to run Apicurio enabled listener",y)}})}function O(d){return typeof d=="function"&&we.add(d),()=>we.delete(d)}function Z(){ae&&(ae.value=R.baseUrl||""),Me&&(Me.value=R.groupId||""),tt&&(tt.value=R.authToken||""),Ge&&(Ge.checked=ve()),je&&(je.checked=!!R.useSemver)}function k(d="",y="muted"){ze&&(ze.textContent=d||"",ze.classList.remove("is-error","is-success"),y==="error"?ze.classList.add("is-error"):y==="success"&&ze.classList.add("is-success"))}function ee(d){if(!Y||(Y.innerHTML="",!d))return;const y=document.createElement("p");y.className="apicurio-hint",y.textContent=d,Y.appendChild(y)}function ke(d){_e.clear(),Oe.clear(),ee(d)}function ge(){const d=c(),y=ve(),N=se(),M=d>=0?r[d]:null,E=!!(M!=null&&M.apicurioVersions&&M.apicurioVersions.length>1);if(re){const V=re.dataset.loading==="true",X=y&&N&&d>=0&&!!ct(r[d]);re.disabled=!y||V||!X,y?V||(re.textContent="Push to Apicurio"):re.textContent="Enable Apicurio to push"}if(W){const V=W.dataset.loading==="true",X=y&&N&&E&&!!ct(M);W.disabled=!X||V,W.hidden=!E,y?V||(W.textContent="Push series"):W.textContent="Enable Apicurio to push series"}if(j){const V=j.dataset.loading==="true",X=y&&N;j.disabled=!X||V,V||(y?N?j.textContent="List artifacts":j.textContent="Enter details to list":j.textContent="Enable Apicurio to list")}}function Ie(){Z(),ve()?se()?(k("Apicurio push is ready when a model is selected.","muted"),_e.size||ee("Click “List artifacts” to browse the current group.")):(k("Enter Apicurio connection details to enable push.","muted"),ke("Enter registry details to browse artifacts.")):(k("Apicurio integration is off. Enable it to allow pushes.","muted"),ke("Apicurio integration is disabled.")),ge()}function $e(){if(window!=null&&window.localStorage)try{localStorage.setItem(Br,JSON.stringify(R))}catch(d){console.warn("[Blockscape] unable to persist Apicurio settings",d)}}function m(){let d={};if(window!=null&&window.localStorage)try{const V=localStorage.getItem(Br);if(V){const X=JSON.parse(V);X&&typeof X=="object"&&(d=X)}}catch(V){console.warn("[Blockscape] failed to restore Apicurio settings",V)}const y=pe(d.baseUrl??pa),N=(d.groupId??Mi).toString().trim();let M=fa,E=ma;typeof d.enabled=="boolean"?M=d.enabled:typeof d.enabled=="string"&&(M=d.enabled==="true"),typeof d.useSemver=="boolean"?E=d.useSemver:typeof d.useSemver=="string"&&(E=d.useSemver==="true"),R.baseUrl=y||pa,R.groupId=N||Mi,R.authToken=(d.authToken??"").toString().trim(),R.enabled=M,R.useSemver=E,Ie(),qe()}function Re(){const d={Accept:"application/json"},y=(R.authToken||"").trim();return y&&(d.Authorization=/\s/.test(y)?y:`Bearer ${y}`),d}function Ye(d,y,{title:N,description:M,version:E}={}){const V={artifactId:d,artifactType:"JSON",firstVersion:{content:{contentType:"application/json",content:y},metadata:{properties:{}}}};E&&(V.firstVersion.version=E),N&&(V.name=N),M&&(V.description=M);try{const X=JSON.parse(y),q=X==null?void 0:X.seriesId;q&&typeof q=="string"&&(V.firstVersion.metadata.properties.seriesId=q)}catch{}return V}function nt(d,{version:y}={}){const N={content:{contentType:"application/json",content:d},metadata:{properties:{}}};try{const M=JSON.parse(d),E=M==null?void 0:M.seriesId;E&&typeof E=="string"&&(N.metadata.properties.seriesId=E)}catch{}return y&&(N.version=y),N}function He(d){if(d==null)return null;const y=String(d).trim();if(!y)return null;const N=/^v?(\d+)\.(\d+)\.(\d+)(?:-.+)?$/.exec(y);if(N)return{major:Number(N[1]),minor:Number(N[2]),patch:Number(N[3])};const M=/^v?(\d+)$/.exec(y);return M?{major:Number(M[1]),minor:0,patch:0}:null}function mt(d){return`${d.major}.${d.minor}.${d.patch}`}function Xe(d,y){return!d&&!y?0:d?y?d.major!==y.major?d.major-y.major:d.minor!==y.minor?d.minor-y.minor:d.patch-y.patch:1:-1}function rt(d=[]){let y=null;if(d.forEach(M=>{const E=He((M==null?void 0:M.version)??M);E&&(!y||Xe(E,y)>0)&&(y=E)}),!y)return"1.0.0";const N={...y,patch:y.patch+1};return mt(N)}function ct(d,{seriesName:y,fallbackTitle:N}={}){var V;if(!d)return null;const M=y||d.title||d.apicurioArtifactName||J(d),E=N||M;if(typeof C=="function"&&(d.isSeries||((V=d.apicurioVersions)==null?void 0:V.length)>1)&&C(d,{seriesName:M,fallbackTitle:E}),typeof Q=="function"){const X=Q(d,{seriesName:M,fallbackTitle:E});if(X)return X}return F(d)}function ht(d){return Array.isArray(d)?d:Array.isArray(d==null?void 0:d.artifacts)?d.artifacts:Array.isArray(d==null?void 0:d.items)?d.items:Array.isArray(d==null?void 0:d.results)?d.results:[]}function S(d){return Array.isArray(d)?d:Array.isArray(d==null?void 0:d.versions)?d.versions:Array.isArray(d==null?void 0:d.items)?d.items:[]}function g(d=[]){if(!Array.isArray(d)||!d.length)return null;const y=[...d].filter(Boolean);return y.sort((N,M)=>{const E=N!=null&&N.createdOn?new Date(N.createdOn).getTime():0,V=M!=null&&M.createdOn?new Date(M.createdOn).getTime():0;if(E!==V)return V-E;const X=Number(N==null?void 0:N.version),q=Number(M==null?void 0:M.version),ye=Number.isFinite(X),Ee=Number.isFinite(q);if(ye&&Ee&&X!==q)return q-X;const me=String((N==null?void 0:N.version)??"");return String((M==null?void 0:M.version)??"").localeCompare(me,void 0,{numeric:!0})}),y[0]||null}function Le(d){if(!d)return d;let y=d;if(!Array.isArray(d==null?void 0:d.categories)){const M=d==null?void 0:d.content;if(typeof M=="string")try{y=JSON.parse(M)}catch(E){console.warn("[Blockscape] artifact payload contained string content that could not be parsed",E)}else M&&typeof M=="object"&&(y=M)}return y}async function v(d,y,N){const M=encodeURIComponent(y),E=encodeURIComponent(N),V=`${d}/groups/${M}/artifacts/${E}`,X=Re();X.Accept="application/json";const q=await fetch(V,{method:"GET",headers:X});if(!q.ok){let ye=q.statusText||"Unknown error";try{const Ee=await q.text();Ee&&(ye=Ee.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact metadata (${q.status}): ${ye}`)}return q.json()}async function fe(d,y,N){const M=encodeURIComponent(y),E=encodeURIComponent(N),V=`${d}/groups/${M}/artifacts/${E}/versions?limit=50&order=desc`,X=Re();X.Accept="application/json";const q=await fetch(V,{method:"GET",headers:X});if(!q.ok){let Ee=q.statusText||"Unknown error";try{const me=await q.text();me&&(Ee=me.slice(0,400))}catch{}throw new Error(`Failed to fetch artifact versions (${q.status}): ${Ee}`)}const ye=await q.json();return S(ye).filter(Ee=>Ee&&Ee.version!=null)}async function Ht(d,y,N,M="latest"){const E=encodeURIComponent(y),V=encodeURIComponent(N),X=encodeURIComponent(M||"latest"),q=`${d}/groups/${E}/artifacts/${V}/versions/${X}/content`,ye=Re();ye.Accept="application/json, application/*+json, */*;q=0.8";const Ee=await fetch(q,{method:"GET",headers:ye});if(!Ee.ok){let Ze=Ee.statusText||"Unknown error";try{const he=await Ee.text();he&&(Ze=he.slice(0,400))}catch{}throw new Error(`Failed to load artifact content (${Ee.status}): ${Ze}`)}const me=await Ee.text();let We=null;try{We=JSON.parse(me)}catch{throw new Error("Artifact content is not valid JSON.")}return Le(We)}async function K(d,y,N,M="latest"){const E=await Ht(d,y,N,M);return{data:E,fingerprint:te(E)}}async function Fe(d,y,N){try{const E=await fe(d,y,N);if(E!=null&&E.length){Oe.set(N,E);const V=g(E);if((V==null?void 0:V.version)!=null)return V.version}}catch(E){console.warn("[Blockscape] compare-version: unable to fetch versions list",E)}try{const E=await v(d,y,N);if((E==null?void 0:E.version)!=null)return E.version}catch(E){console.warn("[Blockscape] compare-version: unable to fetch metadata",E)}const M=Oe.get(N);if(M&&M.length){const E=g(M);if((E==null?void 0:E.version)!=null)return E.version}return"latest"}async function Et(d,y,N,M){if(!R.useSemver)return null;if(!M)return"1.0.0";try{const E=await fe(d,y,N);return rt(E)}catch(E){throw new Error(`Unable to compute next semantic version: ${E.message}`)}}function ot(d=document){re=d.querySelector("#pushApicurio")||document.getElementById("pushApicurio"),W=d.querySelector("#pushApicurioSeries")||document.getElementById("pushApicurioSeries"),j=d.querySelector("#listApicurioArtifacts")||document.getElementById("listApicurioArtifacts"),ae=d.querySelector("#apicurioUrl")||document.getElementById("apicurioUrl"),Me=d.querySelector("#apicurioGroup")||document.getElementById("apicurioGroup"),tt=d.querySelector("#apicurioToken")||document.getElementById("apicurioToken"),Ge=d.querySelector("#apicurioToggle")||document.getElementById("apicurioToggle"),je=d.querySelector("#apicurioSemver")||document.getElementById("apicurioSemver"),ze=d.querySelector("#apicurioStatus")||document.getElementById("apicurioStatus"),Y=d.querySelector("#apicurioArtifacts")||document.getElementById("apicurioArtifacts")}function en(){R.baseUrl=pe((ae==null?void 0:ae.value)??R.baseUrl),R.groupId=((Me==null?void 0:Me.value)??"").trim(),R.authToken=((tt==null?void 0:tt.value)??"").trim(),$e(),Ie()}function Nn(d){R.enabled=d!==!1,$e(),Ie(),qe()}function Ft(){Nn(Ge?Ge.checked:fa)}function ln(){R.useSemver=je?je.checked:ma,$e(),Ie()}function Wt(){[ae,Me,tt].forEach(d=>{d&&d.addEventListener("input",en)}),re&&re.addEventListener("click",()=>{St()}),W&&W.addEventListener("click",()=>{tn()}),Ge&&Ge.addEventListener("change",Ft),je&&je.addEventListener("change",ln),j&&j.addEventListener("click",yn),Y&&Y.addEventListener("click",d=>{const y=d.target.closest("[data-artifact-version]");if(y){d.stopPropagation();const E=y.dataset.artifactId,V=y.dataset.artifactVersion;E&&V&&nn(E,V);return}const N=d.target.closest("[data-artifact-load-all]");if(N){d.stopPropagation(),N.dataset.artifactId&&En();return}const M=d.target.closest("[data-artifact-trigger]");if(M){const E=M.dataset.artifactId;if(!E)return;vn(E)}})}function Rt(){const d=document.createElement("div");return d.className="blockscape-registry-panel",d.innerHTML=`
      <div class="blockscape-registry-header">
        <h2>Apicurio registry</h2>
        <p>Configure the registry connection and push the active model.</p>
      </div>
      <div class="apicurio-controls">
        <label class="apicurio-toggle">
          <input id="apicurioToggle" type="checkbox" />
          <span>Enable Apicurio push</span>
        </label>
        <label class="apicurio-toggle">
          <input id="apicurioSemver" type="checkbox" />
          <span>Use semantic versioning</span>
        </label>
        <p class="apicurio-hint">When disabled, Blockscape never contacts your registry.</p>
        <p class="apicurio-hint apicurio-subnote">When on, Blockscape reads the latest version and auto-bumps the next semver on each push.</p>
        <button id="pushApicurio" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="Enter Apicurio connection details to enable pushes">Push to Apicurio</button>
        <button id="pushApicurioSeries" class="pf-v5-c-button pf-m-secondary" type="button" disabled hidden
          title="Push all versions in this series as a JSON array">Push series</button>
        <button id="listApicurioArtifacts" class="pf-v5-c-button pf-m-secondary" type="button" disabled
          title="List artifacts in the configured group">List artifacts</button>
        <details id="apicurioSettings" class="apicurio-settings">
          <summary>Connection settings (optional)</summary>
          <div class="apicurio-fields">
            <label>
              Registry base URL
              <input id="apicurioUrl" type="url" placeholder="https://registry.example/apis/registry/v3" autocomplete="url" />
            </label>
            <label>
              Group ID
              <input id="apicurioGroup" type="text" placeholder="default" autocomplete="organization" />
            </label>
            <label>
              Auth token (optional)
              <input id="apicurioToken" type="password" placeholder="Bearer token" autocomplete="off" />
            </label>
          </div>
          <p class="apicurio-hint">Details stay in this browser only.</p>
        </details>
        <div id="apicurioStatus" class="apicurio-status" role="status" aria-live="polite"></div>
        <div id="apicurioArtifacts" class="apicurio-artifacts" aria-live="polite"></div>
      </div>
    `,d}function no(d){if(!d)return;d.innerHTML="";const y=Rt();d.appendChild(y),ot(d),Wt(),Ie()}function Mn(d){if(!Y)return;if(Y.innerHTML="",!d.length){ee("No artifacts found in this group.");return}const y=E=>{const V=document.createElement("section");V.className="apicurio-artifact-section";const X=document.createElement("h3");X.textContent=E,V.appendChild(X);const q=document.createElement("ul");return q.className="apicurio-artifact-list",V.appendChild(q),{section:V,list:q}},N=y("Series artifacts"),M=y("Artifacts");d.forEach(E=>{if(!(E!=null&&E.artifactId))return;const X=E._groupId&&E._groupId.endsWith($r)?N.list:M.list,q=document.createElement("li"),ye=document.createElement("button");ye.type="button",ye.className="apicurio-artifact",ye.dataset.artifactId=E.artifactId,ye.dataset.artifactTrigger="toggle";const Ee=document.createElement("span");Ee.className="apicurio-artifact-title",Ee.textContent=E.artifactId,ye.appendChild(Ee);const me=[];if(E.name&&me.push(E.name),E.version!=null&&me.push(`v${E.version}`),E.type&&me.push(E.type),E._groupId&&me.push(E._groupId),me.length){const he=document.createElement("span");he.className="apicurio-artifact-meta",he.textContent=me.join(" • "),ye.appendChild(he)}if(E.description){const he=document.createElement("span");he.className="apicurio-artifact-meta",he.textContent=E.description,ye.appendChild(he)}q.appendChild(ye);const We=document.createElement("div");We.className="apicurio-version-list",We.dataset.versionPanel=E.artifactId,We.hidden=!0;const Ze=document.createElement("p");Ze.className="apicurio-hint",Ze.textContent="Click to load the latest or open versions.",We.appendChild(Ze),q.appendChild(We),X.appendChild(q)}),N.list.children.length&&Y.appendChild(N.section),M.list.children.length&&Y.appendChild(M.section)}function Kn(d){return Y?Y.querySelector(`[data-version-panel="${d}"]`):null}function Ot(d,y){if(!d||(d.innerHTML="",!y))return;const N=document.createElement("p");N.className="apicurio-hint",N.textContent=y,d.appendChild(N)}function Xt(d,y){const N=Kn(d);if(N){if(N.innerHTML="",!y.length){Ot(N,"No versions found for this artifact.");return}y.forEach(M=>{const E=document.createElement("button");E.type="button",E.className="apicurio-version-button",E.dataset.artifactId=d,E.dataset.artifactVersion=M.version;const V=[`Version ${M.version}`];if(M.createdOn){const X=new Date(M.createdOn);isNaN(X)||V.push(X.toISOString().slice(0,10))}E.textContent=V.join(" — "),N.appendChild(E)})}}async function vn(d){const y=Kn(d);if(!y)return;if(y.dataset.open==="true"){y.hidden=!0,y.dataset.open="false";return}if(y.hidden=!1,y.dataset.open="true",y.dataset.loaded!=="true"){if(!se()){Ot(y,"Enter registry details first.");return}Ot(y,"Loading versions…");try{const M=pe(R.baseUrl),E=_e.get(d),V=R.groupId.trim(),X=(E==null?void 0:E._groupId)||V,q=await fe(M,X,d);Oe.set(d,q),y.dataset.loaded="true",Xt(d,q)}catch(M){console.error("[Blockscape] failed to load versions",M),Ot(y,`Unable to fetch versions: ${M.message}`)}}}function Zt(d,y){var M;const N=r.findIndex(E=>E.apicurioArtifactId===d);if(N!==-1){const E=r[N].id;r[N]={...y,id:E||y.id},((M=r[N].apicurioVersions)==null?void 0:M.length)>1&&(r[N].isSeries=!0),f(N)}else r.push(y),f(r.length-1)}async function jt(d,y,N,M){const E=encodeURIComponent(y),V=encodeURIComponent(N),X=`${d}/groups/${E}/artifacts/${V}`;try{const q=await fetch(X,{method:"GET",headers:M});if(q.status===404)return!1;if(q.ok)return!0;throw q.status===401||q.status===403?new Error("Authentication failed while checking the registry."):new Error(`Registry responded with status ${q.status} while checking the artifact.`)}catch(q){throw q instanceof TypeError?new Error("Network error while contacting Apicurio registry."):q}}async function St(){var X;if(!re||re.dataset.loading==="true")return;if(!ve()){k("Apicurio integration is off. Enable it first.","error");return}if(!se()){k("Enter the registry base URL and group ID before pushing.","error");return}const d=c();if(d<0||!r[d]){k("No active model to push.","error");return}const y=ct(r[d],{fallbackTitle:J(r[d])});if(!y){k("Active model needs an id before pushing.","error");return}const N=pe(R.baseUrl),M=R.groupId.trim(),E=JSON.stringify(r[d].data,null,2),V=Re();re.dataset.loading="true",re.textContent="Pushing…",re.disabled=!0,k("Pushing to Apicurio…","muted");try{const q=await jt(N,M,y,V),ye=te(r[d].data);if(q)try{const st=await Fe(N,M,y),{data:kt,fingerprint:wt}=await K(N,M,y,st);if(console.group("[Blockscape] Apicurio push compare"),console.log("compare version",st),console.log("local fingerprint",ye),console.log("registry fingerprint",wt),console.log("local payload",r[d].data),console.log("registry payload",kt),console.groupEnd(),ye&&wt&&ye===wt){if(!window.confirm("The current registry version is identical to this model. Push anyway?")){k("Push cancelled (content matches the latest registry version).","muted");return}k("Pushing identical content by user choice.","muted")}else wt?console.log("[Blockscape] Apicurio compare mismatch (proceeding with push)"):k("Unable to compare with registry content (skipping confirmation).","muted")}catch(st){console.warn("[Blockscape] unable to compare registry content before push",st),k("Skipped comparison with registry (content fetch failed). Proceeding with push.","muted")}const Ee=R.useSemver?await Et(N,M,y,q):null;if(R.useSemver&&!Ee)throw new Error("Semantic versioning is enabled but no version could be computed.");const me=encodeURIComponent(M),We=encodeURIComponent(y),Ze=q?`${N}/groups/${me}/artifacts/${We}/versions`:`${N}/groups/${me}/artifacts`,he={...V,"Content-Type":"application/json"};Ee&&(he["X-Registry-Version"]=Ee,k(`Pushing to Apicurio as version ${Ee}…`,"muted"));const Lt=q?nt(E,{version:Ee}):Ye(y,E,{title:J(r[d]),description:(X=r[d].data)==null?void 0:X.abstract,version:Ee}),bt=await fetch(Ze,{method:"POST",headers:he,body:JSON.stringify(Lt)});if(!bt.ok){let st=bt.statusText||"Unknown error";try{const kt=await bt.text();kt&&(st=kt.slice(0,400))}catch{}throw new Error(`Registry rejected the push (${bt.status}): ${st}`)}let de=null;try{de=await bt.json()}catch{de=null}const ne=(de==null?void 0:de.version)||(de==null?void 0:de.globalId)||"",ut=q?"Updated":"Created",cn=ne?` (version ${ne})`:"";k(`${ut} ${y}${cn}`,"success")}catch(q){console.error("[Blockscape] Apicurio push failed",q),k(`Apicurio push failed: ${q.message}`,"error")}finally{re.dataset.loading="false",ge()}}async function tn(){var Ee,me;if(!W||W.dataset.loading==="true")return;if(!ve()){k("Apicurio integration is off. Enable it first.","error");return}if(!se()){k("Enter the registry base URL and group ID before pushing.","error");return}const d=c(),y=d>=0?r[d]:null;if(!y||!y.apicurioVersions||y.apicurioVersions.length<2){k("Series push requires a model with multiple versions.","error");return}const N=ct(y,{seriesName:y.title||y.apicurioArtifactName||J(y)});if(!N){k("Active series needs an id before pushing.","error");return}typeof C=="function"&&C(y,{seriesName:y.title||y.apicurioArtifactName||J(y)});const M=pe(R.baseUrl),E=R.groupId.trim(),V=y.apicurioVersions.map(We=>We.data),X=JSON.stringify(V,null,2),q=Re(),ye=at(E);W.dataset.loading="true",W.textContent="Pushing…",W.disabled=!0,k("Pushing series to Apicurio…","muted");try{const We=await jt(M,ye,N,q),Ze=te(V);if(We)try{const dn=await Fe(M,ye,N),{data:_n,fingerprint:oo}=await K(M,ye,N,dn);if(console.group("[Blockscape] Apicurio series push compare"),console.log("compare version",dn),console.log("local fingerprint",Ze),console.log("registry fingerprint",oo),console.log("local payload (series)",V),console.log("registry payload",_n),console.groupEnd(),Ze&&oo&&Ze===oo){if(!window.confirm("The current registry version matches this series. Push anyway?")){k("Series push cancelled (content matches latest).","muted");return}k("Pushing identical series by user choice.","muted")}else oo?console.log("[Blockscape] Apicurio compare mismatch (proceeding with series push)"):k("Unable to compare with registry content (skipping confirmation).","muted")}catch(dn){console.warn("[Blockscape] unable to compare registry content before series push",dn),k("Skipped comparison with registry (content fetch failed). Proceeding with series push.","muted")}const he=R.useSemver?await Et(M,ye,N,We):null;if(R.useSemver&&!he)throw new Error("Semantic versioning is enabled but no version could be computed.");const Lt=encodeURIComponent(ye),bt=encodeURIComponent(N),de=We?`${M}/groups/${Lt}/artifacts/${bt}/versions`:`${M}/groups/${Lt}/artifacts`,ne={...q,"Content-Type":"application/json"};he&&(ne["X-Registry-Version"]=he,k(`Pushing series to Apicurio as version ${he}…`,"muted"));const ut=We?nt(X,{version:he}):Ye(N,X,{title:y.apicurioArtifactName||((Ee=y.data)==null?void 0:Ee.title)||N,description:(me=y.data)==null?void 0:me.abstract,version:he}),cn=await fetch(de,{method:"POST",headers:ne,body:JSON.stringify(ut)});if(!cn.ok){let dn=cn.statusText||"Unknown error";try{const _n=await cn.text();_n&&(dn=_n.slice(0,400))}catch{}throw new Error(`Registry rejected the series push (${cn.status}): ${dn}`)}let st=null;try{st=await cn.json()}catch{st=null}const kt=(st==null?void 0:st.version)||(st==null?void 0:st.globalId)||"",wt=We?"Updated":"Created",In=kt?` (version ${kt})`:"";k(`${wt} ${N} series${In}`,"success")}catch(We){console.error("[Blockscape] Apicurio series push failed",We),k(`Apicurio series push failed: ${We.message}`,"error")}finally{W.dataset.loading="false",ge()}}async function yn(){if(!j||j.dataset.loading==="true")return;if(!ve()){k("Enable Apicurio integration to list artifacts.","error");return}if(!se()){k("Enter registry base URL and group ID before listing.","error");return}const d=pe(R.baseUrl),y=R.groupId.trim(),N=at(y),M=[{groupId:y,label:"base"},{groupId:N,label:"series"}];j.dataset.loading="true",j.textContent="Listing…",j.disabled=!0,k("Listing artifacts…","muted"),ee("Contacting registry…");try{const E=Re();E.Accept="application/json";const V=[];for(const q of M){const ye=encodeURIComponent(q.groupId),Ee=`${d}/groups/${ye}/artifacts?limit=50&offset=0`,me=await fetch(Ee,{method:"GET",headers:E});if(!me.ok){let he=me.statusText||"Unknown error";try{const Lt=await me.text();Lt&&(he=Lt.slice(0,400))}catch{}console.warn(`[Blockscape] failed to list artifacts for group ${q.groupId} (${me.status}): ${he}`);continue}const We=await me.json(),Ze=ht(We).filter(he=>he&&he.artifactId);Ze.forEach(he=>{he&&(he._groupId=q.groupId)}),V.push(...Ze)}_e.clear(),Oe.clear(),V.forEach(q=>{q!=null&&q.artifactId&&_e.set(q.artifactId,q)}),Mn(V);const X=V.length;k(X?`Found ${X} artifact${X===1?"":"s"} across base and series groups.`:"No artifacts found in base/series groups.",X?"success":"muted")}catch(E){console.error("[Blockscape] failed to list artifacts",E),ke("Unable to list artifacts."),k(`Listing failed: ${E.message}`,"error")}finally{j.dataset.loading="false",ge()}}async function nn(d,y=null){var We,Ze,he,Lt,bt,de;if(!d)return;if(!ve()){k("Enable Apicurio integration to load artifacts.","error");return}if(!se()){k("Enter registry connection details before loading artifacts.","error");return}const N=pe(R.baseUrl),M=R.groupId.trim(),E=d&&((We=_e.get(d))==null?void 0:We._groupId)||M;let V=_e.get(d);const X=async()=>{try{const ne=await v(N,E,d);return ne!=null&&ne.artifactId&&_e.set(d,ne),ne}catch(ne){throw console.error("[Blockscape] failed to fetch artifact metadata before loading",ne),ne}};if(!V)try{V=await X()}catch(ne){k(`Failed to fetch artifact metadata: ${ne.message}`,"error");return}const q=Oe.get(d)||[];let ye="latest",Ee="latest";if(y)ye=y,Ee=y;else{if(!V||V.version==null)try{V=await X()}catch(ne){k(`Failed to fetch artifact metadata: ${ne.message}`,"error");return}ye=(V==null?void 0:V.version)||"latest",Ee=(V==null?void 0:V.version)||"latest"}const me=q.find(ne=>String(ne.version)===String(ye));(me==null?void 0:me.version)!=null&&(Ee=me.version),k(`Loading artifact ${d}…`,"muted");try{const ne=await Ht(N,E,d,ye),ut=_e.get(d)||V||{},cn=Array.isArray(ne);let st=null;if(cn){const kt=ne.map((In,dn)=>(A(In,{titleHint:ut.name||d,idHint:d}),{version:String(dn+1),data:In,createdOn:(me==null?void 0:me.createdOn)||ut.createdOn}));st={id:x(),title:((he=(Ze=kt[0])==null?void 0:Ze.data)==null?void 0:he.title)||ut.name||d,data:(Lt=kt[0])==null?void 0:Lt.data,apicurioArtifactId:d,apicurioArtifactName:ut.name||"",apicurioVersions:kt,apicurioActiveVersionIndex:0,isSeries:!0};const wt=((bt=ut==null?void 0:ut.properties)==null?void 0:bt.seriesId)||d;typeof C=="function"&&C(st,{seriesName:wt,fallbackTitle:wt}),k(`Loaded series artifact ${d}.`,"success")}else{A(ne,{titleHint:ut.name||d,idHint:d});const kt={version:Ee,data:ne,createdOn:(me==null?void 0:me.createdOn)||ut.createdOn};st={id:x(),title:ne.title||ut.name||d,data:ne,apicurioArtifactId:d,apicurioArtifactName:ut.name||"",apicurioVersions:[kt],apicurioActiveVersionIndex:0};const wt=(de=ut==null?void 0:ut.properties)==null?void 0:de.seriesId;wt&&typeof C=="function"&&C(st,{seriesName:wt,fallbackTitle:wt});const In=Ee?` (version ${Ee})`:"";k(`Loaded artifact ${d}${In}.`,"success")}Zt(d,st)}catch(ne){console.error("[Blockscape] failed to load artifact",ne),k(`Failed to load artifact: ${ne.message}`,"error")}}async function En(d){}return{hydrateConfig:m,mount:no,updateAvailability:ge,isEnabled:ve,setEnabled:Nn,onEnabledChange:O}}const Bt={color:{borderMuted:"#e5e7eb",surfaceGhost:"#f8fafc",primary:"#2563eb",dangerStrong:"#b42318",success:"#22c55e",ink:"#111111",white:"#ffffff"},blockscape:{revdep:"#ef4444"},palette:{letter:{A:"#0284c7",B:"#3b82f6",C:"#06b6d4",D:"#a855f7",E:"#f59e0b",F:"#f97316",G:"#22c55e",H:"#84cc16",I:"#10b981",J:"#14b8a6",K:"#0ea5e9",L:"#60a5fa",M:"#8b5cf6",N:"#d946ef",O:"#e879f9",P:"#67e8f9",Q:"#4ade80",R:"#facc15",S:"#eab308",T:"#a3e635",U:"#22d3ee",V:"#38bdf8",W:"#818cf8",X:"#a78bfa",Y:"#f472b6",Z:"#fb7185"},letterFallback:"#9ca3af"}};function zn(r,c){if(typeof r!="function")throw new Error(`[itemEditor] expected ${c} to be a function`)}function Vl(r){return(r||"item").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"item"}function Dl(r,{excludeId:c}={}){if(!r)return[];const f=r.split(/[\s,]+/).map(C=>C.trim()).filter(Boolean),A=[];return f.forEach(C=>{c&&C===c||A.includes(C)||A.push(C)}),A}function Ul(r,c,f){if(!c||!f||c===f)return;((r==null?void 0:r.categories)||[]).forEach(C=>{(C.items||[]).forEach(F=>{Array.isArray(F.deps)&&(F.deps=F.deps.map(Q=>Q===c?f:Q))})})}function Hl({findItemAndCategoryById:r,collectAllItemIds:c,updateItemReferences:f,loadActiveIntoEditor:A,rebuildFromActive:C,select:F,onSelectionRenamed:Q,makeSlug:J=Vl,isAutoIdFromNameEnabled:te=()=>!0}={}){zn(r,"findItemAndCategoryById"),zn(c,"collectAllItemIds"),zn(f,"updateItemReferences"),zn(A,"loadActiveIntoEditor"),zn(C,"rebuildFromActive"),zn(F,"select"),zn(J,"makeSlug"),zn(te,"isAutoIdFromNameEnabled");const x={wrapper:null,fields:{},categoryId:null,itemId:null,modelData:null,autoIdManuallyEdited:!1,autoSyncEnabled:!0};function re(W){if(x.fields.errorEl){if(!W){x.fields.errorEl.hidden=!0,x.fields.errorEl.textContent="";return}x.fields.errorEl.hidden=!1,x.fields.errorEl.textContent=W}}function j(){x.wrapper&&(x.wrapper.hidden=!0,x.wrapper.setAttribute("aria-hidden","true"),re(""),x.categoryId=null,x.itemId=null,x.modelData=null,document.body.classList.remove("item-editor-open"))}function ae(){x.wrapper&&(x.wrapper.hidden=!1,x.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("item-editor-open"),requestAnimationFrame(()=>{var W,Y;(W=x.fields.nameInput)==null||W.focus(),(Y=x.fields.nameInput)==null||Y.select()}))}function Me({force:W}={}){var we,R;if(!((we=x.fields)!=null&&we.idInput)||!((R=x.fields)!=null&&R.nameInput)||!x.autoSyncEnabled||!te()||!W&&x.autoIdManuallyEdited)return;const Y=J(x.fields.nameInput.value||x.itemId||"item");x.fields.idInput.value=Y}function tt(W){var ve;if(!x.modelData||!x.categoryId||!x.itemId)throw new Error("No item loaded.");const we=(((ve=x.modelData)==null?void 0:ve.categories)||[]).find(qe=>qe.id===x.categoryId);if(!we)throw new Error("Category not found.");we.items=we.items||[];const R=we.items.find(qe=>qe.id===x.itemId);if(!R)throw new Error("Item not found.");const _e=(W.id||"").trim();if(!_e)throw new Error("ID is required.");const Oe=c(x.modelData);if(_e!==R.id&&Oe.has(_e))throw new Error("Another item already uses that ID.");R.id=_e;const pe=(W.name||"").trim();R.name=pe||R.id;const at=(W.logo||"").trim();if(at?R.logo=at:delete R.logo,W.externalFlag&&!W.external)R.external=!0;else{const qe=(W.external??"").toString().trim();qe?R.external=qe:delete R.external}const se=(W.color||"").trim();return se?R.color=se:delete R.color,R.deps=Array.isArray(W.deps)?W.deps:[],R.id!==W.originalId&&typeof Q=="function"&&Q(W.originalId,R.id),f(x.modelData,W.originalId,R.id),A(),C(),F(R.id),R.id}function Ge(){if(!x.fields||!x.fields.idInput)return!1;const W=(x.fields.idInput.value||"").trim(),Y={originalId:x.itemId,id:W,name:x.fields.nameInput.value||"",logo:x.fields.logoInput.value||"",external:x.fields.externalInput.value||"",externalFlag:x.fields.externalFlagInput.checked,color:x.fields.colorInput.value||"",deps:Dl(x.fields.depsInput.value,{excludeId:W})};try{return tt(Y),j(),!0}catch(we){return console.warn("[itemEditor] item edit failed",we),re((we==null?void 0:we.message)||"Unable to save item."),!1}}function je(){if(x.wrapper)return x.wrapper;const W=document.createElement("div");W.className="item-editor-modal",W.hidden=!0,W.setAttribute("role","dialog"),W.setAttribute("aria-modal","true");const Y=document.createElement("div");Y.className="item-editor-modal__backdrop",W.appendChild(Y);const we=document.createElement("div");we.className="item-editor",W.appendChild(we);const R=document.createElement("div");R.className="item-editor__header";const _e=document.createElement("h2");_e.className="item-editor__title",_e.textContent="Edit item";const Oe=document.createElement("button");Oe.type="button",Oe.className="item-editor__close",Oe.setAttribute("aria-label","Close item editor"),Oe.textContent="×",R.appendChild(_e),R.appendChild(Oe),we.appendChild(R);const pe=document.createElement("form");pe.className="item-editor__form",we.appendChild(pe);const at=document.createElement("div");at.className="item-editor__meta",at.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',pe.appendChild(at);const se=document.createElement("div");se.className="item-editor__error",se.hidden=!0,pe.appendChild(se);const ve=(S,g,Le)=>{const v=document.createElement("label");v.className="item-editor__field";const fe=document.createElement("span");if(fe.className="item-editor__label",fe.textContent=S,v.appendChild(fe),g.classList.add("item-editor__control"),v.appendChild(g),Le){const Ht=document.createElement("div");Ht.className="item-editor__hint",Ht.textContent=Le,v.appendChild(Ht)}return v},qe=document.createElement("input");qe.type="text",qe.required=!0,pe.appendChild(ve("ID",qe,"Unique identifier used for dependencies."));const O=document.createElement("input");O.type="text",pe.appendChild(ve("Name",O,"Visible label shown on the tile."));const Z=document.createElement("input");Z.type="url",Z.inputMode="url",Z.placeholder="https://…",pe.appendChild(ve("Logo URL",Z,"Optional image URL."));const k=document.createElement("input");k.type="url",k.inputMode="url",k.placeholder="https://…",pe.appendChild(ve("External link",k,"Shown with ↗ icon and in preview."));const ee=document.createElement("div");ee.className="item-editor__checkbox";const ke=document.createElement("label");ke.className="item-editor__checkbox-row";const ge=document.createElement("input");ge.type="checkbox";const Ie=document.createElement("span");Ie.textContent="Mark as external without link";const $e=document.createElement("div");$e.className="item-editor__hint",$e.textContent="Keeps dashed border even without a URL.",ke.appendChild(ge),ke.appendChild(Ie),ee.appendChild(ke),ee.appendChild($e),pe.appendChild(ee);const m=document.createElement("input");m.type="text",m.placeholder=Bt.color.primary,pe.appendChild(ve("Color",m,"Optional badge color (hex or CSS color)."));const Re=document.createElement("textarea");Re.rows=2,Re.placeholder="Comma or space separated ids",pe.appendChild(ve("Dependencies",Re,"Use item IDs, separated by commas or spaces."));const Ye=document.createElement("div");Ye.className="item-editor__checkbox";const nt=document.createElement("label");nt.className="item-editor__checkbox-row";const He=document.createElement("input");He.type="checkbox";const mt=document.createElement("span");mt.textContent="Sync ID while editing name";const Xe=document.createElement("div");Xe.className="item-editor__hint",Xe.textContent="Turn off to keep typing names without changing the ID.",nt.appendChild(He),nt.appendChild(mt),Ye.appendChild(nt),Ye.appendChild(Xe),pe.appendChild(Ye);const rt=document.createElement("div");rt.className="item-editor__actions";const ct=document.createElement("button");ct.type="button",ct.className="pf-v5-c-button pf-m-tertiary",ct.textContent="Cancel";const ht=document.createElement("button");return ht.type="submit",ht.className="pf-v5-c-button pf-m-primary",ht.textContent="Save",rt.appendChild(ct),rt.appendChild(ht),pe.appendChild(rt),x.wrapper=W,x.fields={idInput:qe,nameInput:O,logoInput:Z,externalInput:k,externalFlagInput:ge,colorInput:m,depsInput:Re,syncCheckbox:He,categoryValue:at.querySelector(".item-editor__meta-value"),errorEl:se},ct.addEventListener("click",j),Oe.addEventListener("click",j),Y.addEventListener("click",j),qe.addEventListener("input",()=>{x.autoIdManuallyEdited=!0}),O.addEventListener("input",Me),He.addEventListener("change",()=>{x.autoSyncEnabled=!!He.checked,x.autoSyncEnabled&&(x.autoIdManuallyEdited=!1,Me({force:!0}))}),pe.addEventListener("submit",S=>{S.preventDefault(),Ge()}),document.addEventListener("keydown",S=>{S.key==="Escape"&&!W.hidden&&(S.preventDefault(),S.stopPropagation(),j())}),document.body.appendChild(W),W}function ze(W){const Y=r(W);if(!Y)return!1;je(),x.categoryId=Y.category.id,x.itemId=Y.item.id,x.modelData=Y.modelData,x.autoIdManuallyEdited=!1;const we=!!te();return x.autoSyncEnabled=we,x.fields.categoryValue.textContent=Y.category.title||Y.category.id,x.fields.idInput.value=Y.item.id||"",x.fields.nameInput.value=Y.item.name||"",x.fields.logoInput.value=Y.item.logo||"",x.fields.externalInput.value=typeof Y.item.external=="string"?Y.item.external:"",x.fields.externalFlagInput.checked=Y.item.external===!0,x.fields.colorInput.value=Y.item.color||"",x.fields.depsInput.value=Array.isArray(Y.item.deps)?Y.item.deps.join(", "):"",x.fields.syncCheckbox.checked=x.autoSyncEnabled,x.fields.syncCheckbox.disabled=!we,!x.fields.idInput.value&&we&&Me({force:!0}),re(""),F(Y.item.id),ae(),!0}return{open:ze,hide:j,isOpen:()=>!!x.wrapper&&!x.wrapper.hidden}}function Fl({menuEl:r,previewEl:c,previewTitleEl:f,previewBodyEl:A,previewActionsEl:C,previewCloseEl:F,escapeHtml:Q,onEditItem:J,onChangeColor:te,selectItem:x,colorPresets:re=[]}={}){const j=r||(()=>{const O=document.createElement("div");return O.className="tile-context-menu",O.hidden=!0,O.setAttribute("aria-hidden","true"),document.body.appendChild(O),O})();let ae={x:0,y:0},Me=0,tt=Array.isArray(re)?re:[];function Ge(){j&&(j.classList.remove("is-open"),j.hidden=!0,j.setAttribute("aria-hidden","true"),j.innerHTML="")}function je(O=[]){C&&(C.innerHTML="",O.forEach(Z=>{const k=document.createElement("button");k.type="button",k.className="item-preview__action",k.textContent=Z.label||"Action",Z.title&&(k.title=Z.title),k.addEventListener("click",ee=>{ee.stopPropagation(),typeof Z.onClick=="function"&&Z.onClick(ee)}),C.appendChild(k)}),C.hidden=O.length===0)}function ze(){Ge(),c&&(c.classList.remove("is-visible","item-preview--has-frame","item-preview--expanded"),c.setAttribute("aria-hidden","true"),c.hidden=!0,je([]))}function W(O,Z){c&&(ae={x:O,y:Z},c.hidden=!1,c.setAttribute("aria-hidden","false"),c.classList.add("is-visible"),Y(O,Z))}function Y(O,Z){if(!c)return;const k=12;c.style.left=`${O+k}px`,c.style.top=`${Z+k}px`;const ee=c.getBoundingClientRect();let ke=ee.left,ge=ee.top;ee.right>window.innerWidth-k&&(ke=Math.max(k,window.innerWidth-ee.width-k)),ee.bottom>window.innerHeight-k&&(ge=Math.max(k,window.innerHeight-ee.height-k)),c.style.left=`${ke}px`,c.style.top=`${ge}px`}function we(O,Z){var Ie;if(!O)return null;const k=O.dataset.id,ee=((Ie=O.querySelector(".name"))==null?void 0:Ie.textContent)||k||"Preview",ke=k?`${k}.html`:"",ge=ke?`items/${ke}`:"";return{id:k,displayName:ee,filename:ke,filepath:ge,externalUrl:O.dataset.externalUrl||"",obsidianUrl:O.dataset.obsidianUrl||"",anchorX:(Z==null?void 0:Z.clientX)??0,anchorY:(Z==null?void 0:Z.clientY)??0}}function R(O,Z){const k=document.createElement("button");return k.type="button",k.className="tile-context-menu__item",k.textContent=O,k.addEventListener("click",()=>{Ge(),typeof Z=="function"&&Z()}),k}function _e(O){if(!j)return;j.innerHTML="";const Z=document.createElement("div");Z.className="tile-context-menu__list",Z.appendChild(R("File view",()=>pe(O))),typeof J=="function"&&Z.appendChild(R("Edit",()=>J(O.id))),typeof te=="function"&&O.id&&tt.forEach(k=>{if(!(k!=null&&k.value))return;const ee=k.name||k.value;Z.appendChild(R(`Set color: ${ee}`,()=>te(O.id,k.value)))}),j.appendChild(Z)}function Oe(O,Z){if(!j)return;const k=4;j.style.left=`${O+k}px`,j.style.top=`${Z+k}px`,j.hidden=!1,j.setAttribute("aria-hidden","false"),j.classList.add("is-open");const ee=j.getBoundingClientRect();let ke=ee.left,ge=ee.top;ee.right>window.innerWidth-k&&(ke=Math.max(k,window.innerWidth-ee.width-k)),ee.bottom>window.innerHeight-k&&(ge=Math.max(k,window.innerHeight-ee.height-k)),j.style.left=`${ke}px`,j.style.top=`${ge}px`}async function pe(O){if(!c||!f||!A||!O)return;const Z=++Me,k=[];if(typeof J=="function"&&O.id&&k.push({label:"Edit",title:"Edit this item",onClick:()=>{ze(),J(O.id)}}),O.externalUrl&&k.push({label:"Open link ↗",title:O.externalUrl,onClick:()=>window.open(O.externalUrl,"_blank","noopener")}),O.obsidianUrl&&k.push({label:"Open in Obsidian",title:O.obsidianUrl,onClick:()=>window.open(O.obsidianUrl,"_blank","noopener")}),je(k),O.id&&typeof x=="function"&&x(O.id),f.textContent=O.displayName,A.innerHTML='<div class="item-preview__status">Loading…</div>',c.classList.remove("item-preview--has-frame"),c.classList.add("item-preview--expanded"),W(O.anchorX,O.anchorY),!O.filepath){A.innerHTML='<div class="item-preview__status">Preview unavailable for this item.</div>',Y(ae.x,ae.y);return}try{const ee=await fetch(O.filepath,{cache:"no-cache"});if(!ee.ok)throw new Error(`HTTP ${ee.status}`);const ke=await ee.text();if(Z!==Me)return;if(!ke.trim()){const $e=Q?Q(O.filename):O.filename;A.innerHTML=`<div class="item-preview__status">No content in <code>${$e}</code>.</div>`,Y(ae.x,ae.y);return}const Ie=document.createElement("iframe");Ie.className="item-preview__frame",Ie.title=`${O.displayName} details`,Ie.srcdoc=ke,A.innerHTML="",A.appendChild(Ie),c.classList.add("item-preview--has-frame"),Y(ae.x,ae.y)}catch(ee){if(Z!==Me)return;const ke=Q?Q(O.displayName):O.displayName;A.innerHTML=`<div class="item-preview__status">No preview available for <strong>${ke}</strong>.</div>`,console.warn(`[Blockscape] preview unavailable for ${O.filepath}`,ee),Y(ae.x,ae.y)}}function at(O,Z){if(!Z)return;O.preventDefault(),O.stopPropagation();const k=we(Z,O);!k||!k.id||(typeof x=="function"&&x(k.id),_e(k),Oe(O.clientX,O.clientY))}function se(O){const Z=O==null?void 0:O.target,k=j&&!j.hidden&&j.contains(Z),ee=c&&!c.hidden&&c.contains(Z);!k&&!ee&&ze()}function ve(){!c||c.hidden||Y(ae.x,ae.y)}function qe(){ze()}return F&&F.addEventListener("click",ze),{handleTileContextMenu:at,hidePreview:ze,hideMenu:Ge,handleDocumentClick:se,handleWindowResize:ve,handleWindowScroll:qe,updateColorPresets:O=>{tt=Array.isArray(O)?O:[]}}}function Rr(r,c="series"){return(r||c).trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||c}function wn(r,c="series"){const f=Rr(r,c).replace(/\./g,"-");return f.replace(/-series$/i,"").replace(/-+$/,"")||f||Rr(c,"series")}function Or(r,{seriesName:c,fallbackTitle:f="unknown"}={}){var J,te;const C=[r==null?void 0:r.seriesId,(J=r==null?void 0:r.data)==null?void 0:J.seriesId,r==null?void 0:r.apicurioArtifactId,c,r==null?void 0:r.title,r==null?void 0:r.apicurioArtifactName,(te=r==null?void 0:r.data)==null?void 0:te.title,f].map(x=>(x??"").toString().trim()),F=C.findIndex(Boolean),Q=F!==-1?C[F]:"";return Q?(console.log("[Series] deriveSeriesId: picked base",{base:Q,sourceIndex:F,candidates:C}),wn(Q,f)):(console.log("[Series] deriveSeriesId: no base found; fallback",{fallbackTitle:f}),null)}function $t(r,{seriesName:c,fallbackTitle:f="unknown"}={}){if(!r||typeof r!="object")return null;const A=Or(r,{seriesName:c,fallbackTitle:f});return A?(r.seriesId=A,r.apicurioArtifactId||(r.apicurioArtifactId=A),A):null}function Ln(r,c={}){var C,F;if(!r)return null;const f=r.isSeries||((C=r.apicurioVersions)==null?void 0:C.length)>1||r.seriesId||((F=r.data)==null?void 0:F.seriesId)||r.apicurioArtifactId;if(!f&&!c.force)return null;const A=Or(r,c);return A||(f?wn(c.fallbackTitle||"unknown"):null)}const Pr={selectionDimOpacity:.2,selectionDimEnabled:!0},Jn={seriesNavWait:r=>`${(r/1e3).toFixed(1)}s`,hoverScale:r=>`${Math.round((r-1)*100)}%`,selectionDimming:(r,c=!0)=>{const f=Math.round((1-r)*100);return c?f===0?"Off":`${f}% dim`:"Off"},compactness:r=>r===1?"Default":`${Math.round(r*100)}%`,titleWidth:r=>`${Math.round((r-1)*100)}% extra`,titleZoomPortion:r=>`${Math.round(r*100)}% of hover zoom`,autoReloadInterval:r=>`${(r/1e3).toFixed(2)}s`};function to(r){return r===!0||r==="true"||r===1||r==="1"}function Wl(r,{localBackend:c}={}){const f=c&&typeof c.getAutoReloadConfig=="function"&&c.getAutoReloadConfig(),A={theme:r.theme,hoverScale:r.hoverScale,selectionDimOpacity:r.selectionDimOpacity,selectionDimEnabled:r.selectionDimEnabled,tileCompactness:r.tileCompactness,titleWrapMode:r.titleWrapMode,titleHoverWidthMultiplier:r.titleHoverWidthMultiplier,titleHoverTextPortion:r.titleHoverTextPortion,obsidianLinksEnabled:r.obsidianLinksEnabled,obsidianLinkMode:r.obsidianLinkMode,obsidianVault:r.obsidianVaultName,autoIdFromName:r.autoIdFromNameEnabled,seriesNavDoubleClickMs:r.seriesNavDoubleClickWaitMs,showSecondaryLinks:r.showSecondaryLinks,centerItems:r.centerItems,showReusedInMap:r.showReusedInMap,colorPresets:r.colorPresets,depColor:r.depColor,revdepColor:r.revdepColor,linkThickness:r.linkThickness};return f&&(A.autoReloadEnabled=!!f.enabled,A.autoReloadIntervalMs=f.intervalMs),A}function jl(r={},c){var ht,S,g,Le;if(!r||typeof r!="object")return{applied:[]};const f=[],{applyTheme:A,applyTileHoverScale:C,persistTileHoverScale:F,applySelectionDimEnabled:Q,persistSelectionDimEnabled:J,applySelectionDimOpacity:te,persistSelectionDimOpacity:x,applyTileCompactness:re,persistTileCompactness:j,applyTitleWrapMode:ae,persistTitleWrapMode:Me,applyTitleHoverWidthMultiplier:tt,persistTitleHoverWidthMultiplier:Ge,applyTitleHoverTextPortion:je,persistTitleHoverTextPortion:ze,applyLinkThickness:W,persistLinkThickness:Y,applyDepColor:we,persistDepColor:R,applyRevdepColor:_e,persistRevdepColor:Oe,applyObsidianLinksEnabled:pe,persistObsidianLinksEnabled:at,applyObsidianLinkMode:se,persistObsidianLinkMode:ve,applyObsidianVaultName:qe,persistObsidianVaultName:O,applyAutoIdFromNameEnabled:Z,persistAutoIdFromNameEnabled:k,applySeriesNavDoubleClickWait:ee,persistSeriesNavDoubleClickWait:ke,applyCenterItems:ge,persistCenterItems:Ie,localBackend:$e,ui:m,refreshObsidianLinks:Re,scheduleOverlaySync:Ye,selection:nt,select:He,clearStyles:mt,drawLinks:Xe,applyReusedHighlights:rt,current:ct}=c;if(r.theme){const fe=((A==null?void 0:A(r.theme))||r.theme)==="dark";(ht=c.ui)!=null&&ht.themeToggle&&(c.ui.themeToggle.checked=fe),(S=c.ui)!=null&&S.tabThemeToggle&&(c.ui.tabThemeToggle.checked=fe),f.push("theme")}if(r.hoverScale!=null){const v=C(parseFloat(r.hoverScale));F(v),m!=null&&m.hoverScaleInput&&(m.hoverScaleInput.value=String(v)),m!=null&&m.hoverScaleValue&&(m.hoverScaleValue.textContent=Jn.hoverScale(v)),nt&&Ye(),f.push("hoverScale")}if(r.selectionDimEnabled!=null){const v=Q(to(r.selectionDimEnabled));J(v),m!=null&&m.selectionDimToggle&&(m.selectionDimToggle.checked=v),m!=null&&m.selectionDimInput&&(m.selectionDimInput.disabled=!v),m!=null&&m.selectionDimValue&&(m.selectionDimValue.textContent=Jn.selectionDimming(ct.selectionDimOpacity??Pr.selectionDimOpacity,v)),f.push("selectionDimEnabled")}if(r.selectionDimOpacity!=null){const v=te(parseFloat(r.selectionDimOpacity));x(v),m!=null&&m.selectionDimInput&&(m.selectionDimInput.value=String(v)),m!=null&&m.selectionDimValue&&(m.selectionDimValue.textContent=Jn.selectionDimming(v,ct.selectionDimEnabled??Pr.selectionDimEnabled)),f.push("selectionDimOpacity")}if(r.tileCompactness!=null){const v=re(parseFloat(r.tileCompactness));j(v),m!=null&&m.tileCompactnessInput&&(m.tileCompactnessInput.value=String(v)),m!=null&&m.tileCompactnessValue&&(m.tileCompactnessValue.textContent=Jn.compactness(v)),nt&&Ye(),f.push("tileCompactness")}if(r.titleWrapMode){const v=ae(r.titleWrapMode);Me(v),m!=null&&m.titleWrapInput&&(m.titleWrapInput.checked=v!=="nowrap"),f.push("titleWrapMode")}if(r.titleHoverWidthMultiplier!=null){const v=tt(parseFloat(r.titleHoverWidthMultiplier));Ge(v),m!=null&&m.titleWidthInput&&(m.titleWidthInput.value=String(v)),m!=null&&m.titleWidthValue&&(m.titleWidthValue.textContent=Jn.titleWidth(v)),f.push("titleHoverWidthMultiplier")}if(r.titleHoverTextPortion!=null){const v=je(parseFloat(r.titleHoverTextPortion));ze(v),m!=null&&m.titleZoomInput&&(m.titleZoomInput.value=String(v)),m!=null&&m.titleZoomValue&&(m.titleZoomValue.textContent=Jn.titleZoomPortion(v)),f.push("titleHoverTextPortion")}if(r.obsidianLinksEnabled!=null){const v=pe(to(r.obsidianLinksEnabled));at(v),m!=null&&m.obsidianToggle&&(m.obsidianToggle.checked=v),(g=m==null?void 0:m.obsidianModeInputs)==null||g.forEach(fe=>{fe.disabled=!v}),m!=null&&m.obsidianVaultInput&&(m.obsidianVaultInput.disabled=!v),Re==null||Re(),f.push("obsidianLinksEnabled")}if(r.obsidianLinkMode){const v=se(r.obsidianLinkMode);ve(v),(Le=m==null?void 0:m.obsidianModeInputs)==null||Le.forEach(fe=>{fe.checked=fe.value===v}),Re==null||Re(),f.push("obsidianLinkMode")}if(r.obsidianVault!=null){const v=qe(r.obsidianVault);O(v),m!=null&&m.obsidianVaultInput&&(m.obsidianVaultInput.value=v),Re==null||Re(),f.push("obsidianVault")}if(r.colorPresets&&(typeof c.setColorPresets=="function"&&c.setColorPresets(r.colorPresets),f.push("colorPresets")),r.linkThickness){const v=W==null?void 0:W(r.linkThickness);v&&(Y==null||Y(v),m!=null&&m.linkThicknessInput&&(m.linkThicknessInput.value=v),f.push("linkThickness"))}if(r.depColor){const v=we==null?void 0:we(r.depColor);v&&(R==null||R(v),m!=null&&m.depColorInput&&(m.depColorInput.value=v),f.push("depColor"))}if(r.revdepColor){const v=_e==null?void 0:_e(r.revdepColor);v&&(Oe==null||Oe(v),m!=null&&m.revdepColorInput&&(m.revdepColorInput.value=v),f.push("revdepColor"))}if(r.autoIdFromName!=null){const v=Z(to(r.autoIdFromName));k(v),m!=null&&m.autoIdToggle&&(m.autoIdToggle.checked=v),f.push("autoIdFromName")}if(r.seriesNavDoubleClickMs!=null){const v=ee(parseInt(r.seriesNavDoubleClickMs,10));ke(v),m!=null&&m.seriesNavInput&&(m.seriesNavInput.value=String(v)),m!=null&&m.seriesNavValue&&(m.seriesNavValue.textContent=Jn.seriesNavWait(v)),f.push("seriesNavDoubleClickMs")}if(r.autoReloadEnabled!=null&&$e&&typeof $e.setAutoReloadEnabled=="function"){const v=to(r.autoReloadEnabled);$e.setAutoReloadEnabled(v),m!=null&&m.autoReloadToggle&&(m.autoReloadToggle.checked=v),m!=null&&m.autoReloadInput&&(m.autoReloadInput.disabled=!v),f.push("autoReloadEnabled")}if(r.autoReloadIntervalMs!=null&&$e&&typeof $e.setAutoReloadInterval=="function"){const v=$e.setAutoReloadInterval(parseInt(r.autoReloadIntervalMs,10));m!=null&&m.autoReloadInput&&(m.autoReloadInput.value=String(v)),m!=null&&m.autoReloadValue&&(m.autoReloadValue.textContent=Jn.autoReloadInterval(v)),f.push("autoReloadIntervalMs")}if(r.centerItems!=null){const v=ge==null?void 0:ge(to(r.centerItems));Ie==null||Ie(v),m!=null&&m.tabCenterToggle&&(m.tabCenterToggle.checked=v),f.push("centerItems")}if(r.showSecondaryLinks!=null){const v=to(r.showSecondaryLinks);typeof c.setShowSecondaryLinks=="function"?c.setShowSecondaryLinks(v):c.showSecondaryLinks=v,m!=null&&m.secondaryLinksToggle&&(m.secondaryLinksToggle.checked=v),m!=null&&m.tabSecondaryLinksToggle&&(m.tabSecondaryLinksToggle.checked=v),nt?He(nt):(mt(),Xe()),f.push("showSecondaryLinks")}if(r.showReusedInMap!=null){const v=to(r.showReusedInMap);typeof c.setShowReusedInMap=="function"?c.setShowReusedInMap(v):c.showReusedInMap=v,m!=null&&m.reusedToggle&&(m.reusedToggle.checked=v),rt==null||rt(),f.push("showReusedInMap")}return{applied:f}}function zl(r,c){const f=new Blob([c],{type:"application/json"}),A=URL.createObjectURL(f),C=document.createElement("a");C.href=A,C.download=r,C.click(),URL.revokeObjectURL(A)}const Bi=typeof{url:Tn&&Tn.tagName.toUpperCase()==="SCRIPT"&&Tn.src||new URL("blockscape.js",document.baseURI).href}<"u"&&"./"||"";function Jl(r={}){console.log("[Blockscape] init");const c={localBackend:!0,fileOpen:!0,fileSave:!0,autoLoadFromDir:!0,showModelMeta:!0,seriesNavMinVersions:1,initialSettings:null,initialSettingsUrl:null,...r},f=document.getElementById("jsonBox"),A=document.querySelector(".blockscape-json-panel"),C=document.getElementById("app"),F=document.getElementById("overlay"),Q=document.getElementById("tabTooltip"),J=document.getElementById("modelList"),te=document.getElementById("itemPreview"),x=document.getElementById("urlForm"),re=document.getElementById("urlInput"),j=document.getElementById("loadUrl"),ae=te.querySelector(".item-preview__title"),Me=te.querySelector(".item-preview__body"),tt=te.querySelector(".item-preview__actions"),Ge=te.querySelector(".item-preview__close"),je=document.getElementById("downloadJson"),ze=document.getElementById("shareModel"),W=document.getElementById("createVersion"),Y=document.getElementById("openInEditor"),we=document.getElementById("copyJson"),R=document.getElementById("copySeries"),_e=document.getElementById("pasteJson"),Oe=document.getElementById("helpButton"),pe=document.getElementById("newPanelButton"),at=document.getElementById("newBlankButton"),se=document.getElementById("shortcutHelp"),ve=document.getElementById("shortcutHelpList"),qe=document.getElementById("shortcutHelpClose"),O=document.getElementById("shortcutHelpBackdrop"),Z=document.getElementById("newPanel"),k=document.getElementById("newPanelClose"),ee=document.getElementById("newPanelBackdrop"),ke=document.getElementById("search"),ge=document.getElementById("searchResults"),Ie=document.getElementById("localBackendPanel"),$e=document.getElementById("localBackendStatus"),m=document.getElementById("localFileList"),Re=document.getElementById("localDirSelect"),Ye=document.getElementById("refreshLocalFiles"),nt=document.getElementById("loadLocalFile"),He=document.getElementById("saveLocalFile"),mt=document.getElementById("saveLocalFileAs"),Xe=document.getElementById("localSavePath"),rt="blockscape:editorPayload",ct="blockscape:editorTransfer",ht=document.title;Ie&&(Ie.hidden=!0),!c.localBackend&&Ie&&(Ie.hidden=!0),c.fileOpen||(nt&&(nt.hidden=!0),Re&&(Re.hidden=!0),Ye&&(Ye.hidden=!0),m&&(m.hidden=!0)),c.fileSave||(He&&(He.hidden=!0),mt&&(mt.hidden=!0),Xe&&(Xe.hidden=!0)),f.value=document.getElementById("seed").textContent.trim();let S=[],g=-1;const Le=Pl({models:S,getActiveIndex:()=>g,setActive:It,ensureModelMetadata:Cn,getModelId:dt,getSeriesId:Ln,ensureSeriesId:$t,getModelTitle:Je,computeJsonFingerprint:Fi,uid:ro});let v=null,fe=new Map,Ht=new Map,K=null,Fe=null,Et=null,ot=null,en=!0,Nn=!1,Ft=!1,ln="map",Wt=null,Rt=null,no=!1,Mn=null;const Kn=2e3;let Ot=null,Xt=null,vn=null,Zt=null,jt=null,St=null,tn=null,yn=null,nn=null,En="",d=!1,y=null;const N=new Map;let M=null,E=null,V=[],X=null;const q=30,ye=1e3,Ee="blockscape:hoverScale",me=1.5,We=1,Ze=2.5,he="blockscape:selectionDimOpacity",Lt="blockscape:selectionDimEnabled",bt=.2,de=.05,ne=1,ut="blockscape:titleWrap",cn="blockscape:titleHoverWidth",st="blockscape:titleHoverTextPortion",kt="wrap",wt=1.3,In=1,dn=1.6,_n=.25,oo=0,ha=.6,Hr="blockscape:tileCompactness",ti=1,Fr=.75,Wr=1.25,jr="blockscape:obsidianLinksEnabled",zr="blockscape:obsidianLinkMode",Jr="blockscape:obsidianVault",ga="title",$i="id",Ri=ga,Kr="blockscape:autoReloadEnabled",Gr="blockscape:autoReloadIntervalMs",ni=1e3,qr=500,Yr=1e4,Xr="blockscape:autoIdFromName",Oi=!0,Zr="blockscape:colorPresets",Qr="blockscape:centerItems",es="blockscape:theme",yo="light",io="dark",Pi="cat:",Vi=!1,ts="blockscape:depColor",ns="blockscape:revdepColor",os="blockscape:linkThickness",is=6,as={s:{primary:1.5,secondary:1},m:{primary:3,secondary:2.25},l:{primary:6,secondary:4.5}};let Eo=me,Bn=bt,$n=!0,So=ti,ba=kt,ko=wt,Io=_n,_o=!1,oi=Ri,Co="",ao=Oi,ii=yo,zt=[],on=Vi,Di="",Ui="",ai="m",xo=null;const rs="blockscape:seriesNavDoubleClickMs",ri=900,ss=300,ls=4e3;let Rn=ri;const Ae={hoverScaleInput:null,hoverScaleValue:null,selectionDimToggle:null,selectionDimInput:null,selectionDimValue:null,tileCompactnessInput:null,tileCompactnessValue:null,titleWrapInput:null,titleWidthInput:null,titleWidthValue:null,titleZoomInput:null,titleZoomValue:null,seriesNavInput:null,seriesNavValue:null,obsidianToggle:null,obsidianModeInputs:[],obsidianVaultInput:null,autoIdToggle:null,autoReloadToggle:null,autoReloadInput:null,autoReloadValue:null,secondaryLinksToggle:null,reusedToggle:null,themeToggle:null,tabThemeToggle:null,tabSecondaryLinksToggle:null,tabCenterToggle:null,colorPresetList:null,depColorInput:null,revdepColorInput:null,linkThicknessInput:null},dc={detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1,highlightSource(){},getAutoReloadConfig:()=>({enabled:!1,intervalMs:ni}),setAutoReloadEnabled(){},setAutoReloadInterval(){},saveModelByIndex:async()=>!1},Ke=c.localBackend?Lc():dc,cs=c.localBackend?Ke.detect():Promise.resolve(!1);Le.hydrateConfig(),wa(bc()),Lo(_c(),{silent:!0}),yc(),Ec(),Ic(),Wc(),jc(),Kc(),Yc(),Gc(),qc(),ed(),od(),nd(),id(),zc(),Jc(),vc(),Kt();function ro(){return Math.random().toString(36).slice(2,10)}function uc(e){const t=new TextEncoder().encode(e);let n="";return t.forEach(o=>{n+=String.fromCharCode(o)}),btoa(n)}function pc(e){const t=atob(e),n=new Uint8Array(t.length);for(let o=0;o<t.length;o++)n[o]=t.charCodeAt(o);return new TextDecoder().decode(n)}function fc(e){return uc(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function mc(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");const n=t.length%4;return n&&(t+="=".repeat(4-n)),pc(t)}const ds=(e,t)=>zl(e,t);function us(e){return!e||typeof e!="object"?null:e.settings&&typeof e.settings=="object"?e.settings:e}async function hc(e){if(!e)return null;const t=Array.isArray(e)?e:[e],n=[];t.forEach(i=>{if(typeof i=="string"&&i.trim()){n.push(i.trim());try{const a=new URL(i,window.location.origin).toString();a!==i.trim()&&n.push(a)}catch{}}});const o=new Set;for(const i of n)if(!o.has(i)){o.add(i);try{const a=await ll(i),s=JSON.parse(a),l=us(s);if(l)return l}catch(a){console.warn("[Blockscape] initial settings fetch failed",i,a)}}return null}async function gc(){const e=typeof refreshObsidianLinks=="function"?refreshObsidianLinks:null,t=[];c.initialSettings&&t.push({type:"inline",snapshot:c.initialSettings}),c.initialSettingsUrl&&t.push({type:"url",url:c.initialSettingsUrl});let n=0;for(const o of t)try{const i=o.type==="inline"?us(o.snapshot):await hc(o.url);if(!i)continue;const a=As(i,{refreshObsidianLinks:e}),s=(a==null?void 0:a.applied)||[];s.length&&(n+=s.length,console.log(`[Blockscape] applied ${s.length} setting${s.length===1?"":"s"} from ${o.type==="inline"?"inline config":o.url}.`))}catch(i){console.warn("[Blockscape] initial settings apply failed",i)}return n}function bc(){if(typeof window>"u"||!window.localStorage)return yo;try{return window.localStorage.getItem(es)===io?io:yo}catch{return yo}}function wc(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(es,e)}catch(t){console.warn("[Blockscape] theme persistence failed",t)}}function wa(e){const t=e===io?io:yo;return ii=t,typeof document<"u"&&document.documentElement.setAttribute("data-theme",t),wc(t),ii}function ps(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Qr,e?"true":"false")}catch(t){console.warn("[Blockscape] failed to persist center items",t)}}function Ao(e){return on=!!e,C&&(C.classList.toggle("is-center-mode",on),C.querySelectorAll(".grid").forEach(t=>{t.classList.toggle("is-centered",on)}),C.querySelectorAll(".tile-add").forEach(t=>{t.hidden=on,t.tabIndex=on?-1:0,t.setAttribute("aria-hidden",on?"true":"false")})),v&&(qi(),Sn()),on}function vc(){if(typeof window>"u"||!window.localStorage)return Ao(Vi);try{const e=window.localStorage.getItem(Qr);return e==null?Ao(Vi):Ao(e==="true"||e==="1")}catch(e){return console.warn("[Blockscape] failed to read center items pref",e),Ao(Vi)}}function To(e){return typeof window>"u"?"":getComputedStyle(document.documentElement).getPropertyValue(e).trim()}function fs(e,t){typeof document>"u"||document.documentElement.style.setProperty(e,t)}function va(e,t){const n=(e||"").toString().trim();return n.match(/^#([0-9a-f]{3}|[0-9a-f]{6})$/i)?n.length===4?"#"+n.slice(1).split("").map(i=>i+i).join(""):n.toLowerCase():t}function ms(e,{fallbackVar:t,fallbackColor:n}){const o=(e||"").toString().trim(),i=o.match(/^var\((--[^)]+)\)$/);if(i){const a=To(i[1]);if(a)return va(a,n);if(t){const s=To(t);if(s)return va(s,n)}}return va(o,n)}function hs(e){if(typeof window>"u"||!window.localStorage)return"";try{return window.localStorage.getItem(e)||""}catch(t){return console.warn("[Blockscape] failed to read stored color",e,t),""}}function ya(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ts,e)}catch(t){console.warn("[Blockscape] failed to persist dep color",t)}}function Ea(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ns,e)}catch(t){console.warn("[Blockscape] failed to persist revdep color",t)}}function Sa(e){const t=ms(e,{fallbackVar:"--color-primary",fallbackColor:Bt.color.primary});return Di=t,fs("--blockscape-dep",t),F&&Sn(),Di}function ka(e){const t=ms(e,{fallbackVar:"--color-danger",fallbackColor:Bt.blockscape.revdep});return Ui=t,fs("--blockscape-revdep",t),F&&Sn(),Ui}function yc(){const e=hs(ts),t=Sa(e||To("--blockscape-dep")||Bt.color.primary);return ya(t),t}function Ec(){const e=hs(ns),t=ka(e||To("--blockscape-revdep")||Bt.blockscape.revdep);return Ea(t),t}function Sc(e){const t=(e||"").toString().toLowerCase();return t==="s"||t==="l"?t:"m"}function kc(){return as[ai]||as.m}function si(e){return ai=Sc(e),Sn(),ai}function Ia(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(os,e)}catch(t){console.warn("[Blockscape] failed to persist link thickness",t)}}function Ic(){if(typeof window>"u"||!window.localStorage)return si("m");try{const e=window.localStorage.getItem(os),t=si(e||"m");return Ia(t),t}catch(e){return console.warn("[Blockscape] failed to read link thickness",e),si("m")}}function gs(e){const t=o=>/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(o||"");if(!Array.isArray(e))return li();const n=e.map(o=>({name:((o==null?void 0:o.name)||"").toString().trim()||"Custom",value:((o==null?void 0:o.value)||"").toString().trim()})).filter(o=>t(o.value));return n.length?n:li()}function li(){return[{name:"Black",value:Bt.color.ink},{name:"White",value:Bt.color.white},{name:"Red",value:Bt.blockscape.revdep},{name:"Green",value:Bt.color.success}]}function _c(){if(typeof window>"u"||!window.localStorage)return li();try{const e=window.localStorage.getItem(Zr);if(!e)return li();const t=JSON.parse(e);return gs(t)}catch(e){return console.warn("[Blockscape] failed to load color presets",e),li()}}function Cc(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Zr,JSON.stringify(e))}catch(t){console.warn("[Blockscape] failed to persist color presets",t)}}function Lo(e,{silent:t=!1}={}){return zt=gs(e),Cc(zt),!t&&typeof Wo=="function"&&Wo(zt),xo==null||xo(),zt}function xc(){if(typeof window>"u"||!window.location)return!1;const e=new URL(window.location.href),n=e.pathname.replace(/\/+$/,"").split("/").filter(Boolean),o=e.searchParams.get("server");return n[0]&&n[0].toLowerCase()==="server"||o&&["1","true","yes","on"].includes(o.toLowerCase())}function Hi(e,{modelId:t,itemId:n}={}){if(typeof window>"u"||!window.location||!e)return;const o=so(e);if(!o)return;const i=S[g],a=so(i==null?void 0:i.sourcePath),s=t??(a&&a===o?dt(i):null),l=n??(a&&a===o?K:null),u=o.split("/").filter(Boolean).map(T=>encodeURIComponent(T)),h=s?encodeURIComponent(s):null,b=l?encodeURIComponent(l):null;try{const T=new URL(window.location.href),D=new URLSearchParams(T.search);D.delete("load"),D.delete("share");const L=["","server",...u,...h?[h]:[],...b?[b]:[]].join("/").replace(/\/+/g,"/");T.pathname=L,T.search=D.toString()?`?${D.toString()}`:"",T.hash="",window.history.replaceState({},document.title,T.toString())}catch(T){console.warn("[Blockscape] failed to update URL for server path",T)}}function Ac(){if(typeof window>"u"||!window.location)return null;const n=new URL(window.location.href).pathname.replace(/\/+$/,"").split("/").filter(Boolean),o=n.findIndex(P=>P.toLowerCase()==="server");if(o===-1)return null;const i=n.slice(o+1);if(!i.length)return null;const a=i.findIndex(P=>P.toLowerCase().endsWith(".bs"));if(a===-1)return null;const s=i.slice(0,a+1),l=i.slice(a+1),u=P=>{try{return decodeURIComponent(P)}catch{return P}},h=s.map(u),b=l.map(u),T=h.join("/"),D=so(T);if(!D)return null;const L=b[0]?b[0].trim():null,B=b[1]?b[1].trim():null;return{path:D,modelId:L||null,itemId:B||null}}function _a({itemId:e}={}){const t=S[g];t!=null&&t.sourcePath&&Hi(t.sourcePath,{modelId:dt(t),itemId:e===void 0?K:e})}function Tc(){return typeof window>"u"||!window.location?!1:(window.location.hostname||"").toLowerCase().endsWith("github.io")}function Lc(){const e=()=>typeof window>"u"||!window.location?{}:{host:window.location.host,path:window.location.pathname,search:window.location.search,hash:window.location.hash};function t(I,z={}){console.log("[Blockscape][local-backend]",I,{...e(),...z})}if(Tc())return t("Disabled on github.io host"),Ie&&(Ie.hidden=!0),{detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1};if(!xc()||!Ie||!$e)return t("Opt-in flag missing or panel unavailable"),Ie&&(Ie.hidden=!0),{detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1};if(!Ie||!$e)return{detect:async()=>!1,refresh:async()=>{},updateActiveSavePlaceholder(){},isAvailable:()=>!1};let o=!1,i="",a=[],s=[],l="",u=new Map,h=P(),b=Be(),T=null,D=!1;const L=new Set;function B(){return L.size>0}function P(){if(typeof window>"u"||!window.localStorage)return!0;try{const I=window.localStorage.getItem(Kr);return I==null?!0:I==="true"}catch{return!0}}function oe(I){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Kr,I?"true":"false")}catch(z){console.warn("[Blockscape] auto-reload: failed to persist",z)}}function Be(){if(typeof window>"u"||!window.localStorage)return ni;try{const I=window.localStorage.getItem(Gr);if(!I)return ni;const z=parseInt(I,10);return Ce(z)}catch{return ni}}function lt(I){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Gr,String(I))}catch(z){console.warn("[Blockscape] auto-reload: failed to persist interval",z)}}function Ce(I){return Number.isFinite(I)?Math.min(Yr,Math.max(qr,I)):ni}function Ne(I){if(!I)return"";const z=I.split("/").filter(Boolean);return z.pop(),z.join("/")}function it(I,{error:z=!1}={}){$e.textContent=I,$e.style.color=z?Bt.color.dangerStrong:"",t("Status",{text:I,error:z})}function De(I){return so(I)}function _t(I){const z=zi(I);return z?{payload:z,isSeries:!0}:{payload:I==null?void 0:I.data,isSeries:!1}}function Vt(){var z;if(g>=0&&((z=S[g])!=null&&z.sourcePath))return S[g].sourcePath;if(g<0)return"blockscape.bs";const I=Je(S[g])||"blockscape";return`${wn(I,"blockscape")}.bs`}function Ct(){var I;Xe&&(Xe.placeholder=Vt(),(I=S[g])!=null&&I.sourcePath&&(Xe.value=S[g].sourcePath))}function xe(){if(!Re)return;Re.innerHTML="";const I=document.createElement("option");I.value="",I.textContent="All (~/blockscape)",Re.appendChild(I),s.forEach(le=>{const ce=document.createElement("option");ce.value=le,ce.textContent=le||"(root)",Re.appendChild(ce)});const z=s.includes(l)?l:"";Re.value=z,l=z}function vt(){if(!m)return;m.innerHTML="";const I=l?a.filter(z=>z.path.startsWith(`${l}/`)):a;if(!I.length){const z=document.createElement("option");z.disabled=!0,z.textContent="No .bs files found yet",m.appendChild(z),m.disabled=!0;return}m.disabled=!1,I.forEach(z=>{const le=document.createElement("option");le.value=z.path;const ce=z.mtimeMs?new Date(z.mtimeMs).toLocaleString():"";le.textContent=ce?`${z.path} · ${ce}`:z.path,m.appendChild(le)}),i&&Array.from(m.options).forEach(z=>{z.value===i&&(z.selected=!0)}),!m.value&&m.options.length&&(m.options[0].selected=!0)}function kn(I){if(!o||!m||!I||!a.find(Qe=>Qe.path===I))return;const le=Ne(I);le!==l&&(l=le,xe()),vt(),Array.from(m.options).forEach(Qe=>{Qe.selected=Qe.value===I});const ce=Array.from(m.options).find(Qe=>Qe.value===I);ce!=null&&ce.scrollIntoView&&ce.scrollIntoView({block:"nearest"}),Xe&&(Xe.value=I)}function Fn(){T&&(clearInterval(T),T=null)}function xt(){Fn(),!(!o||!h||B())&&(T=setInterval(An,b))}function Qt(I){if(!I)return;const z=L.size;L.add(I),L.size!==z&&(t("Auto-reload paused",{reason:I}),xt())}function Gt(I){if(!I)return;L.delete(I)&&(t("Auto-reload resumed",{reason:I}),xt())}async function Ve(I){const z=S.findIndex(le=>le.sourcePath===I);if(z!==-1)try{const le=await fetch(`/api/file?path=${encodeURIComponent(I)}`,{cache:"no-store"});if(!le.ok)throw new Error(`HTTP ${le.status}`);const ce=await le.json(),Qe=JSON.stringify(ce.data??ce,null,2),At=Vn(Qe,I,{seriesTitleOverride:`${I} series`});if(!At.length)return;const be=At[0];if(be.sourcePath=I,Cn(be,{titleHint:Je(S[z]),idHint:dt(S[z])}),be.isSeries){const et=be.title||Je(be)||Je(S[z]),gt=wn(et||"unknown");lo(be,gt),$t(be,{seriesName:et||"unknown",fallbackTitle:"unknown"})}S[z]={...S[z],...be,title:be.title||Je(be),data:be.data,sourcePath:I},z===g?(Pt(),Mt()):Pn(),console.log("[Blockscape] auto-reloaded model from",I)}catch(le){console.warn("[Blockscape] auto-reload failed for",I,le)}}async function An(){if(!(!o||!h||B()||D)){D=!0;try{const I=await fetch("/api/files",{cache:"no-store"});if(!I.ok)throw new Error(`HTTP ${I.status}`);const le=((await I.json()).files||[]).slice().sort((be,et)=>{const gt=(be==null?void 0:be.mtimeMs)||0,rn=(et==null?void 0:et.mtimeMs)||0;return gt===rn?(be.path||"").localeCompare(et.path||""):rn-gt}),ce=new Map;le.forEach(be=>ce.set(be.path,be.mtimeMs||0));const Qe=S.map((be,et)=>({path:be.sourcePath,idx:et})).filter(be=>be.path);for(const be of Qe){const et=u.get(be.path)||0;(ce.get(be.path)||0)>et&&await Ve(be.path)}a=le;const At=new Set;a.forEach(be=>At.add(Ne(be.path))),s=Array.from(At).filter(be=>be!=="").sort(),u=ce,xe(),vt()}catch(I){console.warn("[Blockscape] auto-reload check failed",I)}finally{D=!1}}}function fo(I){h=!!I,oe(h),xt()}function Go(I){return b=Ce(I),lt(b),xt(),b}function an(I){o=!1,a=[],u=new Map,Fn(),vt(),Ie.hidden=!0,I&&it(I,{error:!0}),t("Panel hidden",{message:I})}async function mo({silent:I=!1}={}){try{t("Health check start");const z=await fetch("/api/health",{cache:"no-store"});if(!z.ok)throw new Error(`HTTP ${z.status}`);const le=await z.json();if(o=!!(le!=null&&le.ok),!o)throw new Error("Health check failed");return Ie.hidden=!1,I||it(le.root?`Local server ready (root: ${le.root})`:"Local server ready"),t("Health check ok",{payload:le}),!0}catch(z){return I||console.log("[Blockscape] local backend health failed",z),an("Local server unavailable"),!1}}async function un(){if(o&&m){it("Loading files…");try{const I=await fetch("/api/files",{cache:"no-store"});if(!I.ok)throw new Error(`HTTP ${I.status}`);a=((await I.json()).files||[]).slice().sort((ce,Qe)=>{const At=(ce==null?void 0:ce.mtimeMs)||0,be=(Qe==null?void 0:Qe.mtimeMs)||0;return At===be?(ce.path||"").localeCompare(Qe.path||""):be-At});const le=new Set;a.forEach(ce=>{le.add(Ne(ce.path))}),s=Array.from(le).filter(ce=>ce!=="").sort(),l&&!le.has(l)&&(l=""),!l&&i&&(l=Ne(i)),u=new Map(a.map(ce=>[ce.path,ce.mtimeMs||0])),xe(),vt(),it(a.length?`Browsing ${a.length} file(s) in ~/blockscape`:"No .bs files in ~/blockscape yet")}catch(I){console.warn("[Blockscape] local backend refresh failed",I),an("Local server unavailable")}}}async function mi(){o=!1,an(),it("Checking for local server…");try{return t("Detect start"),await mo()?(Ct(),await un(),xt(),!0):!1}catch(I){return o=!1,console.log("[Blockscape] local backend not detected",I),t("Detect failed",{err:I}),!1}}async function qo(){if(!o||!m)return;const I=Array.from(m.selectedOptions||[]).map(le=>le.value).filter(Boolean).sort((le,ce)=>le.localeCompare(ce));if(!I.length){alert("Select one or more files to load from ~/blockscape.");return}let z=null;for(const le of I)try{it(`Loading ${le}…`);const ce=await bs(le);z==null&&(z=(ce==null?void 0:ce.firstIndex)??null),i=le,Hi(le)}catch(ce){console.error("[Blockscape] failed to load from local server",ce),alert(`Local load failed for ${le}: ${ce.message}`)}z!=null&&It(z),it(`Loaded ${I.length} file(s)`),vt()}async function Yo(I,{statusPrefix:z="Saved to",updateInput:le=!0}={}){if(!o)return;if(g<0){alert("No active model to save.");return}const ce=S[g],{payload:Qe,isSeries:At}=_t(ce);if(!Qe){alert("No model data to save.");return}const be=De(I);if(!be){alert("Enter a relative path (no ..) to save under ~/blockscape.");return}try{const et=JSON.stringify(Qe,null,2);it(`Saving ${At?"series":"map"} to ${be}…`);const rn=await fetch(`/api/file?path=${encodeURIComponent(be)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:et});if(!rn.ok)throw new Error(`HTTP ${rn.status}`);const qt=await rn.json();i=qt.path||be,ce.sourcePath=qt.path||be,le&&Xe&&(Xe.value=qt.path||be),Hi(qt.path||be),it(`${z} ${qt.path||be}`),await un()}catch(et){console.error("[Blockscape] local save failed",et),alert(`Local save failed: ${et.message}`),an("Local server unavailable")}}async function Gn(){var z;const I=De(Xe==null?void 0:Xe.value)||De((z=S[g])==null?void 0:z.sourcePath)||Vt();if(!I){alert("Enter a relative path (no ..) to save under ~/blockscape.");return}await Yo(I,{statusPrefix:"Saved to"})}async function hi(){var ce;if(!o)return;if(g<0){alert("No active model to save.");return}if(typeof window>"u"||typeof window.prompt!="function")return;const I=De((ce=S[g])==null?void 0:ce.sourcePath)||Vt(),z=window.prompt("Save active map as (under ~/blockscape):",I);if(z==null)return;const le=De(z);if(!le){alert("Enter a relative path (no ..) to save under ~/blockscape.");return}await Yo(le,{statusPrefix:"Saved to"})}async function gi(I,z,{refreshAfter:le=!0,statusPrefix:ce="Saved to"}={}){if(!o)return{ok:!1,error:"Local server unavailable"};if(!Number.isInteger(I)||I<0)return{ok:!1,error:"Invalid model index"};const Qe=S[I],{payload:At,isSeries:be}=_t(Qe);if(!At)return{ok:!1,error:"Model has no data"};const et=De(z)||De(Qe==null?void 0:Qe.sourcePath)||Vt();if(!et)return{ok:!1,error:"Enter a relative path (no ..) to save under ~/blockscape."};try{const gt=JSON.stringify(At,null,2);it(`Saving ${be?"series":"map"} to ${et}…`);const qt=await fetch(`/api/file?path=${encodeURIComponent(et)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:gt});if(!qt.ok)throw new Error(`HTTP ${qt.status}`);const Wn=await qt.json();return i=Wn.path||et,Qe.sourcePath=Wn.path||et,I===g&&Ct(),it(`${ce} ${Wn.path||et}`),le&&await un(),{ok:!0,path:Wn.path||et}}catch(gt){return console.error("[Blockscape] local save failed",gt),an("Local server unavailable"),{ok:!1,error:gt.message}}}if(Ye&&(Ye.onclick=()=>un()),nt&&(nt.onclick=()=>qo()),He&&(He.onclick=()=>Gn()),mt&&(mt.onclick=()=>hi()),m&&Xe&&(m.addEventListener("change",()=>{const I=Array.from(m.selectedOptions||[])[0];I!=null&&I.value&&(Xe.value=I.value)}),m.addEventListener("dblclick",()=>{qo()})),Re&&Re.addEventListener("change",()=>{l=Re.value||"",vt()}),Ie){const I="local-files-panel-focus",z="local-files-panel-pointer";let le=!1,ce=!1;Ie.addEventListener("focusin",()=>{le||(le=!0,Qt(I))}),Ie.addEventListener("focusout",Qe=>{if(!le)return;const At=Qe.relatedTarget;At&&Ie.contains(At)||(le=!1,Gt(I))}),Ie.addEventListener("pointerenter",()=>{ce||(ce=!0,Qt(z))}),Ie.addEventListener("pointerleave",()=>{ce&&(ce=!1,Gt(z))})}return{detect:mi,refresh:un,updateActiveSavePlaceholder:Ct,isAvailable:()=>o,highlightSource:kn,saveModelByIndex:gi,getAutoReloadConfig:()=>({enabled:h,intervalMs:b,available:o}),setAutoReloadEnabled:fo,setAutoReloadInterval:Go}}async function bs(e,{labelBase:t=e,seriesTitleOverride:n}={}){if(!e)throw new Error("Missing path");const o=await fetch(`/api/file?path=${encodeURIComponent(e)}`,{cache:"no-store"});if(!o.ok)throw new Error(`HTTP ${o.status}`);const i=await o.json(),a=JSON.stringify(i.data??i,null,2),s=Vn(a,e,{seriesTitleOverride:n||`${e} series`});if(!s.length)throw new Error("No models found in file");let l=null;return s.forEach((u,h)=>{if(u.sourcePath=e,u.isSeries&&!u.title){const D=(e.split("/").filter(Boolean).pop()||e).replace(/\.bs$/i,"");u.title=D}const b=xn(u,{versionLabel:s.length>1?`${t} #${h+1}`:t});l==null&&(l=b)}),{firstIndex:l,total:s.length}}async function ws(e){var t;if(!((t=navigator.clipboard)!=null&&t.writeText))return!1;try{return await navigator.clipboard.writeText(e),!0}catch(n){return console.warn("[Blockscape] clipboard write failed",n),!1}}async function Nc(){var e;if(!((e=navigator.clipboard)!=null&&e.readText))throw new Error("Clipboard read not supported");return navigator.clipboard.readText()}function Jt(e){return(e||"blockscape").trim().toLowerCase().replace(/[^a-z0-9._-]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")||"blockscape"}function so(e){const t=(e||"").trim().replace(/\\/g,"/").replace(/^\/+/,"");return!t||t.includes("..")?null:t.toLowerCase().endsWith(".bs")?t:`${t}.bs`}function Mc(e){return((e||"").split("/").filter(Boolean).pop()||"").replace(/\.bs$/i,"").trim()}function Bc(e,t){const n=so(e);if(!n)return null;const o=n.split("/"),s=`${(o.pop()||n).replace(/\.bs$/i,"")}-${t}.bs`;return[...o,s].filter(Boolean).join("/")}function Ca(){const e=new Date,t=n=>String(n).padStart(2,"0");return`${e.getFullYear()}${t(e.getMonth()+1)}${t(e.getDate())}-${t(e.getHours())}${t(e.getMinutes())}${t(e.getSeconds())}`}async function ci(){try{await cs}catch{}return typeof(Ke==null?void 0:Ke.isAvailable)=="function"?Ke.isAvailable():!1}async function $c(){try{const e=await fetch("/api/files",{cache:"no-store"});if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();return new Set((t.files||[]).map(n=>n.path).filter(Boolean))}catch(e){return console.warn("[Blockscape] failed to list existing local files",e),new Set}}function Rc(e,t){const n=so(e);if(!n)return null;if(!(t!=null&&t.has(n)))return n;const o=n.split("/"),a=(o.pop()||n).replace(/\.bs$/i,"");for(let s=2;s<1e3;s++){const l=`${a}-${s}.bs`,u=[...o,l].filter(Boolean).join("/");if(!t.has(u))return u}return null}function Oc(e,t="clipboard"){const n=Je(e)||(e==null?void 0:e.title)||(e==null?void 0:e.apicurioArtifactName)||t||"blockscape",o=Jt(n),i=Ca();return`${o}-${i}.bs`}function Pc(e,t){if(!(e!=null&&e.isSeries)||!Array.isArray(e==null?void 0:e.apicurioVersions)||e.apicurioVersions.length<=1)return!1;const n=Mc(t);if(!n)return!1;e.title=n,e.apicurioArtifactName=n;const o=wn(n||"unknown");return lo(e,o),$t(e,{seriesName:n,fallbackTitle:n}),!0}function Vc(e){return Number.isFinite(e)?Math.min(Ze,Math.max(We,e)):me}function Kt(){if(!C)return;const e=!!K||!!Fe;C.classList.toggle("blockscape-has-selection",e),C.classList.toggle("blockscape-has-item-selection",!!K)}function No(e){return Eo=Vc(e),document.documentElement.style.setProperty("--blockscape-tile-hover-scale",Eo),Eo}function Dc(e){return Number.isFinite(e)?Math.min(ne,Math.max(de,e)):bt}function Mo(e){Bn=Dc(e),document.documentElement.style.setProperty("--blockscape-selection-dim-opacity",Bn);const t=$n?Bn:1;return document.documentElement.style.setProperty("--blockscape-selection-dim-applied-opacity",t),Bn}function Uc(e){return Number.isFinite(e)?Math.min(Wr,Math.max(Fr,e)):ti}function Bo(e){return So=Uc(e),document.documentElement.style.setProperty("--blockscape-tile-compactness",So),So}function Hc(e){return Number.isFinite(e)?Math.min(dn,Math.max(In,e)):wt}function $o(e){return ko=Hc(e),document.documentElement.style.setProperty("--blockscape-title-hover-width-multiplier",ko),ko}function Fc(e){return Number.isFinite(e)?Math.min(ha,Math.max(oo,e)):_n}function Ro(e){return Io=Fc(e),document.documentElement.style.setProperty("--blockscape-tile-hover-text-portion",Io),Io}function Oo(e){const t=e==="nowrap"?"nowrap":"wrap";ba=t;const n=t==="nowrap"?"nowrap":"normal",o=t==="nowrap"?"nowrap":"normal";return document.documentElement.style.setProperty("--blockscape-title-white-space",n),document.documentElement.style.setProperty("--blockscape-title-text-wrap",o),t}function vs(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Ee,String(e))}catch(t){console.warn("[Blockscape] failed to persist hover scale",t)}}function Wc(){if(typeof window>"u"||!window.localStorage)return No(me);try{const e=window.localStorage.getItem(Ee);if(!e)return No(me);const t=parseFloat(e);return No(t)}catch(e){return console.warn("[Blockscape] failed to read hover scale",e),No(me)}}function ys(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(he,String(e))}catch(t){console.warn("[Blockscape] failed to persist selection dimming",t)}}function jc(){if(typeof window>"u"||!window.localStorage)return Mo(bt);try{const e=window.localStorage.getItem(he);if(!e)return Mo(bt);const t=parseFloat(e);return Mo(t)}catch(e){return console.warn("[Blockscape] failed to read selection dimming",e),Mo(bt)}}function Po(e){$n=!!e;const t=$n?Bn:1;return document.documentElement.style.setProperty("--blockscape-selection-dim-applied-opacity",t),C&&C.classList.toggle("blockscape-dimming-disabled",!$n),$n}function Es(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Lt,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist selection dim toggle",t)}}function zc(){if(typeof window>"u"||!window.localStorage)return Po(!0);try{const e=window.localStorage.getItem(Lt);return e==null?Po(!0):Po(e==="1")}catch(e){return console.warn("[Blockscape] failed to read selection dim toggle",e),Po(!0)}}function Vo(e){return ao=!!e,ao}function Ss(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Xr,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist auto-id toggle",t)}}function Jc(){if(typeof window>"u"||!window.localStorage)return Vo(Oi);try{const e=window.localStorage.getItem(Xr);return e==null?Vo(Oi):Vo(e==="1")}catch(e){return console.warn("[Blockscape] failed to read auto-id toggle",e),Vo(Oi)}}function ks(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Hr,String(e))}catch(t){console.warn("[Blockscape] failed to persist tile compactness",t)}}function Kc(){if(typeof window>"u"||!window.localStorage)return Bo(ti);try{const e=window.localStorage.getItem(Hr);if(!e)return Bo(ti);const t=parseFloat(e);return Bo(t)}catch(e){return console.warn("[Blockscape] failed to read tile compactness",e),Bo(ti)}}function Is(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(cn,String(e))}catch(t){console.warn("[Blockscape] failed to persist title hover width",t)}}function Gc(){if(typeof window>"u"||!window.localStorage)return $o(wt);try{const e=window.localStorage.getItem(cn);if(!e)return $o(wt);const t=parseFloat(e);return $o(t)}catch(e){return console.warn("[Blockscape] failed to read title hover width",e),$o(wt)}}function _s(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(st,String(e))}catch(t){console.warn("[Blockscape] failed to persist title text zoom",t)}}function qc(){if(typeof window>"u"||!window.localStorage)return Ro(_n);try{const e=window.localStorage.getItem(st);if(!e)return Ro(_n);const t=parseFloat(e);return Ro(t)}catch(e){return console.warn("[Blockscape] failed to read title text zoom",e),Ro(_n)}}function Cs(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(ut,e)}catch(t){console.warn("[Blockscape] failed to persist title wrap mode",t)}}function Yc(){if(typeof window>"u"||!window.localStorage)return Oo(kt);try{const e=window.localStorage.getItem(ut);return Oo(e||kt)}catch(e){return console.warn("[Blockscape] failed to read title wrap mode",e),Oo(kt)}}function Xc(e){return Number.isFinite(e)?Math.min(ls,Math.max(ss,e)):ri}function Do(e){return Rn=Xc(e),Rn}function Zc(e){en=!!e}function Qc(e){Ft=!!e}function xs(){return{hoverScale:Eo,selectionDimOpacity:Bn,selectionDimEnabled:$n,tileCompactness:So,titleWrapMode:ba,titleHoverWidthMultiplier:ko,titleHoverTextPortion:Io,obsidianLinksEnabled:_o,obsidianLinkMode:oi,obsidianVaultName:Co,autoIdFromNameEnabled:ao,seriesNavDoubleClickWaitMs:Rn,showSecondaryLinks:en,centerItems:on,showReusedInMap:Ft,theme:ii,colorPresets:zt,depColor:Di,revdepColor:Ui,linkThickness:ai}}function As(e,{refreshObsidianLinks:t}={}){return jl(e,{applyTileHoverScale:No,persistTileHoverScale:vs,applySelectionDimEnabled:Po,persistSelectionDimEnabled:Es,applySelectionDimOpacity:Mo,persistSelectionDimOpacity:ys,applyTileCompactness:Bo,persistTileCompactness:ks,applyTitleWrapMode:Oo,persistTitleWrapMode:Cs,applyTitleHoverWidthMultiplier:$o,persistTitleHoverWidthMultiplier:Is,applyTitleHoverTextPortion:Ro,persistTitleHoverTextPortion:_s,applyObsidianLinksEnabled:Ho,persistObsidianLinksEnabled:Ns,applyObsidianLinkMode:Uo,persistObsidianLinkMode:Ls,applyObsidianVaultName:Fo,persistObsidianVaultName:Ms,applyAutoIdFromNameEnabled:Vo,persistAutoIdFromNameEnabled:Ss,applySeriesNavDoubleClickWait:Do,persistSeriesNavDoubleClickWait:Ts,localBackend:Ke,ui:Ae,refreshObsidianLinks:t,scheduleOverlaySync:zo,selection:K,select:Nt,clearStyles:Xi,drawLinks:Sn,applyReusedHighlights:Da,setShowSecondaryLinks:Zc,setShowReusedInMap:Qc,applyDepColor:Sa,persistDepColor:ya,applyRevdepColor:ka,persistRevdepColor:Ea,applyLinkThickness:si,persistLinkThickness:Ia,applyTheme:wa,setColorPresets:Lo,applyCenterItems:Ao,persistCenterItems:ps,current:xs()})}function Ts(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(rs,String(e))}catch(t){console.warn("[Blockscape] failed to persist series double-click wait",t)}}function ed(){if(typeof window>"u"||!window.localStorage)return Do(ri);try{const e=window.localStorage.getItem(rs);if(!e)return Do(ri);const t=parseInt(e,10);return Do(t)}catch(e){return console.warn("[Blockscape] failed to read series double-click wait",e),Do(ri)}}function td(e){return e===$i?$i:ga}function Uo(e){return oi=td(e),oi}function Ls(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(zr,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian link mode",t)}}function nd(){if(typeof window>"u"||!window.localStorage)return Uo(Ri);try{const e=window.localStorage.getItem(zr);return Uo(e||Ri)}catch(e){return console.warn("[Blockscape] failed to read Obsidian link mode",e),Uo(Ri)}}function Ho(e){return _o=!!e,_o}function Ns(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(jr,e?"1":"0")}catch(t){console.warn("[Blockscape] failed to persist Obsidian toggle",t)}}function od(){if(typeof window>"u"||!window.localStorage)return Ho(!1);try{const e=window.localStorage.getItem(jr);return e==null?Ho(!1):Ho(e==="1")}catch(e){return console.warn("[Blockscape] failed to read Obsidian toggle",e),Ho(!1)}}function Fo(e){return Co=(e??"").toString().trim(),Co}function Ms(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(Jr,e)}catch(t){console.warn("[Blockscape] failed to persist Obsidian vault",t)}}function id(){if(typeof window>"u"||!window.localStorage)return Fo("");try{const e=window.localStorage.getItem(Jr);return Fo(e||"")}catch(e){return console.warn("[Blockscape] failed to read Obsidian vault",e),Fo("")}}function ad(e){return typeof window>"u"||typeof window.prompt!="function"?null:(window.prompt("Name this series",e)||"").trim()||null}function rd(e,t="Pasted"){const n=Array.isArray(e)?e:[];if(!n.length)return`${t} series`;const o=n.find(a=>a&&typeof a=="object")||n[0];return((o==null?void 0:o.title)??"").toString().trim()||`${t} series`}function lo(e,t){!t||!e||typeof e!="object"||(e.seriesId=t,e.apicurioArtifactId=t,e.id=t,e.data&&typeof e.data=="object"&&(e.data.seriesId=t),Array.isArray(e.apicurioVersions)&&e.apicurioVersions.forEach(n=>{n!=null&&n.data&&typeof n.data=="object"&&(n.data.seriesId=t)}))}function sd(e){if(!e||typeof window>"u"||typeof window.prompt!="function")return!1;const t=(e.title??e.apicurioArtifactName??"").toString().trim()||Wi(e,"Series"),n=window.prompt("Series name",t);if(n==null)return!1;const o=n.trim();if(!o)return!1;const i=Ln(e,{seriesName:o,fallbackTitle:o})||wn(o,o),a=window.prompt("Series ID (used for linking and downloads)",i);if(a==null)return!1;const s=wn(a.trim()||o,o||"series");return e.title=o,e.apicurioArtifactName=o,lo(e,s),!0}function xa(e){return e===null||typeof e!="object"?JSON.stringify(e):Array.isArray(e)?`[${e.map(o=>xa(o)).join(",")}]`:`{${Object.keys(e).sort().map(o=>`${JSON.stringify(o)}:${xa(e[o])}`).join(",")}}`}function Bs(e){try{return xa(e)}catch{return""}}function Fi(e){try{const t=typeof e=="string"?JSON.parse(e):e,n=Bs(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint parse failed (first pass)",t)}try{const t=JSON.parse(JSON.stringify(e)),n=Bs(t);if(n)return n}catch(t){console.warn("[Blockscape] fingerprint failed for value",t)}try{return JSON.stringify(e)||""}catch{return""}}const ld=[{keys:[["Arrow Left"],["Arrow Right"]],description:"Move selection to the previous or next item in the current category."},{keys:[["Arrow Up"],["Arrow Down"]],description:"Move up/down through items, pausing on category headers before entering the next category at the same relative position."},{keys:[["Cmd/Ctrl","Arrow Up"],["Cmd/Ctrl","Arrow Down"]],description:"Reorder the selected category (or the category that holds the selected item)."},{keys:[["Shift","Arrow Left"],["Shift","Arrow Right"]],description:"Reorder the selected item inside its category."},{keys:[["Shift","Arrow Up"],["Shift","Arrow Down"]],description:"Move the selected item to the previous or next category."},{keys:[["Cmd/Ctrl","Arrow Left"],["Cmd/Ctrl","Arrow Right"]],description:"Switch to the previous or next map when viewing a series."},{keys:[["Cmd/Ctrl","Z"]],description:"Undo the last deleted tile or category."},{keys:[["Cmd/Ctrl","S"]],description:"Download the active model JSON (series if multiple versions are open)."},{keys:[["Cmd/Ctrl","V"]],description:"Append JSON models from the clipboard when focus is outside inputs."},{keys:[["Enter"],["Space"]],description:"Activate a focused tile, same as clicking it."},{keys:[["F2"]],description:"Edit the selected item; when a category (not an item) is selected, open the category editor."},{keys:[["Delete"]],description:"Delete the selected item or category (use Cmd/Ctrl+Z to undo)."},{keys:[["Insert"]],description:"Add a new category at the bottom of the map."},{keys:[["Escape"]],description:"Unselect item or close the open preview popover."}];function Cn(e,{titleHint:t="Untitled Model",idHint:n}={}){if(!e||typeof e!="object")return e;const o=(e.title??"").toString().trim();e.title=o||t||"Untitled Model";const i=(e.id??"").toString().trim();if(i)e.id=i;else{const a=n||e.title||t||"model",s=Jt(a).replace(/\./g,"-");e.id=s||`model-${ro()}`}return typeof e.abstract!="string"&&(e.abstract=e.abstract==null?"":String(e.abstract)),e}function cd(e){var s,l;const t=u=>{const h=(u??"").toString().trim();if(!h)return{base:"",suffix:null};const b=h.match(/^(.*?)-(\d+)$/);return{base:b?b[1]:h,suffix:b?Number.parseInt(b[2],10):null}},n=Array.isArray(e==null?void 0:e.apicurioVersions)?e.apicurioVersions:[],o=(((s=e==null?void 0:e.data)==null?void 0:s.id)??"").toString().trim();let i=t(o).base;if(!i)for(const u of n){if(u!=null&&u.isCategoryView)continue;const h=t(((l=u==null?void 0:u.data)==null?void 0:l.id)??(u==null?void 0:u.id)??"");if(h.base){i=h.base;break}}i||(i=Jt(Ln(e)||Aa(e)||Je(e,"model")));let a=0;return n.forEach(u=>{var b;if(u!=null&&u.isCategoryView)return;const h=t(((b=u==null?void 0:u.data)==null?void 0:b.id)??(u==null?void 0:u.id)??"");h.base===i&&Number.isFinite(h.suffix)&&h.suffix>a&&(a=h.suffix)}),`${i}-${String(a+1).padStart(2,"0")}`}function dd(e){return JSON.parse(JSON.stringify(e))}function Je(e,t="Untitled Model"){var o;return e&&(((o=e.data)==null?void 0:o.title)??e.title??"").toString().trim()||t}function Wi(e,t="Untitled Model"){var o;if(((o=e==null?void 0:e.apicurioVersions)==null?void 0:o.length)>1||(e==null?void 0:e.isSeries)){const i=((e==null?void 0:e.title)??"").toString().trim()||((e==null?void 0:e.apicurioArtifactName)??"").toString().trim();if(i)return i;const a=dt(e);return a?`${a} series`:t}return Je(e,t)}function dt(e){var i;const t=Ln(e);if(t)return t;const n=(i=e==null?void 0:e.data)==null?void 0:i.id;return n&&n.toString().trim()||null}function Aa(e){if(!(e!=null&&e.sourcePath))return null;try{const t=e.sourcePath.split("/").filter(Boolean);return(t.length?t[t.length-1]:e.sourcePath).replace(/\.bs$/i,"")}catch{return e.sourcePath.replace(/\.bs$/i,"")}}function ud(e){return e?e.toString().replace(/-series$/i,""):null}function Ta(e){if(!e)return-1;const t=e.toString().trim().toLowerCase();if(!t)return-1;for(let n=0;n<S.length;n++){const o=(dt(S[n])||"").toLowerCase(),i=(Aa(S[n])||"").toLowerCase();if(t===o||t===i)return n}return-1}function $s(e){var l;if(e<0||e>=S.length||!f)return!0;const t=S[e],n=(f.value||"").trim();if(!n)return!0;let o;try{o=JSON.parse(n)}catch{return alert("Current JSON is invalid. Fix it before switching versions."),!1}Cn(o,{titleHint:Je(t),idHint:dt(t)});const i=Fi(t.data),a=Fi(o);if(i===a)return!0;t.data=o;const s=Dn(t);return s>=0&&((l=t.apicurioVersions)!=null&&l[s])&&(t.apicurioVersions[s].data=o),!0}function Rs(e){const t=new Set;return((e==null?void 0:e.categories)||[]).forEach(n=>(n.items||[]).forEach(o=>{o!=null&&o.id&&t.add(o.id)})),t}function La(e){if(g<0||!e)return null;const t=S[g].data,n=(t==null?void 0:t.categories)||[];for(const o of n){const a=(o.items||[]).find(s=>s.id===e);if(a)return{category:o,item:a,modelData:t}}return null}function pd(e,t){const n=La(e);return n?(t?n.item.color=t:delete n.item.color,Pt(),Mt(),Nt(e),!0):!1}function fd(e,t){const n=Rs(t);let o=Jt(e||"item");if(!n.has(o))return o;const i=()=>ro().slice(0,4);for(;n.has(o);)o=`${Jt(e||"item")}-${i()}`;return o}function md(e="category",t){const n=(t==null?void 0:t.categories)||[],o=Jt(e||"category"),i=l=>n.some(u=>u.id===l);let a=o||`category-${ro()}`;if(!i(a))return a;let s=n.length+1;for(;i(`${o}-${s}`);)s+=1;return`${o}-${s}`}const co=Hl({findItemAndCategoryById:La,collectAllItemIds:Rs,updateItemReferences:Ul,loadActiveIntoEditor:Pt,rebuildFromActive:Mt,select:e=>Nt(e),onSelectionRenamed:(e,t)=>{var n;K===e&&(K=t,Kt()),((n=Wt==null?void 0:Wt.item)==null?void 0:n.id)===e&&(Wt.item.id=t)},makeSlug:Jt,isAutoIdFromNameEnabled:()=>ao});function hd({getActiveModelData:e,loadActiveIntoEditor:t,rebuildFromActive:n,selectCategory:o,onCategoryRenamed:i}){const a={wrapper:null,fields:{},categoryId:null,modelData:null,idManuallyEdited:!1,autoSyncEnabled:!0},s=B=>{if(a.fields.errorEl){if(!B){a.fields.errorEl.hidden=!0,a.fields.errorEl.textContent="";return}a.fields.errorEl.hidden=!1,a.fields.errorEl.textContent=B}},l=()=>{a.wrapper&&(a.wrapper.hidden=!0,a.wrapper.setAttribute("aria-hidden","true"),s(""),a.categoryId=null,a.modelData=null,document.body.classList.remove("category-editor-open"))},u=()=>{a.wrapper&&(a.wrapper.hidden=!1,a.wrapper.setAttribute("aria-hidden","false"),document.body.classList.add("category-editor-open"),requestAnimationFrame(()=>{var B,P;(B=a.fields.titleInput)==null||B.focus(),(P=a.fields.titleInput)==null||P.select()}))},h=({force:B}={})=>{var oe,Be;if(!ao||!a.autoSyncEnabled||!((oe=a.fields)!=null&&oe.idInput)||!((Be=a.fields)!=null&&Be.titleInput)||!B&&a.idManuallyEdited)return;const P=Jt(a.fields.titleInput.value||a.categoryId||"category");a.fields.idInput.value=P},b=()=>{if(!a.modelData||!a.categoryId)throw new Error("No category loaded.");const B=a.modelData.categories||[],P=B.find(Ne=>Ne.id===a.categoryId);if(!P)throw new Error("Category not found.");const oe=(a.fields.idInput.value||"").trim();if(!oe)throw new Error("ID is required.");const Be=(a.fields.titleInput.value||"").trim();if(B.some(Ne=>Ne.id===oe&&Ne.id!==P.id))throw new Error("Another category already uses that ID.");const Ce=P.id;return P.id=oe,P.title=Be||P.id,Ce!==oe&&typeof i=="function"&&i(Ce,oe),t(),n(),o(oe,{scrollIntoView:!0}),!0},T=()=>{try{return b(),l(),!0}catch(B){return console.warn("[CategoryEditor] save failed",B),s((B==null?void 0:B.message)||"Unable to save category."),!1}},D=()=>{if(a.wrapper)return a.wrapper;const B=document.createElement("div");B.className="item-editor-modal category-editor-modal",B.hidden=!0,B.setAttribute("role","dialog"),B.setAttribute("aria-modal","true");const P=document.createElement("div");P.className="item-editor-modal__backdrop",B.appendChild(P);const oe=document.createElement("div");oe.className="item-editor",B.appendChild(oe);const Be=document.createElement("div");Be.className="item-editor__header";const lt=document.createElement("h2");lt.className="item-editor__title",lt.textContent="Edit category";const Ce=document.createElement("button");Ce.type="button",Ce.className="item-editor__close",Ce.setAttribute("aria-label","Close category editor"),Ce.textContent="×",Be.appendChild(lt),Be.appendChild(Ce),oe.appendChild(Be);const Ne=document.createElement("form");Ne.className="item-editor__form",oe.appendChild(Ne);const it=document.createElement("div");it.className="item-editor__meta",it.innerHTML='<div class="item-editor__meta-label">Category</div><div class="item-editor__meta-value"></div>',Ne.appendChild(it);const De=document.createElement("div");De.className="item-editor__error",De.hidden=!0,Ne.appendChild(De);const _t=(An,fo,Go)=>{const an=document.createElement("label");an.className="item-editor__field";const mo=document.createElement("span");if(mo.className="item-editor__label",mo.textContent=An,an.appendChild(mo),fo.classList.add("item-editor__control"),an.appendChild(fo),Go){const un=document.createElement("div");un.className="item-editor__hint",un.textContent=Go,an.appendChild(un)}return an},Vt=document.createElement("input");Vt.type="text",Ne.appendChild(_t("Title",Vt,"Display label shown in the map."));const Ct=document.createElement("input");Ct.type="text",Ct.required=!0,Ne.appendChild(_t("ID",Ct,"Unique identifier for this category (used in URLs and references)."));const xe=document.createElement("div");xe.className="item-editor__checkbox";const vt=document.createElement("label");vt.className="item-editor__checkbox-row";const kn=document.createElement("input");kn.type="checkbox";const Fn=document.createElement("span");Fn.textContent="Sync ID while editing title";const xt=document.createElement("div");xt.className="item-editor__hint",xt.textContent="Turn off to keep typing titles without changing the ID.",vt.append(kn,Fn),xe.append(vt,xt),Ne.appendChild(xe);const Qt=document.createElement("div");Qt.className="item-editor__actions";const Gt=document.createElement("button");Gt.type="submit",Gt.className="item-editor__action item-editor__action--primary",Gt.textContent="Save";const Ve=document.createElement("button");return Ve.type="button",Ve.className="item-editor__action",Ve.textContent="Cancel",Qt.appendChild(Gt),Qt.appendChild(Ve),Ne.appendChild(Qt),Ne.addEventListener("submit",An=>{An.preventDefault(),T()}),Ve.addEventListener("click",l),Ce.addEventListener("click",l),P.addEventListener("click",l),Ct.addEventListener("input",()=>{a.idManuallyEdited=!0}),Vt.addEventListener("input",()=>h()),kn.addEventListener("change",()=>{a.autoSyncEnabled=!!kn.checked,a.autoSyncEnabled&&(a.idManuallyEdited=!1,h({force:!0}))}),B.addEventListener("keydown",An=>{An.key==="Escape"&&(An.preventDefault(),l())}),document.body.appendChild(B),a.wrapper=B,a.fields={titleInput:Vt,idInput:Ct,errorEl:De,metaLabel:it.querySelector(".item-editor__meta-value"),syncCheckbox:kn},B};return{open:B=>{if(!B||!D())return!1;const oe=e(),lt=((oe==null?void 0:oe.categories)||[]).find(Ne=>Ne.id===B);if(!lt)return!1;a.categoryId=lt.id,a.modelData=oe,a.idManuallyEdited=!1;const Ce=!!ao;return a.autoSyncEnabled=Ce,a.fields.metaLabel.textContent=lt.title||lt.id||"Category",a.fields.titleInput.value=lt.title||lt.id||"",a.fields.idInput.value=lt.id||"",a.fields.syncCheckbox.checked=a.autoSyncEnabled,a.fields.syncCheckbox.disabled=!Ce,!a.fields.idInput.value&&Ce&&h({force:!0}),s(""),u(),!0},hide:l,isOpen:()=>!!a.wrapper&&a.wrapper.hidden===!1}}const gd=hd({getActiveModelData:()=>{var e;return(e=S[g])==null?void 0:e.data},loadActiveIntoEditor:Pt,rebuildFromActive:Mt,selectCategory:(e,t={})=>Un(e,t),onCategoryRenamed:(e,t)=>{Fe===e&&(Fe=t,Kt())}}),{handleTileContextMenu:bd,hidePreview:uo,handleDocumentClick:wd,handleWindowResize:vd,handleWindowScroll:yd,updateColorPresets:Wo}=Fl({menuEl:document.getElementById("tileContextMenu"),previewEl:te,previewTitleEl:ae,previewBodyEl:Me,previewActionsEl:tt,previewCloseEl:Ge,escapeHtml:pi,onEditItem:e=>co.open(e),onChangeColor:(e,t)=>pd(e,t),selectItem:e=>Nt(e),colorPresets:zt});function ji(e,{versionLabel:t="1",createdOn:n}={}){if(!e)return e;if(Array.isArray(e.apicurioVersions)&&e.apicurioVersions.length)return e.apicurioActiveVersionIndex==null&&(e.apicurioActiveVersionIndex=0),!e.data&&e.apicurioVersions[e.apicurioActiveVersionIndex]&&(e.data=e.apicurioVersions[e.apicurioActiveVersionIndex].data),e;const o={version:t,data:e.data,createdOn:n||new Date().toISOString()};e.apicurioVersions=[o],e.apicurioActiveVersionIndex=0;const i=e.title||Je(e);return $t(e,{seriesName:i,fallbackTitle:i}),e.isSeries=!0,e}function Ed({seriesId:e=null,mapTitle:t="Blank map"}={}){const n=Jt(`${e||"blank"}-${Ca()}`),o={id:n,title:t,categories:[],abstract:""};return e&&(o.seriesId=e),Cn(o,{titleHint:t,idHint:n}),o}function Sd(){const t=`Blank series ${Ca()}`,n=wn(t,"blank-series"),o=Ed({seriesId:n,mapTitle:"Blank map"}),i={id:n,title:t,apicurioArtifactName:t,data:o,apicurioVersions:[{version:"1",data:o,createdOn:new Date().toISOString()}],apicurioActiveVersionIndex:0,isSeries:!0};return lo(i,n),$t(i,{seriesName:t,fallbackTitle:t}),i}function kd(){const e=Sd(),t=xn(e,{versionLabel:"blank"});return It(t),Ji(),On("Blank series created. Add categories and tiles to start.",2600),t}function xn(e,{versionLabel:t,createdOn:n}={}){var u,h,b;if(e!=null&&e.isSeries||((u=e==null?void 0:e.apicurioVersions)==null?void 0:u.length)>1){const T=e.title||Je(e);$t(e,{seriesName:T,fallbackTitle:T}),Ki(e)}const o=dt(e);if(!o)return ji(e,{versionLabel:t||"1",createdOn:n}),S.push(e),S.length-1;const i=S.findIndex(T=>dt(T)===o);if(i===-1)return ji(e,{versionLabel:t||"1",createdOn:n}),S.push(e),S.length-1;const a=S[i];if(!Array.isArray(a.apicurioVersions)||!a.apicurioVersions.length){a.apicurioVersions=[{version:"1",data:a.data,createdOn:(b=(h=a.apicurioVersions)==null?void 0:h[0])==null?void 0:b.createdOn}],a.apicurioActiveVersionIndex=0;const T=a.title||Je(a);$t(a,{seriesName:T,fallbackTitle:T})}const s=String(a.apicurioVersions.length+1);a.apicurioVersions.push({version:s,data:e.data,createdOn:n||new Date().toISOString()}),a.apicurioActiveVersionIndex=a.apicurioVersions.length-1,a.data=e.data,a.title=Je(e)||a.title,a.isSeries=!0;const l=a.title||Je(a);return $t(a,{seriesName:l,fallbackTitle:l}),i}function Os({versionLabel:e}={}){var l;if(g<0||!S[g])throw new Error("Load or select a model before creating a version.");const t=S[g];ji(t,{versionLabel:"1"});const n=cd(t);let o;try{o=dd(t.data)}catch(u){throw console.warn("[Blockscape] failed to clone active model for versioning",u),new Error("Could not copy the current model.")}n&&(o.id=n),Cn(o,{titleHint:Je(t),idHint:dt(t)||Ln(t)});const a={version:e||String((((l=t.apicurioVersions)==null?void 0:l.length)||0)+1),data:o,createdOn:new Date().toISOString()};t.apicurioVersions.push(a),t.apicurioActiveVersionIndex=t.apicurioVersions.length-1,t.data=o,t.isSeries=!0;const s=t.title||Je(t);return $t(t,{seriesName:s,fallbackTitle:s}),g}function Na(){const e=g>=0&&S[g]?S[g]:null,t=dt(e);document.title=t?`${t}-blockscape`:ht}function zi(e){if(!e)return null;Ki(e);const t=e.apicurioVersions;if(!Array.isArray(t)||t.length<=1)return null;const n=e.title||e.apicurioArtifactName||Je(e);return $t(e,{seriesName:n,fallbackTitle:n}),t.filter((i,a)=>{var u;const s=((i==null?void 0:i.version)??"").toString().trim(),l=(((u=i==null?void 0:i.data)==null?void 0:u.id)??(i==null?void 0:i.id)??"").toString().trim();return i!=null&&i.isCategoryView||s.startsWith(Pi)?(console.log("[Blockscape] not saving computed map",{versionIndex:a,versionId:s,dataId:l}),!1):!0}).map(i=>i&&typeof i=="object"&&"data"in i?i.data:i)}function Id(){const e=S[g],t=zi(e);if(!t)return null;try{return JSON.stringify(t,null,2)}catch(n){return console.warn("[Blockscape] failed to stringify series",n),null}}function Ps(e="shortcut",t=!1){const n=f.value||"";if(!n.trim())return console.warn("[Blockscape] download ignored: JSON box is empty."),!1;const o=S[g],i=t?zi(o):null,a=!!i,s=a?JSON.stringify(i,null,2):n,l=Ln(o),u=dt(o),h=l||u||Je(o,"blockscape"),b=a?"-series":"",T=`${Jt(h)}${b}.bs`;return ds(T,s),console.log(`[Blockscape] saved JSON (${e}):`,T),!0}const _d=Bt.palette.letter,Cd=Bt.palette.letterFallback;function Vs(e,t){if(t&&/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(t))return t;const n=(e||"?").charAt(0).toUpperCase();return _d[n]||Cd}function xd(e){const t=e.replace("#",""),n=t.length===3?t.split("").map(u=>u+u).join(""):t,o=parseInt(n,16),i=o>>16&255,a=o>>8&255,s=o&255;return .2126*Math.pow(i/255,2.2)+.7152*Math.pow(a/255,2.2)+.0722*Math.pow(s/255,2.2)>.35?Bt.color.ink:Bt.color.white}function Ad(){if(!(typeof window>"u"||typeof window.scrollTo!="function"))try{window.scrollTo({top:0,behavior:"smooth"})}catch{window.scrollTo(0,0)}}function Ma(){if(jt)return;jt=document.createElement("div"),jt.className="series-nav-notice";const e=document.createElement("span");e.className="series-nav-notice__dot",St=document.createElement("span"),St.className="series-nav-notice__text",jt.appendChild(e),jt.appendChild(St),document.body.appendChild(jt)}function Ba(){tn&&(clearTimeout(tn),tn=null),jt&&jt.classList.remove("is-visible"),St&&(St.textContent="")}function jo(){Ot=null,Xt&&(clearTimeout(Xt),Xt=null),Ba()}function $a(){vn=null,Zt&&(clearTimeout(Zt),Zt=null),Ba()}function Td(e,t){var o;if(!((o=e==null?void 0:e.apicurioVersions)!=null&&o[t]))return`version ${t+1}`;const n=e.apicurioVersions[t].version;return n?`version "${n}"`:`version ${t+1}`}function Ld(e,t,n){Ma(),Ot={id:e,targetVersionIndex:t},Xt&&clearTimeout(Xt),Xt=setTimeout(()=>{Xt=null,jo()},Rn);const o=Td(n,t);On(`Click again to open ${o} in this series.`,Rn)}function Nd(e,t){Ma(),vn={id:e,targetIndex:t},Zt&&clearTimeout(Zt),Zt=setTimeout(()=>{Zt=null,$a()},Rn);const n=Wi(S[t]);On(`Click again to open "${n}".`,Rn)}function On(e,t=Kn,n=null){if(Ma(),St.textContent="",St.appendChild(document.createTextNode(e)),n){const o=document.createTextNode(" "),i=document.createElement("a");i.href=n,i.target="_blank",i.rel="noopener",i.textContent=n,St.appendChild(o),St.appendChild(i)}jt.classList.add("is-visible"),tn&&clearTimeout(tn),tn=setTimeout(()=>Ba(),t)}function Md(){ve&&(ve.innerHTML="",ld.forEach(e=>{const t=document.createElement("div");t.className="shortcut-help__row";const n=document.createElement("div");n.className="shortcut-help__keys",e.keys.forEach((i,a)=>{if(a>0){const l=document.createElement("span");l.className="shortcut-help__or",l.textContent="or",n.appendChild(l)}const s=document.createElement("div");s.className="shortcut-help__combo",i.forEach((l,u)=>{if(u>0){const b=document.createElement("span");b.className="shortcut-help__sep",b.textContent="+",s.appendChild(b)}const h=document.createElement("kbd");h.className="shortcut-help__key",h.textContent=l,s.appendChild(h)}),n.appendChild(s)});const o=document.createElement("div");o.className="shortcut-help__desc",o.textContent=e.description,t.appendChild(n),t.appendChild(o),ve.appendChild(t)}),no=!0)}function Bd(){return!!se&&se.hidden===!1}function $d(){if(!se)return;no||Md(),Mn=document.activeElement,se.hidden=!1,se.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=se.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Ra(){if(!se||se.hidden)return;se.hidden=!0,se.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open");const e=Mn;e!=null&&e.focus?e.focus({preventScroll:!0}):Oe!=null&&Oe.focus&&Oe.focus({preventScroll:!0})}function Rd(){if(!Z)return;Z.hidden=!1,Z.setAttribute("aria-hidden","false"),document.body.classList.add("shortcut-help-open");const e=Z.querySelector(".shortcut-help__panel");e==null||e.focus({preventScroll:!0})}function Ji(){!Z||Z.hidden||(Z.hidden=!0,Z.setAttribute("aria-hidden","true"),document.body.classList.remove("shortcut-help-open"),pe!=null&&pe.focus&&pe.focus({preventScroll:!0}))}let Oa=!1;function zo(){Oa||(Oa=!0,requestAnimationFrame(()=>{Oa=!1,qi(),Sn()}))}let Ds=!1;function Us(e){return(e||"").toString().toLowerCase().split(/\s+/).map(t=>t.trim()).filter(Boolean)}function Od(e){const t=Us(e);if(!t.length){C.querySelectorAll(".tile").forEach(n=>{n.style.opacity=""});return}C.querySelectorAll(".tile").forEach(n=>{var s;const o=(((s=n.querySelector(".name"))==null?void 0:s.textContent)||"").toLowerCase(),i=(n.dataset.id||"").toLowerCase(),a=t.every(l=>o.includes(l)||i.includes(l));n.style.opacity=a?"1":"0.2"})}function Pd(e){const t=Us(e);if(!t.length)return[];const n=[];return S.forEach((o,i)=>{var h;const a=Wi(o),s=dt(o)||"",l=`${a} ${s}`.toLowerCase();t.every(b=>l.includes(b))&&n.push({type:"model",modelIndex:i,modelTitle:a,modelId:s}),(Array.isArray((h=o.data)==null?void 0:h.categories)?o.data.categories:[]).forEach(b=>{const T=(b.title||b.id||"").toString();(b.items||[]).forEach(D=>{const L=(D.name||D.id||"").toString(),B=`${L} ${D.id||""} ${T}`.toLowerCase();t.every(P=>B.includes(P))&&n.push({type:"item",modelIndex:i,modelTitle:a,modelId:s,itemId:D.id,itemName:L,categoryTitle:T})})})}),n.slice(0,q)}function Hs(e){if(!ge)return;ge.innerHTML="";const t=(e||"").toString();if(!t.trim()){ge.hidden=!0;return}if(!S.length){const o=document.createElement("div");o.className="search-results__empty",o.textContent="Load models to search",ge.appendChild(o),ge.hidden=!1;return}const n=Pd(t);if(!n.length){const o=document.createElement("div");o.className="search-results__empty",o.textContent="No matches yet",ge.appendChild(o),ge.hidden=!1;return}n.forEach(o=>{const i=document.createElement("button");i.type="button",i.className="search-result",i.dataset.modelIndex=String(o.modelIndex),o.itemId&&(i.dataset.itemId=o.itemId),o.type&&(i.dataset.type=o.type),o.modelIndex===g&&(!o.itemId||K===o.itemId)&&i.classList.add("is-active");const a=document.createElement("div");a.className="search-result__primary";const s=document.createElement("span");s.textContent=o.type==="model"?o.modelTitle:o.itemName||o.itemId||"Item",a.appendChild(s);const l=document.createElement("span");l.className="search-result__badge",l.textContent=o.type==="item"?o.categoryTitle||"Item":"Model",a.appendChild(l);const u=document.createElement("div");u.className="search-result__meta";const h=document.createElement("span");if(h.textContent=o.modelId?`${o.modelTitle} · ${o.modelId}`:o.modelTitle,u.appendChild(h),o.type==="item"&&o.itemId){const b=document.createElement("span");b.textContent=`Item ID: ${o.itemId}`,u.appendChild(b)}else if(o.type==="model"){const b=document.createElement("span");b.textContent="Matches model title",u.appendChild(b)}i.appendChild(a),i.appendChild(u),ge.appendChild(i)}),ge.hidden=!1}function Fs(e){Od(e||""),Hs(e||"")}function Vd(e){!e||!Number.isInteger(e.modelIndex)||(It(e.modelIndex),e.itemId&&requestAnimationFrame(()=>{var n;if(g!==e.modelIndex)return;const t=(n=fe.get(e.itemId))==null?void 0:n.el;t&&(Nt(e.itemId),t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),t.focus({preventScroll:!0}))}))}function It(e){var t;if(uo(),jo(),Wt=null,Rt=null,Fe=null,ot=null,e<0||e>=S.length){console.warn("[Blockscape] setActive called with out-of-range index:",e);return}if(d=!0,g=e,console.log("[Blockscape] active model:",Je(S[e]),"(index",e+" )"),typeof(Ke==null?void 0:Ke.highlightSource)=="function"){const n=((t=S[e])==null?void 0:t.sourcePath)||null;Ke.highlightSource(n)}Na(),Pn(),Pt(),Mt(),ke&&Fs(ke.value||""),Ke.updateActiveSavePlaceholder(),Le.updateAvailability(),_a()}function Pn(){if(J.innerHTML="",!S.length){const e=document.createElement("li");e.className="model-nav-empty",e.textContent="No models loaded yet.",J.appendChild(e);return}S.forEach((e,t)=>{var T;const n=document.createElement("li");n.className="model-nav-item";const o=document.createElement("button");o.type="button",o.className="model-nav-button"+(t===g?" is-active":""),o.dataset.index=String(t),o.setAttribute("aria-current",t===g?"true":"false");const i=document.createElement("span");i.className="model-nav-label";const a=document.createElement("span");a.className="model-nav-title",a.textContent=Wi(e),i.appendChild(a);const s=ud(Aa(e)||dt(e));if(s){const D=document.createElement("span");D.className="model-nav-id",D.textContent=s,i.appendChild(D)}const l=Array.isArray((T=e.data)==null?void 0:T.categories)?e.data.categories:[],u=l.reduce((D,L)=>D+(L.items||[]).length,0),h=document.createElement("span");h.className="model-nav-meta";const b=e.apicurioVersions&&e.apicurioVersions.length>1?` · ${e.apicurioVersions.length} maps`:"";h.textContent=`${l.length} cat · ${u} items${b}`,o.appendChild(i),o.appendChild(h),n.appendChild(o),J.appendChild(n)}),Le.updateAvailability()}function Pt(){if(g<0){f.value="",R&&(R.disabled=!0);return}const e=S[g];f.value=JSON.stringify(e.data,null,2),R&&(R.disabled=!zi(e))}function Dd(e){try{return JSON.parse(e)}catch{return null}}function Ws(e){if(typeof e!="string")return e;const t=e.trim().match(/^```[a-zA-Z0-9_-]*\s*\r?\n([\s\S]*?)\r?\n```$/);return t?t[1]:e}function Ud(e){const t=((e==null?void 0:e.apicurioVersions)||[]).filter(s=>!(s!=null&&s.isCategoryView));if(t.length<2)return[];const n=new Map;t.forEach((s,l)=>{const u=s==null?void 0:s.data;if(!u||!Array.isArray(u.categories))return;const h=Je(u,`Map ${l+1}`),b=(u.id??"").toString().trim()||Jt(h||`map-${l+1}`),T=Jt(b||h||`map-${l+1}`);u.categories.forEach(D=>{const L=((D==null?void 0:D.id)??"").toString().trim();if(!L)return;n.has(L)||n.set(L,{catTitle:D.title||L,sources:[]});const B=n.get(L);!B.catTitle&&(D.title||L)&&(B.catTitle=D.title||L),B.sources.push({category:D,mapId:b,mapTitle:h,mapSlug:T,versionIndex:l})})});const o=Ln(e)||null,i=(e==null?void 0:e.title)||(e==null?void 0:e.apicurioArtifactName)||Je(e,"Series"),a=[];return n.forEach((s,l)=>{var D;if((((D=s.sources)==null?void 0:D.length)||0)<2)return;const u=s.catTitle||l,h=new Set,b=s.sources.map(L=>{var lt;let P=L.mapSlug||Jt(L.mapTitle||L.mapId)||`map-${L.versionIndex+1}`;h.has(P)&&(P=`${P}-${L.versionIndex+1}`),h.add(P);const oe=new Map,Be=(((lt=L.category)==null?void 0:lt.items)||[]).map((Ce,Ne)=>{const it=((Ce==null?void 0:Ce.id)??"").toString().trim()||`item-${Ne+1}`,De=`${P}-${it}`;oe.set(it,De);const _t={...Ce,id:De};return _t.deps=Array.isArray(Ce==null?void 0:Ce.deps)?[...Ce.deps]:[],_t});return Be.forEach(Ce=>{Ce.deps=(Ce.deps||[]).map(Ne=>oe.get(Ne)).filter(Boolean)}),{id:P,title:L.mapTitle||L.mapId||`Map ${L.versionIndex+1}`,items:Be}}),T={id:Jt(`${l}-category-view`),title:u,abstract:`Items from "${u}" across ${s.sources.length} maps in this series${i?` (${i})`:""}.`,categories:b};o&&(T.seriesId=o),Cn(T,{titleHint:u,idHint:`${o||"series"}-${l}`}),a.push({version:`${Pi}${l}`,data:T,isCategoryView:!0,categoryViewKey:l})}),a}function js(e){var o;if(!e)return null;if(e.isCategoryView&&e.categoryViewKey)return`${Pi}${e.categoryViewKey}`;const t=(((o=e.data)==null?void 0:o.id)??e.id??"").toString().trim();return t||(e.version??"").toString().trim()||null}function Ki(e){var s;if(!((s=e==null?void 0:e.apicurioVersions)!=null&&s.length))return e;const t=js(e.apicurioVersions[e.apicurioActiveVersionIndex]),n=e.apicurioVersions.filter(l=>!(l!=null&&l.isCategoryView));if(!n.length)return e;if(n.length<2){e.apicurioVersions=n,e.apicurioActiveVersionIndex=Math.max(0,Math.min(Dn(e),e.apicurioVersions.length-1));const l=e.apicurioVersions[e.apicurioActiveVersionIndex];return l!=null&&l.data&&(e.data=l.data),e}const o=Ud({...e,apicurioVersions:n});e.apicurioVersions=[...n,...o];let i=e.apicurioVersions.findIndex(l=>js(l)===t);i===-1&&(i=Math.min(e.apicurioActiveVersionIndex||0,e.apicurioVersions.length-1)),e.apicurioActiveVersionIndex=Math.max(i,0);const a=e.apicurioVersions[e.apicurioActiveVersionIndex];return a!=null&&a.data&&(e.data=a.data),e}function Hd(e,t="Pasted",n={}){const o=Array.isArray(e)?e:[];if(!o.length)return[];const i=o.map((b,T)=>!b||typeof b!="object"?null:(Cn(b,{titleHint:`${t} #${T+1}`}),{obj:b,idx:T})).filter(Boolean);if(!i.length)return[];const a=i[0].obj,{seriesTitleOverride:s}=n;let l=s||a.title||`${t} series`;s&&!a.title&&(a.title=s);const u={id:ro(),title:l,data:a,apicurioVersions:i.map(({obj:b,idx:T})=>({version:String(T+1),data:b})),apicurioActiveVersionIndex:0,isSeries:!0},h=$t(u,{seriesName:l,fallbackTitle:l});return h&&(u.id=h),Ki(u),[u]}function zs(e,t="Pasted",n={}){return Array.isArray(e)?Hd(e,t,n):!e||typeof e!="object"?[]:(Cn(e,{titleHint:`${t} #1`}),[{id:ro(),title:e.title||`${t} #1`,data:e}])}function Vn(e,t="Pasted",n={}){const i=(Ws(typeof e=="string"?e:"")||"").trim();if(!i)return[];const a=Dd(i);if(a){let l=n;if(Array.isArray(a)&&n.promptForSeriesName){const h=rd(a,t),b=ad(h);l={...n,promptForSeriesName:!1,seriesTitleOverride:b||h}}const u=zs(a,t,l);if(u.length)return u}return i.split(/^\s*(?:---|%%%)\s*$/m).map(l=>l.trim()).filter(Boolean).map((l,u)=>{const h=JSON.parse(l);return Cn(h,{titleHint:`${t} #${u+1}`}),{id:ro(),title:h.title||`${t} #${u+1}`,data:h}})}function Fd(e){if(!e)return!1;if(e.isContentEditable)return!0;const t=(e.tagName||"").toLowerCase();return t==="input"||t==="textarea"||t==="select"}function po(){const e=document.activeElement;return!e||e===document.body||e===document.documentElement?!0:!Fd(e)}function Wd(e){if(!e)return!1;const n=(Ws(e)||"").trimStart();return/^\s*(\{|\[|---|%%%)/.test(n)}function Js(){if(typeof window>"u"||!window.localStorage)return null;let e;try{e=localStorage.getItem(rt)}catch(i){return console.warn("[Blockscape] failed to access editor payload",i),null}if(!e)return null;let t;try{t=JSON.parse(e)}catch(i){console.warn("[Blockscape] invalid payload JSON",i);try{localStorage.removeItem(rt)}catch{}return null}if((t==null?void 0:t.source)!=="editor")return null;try{localStorage.removeItem(rt)}catch(i){console.warn("[Blockscape] failed to clear editor payload",i)}if(!t.text||typeof t.text!="string")return console.warn("[Blockscape] payload missing text"),null;let n=[];try{n=Vn(t.text,t.title||"Editor Export")}catch(i){return console.warn("[Blockscape] could not parse payload text",i),null}if(!n.length)return null;let o=null;return n.forEach(i=>{const a=xn(i,{versionLabel:"editor"});o==null&&(o=a)}),console.log(`[Blockscape] imported ${n.length} model(s) from editor`),{index:o,count:n.length}}function Ks(e="storage"){const t=Js();return!t||typeof t.index!="number"?!1:(It(t.index),console.log(`[Blockscape] imported ${t.count} model(s) from editor via ${e}.`),!0)}function jd(){const e=window.location.hash||"";let t=null;const n=e.match(/share=([^&]+)/);if(n&&(t=n[1]),!t){const s=new URLSearchParams(window.location.search);s.has("share")&&(t=s.get("share"))}if(!t)return null;let o;try{const s=mc(t);o=JSON.parse(s)}catch(s){return console.warn("[Blockscape] failed to decode share token",s),null}if(!o||typeof o!="object"||o.data==null)return console.warn("[Blockscape] share payload missing data"),null;const i=zs(o.data,o.title||"Shared Model");if(!i.length)return console.warn("[Blockscape] share payload did not contain usable models"),null;let a=null;return i.forEach(s=>{const l=s.isSeries?o.title||s.title:null,u=xn({...s,apicurioArtifactName:l||s.apicurioArtifactName},{versionLabel:"shared"});a==null&&(a=u)}),a}async function zd(){const e=Ac();if(!(e!=null&&e.path))return null;const{path:t,modelId:n,itemId:o}=e;try{if(!await ci())return console.log("[Blockscape] local backend not ready; skipping server-path autoload"),null;const a=await bs(t);if(typeof(a==null?void 0:a.firstIndex)=="number"){typeof(Ke==null?void 0:Ke.highlightSource)=="function"&&Ke.highlightSource(t);let s=a.firstIndex;if(n){const l=Ta(n);l!==-1&&(s=l)}return{modelIndex:s,itemId:o||null,modelId:n||null}}return null}catch(i){return console.warn("[Blockscape] server-path autoload failed",i),null}}async function Jd(){const e=window.location.hash||"";let t=null;const n=e.match(/load=([^&]+)/);if(n)try{t=decodeURIComponent(n[1])}catch{t=n[1]}if(!t){const o=new URLSearchParams(window.location.search);o.has("load")&&(t=o.get("load"))}if(!t)return null;try{const o=await Ua(t);return typeof o=="number"?o:null}catch(o){return console.warn("[Blockscape] load param failed",o),null}}function Kd(e){console.log("[Blockscape] parsing model; categories=",((e==null?void 0:e.categories)||[]).length);const t=new Map,n=new Map,o=new Set;(e.categories||[]).forEach(a=>(a.items||[]).forEach(s=>{o.add(s.id);const l=new Set(s.deps||[]);t.set(s.id,l),l.forEach(u=>{n.has(u)||n.set(u,new Set),n.get(u).add(s.id)})}));const i=new Set;return n.forEach((a,s)=>{((a==null?void 0:a.size)||0)>=2&&i.add(s)}),{m:e,fwd:t,rev:n,reusedLocal:i,seen:o}}function Gd(e,t){console.log("[Blockscape] generateLetterImage for:",e);const n=document.createElement("canvas"),o=44;n.width=o,n.height=o;const i=n.getContext("2d"),a=(e||"?").charAt(0).toUpperCase(),s=Vs(e,t),l=xd(s);return i.fillStyle=s,i.beginPath(),i.arc(o/2,o/2,o/2-2,0,2*Math.PI),i.fill(),i.strokeStyle="rgba(0,0,0,0.15)",i.lineWidth=1,i.stroke(),i.fillStyle=l,i.font=`bold ${o*.5}px system-ui, -apple-system, sans-serif`,i.textAlign="center",i.textBaseline="middle",i.fillText(a,o/2,o/2),n.toDataURL("image/png")}function Dn(e){var n;if(!((n=e==null?void 0:e.apicurioVersions)!=null&&n.length))return-1;const t=Number.isInteger(e.apicurioActiveVersionIndex)?e.apicurioActiveVersionIndex:0;return Math.min(Math.max(t,0),e.apicurioVersions.length-1)}function Gs(e){const t=Dn(e);if(t===-1)return null;const n=e.apicurioVersions[t];return(n==null?void 0:n.version)??null}function qs(e,t="active"){return Ln(e)||dt(e)||(e==null?void 0:e.apicurioArtifactId)||(e==null?void 0:e.id)||t}function qd(e){const t=new Map;return((e==null?void 0:e.apicurioVersions)||[]).forEach((n,o)=>{var s,l;const i=(((s=n==null?void 0:n.data)==null?void 0:s.id)??"").toString().trim();i&&t.set(i,o);const a=(((l=n==null?void 0:n.data)==null?void 0:l.seriesId)??"").toString().trim();a&&!t.has(a)&&t.set(a,o)}),t}function Yd(e,t){if(!e||!t)return null;const n=new Set,o=i=>{const a=(i??"").toString().trim();a&&(n.add(a),n.add(a.toLowerCase()),n.add(Jt(a)))};o(e.id),o(e.title);for(const i of n)if(t.has(i))return t.get(i);for(const i of n){const a=i.toLowerCase();for(const[s,l]of t.entries())if(s.toLowerCase()===a)return l}return null}const Ys=new WeakMap;function Xd(e,t){var De;if(!((De=e==null?void 0:e.apicurioVersions)!=null&&De[t]))return null;const n=e.apicurioVersions[t],o=n.data,i=Fi(o),a=Ys.get(n);if(a&&a.fingerprint===i)return a.dataUrl;const s=160,l=160,u=document.createElement("canvas");u.width=s,u.height=l;const h=u.getContext("2d"),b=To("--color-surface-ghost")||Bt.color.surfaceGhost,T=To("--color-border-muted")||Bt.color.borderMuted;h.fillStyle=b,h.fillRect(0,0,s,l),h.strokeStyle=T,h.strokeRect(.5,.5,s-1,l-1);const D=8,L=8,B=4,P=Array.isArray(o==null?void 0:o.categories)?o.categories:[],oe=Math.max(P.length,1),Be=s-B*2,lt=B*3,Ce=oe>1?Math.min(lt,Be/(oe-1)):0,Ne=oe>1?(s-Ce*(oe-1))/2:s/2;P.forEach((_t,Vt)=>{const Ct=Ne+Vt*Ce,xe=Array.isArray(_t.items)?_t.items:[],vt=Math.max(xe.length,1),kn=l-D-L-B*2,Fn=vt>1?Math.min(B*3,kn/(vt-1)):0;xe.forEach((xt,Qt)=>{const Gt=l-L-B-Qt*Fn;h.beginPath(),h.arc(Ct,Gt,B,0,Math.PI*2);const Ve=Vs(xt.name||xt.id||"",xt.color);h.fillStyle=Ve,h.strokeStyle="rgba(15,23,42,0.25)",h.fill(),h.stroke()})});const it=u.toDataURL("image/png");return Ys.set(n,{fingerprint:i,dataUrl:it}),it}function Gi(e,t){var l;if(jo(),e<0||e>=S.length)return!1;const n=S[e];if(!((l=n==null?void 0:n.apicurioVersions)!=null&&l.length)||!$s(e))return!1;const i=n.apicurioVersions.length,a=(t%i+i)%i,s=n.apicurioVersions[a];return s!=null&&s.data?(n.apicurioActiveVersionIndex=a,n.data=s.data,d=!0,K=null,Et=null,Kt(),Pt(),Mt(),!0):!1}function Pa(e){var o;if(!e||g<0)return!1;const t=S[g];if(!((o=t==null?void 0:t.apicurioVersions)!=null&&o.length))return!1;const n=Dn(t);return n===-1?!1:Gi(g,n+e)}function Zd(e,t){if(jo(),e<0||e>=S.length)return!1;const n=S[e];if(!Array.isArray(n==null?void 0:n.apicurioVersions)||n.apicurioVersions.length<=1)return alert("A series needs at least one map. Add another before removing this one."),!1;if(!$s(e))return!1;const o=Math.min(Math.max(t,0),n.apicurioVersions.length-1),i=Dn(n),[a]=n.apicurioVersions.splice(o,1);if(!a)return!1;let s=i;o===i?s=Math.min(o,n.apicurioVersions.length-1):o<i&&(s=Math.max(0,i-1)),n.apicurioActiveVersionIndex=Math.max(0,s);const l=n.apicurioVersions[n.apicurioActiveVersionIndex];return n.data=(l==null?void 0:l.data)||n.data,n.isSeries=n.apicurioVersions.length>1,It(e),!0}function Qd(e){if(!(e!=null&&e.apicurioVersions)||!e.apicurioVersions.length)return null;const t=Math.max(1,c.seriesNavMinVersions||1);if(e.apicurioVersions.length<t)return null;const n=document.createElement("div");n.className="version-nav";const o=document.createElement("div");o.className="version-nav__title",o.textContent=e.apicurioArtifactName||e.apicurioArtifactId||dt(e)||"Artifact",o.title="Double-click to rename this series",o.setAttribute("role","button"),o.tabIndex=0,o.addEventListener("dblclick",()=>{var Be;const P=S[g];!((Be=P==null?void 0:P.apicurioVersions)!=null&&Be.length)||!sd(P)||(Pn(),Pt(),Mt())}),n.appendChild(o);const i=document.createElement("div");i.className="version-nav__status";const a=Dn(e),s=Gs(e)||"latest";i.textContent=`No. in series ${s} (${a+1} of ${e.apicurioVersions.length})`,n.appendChild(i);const l=document.createElement("div");l.className="version-nav__controls";const u=document.createElement("button");u.type="button",u.className="version-nav__button",u.textContent="Previous",u.addEventListener("click",()=>Pa(-1));const h=document.createElement("button");h.type="button",h.className="version-nav__button",h.textContent="Next",h.addEventListener("click",()=>Pa(1)),l.appendChild(u),l.appendChild(h),n.appendChild(l);const b=document.createElement("div");b.className="version-nav__thumbs",e.apicurioVersions.forEach((P,oe)=>{var Vt,Ct;const Be=document.createElement("button");Be.type="button",Be.className="version-nav__thumb",P!=null&&P.isCategoryView&&Be.classList.add("version-nav__thumb--category"),oe===a&&Be.classList.add("is-active");const lt=Xd(e,oe);if(lt){const xe=document.createElement("img");xe.src=lt,xe.alt=`Version ${oe+1}`,Be.appendChild(xe)}const Ce=document.createElement("div");Ce.className="version-nav__thumb-label";const Ne=document.createElement("span");Ne.className="version-nav__thumb-label-text";const it=(((Vt=P==null?void 0:P.data)==null?void 0:Vt.id)??(P==null?void 0:P.id)??"").toString().trim();let De=it||(P!=null&&P.version?`v${P.version}`:`${oe+1}`),_t=it||De;if(P!=null&&P.isCategoryView){const xe=((Ct=P.data)==null?void 0:Ct.title)||P.categoryViewKey||De||"Category";De=xe,_t=`Category view: ${xe}`,Be.dataset.computed="true"}if(Ne.textContent=De,Ce.title=_t,Ce.appendChild(Ne),Be.appendChild(Ce),su(Ce,Ne),e.apicurioVersions.length>1&&!(P!=null&&P.isCategoryView)){const xe=document.createElement("span");xe.className="version-nav__thumb-remove",xe.title=`Remove ${De} from this series`,xe.setAttribute("aria-label",`Remove ${De} from this series`),xe.setAttribute("role","button"),xe.tabIndex=-1,xe.textContent="×",xe.addEventListener("click",vt=>{vt.stopPropagation(),vt.preventDefault(),window.confirm(`Remove ${De} from this series?`)&&Zd(g,oe)}),Be.appendChild(xe)}Be.addEventListener("click",()=>Gi(g,oe)),cu(Be,P),b.appendChild(Be)});const T=document.createElement("button");T.type="button",T.className="version-nav__thumb version-nav__thumb--add",T.title="Create a new version from this map",T.addEventListener("click",()=>{try{const P=Os({versionLabel:"manual"});It(P)}catch(P){alert((P==null?void 0:P.message)||"Unable to create a new version right now.")}});const D=document.createElement("span");D.className="version-nav__thumb-add-icon",D.textContent="+",T.appendChild(D),b.appendChild(T),n.appendChild(b);const L=qs(e,"active"),B=N.get(L);return typeof B=="number"&&!Number.isNaN(B)&&requestAnimationFrame(()=>{b.scrollLeft=B}),b.addEventListener("scroll",()=>{N.set(L,b.scrollLeft)}),n}function di(){var vl,yl;if(!v)return;const e=g>=0&&S[g]?S[g]:null,t=C&&C.querySelector?C.querySelector(".version-nav__thumbs"):null;if(t&&e){const p=qs(e,g);N.set(p,t.scrollLeft)}Hn(),Array.isArray(v.m.categories)||(v.m.categories=[]),console.log("[Blockscape] rendering categories=",v.m.categories.length),console.log("[Blockscape] model.m has abstract?",!!v.m.abstract,"- value:",v.m.abstract?v.m.abstract.substring(0,50)+"...":"none"),C.innerHTML="",fe.clear(),Ht.clear(),V=[],ji(S[g],{versionLabel:"1"});const n=Qd(S[g]);n&&C.appendChild(n),F.setAttribute("width",window.innerWidth),F.setAttribute("height",window.innerHeight);const i=(()=>{var Ue,Te,pt;const p=document.createElement("div");p.className="blockscape-model-meta";const $=document.createElement("div");$.className="blockscape-model-title",$.textContent=v.m.title&&v.m.title.trim()||Je(S[g]),p.appendChild($),((Ue=S[g])!=null&&Ue.isSeries||(pt=(Te=S[g])==null?void 0:Te.apicurioVersions)!=null&&pt.length)&&$t(S[g],{seriesName:S[g].title||v.m.title||Je(S[g])});const U=Gs(S[g]),ie=Ln(S[g]),Pe=(v.m.id??"").toString().trim(),G=document.createElement("div");G.className="blockscape-model-meta__details";const Se=(Ut,sn)=>{if(!sn)return;const go=document.createElement("div");go.className="blockscape-model-id";const bn=document.createElement("span");bn.className="blockscape-model-id__label",bn.textContent=Ut;const Yt=document.createElement("span");Yt.className="blockscape-model-id__value",Yt.textContent=sn,go.append(bn,Yt),G.appendChild(go)};return Se("Series ID",ie),Se("Model ID",Pe),Se("No. in series",U),G.childElementCount&&p.appendChild(G),p})();c.showModelMeta!==!1&&C.appendChild(i.cloneNode(!0));const s=document.createElement("div");s.className="blockscape-tabs";const l=document.createElement("div");l.className="blockscape-tabrow";const u=document.createElement("div");u.className="blockscape-tablist",u.setAttribute("role","tablist"),l.appendChild(u);const h=document.createElement("div");h.className="blockscape-tabactions",l.appendChild(h),s.appendChild(l);const b=document.createElement("div");b.className="blockscape-tabpanels",s.appendChild(b);const T=document.createElement("div"),D=document.createElement("div"),L=document.createElement("div"),B=document.createElement("div"),P=()=>{const p=document.createElement("div");p.className="blockscape-map-legend";const $=document.createElement("div");return $.className="blockscape-legend",$.setAttribute("role","presentation"),$.innerHTML=`
        <span class="legend-entry"><span class="legend-dot legend-dot--dep"></span> enables</span>
        <span class="legend-entry"><span class="legend-dot legend-dot--revdep"></span> dependents</span>
        <span class="legend-entry"><span class="legend-dot legend-dot--reused"></span> reused</span>
        <span class="legend-entry"><span class="legend-dot legend-dot--external"></span> external link</span>
      `,p.appendChild($),p};let oe="";const Be=qd(S[g]),lt=Dn(S[g]),Ce=((yl=(vl=S[g])==null?void 0:vl.apicurioVersions)==null?void 0:yl[lt])||null,Ne=Nn=!!(Ce!=null&&Ce.isCategoryView||((Ce==null?void 0:Ce.version)||"").startsWith(Pi));nn=null,En="";const it=(p,$)=>{!p||!$||(p.title=p.title?`${p.title}
${$}`:$)},De=[{id:"map",label:"Map",panel:T},{id:"abstract",label:"Info",panel:D},{id:"source",label:"Settings",panel:L},{id:"apicurio",label:"Apicurio",panel:B}],_t=typeof Le.isEnabled=="function"?Le.isEnabled():!1,Vt=p=>{if(!F)return;const $=p==="map";F.hidden=!$,$?(qi(),Sn()):F.innerHTML=""};De.forEach((p,$)=>{const U=document.createElement("button");U.type="button",U.id=`tab-${p.id}`,U.className="blockscape-tab"+($===0?" is-active":""),U.setAttribute("role","tab"),U.setAttribute("aria-controls",`panel-${p.id}`),U.setAttribute("aria-selected",$===0?"true":"false"),U.textContent=p.label,p.id==="apicurio"&&!_t&&(U.hidden=!0,U.tabIndex=-1,U.setAttribute("aria-hidden","true"),U.style.display="none"),p.button=U,u.appendChild(U),p.panel.id=`panel-${p.id}`,p.panel.classList.add("blockscape-tabpanel"),p.panel.setAttribute("role","tabpanel"),p.panel.setAttribute("aria-labelledby",U.id),p.panel.hidden=$!==0,$===0&&p.panel.classList.add("is-active"),b.appendChild(p.panel)});const Ct=p=>{ln=p,De.forEach($=>{const U=$.id===p;$.button.classList.toggle("is-active",U),$.button.setAttribute("aria-selected",U?"true":"false"),$.panel.classList.toggle("is-active",U),$.panel.hidden=!U}),Vt(p)},xe=De.find(p=>p.id==="apicurio"),vt=p=>{if(!xe||!xe.button||!xe.panel)return;const $=!!p;if(xe.button.hidden=!$,xe.button.tabIndex=$?0:-1,xe.button.setAttribute("aria-hidden",$?"false":"true"),xe.button.style.display=$?"":"none",$){const U=ln==="apicurio";xe.button.classList.toggle("is-active",U),xe.button.setAttribute("aria-selected",U?"true":"false"),xe.panel.classList.toggle("is-active",U),xe.panel.hidden=!U}else{const U=xe.panel.classList.contains("is-active");if(xe.button.classList.remove("is-active"),xe.button.setAttribute("aria-selected","false"),xe.panel.classList.remove("is-active"),xe.panel.hidden=!0,U){const ie=De.find(Pe=>Pe.id!=="apicurio");ie&&Ct(ie.id)}}M&&(M.checked=$)};De.forEach(p=>{p.button.addEventListener("click",()=>{Hn(),Ct(p.id)}),p.id==="abstract"&&(nn=p.button,p.button.addEventListener("mouseenter",()=>fi(p.button,oe,{offset:12})),p.button.addEventListener("mouseleave",Hn),p.button.addEventListener("focus",()=>fi(p.button,oe,{offset:12})),p.button.addEventListener("blur",Hn))});const Fn=(p=>{const $=De.find(ie=>ie.id===ln);if($&&($.id!=="apicurio"||p))return $.id;const U=De.find(ie=>ie.id!=="apicurio"||p);return(U==null?void 0:U.id)||De[0].id})(_t);Ct(Fn),vt(_t),typeof Le.onEnabledChange=="function"&&Le.onEnabledChange(vt),C.appendChild(s),T.appendChild(P());const xt=document.createElement("div");xt.className="blockscape-render",T.appendChild(xt);const Qt=document.createElement("div");if(Qt.className="blockscape-abstract-panel",D.appendChild(i.cloneNode(!0)),v.m.abstract){console.log("[Blockscape] Rendering abstract content");const p=document.createElement("div");p.className="blockscape-abstract",p.innerHTML=v.m.abstract,Au(p),Qt.appendChild(p),oe=p.outerHTML}else{console.log("[Blockscape] No abstract found in model.m");const p=document.createElement("div");p.className="blockscape-abstract-placeholder",p.textContent="No abstract has been provided for this model.",Qt.appendChild(p),oe=p.outerHTML}En=oe,D.appendChild(Qt);const Gt=document.createElement("div");Gt.className="blockscape-source-panel";const Ve=document.createElement("div");Ve.className="blockscape-settings-panel";const An=p=>{Ae.themeToggle&&(Ae.themeToggle.checked=p),Ae.tabThemeToggle&&(Ae.tabThemeToggle.checked=p)},fo=p=>{An(p),wa(p?io:yo)},Go=p=>{Ae.tabCenterToggle&&(Ae.tabCenterToggle.checked=p)},an=p=>{const $=Ao(p);Go($),ps($)},mo=p=>{Ae.secondaryLinksToggle&&(Ae.secondaryLinksToggle.checked=p),Ae.tabSecondaryLinksToggle&&(Ae.tabSecondaryLinksToggle.checked=p)},un=p=>{const $=!!p;mo($),en=$,K?Nt(K):(Xi(),Sn())},mi=({id:p,label:$,checked:U,onChange:ie})=>{const Pe=document.createElement("label");Pe.className="blockscape-tab-toggle",Pe.setAttribute("for",p);const G=document.createElement("input");G.type="checkbox",G.id=p,G.checked=U,typeof ie=="function"&&G.addEventListener("change",()=>ie(G.checked));const Se=document.createElement("span");return Se.className="blockscape-tab-toggle__label",Se.textContent=$,Pe.append(G,Se),{row:Pe,input:G}},qo=document.createElement("p");qo.className="blockscape-settings-panel__title",qo.textContent="Feature toggles",Ve.appendChild(qo);const Yo=document.createElement("label");Yo.className="settings-toggle";const Gn=document.createElement("input");Gn.type="checkbox",Gn.checked=ii===io;const hi=document.createElement("span");hi.className="settings-toggle__text";const gi=document.createElement("span");gi.className="settings-toggle__label",gi.textContent="Dark mode";const I=document.createElement("span");I.className="settings-toggle__hint",I.textContent="Switch Blockscape UI to dark colors.",hi.append(gi,I),Yo.append(Gn,hi),Gn.addEventListener("change",()=>{fo(Gn.checked)}),Ve.appendChild(Yo),Ae.themeToggle=Gn;const{row:z,input:le}=mi({id:"tabToggleTheme",label:"Dark mode",checked:ii===io,onChange:p=>fo(p)});h.appendChild(z),Ae.tabThemeToggle=le;const{row:ce,input:Qe}=mi({id:"tabToggleSecondaryLinks",label:"Show indirect links",checked:en,onChange:p=>un(p)});h.appendChild(ce),Ae.tabSecondaryLinksToggle=Qe;const{row:At,input:be}=mi({id:"tabToggleCenterItems",label:"Center",checked:on,onChange:p=>an(p)});h.appendChild(At),Ae.tabCenterToggle=be;const et=document.createElement("div");et.className="settings-actions";const gt=document.createElement("input");gt.type="file",gt.accept="application/json",gt.hidden=!0;const rn=document.createElement("button");rn.type="button",rn.className="pf-v5-c-button pf-m-secondary",rn.textContent="Load settings",rn.addEventListener("click",()=>gt.click()),gt.addEventListener("change",async()=>{var $,U;const p=($=gt.files)==null?void 0:$[0];if(p)try{const ie=await p.text(),Pe=JSON.parse(ie),G=(Pe==null?void 0:Pe.settings)||Pe,Ue=((U=As(G||{},{refreshObsidianLinks:Zi}).applied)==null?void 0:U.length)||0;On(Ue?`Loaded ${Ue} setting${Ue===1?"":"s"} from ${p.name}.`:`No matching settings found in ${p.name}.`,2200)}catch(ie){console.warn("[Blockscape] failed to load settings.json",ie),On("Invalid settings file.",2400)}finally{gt.value=""}});const qt=document.createElement("button");qt.type="button",qt.className="pf-v5-c-button pf-m-tertiary",qt.textContent="Download settings",qt.addEventListener("click",()=>{const p={version:1,exportedAt:new Date().toISOString(),settings:Wl(xs(),{localBackend:Ke})};ds("settings.json",JSON.stringify(p,null,2)),On("Settings downloaded.",2e3)}),et.append(rn,qt,gt),Ve.appendChild(et);const Wn=document.createElement("div");Wn.className="color-presets";const Ha=document.createElement("div");Ha.className="settings-text__label",Ha.textContent="Color presets";const Fa=document.createElement("div");Fa.className="settings-text__hint",Fa.textContent="Shown in tile context menu for quick coloring.",Wn.append(Ha,Fa);const bi=document.createElement("div");bi.className="color-presets__list";const Wa=document.createElement("div");Wa.className="color-presets__add";const Xo=document.createElement("input");Xo.type="text",Xo.placeholder="Name",Xo.className="settings-text__input";const wi=document.createElement("input");wi.type="color",wi.value="#2563eb",wi.className="settings-color-input";const vi=document.createElement("button");vi.type="button",vi.className="pf-v5-c-button pf-m-primary",vi.textContent="Add preset",vi.addEventListener("click",()=>{const p=Xo.value.trim()||"Custom",$=wi.value,U=[...zt,{name:p,value:$}];Lo(U),Wo(zt),Xo.value=""}),Wa.append(Xo,wi,vi),Wn.append(bi,Wa),Ve.appendChild(Wn),Ae.colorPresetList=bi,xo=()=>{bi.innerHTML="",zt.forEach((p,$)=>{const U=document.createElement("div");U.className="color-presets__row";const ie=document.createElement("input");ie.type="text",ie.className="settings-text__input",ie.value=p.name||"",ie.placeholder="Name",ie.addEventListener("input",()=>{const Se=[...zt];Se[$]={...Se[$],name:ie.value},Lo(Se),Wo(zt)});const Pe=document.createElement("input");Pe.type="color",Pe.className="settings-color-input",Pe.value=p.value,Pe.addEventListener("input",()=>{const Se=[...zt];Se[$]={...Se[$],value:Pe.value},Lo(Se),Wo(zt)});const G=document.createElement("button");G.type="button",G.className="pf-v5-c-button pf-m-plain",G.textContent="✕",G.title="Remove preset",G.addEventListener("click",()=>{const Se=zt.filter((Ue,Te)=>Te!==$);Lo(Se),Wo(zt),xo()}),U.append(ie,Pe,G),bi.appendChild(U)})},xo();const ja=document.createElement("div");ja.className="settings-text";const za=document.createElement("div");za.className="settings-text__label",za.textContent="Link colors";const Ja=document.createElement("div");Ja.className="settings-text__hint",Ja.textContent="Adjust the colors used when highlighting enables/dependents.";const Ka=document.createElement("div");Ka.className="settings-color-rows";const ul=({id:p,label:$,hint:U,value:ie,onChange:Pe})=>{const G=document.createElement("label");G.className="settings-color-row",G.setAttribute("for",p);const Se=document.createElement("span");if(Se.className="settings-color-row__label",Se.textContent=$,U){const Te=document.createElement("span");Te.className="settings-color-row__hint",Te.textContent=U,Se.appendChild(Te)}const Ue=document.createElement("input");if(Ue.type="color",Ue.id=p,Ue.className="settings-color-input",Ue.value=ie,typeof Pe=="function"){const Te=()=>Pe(Ue.value);Ue.addEventListener("input",Te),Ue.addEventListener("change",Te)}return G.append(Se,Ue),Ka.appendChild(G),Ue};Ae.depColorInput=ul({id:"depColor",label:"Enables",hint:"Outgoing links from the selected item.",value:Di,onChange:p=>{const $=Sa(p);ya($)}}),Ae.revdepColorInput=ul({id:"revdepColor",label:"Dependents",hint:"Incoming links to the selected item.",value:Ui,onChange:p=>{const $=ka(p);Ea($)}}),ja.append(za,Ja,Ka),Ve.appendChild(ja);const Ga=document.createElement("div");Ga.className="settings-text";const qa=document.createElement("div");qa.className="settings-text__text";const Ya=document.createElement("div");Ya.className="settings-text__label",Ya.textContent="Link thickness";const Xa=document.createElement("div");Xa.className="settings-text__hint",Xa.textContent="Adjust stroke width for enables/dependents lines.",qa.append(Ya,Xa);const ho=document.createElement("select");ho.id="linkThickness",ho.className="settings-text__input",[{value:"s",label:"Small"},{value:"m",label:"Medium"},{value:"l",label:"Large"}].forEach(({value:p,label:$})=>{const U=document.createElement("option");U.value=p,U.textContent=$,p===ai&&(U.selected=!0),ho.appendChild(U)}),ho.addEventListener("change",()=>{const p=si(ho.value);Ia(p)});const Za=document.createElement("div");Za.className="settings-text__row",Za.append(qa,ho),Ga.appendChild(Za),Ve.appendChild(Ga),Ae.linkThicknessInput=ho;const qn=({id:p,label:$,hint:U,checked:ie,className:Pe="",onChange:G})=>{const Se=document.createElement("label");Se.className=["settings-toggle",Pe].filter(Boolean).join(" ");const Ue=document.createElement("input");Ue.type="checkbox",Ue.id=p,Ue.checked=ie;const Te=document.createElement("span");Te.className="settings-toggle__text";const pt=document.createElement("span");if(pt.className="settings-toggle__label",pt.textContent=$,Te.appendChild(pt),U){const Ut=document.createElement("span");Ut.className="settings-toggle__hint",Ut.textContent=U,Te.appendChild(Ut)}return Se.appendChild(Ue),Se.appendChild(Te),typeof G=="function"&&Ue.addEventListener("change",()=>G(Ue.checked)),{row:Se,input:Ue}},Zi=()=>{C.querySelectorAll(".tile").forEach(p=>{const $=p.dataset.id,U=La($);if(!(U!=null&&U.item))return;const ie=nl(U.item.external),Pe=tl(U.item,{externalMeta:ie,seriesIdLookup:Be});ol(p,Pe)})},{row:Mu,input:Bu}=qn({id:"toggleSecondaryLinks",label:"Show indirect links",checked:en,className:"map-controls__toggle",onChange:p=>un(p)});Ve.appendChild(Mu),Ae.secondaryLinksToggle=Bu;const{row:$u,input:Ru}=qn({id:"toggleReusedInMap",label:"Display reused in map view",hint:"Show markers for nodes used multiple times.",checked:Ft,className:"map-controls__toggle",onChange:p=>{Ft=p,Da()}});Ve.appendChild($u),Ae.reusedToggle=Ru;const{row:Ou,input:Pu}=qn({id:"toggleAutoIdFromName",label:"Auto-fill IDs from titles",hint:"Keep ID in sync while editing name/title (can be overridden manually).",checked:ao,className:"map-controls__toggle",onChange:p=>{const $=Vo(p);Ss($)}});Ve.appendChild(Ou),Ae.autoIdToggle=Pu;const Qa=[],{row:Vu,input:Du}=qn({id:"toggleObsidianLinks",label:"Obsidian",hint:"Make tiles open Obsidian when no external URL exists.",checked:_o,className:"map-controls__toggle",onChange:p=>{const $=Ho(p);Ns($),Qa.forEach(U=>{U.disabled=!$}),Zi()}});if(Ve.appendChild(Vu),Ae.obsidianToggle=Du,typeof(Ke==null?void 0:Ke.isAvailable)=="function"&&Ke.isAvailable()&&typeof(Ke==null?void 0:Ke.getAutoReloadConfig)=="function"){const{enabled:p,intervalMs:$}=Ke.getAutoReloadConfig();let U=null;const{row:ie,input:Pe}=qn({id:"toggleAutoReload",label:"Auto-reload local files",hint:"Poll the local backend for file changes and refresh matching models.",checked:p,className:"map-controls__toggle",onChange:sn=>{Ke.setAutoReloadEnabled(sn),U&&(U.disabled=!sn)}});Ve.appendChild(ie),Ae.autoReloadToggle=Pe;const G=sn=>`${(sn/1e3).toFixed(2)}s`,Se=document.createElement("label");Se.className="settings-slider",Se.setAttribute("for","autoReloadInterval");const Ue=document.createElement("div");Ue.className="settings-slider__text";const Te=document.createElement("span");Te.className="settings-slider__label",Te.textContent="Auto-reload interval";const pt=document.createElement("span");pt.className="settings-slider__hint",pt.textContent="Adjust how often to poll for file changes.",Ue.append(Te,pt);const Ut=document.createElement("span");Ut.className="settings-slider__value",Ut.textContent=G($),U=document.createElement("input"),U.type="range",U.id="autoReloadInterval",U.className="settings-slider__input",U.min=String(qr),U.max=String(Yr),U.step="100",U.value=String($),U.disabled=!p,U.setAttribute("aria-label","Set auto-reload polling interval"),U.addEventListener("input",()=>{const sn=Ke.setAutoReloadInterval(parseInt(U.value,10));Ut.textContent=G(sn)}),Se.append(Ue,Ut,U),Ve.appendChild(Se),Ae.autoReloadInput=U,Ae.autoReloadValue=Ut}const er=document.createElement("div");er.className="settings-radio";const tr=document.createElement("div");tr.className="settings-radio__label",tr.textContent="Obsidian link format";const nr=document.createElement("div");nr.className="settings-radio__hint",nr.textContent="Use the tile title or id when building Obsidian links.";const or=document.createElement("div");or.className="settings-radio__options";const pl=(p,$)=>{const U=document.createElement("label");U.className="settings-radio__option";const ie=document.createElement("input");ie.type="radio",ie.name="obsidianLinkMode",ie.value=p,ie.checked=oi===p,ie.disabled=!_o,ie.addEventListener("change",()=>{if(!ie.checked)return;const G=Uo(p);Ls(G),Zi()});const Pe=document.createElement("span");Pe.textContent=$,U.append(ie,Pe),Qa.push(ie),or.appendChild(U)};pl(ga,"Use title"),pl($i,"Use id"),er.append(tr,or,nr),Ve.appendChild(er),Ae.obsidianModeInputs=Qa;const Qi=document.createElement("label");Qi.className="settings-text",Qi.setAttribute("for","obsidianVaultInput");const ir=document.createElement("div");ir.className="settings-text__text";const ar=document.createElement("span");ar.className="settings-text__label",ar.textContent="Obsidian vault";const rr=document.createElement("span");rr.className="settings-text__hint",rr.textContent="Optional. Set the vault name to avoid duplicates.",ir.append(ar,rr);const jn=document.createElement("input");jn.type="text",jn.id="obsidianVaultInput",jn.className="settings-text__input",jn.placeholder="Vault name",jn.value=Co,jn.addEventListener("input",()=>{const p=Fo(jn.value);Ms(p),Zi()}),Qi.append(ir,jn),Ve.appendChild(Qi),Ae.obsidianVaultInput=jn;const sr=document.createElement("p");sr.className="settings-note",sr.innerHTML='Requires the Obsidian <a href="https://vinzent03.github.io/obsidian-advanced-uri/" target="_blank" rel="noreferrer noopener">Advanced URI</a> plugin for create/open behavior.',Ve.appendChild(sr);const fl=p=>`${(p/1e3).toFixed(1)}s`,ea=document.createElement("label");ea.className="settings-slider",ea.setAttribute("for","seriesNavDoubleClickWait");const lr=document.createElement("div");lr.className="settings-slider__text";const cr=document.createElement("span");cr.className="settings-slider__label",cr.textContent="Series double-click wait";const dr=document.createElement("span");dr.className="settings-slider__hint",dr.textContent="Time window to double-click into another map version.",lr.append(cr,dr);const yi=document.createElement("span");yi.className="settings-slider__value",yi.textContent=fl(Rn);const pn=document.createElement("input");pn.type="range",pn.id="seriesNavDoubleClickWait",pn.className="settings-slider__input",pn.min=String(ss),pn.max=String(ls),pn.step="50",pn.value=String(Rn),pn.setAttribute("aria-label","Adjust double-click wait for series navigation"),pn.addEventListener("input",()=>{const p=Do(parseInt(pn.value,10));yi.textContent=fl(p),Ts(p)}),ea.append(lr,yi,pn),Ve.appendChild(ea),Ae.seriesNavInput=pn,Ae.seriesNavValue=yi;const ml=p=>`${Math.round((p-1)*100)}%`,ta=document.createElement("label");ta.className="settings-slider",ta.setAttribute("for","hoverScaleSlider");const ur=document.createElement("div");ur.className="settings-slider__text";const pr=document.createElement("span");pr.className="settings-slider__label",pr.textContent="Hover zoom";const fr=document.createElement("span");fr.className="settings-slider__hint",fr.textContent="Expand tiles on hover to see more detail.",ur.append(pr,fr);const Ei=document.createElement("span");Ei.className="settings-slider__value",Ei.textContent=ml(Eo);const fn=document.createElement("input");fn.type="range",fn.id="hoverScaleSlider",fn.className="settings-slider__input",fn.min=String(We),fn.max=String(Ze),fn.step="0.1",fn.value=String(Eo),fn.setAttribute("aria-label","Adjust hover zoom"),fn.addEventListener("input",()=>{const p=No(parseFloat(fn.value));Ei.textContent=ml(p),vs(p),K&&zo()}),ta.append(ur,Ei,fn),Ve.appendChild(ta),Ae.hoverScaleInput=fn,Ae.hoverScaleValue=Ei;let Dt=null,Yn=null;const mr=p=>{const $=Math.round((1-p)*100);return $===0?"Off":`${$}% dim`},{row:Uu,input:Hu}=qn({id:"toggleSelectionDimming",label:"Dim unrelated tiles",hint:"When selecting a tile, fade everything except linked tiles.",checked:$n,className:"map-controls__toggle",onChange:p=>{const $=Po(p);Es($),Dt&&(Dt.disabled=!$),Yn&&(Yn.textContent=mr($?Bn:1))}});Ve.appendChild(Uu),Ae.selectionDimToggle=Hu;const na=document.createElement("label");na.className="settings-slider",na.setAttribute("for","selectionDimmingSlider");const hr=document.createElement("div");hr.className="settings-slider__text";const gr=document.createElement("span");gr.className="settings-slider__label",gr.textContent="Dimming strength";const br=document.createElement("span");br.className="settings-slider__hint",br.textContent="Adjust how much unrelated tiles fade when dimming is on.",hr.append(gr,br),Yn=document.createElement("span"),Yn.className="settings-slider__value",Yn.textContent=mr($n?Bn:1),Dt=document.createElement("input"),Dt.type="range",Dt.id="selectionDimmingSlider",Dt.className="settings-slider__input",Dt.min=String(de),Dt.max=String(ne),Dt.step="0.05",Dt.value=String(Bn),Dt.disabled=!$n,Dt.setAttribute("aria-label","Adjust how much unrelated tiles dim on selection"),Dt.addEventListener("input",()=>{const p=Mo(parseFloat(Dt.value));Yn.textContent=mr(p),ys(p)}),na.append(hr,Yn,Dt),Ve.appendChild(na),Ae.selectionDimInput=Dt,Ae.selectionDimValue=Yn;const hl=p=>p===1?"Default":`${Math.round(p*100)}%`,oa=document.createElement("label");oa.className="settings-slider",oa.setAttribute("for","tileCompactnessSlider");const wr=document.createElement("div");wr.className="settings-slider__text";const vr=document.createElement("span");vr.className="settings-slider__label",vr.textContent="Tile compactness";const yr=document.createElement("span");yr.className="settings-slider__hint",yr.textContent="Adjust padding, gap, and logo size for tiles.",wr.append(vr,yr);const Si=document.createElement("span");Si.className="settings-slider__value",Si.textContent=hl(So);const mn=document.createElement("input");mn.type="range",mn.id="tileCompactnessSlider",mn.className="settings-slider__input",mn.min=String(Fr),mn.max=String(Wr),mn.step="0.05",mn.value=String(So),mn.setAttribute("aria-label","Adjust tile compactness"),mn.addEventListener("input",()=>{const p=Bo(parseFloat(mn.value));Si.textContent=hl(p),ks(p),K&&zo()}),oa.append(wr,Si,mn),Ve.appendChild(oa),Ae.tileCompactnessInput=mn,Ae.tileCompactnessValue=Si;const{row:Fu,input:Wu}=qn({id:"titleWrapToggle",label:"Wrap titles",hint:"Allow long titles to wrap instead of truncating.",checked:ba!=="nowrap",className:"map-controls__toggle",onChange:p=>{const $=p?"wrap":"nowrap";Oo($),Cs($)}});Ve.appendChild(Fu),Ae.titleWrapInput=Wu;const gl=p=>`${Math.round((p-1)*100)}% extra`,ia=document.createElement("label");ia.className="settings-slider",ia.setAttribute("for","titleHoverWidthSlider");const Er=document.createElement("div");Er.className="settings-slider__text";const Sr=document.createElement("span");Sr.className="settings-slider__label",Sr.textContent="Title width on hover";const kr=document.createElement("span");kr.className="settings-slider__hint",kr.textContent="Give titles more room horizontally when zoomed.",Er.append(Sr,kr);const ki=document.createElement("span");ki.className="settings-slider__value",ki.textContent=gl(ko);const hn=document.createElement("input");hn.type="range",hn.id="titleHoverWidthSlider",hn.className="settings-slider__input",hn.min=String(In),hn.max=String(dn),hn.step="0.05",hn.value=String(ko),hn.setAttribute("aria-label","Adjust title width boost on hover"),hn.addEventListener("input",()=>{const p=$o(parseFloat(hn.value));ki.textContent=gl(p),Is(p)}),ia.append(Er,ki,hn),Ve.appendChild(ia),Ae.titleWidthInput=hn,Ae.titleWidthValue=ki;const bl=p=>`${Math.round(p*100)}% of hover zoom`,aa=document.createElement("label");aa.className="settings-slider",aa.setAttribute("for","titleZoomPortionSlider");const Ir=document.createElement("div");Ir.className="settings-slider__text";const _r=document.createElement("span");_r.className="settings-slider__label",_r.textContent="Title zoom influence";const Cr=document.createElement("span");Cr.className="settings-slider__hint",Cr.textContent="How much the title scales relative to tile hover zoom.",Ir.append(_r,Cr);const Ii=document.createElement("span");Ii.className="settings-slider__value",Ii.textContent=bl(Io);const gn=document.createElement("input");gn.type="range",gn.id="titleZoomPortionSlider",gn.className="settings-slider__input",gn.min=String(oo),gn.max=String(ha),gn.step="0.05",gn.value=String(Io),gn.setAttribute("aria-label","Adjust how much titles scale on hover"),gn.addEventListener("input",()=>{const p=Ro(parseFloat(gn.value));Ii.textContent=bl(p),_s(p)}),aa.append(Ir,Ii,gn),Ve.appendChild(aa),Ae.titleZoomInput=gn,Ae.titleZoomValue=Ii;const ju=typeof Le.isEnabled=="function"?Le.isEnabled():!1,{row:zu,input:Ju}=qn({id:"apicurioFeatureToggle",label:"Apicurio",hint:"Show the Apicurio registry tab when enabled.",checked:ju,className:"apicurio-toggle",onChange:p=>{typeof Le.setEnabled=="function"&&Le.setEnabled(p)}});if(M=Ju,Ve.appendChild(zu),Gt.appendChild(Ve),A)A.hidden=!1,A.classList.remove("pf-v5-c-page__main-section"),Gt.appendChild(A);else{const p=document.createElement("p");p.className="muted",p.textContent="Source editor unavailable.",Gt.appendChild(p)}L.appendChild(Gt),Le.mount(B);let wl=0;if(v.m.categories.forEach(p=>{const $=document.createElement("section");$.className="category",$.dataset.cat=p.id;const U=Ne?Yd(p,Be):null,ie=document.createElement("div");ie.className="cat-head",ie.dataset.cat=p.id,ie.tabIndex=0,Ne&&Number.isInteger(U)?(ie.dataset.seriesVersionIndex=String(U),ie.title="Open this category's map in the series",ie.classList.add("cat-head--series-link")):ie.title="Select category",ie.innerHTML=`<div class="cat-title">${pi(p.title||p.id)}</div>
                          <div class="muted cat-count">${(p.items||[]).length} items</div>`,ie.addEventListener("click",()=>{var pt;const G=ie.dataset.seriesVersionIndex!=null?parseInt(ie.dataset.seriesVersionIndex,10):null,Se=S[g],Ue=Se?Dn(Se):-1;Ne&&((pt=Se==null?void 0:Se.apicurioVersions)==null?void 0:pt.length)>1&&Number.isInteger(G)&&G!==Ue&&Gi(g,G)||Un(p.id)}),ie.addEventListener("keydown",G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),ie.click())}),ie.addEventListener("focus",()=>Un(p.id,{scrollIntoView:!1})),$.appendChild(ie);const Pe=document.createElement("div");if(Pe.className="grid"+(on?" is-centered":""),$.appendChild(Pe),(p.items||[]).forEach(G=>{wl+=1;const Se=nl(G.external),Ue=tl(G,{externalMeta:Se,seriesIdLookup:Be}),Te=document.createElement("div");if(Te.className=Se.isExternal?"tile external":"tile",Te.tabIndex=0,Te.dataset.id=G.id,Te.dataset.globalIndex=String(wl),Se.url&&(Te.dataset.externalUrl=Se.url),!Ne){let Yt=null;if(Be.has(G.id)&&(Yt=Be.get(G.id)),Number.isInteger(Yt)){Te.dataset.seriesVersionIndex=String(Yt),Te.classList.add("tile--series-link");const Ku=Yt===lt?"Current map in this series":`Open version ${Yt+1} in this series`;it(Te,Ku)}}if(Ue&&(Te.dataset.obsidianUrl=Ue),!Ne){const Yt=Ta(G.id);Yt!==-1&&Yt!==g&&(Te.classList.add("tile--series-link"),Te.dataset.navTargetIndex=String(Yt))}const pt=document.createElement("img");pt.className="logo",G.logo?(pt.src=G.logo,pt.alt=G.name||G.id):(pt.alt="",pt.style.opacity=1,pt.src=Gd(G.name||G.id,G.color));const Ut=document.createElement("div");Ut.className="name",Ut.textContent=G.name||G.id;const sn=document.createElement("div");sn.className="tile-id",sn.textContent=G.id||"";const go=document.createElement("div");go.className="badge",go.textContent="reused";let bn=null;Ne||(bn=document.createElement("button"),bn.type="button",bn.className="tile-delete",bn.setAttribute("aria-label",`Delete ${G.name||G.id}`),bn.textContent="×",bn.addEventListener("click",Yt=>{Yt.stopPropagation(),_u(G.id)})),Se.url&&Te.appendChild(ru(Se.url)),ol(Te,Ue),bn&&Te.appendChild(bn),Te.appendChild(pt),Te.appendChild(Ut),Te.appendChild(sn),Te.appendChild(go),Pe.appendChild(Te),fe.set(G.id,{el:Te,catId:p.id,rect:null})}),xt.appendChild($),Ht.set(p.id,{el:$,headEl:ie}),!Ne){const G=document.createElement("button");G.type="button",G.className="tile-add",G.innerHTML='<span class="tile-add__icon" aria-hidden="true">+</span><span class="tile-add__label"></span>',G.hidden=on,G.tabIndex=on?-1:0,G.setAttribute("aria-hidden",on?"true":"false"),G.addEventListener("click",()=>fu(p.id)),Pe.appendChild(G)}}),!Ne){const p=document.createElement("button");p.type="button",p.className="category-add",p.innerHTML='<span class="category-add__icon" aria-hidden="true">+</span><span class="category-add__label">Add category</span><span class="category-add__hint">(Insert)</span>',p.addEventListener("click",()=>al()),xt.appendChild(p)}Da(),eu(),qi(),Sn(),Jo(),du()}function eu(){C.querySelectorAll(".tile").forEach(e=>{e.addEventListener("click",n=>{var L;if(typeof n.button=="number"&&n.button!==0)return;uo();const o=e.dataset.id,i=e.dataset.seriesVersionIndex!=null?parseInt(e.dataset.seriesVersionIndex,10):null,a=e.dataset.globalIndex!=null?parseInt(e.dataset.globalIndex,10):null,s=e.dataset.navTargetIndex!=null?parseInt(e.dataset.navTargetIndex,10):null,l=S[g],u=l?Dn(l):-1,h=((L=l==null?void 0:l.apicurioVersions)==null?void 0:L.length)>1&&Number.isInteger(i)&&i!==u,b=Number.isInteger(s)&&s!==g&&s>=0&&s<S.length,T=Ot&&Ot.id===o&&Ot.targetVersionIndex===i,D=vn&&vn.id===o&&vn.targetIndex===s;if(Ot&&!T&&jo(),vn&&!D&&$a(),h)if(T){if(jo(),Gi(g,i))return}else Ld(o,i,l);else if(b){if(D){$a(),It(s);return}Nd(o,s)}else Number.isInteger(a)&&a>0&&a%5===0&&On("Use arrow keys to move between blocks. Shift arrow to move block.");if(console.log("[Blockscape] click",o),K===o&&!(h&&T)&&!(b&&D)){Ko();return}Nt(o)}),e.addEventListener("dblclick",n=>{n.preventDefault();const o=e.dataset.id,i=e.dataset.navTargetIndex!=null?parseInt(e.dataset.navTargetIndex,10):Ta(o);i!==-1&&i!==g&&It(i)}),e.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&(n.preventDefault(),e.click())});const t=()=>{K&&zo()};e.addEventListener("pointerenter",t),e.addEventListener("pointerleave",t),e.addEventListener("focus",t),e.addEventListener("blur",t)}),Ds||(Ds=!0,window.addEventListener("resize",zo),window.addEventListener("scroll",zo,{passive:!0}),window.addEventListener("resize",il),document.addEventListener("click",e=>{var a,s,l;if(!K&&!Fe||typeof e.button=="number"&&e.button!==0)return;const t=e.target,n=(a=t==null?void 0:t.closest)==null?void 0:a.call(t,".tile"),o=(s=t==null?void 0:t.closest)==null?void 0:s.call(t,".cat-head"),i=(l=t==null?void 0:t.closest)==null?void 0:l.call(t,".tile-context-menu");n||o||i||Ko()})),document.getElementById("clear").onclick=()=>Ko()}function qi(){fe.forEach(e=>{e.rect=e.el.getBoundingClientRect()})}function Xs(e,{includeSecondary:t=en}={}){if(!e||!v)return{deps:new Set,revs:new Set,secondaryDeps:new Set,secondaryRevs:new Set,edges:[]};const n=new Set(v.fwd.get(e)||[]),o=new Set(v.rev.get(e)||[]),i=new Set,a=new Set,s=[],l=new Set,u=(h,b,T,D)=>{if(!h||!b)return;const L=`${h}->${b}:${T}:${D}`;l.has(L)||(l.add(L),s.push({from:h,to:b,type:T,depth:D}))};return n.forEach(h=>u(e,h,"dep",1)),o.forEach(h=>u(e,h,"revdep",1)),t&&new Set([...n,...o]).forEach(b=>{(v.fwd.get(b)||new Set).forEach(L=>{const B=L===e;B||i.add(L),B||u(b,L,"dep",2)}),(v.rev.get(b)||new Set).forEach(L=>{const B=L===e;B||a.add(L),B||u(b,L,"revdep",2)})}),{deps:n,revs:o,secondaryDeps:i,secondaryRevs:a,edges:s}}function Yi(e,t){const n=fe.get(e);n&&n.el.classList.add(t)}function Nt(e){var l,u,h;if(!e)return;Fe=null,K=e,ot=null,Et=Xs(e),Kt(),Xi(),Jo();const{deps:t,revs:n,secondaryDeps:o,secondaryRevs:i}=Et;console.log("[Blockscape] selecting id=",e,"deps=",Array.from(t),"revs=",Array.from(n));const a=fe.get(e);a&&a.el.classList.add("selected"),t.forEach(b=>Yi(b,"dep")),n.forEach(b=>Yi(b,"revdep")),o.forEach(b=>{!t.has(b)&&b!==e&&Yi(b,"dep-indirect")}),i.forEach(b=>{!n.has(b)&&!t.has(b)&&b!==e&&Yi(b,"revdep-indirect")}),Sn();const s=(h=(u=(l=fe.get(e))==null?void 0:l.el)==null?void 0:u.dataset)==null?void 0:h.externalUrl;s&&On("This item has link to",Kn,s),_a()}function Un(e,{scrollIntoView:t=!0,preserveEntryHint:n=!1}={}){var s,l;if(!((s=v==null?void 0:v.m)!=null&&s.categories)||!e)return!1;const i=(v.m.categories||[]).find(u=>u.id===e);if(!i)return!1;uo(),Va(),n||(ot=null),Fe=i.id,Kt(),Jo();const a=Ht.get(i.id);return t&&(a!=null&&a.el)&&(a.el.scrollIntoView({behavior:"smooth",block:"center"}),(l=a.headEl)==null||l.focus({preventScroll:!0})),!0}function Jo(){if(Ht.forEach(({el:t,headEl:n})=>{t.classList.remove("category--selected"),n&&n.removeAttribute("aria-current")}),!Fe)return;const e=Ht.get(Fe);if(!(e!=null&&e.el)){Fe=null,ot=null,Kt();return}e.el.classList.add("category--selected"),e.headEl&&e.headEl.setAttribute("aria-current","true")}function ui(){if(Fe)return Fe;const e=K?fe.get(K):null;return e!=null&&e.catId?e.catId:null}function tu(e){var a,s,l,u;if(!((s=(a=v==null?void 0:v.m)==null?void 0:a.categories)!=null&&s.length)||!e)return!1;const t=v.m.categories,n=ui();let o=t.findIndex(h=>h.id===n);if(o===-1){const h=((l=t.find(b=>(b.items||[]).length))==null?void 0:l.id)||((u=t[0])==null?void 0:u.id);return h?Un(h):!1}const i=o+e;return i<0||i>=t.length?!1:Un(t[i].id)}function Va(){K=null,Et=null,Xi(),Sn(),_a({itemId:null})}function nu(){Fe=null,ot=null,Jo()}function Ko(){Va(),nu(),ot=null,Kt()}function Xi(){C.querySelectorAll(".tile").forEach(e=>e.classList.remove("dep","revdep","dep-indirect","revdep-indirect","selected"))}function Da(){v!=null&&v.reusedLocal&&v.reusedLocal.forEach(e=>{const t=fe.get(e);if(!t)return;t.el.classList.toggle("reused",Ft);const n=t.el.querySelector(".badge");n&&(n.style.display=Ft?"inline-block":"none")})}function Sn(){for(;F.firstChild;)F.removeChild(F.firstChild);if(!K||F.hidden)return;Et=Xs(K);const e=Et,{primary:t,secondary:n}=kc();e.edges.forEach(o=>{var P,oe;const i=(P=fe.get(o.from))==null?void 0:P.rect,a=(oe=fe.get(o.to))==null?void 0:oe.rect;if(!i||!a)return;const s=Zs(i),l=Zs(a),u=el(Qs(i,l)||s,i,is)||s,h=el(Qs(a,s)||l,a,is)||l,b=document.createElementNS("http://www.w3.org/2000/svg","path"),T=(u.x+h.x)/2,D=u.y,L=(u.x+h.x)/2,B=h.y;b.setAttribute("d",`M ${u.x},${u.y} C ${T},${D} ${L},${B} ${h.x},${h.y}`),b.setAttribute("fill","none"),b.setAttribute("stroke",o.type==="dep"?"var(--blockscape-dep)":"var(--blockscape-revdep)"),b.setAttribute("stroke-opacity",o.depth===1?"0.45":"0.22"),b.setAttribute("stroke-width",o.depth===1?t:n),o.depth>1&&b.setAttribute("stroke-dasharray","4 3"),b.setAttribute("vector-effect","non-scaling-stroke"),F.appendChild(b)})}function Zs(e){return{x:e.left+e.width/2,y:e.top+e.height/2}}function Qs(e,t){if(!e||!t)return null;const n=e.left+e.width/2,o=e.top+e.height/2,i=t.x-n,a=t.y-o;if(i===0&&a===0)return{x:n,y:o};const s=e.width/2,l=e.height/2,u=[];i!==0&&u.push((i>0?s:-s)/i),a!==0&&u.push((a>0?l:-l)/a);const h=Math.min(...u.filter(T=>T>0)),b=Number.isFinite(h)?h:0;return{x:n+i*b,y:o+a*b}}function el(e,t,n=0){if(!e||!t||n<=0)return e;const o=t.left+t.width/2,i=t.top+t.height/2,a=o-e.x,s=i-e.y,l=Math.hypot(a,s);if(!l)return e;const u=Math.min(n,l/2)/l;return{x:e.x+a*u,y:e.y+s*u}}function pi(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function ou(e){const t=(e??"").toString().trim();if(!t)return"";const n=t.endsWith(".md")?t:`${t}.md`,o=new URLSearchParams;return o.set("filepath",n),o.set("data"," "),o.set("mode","append"),Co&&o.set("vault",Co),`obsidian://advanced-uri?${o.toString()}`}function iu(e){return e?oi===$i?e.id??e.name??"":e.name??e.id??"":""}function tl(e,{externalMeta:t,seriesIdLookup:n}={}){var i;if(!_o||!e||(i=n==null?void 0:n.has)!=null&&i.call(n,e.id))return"";const o=iu(e);return ou(o)}function nl(e){var t;if(typeof e=="string"){const n=e.trim();if(!n)return{isExternal:!1,url:""};try{const o=new URL(n);return/^https?:/i.test(o.protocol)?{isExternal:!0,url:o.toString()}:{isExternal:!1,url:""}}catch{}if(!/^[a-z][a-z0-9+.-]*:/i.test(n))try{const o=typeof window<"u"&&((t=window.location)!=null&&t.href)?window.location.href:void 0;return{isExternal:!0,url:o?new URL(n,o).toString():n}}catch(o){return console.warn("[Blockscape] invalid external url skipped",e,o),{isExternal:!1,url:""}}return console.warn("[Blockscape] invalid external url skipped",e),{isExternal:!1,url:""}}return e===!0?{isExternal:!0,url:""}:{isExternal:!1,url:""}}function au(e){const t=document.createElement("button");return t.type="button",t.className="external-link obsidian-link",t.setAttribute("aria-label","Open in Obsidian"),t.title=e,t.textContent="O",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function ru(e){const t=document.createElement("button");return t.type="button",t.className="external-link",t.setAttribute("aria-label","Open external reference in a new tab"),t.title=e,t.textContent="↗",t.addEventListener("click",n=>{n.stopPropagation(),window.open(e,"_blank","noopener")}),t.addEventListener("keydown",n=>n.stopPropagation()),t}function ol(e,t){if(!e)return;const n=e.querySelector(".obsidian-link");if(!t){n&&n.remove(),e.removeAttribute("data-obsidian-url");return}if(e.dataset.obsidianUrl=t,n){n.title=t;return}e.appendChild(au(t))}function il(){X||(X=requestAnimationFrame(()=>{X=null,V=V.filter(({labelEl:e,textEl:t})=>(e==null?void 0:e.isConnected)&&(t==null?void 0:t.isConnected)),V.forEach(({labelEl:e,textEl:t})=>{const n=Math.max(t.scrollWidth-e.clientWidth,0);if(n>4){const o=Math.max(4,Math.min(14,4+n/30));e.classList.add("version-nav__thumb-label--scroll"),t.style.setProperty("--marquee-distance",`${n}px`),t.style.setProperty("--marquee-duration",`${o}s`)}else e.classList.remove("version-nav__thumb-label--scroll"),t.style.removeProperty("--marquee-distance"),t.style.removeProperty("--marquee-duration")})}))}function su(e,t){!e||!t||(V.push({labelEl:e,textEl:t}),il())}function lu(e,t){var a,s;const n=[`<div class="version-nav__tooltip-title">${pi(t)}</div>`],o=((e==null?void 0:e.version)??((a=e==null?void 0:e.data)==null?void 0:a.version)??"").toString().trim();o&&n.push(`<div class="version-nav__tooltip-meta">Version ${pi(o)}</div>`);const i=(((s=e==null?void 0:e.data)==null?void 0:s.abstract)??"").toString().trim();return i?n.push(`<div class="version-nav__tooltip-body">${i}</div>`):n.push('<div class="version-nav__tooltip-body muted">No info available for this version.</div>'),n.join("")}function fi(e,t,{offset:n=8}={}){!Q||!e||!t||(Q.innerHTML=t,Q.hidden=!1,Q.setAttribute("aria-hidden","false"),requestAnimationFrame(()=>{const o=e.getBoundingClientRect(),i=Q.getBoundingClientRect(),a=window.scrollX||document.documentElement.scrollLeft,s=window.scrollY||document.documentElement.scrollTop;let l=o.left+o.width/2-i.width/2+a,u=o.top-i.height-n+s;l<a+n&&(l=a+n);const h=a+window.innerWidth-i.width-n;l>h&&(l=h),u<s+n&&(u=o.bottom+n+s),Q.style.left=`${l}px`,Q.style.top=`${u}px`,Q.classList.add("is-visible")}))}function Hn(){yn&&(clearTimeout(yn),yn=null),Q&&(Q.classList.remove("is-visible"),Q.setAttribute("aria-hidden","true"),Q.hidden=!0)}function cu(e,t){if(!e)return;const n=Je((t==null?void 0:t.data)||t,"Series version");e.title=n,e.setAttribute("aria-label",n);const o=lu(t,n);let i=null;const a=()=>{i&&(clearTimeout(i),i=null)},s=()=>{E=e,fi(e,`<div class="version-nav__tooltip-title">${pi(n)}</div>`,{offset:10})},l=()=>{a(),i=setTimeout(()=>{E===e&&fi(e,o,{offset:10})},ye)},u=()=>{s(),l()},h=()=>{E!==e&&s(),l()},b=()=>{a(),E===e&&(E=null,Hn())};e.addEventListener("mouseenter",u),e.addEventListener("focus",u),e.addEventListener("pointermove",h),e.addEventListener("mouseleave",b),e.addEventListener("blur",b),e.addEventListener("click",b)}function du(){d&&(d=!1,!(!nn||!En)&&(Hn(),fi(nn,En,{offset:12}),yn=setTimeout(()=>{Hn(),uu()},1e3)))}function uu(){nn&&(y&&(clearTimeout(y),y=null),nn.classList.add("blockscape-tab--twinkle"),y=setTimeout(()=>{nn.classList.remove("blockscape-tab--twinkle"),y=null},1400))}window.addEventListener("scroll",Hn,!0),window.addEventListener("resize",Hn),Oe&&Oe.addEventListener("click",()=>{$d()}),pe&&pe.addEventListener("click",()=>{Rd()}),at&&at.addEventListener("click",()=>{try{Ad(),kd()}catch(e){console.error("[Blockscape] failed to create blank series",e),alert((e==null?void 0:e.message)||"Unable to create a blank map right now.")}}),qe&&qe.addEventListener("click",Ra),O&&O.addEventListener("click",Ra),k&&k.addEventListener("click",Ji),ee&&ee.addEventListener("click",Ji),C&&C.addEventListener("contextmenu",e=>{const t=e.target.closest(".tile");Nn||!t||!C.contains(t)||bd(e,t)}),document.addEventListener("click",e=>{typeof e.button=="number"&&e.button!==0||wd(e)}),je&&je.addEventListener("click",()=>{Ps("button")}),W&&W.addEventListener("click",()=>{if(g<0){alert("Load or select a model before creating a version.");return}try{const e=Os({versionLabel:"map edit"});It(e),console.log("[Blockscape] created new version from map view")}catch(e){alert((e==null?void 0:e.message)||"Unable to create a new version right now.")}}),ze&&ze.addEventListener("click",async()=>{var a;if(g<0||!S[g]){alert("Select or load a model before sharing.");return}const e={title:Je(S[g],"Shared Model"),data:S[g].data};let t;try{t=fc(JSON.stringify(e))}catch(s){console.error("[Blockscape] share encode failed",s),alert("Unable to encode this model for sharing.");return}const n=new URL(window.location.href);n.searchParams.delete("share"),n.hash=`share=${t}`;const o=n.toString();try{window.history.replaceState({},document.title,o)}catch(s){console.warn("[Blockscape] failed to update URL for share",s),window.location.hash=n.hash}let i=!1;if((a=navigator.clipboard)!=null&&a.writeText)try{await navigator.clipboard.writeText(o),i=!0}catch(s){console.warn("[Blockscape] clipboard write failed",s)}i?alert("Share URL copied to clipboard."):window.prompt("Copy this share URL:",o)}),Y&&Y.addEventListener("click",()=>{const e=(f.value||"").trim();if(!e){alert("Load or paste a model before opening the editor.");return}try{JSON.parse(e)}catch{alert("Current JSON is invalid. Fix it before opening the editor.");return}try{const n={ts:Date.now(),text:e,source:"viewer"};K&&(n.selectedItemId=K),localStorage.setItem(rt,JSON.stringify(n))}catch(n){console.error("[Blockscape] failed to store editor payload",n),alert("Unable to stash JSON for the editor (storage disabled?).");return}let t="editor.html#viewer";K&&(t=`editor.html?selected=${encodeURIComponent(K)}#viewer`),window.open(t,"_blank")}),typeof window<"u"&&(window.addEventListener("storage",e=>{if(!e||e.storageArea&&e.storageArea!==window.localStorage||e.key!==rt||!e.newValue)return;let t;try{t=JSON.parse(e.newValue)}catch(n){console.warn("[Blockscape] storage payload parse failed",n);return}!t||t.source!=="editor"||Ks("storage-event")}),window.addEventListener("message",e=>{if(!e||!e.data)return;const t=window.location.origin;if(t&&t!=="null"){if(e.origin!==t)return}else if(e.origin&&e.origin!=="null")return;typeof e.data=="object"&&e.data!==null&&e.data.type===ct&&Ks("message")})),document.addEventListener("keydown",e=>{var o,i,a,s,l,u,h,b,T,D;if(Bd()){e.key==="Escape"&&(e.preventDefault(),Ra());return}if(!(Z!=null&&Z.hidden)&&e.key==="Escape"){e.preventDefault(),Ji();return}if((o=co==null?void 0:co.isOpen)==null?void 0:o.call(co))return;const n=Nn;if((e.ctrlKey||e.metaKey)&&e.code==="KeyS"){e.preventDefault();const L=S[g],B=((i=L==null?void 0:L.apicurioVersions)==null?void 0:i.length)>1;Ps("shortcut",B);return}if((e.ctrlKey||e.metaKey)&&!e.altKey&&!e.shiftKey&&e.key&&e.key.toLowerCase()==="z"){if(!po())return;if(Eu()){e.preventDefault();return}}if(e.key==="Escape"){let L=!1;te&&!te.hidden&&(uo(),L=!0),(K||Fe)&&(Ko(),L=!0),L&&e.preventDefault()}if(e.key==="ArrowLeft"||e.key==="ArrowRight"){if(n||!po())return;const L=e.key==="ArrowLeft"?-1:1;if(e.altKey)return;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){Pa(L)&&e.preventDefault();return}if(e.ctrlKey||e.metaKey)return;if(Fe&&!e.shiftKey){e.preventDefault();return}e.shiftKey?hu(L)&&e.preventDefault():gu(L)&&e.preventDefault()}if(e.key==="ArrowUp"||e.key==="ArrowDown"){if(n||!po())return;const L=e.key==="ArrowUp"?-1:1;if((e.ctrlKey||e.metaKey)&&!e.altKey){yu(L)&&e.preventDefault();return}if(e.altKey)return;if(Fe&&!K&&!e.shiftKey){if(wu(L)){e.preventDefault();return}if(tu(L)){e.preventDefault();return}}e.shiftKey?vu(L)&&e.preventDefault():bu(L)&&e.preventDefault()}if(e.key==="Delete"){if(n||!po()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;const L=Fe?Iu():!1,B=L?!0:rl();(L||B)&&e.preventDefault()}if(e.key==="F2"){if(n||!po())return;const L=Fe&&!K&&Fe||!K&&((u=(l=(s=(a=e.target)==null?void 0:a.closest)==null?void 0:s.call(a,".category"))==null?void 0:l.dataset)==null?void 0:u.cat)||null;if(L&&!K&&mu(L)){e.preventDefault();return}const B=K||((D=(T=(b=(h=e.target)==null?void 0:h.closest)==null?void 0:b.call(h,".tile"))==null?void 0:T.dataset)==null?void 0:D.id);B&&co.open(B)&&e.preventDefault()}if(e.key==="Insert"){if(n||!po()||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)return;al()&&e.preventDefault()}}),window.addEventListener("resize",()=>{vd()}),window.addEventListener("scroll",()=>yd(),!0);function pu(e,t,n){if(g<0)return;const i=S[g].data.categories||[],a=i.find(b=>(b.items||[]).some(T=>T.id===e)),s=i.find(b=>b.id===n);if(!a||!s)return;a.items=a.items||[],s.items=s.items||[];const l=a.items.findIndex(b=>b.id===e);if(l===-1)return;const[u]=a.items.splice(l,1);let h=s.items.length;if(t){const b=s.items.findIndex(T=>T.id===t);b!==-1&&(h=b)}s.items.splice(h,0,u),Pt(),Mt()}function fu(e){if(g<0||!e)return;const t=S[g].data,o=(t.categories||[]).find(u=>u.id===e);if(!o)return;o.items=o.items||[];const i=`New item ${o.items.length+1}`,s={id:fd(`${e}-${o.items.length+1}`,t),name:i,deps:[]};o.items.push(s),Pt(),Mt(),uo(),Nt(s.id);const l=fe.get(s.id);l!=null&&l.el&&l.el.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),console.log("[Blockscape] added item",s.id,"to",e)}function al(){if(g<0)return!1;const e=S[g].data;e.categories=e.categories||[];const t=`New category ${e.categories.length+1}`,n=md(t,e),o={id:n,title:t,items:[]};return e.categories.push(o),Fe=n,K=null,Et=null,ot=null,Pt(),Mt(),Un(n),console.log("[Blockscape] added category",n),!0}function mu(e=ui()){if(g<0||!e)return!1;const t=gd.open(e);return t&&(K=null,Et=null,Kt()),t}function hu(e){if(!K||g<0||!e)return!1;const n=S[g].data.categories||[],o=fe.get(K);let i=null;if(o!=null&&o.catId&&(i=n.find(u=>u.id===o.catId)),i||(i=n.find(u=>(u.items||[]).some(h=>h.id===K))),!i)return!1;i.items=i.items||[];const a=i.items.findIndex(u=>u.id===K);if(a===-1)return!1;const s=a+e;if(s<0||s>=i.items.length)return!1;const[l]=i.items.splice(a,1);return i.items.splice(s,0,l),Pt(),Mt(),di(),Nt(K),!0}function gu(e){if(!v||!v.m||!e)return!1;const t=v.m.categories||[];if(!t.length)return!1;const n=()=>{const u=t.find(h=>(h.items||[]).length);return u?{category:u,item:u.items[0]}:null};if(!K){const u=n();return u?(Nt(u.item.id),!0):!1}const o=fe.get(K);let i=null;if(o!=null&&o.catId&&(i=t.find(u=>u.id===o.catId)),i||(i=t.find(u=>(u.items||[]).some(h=>h.id===K))),!i){const u=n();return u?(Nt(u.item.id),!0):!1}const a=i.items||[];if(!a.length)return!1;const s=a.findIndex(u=>u.id===K);if(s===-1)return!1;const l=s+e;return l<0||l>=a.length?!1:(Nt(a[l].id),!0)}function bu(e){if(!v||!v.m||!e)return!1;const t=v.m.categories||[];if(!t.length)return!1;const n=ui();let o=t.findIndex(s=>s.id===n),i=o+e;if(o===-1&&(i=e>0?0:t.length-1),i<0||i>=t.length)return!1;const a=t[i];if(K){const l=(t[o].items||[]).findIndex(u=>u.id===K);ot={catId:a.id,position:l===-1?0:l}}else ot=null;return Un(a.id,{preserveEntryHint:!0})}function wu(e){var a;if(!Fe||!((a=v==null?void 0:v.m)!=null&&a.categories)||!e)return!1;const n=(v.m.categories||[]).find(s=>s.id===Fe);if(!n)return!1;const o=n.items||[];if(!o.length)return!1;let i=e>0?0:Math.max(0,o.length-1);return(ot==null?void 0:ot.catId)===n.id&&(i=Math.min(o.length-1,Math.max(0,ot.position||0))),ot=null,Nt(o[i].id),!0}function vu(e){if(!K||g<0||!e)return!1;const n=S[g].data.categories||[];if(!n.length)return!1;const o=fe.get(K);let i=-1;if(o!=null&&o.catId&&(i=n.findIndex(T=>T.id===o.catId)),i===-1&&(i=n.findIndex(T=>(T.items||[]).some(D=>D.id===K))),i===-1)return!1;const a=i+e;if(a<0||a>=n.length)return!1;const s=n[i],l=n[a];if(!l)return!1;s.items=s.items||[],l.items=l.items||[];const u=s.items.findIndex(T=>T.id===K);if(u===-1)return!1;const h=Math.min(l.items.length,Math.max(0,u)),b=h<l.items.length?l.items[h].id:null;return pu(K,b,l.id),di(),Nt(K),!0}function yu(e){if(g<0||!e)return!1;const n=S[g].data.categories||[];if(!n.length)return!1;const o=ui();if(!o)return!1;const i=n.findIndex(l=>l.id===o);if(i===-1)return!1;const a=i+e;if(a<0||a>=n.length)return!1;const[s]=n.splice(i,1);return n.splice(a,0,s),Fe=s.id,Va(),ot=null,Kt(),Pt(),Mt(),Jo(),console.log("[Blockscape] moved category",s.id,"from",i,"to",a),!0}function Eu(){if(g<0)return!1;const e=S[g],t=dt(e)||(e?e.id:null),n=[];if(Wt&&t===Wt.modelId&&n.push({...Wt,type:"item"}),Rt&&t===Rt.modelId&&n.push({...Rt,type:"category"}),!n.length)return!1;const o=n.reduce((i,a)=>i?(a.ts||0)>(i.ts||0)?a:i:a,null);if(!o)return!1;if(o.type==="category"){if(ku(o))return!0}else if(o.type==="item"&&Su(o))return!0;return!1}function Su(e){const t=S[g],n=dt(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const a=(t.data.categories||[]).find(l=>l.id===e.categoryId);if(!a)return!1;a.items=a.items||[];const s=Math.min(Math.max(e.index,0),a.items.length);return a.items.splice(s,0,e.item),Wt=null,uo(),K=null,Et=null,Kt(),Pt(),Mt(),di(),Nt(e.item.id),console.log("[Blockscape] undo delete restored",e.item.id),!0}function ku(e){const t=S[g],n=dt(t)||(t?t.id:null);if(!t||n!==e.modelId)return!1;const o=t.data;o.categories=o.categories||[];const i=Math.min(Math.max(e.index,0),o.categories.length);return o.categories.splice(i,0,e.category),Rt=null,K=null,Et=null,Fe=e.category.id,ot=null,Kt(),Pt(),Mt(),Jo(),Un(e.category.id),console.log("[Blockscape] undo delete restored category",e.category.id),!0}function rl(){if(!K||g<0)return!1;const t=S[g].data.categories||[];if(!t.length)return!1;const n=fe.get(K);let o=null;if(n!=null&&n.catId&&(o=t.find(h=>h.id===n.catId)),o||(o=t.find(h=>(h.items||[]).some(b=>b.id===K))),!o||!Array.isArray(o.items))return!1;const i=o.items.findIndex(h=>h.id===K);if(i===-1)return!1;const a=o.items.splice(i,1)[0];if(!a)return!1;const s=S[g];Wt={item:a,categoryId:o.id,index:i,modelId:dt(s)||(s?s.id:null),ts:Date.now()};const u=(()=>{var b;if(o.items.length){const T=Math.min(i,o.items.length-1);return((b=o.items[T])==null?void 0:b.id)||null}const h=t.findIndex(T=>T.id===o.id);if(h===-1)return null;for(let T=h+1;T<t.length;T++){const D=t[T].items||[];if(D.length)return D[0].id}for(let T=h-1;T>=0;T--){const D=t[T].items||[];if(D.length)return D[0].id}return null})();return uo(),K=null,Et=null,ot=null,Kt(),Pt(),Mt(),di(),u?Nt(u):Ko(),console.log("[Blockscape] removed item",a.id),!0}function Iu(){var l,u;const e=ui();if(!e||g<0)return!1;const n=S[g].data.categories||[];if(!n.length)return!1;const o=n.findIndex(h=>h.id===e);if(o===-1)return!1;const[i]=n.splice(o,1);if(!i)return!1;const a=S[g];Rt={category:i,index:o,modelId:dt(a)||(a?a.id:null),ts:Date.now()},Fe=null,K=null,Et=null,ot=null,Kt(),Pt(),Mt();const s=((l=n[o])==null?void 0:l.id)||((u=n[o-1])==null?void 0:u.id)||null;return s?Un(s):Ko(),console.log("[Blockscape] removed category",i.id),!0}function _u(e){if(!e)return!1;const t=K;K=e;const n=rl();return n||(K=t,Kt()),n}we&&we.addEventListener("click",async()=>{const e=f.value||"";if(!e.trim()){alert("JSON editor is empty.");return}await ws(e)?alert("JSON copied to clipboard."):window.prompt("Copy this JSON manually:",e)}),R&&R.addEventListener("click",async()=>{const e=Id();if(!e){alert("No series available to copy. Create another version first.");return}await ws(e)?alert("Series JSON copied to clipboard."):window.prompt("Copy this series JSON manually:",e)}),_e&&_e.addEventListener("click",async()=>{try{const e=await Nc();if(!e){alert("Clipboard is empty.");return}f.value=e,f.focus()}catch(e){console.warn("[Blockscape] clipboard read failed",e),alert("Unable to read from the clipboard. Use Cmd/Ctrl+V inside the editor instead.")}}),document.getElementById("appendFromBox").onclick=async()=>{try{const e=await ci(),t=Vn(f.value,"Pasted",{promptForSeriesName:!e});if(!t.length){alert("No valid JSON found to append.");return}console.log("[Blockscape] appending",t.length,"model(s)");let n=null;const o=[];t.forEach((i,a)=>{const s=xn(i,{versionLabel:t.length>1?`paste #${a+1}`:"paste"});n==null&&(n=s),o.push(s)}),g===-1&&n!=null?It(n):Pn(),e&&await sl(o,{origin:"append"})}catch(e){console.error("[Blockscape] append error:",e),alert("Append error (see console).")}},document.getElementById("replaceActive").onclick=()=>{var e;if(g<0){alert("No active model selected.");return}try{const t=JSON.parse(f.value);if(Cn(t,{titleHint:Je(S[g]),idHint:dt(S[g])||Je(S[g])}),S[g].data=t,S[g].title=t.title||S[g].title,S[g].isSeries||((e=S[g].apicurioVersions)==null?void 0:e.length)>1){const n=S[g].title||Je(S[g]);$t(S[g],{seriesName:n,fallbackTitle:n})}Na(),console.log("[Blockscape] replaced active model:",Je(S[g])),Mt(),Le.updateAvailability()}catch(t){console.error("[Blockscape] replace error:",t),alert("JSON parse error (see console).")}},document.getElementById("file").onchange=async e=>{const t=Array.from(e.target.files||[]);if(t.length)try{console.log("[Blockscape] reading",t.length,"file(s)");let n=null;for(const o of t){const i=await o.text(),a=o.name.replace(/\.[^.]+$/,"")||"File",s=Vn(i,a,{seriesTitleOverride:`${a} series`});if(!s.length){console.warn("[Blockscape] no models in file:",o.name);continue}s.forEach((l,u)=>{var P;const h=(((P=l.data)==null?void 0:P.title)??"").toString().trim(),b=s.length>1?`${o.name} #${u+1}`:o.name,T=`${a} series`,D=l.isSeries?T:null;let L={...l};if(l.isSeries){const oe=D||h||l.title||b||"unknown";L.title=oe;const Be=wn(oe||"unknown");lo(L,Be),$t(L,{seriesName:oe,fallbackTitle:"unknown"}),L.apicurioArtifactName=L.apicurioArtifactName||oe}else L.title=h||b;const B=xn({...L,apicurioArtifactName:L.apicurioArtifactName||D||L.apicurioArtifactName},{versionLabel:o.name});n==null&&(n=B)})}g===-1&&n!=null?It(n):Pn()}catch(n){console.error("[Blockscape] file load error:",n),alert("File load error (see console).")}finally{e.target.value=""}},document.addEventListener("paste",Cu);async function Cu(e){var a;if(!po())return;const t=((a=e.clipboardData)==null?void 0:a.getData("text/plain"))||window.clipboardData&&window.clipboardData.getData("Text")||"";if(!Wd(t))return;let n=[];try{const s=await ci();n=Vn(t,"Clipboard",{promptForSeriesName:!s})}catch(s){console.warn("[Blockscape] clipboard paste ignored (invalid JSON)",s);return}if(!n.length)return;e.preventDefault();let o=null;const i=[];n.forEach((s,l)=>{const u=xn(s,{versionLabel:n.length>1?`paste #${l+1}`:"paste"});o==null&&(o=u),i.push(u)}),console.log(`[Blockscape] pasted ${n.length} model(s) from clipboard`),o!=null&&It(o),await ci()&&await sl(i,{origin:"clipboard"})}async function sl(e,{origin:t="clipboard"}={}){if(!await ci()||typeof(Ke==null?void 0:Ke.saveModelByIndex)!="function")return;const o=(Array.isArray(e)?e:[]).filter(D=>{const L=S[D];return L&&!L.sourcePath});if(!o.length)return;const i=o.length===1?"model":"models",a=S[o[0]],s=Oc(a,t==="append"?"pasted":"clipboard");if(typeof window>"u"||typeof window.prompt!="function")return;const l=window.prompt(`Save pasted ${i} as a new .bs file (under ~/blockscape):`,s);if(l==null)return;const u=so(l);if(!u){alert("Enter a relative filename (no ..) to save under ~/blockscape.");return}const h=await $c(),b=[];for(let D=0;D<o.length;D++){const L=o.length===1?u:Bc(u,D+1),B=Rc(L,h);if(!B){alert("Could not find a unique filename to save.");return}h.add(B),b.push(B)}let T=null;for(let D=0;D<o.length;D++){const L=o[D],B=b[D],P=S[L];if(!P)continue;o.length===1&&Pc(P,B);const oe=await Ke.saveModelByIndex(L,B,{refreshAfter:!1,statusPrefix:"Auto-saved to"});if(!(oe!=null&&oe.ok)){alert(`Local auto-save failed: ${(oe==null?void 0:oe.error)||"unknown error"}`);return}T==null&&(T=B)}T&&Hi(T),await Ke.refresh(),Pn(),On(`Saved ${o.length} ${i}.`,2500)}J.addEventListener("click",e=>{const t=e.target.closest("button[data-index]");if(!t)return;const n=parseInt(t.dataset.index,10);Number.isInteger(n)&&It(n)}),document.getElementById("removeModel").onclick=()=>{if(g<0)return;const e=Je(S[g]);if(!window.confirm(`Remove "${e}" from this session?`))return;if(console.log("[Blockscape] removing model:",Je(S[g])),S.splice(g,1),!S.length){g=-1,v=null,C.innerHTML="",F.innerHTML="",f.value="",Pn(),Na();return}const n=Math.min(g,S.length-1);It(n)},ke&&(ke.addEventListener("input",e=>{Fs(e.target.value||"")}),ke.addEventListener("focus",()=>{ke.value&&ke.value.trim()&&Hs(ke.value)})),ge&&ge.addEventListener("click",e=>{const t=e.target.closest(".search-result");if(!t)return;const n=parseInt(t.dataset.modelIndex||"-1",10),o=t.dataset.itemId;Vd({modelIndex:n,itemId:o})}),document.addEventListener("click",e=>{if(!ge||ge.hidden)return;const t=e.target;ge.contains(t)||ke&&(t===ke||ke.contains(t))||(ge.hidden=!0)}),x&&re&&j&&x.addEventListener("submit",async e=>{e.preventDefault();const t=re.value.trim();if(!t){alert("Please enter a URL"),re.focus();return}const n=await Ua(t);if(typeof n=="number"){It(n),re.value="";const o=document.getElementById("urlHint");o&&(o.textContent="")}}),function(){const t=document.getElementById("urlHint");if(!re||!t)return;let n=null;re.addEventListener("input",()=>{clearTimeout(n),n=setTimeout(()=>{const i=re.value.slice(-12);t.textContent=i?`…${i}`:""},300)})}();function Mt(){if(!(g<0))try{Ki(S[g]),v=Kd(S[g].data),di()}catch(e){console.error("[Blockscape] rebuild error (active model likely malformed):",e),alert("Active model parse/render error (see console).")}}async function xu(){const e=["comms.bs","planets.bs","styleguide.bs","blockscape-features.bs"],t=n=>Bi?Bi.endsWith("/")?`${Bi}${n}`:`${Bi}/${n}`:n;for(const n of e)try{const o=await fetch(t(n),{cache:"no-store"});if(!o.ok){console.warn(`[Blockscape] ${n} not fetched (${o.status}); skipping`);continue}const i=await o.text(),a=n.replace(/\.[^.]+$/,"")||"Model",s=Vn(i,a,{seriesTitleOverride:`${a} series`});if(!s.length){console.warn("[Blockscape] no models found in",n);continue}s.forEach(l=>{let u={...l};if(l.isSeries){const h=`${a} series`;u={...l,title:h,apicurioArtifactName:h};const b=wn(h||"unknown");lo(u,b),$t(u,{seriesName:h,fallbackTitle:"unknown"})}xn(u,{versionLabel:n})}),console.log(`[Blockscape] loaded ${s.length} model(s) from ${n}`)}catch(o){console.log("[Blockscape] could not load",n,"- this is normal for file:// protocol",o)}Pn()}async function ll(e){const t=[{cache:"no-store"},{cache:"reload"},{}];let n=null;for(const o of t)try{console.log(`[Blockscape] fetching ${e} with cache="${o.cache??"default"}"`);const i=await fetch(e,o);if(i.status===304){console.warn("[Blockscape] fetch returned 304 (Not Modified), retrying without cache");continue}if(!i.ok)throw new Error(`HTTP ${i.status}: ${i.statusText}`);return await i.text()}catch(i){n=i}throw n||new Error("Unable to fetch URL")}function Au(e){if(!e)return;const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT),n=[];for(;t.nextNode();)n.push(t.currentNode);n.forEach(o=>Tu(o)),e.querySelectorAll("a[href]").forEach(o=>{const i=o.getAttribute("href");dl(i)&&cl(o,i)})}function Tu(e){var l,u;if(!e||!e.nodeValue||!e.nodeValue.includes("http")||(u=(l=e.parentNode)==null?void 0:l.closest)!=null&&u.call(l,"a"))return;const t=e.nodeValue,n=/(https?:\/\/[^\s<]+)/gi,o=[];let i;for(;(i=n.exec(t))!==null;)o.push({url:i[0],index:i.index});if(!o.length)return;const a=document.createDocumentFragment();let s=0;o.forEach(({url:h,index:b})=>{b>s&&a.appendChild(document.createTextNode(t.slice(s,b))),a.appendChild(Lu(h)),s=b+h.length}),s<t.length&&a.appendChild(document.createTextNode(t.slice(s))),e.parentNode.replaceChild(a,e)}function Lu(e){const t=document.createElement("a");return t.href=e,t.textContent=e,t.target="_blank",t.rel="noopener noreferrer",dl(e)&&cl(t,e),t}function cl(e,t){!e||e.dataset.gistLinkBound==="true"||(e.dataset.gistLinkBound="true",e.classList.add("blockscape-gist-link"),e.title="Load this Gist into Blockscape",e.addEventListener("click",n=>Nu(n,t,e)))}async function Nu(e,t,n){if(e.preventDefault(),e.stopPropagation(),!(!t||n.dataset.loading==="true")){n.dataset.loading="true",n.classList.add("is-loading");try{await Ua(t)}finally{n.dataset.loading="false",n.classList.remove("is-loading")}}}function dl(e){if(typeof e!="string")return!1;try{const n=new URL(e,window.location.href).hostname.toLowerCase();return n==="gist.githubusercontent.com"||n.startsWith("gist.")&&n.endsWith("githubusercontent.com")}catch{return!1}}async function Ua(e){try{console.log("[Blockscape] loading from URL:",e);const t=await ll(e),o=(e.split("/").pop()||"").replace(/\.[^.]+$/,"")||"URL Model";let i;try{i=Vn(t,o)}catch(s){throw new Error(`Invalid JSON payload: ${s.message}`)}if(!i.length)throw new Error("No JSON objects found in response.");let a=null;return i.forEach((s,l)=>{var L;const u=(((L=s.data)==null?void 0:L.title)??"").toString().trim(),h=i.length>1?`${o} #${l+1}`:o,b=s.isSeries?`${o} series`:null;let T={...s};if(s.isSeries){const B=b||u||T.title||h;T={...s,title:B,apicurioArtifactName:B||s.apicurioArtifactName};const P=wn(B||"unknown");lo(T,P),$t(T,{seriesName:B||b||"unknown",fallbackTitle:"unknown"}),console.log("[Blockscape] loadFromUrl: series slug applied",{seriesSlug:P,url:e,baseName:o,seriesTitle:B})}const D=xn({...T,title:u||T.title||h,apicurioArtifactName:T.apicurioArtifactName||b||s.apicurioArtifactName},{versionLabel:o});a==null&&(a=D)}),console.log(`[Blockscape] loaded ${i.length} model(s) from URL:`,o),g===-1&&a!=null?It(a):Pn(),a}catch(t){return console.error("[Blockscape] URL load error:",t),alert(`Failed to load JSON from URL: ${t.message}`),null}}(async function(){const t=document.getElementById("seed");if(!t)throw new Error("Seed template not found in document.");const n=(t.textContent||t.innerHTML||"").trim();if(!n)throw new Error("Seed template is empty.");const o=Vn(n,"Blockscape");if(!o.length)throw new Error("Seed template could not be parsed.");let i=null;o.forEach(L=>{const B=xn(L,{versionLabel:"seed"});i==null&&(i=B)}),await gc(),!await cs&&c.autoLoadFromDir&&await xu();const s=await zd(),l=typeof(s==null?void 0:s.modelIndex)=="number"?s.modelIndex:null,u=await Jd(),h=Js(),b=h==null?void 0:h.index,T=jd(),D=typeof l=="number"?l:typeof u=="number"?u:typeof T=="number"?T:typeof b=="number"?b:i??0;It(D),s!=null&&s.itemId&&typeof s.modelIndex=="number"&&s.modelIndex===D&&requestAnimationFrame(()=>{var B;if(g!==s.modelIndex)return;const L=(B=fe.get(s.itemId))==null?void 0:B.el;L&&(Nt(s.itemId),L.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),L.focus({preventScroll:!0}))})})()}const Kl=r=>typeof r=="string"&&r.endsWith("/")?r:`${r||"/"}/`;function Gl(){if(typeof window>"u"||!window.location)return"/";const r=(window.location.pathname||"/").split("/").filter(Boolean);return!r.length||r[0].toLowerCase()==="server"?"/":`/${r[0]}/`}function ql(r){return Kl(Gl())}const Yl=`${ql()}documentation/`;function Xl(r){let c;return{c(){c=H("div"),c.innerHTML=`<div id="shortcutHelpBackdrop" class="shortcut-help__backdrop"></div> <div class="shortcut-help__panel" tabindex="-1"><div class="shortcut-help__header"><div class="shortcut-help__title"><h2 id="shortcutHelpTitle">Help</h2></div> <button id="shortcutHelpClose" class="shortcut-help__close" type="button" aria-label="Close keyboard shortcuts">×</button></div> <section class="shortcut-help__section"><ul class="shortcut-help__tips"><li>Play around with the example maps.</li> <li>Open the <a href="${Yl}">documentation</a>.</li> <li>Read about <a href="https://www.wardleymaps.com" target="_blank" rel="noreferrer noopener">Wardley Maps</a>.</li> <li>Copy this URL and use &quot;Load URL&quot;: <a href="https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs" target="_blank" rel="noreferrer noopener">https://gist.githubusercontent.com/pwright/86dbb074b35d6d17671bf17ecbf1a824/raw/git.bs</a></li> <li>Edit maps by moving items with Shift + Arrow keys.</li></ul></section> <section class="shortcut-help__section"><h3 class="shortcut-help__section-title">Keyboard shortcuts</h3> <div id="shortcutHelpList" class="shortcut-help__list" aria-live="polite"></div></section></div>`,w(c,"id","shortcutHelp"),w(c,"class","shortcut-help"),c.hidden=!0,w(c,"aria-hidden","true"),w(c,"role","dialog"),w(c,"aria-modal","true"),w(c,"aria-labelledby","shortcutHelpTitle")},m(f,A){yt(f,c,A)},p:Tt,i:Tt,o:Tt,d(f){f&&ft(c)}}}class Zl extends Ni{constructor(c){super(),Li(this,c,null,Xl,_i,{})}}const Ql=`Generate a blockscape [map|series] for the domain of [DOMAIN]

### Requirements

* Output **valid JSON only** with the structure below (no commentary):

  * Model level:
    * \`id\`: required string, short/sluggy (lowercase, hyphen/underscore ok)
    * \`title\`: required string, human‑friendly model title
    * \`abstract\`: optional string (plain text or simple HTML) that explains the landscape
    * \`categories\`: array of category objects

  * Each category has:
    * \`id\` (short, lowercase, unique)
    * \`title\` (human‑friendly)
    * \`items\`: array of component objects

      * each item has:
        * \`id\` (short, lowercase, unique across all categories)
        * \`name\` (human‑friendly)
        * optional \`logo\` (e.g., \`"logos/[slug].svg"\`)
        * optional \`external\` (string URL) pointing to external documentation or reference material for that item
        * optional \`color\` (hex string) for tile tint
        * optional \`deps\`: array of item \`id\`s this item **depends on** (when present, must reference defined items only)
* Use **3–6/7 categories** and **2–6/7 items per category**. Prefer clarity over exhaustiveness.
* Order categories roughly from **abstract to concrete**.
* Model **visible user value** via **vertical position** (things closer to the user are higher). Ensure \`deps\` reflect a flow from higher‑value items to their underlying enablers.
* (Optional) You may imply **horizontal evolution/maturity** via category naming or item grouping, but do not add extra fields for it.
* Keep all identifiers **ASCII**, hyphen‑separated where needed.

### Domain Guidance

In **[one paragraph]**, summarize the domain’s user‑visible goals and the key enabling components. Use that understanding to choose categories and dependencies.

### Output

If the user asks for a 'series', create an array of json using the following criteria.

Return **only the JSON** matching this schema:

\`\`\`
{
  "id": "[model-id]",
  "title": "[Model Title]",
  "abstract": "[Short description or HTML snippet, optional]",
  "categories": [
    {
      "id": "[category-id]",
      "title": "[Category Title]",
      "items": [
        { "id": "[item-id]", "name": "[Item Name]", "deps": ["[id]"] }
      ]
    }
  ]
}
\`\`\`

### Validation Checklist (the model should self‑check before returning):

* Top-level \`id\` and \`title\` are present and non-empty; if \`abstract\` is provided, it is non-empty.
* All provided \`deps\` reference **existing** item IDs.
* No duplicate \`id\`s across all items.
* 3–6/7 categories; each has 2–6/7 items.
* JSON parses.

---

## One‑shot Example (Machine Learning Model Deployment)

**Prompt to paste**

Generate a **Blockscape value‑chain JSON** for the domain of **machine learning model deployment**.

### Requirements

* Output **valid JSON only** with this structure (no commentary).
* Use **3 - 6/7 categories**, **3–6/7 items each**.
* Order from abstract (user‑facing) to concrete (infrastructure).
* Vertical axis is **visible user value**; \`deps\` should point from user‑visible items down to enablers they rely on.
* Optional \`logo\` paths may use placeholders like \`"logos/[slug].svg"\`.

### Domain Guidance

Users need **reliable predictions** surfaced via **APIs/UI**, backed by **versioned models**, **observability**, and **scalable infra**. Security and governance span across.

### Output (JSON only)

\`\`\`
{
  "categories": [
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        { "id": "prediction-api", "name": "Prediction API", "deps": ["model-serving", "authz"], "external": "https://example.com/api.html"},
        { "id": "batch-scoring", "name": "Batch Scoring", "deps": ["feature-store", "orchestration"] },
        { "id": "ui-console", "name": "Ops Console", "deps": ["monitoring", "logging"] }
      ]
    },
    {
      "id": "models",
      "title": "Models & Data",
      "items": [
        { "id": "model-serving", "name": "Model Serving", "deps": ["container-runtime", "autoscaling"] },
        { "id": "model-registry", "name": "Model Registry", "deps": ["artifact-store"] },
        { "id": "feature-store", "name": "Feature Store", "deps": ["data-pipelines"] }
      ]
    },
    {
      "id": "platform",
      "title": "Platform Services",
      "items": [
        { "id": "monitoring", "name": "Monitoring", "deps": ["metrics-backend"] },
        { "id": "logging", "name": "Logging", "deps": ["log-backend"] },
        { "id": "authz", "name": "AuthN/Z", "deps": ["secrets"] },
        { "id": "orchestration", "name": "Orchestration", "deps": ["container-runtime"] }
      ]
    },
    {
      "id": "infrastructure",
      "title": "Infrastructure",
      "items": [
        { "id": "autoscaling", "name": "Autoscaling", "deps": ["metrics-backend"] },
        { "id": "container-runtime", "name": "Container Runtime", "deps": [] },
        { "id": "artifact-store", "name": "Artifact Store", "deps": [] },
        { "id": "data-pipelines", "name": "Data Pipelines", "deps": [] },
        { "id": "metrics-backend", "name": "Metrics Backend", "deps": [] },
        { "id": "log-backend", "name": "Log Backend", "deps": [] },
        { "id": "secrets", "name": "Secrets Management", "deps": [] }
      ]
    }
  ]
}
\`\`\`

---

## Tips

* Keep **names** user‑friendly; keep **ids** short and consistent.
* If an item feels too broad, introduce a new category rather than bloating \`deps\`.
* If there's a link (external), use the favicon from the website as logo
* If you’re unsure about \`logo\`, omit it; you can add paths later.

The following map shows color conventions:

\`\`\`
{
  "id": "conventions",
  "title": "Color Conventions",
  "abstract": "Reference for color conventions.",
  "categories": [
    {
      "id": "color-conventions",
      "title": "Color conventions",
      "items": [
        {
          "id": "old",
          "name": "Old",
          "color": "#000000",
          "deps": []
        },
        {
          "id": "new",
          "name": "New",
          "color": "#FFFFFF",
          "deps": []
        },
        {
          "id": "important",
          "name": "Important",
          "deps": [],
          "color": "#FF0000"
        }
      ]
    }
  ]
}
\`\`\`
`;function Vr(r){let c,f,A,C,F,Q,J,te;return{c(){c=H("div"),f=H("div"),A=H("a"),C=ra("Open Blockscape GPT"),F=ue(),Q=H("div"),Q.textContent="Paste the copied prompt into that chat.",J=ue(),te=H("div"),te.innerHTML='<span>Gem is not available yet</span> <div class="new-panel__hint">https://gemini.google.com/gems/create</div>',w(A,"href",tc),w(A,"target","_blank"),w(A,"rel","noreferrer"),w(Q,"class","new-panel__hint"),w(f,"class","new-panel__link"),w(te,"class","new-panel__link new-panel__link--disabled"),w(c,"class","new-panel__links")},m(x,re){yt(x,c,re),_(c,f),_(f,A),_(A,C),_(f,F),_(f,Q),_(c,J),_(c,te)},p:Tt,d(x){x&&ft(c)}}}function Dr(r){let c,f,A,C,F,Q;return{c(){c=H("div"),f=H("div"),f.textContent="Generated prompt",A=ue(),C=H("textarea"),w(f,"class","new-panel__prompt-label"),w(C,"class","pf-v5-c-form-control new-panel__textarea"),w(C,"rows","4"),C.readOnly=!0,w(c,"class","new-panel__prompt")},m(J,te){yt(J,c,te),_(c,f),_(c,A),_(c,C),eo(C,r[4]),F||(Q=Qn(C,"input",r[12]),F=!0)},p(J,te){te&16&&eo(C,J[4])},d(J){J&&ft(c),F=!1,Q()}}}function ec(r){let c,f,A,C,F,Q,J,te,x,re,j,ae,Me,tt,Ge,je,ze,W,Y,we,R,_e,Oe,pe,at,se,ve,qe,O,Z,k,ee,ke,ge,Ie,$e,m,Re,Ye,nt,He,mt,Xe,rt,ct,ht,S,g=r[2]==="gpt"&&Vr(),Le=r[4]&&r[5]&&Dr(r);return ct=Il(r[10][0]),{c(){c=H("div"),f=H("div"),A=ue(),C=H("div"),F=H("div"),F.innerHTML='<div class="shortcut-help__title"><h2 id="newPanelTitle">New blockscape</h2> <p class="shortcut-help__subtitle">Describe what you need and we will create a prompt for you.</p></div> <button id="newPanelClose" class="shortcut-help__close" type="button" aria-label="Close new panel">×</button>',Q=ue(),J=H("form"),te=H("div"),x=H("label"),x.textContent="Domain",re=ue(),j=H("p"),j.textContent="Describe what you want to create a map for.",ae=ue(),Me=H("textarea"),tt=ue(),Ge=H("div"),je=H("label"),ze=H("input"),W=ue(),Y=H("span"),Y.innerHTML=`Series
            <span class="new-panel__hint">Toggle on to create a series instead of a single map.</span>`,we=ue(),R=H("fieldset"),_e=H("legend"),_e.textContent="Target",Oe=ue(),pe=H("p"),pe.textContent="Choose where you plan to use the prompt.",at=ue(),se=H("label"),ve=H("input"),qe=ue(),O=H("div"),O.innerHTML='<div class="new-panel__option-title">GPT or Gem</div> <div class="new-panel__hint">Copies a simple prompt tailored for GPT or Gem.</div>',Z=ue(),k=H("label"),ee=H("input"),ke=ue(),ge=H("div"),ge.innerHTML='<div class="new-panel__option-title">Plain LLM</div> <div class="new-panel__hint">Creates a large prompt to generate blockscape from scratch.</div>',Ie=ue(),$e=H("div"),m=H("button"),m.textContent="Copy prompt",Re=ue(),Ye=H("button"),Ye.textContent="New blank",nt=ue(),He=H("div"),mt=ra(r[3]),Xe=ue(),g&&g.c(),rt=ue(),Le&&Le.c(),w(f,"id","newPanelBackdrop"),w(f,"class","shortcut-help__backdrop"),w(F,"class","shortcut-help__header"),w(x,"for","newDomain"),w(j,"class","new-panel__hint"),w(Me,"id","newDomain"),w(Me,"class","pf-v5-c-form-control new-panel__textarea"),w(Me,"rows","4"),Me.required=!0,w(Me,"placeholder","Ex: Companies building open-source geospatial tools"),w(te,"class","new-panel__field"),w(ze,"id","seriesToggle"),w(ze,"type","checkbox"),w(je,"class","new-panel__toggle"),w(je,"for","seriesToggle"),w(Ge,"class","new-panel__field"),w(pe,"class","new-panel__hint"),w(ve,"type","radio"),w(ve,"name","target"),ve.__value="gpt",eo(ve,ve.__value),w(se,"class","new-panel__option"),w(ee,"type","radio"),w(ee,"name","target"),ee.__value="plain",eo(ee,ee.__value),w(k,"class","new-panel__option"),w(R,"class","new-panel__field"),w(m,"class","pf-v5-c-button pf-m-primary"),w(m,"type","submit"),w(Ye,"id","newBlankButton"),w(Ye,"class","pf-v5-c-button pf-m-secondary"),w(Ye,"type","button"),w(Ye,"title","Start from an empty map"),w(He,"class","new-panel__status"),w(He,"aria-live","polite"),w($e,"class","new-panel__actions"),w(J,"class","shortcut-help__list new-panel__form"),w(C,"class","shortcut-help__panel"),w(C,"tabindex","-1"),w(c,"id","newPanel"),w(c,"class","shortcut-help"),c.hidden=!0,w(c,"aria-hidden","true"),w(c,"role","dialog"),w(c,"aria-modal","true"),w(c,"aria-labelledby","newPanelTitle"),ct.p(ve,ee)},m(v,fe){yt(v,c,fe),_(c,f),_(c,A),_(c,C),_(C,F),_(C,Q),_(C,J),_(J,te),_(te,x),_(te,re),_(te,j),_(te,ae),_(te,Me),eo(Me,r[0]),_(J,tt),_(J,Ge),_(Ge,je),_(je,ze),ze.checked=r[1],_(je,W),_(je,Y),_(J,we),_(J,R),_(R,_e),_(R,Oe),_(R,pe),_(R,at),_(R,se),_(se,ve),ve.checked=ve.__value===r[2],_(se,qe),_(se,O),_(R,Z),_(R,k),_(k,ee),ee.checked=ee.__value===r[2],_(k,ke),_(k,ge),_(J,Ie),_(J,$e),_($e,m),_($e,Re),_($e,Ye),_($e,nt),_($e,He),_(He,mt),_(J,Xe),g&&g.m(J,null),_(J,rt),Le&&Le.m(J,null),ht||(S=[Qn(Me,"input",r[7]),Qn(ze,"change",r[8]),Qn(ve,"change",r[9]),Qn(ee,"change",r[11]),Qn(J,"submit",kl(r[6]))],ht=!0)},p(v,[fe]){fe&1&&eo(Me,v[0]),fe&2&&(ze.checked=v[1]),fe&4&&(ve.checked=ve.__value===v[2]),fe&4&&(ee.checked=ee.__value===v[2]),fe&8&&Cl(mt,v[3]),v[2]==="gpt"?g?g.p(v,fe):(g=Vr(),g.c(),g.m(J,rt)):g&&(g.d(1),g=null),v[4]&&v[5]?Le?Le.p(v,fe):(Le=Dr(v),Le.c(),Le.m(J,null)):Le&&(Le.d(1),Le=null)},i:Tt,o:Tt,d(v){v&&ft(c),g&&g.d(),Le&&Le.d(),ct.r(),ht=!1,Zo(S)}}}const tc="https://chatgpt.com/g/g-690f6217889c819191786ef16481f534-blockscape";function nc(r,c,f){let A="",C=!1,F="gpt",Q="",J="",te=!1;const x=()=>{var W;return typeof navigator<"u"&&!!((W=navigator.clipboard)!=null&&W.writeText)};function re(W){const Y=W||"[DOMAIN]",we=C?"series":"map",_e=Ql.replaceAll("[DOMAIN NAME]",Y).replaceAll("[DOMAIN]",Y).replaceAll("[map|series]",we).split(`
`),Oe=`Generate a **blockscape ${we}** for the domain of ${Y}.`,pe=_e.findIndex(se=>se.toLowerCase().includes("generate a **blockscape value")||se.toLowerCase().includes("generate a blockscape [map|series]")||se.toLowerCase().startsWith("generate a blockscape"));pe>=0?_e[pe]=Oe:_e.unshift(Oe);const at=C?`

User requested a series (return an array of models).`:"";return`${_e.join(`
`).trim()}${at}`}async function j(W){W.preventDefault();const Y=A.trim();if(f(3,Q=""),f(5,te=F!=="gpt"),!Y){f(3,Q="Add a domain to generate a prompt."),f(4,J="");return}if(F==="gpt"?f(4,J=`${C?"Create a series":"Create a map"} for ${Y}`):(f(4,J=re(Y)),f(5,te=!0)),!x()){f(3,Q="Clipboard access is unavailable. Copy the prompt below."),f(5,te=!0);return}try{await navigator.clipboard.writeText(J),f(3,Q=F==="gpt"?"Prompt copied. Open the Blockscape GPT link to paste it.":"Prompt copied to clipboard."),F==="gpt"&&f(5,te=!1)}catch(R){console.warn("[Blockscape] clipboard write failed",R),f(3,Q="Copy failed. Use the prompt below."),f(5,te=!0)}}const ae=[[]];function Me(){A=this.value,f(0,A)}function tt(){C=this.checked,f(1,C)}function Ge(){F=this.__value,f(2,F)}function je(){F=this.__value,f(2,F)}function ze(){J=this.value,f(4,J)}return[A,C,F,Q,J,te,j,Me,tt,Ge,ae,je,ze]}class oc extends Ni{constructor(c){super(),Li(this,c,nc,ec,_i,{})}}const{document:Ur}=Sl;function ic(r){let c,f,A,C,F,Q,J,te,x,re,j,ae,Me,tt,Ge,je,ze,W,Y,we,R,_e,Oe,pe,at,se,ve,qe,O,Z,k,ee,ke,ge,Ie,$e,m,Re,Ye,nt,He,mt,Xe,rt,ct,ht,S,g,Le,v,fe,Ht,K,Fe,Et,ot,en,Nn,Ft,ln,Wt,Rt,no,Mn,Kn,Ot,Xt,vn,Zt,jt,St,tn,yn,nn,En,d=`<script id="seed" type="application/json">${r[4]}<\/script>`,y,N,M,E,V,X,q,ye,Ee,me,We,Ze,he,Lt,bt;return me=new Zl({}),Ze=new oc({}),{c(){c=H("link"),f=ue(),A=H("div"),C=H("header"),F=H("div"),Q=H("div"),J=H("div"),te=H("div"),te.innerHTML='<h1 class="sr-only">Blockscape</h1> <img class="blockscape-brand__logo" src="logos/blockscape-logo.svg" alt="Blockscape — landscape tile explorer" decoding="async"/>',x=ue(),re=H("div"),j=H("div"),ae=H("button"),Me=H("span"),Me.textContent="Advanced",tt=ue(),Ge=H("span"),Ge.textContent="▾",ze=ue(),W=H("button"),W.textContent="New",Y=ue(),we=H("label"),we.innerHTML='<span>Open</span> <input id="file" type="file" accept=".bs,.json,.txt" multiple=""/>',R=ue(),_e=H("button"),_e.textContent="Share",Oe=ue(),pe=H("button"),pe.textContent="Help",at=ue(),se=H("div"),ve=H("div"),ve.innerHTML='<label class="sr-only" for="search">Search tiles</label> <input id="search" class="pf-v5-c-form-control" type="text" placeholder="Search…"/> <div id="searchResults" class="search-results" role="listbox" aria-label="Search across all models" hidden=""></div>',qe=ue(),O=H("form"),O.innerHTML='<label class="sr-only" for="urlInput">Load JSON from URL</label> <input id="urlInput" name="modelUrl" class="pf-v5-c-form-control is-url" type="url" placeholder="Load JSON from URL…" autocomplete="additional-name"/> <button id="loadUrl" class="pf-v5-c-button pf-m-primary" type="submit">Load URL</button> <div id="urlHint" class="url-hint" aria-live="polite"></div>',Z=ue(),k=H("button"),k.textContent="Edit",Ie=ue(),$e=H("a"),$e.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>',Re=ue(),Ye=H("main"),nt=H("div"),He=H("aside"),mt=H("div"),mt.textContent="Models",Xe=ue(),rt=H("ul"),ct=ue(),ht=H("div"),ht.innerHTML='<button id="removeModel" class="pf-v5-c-button pf-m-tertiary" type="button" title="Remove selected model">Remove active</button> <button id="clear" class="pf-v5-c-button pf-m-tertiary" type="button">Clear selection</button>',S=ue(),g=H("section"),Le=H("div"),Le.textContent="Local files",v=ue(),fe=H("p"),fe.textContent="Checking for local server…",Ht=ue(),K=H("div"),Fe=H("label"),Fe.textContent="Blockscape files under ~/blockscape",Et=ue(),ot=H("div"),en=H("label"),en.textContent="Folder",Nn=ue(),Ft=H("select"),ln=H("option"),ln.textContent="All (~/blockscape)",Wt=ue(),Rt=H("select"),no=ue(),Mn=H("div"),Mn.innerHTML='<button id="refreshLocalFiles" class="pf-v5-c-button pf-m-tertiary" type="button">Refresh</button> <button id="loadLocalFile" class="pf-v5-c-button pf-m-secondary" type="button">Load</button>',Kn=ue(),Ot=H("div"),Ot.innerHTML='<label for="localSavePath">Save active map to ~/blockscape</label> <input id="localSavePath" class="pf-v5-c-form-control" type="text" placeholder="my-map.bs"/> <div class="local-backend__save-actions"><button id="saveLocalFile" class="pf-v5-c-button pf-m-primary" type="button">Save</button> <button id="saveLocalFileAs" class="pf-v5-c-button pf-m-secondary" type="button">Save as</button></div>',vn=ue(),Zt=H("div"),Zt.innerHTML=`<section class="pf-v5-c-page__main-section blockscape-json-panel" hidden="" aria-label="Model source JSON editor"><p class="blockscape-json-panel__title">Paste / edit JSON for the <b>active</b> model (schema below)</p> <div class="muted">Schema: <code>{ id, title, abstract?, categories:[{id,title,items:[{id,name,deps?:[],logo?,external?:url,color?,...}}], ... }</code><br/>
            You can paste multiple objects separated by <code>---</code> or <code>%%%</code>, or a JSON array of models, to append several models.
            A single object replaces only when you click “Replace active with JSON”. Tip: with no input focused, press
            Cmd/Ctrl+V anywhere on the page to append clipboard JSON instantly.</div> <div class="blockscape-json-controls"><textarea id="jsonBox" class="pf-v5-c-form-control" aria-label="JSON editor for the active model"></textarea> <div class="blockscape-json-actions"><button id="copyJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy the current JSON to your clipboard">Copy</button> <button id="copySeries" class="pf-v5-c-button pf-m-tertiary" type="button" title="Copy every version in this series as an array">Copy series</button> <button id="pasteJson" class="pf-v5-c-button pf-m-tertiary" type="button" title="Paste clipboard JSON to replace the editor contents">Paste</button> <button id="appendFromBox" class="pf-v5-c-button pf-m-primary" type="button">Append model(s)</button> <button id="replaceActive" class="pf-v5-c-button pf-m-secondary" type="button">Replace active with
                JSON</button> <button id="createVersion" class="pf-v5-c-button pf-m-secondary" type="button" title="Create a new version from the current map">New version</button></div></div></section> <section class="pf-v5-c-page__main-section blockscape-main-section"><div id="app" aria-live="polite"></div></section>`,jt=ue(),St=H("footer"),tn=H("div"),tn.innerHTML='<a href="https://pwright.github.io/backscape/" target="_blank" rel="noreferrer noopener">Old versions</a>',nn=ue(),En=new xl(!1),y=ue(),N=Tr("svg"),M=ue(),E=H("div"),V=ue(),X=H("div"),q=ue(),ye=H("div"),ye.innerHTML='<div class="item-preview__header"><span class="item-preview__title">Preview</span> <div class="item-preview__actions" hidden=""></div> <button type="button" class="item-preview__close" aria-label="Close preview">×</button></div> <div class="item-preview__body"><div class="item-preview__status">Right-click a tile to see related notes.</div></div>',Ee=ue(),ua(me.$$.fragment),We=ue(),ua(Ze.$$.fragment),Ur.title="Blockscape — simple landscape-style tiles",w(c,"rel","icon"),w(c,"type","image/svg+xml"),w(c,"href","./favicon.svg"),w(te,"class","blockscape-brand"),w(Me,"class","blockscape-toolbar__toggle-label"),w(Ge,"class","blockscape-toolbar__toggle-icon"),w(Ge,"aria-hidden","true"),w(ae,"class","pf-v5-c-button pf-m-secondary blockscape-toolbar__toggle"),w(ae,"type","button"),w(ae,"aria-expanded",r[0]),w(ae,"aria-controls","blockscapeHeaderExtras"),w(ae,"aria-label",je=r[0]?"Hide advanced tools":"Show advanced tools"),w(W,"id","newPanelButton"),w(W,"class","pf-v5-c-button pf-m-primary"),w(W,"type","button"),w(W,"title","Create something new"),w(we,"class","pf-v5-c-button pf-m-primary blockscape-file"),w(_e,"id","shareModel"),w(_e,"class","pf-v5-c-button pf-m-secondary"),w(_e,"type","button"),w(_e,"title","Copy a shareable URL for this model"),w(pe,"id","helpButton"),w(pe,"class","pf-v5-c-button pf-m-primary"),w(pe,"type","button"),w(pe,"title","Show keyboard shortcuts"),w(j,"class","blockscape-toolbar__primary"),w(ve,"class","blockscape-search"),w(O,"id","urlForm"),w(O,"class","blockscape-url-form"),w(O,"autocomplete","on"),O.noValidate=!0,w(k,"id","openInEditor"),w(k,"class","pf-v5-c-button pf-m-secondary"),w(k,"type","button"),w(k,"title","Open current JSON in the editor"),w(se,"id","blockscapeHeaderExtras"),w(se,"class","blockscape-toolbar__extras"),se.hidden=ee=!r[0],w(se,"aria-hidden",ke=!r[0]),w(re,"class","blockscape-toolbar__controls"),w(re,"data-expanded",ge=r[0]?"true":"false"),w($e,"href","https://github.com/pwright/blockscape"),w($e,"target","_blank"),w($e,"class","pf-v5-c-button pf-m-plain blockscape-toolbar__github"),w($e,"title","View on GitHub"),w($e,"aria-label","View Blockscape on GitHub"),w(J,"class","blockscape-toolbar"),w(Q,"class","pf-v5-c-masthead__content"),w(F,"class","pf-v5-c-masthead pf-m-display-inline blockscape-masthead"),w(C,"class","pf-v5-c-page__header"),C.hidden=m=!r[3],w(mt,"class","sidebar-heading"),w(rt,"id","modelList"),w(rt,"class","model-nav-list"),w(ht,"class","model-actions"),w(Le,"class","sidebar-heading"),w(fe,"id","localBackendStatus"),w(fe,"class","local-backend__status muted"),w(Fe,"class","sr-only"),w(Fe,"for","localFileList"),w(en,"for","localDirSelect"),ln.__value="",eo(ln,ln.__value),w(Ft,"id","localDirSelect"),w(Ft,"class","pf-v5-c-form-control"),w(Ft,"aria-label","Folder filter"),w(ot,"class","local-backend__dir"),w(Rt,"id","localFileList"),w(Rt,"class","pf-v5-c-form-control"),w(Rt,"size","12"),Rt.multiple=!0,w(Rt,"aria-label","Blockscape files on local server"),w(Mn,"class","local-backend__actions"),w(K,"class","local-backend__list"),w(Ot,"class","local-backend__save"),w(g,"id","localBackendPanel"),w(g,"class","local-backend"),g.hidden=!0,w(He,"class","blockscape-sidebar"),w(He,"aria-label","Models"),He.hidden=Xt=!r[2],w(Zt,"class","blockscape-main"),w(nt,"class","blockscape-content"),w(Ye,"class","pf-v5-c-page__main"),w(tn,"class","blockscape-footer__inner"),w(St,"class","pf-v5-c-page__footer blockscape-footer"),St.hidden=yn=!r[1],w(A,"class","pf-v5-c-page"),En.a=y,w(N,"id","overlay"),w(N,"class","svg-layer"),w(E,"id","tabTooltip"),w(E,"class","blockscape-tab-tooltip"),E.hidden=!0,w(E,"aria-hidden","true"),w(X,"id","tileContextMenu"),w(X,"class","tile-context-menu"),X.hidden=!0,w(X,"aria-hidden","true"),w(ye,"id","itemPreview"),w(ye,"class","item-preview"),ye.hidden=!0,w(ye,"aria-hidden","true")},m(de,ne){_(Ur.head,c),yt(de,f,ne),yt(de,A,ne),_(A,C),_(C,F),_(F,Q),_(Q,J),_(J,te),_(J,x),_(J,re),_(re,j),_(j,ae),_(ae,Me),_(ae,tt),_(ae,Ge),_(j,ze),_(j,W),_(j,Y),_(j,we),_(j,R),_(j,_e),_(j,Oe),_(j,pe),_(re,at),_(re,se),_(se,ve),_(se,qe),_(se,O),_(se,Z),_(se,k),_(J,Ie),_(J,$e),_(A,Re),_(A,Ye),_(Ye,nt),_(nt,He),_(He,mt),_(He,Xe),_(He,rt),_(He,ct),_(He,ht),_(He,S),_(He,g),_(g,Le),_(g,v),_(g,fe),_(g,Ht),_(g,K),_(K,Fe),_(K,Et),_(K,ot),_(ot,en),_(ot,Nn),_(ot,Ft),_(Ft,ln),_(K,Wt),_(K,Rt),_(K,no),_(K,Mn),_(g,Kn),_(g,Ot),_(nt,vn),_(nt,Zt),_(A,jt),_(A,St),_(St,tn),yt(de,nn,ne),En.m(d,de,ne),yt(de,y,ne),yt(de,N,ne),yt(de,M,ne),yt(de,E,ne),yt(de,V,ne),yt(de,X,ne),yt(de,q,ne),yt(de,ye,ne),yt(de,Ee,ne),Ai(me,de,ne),yt(de,We,ne),Ai(Ze,de,ne),he=!0,Lt||(bt=Qn(ae,"click",r[5]),Lt=!0)},p(de,[ne]){(!he||ne&1)&&w(ae,"aria-expanded",de[0]),(!he||ne&1&&je!==(je=de[0]?"Hide advanced tools":"Show advanced tools"))&&w(ae,"aria-label",je),(!he||ne&1&&ee!==(ee=!de[0]))&&(se.hidden=ee),(!he||ne&1&&ke!==(ke=!de[0]))&&w(se,"aria-hidden",ke),(!he||ne&1&&ge!==(ge=de[0]?"true":"false"))&&w(re,"data-expanded",ge),(!he||ne&8&&m!==(m=!de[3]))&&(C.hidden=m),(!he||ne&4&&Xt!==(Xt=!de[2]))&&(He.hidden=Xt),(!he||ne&2&&yn!==(yn=!de[1]))&&(St.hidden=yn)},i(de){he||(xi(me.$$.fragment,de),xi(Ze.$$.fragment,de),he=!0)},o(de){da(me.$$.fragment,de),da(Ze.$$.fragment,de),he=!1},d(de){de&&(ft(f),ft(A),ft(nn),En.d(),ft(y),ft(N),ft(M),ft(E),ft(V),ft(X),ft(q),ft(ye),ft(Ee),ft(We)),ft(c),Ti(me,de),Ti(Ze,de),Lt=!1,bt()}}}function ac(r,c,f){let A,C,F,{seed:Q}=c,{features:J={}}=c;const x=Q?JSON.stringify(Q,null,2):`
  {
  "id": "blockscape",
  "title": "Blockscape (AI maps)",
  "abstract": "Blockscape (pronounced BYK-shed) visualizes value chains and dependencies using a BS file. Inspired by Wardley maps, these maps emphasizes the topology that makes maps useful.",
  "categories": [
    {
      "id": "communication",
      "title": "Communication",
      "items": [
        {
          "id": "gestalt",
          "name": "Visualise to understand",
          "logo": "./logos/block-mind-blown.gif",
          "deps": []
        },
        {
          "id": "value-chain",
          "name": "Visible value chain (y-axis)",
          "deps": []
        },
        {
          "id": "evolution",
          "name": "Evolution and maturity (x-axis)",
          "deps": []
        },
        {
          "id": "relational-awareness",
          "name": "Relations",
          "logo": "./logos/relations.png",
          "deps": []
        },
        {
          "id": "icons",
          "name": "Icons",
          "deps": []
        }
      ]
    },
    {
      "id": "experience",
      "title": "User Experience",
      "items": [
        {
          "id": "paste-bs-file",
          "name": "Paste (cmd-v)",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "load-multidoc-file",
          "name": "Series",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "create-gist-multidoc",
          "name": "Gist",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "abstract-gist-loading",
          "name": "Links",
          "deps": [
            "gists",
            "bs-format-simple"
          ]
        },
        {
          "id": "model-collection",
          "name": "Portfolio",
          "deps": [
            "apicurio",
            "bs-format-simple"
          ]
        }
      ]
    },
    {
      "id": "authoring-ai",
      "title": "Authoring (LLM)",
      "items": [
        {
          "id": "bs-format-simple",
          "name": "BS Schema",
          "deps": []
        },
        {
          "id": "editor-human-terms",
          "name": "Edit",
          "deps": [
            "bs-format-simple",
            "gestalt"
          ]
        },
        {
          "id": "llm-generate-bs",
          "name": "LLM generates BS",
          "external": "https://github.com/pwright/blockscape/blob/main/map-generation-prompt.md",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "llm-consume-bs",
          "name": "LLM consumes BS",
          "deps": [
            "bs-format-simple"
          ]
        },
        {
          "id": "move-items",
          "name": "Move (shift - arrow keys)",
          "logo": "./logos/block-swap.gif",
          "deps": []
        }
      ]
    },
    {
      "id": "platforms",
      "title": "Platforms",
      "items": [
        {
          "id": "gists",
          "name": "Gist",
          "logo": "https://favicon.im/github.com",
          "deps": []
        },
        {
          "id": "apicurio",
          "name": "Apicurio",
          "logo": "https://www.google.com/s2/favicons?domain=apicur.io&sz=96",
          "deps": []
        }
      ]
    }
  ]
}`;let re=!1;const j=()=>{if(f(0,re=!re),!re){const ae=document.getElementById("search");ae&&ae.value&&(ae.value="",ae.dispatchEvent(new Event("input",{bubbles:!0})))}};return Tl(()=>{Jl(J)}),r.$$set=ae=>{"seed"in ae&&f(6,Q=ae.seed),"features"in ae&&f(7,J=ae.features)},r.$$.update=()=>{r.$$.dirty&128&&f(3,A=J.showHeader!==!1),r.$$.dirty&128&&f(2,C=J.showSidebar!==!1),r.$$.dirty&128&&f(1,F=J.showFooter!==!1)},[re,F,C,A,x,j,Q,J]}class rc extends Ni{constructor(c){super(),Li(this,c,ac,ic,_i,{seed:6,features:7})}}function sc(r){let c,f;return c=new rc({props:{seed:r[0],features:r[1]}}),{c(){ua(c.$$.fragment)},m(A,C){Ai(c,A,C),f=!0},p(A,[C]){const F={};C&1&&(F.seed=A[0]),C&2&&(F.features=A[1]),c.$set(F)},i(A){f||(xi(c.$$.fragment,A),f=!0)},o(A){da(c.$$.fragment,A),f=!1},d(A){Ti(c,A)}}}function lc(r,c,f){let{seed:A}=c,{features:C={}}=c;return r.$$set=F=>{"seed"in F&&f(0,A=F.seed),"features"in F&&f(1,C=F.features)},[A,C]}class cc extends Ni{constructor(c){super(),Li(this,c,lc,sc,_i,{seed:0,features:1})}}return cc}();
